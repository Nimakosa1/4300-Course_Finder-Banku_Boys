(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();var gA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function x3(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var PR={exports:{}},B_={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D5;function Hee(){if(D5)return B_;D5=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function i(r,n,s){var a=null;if(s!==void 0&&(a=""+s),n.key!==void 0&&(a=""+n.key),"key"in n){s={};for(var o in n)o!=="key"&&(s[o]=n[o])}else s=n;return n=s.ref,{$$typeof:t,type:r,key:a,ref:n!==void 0?n:null,props:s}}return B_.Fragment=e,B_.jsx=i,B_.jsxs=i,B_}var P5;function Gee(){return P5||(P5=1,PR.exports=Hee()),PR.exports}var Pe=Gee(),RR={exports:{}},rr={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var R5;function jee(){if(R5)return rr;R5=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.iterator;function d(G){return G===null||typeof G!="object"?null:(G=h&&G[h]||G["@@iterator"],typeof G=="function"?G:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,x={};function v(G,j,ee){this.props=G,this.context=j,this.refs=x,this.updater=ee||p}v.prototype.isReactComponent={},v.prototype.setState=function(G,j){if(typeof G!="object"&&typeof G!="function"&&G!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,G,j,"setState")},v.prototype.forceUpdate=function(G){this.updater.enqueueForceUpdate(this,G,"forceUpdate")};function b(){}b.prototype=v.prototype;function w(G,j,ee){this.props=G,this.context=j,this.refs=x,this.updater=ee||p}var M=w.prototype=new b;M.constructor=w,g(M,v.prototype),M.isPureReactComponent=!0;var E=Array.isArray,D={H:null,A:null,T:null,S:null},T=Object.prototype.hasOwnProperty;function L(G,j,ee,oe,Q,ae){return ee=ae.ref,{$$typeof:t,type:G,key:j,ref:ee!==void 0?ee:null,props:ae}}function P(G,j){return L(G.type,j,void 0,void 0,void 0,G.props)}function R(G){return typeof G=="object"&&G!==null&&G.$$typeof===t}function O(G){var j={"=":"=0",":":"=2"};return"$"+G.replace(/[=:]/g,function(ee){return j[ee]})}var U=/\/+/g;function F(G,j){return typeof G=="object"&&G!==null&&G.key!=null?O(""+G.key):j.toString(36)}function V(){}function k(G){switch(G.status){case"fulfilled":return G.value;case"rejected":throw G.reason;default:switch(typeof G.status=="string"?G.then(V,V):(G.status="pending",G.then(function(j){G.status==="pending"&&(G.status="fulfilled",G.value=j)},function(j){G.status==="pending"&&(G.status="rejected",G.reason=j)})),G.status){case"fulfilled":return G.value;case"rejected":throw G.reason}}throw G}function K(G,j,ee,oe,Q){var ae=typeof G;(ae==="undefined"||ae==="boolean")&&(G=null);var ne=!1;if(G===null)ne=!0;else switch(ae){case"bigint":case"string":case"number":ne=!0;break;case"object":switch(G.$$typeof){case t:case e:ne=!0;break;case u:return ne=G._init,K(ne(G._payload),j,ee,oe,Q)}}if(ne)return Q=Q(G),ne=oe===""?"."+F(G,0):oe,E(Q)?(ee="",ne!=null&&(ee=ne.replace(U,"$&/")+"/"),K(Q,j,ee,"",function(xe){return xe})):Q!=null&&(R(Q)&&(Q=P(Q,ee+(Q.key==null||G&&G.key===Q.key?"":(""+Q.key).replace(U,"$&/")+"/")+ne)),j.push(Q)),1;ne=0;var ue=oe===""?".":oe+":";if(E(G))for(var fe=0;fe<G.length;fe++)oe=G[fe],ae=ue+F(oe,fe),ne+=K(oe,j,ee,ae,Q);else if(fe=d(G),typeof fe=="function")for(G=fe.call(G),fe=0;!(oe=G.next()).done;)oe=oe.value,ae=ue+F(oe,fe++),ne+=K(oe,j,ee,ae,Q);else if(ae==="object"){if(typeof G.then=="function")return K(k(G),j,ee,oe,Q);throw j=String(G),Error("Objects are not valid as a React child (found: "+(j==="[object Object]"?"object with keys {"+Object.keys(G).join(", ")+"}":j)+"). If you meant to render a collection of children, use an array instead.")}return ne}function X(G,j,ee){if(G==null)return G;var oe=[],Q=0;return K(G,oe,"","",function(ae){return j.call(ee,ae,Q++)}),oe}function $(G){if(G._status===-1){var j=G._result;j=j(),j.then(function(ee){(G._status===0||G._status===-1)&&(G._status=1,G._result=ee)},function(ee){(G._status===0||G._status===-1)&&(G._status=2,G._result=ee)}),G._status===-1&&(G._status=0,G._result=j)}if(G._status===1)return G._result.default;throw G._result}var Y=typeof reportError=="function"?reportError:function(G){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var j=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof G=="object"&&G!==null&&typeof G.message=="string"?String(G.message):String(G),error:G});if(!window.dispatchEvent(j))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",G);return}console.error(G)};function re(){}return rr.Children={map:X,forEach:function(G,j,ee){X(G,function(){j.apply(this,arguments)},ee)},count:function(G){var j=0;return X(G,function(){j++}),j},toArray:function(G){return X(G,function(j){return j})||[]},only:function(G){if(!R(G))throw Error("React.Children.only expected to receive a single React element child.");return G}},rr.Component=v,rr.Fragment=i,rr.Profiler=n,rr.PureComponent=w,rr.StrictMode=r,rr.Suspense=l,rr.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,rr.act=function(){throw Error("act(...) is not supported in production builds of React.")},rr.cache=function(G){return function(){return G.apply(null,arguments)}},rr.cloneElement=function(G,j,ee){if(G==null)throw Error("The argument must be a React element, but you passed "+G+".");var oe=g({},G.props),Q=G.key,ae=void 0;if(j!=null)for(ne in j.ref!==void 0&&(ae=void 0),j.key!==void 0&&(Q=""+j.key),j)!T.call(j,ne)||ne==="key"||ne==="__self"||ne==="__source"||ne==="ref"&&j.ref===void 0||(oe[ne]=j[ne]);var ne=arguments.length-2;if(ne===1)oe.children=ee;else if(1<ne){for(var ue=Array(ne),fe=0;fe<ne;fe++)ue[fe]=arguments[fe+2];oe.children=ue}return L(G.type,Q,void 0,void 0,ae,oe)},rr.createContext=function(G){return G={$$typeof:a,_currentValue:G,_currentValue2:G,_threadCount:0,Provider:null,Consumer:null},G.Provider=G,G.Consumer={$$typeof:s,_context:G},G},rr.createElement=function(G,j,ee){var oe,Q={},ae=null;if(j!=null)for(oe in j.key!==void 0&&(ae=""+j.key),j)T.call(j,oe)&&oe!=="key"&&oe!=="__self"&&oe!=="__source"&&(Q[oe]=j[oe]);var ne=arguments.length-2;if(ne===1)Q.children=ee;else if(1<ne){for(var ue=Array(ne),fe=0;fe<ne;fe++)ue[fe]=arguments[fe+2];Q.children=ue}if(G&&G.defaultProps)for(oe in ne=G.defaultProps,ne)Q[oe]===void 0&&(Q[oe]=ne[oe]);return L(G,ae,void 0,void 0,null,Q)},rr.createRef=function(){return{current:null}},rr.forwardRef=function(G){return{$$typeof:o,render:G}},rr.isValidElement=R,rr.lazy=function(G){return{$$typeof:u,_payload:{_status:-1,_result:G},_init:$}},rr.memo=function(G,j){return{$$typeof:c,type:G,compare:j===void 0?null:j}},rr.startTransition=function(G){var j=D.T,ee={};D.T=ee;try{var oe=G(),Q=D.S;Q!==null&&Q(ee,oe),typeof oe=="object"&&oe!==null&&typeof oe.then=="function"&&oe.then(re,Y)}catch(ae){Y(ae)}finally{D.T=j}},rr.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},rr.use=function(G){return D.H.use(G)},rr.useActionState=function(G,j,ee){return D.H.useActionState(G,j,ee)},rr.useCallback=function(G,j){return D.H.useCallback(G,j)},rr.useContext=function(G){return D.H.useContext(G)},rr.useDebugValue=function(){},rr.useDeferredValue=function(G,j){return D.H.useDeferredValue(G,j)},rr.useEffect=function(G,j){return D.H.useEffect(G,j)},rr.useId=function(){return D.H.useId()},rr.useImperativeHandle=function(G,j,ee){return D.H.useImperativeHandle(G,j,ee)},rr.useInsertionEffect=function(G,j){return D.H.useInsertionEffect(G,j)},rr.useLayoutEffect=function(G,j){return D.H.useLayoutEffect(G,j)},rr.useMemo=function(G,j){return D.H.useMemo(G,j)},rr.useOptimistic=function(G,j){return D.H.useOptimistic(G,j)},rr.useReducer=function(G,j,ee){return D.H.useReducer(G,j,ee)},rr.useRef=function(G){return D.H.useRef(G)},rr.useState=function(G){return D.H.useState(G)},rr.useSyncExternalStore=function(G,j,ee){return D.H.useSyncExternalStore(G,j,ee)},rr.useTransition=function(){return D.H.useTransition()},rr.version="19.0.0",rr}var O5;function $1(){return O5||(O5=1,RR.exports=jee()),RR.exports}var Me=$1();const yC=x3(Me);var OR={exports:{}},N_={},LR={exports:{}},IR={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var L5;function Wee(){return L5||(L5=1,function(t){function e(X,$){var Y=X.length;X.push($);e:for(;0<Y;){var re=Y-1>>>1,G=X[re];if(0<n(G,$))X[re]=$,X[Y]=G,Y=re;else break e}}function i(X){return X.length===0?null:X[0]}function r(X){if(X.length===0)return null;var $=X[0],Y=X.pop();if(Y!==$){X[0]=Y;e:for(var re=0,G=X.length,j=G>>>1;re<j;){var ee=2*(re+1)-1,oe=X[ee],Q=ee+1,ae=X[Q];if(0>n(oe,Y))Q<G&&0>n(ae,oe)?(X[re]=ae,X[Q]=Y,re=Q):(X[re]=oe,X[ee]=Y,re=ee);else if(Q<G&&0>n(ae,Y))X[re]=ae,X[Q]=Y,re=Q;else break e}}return $}function n(X,$){var Y=X.sortIndex-$.sortIndex;return Y!==0?Y:X.id-$.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();t.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,p=!1,g=!1,x=!1,v=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;function M(X){for(var $=i(c);$!==null;){if($.callback===null)r(c);else if($.startTime<=X)r(c),$.sortIndex=$.expirationTime,e(l,$);else break;$=i(c)}}function E(X){if(x=!1,M(X),!g)if(i(l)!==null)g=!0,k();else{var $=i(c);$!==null&&K(E,$.startTime-X)}}var D=!1,T=-1,L=5,P=-1;function R(){return!(t.unstable_now()-P<L)}function O(){if(D){var X=t.unstable_now();P=X;var $=!0;try{e:{g=!1,x&&(x=!1,b(T),T=-1),p=!0;var Y=d;try{t:{for(M(X),h=i(l);h!==null&&!(h.expirationTime>X&&R());){var re=h.callback;if(typeof re=="function"){h.callback=null,d=h.priorityLevel;var G=re(h.expirationTime<=X);if(X=t.unstable_now(),typeof G=="function"){h.callback=G,M(X),$=!0;break t}h===i(l)&&r(l),M(X)}else r(l);h=i(l)}if(h!==null)$=!0;else{var j=i(c);j!==null&&K(E,j.startTime-X),$=!1}}break e}finally{h=null,d=Y,p=!1}$=void 0}}finally{$?U():D=!1}}}var U;if(typeof w=="function")U=function(){w(O)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,V=F.port2;F.port1.onmessage=O,U=function(){V.postMessage(null)}}else U=function(){v(O,0)};function k(){D||(D=!0,U())}function K(X,$){T=v(function(){X(t.unstable_now())},$)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(X){X.callback=null},t.unstable_continueExecution=function(){g||p||(g=!0,k())},t.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<X?Math.floor(1e3/X):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(X){switch(d){case 1:case 2:case 3:var $=3;break;default:$=d}var Y=d;d=$;try{return X()}finally{d=Y}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(X,$){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var Y=d;d=X;try{return $()}finally{d=Y}},t.unstable_scheduleCallback=function(X,$,Y){var re=t.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?re+Y:re):Y=re,X){case 1:var G=-1;break;case 2:G=250;break;case 5:G=1073741823;break;case 4:G=1e4;break;default:G=5e3}return G=Y+G,X={id:u++,callback:$,priorityLevel:X,startTime:Y,expirationTime:G,sortIndex:-1},Y>re?(X.sortIndex=Y,e(c,X),i(l)===null&&X===i(c)&&(x?(b(T),T=-1):x=!0,K(E,Y-re))):(X.sortIndex=G,e(l,X),g||p||(g=!0,k())),X},t.unstable_shouldYield=R,t.unstable_wrapCallback=function(X){var $=d;return function(){var Y=d;d=$;try{return X.apply(this,arguments)}finally{d=Y}}}}(IR)),IR}var I5;function eN(){return I5||(I5=1,LR.exports=Wee()),LR.exports}var zR={exports:{}},So={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z5;function qee(){if(z5)return So;z5=1;var t=$1();function e(l){var c="https://react.dev/errors/"+l;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)c+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+l+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var r={d:{f:i,r:function(){throw Error(e(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},n=Symbol.for("react.portal");function s(l,c,u){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:n,key:h==null?null:""+h,children:l,containerInfo:c,implementation:u}}var a=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(l,c){if(l==="font")return"";if(typeof c=="string")return c==="use-credentials"?c:""}return So.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,So.createPortal=function(l,c){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)throw Error(e(299));return s(l,c,null,u)},So.flushSync=function(l){var c=a.T,u=r.p;try{if(a.T=null,r.p=2,l)return l()}finally{a.T=c,r.p=u,r.d.f()}},So.preconnect=function(l,c){typeof l=="string"&&(c?(c=c.crossOrigin,c=typeof c=="string"?c==="use-credentials"?c:"":void 0):c=null,r.d.C(l,c))},So.prefetchDNS=function(l){typeof l=="string"&&r.d.D(l)},So.preinit=function(l,c){if(typeof l=="string"&&c&&typeof c.as=="string"){var u=c.as,h=o(u,c.crossOrigin),d=typeof c.integrity=="string"?c.integrity:void 0,p=typeof c.fetchPriority=="string"?c.fetchPriority:void 0;u==="style"?r.d.S(l,typeof c.precedence=="string"?c.precedence:void 0,{crossOrigin:h,integrity:d,fetchPriority:p}):u==="script"&&r.d.X(l,{crossOrigin:h,integrity:d,fetchPriority:p,nonce:typeof c.nonce=="string"?c.nonce:void 0})}},So.preinitModule=function(l,c){if(typeof l=="string")if(typeof c=="object"&&c!==null){if(c.as==null||c.as==="script"){var u=o(c.as,c.crossOrigin);r.d.M(l,{crossOrigin:u,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0})}}else c==null&&r.d.M(l)},So.preload=function(l,c){if(typeof l=="string"&&typeof c=="object"&&c!==null&&typeof c.as=="string"){var u=c.as,h=o(u,c.crossOrigin);r.d.L(l,u,{crossOrigin:h,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0,type:typeof c.type=="string"?c.type:void 0,fetchPriority:typeof c.fetchPriority=="string"?c.fetchPriority:void 0,referrerPolicy:typeof c.referrerPolicy=="string"?c.referrerPolicy:void 0,imageSrcSet:typeof c.imageSrcSet=="string"?c.imageSrcSet:void 0,imageSizes:typeof c.imageSizes=="string"?c.imageSizes:void 0,media:typeof c.media=="string"?c.media:void 0})}},So.preloadModule=function(l,c){if(typeof l=="string")if(c){var u=o(c.as,c.crossOrigin);r.d.m(l,{as:typeof c.as=="string"&&c.as!=="script"?c.as:void 0,crossOrigin:u,integrity:typeof c.integrity=="string"?c.integrity:void 0})}else r.d.m(l)},So.requestFormReset=function(l){r.d.r(l)},So.unstable_batchedUpdates=function(l,c){return l(c)},So.useFormState=function(l,c,u){return a.H.useFormState(l,c,u)},So.useFormStatus=function(){return a.H.useHostTransitionStatus()},So.version="19.0.0",So}var U5;function Y9(){if(U5)return zR.exports;U5=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),zR.exports=qee(),zR.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B5;function Xee(){if(B5)return N_;B5=1;var t=eN(),e=$1(),i=Y9();function r(f){var m="https://react.dev/errors/"+f;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var S=2;S<arguments.length;S++)m+="&args[]="+encodeURIComponent(arguments[S])}return"Minified React error #"+f+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}var s=Symbol.for("react.element"),a=Symbol.for("react.transitional.element"),o=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),h=Symbol.for("react.provider"),d=Symbol.for("react.consumer"),p=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),v=Symbol.for("react.suspense_list"),b=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),M=Symbol.for("react.offscreen"),E=Symbol.for("react.memo_cache_sentinel"),D=Symbol.iterator;function T(f){return f===null||typeof f!="object"?null:(f=D&&f[D]||f["@@iterator"],typeof f=="function"?f:null)}var L=Symbol.for("react.client.reference");function P(f){if(f==null)return null;if(typeof f=="function")return f.$$typeof===L?null:f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case l:return"Fragment";case o:return"Portal";case u:return"Profiler";case c:return"StrictMode";case x:return"Suspense";case v:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case p:return(f.displayName||"Context")+".Provider";case d:return(f._context.displayName||"Context")+".Consumer";case g:var m=f.render;return f=f.displayName,f||(f=m.displayName||m.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case b:return m=f.displayName||null,m!==null?m:P(f.type)||"Memo";case w:m=f._payload,f=f._init;try{return P(f(m))}catch{}}return null}var R=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,O=Object.assign,U,F;function V(f){if(U===void 0)try{throw Error()}catch(S){var m=S.stack.trim().match(/\n( *(at )?)/);U=m&&m[1]||"",F=-1<S.stack.indexOf(`
    at`)?" (<anonymous>)":-1<S.stack.indexOf("@")?"@unknown:0:0":""}return`
`+U+f+F}var k=!1;function K(f,m){if(!f||k)return"";k=!0;var S=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var A={DetermineComponentFrameRoot:function(){try{if(m){var Lt=function(){throw Error()};if(Object.defineProperty(Lt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Lt,[])}catch(wt){var gt=wt}Reflect.construct(f,[],Lt)}else{try{Lt.call()}catch(wt){gt=wt}f.call(Lt.prototype)}}else{try{throw Error()}catch(wt){gt=wt}(Lt=f())&&typeof Lt.catch=="function"&&Lt.catch(function(){})}}catch(wt){if(wt&&gt&&typeof wt.stack=="string")return[wt.stack,gt.stack]}return[null,null]}};A.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var I=Object.getOwnPropertyDescriptor(A.DetermineComponentFrameRoot,"name");I&&I.configurable&&Object.defineProperty(A.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var B=A.DetermineComponentFrameRoot(),ie=B[0],ve=B[1];if(ie&&ve){var Le=ie.split(`
`),Je=ve.split(`
`);for(I=A=0;A<Le.length&&!Le[A].includes("DetermineComponentFrameRoot");)A++;for(;I<Je.length&&!Je[I].includes("DetermineComponentFrameRoot");)I++;if(A===Le.length||I===Je.length)for(A=Le.length-1,I=Je.length-1;1<=A&&0<=I&&Le[A]!==Je[I];)I--;for(;1<=A&&0<=I;A--,I--)if(Le[A]!==Je[I]){if(A!==1||I!==1)do if(A--,I--,0>I||Le[A]!==Je[I]){var Et=`
`+Le[A].replace(" at new "," at ");return f.displayName&&Et.includes("<anonymous>")&&(Et=Et.replace("<anonymous>",f.displayName)),Et}while(1<=A&&0<=I);break}}}finally{k=!1,Error.prepareStackTrace=S}return(S=f?f.displayName||f.name:"")?V(S):""}function X(f){switch(f.tag){case 26:case 27:case 5:return V(f.type);case 16:return V("Lazy");case 13:return V("Suspense");case 19:return V("SuspenseList");case 0:case 15:return f=K(f.type,!1),f;case 11:return f=K(f.type.render,!1),f;case 1:return f=K(f.type,!0),f;default:return""}}function $(f){try{var m="";do m+=X(f),f=f.return;while(f);return m}catch(S){return`
Error generating stack: `+S.message+`
`+S.stack}}function Y(f){var m=f,S=f;if(f.alternate)for(;m.return;)m=m.return;else{f=m;do m=f,(m.flags&4098)!==0&&(S=m.return),f=m.return;while(f)}return m.tag===3?S:null}function re(f){if(f.tag===13){var m=f.memoizedState;if(m===null&&(f=f.alternate,f!==null&&(m=f.memoizedState)),m!==null)return m.dehydrated}return null}function G(f){if(Y(f)!==f)throw Error(r(188))}function j(f){var m=f.alternate;if(!m){if(m=Y(f),m===null)throw Error(r(188));return m!==f?null:f}for(var S=f,A=m;;){var I=S.return;if(I===null)break;var B=I.alternate;if(B===null){if(A=I.return,A!==null){S=A;continue}break}if(I.child===B.child){for(B=I.child;B;){if(B===S)return G(I),f;if(B===A)return G(I),m;B=B.sibling}throw Error(r(188))}if(S.return!==A.return)S=I,A=B;else{for(var ie=!1,ve=I.child;ve;){if(ve===S){ie=!0,S=I,A=B;break}if(ve===A){ie=!0,A=I,S=B;break}ve=ve.sibling}if(!ie){for(ve=B.child;ve;){if(ve===S){ie=!0,S=B,A=I;break}if(ve===A){ie=!0,A=B,S=I;break}ve=ve.sibling}if(!ie)throw Error(r(189))}}if(S.alternate!==A)throw Error(r(190))}if(S.tag!==3)throw Error(r(188));return S.stateNode.current===S?f:m}function ee(f){var m=f.tag;if(m===5||m===26||m===27||m===6)return f;for(f=f.child;f!==null;){if(m=ee(f),m!==null)return m;f=f.sibling}return null}var oe=Array.isArray,Q=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ae={pending:!1,data:null,method:null,action:null},ne=[],ue=-1;function fe(f){return{current:f}}function xe(f){0>ue||(f.current=ne[ue],ne[ue]=null,ue--)}function be(f,m){ue++,ne[ue]=f.current,f.current=m}var Ce=fe(null),ge=fe(null),Te=fe(null),ce=fe(null);function Ue(f,m){switch(be(Te,m),be(ge,f),be(Ce,null),f=m.nodeType,f){case 9:case 11:m=(m=m.documentElement)&&(m=m.namespaceURI)?n5(m):0;break;default:if(f=f===8?m.parentNode:m,m=f.tagName,f=f.namespaceURI)f=n5(f),m=s5(f,m);else switch(m){case"svg":m=1;break;case"math":m=2;break;default:m=0}}xe(Ce),be(Ce,m)}function ze(){xe(Ce),xe(ge),xe(Te)}function Xe(f){f.memoizedState!==null&&be(ce,f);var m=Ce.current,S=s5(m,f.type);m!==S&&(be(ge,f),be(Ce,S))}function De(f){ge.current===f&&(xe(Ce),xe(ge)),ce.current===f&&(xe(ce),O_._currentValue=ae)}var Ge=Object.prototype.hasOwnProperty,We=t.unstable_scheduleCallback,se=t.unstable_cancelCallback,H=t.unstable_shouldYield,Z=t.unstable_requestPaint,pe=t.unstable_now,we=t.unstable_getCurrentPriorityLevel,J=t.unstable_ImmediatePriority,He=t.unstable_UserBlockingPriority,je=t.unstable_NormalPriority,Ye=t.unstable_LowPriority,Ve=t.unstable_IdlePriority,Ke=t.log,at=t.unstable_setDisableYieldValue,ut=null,ht=null;function $e(f){if(ht&&typeof ht.onCommitFiberRoot=="function")try{ht.onCommitFiberRoot(ut,f,void 0,(f.current.flags&128)===128)}catch{}}function St(f){if(typeof Ke=="function"&&at(f),ht&&typeof ht.setStrictMode=="function")try{ht.setStrictMode(ut,f)}catch{}}var Pt=Math.clz32?Math.clz32:Re,Kt=Math.log,le=Math.LN2;function Re(f){return f>>>=0,f===0?32:31-(Kt(f)/le|0)|0}var Ee=128,Qe=4194304;function ot(f){var m=f&42;if(m!==0)return m;switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return f&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return f}}function pt(f,m){var S=f.pendingLanes;if(S===0)return 0;var A=0,I=f.suspendedLanes,B=f.pingedLanes,ie=f.warmLanes;f=f.finishedLanes!==0;var ve=S&134217727;return ve!==0?(S=ve&~I,S!==0?A=ot(S):(B&=ve,B!==0?A=ot(B):f||(ie=ve&~ie,ie!==0&&(A=ot(ie))))):(ve=S&~I,ve!==0?A=ot(ve):B!==0?A=ot(B):f||(ie=S&~ie,ie!==0&&(A=ot(ie)))),A===0?0:m!==0&&m!==A&&(m&I)===0&&(I=A&-A,ie=m&-m,I>=ie||I===32&&(ie&4194176)!==0)?m:A}function Bt(f,m){return(f.pendingLanes&~(f.suspendedLanes&~f.pingedLanes)&m)===0}function Jt(f,m){switch(f){case 1:case 2:case 4:case 8:return m+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qt(){var f=Ee;return Ee<<=1,(Ee&4194176)===0&&(Ee=128),f}function Ft(){var f=Qe;return Qe<<=1,(Qe&62914560)===0&&(Qe=4194304),f}function Ni(f){for(var m=[],S=0;31>S;S++)m.push(f);return m}function Oi(f,m){f.pendingLanes|=m,m!==268435456&&(f.suspendedLanes=0,f.pingedLanes=0,f.warmLanes=0)}function Tr(f,m,S,A,I,B){var ie=f.pendingLanes;f.pendingLanes=S,f.suspendedLanes=0,f.pingedLanes=0,f.warmLanes=0,f.expiredLanes&=S,f.entangledLanes&=S,f.errorRecoveryDisabledLanes&=S,f.shellSuspendCounter=0;var ve=f.entanglements,Le=f.expirationTimes,Je=f.hiddenUpdates;for(S=ie&~S;0<S;){var Et=31-Pt(S),Lt=1<<Et;ve[Et]=0,Le[Et]=-1;var gt=Je[Et];if(gt!==null)for(Je[Et]=null,Et=0;Et<gt.length;Et++){var wt=gt[Et];wt!==null&&(wt.lane&=-536870913)}S&=~Lt}A!==0&&Dn(f,A,0),B!==0&&I===0&&f.tag!==0&&(f.suspendedLanes|=B&~(ie&~m))}function Dn(f,m,S){f.pendingLanes|=m,f.suspendedLanes&=~m;var A=31-Pt(m);f.entangledLanes|=m,f.entanglements[A]=f.entanglements[A]|1073741824|S&4194218}function pn(f,m){var S=f.entangledLanes|=m;for(f=f.entanglements;S;){var A=31-Pt(S),I=1<<A;I&m|f[A]&m&&(f[A]|=m),S&=~I}}function Fr(f){return f&=-f,2<f?8<f?(f&134217727)!==0?32:268435456:8:2}function _e(){var f=Q.p;return f!==0?f:(f=window.event,f===void 0?32:w5(f.type))}function tt(f,m){var S=Q.p;try{return Q.p=f,m()}finally{Q.p=S}}var ct=Math.random().toString(36).slice(2),qe="__reactFiber$"+ct,it="__reactProps$"+ct,Gt="__reactContainer$"+ct,oi="__reactEvents$"+ct,gi="__reactListeners$"+ct,ri="__reactHandles$"+ct,Wi="__reactResources$"+ct,mi="__reactMarker$"+ct;function Mi(f){delete f[qe],delete f[it],delete f[oi],delete f[gi],delete f[ri]}function hi(f){var m=f[qe];if(m)return m;for(var S=f.parentNode;S;){if(m=S[Gt]||S[qe]){if(S=m.alternate,m.child!==null||S!==null&&S.child!==null)for(f=l5(f);f!==null;){if(S=f[qe])return S;f=l5(f)}return m}f=S,S=f.parentNode}return null}function de(f){if(f=f[qe]||f[Gt]){var m=f.tag;if(m===5||m===6||m===13||m===26||m===27||m===3)return f}return null}function ke(f){var m=f.tag;if(m===5||m===26||m===27||m===6)return f.stateNode;throw Error(r(33))}function rt(f){var m=f[Wi];return m||(m=f[Wi]={hoistableStyles:new Map,hoistableScripts:new Map}),m}function Ie(f){f[mi]=!0}var Fe=new Set,Dt={};function xt(f,m){Nt(f,m),Nt(f+"Capture",m)}function Nt(f,m){for(Dt[f]=m,f=0;f<m.length;f++)Fe.add(m[f])}var kt=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),li=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ii={},te={};function he(f){return Ge.call(te,f)?!0:Ge.call(ii,f)?!1:li.test(f)?te[f]=!0:(ii[f]=!0,!1)}function Ae(f,m,S){if(he(m))if(S===null)f.removeAttribute(m);else{switch(typeof S){case"undefined":case"function":case"symbol":f.removeAttribute(m);return;case"boolean":var A=m.toLowerCase().slice(0,5);if(A!=="data-"&&A!=="aria-"){f.removeAttribute(m);return}}f.setAttribute(m,""+S)}}function me(f,m,S){if(S===null)f.removeAttribute(m);else{switch(typeof S){case"undefined":case"function":case"symbol":case"boolean":f.removeAttribute(m);return}f.setAttribute(m,""+S)}}function Ne(f,m,S,A){if(A===null)f.removeAttribute(S);else{switch(typeof A){case"undefined":case"function":case"symbol":case"boolean":f.removeAttribute(S);return}f.setAttributeNS(m,S,""+A)}}function mt(f){switch(typeof f){case"bigint":case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function ei(f){var m=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function jr(f){var m=ei(f)?"checked":"value",S=Object.getOwnPropertyDescriptor(f.constructor.prototype,m),A=""+f[m];if(!f.hasOwnProperty(m)&&typeof S<"u"&&typeof S.get=="function"&&typeof S.set=="function"){var I=S.get,B=S.set;return Object.defineProperty(f,m,{configurable:!0,get:function(){return I.call(this)},set:function(ie){A=""+ie,B.call(this,ie)}}),Object.defineProperty(f,m,{enumerable:S.enumerable}),{getValue:function(){return A},setValue:function(ie){A=""+ie},stopTracking:function(){f._valueTracker=null,delete f[m]}}}}function Li(f){f._valueTracker||(f._valueTracker=jr(f))}function Pn(f){if(!f)return!1;var m=f._valueTracker;if(!m)return!0;var S=m.getValue(),A="";return f&&(A=ei(f)?f.checked?"true":"false":f.value),f=A,f!==S?(m.setValue(f),!0):!1}function Un(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}var _n=/[\n"\\]/g;function zr(f){return f.replace(_n,function(m){return"\\"+m.charCodeAt(0).toString(16)+" "})}function Or(f,m,S,A,I,B,ie,ve){f.name="",ie!=null&&typeof ie!="function"&&typeof ie!="symbol"&&typeof ie!="boolean"?f.type=ie:f.removeAttribute("type"),m!=null?ie==="number"?(m===0&&f.value===""||f.value!=m)&&(f.value=""+mt(m)):f.value!==""+mt(m)&&(f.value=""+mt(m)):ie!=="submit"&&ie!=="reset"||f.removeAttribute("value"),m!=null?Rn(f,ie,mt(m)):S!=null?Rn(f,ie,mt(S)):A!=null&&f.removeAttribute("value"),I==null&&B!=null&&(f.defaultChecked=!!B),I!=null&&(f.checked=I&&typeof I!="function"&&typeof I!="symbol"),ve!=null&&typeof ve!="function"&&typeof ve!="symbol"&&typeof ve!="boolean"?f.name=""+mt(ve):f.removeAttribute("name")}function Vn(f,m,S,A,I,B,ie,ve){if(B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"&&(f.type=B),m!=null||S!=null){if(!(B!=="submit"&&B!=="reset"||m!=null))return;S=S!=null?""+mt(S):"",m=m!=null?""+mt(m):S,ve||m===f.value||(f.value=m),f.defaultValue=m}A=A??I,A=typeof A!="function"&&typeof A!="symbol"&&!!A,f.checked=ve?f.checked:!!A,f.defaultChecked=!!A,ie!=null&&typeof ie!="function"&&typeof ie!="symbol"&&typeof ie!="boolean"&&(f.name=ie)}function Rn(f,m,S){m==="number"&&Un(f.ownerDocument)===f||f.defaultValue===""+S||(f.defaultValue=""+S)}function mn(f,m,S,A){if(f=f.options,m){m={};for(var I=0;I<S.length;I++)m["$"+S[I]]=!0;for(S=0;S<f.length;S++)I=m.hasOwnProperty("$"+f[S].value),f[S].selected!==I&&(f[S].selected=I),I&&A&&(f[S].defaultSelected=!0)}else{for(S=""+mt(S),m=null,I=0;I<f.length;I++){if(f[I].value===S){f[I].selected=!0,A&&(f[I].defaultSelected=!0);return}m!==null||f[I].disabled||(m=f[I])}m!==null&&(m.selected=!0)}}function On(f,m,S){if(m!=null&&(m=""+mt(m),m!==f.value&&(f.value=m),S==null)){f.defaultValue!==m&&(f.defaultValue=m);return}f.defaultValue=S!=null?""+mt(S):""}function ha(f,m,S,A){if(m==null){if(A!=null){if(S!=null)throw Error(r(92));if(oe(A)){if(1<A.length)throw Error(r(93));A=A[0]}S=A}S==null&&(S=""),m=S}S=mt(m),f.defaultValue=S,A=f.textContent,A===S&&A!==""&&A!==null&&(f.value=A)}function _s(f,m){if(m){var S=f.firstChild;if(S&&S===f.lastChild&&S.nodeType===3){S.nodeValue=m;return}}f.textContent=m}var sf=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Th(f,m,S){var A=m.indexOf("--")===0;S==null||typeof S=="boolean"||S===""?A?f.setProperty(m,""):m==="float"?f.cssFloat="":f[m]="":A?f.setProperty(m,S):typeof S!="number"||S===0||sf.has(m)?m==="float"?f.cssFloat=S:f[m]=(""+S).trim():f[m]=S+"px"}function af(f,m,S){if(m!=null&&typeof m!="object")throw Error(r(62));if(f=f.style,S!=null){for(var A in S)!S.hasOwnProperty(A)||m!=null&&m.hasOwnProperty(A)||(A.indexOf("--")===0?f.setProperty(A,""):A==="float"?f.cssFloat="":f[A]="");for(var I in m)A=m[I],m.hasOwnProperty(I)&&S[I]!==A&&Th(f,I,A)}else for(var B in m)m.hasOwnProperty(B)&&Th(f,B,m[B])}function Zl(f){if(f.indexOf("-")===-1)return!1;switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ug=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),of=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function pl(f){return of.test(""+f)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":f}var Kl=null;function Jl(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var wc=null,No=null;function Ch(f){var m=de(f);if(m&&(f=m.stateNode)){var S=f[it]||null;e:switch(f=m.stateNode,m.type){case"input":if(Or(f,S.value,S.defaultValue,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name),m=S.name,S.type==="radio"&&m!=null){for(S=f;S.parentNode;)S=S.parentNode;for(S=S.querySelectorAll('input[name="'+zr(""+m)+'"][type="radio"]'),m=0;m<S.length;m++){var A=S[m];if(A!==f&&A.form===f.form){var I=A[it]||null;if(!I)throw Error(r(90));Or(A,I.value,I.defaultValue,I.defaultValue,I.checked,I.defaultChecked,I.type,I.name)}}for(m=0;m<S.length;m++)A=S[m],A.form===f.form&&Pn(A)}break e;case"textarea":On(f,S.value,S.defaultValue);break e;case"select":m=S.value,m!=null&&mn(f,!!S.multiple,m,!1)}}}var Dh=!1;function Vp(f,m,S){if(Dh)return f(m,S);Dh=!0;try{var A=f(m);return A}finally{if(Dh=!1,(wc!==null||No!==null)&&(Of(),wc&&(m=wc,f=No,No=wc=null,Ch(m),f)))for(m=0;m<f.length;m++)Ch(f[m])}}function $l(f,m){var S=f.stateNode;if(S===null)return null;var A=S[it]||null;if(A===null)return null;S=A[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(A=!A.disabled)||(f=f.type,A=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!A;break e;default:f=!1}if(f)return null;if(S&&typeof S!="function")throw Error(r(231,m,typeof S));return S}var cu=!1;if(kt)try{var uu={};Object.defineProperty(uu,"passive",{get:function(){cu=!0}}),window.addEventListener("test",uu,uu),window.removeEventListener("test",uu,uu)}catch{cu=!1}var Hn=null,lf=null,cf=null;function Hp(){if(cf)return cf;var f,m=lf,S=m.length,A,I="value"in Hn?Hn.value:Hn.textContent,B=I.length;for(f=0;f<S&&m[f]===I[f];f++);var ie=S-f;for(A=1;A<=ie&&m[S-A]===I[B-A];A++);return cf=I.slice(f,1<A?1-A:void 0)}function ml(f){var m=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&m===13&&(f=13)):f=m,f===10&&(f=13),32<=f||f===13?f:0}function hu(){return!0}function Ph(){return!1}function Gn(f){function m(S,A,I,B,ie){this._reactName=S,this._targetInst=I,this.type=A,this.nativeEvent=B,this.target=ie,this.currentTarget=null;for(var ve in f)f.hasOwnProperty(ve)&&(S=f[ve],this[ve]=S?S(B):B[ve]);return this.isDefaultPrevented=(B.defaultPrevented!=null?B.defaultPrevented:B.returnValue===!1)?hu:Ph,this.isPropagationStopped=Ph,this}return O(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var S=this.nativeEvent;S&&(S.preventDefault?S.preventDefault():typeof S.returnValue!="unknown"&&(S.returnValue=!1),this.isDefaultPrevented=hu)},stopPropagation:function(){var S=this.nativeEvent;S&&(S.stopPropagation?S.stopPropagation():typeof S.cancelBubble!="unknown"&&(S.cancelBubble=!0),this.isPropagationStopped=hu)},persist:function(){},isPersistent:hu}),m}var co={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ba=Gn(co),du=O({},co,{view:0,detail:0}),Gp=Gn(du),Fo,gl,fu,vl=O({},du,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Fg,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==fu&&(fu&&f.type==="mousemove"?(Fo=f.screenX-fu.screenX,gl=f.screenY-fu.screenY):gl=Fo=0,fu=f),Fo)},movementY:function(f){return"movementY"in f?f.movementY:gl}}),uf=Gn(vl),da=O({},vl,{dataTransfer:0}),Pb=Gn(da),Bn=O({},du,{relatedTarget:0}),pu=Gn(Bn),Bg=O({},co,{animationName:0,elapsedTime:0,pseudoElement:0}),ry=Gn(Bg),Xs=O({},co,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),uo=Gn(Xs),as=O({},co,{data:0}),ko=Gn(as),Ng={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ZM={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},KM={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Rb(f){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(f):(f=KM[f])?!!m[f]:!1}function Fg(){return Rb}var JM=O({},du,{key:function(f){if(f.key){var m=Ng[f.key]||f.key;if(m!=="Unidentified")return m}return f.type==="keypress"?(f=ml(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?ZM[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Fg,charCode:function(f){return f.type==="keypress"?ml(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?ml(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),Ob=Gn(JM),Lb=O({},vl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ny=Gn(Lb),$M=O({},du,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Fg}),Ib=Gn($M),eE=O({},co,{propertyName:0,elapsedTime:0,pseudoElement:0}),mu=Gn(eE),zb=O({},vl,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),ZP=Gn(zb),tE=O({},co,{newState:0,oldState:0}),Rh=Gn(tE),gu=[9,13,27,32],kg=kt&&"CompositionEvent"in window,hf=null;kt&&"documentMode"in document&&(hf=document.documentMode);var Vg=kt&&"TextEvent"in window&&!hf,Hg=kt&&(!kg||hf&&8<hf&&11>=hf),Oh=" ",Ys=!1;function Gg(f,m){switch(f){case"keyup":return gu.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ub(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var Lh=!1;function jg(f,m){switch(f){case"compositionend":return Ub(m);case"keypress":return m.which!==32?null:(Ys=!0,Oh);case"textInput":return f=m.data,f===Oh&&Ys?null:f;default:return null}}function Bb(f,m){if(Lh)return f==="compositionend"||!kg&&Gg(f,m)?(f=Hp(),cf=lf=Hn=null,Lh=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return Hg&&m.locale!=="ko"?null:m.data;default:return null}}var sy={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Nb(f){var m=f&&f.nodeName&&f.nodeName.toLowerCase();return m==="input"?!!sy[f.type]:m==="textarea"}function ho(f,m,S,A){wc?No?No.push(A):No=[A]:wc=A,m=tA(m,"onChange"),0<m.length&&(S=new Ba("onChange","change",null,S,A),f.push({event:S,listeners:m}))}var jp=null,df=null;function iE(f){$F(f,0)}function Wg(f){var m=ke(f);if(Pn(m))return f}function ay(f,m){if(f==="change")return m}var oy=!1;if(kt){var ly;if(kt){var Wp="oninput"in document;if(!Wp){var qp=document.createElement("div");qp.setAttribute("oninput","return;"),Wp=typeof qp.oninput=="function"}ly=Wp}else ly=!1;oy=ly&&(!document.documentMode||9<document.documentMode)}function Sn(){jp&&(jp.detachEvent("onpropertychange",rE),df=jp=null)}function rE(f){if(f.propertyName==="value"&&Wg(df)){var m=[];ho(m,df,f,Jl(f)),Vp(iE,m)}}function KP(f,m,S){f==="focusin"?(Sn(),jp=m,df=S,jp.attachEvent("onpropertychange",rE)):f==="focusout"&&Sn()}function nE(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return Wg(df)}function qg(f,m){if(f==="click")return Wg(m)}function Ih(f,m){if(f==="input"||f==="change")return Wg(m)}function sE(f,m){return f===m&&(f!==0||1/f===1/m)||f!==f&&m!==m}var fo=typeof Object.is=="function"?Object.is:sE;function ec(f,m){if(fo(f,m))return!0;if(typeof f!="object"||f===null||typeof m!="object"||m===null)return!1;var S=Object.keys(f),A=Object.keys(m);if(S.length!==A.length)return!1;for(A=0;A<S.length;A++){var I=S[A];if(!Ge.call(m,I)||!fo(f[I],m[I]))return!1}return!0}function po(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function Fb(f,m){var S=po(f);f=0;for(var A;S;){if(S.nodeType===3){if(A=f+S.textContent.length,f<=m&&A>=m)return{node:S,offset:m-f};f=A}e:{for(;S;){if(S.nextSibling){S=S.nextSibling;break e}S=S.parentNode}S=void 0}S=po(S)}}function kb(f,m){return f&&m?f===m?!0:f&&f.nodeType===3?!1:m&&m.nodeType===3?kb(f,m.parentNode):"contains"in f?f.contains(m):f.compareDocumentPosition?!!(f.compareDocumentPosition(m)&16):!1:!1}function Vb(f){f=f!=null&&f.ownerDocument!=null&&f.ownerDocument.defaultView!=null?f.ownerDocument.defaultView:window;for(var m=Un(f.document);m instanceof f.HTMLIFrameElement;){try{var S=typeof m.contentWindow.location.href=="string"}catch{S=!1}if(S)f=m.contentWindow;else break;m=Un(f.document)}return m}function Xg(f){var m=f&&f.nodeName&&f.nodeName.toLowerCase();return m&&(m==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||m==="textarea"||f.contentEditable==="true")}function Hb(f,m){var S=Vb(m);m=f.focusedElem;var A=f.selectionRange;if(S!==m&&m&&m.ownerDocument&&kb(m.ownerDocument.documentElement,m)){if(A!==null&&Xg(m)){if(f=A.start,S=A.end,S===void 0&&(S=f),"selectionStart"in m)m.selectionStart=f,m.selectionEnd=Math.min(S,m.value.length);else if(S=(f=m.ownerDocument||document)&&f.defaultView||window,S.getSelection){S=S.getSelection();var I=m.textContent.length,B=Math.min(A.start,I);A=A.end===void 0?B:Math.min(A.end,I),!S.extend&&B>A&&(I=A,A=B,B=I),I=Fb(m,B);var ie=Fb(m,A);I&&ie&&(S.rangeCount!==1||S.anchorNode!==I.node||S.anchorOffset!==I.offset||S.focusNode!==ie.node||S.focusOffset!==ie.offset)&&(f=f.createRange(),f.setStart(I.node,I.offset),S.removeAllRanges(),B>A?(S.addRange(f),S.extend(ie.node,ie.offset)):(f.setEnd(ie.node,ie.offset),S.addRange(f)))}}for(f=[],S=m;S=S.parentNode;)S.nodeType===1&&f.push({element:S,left:S.scrollLeft,top:S.scrollTop});for(typeof m.focus=="function"&&m.focus(),m=0;m<f.length;m++)S=f[m],S.element.scrollLeft=S.left,S.element.scrollTop=S.top}}var cy=kt&&"documentMode"in document&&11>=document.documentMode,ff=null,Gb=null,Xp=null,uy=!1;function yl(f,m,S){var A=S.window===S?S.document:S.nodeType===9?S:S.ownerDocument;uy||ff==null||ff!==Un(A)||(A=ff,"selectionStart"in A&&Xg(A)?A={start:A.selectionStart,end:A.selectionEnd}:(A=(A.ownerDocument&&A.ownerDocument.defaultView||window).getSelection(),A={anchorNode:A.anchorNode,anchorOffset:A.anchorOffset,focusNode:A.focusNode,focusOffset:A.focusOffset}),Xp&&ec(Xp,A)||(Xp=A,A=tA(Gb,"onSelect"),0<A.length&&(m=new Ba("onSelect","select",null,m,S),f.push({event:m,listeners:A}),m.target=ff)))}function vu(f,m){var S={};return S[f.toLowerCase()]=m.toLowerCase(),S["Webkit"+f]="webkit"+m,S["Moz"+f]="moz"+m,S}var pf={animationend:vu("Animation","AnimationEnd"),animationiteration:vu("Animation","AnimationIteration"),animationstart:vu("Animation","AnimationStart"),transitionrun:vu("Transition","TransitionRun"),transitionstart:vu("Transition","TransitionStart"),transitioncancel:vu("Transition","TransitionCancel"),transitionend:vu("Transition","TransitionEnd")},jb={},hy={};kt&&(hy=document.createElement("div").style,"AnimationEvent"in window||(delete pf.animationend.animation,delete pf.animationiteration.animation,delete pf.animationstart.animation),"TransitionEvent"in window||delete pf.transitionend.transition);function os(f){if(jb[f])return jb[f];if(!pf[f])return f;var m=pf[f],S;for(S in m)if(m.hasOwnProperty(S)&&S in hy)return jb[f]=m[S];return f}var Wb=os("animationend"),mo=os("animationiteration"),qb=os("animationstart"),yu=os("transitionrun"),Yp=os("transitionstart"),zh=os("transitioncancel"),dy=os("transitionend"),fy=new Map,xu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function xl(f,m){fy.set(f,m),xt(m,[f])}var Qs=[],Mc=0,bu=0;function Yg(){for(var f=Mc,m=bu=Mc=0;m<f;){var S=Qs[m];Qs[m++]=null;var A=Qs[m];Qs[m++]=null;var I=Qs[m];Qs[m++]=null;var B=Qs[m];if(Qs[m++]=null,A!==null&&I!==null){var ie=A.pending;ie===null?I.next=I:(I.next=ie.next,ie.next=I),A.pending=I}B!==0&&Zg(S,I,B)}}function Qg(f,m,S,A){Qs[Mc++]=f,Qs[Mc++]=m,Qs[Mc++]=S,Qs[Mc++]=A,bu|=A,f.lanes|=A,f=f.alternate,f!==null&&(f.lanes|=A)}function mf(f,m,S,A){return Qg(f,m,S,A),Kg(f)}function _u(f,m){return Qg(f,null,null,m),Kg(f)}function Zg(f,m,S){f.lanes|=S;var A=f.alternate;A!==null&&(A.lanes|=S);for(var I=!1,B=f.return;B!==null;)B.childLanes|=S,A=B.alternate,A!==null&&(A.childLanes|=S),B.tag===22&&(f=B.stateNode,f===null||f._visibility&1||(I=!0)),f=B,B=B.return;I&&m!==null&&f.tag===3&&(B=f.stateNode,I=31-Pt(S),B=B.hiddenUpdates,f=B[I],f===null?B[I]=[m]:f.push(m),m.lane=S|536870912)}function Kg(f){if(50<Dl)throw Dl=0,Hu=null,Error(r(185));for(var m=f.return;m!==null;)f=m,m=f.return;return f.tag===3?f.stateNode:null}var Uh={},py=new WeakMap;function go(f,m){if(typeof f=="object"&&f!==null){var S=py.get(f);return S!==void 0?S:(m={value:f,source:m,stack:$(m)},py.set(f,m),m)}return{value:f,source:m,stack:$(m)}}var gf=[],Bh=0,fa=null,Jg=0,on=[],Vo=0,Su=null,Ec=1,wu="";function Na(f,m){gf[Bh++]=Jg,gf[Bh++]=fa,fa=f,Jg=m}function Xb(f,m,S){on[Vo++]=Ec,on[Vo++]=wu,on[Vo++]=Su,Su=f;var A=Ec;f=wu;var I=32-Pt(A)-1;A&=~(1<<I),S+=1;var B=32-Pt(m)+I;if(30<B){var ie=I-I%5;B=(A&(1<<ie)-1).toString(32),A>>=ie,I-=ie,Ec=1<<32-Pt(m)+I|S<<I|A,wu=B+f}else Ec=1<<B|S<<I|A,wu=f}function $g(f){f.return!==null&&(Na(f,1),Xb(f,1,0))}function Nh(f){for(;f===fa;)fa=gf[--Bh],gf[Bh]=null,Jg=gf[--Bh],gf[Bh]=null;for(;f===Su;)Su=on[--Vo],on[Vo]=null,wu=on[--Vo],on[Vo]=null,Ec=on[--Vo],on[Vo]=null}var pa=null,Is=null,br=!1,bl=null,_l=!1,ev=Error(r(519));function vf(f){var m=Error(r(418,""));throw Ac(go(m,f)),ev}function aE(f){var m=f.stateNode,S=f.type,A=f.memoizedProps;switch(m[qe]=f,m[it]=A,S){case"dialog":Sr("cancel",m),Sr("close",m);break;case"iframe":case"object":case"embed":Sr("load",m);break;case"video":case"audio":for(S=0;S<T_.length;S++)Sr(T_[S],m);break;case"source":Sr("error",m);break;case"img":case"image":case"link":Sr("error",m),Sr("load",m);break;case"details":Sr("toggle",m);break;case"input":Sr("invalid",m),Vn(m,A.value,A.defaultValue,A.checked,A.defaultChecked,A.type,A.name,!0),Li(m);break;case"select":Sr("invalid",m);break;case"textarea":Sr("invalid",m),ha(m,A.value,A.defaultValue,A.children),Li(m)}S=A.children,typeof S!="string"&&typeof S!="number"&&typeof S!="bigint"||m.textContent===""+S||A.suppressHydrationWarning===!0||r5(m.textContent,S)?(A.popover!=null&&(Sr("beforetoggle",m),Sr("toggle",m)),A.onScroll!=null&&Sr("scroll",m),A.onScrollEnd!=null&&Sr("scrollend",m),A.onClick!=null&&(m.onclick=iA),m=!0):m=!1,m||vf(f)}function oE(f){for(pa=f.return;pa;)switch(pa.tag){case 3:case 27:_l=!0;return;case 5:case 13:_l=!1;return;default:pa=pa.return}}function Qp(f){if(f!==pa)return!1;if(!br)return oE(f),br=!0,!1;var m=!1,S;if((S=f.tag!==3&&f.tag!==27)&&((S=f.tag===5)&&(S=f.type,S=!(S!=="form"&&S!=="button")||vR(f.type,f.memoizedProps)),S=!S),S&&(m=!0),m&&Is&&vf(f),oE(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(r(317));e:{for(f=f.nextSibling,m=0;f;){if(f.nodeType===8)if(S=f.data,S==="/$"){if(m===0){Is=ju(f.nextSibling);break e}m--}else S!=="$"&&S!=="$!"&&S!=="$?"||m++;f=f.nextSibling}Is=null}}else Is=pa?ju(f.stateNode.nextSibling):null;return!0}function Zp(){Is=pa=null,br=!1}function Ac(f){bl===null?bl=[f]:bl.push(f)}var Fh=Error(r(460)),Yb=Error(r(474)),my={then:function(){}};function lE(f){return f=f.status,f==="fulfilled"||f==="rejected"}function tv(){}function kh(f,m,S){switch(S=f[S],S===void 0?f.push(m):S!==m&&(m.then(tv,tv),m=S),m.status){case"fulfilled":return m.value;case"rejected":throw f=m.reason,f===Fh?Error(r(483)):f;default:if(typeof m.status=="string")m.then(tv,tv);else{if(f=qr,f!==null&&100<f.shellSuspendCounter)throw Error(r(482));f=m,f.status="pending",f.then(function(A){if(m.status==="pending"){var I=m;I.status="fulfilled",I.value=A}},function(A){if(m.status==="pending"){var I=m;I.status="rejected",I.reason=A}})}switch(m.status){case"fulfilled":return m.value;case"rejected":throw f=m.reason,f===Fh?Error(r(483)):f}throw Kp=m,Fh}}var Kp=null;function Ur(){if(Kp===null)throw Error(r(459));var f=Kp;return Kp=null,f}var Vh=null,iv=0;function rv(f){var m=iv;return iv+=1,Vh===null&&(Vh=[]),kh(Vh,f,m)}function nv(f,m){m=m.props.ref,f.ref=m!==void 0?m:null}function gy(f,m){throw m.$$typeof===s?Error(r(525)):(f=Object.prototype.toString.call(m),Error(r(31,f==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":f)))}function cE(f){var m=f._init;return m(f._payload)}function uE(f){function m(nt,Ze){if(f){var dt=nt.deletions;dt===null?(nt.deletions=[Ze],nt.flags|=16):dt.push(Ze)}}function S(nt,Ze){if(!f)return null;for(;Ze!==null;)m(nt,Ze),Ze=Ze.sibling;return null}function A(nt){for(var Ze=new Map;nt!==null;)nt.key!==null?Ze.set(nt.key,nt):Ze.set(nt.index,nt),nt=nt.sibling;return Ze}function I(nt,Ze){return nt=Ha(nt,Ze),nt.index=0,nt.sibling=null,nt}function B(nt,Ze,dt){return nt.index=dt,f?(dt=nt.alternate,dt!==null?(dt=dt.index,dt<Ze?(nt.flags|=33554434,Ze):dt):(nt.flags|=33554434,Ze)):(nt.flags|=1048576,Ze)}function ie(nt){return f&&nt.alternate===null&&(nt.flags|=33554434),nt}function ve(nt,Ze,dt,Rt){return Ze===null||Ze.tag!==6?(Ze=hs(dt,nt.mode,Rt),Ze.return=nt,Ze):(Ze=I(Ze,dt),Ze.return=nt,Ze)}function Le(nt,Ze,dt,Rt){var si=dt.type;return si===l?Et(nt,Ze,dt.props.children,Rt,dt.key):Ze!==null&&(Ze.elementType===si||typeof si=="object"&&si!==null&&si.$$typeof===w&&cE(si)===Ze.type)?(Ze=I(Ze,dt.props),nv(Ze,dt),Ze.return=nt,Ze):(Ze=dm(dt.type,dt.key,dt.props,null,nt.mode,Rt),nv(Ze,dt),Ze.return=nt,Ze)}function Je(nt,Ze,dt,Rt){return Ze===null||Ze.tag!==4||Ze.stateNode.containerInfo!==dt.containerInfo||Ze.stateNode.implementation!==dt.implementation?(Ze=gv(dt,nt.mode,Rt),Ze.return=nt,Ze):(Ze=I(Ze,dt.children||[]),Ze.return=nt,Ze)}function Et(nt,Ze,dt,Rt,si){return Ze===null||Ze.tag!==7?(Ze=ad(dt,nt.mode,Rt,si),Ze.return=nt,Ze):(Ze=I(Ze,dt),Ze.return=nt,Ze)}function Lt(nt,Ze,dt){if(typeof Ze=="string"&&Ze!==""||typeof Ze=="number"||typeof Ze=="bigint")return Ze=hs(""+Ze,nt.mode,dt),Ze.return=nt,Ze;if(typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case a:return dt=dm(Ze.type,Ze.key,Ze.props,null,nt.mode,dt),nv(dt,Ze),dt.return=nt,dt;case o:return Ze=gv(Ze,nt.mode,dt),Ze.return=nt,Ze;case w:var Rt=Ze._init;return Ze=Rt(Ze._payload),Lt(nt,Ze,dt)}if(oe(Ze)||T(Ze))return Ze=ad(Ze,nt.mode,dt,null),Ze.return=nt,Ze;if(typeof Ze.then=="function")return Lt(nt,rv(Ze),dt);if(Ze.$$typeof===p)return Lt(nt,Ly(nt,Ze),dt);gy(nt,Ze)}return null}function gt(nt,Ze,dt,Rt){var si=Ze!==null?Ze.key:null;if(typeof dt=="string"&&dt!==""||typeof dt=="number"||typeof dt=="bigint")return si!==null?null:ve(nt,Ze,""+dt,Rt);if(typeof dt=="object"&&dt!==null){switch(dt.$$typeof){case a:return dt.key===si?Le(nt,Ze,dt,Rt):null;case o:return dt.key===si?Je(nt,Ze,dt,Rt):null;case w:return si=dt._init,dt=si(dt._payload),gt(nt,Ze,dt,Rt)}if(oe(dt)||T(dt))return si!==null?null:Et(nt,Ze,dt,Rt,null);if(typeof dt.then=="function")return gt(nt,Ze,rv(dt),Rt);if(dt.$$typeof===p)return gt(nt,Ze,Ly(nt,dt),Rt);gy(nt,dt)}return null}function wt(nt,Ze,dt,Rt,si){if(typeof Rt=="string"&&Rt!==""||typeof Rt=="number"||typeof Rt=="bigint")return nt=nt.get(dt)||null,ve(Ze,nt,""+Rt,si);if(typeof Rt=="object"&&Rt!==null){switch(Rt.$$typeof){case a:return nt=nt.get(Rt.key===null?dt:Rt.key)||null,Le(Ze,nt,Rt,si);case o:return nt=nt.get(Rt.key===null?dt:Rt.key)||null,Je(Ze,nt,Rt,si);case w:var dr=Rt._init;return Rt=dr(Rt._payload),wt(nt,Ze,dt,Rt,si)}if(oe(Rt)||T(Rt))return nt=nt.get(dt)||null,Et(Ze,nt,Rt,si,null);if(typeof Rt.then=="function")return wt(nt,Ze,dt,rv(Rt),si);if(Rt.$$typeof===p)return wt(nt,Ze,dt,Ly(Ze,Rt),si);gy(Ze,Rt)}return null}function pi(nt,Ze,dt,Rt){for(var si=null,dr=null,vi=Ze,zi=Ze=0,_a=null;vi!==null&&zi<dt.length;zi++){vi.index>zi?(_a=vi,vi=null):_a=vi.sibling;var Br=gt(nt,vi,dt[zi],Rt);if(Br===null){vi===null&&(vi=_a);break}f&&vi&&Br.alternate===null&&m(nt,vi),Ze=B(Br,Ze,zi),dr===null?si=Br:dr.sibling=Br,dr=Br,vi=_a}if(zi===dt.length)return S(nt,vi),br&&Na(nt,zi),si;if(vi===null){for(;zi<dt.length;zi++)vi=Lt(nt,dt[zi],Rt),vi!==null&&(Ze=B(vi,Ze,zi),dr===null?si=vi:dr.sibling=vi,dr=vi);return br&&Na(nt,zi),si}for(vi=A(vi);zi<dt.length;zi++)_a=wt(vi,nt,zi,dt[zi],Rt),_a!==null&&(f&&_a.alternate!==null&&vi.delete(_a.key===null?zi:_a.key),Ze=B(_a,Ze,zi),dr===null?si=_a:dr.sibling=_a,dr=_a);return f&&vi.forEach(function(_m){return m(nt,_m)}),br&&Na(nt,zi),si}function qi(nt,Ze,dt,Rt){if(dt==null)throw Error(r(151));for(var si=null,dr=null,vi=Ze,zi=Ze=0,_a=null,Br=dt.next();vi!==null&&!Br.done;zi++,Br=dt.next()){vi.index>zi?(_a=vi,vi=null):_a=vi.sibling;var _m=gt(nt,vi,Br.value,Rt);if(_m===null){vi===null&&(vi=_a);break}f&&vi&&_m.alternate===null&&m(nt,vi),Ze=B(_m,Ze,zi),dr===null?si=_m:dr.sibling=_m,dr=_m,vi=_a}if(Br.done)return S(nt,vi),br&&Na(nt,zi),si;if(vi===null){for(;!Br.done;zi++,Br=dt.next())Br=Lt(nt,Br.value,Rt),Br!==null&&(Ze=B(Br,Ze,zi),dr===null?si=Br:dr.sibling=Br,dr=Br);return br&&Na(nt,zi),si}for(vi=A(vi);!Br.done;zi++,Br=dt.next())Br=wt(vi,nt,zi,Br.value,Rt),Br!==null&&(f&&Br.alternate!==null&&vi.delete(Br.key===null?zi:Br.key),Ze=B(Br,Ze,zi),dr===null?si=Br:dr.sibling=Br,dr=Br);return f&&vi.forEach(function(Vee){return m(nt,Vee)}),br&&Na(nt,zi),si}function ps(nt,Ze,dt,Rt){if(typeof dt=="object"&&dt!==null&&dt.type===l&&dt.key===null&&(dt=dt.props.children),typeof dt=="object"&&dt!==null){switch(dt.$$typeof){case a:e:{for(var si=dt.key;Ze!==null;){if(Ze.key===si){if(si=dt.type,si===l){if(Ze.tag===7){S(nt,Ze.sibling),Rt=I(Ze,dt.props.children),Rt.return=nt,nt=Rt;break e}}else if(Ze.elementType===si||typeof si=="object"&&si!==null&&si.$$typeof===w&&cE(si)===Ze.type){S(nt,Ze.sibling),Rt=I(Ze,dt.props),nv(Rt,dt),Rt.return=nt,nt=Rt;break e}S(nt,Ze);break}else m(nt,Ze);Ze=Ze.sibling}dt.type===l?(Rt=ad(dt.props.children,nt.mode,Rt,dt.key),Rt.return=nt,nt=Rt):(Rt=dm(dt.type,dt.key,dt.props,null,nt.mode,Rt),nv(Rt,dt),Rt.return=nt,nt=Rt)}return ie(nt);case o:e:{for(si=dt.key;Ze!==null;){if(Ze.key===si)if(Ze.tag===4&&Ze.stateNode.containerInfo===dt.containerInfo&&Ze.stateNode.implementation===dt.implementation){S(nt,Ze.sibling),Rt=I(Ze,dt.children||[]),Rt.return=nt,nt=Rt;break e}else{S(nt,Ze);break}else m(nt,Ze);Ze=Ze.sibling}Rt=gv(dt,nt.mode,Rt),Rt.return=nt,nt=Rt}return ie(nt);case w:return si=dt._init,dt=si(dt._payload),ps(nt,Ze,dt,Rt)}if(oe(dt))return pi(nt,Ze,dt,Rt);if(T(dt)){if(si=T(dt),typeof si!="function")throw Error(r(150));return dt=si.call(dt),qi(nt,Ze,dt,Rt)}if(typeof dt.then=="function")return ps(nt,Ze,rv(dt),Rt);if(dt.$$typeof===p)return ps(nt,Ze,Ly(nt,dt),Rt);gy(nt,dt)}return typeof dt=="string"&&dt!==""||typeof dt=="number"||typeof dt=="bigint"?(dt=""+dt,Ze!==null&&Ze.tag===6?(S(nt,Ze.sibling),Rt=I(Ze,dt),Rt.return=nt,nt=Rt):(S(nt,Ze),Rt=hs(dt,nt.mode,Rt),Rt.return=nt,nt=Rt),ie(nt)):S(nt,Ze)}return function(nt,Ze,dt,Rt){try{iv=0;var si=ps(nt,Ze,dt,Rt);return Vh=null,si}catch(vi){if(vi===Fh)throw vi;var dr=Zn(29,vi,null,nt.mode);return dr.lanes=Rt,dr.return=nt,dr}finally{}}}var Mu=uE(!0),Eu=uE(!1),yf=fe(null),xf=fe(0);function Hh(f,m){f=Vu,be(xf,f),be(yf,m),Vu=f|m.baseLanes}function vy(){be(xf,Vu),be(yf,yf.current)}function sv(){Vu=xf.current,xe(yf),xe(xf)}var vo=fe(null),Tc=null;function Au(f){var m=f.alternate;be(ls,ls.current&1),be(vo,f),Tc===null&&(m===null||yf.current!==null||m.memoizedState!==null)&&(Tc=f)}function Qb(f){if(f.tag===22){if(be(ls,ls.current),be(vo,f),Tc===null){var m=f.alternate;m!==null&&m.memoizedState!==null&&(Tc=f)}}else Tu()}function Tu(){be(ls,ls.current),be(vo,vo.current)}function Cc(f){xe(vo),Tc===f&&(Tc=null),xe(ls)}var ls=fe(0);function Jp(f){for(var m=f;m!==null;){if(m.tag===13){var S=m.memoizedState;if(S!==null&&(S=S.dehydrated,S===null||S.data==="$?"||S.data==="$!"))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===f)break;for(;m.sibling===null;){if(m.return===null||m.return===f)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var lr=typeof AbortController<"u"?AbortController:function(){var f=[],m=this.signal={aborted:!1,addEventListener:function(S,A){f.push(A)}};this.abort=function(){m.aborted=!0,f.forEach(function(S){return S()})}},JP=t.unstable_scheduleCallback,Ho=t.unstable_NormalPriority,jn={$$typeof:p,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Zb(){return{controller:new lr,data:new Map,refCount:0}}function Gh(f){f.refCount--,f.refCount===0&&JP(Ho,function(){f.controller.abort()})}var Dc=null,jh=0,bf=0,Wh=null;function $P(f,m){if(Dc===null){var S=Dc=[];jh=0,bf=lR(),Wh={status:"pending",value:void 0,then:function(A){S.push(A)}}}return jh++,m.then(Kb,Kb),m}function Kb(){if(--jh===0&&Dc!==null){Wh!==null&&(Wh.status="fulfilled");var f=Dc;Dc=null,bf=0,Wh=null;for(var m=0;m<f.length;m++)(0,f[m])()}}function qh(f,m){var S=[],A={status:"pending",value:null,reason:null,then:function(I){S.push(I)}};return f.then(function(){A.status="fulfilled",A.value=m;for(var I=0;I<S.length;I++)(0,S[I])(m)},function(I){for(A.status="rejected",A.reason=I,I=0;I<S.length;I++)(0,S[I])(void 0)}),A}var yy=R.S;R.S=function(f,m){typeof m=="object"&&m!==null&&typeof m.then=="function"&&$P(f,m),yy!==null&&yy(f,m)};var Cu=fe(null);function av(){var f=Cu.current;return f!==null?f:qr.pooledCache}function $p(f,m){m===null?be(Cu,Cu.current):be(Cu,m.pool)}function Du(){var f=av();return f===null?null:{parent:jn._currentValue,pool:f}}var Pu=0,tr=null,kr=null,cs=null,Ii=!1,Xh=!1,Yh=!1,em=0,Qh=0,tm=null,eR=0;function Nn(){throw Error(r(321))}function _f(f,m){if(m===null)return!1;for(var S=0;S<m.length&&S<f.length;S++)if(!fo(f[S],m[S]))return!1;return!0}function Jb(f,m,S,A,I,B){return Pu=B,tr=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,R.H=f===null||f.memoizedState===null?Kh:Ou,Yh=!1,B=S(A,I),Yh=!1,Xh&&(B=dE(m,S,A,I)),hE(f),B}function hE(f){R.H=Rc;var m=kr!==null&&kr.next!==null;if(Pu=0,cs=kr=tr=null,Ii=!1,Qh=0,tm=null,m)throw Error(r(300));f===null||Ss||(f=f.dependencies,f!==null&&am(f)&&(Ss=!0))}function dE(f,m,S,A){tr=f;var I=0;do{if(Xh&&(tm=null),Qh=0,Xh=!1,25<=I)throw Error(r(301));if(I+=1,cs=kr=null,f.updateQueue!=null){var B=f.updateQueue;B.lastEffect=null,B.events=null,B.stores=null,B.memoCache!=null&&(B.memoCache.index=0)}R.H=Mf,B=m(S,A)}while(Xh);return B}function tR(){var f=R.H,m=f.useState()[0];return m=typeof m.then=="function"?lv(m):m,f=f.useState()[0],(kr!==null?kr.memoizedState:null)!==f&&(tr.flags|=1024),m}function $b(){var f=em!==0;return em=0,f}function ov(f,m,S){m.updateQueue=f.updateQueue,m.flags&=-2053,f.lanes&=~S}function xy(f){if(Ii){for(f=f.memoizedState;f!==null;){var m=f.queue;m!==null&&(m.pending=null),f=f.next}Ii=!1}Pu=0,cs=kr=tr=null,Xh=!1,Qh=em=0,tm=null}function Zs(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return cs===null?tr.memoizedState=cs=f:cs=cs.next=f,cs}function Wn(){if(kr===null){var f=tr.alternate;f=f!==null?f.memoizedState:null}else f=kr.next;var m=cs===null?tr.memoizedState:cs.next;if(m!==null)cs=m,kr=f;else{if(f===null)throw tr.alternate===null?Error(r(467)):Error(r(310));kr=f,f={memoizedState:kr.memoizedState,baseState:kr.baseState,baseQueue:kr.baseQueue,queue:kr.queue,next:null},cs===null?tr.memoizedState=cs=f:cs=cs.next=f}return cs}var by;by=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function lv(f){var m=Qh;return Qh+=1,tm===null&&(tm=[]),f=kh(tm,f,m),m=tr,(cs===null?m.memoizedState:cs.next)===null&&(m=m.alternate,R.H=m===null||m.memoizedState===null?Kh:Ou),f}function im(f){if(f!==null&&typeof f=="object"){if(typeof f.then=="function")return lv(f);if(f.$$typeof===p)return ma(f)}throw Error(r(438,String(f)))}function tc(f){var m=null,S=tr.updateQueue;if(S!==null&&(m=S.memoCache),m==null){var A=tr.alternate;A!==null&&(A=A.updateQueue,A!==null&&(A=A.memoCache,A!=null&&(m={data:A.data.map(function(I){return I.slice()}),index:0})))}if(m==null&&(m={data:[],index:0}),S===null&&(S=by(),tr.updateQueue=S),S.memoCache=m,S=m.data[m.index],S===void 0)for(S=m.data[m.index]=Array(f),A=0;A<f;A++)S[A]=E;return m.index++,S}function wn(f,m){return typeof m=="function"?m(f):m}function ic(f){var m=Wn();return yo(m,kr,f)}function yo(f,m,S){var A=f.queue;if(A===null)throw Error(r(311));A.lastRenderedReducer=S;var I=f.baseQueue,B=A.pending;if(B!==null){if(I!==null){var ie=I.next;I.next=B.next,B.next=ie}m.baseQueue=I=B,A.pending=null}if(B=f.baseState,I===null)f.memoizedState=B;else{m=I.next;var ve=ie=null,Le=null,Je=m,Et=!1;do{var Lt=Je.lane&-536870913;if(Lt!==Je.lane?(Ei&Lt)===Lt:(Pu&Lt)===Lt){var gt=Je.revertLane;if(gt===0)Le!==null&&(Le=Le.next={lane:0,revertLane:0,action:Je.action,hasEagerState:Je.hasEagerState,eagerState:Je.eagerState,next:null}),Lt===bf&&(Et=!0);else if((Pu&gt)===gt){Je=Je.next,gt===bf&&(Et=!0);continue}else Lt={lane:0,revertLane:Je.revertLane,action:Je.action,hasEagerState:Je.hasEagerState,eagerState:Je.eagerState,next:null},Le===null?(ve=Le=Lt,ie=B):Le=Le.next=Lt,tr.lanes|=gt,cc|=gt;Lt=Je.action,Yh&&S(B,Lt),B=Je.hasEagerState?Je.eagerState:S(B,Lt)}else gt={lane:Lt,revertLane:Je.revertLane,action:Je.action,hasEagerState:Je.hasEagerState,eagerState:Je.eagerState,next:null},Le===null?(ve=Le=gt,ie=B):Le=Le.next=gt,tr.lanes|=Lt,cc|=Lt;Je=Je.next}while(Je!==null&&Je!==m);if(Le===null?ie=B:Le.next=ve,!fo(B,f.memoizedState)&&(Ss=!0,Et&&(S=Wh,S!==null)))throw S;f.memoizedState=B,f.baseState=ie,f.baseQueue=Le,A.lastRenderedState=B}return I===null&&(A.lanes=0),[f.memoizedState,A.dispatch]}function _y(f){var m=Wn(),S=m.queue;if(S===null)throw Error(r(311));S.lastRenderedReducer=f;var A=S.dispatch,I=S.pending,B=m.memoizedState;if(I!==null){S.pending=null;var ie=I=I.next;do B=f(B,ie.action),ie=ie.next;while(ie!==I);fo(B,m.memoizedState)||(Ss=!0),m.memoizedState=B,m.baseQueue===null&&(m.baseState=B),S.lastRenderedState=B}return[B,A]}function fE(f,m,S){var A=tr,I=Wn(),B=br;if(B){if(S===void 0)throw Error(r(407));S=S()}else S=m();var ie=!fo((kr||I).memoizedState,S);if(ie&&(I.memoizedState=S,Ss=!0),I=I.queue,r_(pE.bind(null,A,I,f),[f]),I.getSnapshot!==m||ie||cs!==null&&cs.memoizedState.tag&1){if(A.flags|=2048,Pc(9,Zh.bind(null,A,I,S,m),{destroy:void 0},null),qr===null)throw Error(r(349));B||(Pu&60)!==0||Fa(A,m,S)}return S}function Fa(f,m,S){f.flags|=16384,f={getSnapshot:m,value:S},m=tr.updateQueue,m===null?(m=by(),tr.updateQueue=m,m.stores=[f]):(S=m.stores,S===null?m.stores=[f]:S.push(f))}function Zh(f,m,S,A){m.value=S,m.getSnapshot=A,mE(m)&&gE(f)}function pE(f,m,S){return S(function(){mE(m)&&gE(f)})}function mE(f){var m=f.getSnapshot;f=f.value;try{var S=m();return!fo(f,S)}catch{return!0}}function gE(f){var m=_u(f,2);m!==null&&fs(m,f,2)}function e_(f){var m=Zs();if(typeof f=="function"){var S=f;if(f=S(),Yh){St(!0);try{S()}finally{St(!1)}}}return m.memoizedState=m.baseState=f,m.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:wn,lastRenderedState:f},m}function t_(f,m,S,A){return f.baseState=S,yo(f,kr,typeof A=="function"?A:wn)}function iR(f,m,S,A,I){if(Ay(f))throw Error(r(485));if(f=m.action,f!==null){var B={payload:I,action:f,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ie){B.listeners.push(ie)}};R.T!==null?S(!0):B.isTransition=!1,A(B),S=m.pending,S===null?(B.next=m.pending=B,i_(m,B)):(B.next=S.next,m.pending=S.next=B)}}function i_(f,m){var S=m.action,A=m.payload,I=f.state;if(m.isTransition){var B=R.T,ie={};R.T=ie;try{var ve=S(I,A),Le=R.S;Le!==null&&Le(ie,ve),vE(f,m,ve)}catch(Je){Ru(f,m,Je)}finally{R.T=B}}else try{B=S(I,A),vE(f,m,B)}catch(Je){Ru(f,m,Je)}}function vE(f,m,S){S!==null&&typeof S=="object"&&typeof S.then=="function"?S.then(function(A){Sf(f,m,A)},function(A){return Ru(f,m,A)}):Sf(f,m,S)}function Sf(f,m,S){m.status="fulfilled",m.value=S,yE(m),f.state=S,m=f.pending,m!==null&&(S=m.next,S===m?f.pending=null:(S=S.next,m.next=S,i_(f,S)))}function Ru(f,m,S){var A=f.pending;if(f.pending=null,A!==null){A=A.next;do m.status="rejected",m.reason=S,yE(m),m=m.next;while(m!==A)}f.action=null}function yE(f){f=f.listeners;for(var m=0;m<f.length;m++)(0,f[m])()}function xE(f,m){return m}function bE(f,m){if(br){var S=qr.formState;if(S!==null){e:{var A=tr;if(br){if(Is){t:{for(var I=Is,B=_l;I.nodeType!==8;){if(!B){I=null;break t}if(I=ju(I.nextSibling),I===null){I=null;break t}}B=I.data,I=B==="F!"||B==="F"?I:null}if(I){Is=ju(I.nextSibling),A=I.data==="F!";break e}}vf(A)}A=!1}A&&(m=S[0])}}return S=Zs(),S.memoizedState=S.baseState=m,A={pending:null,lanes:0,dispatch:null,lastRenderedReducer:xE,lastRenderedState:m},S.queue=A,S=o_.bind(null,tr,A),A.dispatch=S,A=e_(!1),B=cv.bind(null,tr,!1,A.queue),A=Zs(),I={state:m,dispatch:null,action:f,pending:null},A.queue=I,S=iR.bind(null,tr,I,B,S),I.dispatch=S,A.memoizedState=f,[m,S,!1]}function rm(f){var m=Wn();return _E(m,kr,f)}function _E(f,m,S){m=yo(f,m,xE)[0],f=ic(wn)[0],m=typeof m=="object"&&m!==null&&typeof m.then=="function"?lv(m):m;var A=Wn(),I=A.queue,B=I.dispatch;return S!==A.memoizedState&&(tr.flags|=2048,Pc(9,rR.bind(null,I,S),{destroy:void 0},null)),[m,B,f]}function rR(f,m){f.action=m}function SE(f){var m=Wn(),S=kr;if(S!==null)return _E(m,S,f);Wn(),m=m.memoizedState,S=Wn();var A=S.queue.dispatch;return S.memoizedState=f,[m,A,!1]}function Pc(f,m,S,A){return f={tag:f,create:m,inst:S,deps:A,next:null},m=tr.updateQueue,m===null&&(m=by(),tr.updateQueue=m),S=m.lastEffect,S===null?m.lastEffect=f.next=f:(A=S.next,S.next=f,f.next=A,m.lastEffect=f),f}function wE(){return Wn().memoizedState}function Sy(f,m,S,A){var I=Zs();tr.flags|=f,I.memoizedState=Pc(1|m,S,{destroy:void 0},A===void 0?null:A)}function wy(f,m,S,A){var I=Wn();A=A===void 0?null:A;var B=I.memoizedState.inst;kr!==null&&A!==null&&_f(A,kr.memoizedState.deps)?I.memoizedState=Pc(m,S,B,A):(tr.flags|=f,I.memoizedState=Pc(1|m,S,B,A))}function ME(f,m){Sy(8390656,8,f,m)}function r_(f,m){wy(2048,8,f,m)}function EE(f,m){return wy(4,2,f,m)}function AE(f,m){return wy(4,4,f,m)}function TE(f,m){if(typeof m=="function"){f=f();var S=m(f);return function(){typeof S=="function"?S():m(null)}}if(m!=null)return f=f(),m.current=f,function(){m.current=null}}function CE(f,m,S){S=S!=null?S.concat([f]):null,wy(4,4,TE.bind(null,m,f),S)}function n_(){}function DE(f,m){var S=Wn();m=m===void 0?null:m;var A=S.memoizedState;return m!==null&&_f(m,A[1])?A[0]:(S.memoizedState=[f,m],f)}function PE(f,m){var S=Wn();m=m===void 0?null:m;var A=S.memoizedState;if(m!==null&&_f(m,A[1]))return A[0];if(A=f(),Yh){St(!0);try{f()}finally{St(!1)}}return S.memoizedState=[A,m],A}function My(f,m,S){return S===void 0||(Pu&1073741824)!==0?f.memoizedState=m:(f.memoizedState=S,f=Xo(),tr.lanes|=f,cc|=f,S)}function RE(f,m,S,A){return fo(S,m)?S:yf.current!==null?(f=My(f,S,A),fo(f,m)||(Ss=!0),f):(Pu&42)===0?(Ss=!0,f.memoizedState=S):(f=Xo(),tr.lanes|=f,cc|=f,m)}function OE(f,m,S,A,I){var B=Q.p;Q.p=B!==0&&8>B?B:8;var ie=R.T,ve={};R.T=ve,cv(f,!1,m,S);try{var Le=I(),Je=R.S;if(Je!==null&&Je(ve,Le),Le!==null&&typeof Le=="object"&&typeof Le.then=="function"){var Et=qh(Le,A);wf(f,m,Et,ja(f))}else wf(f,m,A,ja(f))}catch(Lt){wf(f,m,{then:function(){},status:"rejected",reason:Lt},ja())}finally{Q.p=B,R.T=ie}}function nR(){}function s_(f,m,S,A){if(f.tag!==5)throw Error(r(476));var I=LE(f).queue;OE(f,I,m,ae,S===null?nR:function(){return IE(f),S(A)})}function LE(f){var m=f.memoizedState;if(m!==null)return m;m={memoizedState:ae,baseState:ae,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:wn,lastRenderedState:ae},next:null};var S={};return m.next={memoizedState:S,baseState:S,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:wn,lastRenderedState:S},next:null},f.memoizedState=m,f=f.alternate,f!==null&&(f.memoizedState=m),m}function IE(f){var m=LE(f).next.queue;wf(f,m,{},ja())}function Ey(){return ma(O_)}function a_(){return Wn().memoizedState}function zE(){return Wn().memoizedState}function UE(f){for(var m=f.return;m!==null;){switch(m.tag){case 24:case 3:var S=ja();f=Wo(S);var A=qo(m,f,S);A!==null&&(fs(A,m,S),ed(A,m,S)),m={cache:Zb()},f.payload=m;return}m=m.return}}function BE(f,m,S){var A=ja();S={lane:A,revertLane:0,action:S,hasEagerState:!1,eagerState:null,next:null},Ay(f)?NE(m,S):(S=mf(f,m,S,A),S!==null&&(fs(S,f,A),FE(S,m,A)))}function o_(f,m,S){var A=ja();wf(f,m,S,A)}function wf(f,m,S,A){var I={lane:A,revertLane:0,action:S,hasEagerState:!1,eagerState:null,next:null};if(Ay(f))NE(m,I);else{var B=f.alternate;if(f.lanes===0&&(B===null||B.lanes===0)&&(B=m.lastRenderedReducer,B!==null))try{var ie=m.lastRenderedState,ve=B(ie,S);if(I.hasEagerState=!0,I.eagerState=ve,fo(ve,ie))return Qg(f,m,I,0),qr===null&&Yg(),!1}catch{}finally{}if(S=mf(f,m,I,A),S!==null)return fs(S,f,A),FE(S,m,A),!0}return!1}function cv(f,m,S,A){if(A={lane:2,revertLane:lR(),action:A,hasEagerState:!1,eagerState:null,next:null},Ay(f)){if(m)throw Error(r(479))}else m=mf(f,S,A,2),m!==null&&fs(m,f,2)}function Ay(f){var m=f.alternate;return f===tr||m!==null&&m===tr}function NE(f,m){Xh=Ii=!0;var S=f.pending;S===null?m.next=m:(m.next=S.next,S.next=m),f.pending=m}function FE(f,m,S){if((S&4194176)!==0){var A=m.lanes;A&=f.pendingLanes,S|=A,m.lanes=S,pn(f,S)}}var Rc={readContext:ma,use:im,useCallback:Nn,useContext:Nn,useEffect:Nn,useImperativeHandle:Nn,useLayoutEffect:Nn,useInsertionEffect:Nn,useMemo:Nn,useReducer:Nn,useRef:Nn,useState:Nn,useDebugValue:Nn,useDeferredValue:Nn,useTransition:Nn,useSyncExternalStore:Nn,useId:Nn};Rc.useCacheRefresh=Nn,Rc.useMemoCache=Nn,Rc.useHostTransitionStatus=Nn,Rc.useFormState=Nn,Rc.useActionState=Nn,Rc.useOptimistic=Nn;var Kh={readContext:ma,use:im,useCallback:function(f,m){return Zs().memoizedState=[f,m===void 0?null:m],f},useContext:ma,useEffect:ME,useImperativeHandle:function(f,m,S){S=S!=null?S.concat([f]):null,Sy(4194308,4,TE.bind(null,m,f),S)},useLayoutEffect:function(f,m){return Sy(4194308,4,f,m)},useInsertionEffect:function(f,m){Sy(4,2,f,m)},useMemo:function(f,m){var S=Zs();m=m===void 0?null:m;var A=f();if(Yh){St(!0);try{f()}finally{St(!1)}}return S.memoizedState=[A,m],A},useReducer:function(f,m,S){var A=Zs();if(S!==void 0){var I=S(m);if(Yh){St(!0);try{S(m)}finally{St(!1)}}}else I=m;return A.memoizedState=A.baseState=I,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:I},A.queue=f,f=f.dispatch=BE.bind(null,tr,f),[A.memoizedState,f]},useRef:function(f){var m=Zs();return f={current:f},m.memoizedState=f},useState:function(f){f=e_(f);var m=f.queue,S=o_.bind(null,tr,m);return m.dispatch=S,[f.memoizedState,S]},useDebugValue:n_,useDeferredValue:function(f,m){var S=Zs();return My(S,f,m)},useTransition:function(){var f=e_(!1);return f=OE.bind(null,tr,f.queue,!0,!1),Zs().memoizedState=f,[!1,f]},useSyncExternalStore:function(f,m,S){var A=tr,I=Zs();if(br){if(S===void 0)throw Error(r(407));S=S()}else{if(S=m(),qr===null)throw Error(r(349));(Ei&60)!==0||Fa(A,m,S)}I.memoizedState=S;var B={value:S,getSnapshot:m};return I.queue=B,ME(pE.bind(null,A,B,f),[f]),A.flags|=2048,Pc(9,Zh.bind(null,A,B,S,m),{destroy:void 0},null),S},useId:function(){var f=Zs(),m=qr.identifierPrefix;if(br){var S=wu,A=Ec;S=(A&~(1<<32-Pt(A)-1)).toString(32)+S,m=":"+m+"R"+S,S=em++,0<S&&(m+="H"+S.toString(32)),m+=":"}else S=eR++,m=":"+m+"r"+S.toString(32)+":";return f.memoizedState=m},useCacheRefresh:function(){return Zs().memoizedState=UE.bind(null,tr)}};Kh.useMemoCache=tc,Kh.useHostTransitionStatus=Ey,Kh.useFormState=bE,Kh.useActionState=bE,Kh.useOptimistic=function(f){var m=Zs();m.memoizedState=m.baseState=f;var S={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return m.queue=S,m=cv.bind(null,tr,!0,S),S.dispatch=m,[f,m]};var Ou={readContext:ma,use:im,useCallback:DE,useContext:ma,useEffect:r_,useImperativeHandle:CE,useInsertionEffect:EE,useLayoutEffect:AE,useMemo:PE,useReducer:ic,useRef:wE,useState:function(){return ic(wn)},useDebugValue:n_,useDeferredValue:function(f,m){var S=Wn();return RE(S,kr.memoizedState,f,m)},useTransition:function(){var f=ic(wn)[0],m=Wn().memoizedState;return[typeof f=="boolean"?f:lv(f),m]},useSyncExternalStore:fE,useId:a_};Ou.useCacheRefresh=zE,Ou.useMemoCache=tc,Ou.useHostTransitionStatus=Ey,Ou.useFormState=rm,Ou.useActionState=rm,Ou.useOptimistic=function(f,m){var S=Wn();return t_(S,kr,f,m)};var Mf={readContext:ma,use:im,useCallback:DE,useContext:ma,useEffect:r_,useImperativeHandle:CE,useInsertionEffect:EE,useLayoutEffect:AE,useMemo:PE,useReducer:_y,useRef:wE,useState:function(){return _y(wn)},useDebugValue:n_,useDeferredValue:function(f,m){var S=Wn();return kr===null?My(S,f,m):RE(S,kr.memoizedState,f,m)},useTransition:function(){var f=_y(wn)[0],m=Wn().memoizedState;return[typeof f=="boolean"?f:lv(f),m]},useSyncExternalStore:fE,useId:a_};Mf.useCacheRefresh=zE,Mf.useMemoCache=tc,Mf.useHostTransitionStatus=Ey,Mf.useFormState=SE,Mf.useActionState=SE,Mf.useOptimistic=function(f,m){var S=Wn();return kr!==null?t_(S,kr,f,m):(S.baseState=f,[f,S.queue.dispatch])};function l_(f,m,S,A){m=f.memoizedState,S=S(A,m),S=S==null?m:O({},m,S),f.memoizedState=S,f.lanes===0&&(f.updateQueue.baseState=S)}var c_={isMounted:function(f){return(f=f._reactInternals)?Y(f)===f:!1},enqueueSetState:function(f,m,S){f=f._reactInternals;var A=ja(),I=Wo(A);I.payload=m,S!=null&&(I.callback=S),m=qo(f,I,A),m!==null&&(fs(m,f,A),ed(m,f,A))},enqueueReplaceState:function(f,m,S){f=f._reactInternals;var A=ja(),I=Wo(A);I.tag=1,I.payload=m,S!=null&&(I.callback=S),m=qo(f,I,A),m!==null&&(fs(m,f,A),ed(m,f,A))},enqueueForceUpdate:function(f,m){f=f._reactInternals;var S=ja(),A=Wo(S);A.tag=2,m!=null&&(A.callback=m),m=qo(f,A,S),m!==null&&(fs(m,f,S),ed(m,f,S))}};function kE(f,m,S,A,I,B,ie){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(A,B,ie):m.prototype&&m.prototype.isPureReactComponent?!ec(S,A)||!ec(I,B):!0}function VE(f,m,S,A){f=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(S,A),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(S,A),m.state!==f&&c_.enqueueReplaceState(m,m.state,null)}function Ef(f,m){var S=m;if("ref"in m){S={};for(var A in m)A!=="ref"&&(S[A]=m[A])}if(f=f.defaultProps){S===m&&(S=O({},S));for(var I in f)S[I]===void 0&&(S[I]=f[I])}return S}var Ty=typeof reportError=="function"?reportError:function(f){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var m=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof f=="object"&&f!==null&&typeof f.message=="string"?String(f.message):String(f),error:f});if(!window.dispatchEvent(m))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",f);return}console.error(f)};function HE(f){Ty(f)}function GE(f){console.error(f)}function jE(f){Ty(f)}function Cy(f,m){try{var S=f.onUncaughtError;S(m.value,{componentStack:m.stack})}catch(A){setTimeout(function(){throw A})}}function WE(f,m,S){try{var A=f.onCaughtError;A(S.value,{componentStack:S.stack,errorBoundary:m.tag===1?m.stateNode:null})}catch(I){setTimeout(function(){throw I})}}function u_(f,m,S){return S=Wo(S),S.tag=3,S.payload={element:null},S.callback=function(){Cy(f,m)},S}function h_(f){return f=Wo(f),f.tag=3,f}function qE(f,m,S,A){var I=S.type.getDerivedStateFromError;if(typeof I=="function"){var B=A.value;f.payload=function(){return I(B)},f.callback=function(){WE(m,S,A)}}var ie=S.stateNode;ie!==null&&typeof ie.componentDidCatch=="function"&&(f.callback=function(){WE(m,S,A),typeof I!="function"&&(ds===null?ds=new Set([this]):ds.add(this));var ve=A.stack;this.componentDidCatch(A.value,{componentStack:ve!==null?ve:""})})}function sR(f,m,S,A,I){if(S.flags|=32768,A!==null&&typeof A=="object"&&typeof A.then=="function"){if(m=S.alternate,m!==null&&hv(m,S,I,!0),S=vo.current,S!==null){switch(S.tag){case 13:return Tc===null?xv():S.alternate===null&&yn===0&&(yn=3),S.flags&=-257,S.flags|=65536,S.lanes=I,A===my?S.flags|=16384:(m=S.updateQueue,m===null?S.updateQueue=new Set([A]):m.add(A),Vi(f,A,I)),!1;case 22:return S.flags|=65536,A===my?S.flags|=16384:(m=S.updateQueue,m===null?(m={transitions:null,markerInstances:null,retryQueue:new Set([A])},S.updateQueue=m):(S=m.retryQueue,S===null?m.retryQueue=new Set([A]):S.add(A)),Vi(f,A,I)),!1}throw Error(r(435,S.tag))}return Vi(f,A,I),xv(),!1}if(br)return m=vo.current,m!==null?((m.flags&65536)===0&&(m.flags|=256),m.flags|=65536,m.lanes=I,A!==ev&&(f=Error(r(422),{cause:A}),Ac(go(f,S)))):(A!==ev&&(m=Error(r(423),{cause:A}),Ac(go(m,S))),f=f.current.alternate,f.flags|=65536,I&=-I,f.lanes|=I,A=go(A,S),I=u_(f.stateNode,A,I),lm(f,I),yn!==4&&(yn=2)),!1;var B=Error(r(520),{cause:A});if(B=go(B,S),yv===null?yv=[B]:yv.push(B),yn!==4&&(yn=2),m===null)return!0;A=go(A,S),S=m;do{switch(S.tag){case 3:return S.flags|=65536,f=I&-I,S.lanes|=f,f=u_(S.stateNode,A,f),lm(S,f),!1;case 1:if(m=S.type,B=S.stateNode,(S.flags&128)===0&&(typeof m.getDerivedStateFromError=="function"||B!==null&&typeof B.componentDidCatch=="function"&&(ds===null||!ds.has(B))))return S.flags|=65536,I&=-I,S.lanes|=I,I=h_(I),qE(I,f,S,A),lm(S,I),!1}S=S.return}while(S!==null);return!1}var Go=Error(r(461)),Ss=!1;function ws(f,m,S,A){m.child=f===null?Eu(m,null,S,A):Mu(m,f.child,S,A)}function d_(f,m,S,A,I){S=S.render;var B=m.ref;if("ref"in A){var ie={};for(var ve in A)ve!=="ref"&&(ie[ve]=A[ve])}else ie=A;return Tf(m),A=Jb(f,m,S,ie,B,I),ve=$b(),f!==null&&!Ss?(ov(f,m,I),qn(f,m,I)):(br&&ve&&$g(m),m.flags|=1,ws(f,m,A,I),m.child)}function f_(f,m,S,A,I){if(f===null){var B=S.type;return typeof B=="function"&&!Fu(B)&&B.defaultProps===void 0&&S.compare===null?(m.tag=15,m.type=B,p_(f,m,B,A,I)):(f=dm(S.type,null,A,m,m.mode,I),f.ref=m.ref,f.return=m,m.child=f)}if(B=f.child,!__(f,I)){var ie=B.memoizedProps;if(S=S.compare,S=S!==null?S:ec,S(ie,A)&&f.ref===m.ref)return qn(f,m,I)}return m.flags|=1,f=Ha(B,A),f.ref=m.ref,f.return=m,m.child=f}function p_(f,m,S,A,I){if(f!==null){var B=f.memoizedProps;if(ec(B,A)&&f.ref===m.ref)if(Ss=!1,m.pendingProps=A=B,__(f,I))(f.flags&131072)!==0&&(Ss=!0);else return m.lanes=f.lanes,qn(f,m,I)}return g_(f,m,S,A,I)}function XE(f,m,S){var A=m.pendingProps,I=A.children,B=(m.stateNode._pendingVisibility&2)!==0,ie=f!==null?f.memoizedState:null;if(nm(f,m),A.mode==="hidden"||B){if((m.flags&128)!==0){if(A=ie!==null?ie.baseLanes|S:S,f!==null){for(I=m.child=f.child,B=0;I!==null;)B=B|I.lanes|I.childLanes,I=I.sibling;m.childLanes=B&~A}else m.childLanes=0,m.child=null;return m_(f,m,A,S)}if((S&536870912)!==0)m.memoizedState={baseLanes:0,cachePool:null},f!==null&&$p(m,ie!==null?ie.cachePool:null),ie!==null?Hh(m,ie):vy(),Qb(m);else return m.lanes=m.childLanes=536870912,m_(f,m,ie!==null?ie.baseLanes|S:S,S)}else ie!==null?($p(m,ie.cachePool),Hh(m,ie),Tu(),m.memoizedState=null):(f!==null&&$p(m,null),vy(),Tu());return ws(f,m,I,S),m.child}function m_(f,m,S,A){var I=av();return I=I===null?null:{parent:jn._currentValue,pool:I},m.memoizedState={baseLanes:S,cachePool:I},f!==null&&$p(m,null),vy(),Qb(m),f!==null&&hv(f,m,A,!0),null}function nm(f,m){var S=m.ref;if(S===null)f!==null&&f.ref!==null&&(m.flags|=2097664);else{if(typeof S!="function"&&typeof S!="object")throw Error(r(284));(f===null||f.ref!==S)&&(m.flags|=2097664)}}function g_(f,m,S,A,I){return Tf(m),S=Jb(f,m,S,A,void 0,I),A=$b(),f!==null&&!Ss?(ov(f,m,I),qn(f,m,I)):(br&&A&&$g(m),m.flags|=1,ws(f,m,S,I),m.child)}function YE(f,m,S,A,I,B){return Tf(m),m.updateQueue=null,S=dE(m,A,S,I),hE(f),A=$b(),f!==null&&!Ss?(ov(f,m,B),qn(f,m,B)):(br&&A&&$g(m),m.flags|=1,ws(f,m,S,B),m.child)}function QE(f,m,S,A,I){if(Tf(m),m.stateNode===null){var B=Uh,ie=S.contextType;typeof ie=="object"&&ie!==null&&(B=ma(ie)),B=new S(A,B),m.memoizedState=B.state!==null&&B.state!==void 0?B.state:null,B.updater=c_,m.stateNode=B,B._reactInternals=m,B=m.stateNode,B.props=A,B.state=m.memoizedState,B.refs={},ka(m),ie=S.contextType,B.context=typeof ie=="object"&&ie!==null?ma(ie):Uh,B.state=m.memoizedState,ie=S.getDerivedStateFromProps,typeof ie=="function"&&(l_(m,S,ie,A),B.state=m.memoizedState),typeof S.getDerivedStateFromProps=="function"||typeof B.getSnapshotBeforeUpdate=="function"||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(ie=B.state,typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount(),ie!==B.state&&c_.enqueueReplaceState(B,B.state,null),nc(m,A,B,I),ga(),B.state=m.memoizedState),typeof B.componentDidMount=="function"&&(m.flags|=4194308),A=!0}else if(f===null){B=m.stateNode;var ve=m.memoizedProps,Le=Ef(S,ve);B.props=Le;var Je=B.context,Et=S.contextType;ie=Uh,typeof Et=="object"&&Et!==null&&(ie=ma(Et));var Lt=S.getDerivedStateFromProps;Et=typeof Lt=="function"||typeof B.getSnapshotBeforeUpdate=="function",ve=m.pendingProps!==ve,Et||typeof B.UNSAFE_componentWillReceiveProps!="function"&&typeof B.componentWillReceiveProps!="function"||(ve||Je!==ie)&&VE(m,B,A,ie),us=!1;var gt=m.memoizedState;B.state=gt,nc(m,A,B,I),ga(),Je=m.memoizedState,ve||gt!==Je||us?(typeof Lt=="function"&&(l_(m,S,Lt,A),Je=m.memoizedState),(Le=us||kE(m,S,Le,A,gt,Je,ie))?(Et||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount()),typeof B.componentDidMount=="function"&&(m.flags|=4194308)):(typeof B.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=A,m.memoizedState=Je),B.props=A,B.state=Je,B.context=ie,A=Le):(typeof B.componentDidMount=="function"&&(m.flags|=4194308),A=!1)}else{B=m.stateNode,Iy(f,m),ie=m.memoizedProps,Et=Ef(S,ie),B.props=Et,Lt=m.pendingProps,gt=B.context,Je=S.contextType,Le=Uh,typeof Je=="object"&&Je!==null&&(Le=ma(Je)),ve=S.getDerivedStateFromProps,(Je=typeof ve=="function"||typeof B.getSnapshotBeforeUpdate=="function")||typeof B.UNSAFE_componentWillReceiveProps!="function"&&typeof B.componentWillReceiveProps!="function"||(ie!==Lt||gt!==Le)&&VE(m,B,A,Le),us=!1,gt=m.memoizedState,B.state=gt,nc(m,A,B,I),ga();var wt=m.memoizedState;ie!==Lt||gt!==wt||us||f!==null&&f.dependencies!==null&&am(f.dependencies)?(typeof ve=="function"&&(l_(m,S,ve,A),wt=m.memoizedState),(Et=us||kE(m,S,Et,A,gt,wt,Le)||f!==null&&f.dependencies!==null&&am(f.dependencies))?(Je||typeof B.UNSAFE_componentWillUpdate!="function"&&typeof B.componentWillUpdate!="function"||(typeof B.componentWillUpdate=="function"&&B.componentWillUpdate(A,wt,Le),typeof B.UNSAFE_componentWillUpdate=="function"&&B.UNSAFE_componentWillUpdate(A,wt,Le)),typeof B.componentDidUpdate=="function"&&(m.flags|=4),typeof B.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof B.componentDidUpdate!="function"||ie===f.memoizedProps&&gt===f.memoizedState||(m.flags|=4),typeof B.getSnapshotBeforeUpdate!="function"||ie===f.memoizedProps&&gt===f.memoizedState||(m.flags|=1024),m.memoizedProps=A,m.memoizedState=wt),B.props=A,B.state=wt,B.context=Le,A=Et):(typeof B.componentDidUpdate!="function"||ie===f.memoizedProps&&gt===f.memoizedState||(m.flags|=4),typeof B.getSnapshotBeforeUpdate!="function"||ie===f.memoizedProps&&gt===f.memoizedState||(m.flags|=1024),A=!1)}return B=A,nm(f,m),A=(m.flags&128)!==0,B||A?(B=m.stateNode,S=A&&typeof S.getDerivedStateFromError!="function"?null:B.render(),m.flags|=1,f!==null&&A?(m.child=Mu(m,f.child,null,I),m.child=Mu(m,null,S,I)):ws(f,m,S,I),m.memoizedState=B.state,f=m.child):f=qn(f,m,I),f}function v_(f,m,S,A){return Zp(),m.flags|=256,ws(f,m,S,A),m.child}var y_={dehydrated:null,treeContext:null,retryLane:0};function zs(f){return{baseLanes:f,cachePool:Du()}}function Dy(f,m,S){return f=f!==null?f.childLanes&~S:0,m&&(f|=Ga),f}function ZE(f,m,S){var A=m.pendingProps,I=!1,B=(m.flags&128)!==0,ie;if((ie=B)||(ie=f!==null&&f.memoizedState===null?!1:(ls.current&2)!==0),ie&&(I=!0,m.flags&=-129),ie=(m.flags&32)!==0,m.flags&=-33,f===null){if(br){if(I?Au(m):Tu(),br){var ve=Is,Le;if(Le=ve){e:{for(Le=ve,ve=_l;Le.nodeType!==8;){if(!ve){ve=null;break e}if(Le=ju(Le.nextSibling),Le===null){ve=null;break e}}ve=Le}ve!==null?(m.memoizedState={dehydrated:ve,treeContext:Su!==null?{id:Ec,overflow:wu}:null,retryLane:536870912},Le=Zn(18,null,null,0),Le.stateNode=ve,Le.return=m,m.child=Le,pa=m,Is=null,Le=!0):Le=!1}Le||vf(m)}if(ve=m.memoizedState,ve!==null&&(ve=ve.dehydrated,ve!==null))return ve.data==="$!"?m.lanes=16:m.lanes=536870912,null;Cc(m)}return ve=A.children,A=A.fallback,I?(Tu(),I=m.mode,ve=b_({mode:"hidden",children:ve},I),A=ad(A,I,S,null),ve.return=m,A.return=m,ve.sibling=A,m.child=ve,I=m.child,I.memoizedState=zs(S),I.childLanes=Dy(f,ie,S),m.memoizedState=y_,A):(Au(m),x_(m,ve))}if(Le=f.memoizedState,Le!==null&&(ve=Le.dehydrated,ve!==null)){if(B)m.flags&256?(Au(m),m.flags&=-257,m=Py(f,m,S)):m.memoizedState!==null?(Tu(),m.child=f.child,m.flags|=128,m=null):(Tu(),I=A.fallback,ve=m.mode,A=b_({mode:"visible",children:A.children},ve),I=ad(I,ve,S,null),I.flags|=2,A.return=m,I.return=m,A.sibling=I,m.child=A,Mu(m,f.child,null,S),A=m.child,A.memoizedState=zs(S),A.childLanes=Dy(f,ie,S),m.memoizedState=y_,m=I);else if(Au(m),ve.data==="$!"){if(ie=ve.nextSibling&&ve.nextSibling.dataset,ie)var Je=ie.dgst;ie=Je,A=Error(r(419)),A.stack="",A.digest=ie,Ac({value:A,source:null,stack:null}),m=Py(f,m,S)}else if(Ss||hv(f,m,S,!1),ie=(S&f.childLanes)!==0,Ss||ie){if(ie=qr,ie!==null){if(A=S&-S,(A&42)!==0)A=1;else switch(A){case 2:A=1;break;case 8:A=4;break;case 32:A=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:A=64;break;case 268435456:A=134217728;break;default:A=0}if(A=(A&(ie.suspendedLanes|S))!==0?0:A,A!==0&&A!==Le.retryLane)throw Le.retryLane=A,_u(f,A),fs(ie,f,A),Go}ve.data==="$?"||xv(),m=Py(f,m,S)}else ve.data==="$?"?(m.flags|=128,m.child=f.child,m=If.bind(null,f),ve._reactRetry=m,m=null):(f=Le.treeContext,Is=ju(ve.nextSibling),pa=m,br=!0,bl=null,_l=!1,f!==null&&(on[Vo++]=Ec,on[Vo++]=wu,on[Vo++]=Su,Ec=f.id,wu=f.overflow,Su=m),m=x_(m,A.children),m.flags|=4096);return m}return I?(Tu(),I=A.fallback,ve=m.mode,Le=f.child,Je=Le.sibling,A=Ha(Le,{mode:"hidden",children:A.children}),A.subtreeFlags=Le.subtreeFlags&31457280,Je!==null?I=Ha(Je,I):(I=ad(I,ve,S,null),I.flags|=2),I.return=m,A.return=m,A.sibling=I,m.child=A,A=I,I=m.child,ve=f.child.memoizedState,ve===null?ve=zs(S):(Le=ve.cachePool,Le!==null?(Je=jn._currentValue,Le=Le.parent!==Je?{parent:Je,pool:Je}:Le):Le=Du(),ve={baseLanes:ve.baseLanes|S,cachePool:Le}),I.memoizedState=ve,I.childLanes=Dy(f,ie,S),m.memoizedState=y_,A):(Au(m),S=f.child,f=S.sibling,S=Ha(S,{mode:"visible",children:A.children}),S.return=m,S.sibling=null,f!==null&&(ie=m.deletions,ie===null?(m.deletions=[f],m.flags|=16):ie.push(f)),m.child=S,m.memoizedState=null,S)}function x_(f,m){return m=b_({mode:"visible",children:m},f.mode),m.return=f,f.child=m}function b_(f,m){return w_(f,m,0,null)}function Py(f,m,S){return Mu(m,f.child,null,S),f=x_(m,m.pendingProps.children),f.flags|=2,m.memoizedState=null,f}function Ry(f,m,S){f.lanes|=m;var A=f.alternate;A!==null&&(A.lanes|=m),jo(f.return,m,S)}function Jh(f,m,S,A,I){var B=f.memoizedState;B===null?f.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:A,tail:S,tailMode:I}:(B.isBackwards=m,B.rendering=null,B.renderingStartTime=0,B.last=A,B.tail=S,B.tailMode=I)}function Af(f,m,S){var A=m.pendingProps,I=A.revealOrder,B=A.tail;if(ws(f,m,A.children,S),A=ls.current,(A&2)!==0)A=A&1|2,m.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=m.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&Ry(f,S,m);else if(f.tag===19)Ry(f,S,m);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===m)break e;for(;f.sibling===null;){if(f.return===null||f.return===m)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}A&=1}switch(be(ls,A),I){case"forwards":for(S=m.child,I=null;S!==null;)f=S.alternate,f!==null&&Jp(f)===null&&(I=S),S=S.sibling;S=I,S===null?(I=m.child,m.child=null):(I=S.sibling,S.sibling=null),Jh(m,!1,I,S,B);break;case"backwards":for(S=null,I=m.child,m.child=null;I!==null;){if(f=I.alternate,f!==null&&Jp(f)===null){m.child=I;break}f=I.sibling,I.sibling=S,S=I,I=f}Jh(m,!0,S,null,B);break;case"together":Jh(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function qn(f,m,S){if(f!==null&&(m.dependencies=f.dependencies),cc|=m.lanes,(S&m.childLanes)===0)if(f!==null){if(hv(f,m,S,!1),(S&m.childLanes)===0)return null}else return null;if(f!==null&&m.child!==f.child)throw Error(r(153));if(m.child!==null){for(f=m.child,S=Ha(f,f.pendingProps),m.child=S,S.return=m;f.sibling!==null;)f=f.sibling,S=S.sibling=Ha(f,f.pendingProps),S.return=m;S.sibling=null}return m.child}function __(f,m){return(f.lanes&m)!==0?!0:(f=f.dependencies,!!(f!==null&&am(f)))}function aR(f,m,S){switch(m.tag){case 3:Ue(m,m.stateNode.containerInfo),$h(m,jn,f.memoizedState.cache),Zp();break;case 27:case 5:Xe(m);break;case 4:Ue(m,m.stateNode.containerInfo);break;case 10:$h(m,m.type,m.memoizedProps.value);break;case 13:var A=m.memoizedState;if(A!==null)return A.dehydrated!==null?(Au(m),m.flags|=128,null):(S&m.child.childLanes)!==0?ZE(f,m,S):(Au(m),f=qn(f,m,S),f!==null?f.sibling:null);Au(m);break;case 19:var I=(f.flags&128)!==0;if(A=(S&m.childLanes)!==0,A||(hv(f,m,S,!1),A=(S&m.childLanes)!==0),I){if(A)return Af(f,m,S);m.flags|=128}if(I=m.memoizedState,I!==null&&(I.rendering=null,I.tail=null,I.lastEffect=null),be(ls,ls.current),A)break;return null;case 22:case 23:return m.lanes=0,XE(f,m,S);case 24:$h(m,jn,f.memoizedState.cache)}return qn(f,m,S)}function uv(f,m,S){if(f!==null)if(f.memoizedProps!==m.pendingProps)Ss=!0;else{if(!__(f,S)&&(m.flags&128)===0)return Ss=!1,aR(f,m,S);Ss=(f.flags&131072)!==0}else Ss=!1,br&&(m.flags&1048576)!==0&&Xb(m,Jg,m.index);switch(m.lanes=0,m.tag){case 16:e:{f=m.pendingProps;var A=m.elementType,I=A._init;if(A=I(A._payload),m.type=A,typeof A=="function")Fu(A)?(f=Ef(A,f),m.tag=1,m=QE(null,m,A,f,S)):(m.tag=0,m=g_(null,m,A,f,S));else{if(A!=null){if(I=A.$$typeof,I===g){m.tag=11,m=d_(null,m,A,f,S);break e}else if(I===b){m.tag=14,m=f_(null,m,A,f,S);break e}}throw m=P(A)||A,Error(r(306,m,""))}}return m;case 0:return g_(f,m,m.type,m.pendingProps,S);case 1:return A=m.type,I=Ef(A,m.pendingProps),QE(f,m,A,I,S);case 3:e:{if(Ue(m,m.stateNode.containerInfo),f===null)throw Error(r(387));var B=m.pendingProps;I=m.memoizedState,A=I.element,Iy(f,m),nc(m,B,null,S);var ie=m.memoizedState;if(B=ie.cache,$h(m,jn,B),B!==I.cache&&Oy(m,[jn],S,!0),ga(),B=ie.element,I.isDehydrated)if(I={element:B,isDehydrated:!1,cache:ie.cache},m.updateQueue.baseState=I,m.memoizedState=I,m.flags&256){m=v_(f,m,B,S);break e}else if(B!==A){A=go(Error(r(424)),m),Ac(A),m=v_(f,m,B,S);break e}else for(Is=ju(m.stateNode.containerInfo.firstChild),pa=m,br=!0,bl=null,_l=!0,S=Eu(m,null,B,S),m.child=S;S;)S.flags=S.flags&-3|4096,S=S.sibling;else{if(Zp(),B===A){m=qn(f,m,S);break e}ws(f,m,B,S)}m=m.child}return m;case 26:return nm(f,m),f===null?(S=d5(m.type,null,m.pendingProps,null))?m.memoizedState=S:br||(S=m.type,f=m.pendingProps,A=rA(Te.current).createElement(S),A[qe]=m,A[it]=f,Wa(A,S,f),Ie(A),m.stateNode=A):m.memoizedState=d5(m.type,f.memoizedProps,m.pendingProps,f.memoizedState),null;case 27:return Xe(m),f===null&&br&&(A=m.stateNode=c5(m.type,m.pendingProps,Te.current),pa=m,_l=!0,Is=ju(A.firstChild)),A=m.pendingProps.children,f!==null||br?ws(f,m,A,S):m.child=Mu(m,null,A,S),nm(f,m),m.child;case 5:return f===null&&br&&((I=A=Is)&&(A=vee(A,m.type,m.pendingProps,_l),A!==null?(m.stateNode=A,pa=m,Is=ju(A.firstChild),_l=!1,I=!0):I=!1),I||vf(m)),Xe(m),I=m.type,B=m.pendingProps,ie=f!==null?f.memoizedProps:null,A=B.children,vR(I,B)?A=null:ie!==null&&vR(I,ie)&&(m.flags|=32),m.memoizedState!==null&&(I=Jb(f,m,tR,null,null,S),O_._currentValue=I),nm(f,m),ws(f,m,A,S),m.child;case 6:return f===null&&br&&((f=S=Is)&&(S=yee(S,m.pendingProps,_l),S!==null?(m.stateNode=S,pa=m,Is=null,f=!0):f=!1),f||vf(m)),null;case 13:return ZE(f,m,S);case 4:return Ue(m,m.stateNode.containerInfo),A=m.pendingProps,f===null?m.child=Mu(m,null,A,S):ws(f,m,A,S),m.child;case 11:return d_(f,m,m.type,m.pendingProps,S);case 7:return ws(f,m,m.pendingProps,S),m.child;case 8:return ws(f,m,m.pendingProps.children,S),m.child;case 12:return ws(f,m,m.pendingProps.children,S),m.child;case 10:return A=m.pendingProps,$h(m,m.type,A.value),ws(f,m,A.children,S),m.child;case 9:return I=m.type._context,A=m.pendingProps.children,Tf(m),I=ma(I),A=A(I),m.flags|=1,ws(f,m,A,S),m.child;case 14:return f_(f,m,m.type,m.pendingProps,S);case 15:return p_(f,m,m.type,m.pendingProps,S);case 19:return Af(f,m,S);case 22:return XE(f,m,S);case 24:return Tf(m),A=ma(jn),f===null?(I=av(),I===null&&(I=qr,B=Zb(),I.pooledCache=B,B.refCount++,B!==null&&(I.pooledCacheLanes|=S),I=B),m.memoizedState={parent:A,cache:I},ka(m),$h(m,jn,I)):((f.lanes&S)!==0&&(Iy(f,m),nc(m,null,null,S),ga()),I=f.memoizedState,B=m.memoizedState,I.parent!==A?(I={parent:A,cache:A},m.memoizedState=I,m.lanes===0&&(m.memoizedState=m.updateQueue.baseState=I),$h(m,jn,A)):(A=B.cache,$h(m,jn,A),A!==I.cache&&Oy(m,[jn],S,!0))),ws(f,m,m.pendingProps.children,S),m.child;case 29:throw m.pendingProps}throw Error(r(156,m.tag))}var sm=fe(null),Oc=null,rc=null;function $h(f,m,S){be(sm,m._currentValue),m._currentValue=S}function Lu(f){f._currentValue=sm.current,xe(sm)}function jo(f,m,S){for(;f!==null;){var A=f.alternate;if((f.childLanes&m)!==m?(f.childLanes|=m,A!==null&&(A.childLanes|=m)):A!==null&&(A.childLanes&m)!==m&&(A.childLanes|=m),f===S)break;f=f.return}}function Oy(f,m,S,A){var I=f.child;for(I!==null&&(I.return=f);I!==null;){var B=I.dependencies;if(B!==null){var ie=I.child;B=B.firstContext;e:for(;B!==null;){var ve=B;B=I;for(var Le=0;Le<m.length;Le++)if(ve.context===m[Le]){B.lanes|=S,ve=B.alternate,ve!==null&&(ve.lanes|=S),jo(B.return,S,f),A||(ie=null);break e}B=ve.next}}else if(I.tag===18){if(ie=I.return,ie===null)throw Error(r(341));ie.lanes|=S,B=ie.alternate,B!==null&&(B.lanes|=S),jo(ie,S,f),ie=null}else ie=I.child;if(ie!==null)ie.return=I;else for(ie=I;ie!==null;){if(ie===f){ie=null;break}if(I=ie.sibling,I!==null){I.return=ie.return,ie=I;break}ie=ie.return}I=ie}}function hv(f,m,S,A){f=null;for(var I=m,B=!1;I!==null;){if(!B){if((I.flags&524288)!==0)B=!0;else if((I.flags&262144)!==0)break}if(I.tag===10){var ie=I.alternate;if(ie===null)throw Error(r(387));if(ie=ie.memoizedProps,ie!==null){var ve=I.type;fo(I.pendingProps.value,ie.value)||(f!==null?f.push(ve):f=[ve])}}else if(I===ce.current){if(ie=I.alternate,ie===null)throw Error(r(387));ie.memoizedState.memoizedState!==I.memoizedState.memoizedState&&(f!==null?f.push(O_):f=[O_])}I=I.return}f!==null&&Oy(m,f,S,A),m.flags|=262144}function am(f){for(f=f.firstContext;f!==null;){if(!fo(f.context._currentValue,f.memoizedValue))return!0;f=f.next}return!1}function Tf(f){Oc=f,rc=null,f=f.dependencies,f!==null&&(f.firstContext=null)}function ma(f){return om(Oc,f)}function Ly(f,m){return Oc===null&&Tf(f),om(f,m)}function om(f,m){var S=m._currentValue;if(m={context:m,memoizedValue:S,next:null},rc===null){if(f===null)throw Error(r(308));rc=m,f.dependencies={lanes:0,firstContext:m},f.flags|=524288}else rc=rc.next=m;return S}var us=!1;function ka(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Iy(f,m){f=f.updateQueue,m.updateQueue===f&&(m.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,callbacks:null})}function Wo(f){return{lane:f,tag:0,payload:null,callback:null,next:null}}function qo(f,m,S){var A=f.updateQueue;if(A===null)return null;if(A=A.shared,(ki&2)!==0){var I=A.pending;return I===null?m.next=m:(m.next=I.next,I.next=m),A.pending=m,m=Kg(f),Zg(f,null,S),m}return Qg(f,A,m,S),Kg(f)}function ed(f,m,S){if(m=m.updateQueue,m!==null&&(m=m.shared,(S&4194176)!==0)){var A=m.lanes;A&=f.pendingLanes,S|=A,m.lanes=S,pn(f,S)}}function lm(f,m){var S=f.updateQueue,A=f.alternate;if(A!==null&&(A=A.updateQueue,S===A)){var I=null,B=null;if(S=S.firstBaseUpdate,S!==null){do{var ie={lane:S.lane,tag:S.tag,payload:S.payload,callback:null,next:null};B===null?I=B=ie:B=B.next=ie,S=S.next}while(S!==null);B===null?I=B=m:B=B.next=m}else I=B=m;S={baseState:A.baseState,firstBaseUpdate:I,lastBaseUpdate:B,shared:A.shared,callbacks:A.callbacks},f.updateQueue=S;return}f=S.lastBaseUpdate,f===null?S.firstBaseUpdate=m:f.next=m,S.lastBaseUpdate=m}var xo=!1;function ga(){if(xo){var f=Wh;if(f!==null)throw f}}function nc(f,m,S,A){xo=!1;var I=f.updateQueue;us=!1;var B=I.firstBaseUpdate,ie=I.lastBaseUpdate,ve=I.shared.pending;if(ve!==null){I.shared.pending=null;var Le=ve,Je=Le.next;Le.next=null,ie===null?B=Je:ie.next=Je,ie=Le;var Et=f.alternate;Et!==null&&(Et=Et.updateQueue,ve=Et.lastBaseUpdate,ve!==ie&&(ve===null?Et.firstBaseUpdate=Je:ve.next=Je,Et.lastBaseUpdate=Le))}if(B!==null){var Lt=I.baseState;ie=0,Et=Je=Le=null,ve=B;do{var gt=ve.lane&-536870913,wt=gt!==ve.lane;if(wt?(Ei&gt)===gt:(A&gt)===gt){gt!==0&&gt===bf&&(xo=!0),Et!==null&&(Et=Et.next={lane:0,tag:ve.tag,payload:ve.payload,callback:null,next:null});e:{var pi=f,qi=ve;gt=m;var ps=S;switch(qi.tag){case 1:if(pi=qi.payload,typeof pi=="function"){Lt=pi.call(ps,Lt,gt);break e}Lt=pi;break e;case 3:pi.flags=pi.flags&-65537|128;case 0:if(pi=qi.payload,gt=typeof pi=="function"?pi.call(ps,Lt,gt):pi,gt==null)break e;Lt=O({},Lt,gt);break e;case 2:us=!0}}gt=ve.callback,gt!==null&&(f.flags|=64,wt&&(f.flags|=8192),wt=I.callbacks,wt===null?I.callbacks=[gt]:wt.push(gt))}else wt={lane:gt,tag:ve.tag,payload:ve.payload,callback:ve.callback,next:null},Et===null?(Je=Et=wt,Le=Lt):Et=Et.next=wt,ie|=gt;if(ve=ve.next,ve===null){if(ve=I.shared.pending,ve===null)break;wt=ve,ve=wt.next,wt.next=null,I.lastBaseUpdate=wt,I.shared.pending=null}}while(!0);Et===null&&(Le=Lt),I.baseState=Le,I.firstBaseUpdate=Je,I.lastBaseUpdate=Et,B===null&&(I.shared.lanes=0),cc|=ie,f.lanes=ie,f.memoizedState=Lt}}function Lc(f,m){if(typeof f!="function")throw Error(r(191,f));f.call(m)}function Ic(f,m){var S=f.callbacks;if(S!==null)for(f.callbacks=null,f=0;f<S.length;f++)Lc(S[f],m)}function Xn(f,m){try{var S=m.updateQueue,A=S!==null?S.lastEffect:null;if(A!==null){var I=A.next;S=I;do{if((S.tag&f)===f){A=void 0;var B=S.create,ie=S.inst;A=B(),ie.destroy=A}S=S.next}while(S!==I)}}catch(ve){zt(m,m.return,ve)}}function Sl(f,m,S){try{var A=m.updateQueue,I=A!==null?A.lastEffect:null;if(I!==null){var B=I.next;A=B;do{if((A.tag&f)===f){var ie=A.inst,ve=ie.destroy;if(ve!==void 0){ie.destroy=void 0,I=m;var Le=S;try{ve()}catch(Je){zt(I,Le,Je)}}}A=A.next}while(A!==B)}}catch(Je){zt(m,m.return,Je)}}function Iu(f){var m=f.updateQueue;if(m!==null){var S=f.stateNode;try{Ic(m,S)}catch(A){zt(f,f.return,A)}}}function dv(f,m,S){S.props=Ef(f.type,f.memoizedProps),S.state=f.memoizedState;try{S.componentWillUnmount()}catch(A){zt(f,m,A)}}function Yn(f,m){try{var S=f.ref;if(S!==null){var A=f.stateNode;switch(f.tag){case 26:case 27:case 5:var I=A;break;default:I=A}typeof S=="function"?f.refCleanup=S(I):S.current=I}}catch(B){zt(f,m,B)}}function Wr(f,m){var S=f.ref,A=f.refCleanup;if(S!==null)if(typeof A=="function")try{A()}catch(I){zt(f,m,I)}finally{f.refCleanup=null,f=f.alternate,f!=null&&(f.refCleanup=null)}else if(typeof S=="function")try{S(null)}catch(I){zt(f,m,I)}else S.current=null}function _r(f){var m=f.type,S=f.memoizedProps,A=f.stateNode;try{e:switch(m){case"button":case"input":case"select":case"textarea":S.autoFocus&&A.focus();break e;case"img":S.src?A.src=S.src:S.srcSet&&(A.srcset=S.srcSet)}}catch(I){zt(f,f.return,I)}}function wl(f,m,S){try{var A=f.stateNode;dee(A,f.type,S,m),A[it]=m}catch(I){zt(f,f.return,I)}}function sc(f){return f.tag===5||f.tag===3||f.tag===26||f.tag===27||f.tag===4}function fv(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||sc(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==27&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function bo(f,m,S){var A=f.tag;if(A===5||A===6)f=f.stateNode,m?S.nodeType===8?S.parentNode.insertBefore(f,m):S.insertBefore(f,m):(S.nodeType===8?(m=S.parentNode,m.insertBefore(f,S)):(m=S,m.appendChild(f)),S=S._reactRootContainer,S!=null||m.onclick!==null||(m.onclick=iA));else if(A!==4&&A!==27&&(f=f.child,f!==null))for(bo(f,m,S),f=f.sibling;f!==null;)bo(f,m,S),f=f.sibling}function zu(f,m,S){var A=f.tag;if(A===5||A===6)f=f.stateNode,m?S.insertBefore(f,m):S.appendChild(f);else if(A!==4&&A!==27&&(f=f.child,f!==null))for(zu(f,m,S),f=f.sibling;f!==null;)zu(f,m,S),f=f.sibling}var ac=!1,gn=!1,td=!1,zy=typeof WeakSet=="function"?WeakSet:Set,Qn=null,Uy=!1;function cm(f,m){if(f=f.containerInfo,mR=cA,f=Vb(f),Xg(f)){if("selectionStart"in f)var S={start:f.selectionStart,end:f.selectionEnd};else e:{S=(S=f.ownerDocument)&&S.defaultView||window;var A=S.getSelection&&S.getSelection();if(A&&A.rangeCount!==0){S=A.anchorNode;var I=A.anchorOffset,B=A.focusNode;A=A.focusOffset;try{S.nodeType,B.nodeType}catch{S=null;break e}var ie=0,ve=-1,Le=-1,Je=0,Et=0,Lt=f,gt=null;t:for(;;){for(var wt;Lt!==S||I!==0&&Lt.nodeType!==3||(ve=ie+I),Lt!==B||A!==0&&Lt.nodeType!==3||(Le=ie+A),Lt.nodeType===3&&(ie+=Lt.nodeValue.length),(wt=Lt.firstChild)!==null;)gt=Lt,Lt=wt;for(;;){if(Lt===f)break t;if(gt===S&&++Je===I&&(ve=ie),gt===B&&++Et===A&&(Le=ie),(wt=Lt.nextSibling)!==null)break;Lt=gt,gt=Lt.parentNode}Lt=wt}S=ve===-1||Le===-1?null:{start:ve,end:Le}}else S=null}S=S||{start:0,end:0}}else S=null;for(gR={focusedElem:f,selectionRange:S},cA=!1,Qn=m;Qn!==null;)if(m=Qn,f=m.child,(m.subtreeFlags&1028)!==0&&f!==null)f.return=m,Qn=f;else for(;Qn!==null;){switch(m=Qn,B=m.alternate,f=m.flags,m.tag){case 0:break;case 11:case 15:break;case 1:if((f&1024)!==0&&B!==null){f=void 0,S=m,I=B.memoizedProps,B=B.memoizedState,A=S.stateNode;try{var pi=Ef(S.type,I,S.elementType===S.type);f=A.getSnapshotBeforeUpdate(pi,B),A.__reactInternalSnapshotBeforeUpdate=f}catch(qi){zt(S,S.return,qi)}}break;case 3:if((f&1024)!==0){if(f=m.stateNode.containerInfo,S=f.nodeType,S===9)bR(f);else if(S===1)switch(f.nodeName){case"HEAD":case"HTML":case"BODY":bR(f);break;default:f.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((f&1024)!==0)throw Error(r(163))}if(f=m.sibling,f!==null){f.return=m.return,Qn=f;break}Qn=m.return}return pi=Uy,Uy=!1,pi}function um(f,m,S){var A=S.flags;switch(S.tag){case 0:case 11:case 15:zc(f,S),A&4&&Xn(5,S);break;case 1:if(zc(f,S),A&4)if(f=S.stateNode,m===null)try{f.componentDidMount()}catch(ve){zt(S,S.return,ve)}else{var I=Ef(S.type,m.memoizedProps);m=m.memoizedState;try{f.componentDidUpdate(I,m,f.__reactInternalSnapshotBeforeUpdate)}catch(ve){zt(S,S.return,ve)}}A&64&&Iu(S),A&512&&Yn(S,S.return);break;case 3:if(zc(f,S),A&64&&(A=S.updateQueue,A!==null)){if(f=null,S.child!==null)switch(S.child.tag){case 27:case 5:f=S.child.stateNode;break;case 1:f=S.child.stateNode}try{Ic(A,f)}catch(ve){zt(S,S.return,ve)}}break;case 26:zc(f,S),A&512&&Yn(S,S.return);break;case 27:case 5:zc(f,S),m===null&&A&4&&_r(S),A&512&&Yn(S,S.return);break;case 12:zc(f,S);break;case 13:zc(f,S),A&4&&KE(f,S);break;case 22:if(I=S.memoizedState!==null||ac,!I){m=m!==null&&m.memoizedState!==null||gn;var B=ac,ie=gn;ac=I,(gn=m)&&!ie?lc(f,S,(S.subtreeFlags&8772)!==0):zc(f,S),ac=B,gn=ie}A&512&&(S.memoizedProps.mode==="manual"?Yn(S,S.return):Wr(S,S.return));break;default:zc(f,S)}}function By(f){var m=f.alternate;m!==null&&(f.alternate=null,By(m)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(m=f.stateNode,m!==null&&Mi(m)),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}var vn=null,Us=!1;function va(f,m,S){for(S=S.child;S!==null;)Ny(f,m,S),S=S.sibling}function Ny(f,m,S){if(ht&&typeof ht.onCommitFiberUnmount=="function")try{ht.onCommitFiberUnmount(ut,S)}catch{}switch(S.tag){case 26:gn||Wr(S,m),va(f,m,S),S.memoizedState?S.memoizedState.count--:S.stateNode&&(S=S.stateNode,S.parentNode.removeChild(S));break;case 27:gn||Wr(S,m);var A=vn,I=Us;for(vn=S.stateNode,va(f,m,S),S=S.stateNode,m=S.attributes;m.length;)S.removeAttributeNode(m[0]);Mi(S),vn=A,Us=I;break;case 5:gn||Wr(S,m);case 6:I=vn;var B=Us;if(vn=null,va(f,m,S),vn=I,Us=B,vn!==null)if(Us)try{f=vn,A=S.stateNode,f.nodeType===8?f.parentNode.removeChild(A):f.removeChild(A)}catch(ie){zt(S,m,ie)}else try{vn.removeChild(S.stateNode)}catch(ie){zt(S,m,ie)}break;case 18:vn!==null&&(Us?(m=vn,S=S.stateNode,m.nodeType===8?xR(m.parentNode,S):m.nodeType===1&&xR(m,S),U_(m)):xR(vn,S.stateNode));break;case 4:A=vn,I=Us,vn=S.stateNode.containerInfo,Us=!0,va(f,m,S),vn=A,Us=I;break;case 0:case 11:case 14:case 15:gn||Sl(2,S,m),gn||Sl(4,S,m),va(f,m,S);break;case 1:gn||(Wr(S,m),A=S.stateNode,typeof A.componentWillUnmount=="function"&&dv(S,m,A)),va(f,m,S);break;case 21:va(f,m,S);break;case 22:gn||Wr(S,m),gn=(A=gn)||S.memoizedState!==null,va(f,m,S),gn=A;break;default:va(f,m,S)}}function KE(f,m){if(m.memoizedState===null&&(f=m.alternate,f!==null&&(f=f.memoizedState,f!==null&&(f=f.dehydrated,f!==null))))try{U_(f)}catch(S){zt(m,m.return,S)}}function pv(f){switch(f.tag){case 13:case 19:var m=f.stateNode;return m===null&&(m=f.stateNode=new zy),m;case 22:return f=f.stateNode,m=f._retryCache,m===null&&(m=f._retryCache=new zy),m;default:throw Error(r(435,f.tag))}}function mv(f,m){var S=pv(f);m.forEach(function(A){var I=ft.bind(null,f,A);S.has(A)||(S.add(A),A.then(I,I))})}function Va(f,m){var S=m.deletions;if(S!==null)for(var A=0;A<S.length;A++){var I=S[A],B=f,ie=m,ve=ie;e:for(;ve!==null;){switch(ve.tag){case 27:case 5:vn=ve.stateNode,Us=!1;break e;case 3:vn=ve.stateNode.containerInfo,Us=!0;break e;case 4:vn=ve.stateNode.containerInfo,Us=!0;break e}ve=ve.return}if(vn===null)throw Error(r(160));Ny(B,ie,I),vn=null,Us=!1,B=I.alternate,B!==null&&(B.return=null),I.return=null}if(m.subtreeFlags&13878)for(m=m.child;m!==null;)Cf(m,f),m=m.sibling}var ya=null;function Cf(f,m){var S=f.alternate,A=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:Va(m,f),xa(f),A&4&&(Sl(3,f,f.return),Xn(3,f),Sl(5,f,f.return));break;case 1:Va(m,f),xa(f),A&512&&(gn||S===null||Wr(S,S.return)),A&64&&ac&&(f=f.updateQueue,f!==null&&(A=f.callbacks,A!==null&&(S=f.shared.hiddenCallbacks,f.shared.hiddenCallbacks=S===null?A:S.concat(A))));break;case 26:var I=ya;if(Va(m,f),xa(f),A&512&&(gn||S===null||Wr(S,S.return)),A&4){var B=S!==null?S.memoizedState:null;if(A=f.memoizedState,S===null)if(A===null)if(f.stateNode===null){e:{A=f.type,S=f.memoizedProps,I=I.ownerDocument||I;t:switch(A){case"title":B=I.getElementsByTagName("title")[0],(!B||B[mi]||B[qe]||B.namespaceURI==="http://www.w3.org/2000/svg"||B.hasAttribute("itemprop"))&&(B=I.createElement(A),I.head.insertBefore(B,I.querySelector("head > title"))),Wa(B,A,S),B[qe]=f,Ie(B),A=B;break e;case"link":var ie=m5("link","href",I).get(A+(S.href||""));if(ie){for(var ve=0;ve<ie.length;ve++)if(B=ie[ve],B.getAttribute("href")===(S.href==null?null:S.href)&&B.getAttribute("rel")===(S.rel==null?null:S.rel)&&B.getAttribute("title")===(S.title==null?null:S.title)&&B.getAttribute("crossorigin")===(S.crossOrigin==null?null:S.crossOrigin)){ie.splice(ve,1);break t}}B=I.createElement(A),Wa(B,A,S),I.head.appendChild(B);break;case"meta":if(ie=m5("meta","content",I).get(A+(S.content||""))){for(ve=0;ve<ie.length;ve++)if(B=ie[ve],B.getAttribute("content")===(S.content==null?null:""+S.content)&&B.getAttribute("name")===(S.name==null?null:S.name)&&B.getAttribute("property")===(S.property==null?null:S.property)&&B.getAttribute("http-equiv")===(S.httpEquiv==null?null:S.httpEquiv)&&B.getAttribute("charset")===(S.charSet==null?null:S.charSet)){ie.splice(ve,1);break t}}B=I.createElement(A),Wa(B,A,S),I.head.appendChild(B);break;default:throw Error(r(468,A))}B[qe]=f,Ie(B),A=B}f.stateNode=A}else g5(I,f.type,f.stateNode);else f.stateNode=p5(I,A,f.memoizedProps);else B!==A?(B===null?S.stateNode!==null&&(S=S.stateNode,S.parentNode.removeChild(S)):B.count--,A===null?g5(I,f.type,f.stateNode):p5(I,A,f.memoizedProps)):A===null&&f.stateNode!==null&&wl(f,f.memoizedProps,S.memoizedProps)}break;case 27:if(A&4&&f.alternate===null){I=f.stateNode,B=f.memoizedProps;try{for(var Le=I.firstChild;Le;){var Je=Le.nextSibling,Et=Le.nodeName;Le[mi]||Et==="HEAD"||Et==="BODY"||Et==="SCRIPT"||Et==="STYLE"||Et==="LINK"&&Le.rel.toLowerCase()==="stylesheet"||I.removeChild(Le),Le=Je}for(var Lt=f.type,gt=I.attributes;gt.length;)I.removeAttributeNode(gt[0]);Wa(I,Lt,B),I[qe]=f,I[it]=B}catch(pi){zt(f,f.return,pi)}}case 5:if(Va(m,f),xa(f),A&512&&(gn||S===null||Wr(S,S.return)),f.flags&32){I=f.stateNode;try{_s(I,"")}catch(pi){zt(f,f.return,pi)}}A&4&&f.stateNode!=null&&(I=f.memoizedProps,wl(f,I,S!==null?S.memoizedProps:I)),A&1024&&(td=!0);break;case 6:if(Va(m,f),xa(f),A&4){if(f.stateNode===null)throw Error(r(162));A=f.memoizedProps,S=f.stateNode;try{S.nodeValue=A}catch(pi){zt(f,f.return,pi)}}break;case 3:if(aA=null,I=ya,ya=nA(m.containerInfo),Va(m,f),ya=I,xa(f),A&4&&S!==null&&S.memoizedState.isDehydrated)try{U_(m.containerInfo)}catch(pi){zt(f,f.return,pi)}td&&(td=!1,id(f));break;case 4:A=ya,ya=nA(f.stateNode.containerInfo),Va(m,f),xa(f),ya=A;break;case 12:Va(m,f),xa(f);break;case 13:Va(m,f),xa(f),f.child.flags&8192&&f.memoizedState!==null!=(S!==null&&S.memoizedState!==null)&&(ir=pe()),A&4&&(A=f.updateQueue,A!==null&&(f.updateQueue=null,mv(f,A)));break;case 22:if(A&512&&(gn||S===null||Wr(S,S.return)),Le=f.memoizedState!==null,Je=S!==null&&S.memoizedState!==null,Et=ac,Lt=gn,ac=Et||Le,gn=Lt||Je,Va(m,f),gn=Lt,ac=Et,xa(f),m=f.stateNode,m._current=f,m._visibility&=-3,m._visibility|=m._pendingVisibility&2,A&8192&&(m._visibility=Le?m._visibility&-2:m._visibility|1,Le&&(m=ac||gn,S===null||Je||m||oc(f)),f.memoizedProps===null||f.memoizedProps.mode!=="manual"))e:for(S=null,m=f;;){if(m.tag===5||m.tag===26||m.tag===27){if(S===null){Je=S=m;try{if(I=Je.stateNode,Le)B=I.style,typeof B.setProperty=="function"?B.setProperty("display","none","important"):B.display="none";else{ie=Je.stateNode,ve=Je.memoizedProps.style;var wt=ve!=null&&ve.hasOwnProperty("display")?ve.display:null;ie.style.display=wt==null||typeof wt=="boolean"?"":(""+wt).trim()}}catch(pi){zt(Je,Je.return,pi)}}}else if(m.tag===6){if(S===null){Je=m;try{Je.stateNode.nodeValue=Le?"":Je.memoizedProps}catch(pi){zt(Je,Je.return,pi)}}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===f)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===f)break e;for(;m.sibling===null;){if(m.return===null||m.return===f)break e;S===m&&(S=null),m=m.return}S===m&&(S=null),m.sibling.return=m.return,m=m.sibling}A&4&&(A=f.updateQueue,A!==null&&(S=A.retryQueue,S!==null&&(A.retryQueue=null,mv(f,S))));break;case 19:Va(m,f),xa(f),A&4&&(A=f.updateQueue,A!==null&&(f.updateQueue=null,mv(f,A)));break;case 21:break;default:Va(m,f),xa(f)}}function xa(f){var m=f.flags;if(m&2){try{if(f.tag!==27){e:{for(var S=f.return;S!==null;){if(sc(S)){var A=S;break e}S=S.return}throw Error(r(160))}switch(A.tag){case 27:var I=A.stateNode,B=fv(f);zu(f,B,I);break;case 5:var ie=A.stateNode;A.flags&32&&(_s(ie,""),A.flags&=-33);var ve=fv(f);zu(f,ve,ie);break;case 3:case 4:var Le=A.stateNode.containerInfo,Je=fv(f);bo(f,Je,Le);break;default:throw Error(r(161))}}}catch(Et){zt(f,f.return,Et)}f.flags&=-3}m&4096&&(f.flags&=-4097)}function id(f){if(f.subtreeFlags&1024)for(f=f.child;f!==null;){var m=f;id(m),m.tag===5&&m.flags&1024&&m.stateNode.reset(),f=f.sibling}}function zc(f,m){if(m.subtreeFlags&8772)for(m=m.child;m!==null;)um(f,m.alternate,m),m=m.sibling}function oc(f){for(f=f.child;f!==null;){var m=f;switch(m.tag){case 0:case 11:case 14:case 15:Sl(4,m,m.return),oc(m);break;case 1:Wr(m,m.return);var S=m.stateNode;typeof S.componentWillUnmount=="function"&&dv(m,m.return,S),oc(m);break;case 26:case 27:case 5:Wr(m,m.return),oc(m);break;case 22:Wr(m,m.return),m.memoizedState===null&&oc(m);break;default:oc(m)}f=f.sibling}}function lc(f,m,S){for(S=S&&(m.subtreeFlags&8772)!==0,m=m.child;m!==null;){var A=m.alternate,I=f,B=m,ie=B.flags;switch(B.tag){case 0:case 11:case 15:lc(I,B,S),Xn(4,B);break;case 1:if(lc(I,B,S),A=B,I=A.stateNode,typeof I.componentDidMount=="function")try{I.componentDidMount()}catch(Je){zt(A,A.return,Je)}if(A=B,I=A.updateQueue,I!==null){var ve=A.stateNode;try{var Le=I.shared.hiddenCallbacks;if(Le!==null)for(I.shared.hiddenCallbacks=null,I=0;I<Le.length;I++)Lc(Le[I],ve)}catch(Je){zt(A,A.return,Je)}}S&&ie&64&&Iu(B),Yn(B,B.return);break;case 26:case 27:case 5:lc(I,B,S),S&&A===null&&ie&4&&_r(B),Yn(B,B.return);break;case 12:lc(I,B,S);break;case 13:lc(I,B,S),S&&ie&4&&KE(I,B);break;case 22:B.memoizedState===null&&lc(I,B,S),Yn(B,B.return);break;default:lc(I,B,S)}m=m.sibling}}function _o(f,m){var S=null;f!==null&&f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(S=f.memoizedState.cachePool.pool),f=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(f=m.memoizedState.cachePool.pool),f!==S&&(f!=null&&f.refCount++,S!=null&&Gh(S))}function Ml(f,m){f=null,m.alternate!==null&&(f=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==f&&(m.refCount++,f!=null&&Gh(f))}function ln(f,m,S,A){if(m.subtreeFlags&10256)for(m=m.child;m!==null;)Uu(f,m,S,A),m=m.sibling}function Uu(f,m,S,A){var I=m.flags;switch(m.tag){case 0:case 11:case 15:ln(f,m,S,A),I&2048&&Xn(9,m);break;case 3:ln(f,m,S,A),I&2048&&(f=null,m.alternate!==null&&(f=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==f&&(m.refCount++,f!=null&&Gh(f)));break;case 12:if(I&2048){ln(f,m,S,A),f=m.stateNode;try{var B=m.memoizedProps,ie=B.id,ve=B.onPostCommit;typeof ve=="function"&&ve(ie,m.alternate===null?"mount":"update",f.passiveEffectDuration,-0)}catch(Le){zt(m,m.return,Le)}}else ln(f,m,S,A);break;case 23:break;case 22:B=m.stateNode,m.memoizedState!==null?B._visibility&4?ln(f,m,S,A):Cr(f,m):B._visibility&4?ln(f,m,S,A):(B._visibility|=4,Fi(f,m,S,A,(m.subtreeFlags&10256)!==0)),I&2048&&_o(m.alternate,m);break;case 24:ln(f,m,S,A),I&2048&&Ml(m.alternate,m);break;default:ln(f,m,S,A)}}function Fi(f,m,S,A,I){for(I=I&&(m.subtreeFlags&10256)!==0,m=m.child;m!==null;){var B=f,ie=m,ve=S,Le=A,Je=ie.flags;switch(ie.tag){case 0:case 11:case 15:Fi(B,ie,ve,Le,I),Xn(8,ie);break;case 23:break;case 22:var Et=ie.stateNode;ie.memoizedState!==null?Et._visibility&4?Fi(B,ie,ve,Le,I):Cr(B,ie):(Et._visibility|=4,Fi(B,ie,ve,Le,I)),I&&Je&2048&&_o(ie.alternate,ie);break;case 24:Fi(B,ie,ve,Le,I),I&&Je&2048&&Ml(ie.alternate,ie);break;default:Fi(B,ie,ve,Le,I)}m=m.sibling}}function Cr(f,m){if(m.subtreeFlags&10256)for(m=m.child;m!==null;){var S=f,A=m,I=A.flags;switch(A.tag){case 22:Cr(S,A),I&2048&&_o(A.alternate,A);break;case 24:Cr(S,A),I&2048&&Ml(A.alternate,A);break;default:Cr(S,A)}m=m.sibling}}var Mn=8192;function Bu(f){if(f.subtreeFlags&Mn)for(f=f.child;f!==null;)Df(f),f=f.sibling}function Df(f){switch(f.tag){case 26:Bu(f),f.flags&Mn&&f.memoizedState!==null&&Ree(ya,f.memoizedState,f.memoizedProps);break;case 5:Bu(f);break;case 3:case 4:var m=ya;ya=nA(f.stateNode.containerInfo),Bu(f),ya=m;break;case 22:f.memoizedState===null&&(m=f.alternate,m!==null&&m.memoizedState!==null?(m=Mn,Mn=16777216,Bu(f),Mn=m):Bu(f));break;default:Bu(f)}}function rd(f){var m=f.alternate;if(m!==null&&(f=m.child,f!==null)){m.child=null;do m=f.sibling,f.sibling=null,f=m;while(f!==null)}}function nd(f){var m=f.deletions;if((f.flags&16)!==0){if(m!==null)for(var S=0;S<m.length;S++){var A=m[S];Qn=A,JE(A,f)}rd(f)}if(f.subtreeFlags&10256)for(f=f.child;f!==null;)hm(f),f=f.sibling}function hm(f){switch(f.tag){case 0:case 11:case 15:nd(f),f.flags&2048&&Sl(9,f,f.return);break;case 3:nd(f);break;case 12:nd(f);break;case 22:var m=f.stateNode;f.memoizedState!==null&&m._visibility&4&&(f.return===null||f.return.tag!==13)?(m._visibility&=-5,Nu(f)):nd(f);break;default:nd(f)}}function Nu(f){var m=f.deletions;if((f.flags&16)!==0){if(m!==null)for(var S=0;S<m.length;S++){var A=m[S];Qn=A,JE(A,f)}rd(f)}for(f=f.child;f!==null;){switch(m=f,m.tag){case 0:case 11:case 15:Sl(8,m,m.return),Nu(m);break;case 22:S=m.stateNode,S._visibility&4&&(S._visibility&=-5,Nu(m));break;default:Nu(m)}f=f.sibling}}function JE(f,m){for(;Qn!==null;){var S=Qn;switch(S.tag){case 0:case 11:case 15:Sl(8,S,m);break;case 23:case 22:if(S.memoizedState!==null&&S.memoizedState.cachePool!==null){var A=S.memoizedState.cachePool.pool;A!=null&&A.refCount++}break;case 24:Gh(S.memoizedState.cache)}if(A=S.child,A!==null)A.return=S,Qn=A;else e:for(S=f;Qn!==null;){A=Qn;var I=A.sibling,B=A.return;if(By(A),A===S){Qn=null;break e}if(I!==null){I.return=B,Qn=I;break e}Qn=B}}}function S_(f,m,S,A){this.tag=f,this.key=S,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=A,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Zn(f,m,S,A){return new S_(f,m,S,A)}function Fu(f){return f=f.prototype,!(!f||!f.isReactComponent)}function Ha(f,m){var S=f.alternate;return S===null?(S=Zn(f.tag,m,f.key,f.mode),S.elementType=f.elementType,S.type=f.type,S.stateNode=f.stateNode,S.alternate=f,f.alternate=S):(S.pendingProps=m,S.type=f.type,S.flags=0,S.subtreeFlags=0,S.deletions=null),S.flags=f.flags&31457280,S.childLanes=f.childLanes,S.lanes=f.lanes,S.child=f.child,S.memoizedProps=f.memoizedProps,S.memoizedState=f.memoizedState,S.updateQueue=f.updateQueue,m=f.dependencies,S.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},S.sibling=f.sibling,S.index=f.index,S.ref=f.ref,S.refCleanup=f.refCleanup,S}function sd(f,m){f.flags&=31457282;var S=f.alternate;return S===null?(f.childLanes=0,f.lanes=m,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=S.childLanes,f.lanes=S.lanes,f.child=S.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=S.memoizedProps,f.memoizedState=S.memoizedState,f.updateQueue=S.updateQueue,f.type=S.type,m=S.dependencies,f.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext}),f}function dm(f,m,S,A,I,B){var ie=0;if(A=f,typeof f=="function")Fu(f)&&(ie=1);else if(typeof f=="string")ie=Dee(f,S,Ce.current)?26:f==="html"||f==="head"||f==="body"?27:5;else e:switch(f){case l:return ad(S.children,I,B,m);case c:ie=8,I|=24;break;case u:return f=Zn(12,S,m,I|2),f.elementType=u,f.lanes=B,f;case x:return f=Zn(13,S,m,I),f.elementType=x,f.lanes=B,f;case v:return f=Zn(19,S,m,I),f.elementType=v,f.lanes=B,f;case M:return w_(S,I,B,m);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case h:case p:ie=10;break e;case d:ie=9;break e;case g:ie=11;break e;case b:ie=14;break e;case w:ie=16,A=null;break e}ie=29,S=Error(r(130,f===null?"null":typeof f,"")),A=null}return m=Zn(ie,S,m,I),m.elementType=f,m.type=A,m.lanes=B,m}function ad(f,m,S,A){return f=Zn(7,f,A,m),f.lanes=S,f}function w_(f,m,S,A){f=Zn(22,f,A,m),f.elementType=M,f.lanes=S;var I={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var B=I._current;if(B===null)throw Error(r(456));if((I._pendingVisibility&2)===0){var ie=_u(B,2);ie!==null&&(I._pendingVisibility|=2,fs(ie,B,2))}},attach:function(){var B=I._current;if(B===null)throw Error(r(456));if((I._pendingVisibility&2)!==0){var ie=_u(B,2);ie!==null&&(I._pendingVisibility&=-3,fs(ie,B,2))}}};return f.stateNode=I,f}function hs(f,m,S){return f=Zn(6,f,null,m),f.lanes=S,f}function gv(f,m,S){return m=Zn(4,f.children!==null?f.children:[],f.key,m),m.lanes=S,m.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},m}function El(f){f.flags|=4}function od(f,m){if(m.type!=="stylesheet"||(m.state.loading&4)!==0)f.flags&=-16777217;else if(f.flags|=16777216,!v5(m)){if(m=vo.current,m!==null&&((Ei&4194176)===Ei?Tc!==null:(Ei&62914560)!==Ei&&(Ei&536870912)===0||m!==Tc))throw Kp=my,Yb;f.flags|=8192}}function Al(f,m){m!==null&&(f.flags|=4),f.flags&16384&&(m=f.tag!==22?Ft():536870912,f.lanes|=m,Bc|=m)}function vv(f,m){if(!br)switch(f.tailMode){case"hidden":m=f.tail;for(var S=null;m!==null;)m.alternate!==null&&(S=m),m=m.sibling;S===null?f.tail=null:S.sibling=null;break;case"collapsed":S=f.tail;for(var A=null;S!==null;)S.alternate!==null&&(A=S),S=S.sibling;A===null?m||f.tail===null?f.tail=null:f.tail.sibling=null:A.sibling=null}}function Ln(f){var m=f.alternate!==null&&f.alternate.child===f.child,S=0,A=0;if(m)for(var I=f.child;I!==null;)S|=I.lanes|I.childLanes,A|=I.subtreeFlags&31457280,A|=I.flags&31457280,I.return=f,I=I.sibling;else for(I=f.child;I!==null;)S|=I.lanes|I.childLanes,A|=I.subtreeFlags,A|=I.flags,I.return=f,I=I.sibling;return f.subtreeFlags|=A,f.childLanes=S,m}function oR(f,m,S){var A=m.pendingProps;switch(Nh(m),m.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ln(m),null;case 1:return Ln(m),null;case 3:return S=m.stateNode,A=null,f!==null&&(A=f.memoizedState.cache),m.memoizedState.cache!==A&&(m.flags|=2048),Lu(jn),ze(),S.pendingContext&&(S.context=S.pendingContext,S.pendingContext=null),(f===null||f.child===null)&&(Qp(m)?El(m):f===null||f.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,bl!==null&&(Pl(bl),bl=null))),Ln(m),null;case 26:return S=m.memoizedState,f===null?(El(m),S!==null?(Ln(m),od(m,S)):(Ln(m),m.flags&=-16777217)):S?S!==f.memoizedState?(El(m),Ln(m),od(m,S)):(Ln(m),m.flags&=-16777217):(f.memoizedProps!==A&&El(m),Ln(m),m.flags&=-16777217),null;case 27:De(m),S=Te.current;var I=m.type;if(f!==null&&m.stateNode!=null)f.memoizedProps!==A&&El(m);else{if(!A){if(m.stateNode===null)throw Error(r(166));return Ln(m),null}f=Ce.current,Qp(m)?aE(m):(f=c5(I,A,S),m.stateNode=f,El(m))}return Ln(m),null;case 5:if(De(m),S=m.type,f!==null&&m.stateNode!=null)f.memoizedProps!==A&&El(m);else{if(!A){if(m.stateNode===null)throw Error(r(166));return Ln(m),null}if(f=Ce.current,Qp(m))aE(m);else{switch(I=rA(Te.current),f){case 1:f=I.createElementNS("http://www.w3.org/2000/svg",S);break;case 2:f=I.createElementNS("http://www.w3.org/1998/Math/MathML",S);break;default:switch(S){case"svg":f=I.createElementNS("http://www.w3.org/2000/svg",S);break;case"math":f=I.createElementNS("http://www.w3.org/1998/Math/MathML",S);break;case"script":f=I.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild);break;case"select":f=typeof A.is=="string"?I.createElement("select",{is:A.is}):I.createElement("select"),A.multiple?f.multiple=!0:A.size&&(f.size=A.size);break;default:f=typeof A.is=="string"?I.createElement(S,{is:A.is}):I.createElement(S)}}f[qe]=m,f[it]=A;e:for(I=m.child;I!==null;){if(I.tag===5||I.tag===6)f.appendChild(I.stateNode);else if(I.tag!==4&&I.tag!==27&&I.child!==null){I.child.return=I,I=I.child;continue}if(I===m)break e;for(;I.sibling===null;){if(I.return===null||I.return===m)break e;I=I.return}I.sibling.return=I.return,I=I.sibling}m.stateNode=f;e:switch(Wa(f,S,A),S){case"button":case"input":case"select":case"textarea":f=!!A.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&El(m)}}return Ln(m),m.flags&=-16777217,null;case 6:if(f&&m.stateNode!=null)f.memoizedProps!==A&&El(m);else{if(typeof A!="string"&&m.stateNode===null)throw Error(r(166));if(f=Te.current,Qp(m)){if(f=m.stateNode,S=m.memoizedProps,A=null,I=pa,I!==null)switch(I.tag){case 27:case 5:A=I.memoizedProps}f[qe]=m,f=!!(f.nodeValue===S||A!==null&&A.suppressHydrationWarning===!0||r5(f.nodeValue,S)),f||vf(m)}else f=rA(f).createTextNode(A),f[qe]=m,m.stateNode=f}return Ln(m),null;case 13:if(A=m.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(I=Qp(m),A!==null&&A.dehydrated!==null){if(f===null){if(!I)throw Error(r(318));if(I=m.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(r(317));I[qe]=m}else Zp(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;Ln(m),I=!1}else bl!==null&&(Pl(bl),bl=null),I=!0;if(!I)return m.flags&256?(Cc(m),m):(Cc(m),null)}if(Cc(m),(m.flags&128)!==0)return m.lanes=S,m;if(S=A!==null,f=f!==null&&f.memoizedState!==null,S){A=m.child,I=null,A.alternate!==null&&A.alternate.memoizedState!==null&&A.alternate.memoizedState.cachePool!==null&&(I=A.alternate.memoizedState.cachePool.pool);var B=null;A.memoizedState!==null&&A.memoizedState.cachePool!==null&&(B=A.memoizedState.cachePool.pool),B!==I&&(A.flags|=2048)}return S!==f&&S&&(m.child.flags|=8192),Al(m,m.updateQueue),Ln(m),null;case 4:return ze(),f===null&&dR(m.stateNode.containerInfo),Ln(m),null;case 10:return Lu(m.type),Ln(m),null;case 19:if(xe(ls),I=m.memoizedState,I===null)return Ln(m),null;if(A=(m.flags&128)!==0,B=I.rendering,B===null)if(A)vv(I,!1);else{if(yn!==0||f!==null&&(f.flags&128)!==0)for(f=m.child;f!==null;){if(B=Jp(f),B!==null){for(m.flags|=128,vv(I,!1),f=B.updateQueue,m.updateQueue=f,Al(m,f),m.subtreeFlags=0,f=S,S=m.child;S!==null;)sd(S,f),S=S.sibling;return be(ls,ls.current&1|2),m.child}f=f.sibling}I.tail!==null&&pe()>ur&&(m.flags|=128,A=!0,vv(I,!1),m.lanes=4194304)}else{if(!A)if(f=Jp(B),f!==null){if(m.flags|=128,A=!0,f=f.updateQueue,m.updateQueue=f,Al(m,f),vv(I,!0),I.tail===null&&I.tailMode==="hidden"&&!B.alternate&&!br)return Ln(m),null}else 2*pe()-I.renderingStartTime>ur&&S!==536870912&&(m.flags|=128,A=!0,vv(I,!1),m.lanes=4194304);I.isBackwards?(B.sibling=m.child,m.child=B):(f=I.last,f!==null?f.sibling=B:m.child=B,I.last=B)}return I.tail!==null?(m=I.tail,I.rendering=m,I.tail=m.sibling,I.renderingStartTime=pe(),m.sibling=null,f=ls.current,be(ls,A?f&1|2:f&1),m):(Ln(m),null);case 22:case 23:return Cc(m),sv(),A=m.memoizedState!==null,f!==null?f.memoizedState!==null!==A&&(m.flags|=8192):A&&(m.flags|=8192),A?(S&536870912)!==0&&(m.flags&128)===0&&(Ln(m),m.subtreeFlags&6&&(m.flags|=8192)):Ln(m),S=m.updateQueue,S!==null&&Al(m,S.retryQueue),S=null,f!==null&&f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(S=f.memoizedState.cachePool.pool),A=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(A=m.memoizedState.cachePool.pool),A!==S&&(m.flags|=2048),f!==null&&xe(Cu),null;case 24:return S=null,f!==null&&(S=f.memoizedState.cache),m.memoizedState.cache!==S&&(m.flags|=2048),Lu(jn),Ln(m),null;case 25:return null}throw Error(r(156,m.tag))}function Fn(f,m){switch(Nh(m),m.tag){case 1:return f=m.flags,f&65536?(m.flags=f&-65537|128,m):null;case 3:return Lu(jn),ze(),f=m.flags,(f&65536)!==0&&(f&128)===0?(m.flags=f&-65537|128,m):null;case 26:case 27:case 5:return De(m),null;case 13:if(Cc(m),f=m.memoizedState,f!==null&&f.dehydrated!==null){if(m.alternate===null)throw Error(r(340));Zp()}return f=m.flags,f&65536?(m.flags=f&-65537|128,m):null;case 19:return xe(ls),null;case 4:return ze(),null;case 10:return Lu(m.type),null;case 22:case 23:return Cc(m),sv(),f!==null&&xe(Cu),f=m.flags,f&65536?(m.flags=f&-65537|128,m):null;case 24:return Lu(jn),null;case 25:return null;default:return null}}function M_(f,m){switch(Nh(m),m.tag){case 3:Lu(jn),ze();break;case 26:case 27:case 5:De(m);break;case 4:ze();break;case 13:Cc(m);break;case 19:xe(ls);break;case 10:Lu(m.type);break;case 22:case 23:Cc(m),sv(),f!==null&&xe(Cu);break;case 24:Lu(jn)}}var Pf={getCacheForType:function(f){var m=ma(jn),S=m.data.get(f);return S===void 0&&(S=f(),m.data.set(f,S)),S}},ku=typeof WeakMap=="function"?WeakMap:Map,ki=0,qr=null,ar=null,Ei=0,Jr=0,Dr=null,Kn=!1,ba=!1,ld=!1,Vu=0,yn=0,cc=0,Uc=0,fm=0,Ga=0,Bc=0,yv=null,cr=null,Xr=!1,ir=0,ur=1/0,Vr=null,ds=null,Tl=!1,Cl=null,Rf=0,uc=0,En=null,Dl=0,Hu=null;function ja(){if((ki&2)!==0&&Ei!==0)return Ei&-Ei;if(R.T!==null){var f=bf;return f!==0?f:lR()}return _e()}function Xo(){Ga===0&&(Ga=(Ei&536870912)===0||br?qt():536870912);var f=vo.current;return f!==null&&(f.flags|=32),Ga}function fs(f,m,S){(f===qr&&Jr===2||f.cancelPendingCommit!==null)&&(Gu(f,0),Yo(f,Ei,Ga,!1)),Oi(f,S),((ki&2)===0||f!==qr)&&(f===qr&&((ki&2)===0&&(Uc|=S),yn===4&&Yo(f,Ei,Ga,!1)),$r(f))}function pm(f,m,S){if((ki&6)!==0)throw Error(r(327));var A=!S&&(m&60)===0&&(m&f.expiredLanes)===0||Bt(f,m),I=A?y(f,m):Lf(f,m,!0),B=A;do{if(I===0){ba&&!A&&Yo(f,m,0,!1);break}else if(I===6)Yo(f,m,0,!Kn);else{if(S=f.current.alternate,B&&!E_(S)){I=Lf(f,m,!1),B=!1;continue}if(I===2){if(B=m,f.errorRecoveryDisabledLanes&B)var ie=0;else ie=f.pendingLanes&-536870913,ie=ie!==0?ie:ie&536870912?536870912:0;if(ie!==0){m=ie;e:{var ve=f;I=yv;var Le=ve.current.memoizedState.isDehydrated;if(Le&&(Gu(ve,ie).flags|=256),ie=Lf(ve,ie,!1),ie!==2){if(ld&&!Le){ve.errorRecoveryDisabledLanes|=B,Uc|=B,I=4;break e}B=cr,cr=I,B!==null&&Pl(B)}I=ie}if(B=!1,I!==2)continue}}if(I===1){Gu(f,0),Yo(f,m,0,!0);break}e:{switch(A=f,I){case 0:case 1:throw Error(r(345));case 4:if((m&4194176)===m){Yo(A,m,Ga,!Kn);break e}break;case 2:cr=null;break;case 3:case 5:break;default:throw Error(r(329))}if(A.finishedWork=S,A.finishedLanes=m,(m&62914560)===m&&(B=ir+300-pe(),10<B)){if(Yo(A,m,Ga,!Kn),pt(A,0)!==0)break e;A.timeoutHandle=a5(Fy.bind(null,A,S,cr,Vr,Xr,m,Ga,Uc,Bc,Kn,2,-0,0),B);break e}Fy(A,S,cr,Vr,Xr,m,Ga,Uc,Bc,Kn,0,-0,0)}}break}while(!0);$r(f)}function Pl(f){cr===null?cr=f:cr.push.apply(cr,f)}function Fy(f,m,S,A,I,B,ie,ve,Le,Je,Et,Lt,gt){var wt=m.subtreeFlags;if((wt&8192||(wt&16785408)===16785408)&&(R_={stylesheets:null,count:0,unsuspend:Pee},Df(m),m=Oee(),m!==null)){f.cancelPendingCommit=m(Be.bind(null,f,S,A,I,ie,ve,Le,1,Lt,gt)),Yo(f,B,ie,!Je);return}Be(f,S,A,I,ie,ve,Le,Et,Lt,gt)}function E_(f){for(var m=f;;){var S=m.tag;if((S===0||S===11||S===15)&&m.flags&16384&&(S=m.updateQueue,S!==null&&(S=S.stores,S!==null)))for(var A=0;A<S.length;A++){var I=S[A],B=I.getSnapshot;I=I.value;try{if(!fo(B(),I))return!1}catch{return!1}}if(S=m.child,m.subtreeFlags&16384&&S!==null)S.return=m,m=S;else{if(m===f)break;for(;m.sibling===null;){if(m.return===null||m.return===f)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function Yo(f,m,S,A){m&=~fm,m&=~Uc,f.suspendedLanes|=m,f.pingedLanes&=~m,A&&(f.warmLanes|=m),A=f.expirationTimes;for(var I=m;0<I;){var B=31-Pt(I),ie=1<<B;A[B]=-1,I&=~ie}S!==0&&Dn(f,S,m)}function Of(){return(ki&6)===0?(hr(0),!1):!0}function Nc(){if(ar!==null){if(Jr===0)var f=ar.return;else f=ar,rc=Oc=null,xy(f),Vh=null,iv=0,f=ar;for(;f!==null;)M_(f.alternate,f),f=f.return;ar=null}}function Gu(f,m){f.finishedWork=null,f.finishedLanes=0;var S=f.timeoutHandle;S!==-1&&(f.timeoutHandle=-1,pee(S)),S=f.cancelPendingCommit,S!==null&&(f.cancelPendingCommit=null,S()),Nc(),qr=f,ar=S=Ha(f.current,null),Ei=m,Jr=0,Dr=null,Kn=!1,ba=Bt(f,m),ld=!1,Bc=Ga=fm=Uc=cc=yn=0,cr=yv=null,Xr=!1,(m&8)!==0&&(m|=m&32);var A=f.entangledLanes;if(A!==0)for(f=f.entanglements,A&=m;0<A;){var I=31-Pt(A),B=1<<I;m|=f[I],A&=~B}return Vu=m,Yg(),S}function cd(f,m){tr=null,R.H=Rc,m===Fh?(m=Ur(),Jr=3):m===Yb?(m=Ur(),Jr=4):Jr=m===Go?8:m!==null&&typeof m=="object"&&typeof m.then=="function"?6:1,Dr=m,ar===null&&(yn=1,Cy(f,go(m,f.current)))}function mm(){var f=R.H;return R.H=Rc,f===null?Rc:f}function ky(){var f=R.A;return R.A=Pf,f}function xv(){yn=4,Kn||(Ei&4194176)!==Ei&&vo.current!==null||(ba=!0),(cc&134217727)===0&&(Uc&134217727)===0||qr===null||Yo(qr,Ei,Ga,!1)}function Lf(f,m,S){var A=ki;ki|=2;var I=mm(),B=ky();(qr!==f||Ei!==m)&&(Vr=null,Gu(f,m)),m=!1;var ie=yn;e:do try{if(Jr!==0&&ar!==null){var ve=ar,Le=Dr;switch(Jr){case 8:Nc(),ie=6;break e;case 3:case 2:case 6:vo.current===null&&(m=!0);var Je=Jr;if(Jr=0,Dr=null,N(f,ve,Le,Je),S&&ba){ie=0;break e}break;default:Je=Jr,Jr=0,Dr=null,N(f,ve,Le,Je)}}A_(),ie=yn;break}catch(Et){cd(f,Et)}while(!0);return m&&f.shellSuspendCounter++,rc=Oc=null,ki=A,R.H=I,R.A=B,ar===null&&(qr=null,Ei=0,Yg()),ie}function A_(){for(;ar!==null;)C(ar)}function y(f,m){var S=ki;ki|=2;var A=mm(),I=ky();qr!==f||Ei!==m?(Vr=null,ur=pe()+500,Gu(f,m)):ba=Bt(f,m);e:do try{if(Jr!==0&&ar!==null){m=ar;var B=Dr;t:switch(Jr){case 1:Jr=0,Dr=null,N(f,m,B,1);break;case 2:if(lE(B)){Jr=0,Dr=null,z(m);break}m=function(){Jr===2&&qr===f&&(Jr=7),$r(f)},B.then(m,m);break e;case 3:Jr=7;break e;case 4:Jr=5;break e;case 7:lE(B)?(Jr=0,Dr=null,z(m)):(Jr=0,Dr=null,N(f,m,B,7));break;case 5:var ie=null;switch(ar.tag){case 26:ie=ar.memoizedState;case 5:case 27:var ve=ar;if(!ie||v5(ie)){Jr=0,Dr=null;var Le=ve.sibling;if(Le!==null)ar=Le;else{var Je=ve.return;Je!==null?(ar=Je,q(Je)):ar=null}break t}}Jr=0,Dr=null,N(f,m,B,5);break;case 6:Jr=0,Dr=null,N(f,m,B,6);break;case 8:Nc(),yn=6;break e;default:throw Error(r(462))}}_();break}catch(Et){cd(f,Et)}while(!0);return rc=Oc=null,R.H=A,R.A=I,ki=S,ar!==null?0:(qr=null,Ei=0,Yg(),yn)}function _(){for(;ar!==null&&!H();)C(ar)}function C(f){var m=uv(f.alternate,f,Vu);f.memoizedProps=f.pendingProps,m===null?q(f):ar=m}function z(f){var m=f,S=m.alternate;switch(m.tag){case 15:case 0:m=YE(S,m,m.pendingProps,m.type,void 0,Ei);break;case 11:m=YE(S,m,m.pendingProps,m.type.render,m.ref,Ei);break;case 5:xy(m);default:M_(S,m),m=ar=sd(m,Vu),m=uv(S,m,Vu)}f.memoizedProps=f.pendingProps,m===null?q(f):ar=m}function N(f,m,S,A){rc=Oc=null,xy(m),Vh=null,iv=0;var I=m.return;try{if(sR(f,I,m,S,Ei)){yn=1,Cy(f,go(S,f.current)),ar=null;return}}catch(B){if(I!==null)throw ar=I,B;yn=1,Cy(f,go(S,f.current)),ar=null;return}m.flags&32768?(br||A===1?f=!0:ba||(Ei&536870912)!==0?f=!1:(Kn=f=!0,(A===2||A===3||A===6)&&(A=vo.current,A!==null&&A.tag===13&&(A.flags|=16384))),ye(m,f)):q(m)}function q(f){var m=f;do{if((m.flags&32768)!==0){ye(m,Kn);return}f=m.return;var S=oR(m.alternate,m,Vu);if(S!==null){ar=S;return}if(m=m.sibling,m!==null){ar=m;return}ar=m=f}while(m!==null);yn===0&&(yn=5)}function ye(f,m){do{var S=Fn(f.alternate,f);if(S!==null){S.flags&=32767,ar=S;return}if(S=f.return,S!==null&&(S.flags|=32768,S.subtreeFlags=0,S.deletions=null),!m&&(f=f.sibling,f!==null)){ar=f;return}ar=f=S}while(f!==null);yn=6,ar=null}function Be(f,m,S,A,I,B,ie,ve,Le,Je){var Et=R.T,Lt=Q.p;try{Q.p=2,R.T=null,st(f,m,S,A,Lt,I,B,ie,ve,Le,Je)}finally{R.T=Et,Q.p=Lt}}function st(f,m,S,A,I,B,ie,ve){do Ut();while(Cl!==null);if((ki&6)!==0)throw Error(r(327));var Le=f.finishedWork;if(A=f.finishedLanes,Le===null)return null;if(f.finishedWork=null,f.finishedLanes=0,Le===f.current)throw Error(r(177));f.callbackNode=null,f.callbackPriority=0,f.cancelPendingCommit=null;var Je=Le.lanes|Le.childLanes;if(Je|=bu,Tr(f,A,Je,B,ie,ve),f===qr&&(ar=qr=null,Ei=0),(Le.subtreeFlags&10256)===0&&(Le.flags&10256)===0||Tl||(Tl=!0,uc=Je,En=S,et(je,function(){return Ut(),null})),S=(Le.flags&15990)!==0,(Le.subtreeFlags&15990)!==0||S?(S=R.T,R.T=null,B=Q.p,Q.p=2,ie=ki,ki|=4,cm(f,Le),Cf(Le,f),Hb(gR,f.containerInfo),cA=!!mR,gR=mR=null,f.current=Le,um(f,Le.alternate,Le),Z(),ki=ie,Q.p=B,R.T=S):f.current=Le,Tl?(Tl=!1,Cl=f,Rf=A):Mt(f,Je),Je=f.pendingLanes,Je===0&&(ds=null),$e(Le.stateNode),$r(f),m!==null)for(I=f.onRecoverableError,Le=0;Le<m.length;Le++)Je=m[Le],I(Je.value,{componentStack:Je.stack});return(Rf&3)!==0&&Ut(),Je=f.pendingLanes,(A&4194218)!==0&&(Je&42)!==0?f===Hu?Dl++:(Dl=0,Hu=f):Dl=0,hr(0),null}function Mt(f,m){(f.pooledCacheLanes&=m)===0&&(m=f.pooledCache,m!=null&&(f.pooledCache=null,Gh(m)))}function Ut(){if(Cl!==null){var f=Cl,m=uc;uc=0;var S=Fr(Rf),A=R.T,I=Q.p;try{if(Q.p=32>S?32:S,R.T=null,Cl===null)var B=!1;else{S=En,En=null;var ie=Cl,ve=Rf;if(Cl=null,Rf=0,(ki&6)!==0)throw Error(r(331));var Le=ki;if(ki|=4,hm(ie.current),Uu(ie,ie.current,ve,S),ki=Le,hr(0,!1),ht&&typeof ht.onPostCommitFiberRoot=="function")try{ht.onPostCommitFiberRoot(ut,ie)}catch{}B=!0}return B}finally{Q.p=I,R.T=A,Mt(f,m)}}return!1}function Xt(f,m,S){m=go(S,m),m=u_(f.stateNode,m,2),f=qo(f,m,2),f!==null&&(Oi(f,2),$r(f))}function zt(f,m,S){if(f.tag===3)Xt(f,f,S);else for(;m!==null;){if(m.tag===3){Xt(m,f,S);break}else if(m.tag===1){var A=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof A.componentDidCatch=="function"&&(ds===null||!ds.has(A))){f=go(S,f),S=h_(2),A=qo(m,S,2),A!==null&&(qE(S,A,m,f),Oi(A,2),$r(A));break}}m=m.return}}function Vi(f,m,S){var A=f.pingCache;if(A===null){A=f.pingCache=new ku;var I=new Set;A.set(m,I)}else I=A.get(m),I===void 0&&(I=new Set,A.set(m,I));I.has(S)||(ld=!0,I.add(S),f=Rl.bind(null,f,m,S),m.then(f,f))}function Rl(f,m,S){var A=f.pingCache;A!==null&&A.delete(m),f.pingedLanes|=f.suspendedLanes&S,f.warmLanes&=~S,qr===f&&(Ei&S)===S&&(yn===4||yn===3&&(Ei&62914560)===Ei&&300>pe()-ir?(ki&2)===0&&Gu(f,0):fm|=S,Bc===Ei&&(Bc=0)),$r(f)}function gm(f,m){m===0&&(m=Ft()),f=_u(f,m),f!==null&&(Oi(f,m),$r(f))}function If(f){var m=f.memoizedState,S=0;m!==null&&(S=m.retryLane),gm(f,S)}function ft(f,m){var S=0;switch(f.tag){case 13:var A=f.stateNode,I=f.memoizedState;I!==null&&(S=I.retryLane);break;case 19:A=f.stateNode;break;case 22:A=f.stateNode._retryCache;break;default:throw Error(r(314))}A!==null&&A.delete(m),gm(f,S)}function et(f,m){return We(f,m)}var vt=null,It=null,fi=!1,Yr=!1,Pi=!1,or=0;function $r(f){f!==It&&f.next===null&&(It===null?vt=It=f:It=It.next=f),Yr=!0,fi||(fi=!0,see(ud))}function hr(f,m){if(!Pi&&Yr){Pi=!0;do for(var S=!1,A=vt;A!==null;){if(f!==0){var I=A.pendingLanes;if(I===0)var B=0;else{var ie=A.suspendedLanes,ve=A.pingedLanes;B=(1<<31-Pt(42|f)+1)-1,B&=I&~(ie&~ve),B=B&201326677?B&201326677|1:B?B|2:0}B!==0&&(S=!0,ZF(A,B))}else B=Ei,B=pt(A,A===qr?B:0),(B&3)===0||Bt(A,B)||(S=!0,ZF(A,B));A=A.next}while(S);Pi=!1}}function ud(){Yr=fi=!1;var f=0;or!==0&&(fee()&&(f=or),or=0);for(var m=pe(),S=null,A=vt;A!==null;){var I=A.next,B=$E(A,m);B===0?(A.next=null,S===null?vt=I:S.next=I,I===null&&(It=S)):(S=A,(f!==0||(B&3)!==0)&&(Yr=!0)),A=I}hr(f)}function $E(f,m){for(var S=f.suspendedLanes,A=f.pingedLanes,I=f.expirationTimes,B=f.pendingLanes&-62914561;0<B;){var ie=31-Pt(B),ve=1<<ie,Le=I[ie];Le===-1?((ve&S)===0||(ve&A)!==0)&&(I[ie]=Jt(ve,m)):Le<=m&&(f.expiredLanes|=ve),B&=~ve}if(m=qr,S=Ei,S=pt(f,f===m?S:0),A=f.callbackNode,S===0||f===m&&Jr===2||f.cancelPendingCommit!==null)return A!==null&&A!==null&&se(A),f.callbackNode=null,f.callbackPriority=0;if((S&3)===0||Bt(f,S)){if(m=S&-S,m===f.callbackPriority)return m;switch(A!==null&&se(A),Fr(S)){case 2:case 8:S=He;break;case 32:S=je;break;case 268435456:S=Ve;break;default:S=je}return A=QF.bind(null,f),S=We(S,A),f.callbackPriority=m,f.callbackNode=S,m}return A!==null&&A!==null&&se(A),f.callbackPriority=2,f.callbackNode=null,2}function QF(f,m){var S=f.callbackNode;if(Ut()&&f.callbackNode!==S)return null;var A=Ei;return A=pt(f,f===qr?A:0),A===0?null:(pm(f,A,m),$E(f,pe()),f.callbackNode!=null&&f.callbackNode===S?QF.bind(null,f):null)}function ZF(f,m){if(Ut())return null;pm(f,m,!0)}function see(f){mee(function(){(ki&6)!==0?We(J,f):f()})}function lR(){return or===0&&(or=qt()),or}function KF(f){return f==null||typeof f=="symbol"||typeof f=="boolean"?null:typeof f=="function"?f:pl(""+f)}function JF(f,m){var S=m.ownerDocument.createElement("input");return S.name=m.name,S.value=m.value,f.id&&S.setAttribute("form",f.id),m.parentNode.insertBefore(S,m),f=new FormData(f),S.parentNode.removeChild(S),f}function aee(f,m,S,A,I){if(m==="submit"&&S&&S.stateNode===I){var B=KF((I[it]||null).action),ie=A.submitter;ie&&(m=(m=ie[it]||null)?KF(m.formAction):ie.getAttribute("formAction"),m!==null&&(B=m,ie=null));var ve=new Ba("action","action",null,A,I);f.push({event:ve,listeners:[{instance:null,listener:function(){if(A.defaultPrevented){if(or!==0){var Le=ie?JF(I,ie):new FormData(I);s_(S,{pending:!0,data:Le,method:I.method,action:B},null,Le)}}else typeof B=="function"&&(ve.preventDefault(),Le=ie?JF(I,ie):new FormData(I),s_(S,{pending:!0,data:Le,method:I.method,action:B},B,Le))},currentTarget:I}]})}}for(var cR=0;cR<xu.length;cR++){var uR=xu[cR],oee=uR.toLowerCase(),lee=uR[0].toUpperCase()+uR.slice(1);xl(oee,"on"+lee)}xl(Wb,"onAnimationEnd"),xl(mo,"onAnimationIteration"),xl(qb,"onAnimationStart"),xl("dblclick","onDoubleClick"),xl("focusin","onFocus"),xl("focusout","onBlur"),xl(yu,"onTransitionRun"),xl(Yp,"onTransitionStart"),xl(zh,"onTransitionCancel"),xl(dy,"onTransitionEnd"),Nt("onMouseEnter",["mouseout","mouseover"]),Nt("onMouseLeave",["mouseout","mouseover"]),Nt("onPointerEnter",["pointerout","pointerover"]),Nt("onPointerLeave",["pointerout","pointerover"]),xt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),xt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),xt("onBeforeInput",["compositionend","keypress","textInput","paste"]),xt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),xt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),xt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var T_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),cee=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(T_));function $F(f,m){m=(m&4)!==0;for(var S=0;S<f.length;S++){var A=f[S],I=A.event;A=A.listeners;e:{var B=void 0;if(m)for(var ie=A.length-1;0<=ie;ie--){var ve=A[ie],Le=ve.instance,Je=ve.currentTarget;if(ve=ve.listener,Le!==B&&I.isPropagationStopped())break e;B=ve,I.currentTarget=Je;try{B(I)}catch(Et){Ty(Et)}I.currentTarget=null,B=Le}else for(ie=0;ie<A.length;ie++){if(ve=A[ie],Le=ve.instance,Je=ve.currentTarget,ve=ve.listener,Le!==B&&I.isPropagationStopped())break e;B=ve,I.currentTarget=Je;try{B(I)}catch(Et){Ty(Et)}I.currentTarget=null,B=Le}}}}function Sr(f,m){var S=m[oi];S===void 0&&(S=m[oi]=new Set);var A=f+"__bubble";S.has(A)||(e5(m,f,2,!1),S.add(A))}function hR(f,m,S){var A=0;m&&(A|=4),e5(S,f,A,m)}var eA="_reactListening"+Math.random().toString(36).slice(2);function dR(f){if(!f[eA]){f[eA]=!0,Fe.forEach(function(S){S!=="selectionchange"&&(cee.has(S)||hR(S,!1,f),hR(S,!0,f))});var m=f.nodeType===9?f:f.ownerDocument;m===null||m[eA]||(m[eA]=!0,hR("selectionchange",!1,m))}}function e5(f,m,S,A){switch(w5(m)){case 2:var I=zee;break;case 8:I=Uee;break;default:I=ER}S=I.bind(null,m,S,f),I=void 0,!cu||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||(I=!0),A?I!==void 0?f.addEventListener(m,S,{capture:!0,passive:I}):f.addEventListener(m,S,!0):I!==void 0?f.addEventListener(m,S,{passive:I}):f.addEventListener(m,S,!1)}function fR(f,m,S,A,I){var B=A;if((m&1)===0&&(m&2)===0&&A!==null)e:for(;;){if(A===null)return;var ie=A.tag;if(ie===3||ie===4){var ve=A.stateNode.containerInfo;if(ve===I||ve.nodeType===8&&ve.parentNode===I)break;if(ie===4)for(ie=A.return;ie!==null;){var Le=ie.tag;if((Le===3||Le===4)&&(Le=ie.stateNode.containerInfo,Le===I||Le.nodeType===8&&Le.parentNode===I))return;ie=ie.return}for(;ve!==null;){if(ie=hi(ve),ie===null)return;if(Le=ie.tag,Le===5||Le===6||Le===26||Le===27){A=B=ie;continue e}ve=ve.parentNode}}A=A.return}Vp(function(){var Je=B,Et=Jl(S),Lt=[];e:{var gt=fy.get(f);if(gt!==void 0){var wt=Ba,pi=f;switch(f){case"keypress":if(ml(S)===0)break e;case"keydown":case"keyup":wt=Ob;break;case"focusin":pi="focus",wt=pu;break;case"focusout":pi="blur",wt=pu;break;case"beforeblur":case"afterblur":wt=pu;break;case"click":if(S.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":wt=uf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":wt=Pb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":wt=Ib;break;case Wb:case mo:case qb:wt=ry;break;case dy:wt=mu;break;case"scroll":case"scrollend":wt=Gp;break;case"wheel":wt=ZP;break;case"copy":case"cut":case"paste":wt=uo;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":wt=ny;break;case"toggle":case"beforetoggle":wt=Rh}var qi=(m&4)!==0,ps=!qi&&(f==="scroll"||f==="scrollend"),nt=qi?gt!==null?gt+"Capture":null:gt;qi=[];for(var Ze=Je,dt;Ze!==null;){var Rt=Ze;if(dt=Rt.stateNode,Rt=Rt.tag,Rt!==5&&Rt!==26&&Rt!==27||dt===null||nt===null||(Rt=$l(Ze,nt),Rt!=null&&qi.push(C_(Ze,Rt,dt))),ps)break;Ze=Ze.return}0<qi.length&&(gt=new wt(gt,pi,null,S,Et),Lt.push({event:gt,listeners:qi}))}}if((m&7)===0){e:{if(gt=f==="mouseover"||f==="pointerover",wt=f==="mouseout"||f==="pointerout",gt&&S!==Kl&&(pi=S.relatedTarget||S.fromElement)&&(hi(pi)||pi[Gt]))break e;if((wt||gt)&&(gt=Et.window===Et?Et:(gt=Et.ownerDocument)?gt.defaultView||gt.parentWindow:window,wt?(pi=S.relatedTarget||S.toElement,wt=Je,pi=pi?hi(pi):null,pi!==null&&(ps=Y(pi),qi=pi.tag,pi!==ps||qi!==5&&qi!==27&&qi!==6)&&(pi=null)):(wt=null,pi=Je),wt!==pi)){if(qi=uf,Rt="onMouseLeave",nt="onMouseEnter",Ze="mouse",(f==="pointerout"||f==="pointerover")&&(qi=ny,Rt="onPointerLeave",nt="onPointerEnter",Ze="pointer"),ps=wt==null?gt:ke(wt),dt=pi==null?gt:ke(pi),gt=new qi(Rt,Ze+"leave",wt,S,Et),gt.target=ps,gt.relatedTarget=dt,Rt=null,hi(Et)===Je&&(qi=new qi(nt,Ze+"enter",pi,S,Et),qi.target=dt,qi.relatedTarget=ps,Rt=qi),ps=Rt,wt&&pi)t:{for(qi=wt,nt=pi,Ze=0,dt=qi;dt;dt=Vy(dt))Ze++;for(dt=0,Rt=nt;Rt;Rt=Vy(Rt))dt++;for(;0<Ze-dt;)qi=Vy(qi),Ze--;for(;0<dt-Ze;)nt=Vy(nt),dt--;for(;Ze--;){if(qi===nt||nt!==null&&qi===nt.alternate)break t;qi=Vy(qi),nt=Vy(nt)}qi=null}else qi=null;wt!==null&&t5(Lt,gt,wt,qi,!1),pi!==null&&ps!==null&&t5(Lt,ps,pi,qi,!0)}}e:{if(gt=Je?ke(Je):window,wt=gt.nodeName&&gt.nodeName.toLowerCase(),wt==="select"||wt==="input"&&gt.type==="file")var si=ay;else if(Nb(gt))if(oy)si=Ih;else{si=nE;var dr=KP}else wt=gt.nodeName,!wt||wt.toLowerCase()!=="input"||gt.type!=="checkbox"&&gt.type!=="radio"?Je&&Zl(Je.elementType)&&(si=ay):si=qg;if(si&&(si=si(f,Je))){ho(Lt,si,S,Et);break e}dr&&dr(f,gt,Je),f==="focusout"&&Je&&gt.type==="number"&&Je.memoizedProps.value!=null&&Rn(gt,"number",gt.value)}switch(dr=Je?ke(Je):window,f){case"focusin":(Nb(dr)||dr.contentEditable==="true")&&(ff=dr,Gb=Je,Xp=null);break;case"focusout":Xp=Gb=ff=null;break;case"mousedown":uy=!0;break;case"contextmenu":case"mouseup":case"dragend":uy=!1,yl(Lt,S,Et);break;case"selectionchange":if(cy)break;case"keydown":case"keyup":yl(Lt,S,Et)}var vi;if(kg)e:{switch(f){case"compositionstart":var zi="onCompositionStart";break e;case"compositionend":zi="onCompositionEnd";break e;case"compositionupdate":zi="onCompositionUpdate";break e}zi=void 0}else Lh?Gg(f,S)&&(zi="onCompositionEnd"):f==="keydown"&&S.keyCode===229&&(zi="onCompositionStart");zi&&(Hg&&S.locale!=="ko"&&(Lh||zi!=="onCompositionStart"?zi==="onCompositionEnd"&&Lh&&(vi=Hp()):(Hn=Et,lf="value"in Hn?Hn.value:Hn.textContent,Lh=!0)),dr=tA(Je,zi),0<dr.length&&(zi=new ko(zi,f,null,S,Et),Lt.push({event:zi,listeners:dr}),vi?zi.data=vi:(vi=Ub(S),vi!==null&&(zi.data=vi)))),(vi=Vg?jg(f,S):Bb(f,S))&&(zi=tA(Je,"onBeforeInput"),0<zi.length&&(dr=new ko("onBeforeInput","beforeinput",null,S,Et),Lt.push({event:dr,listeners:zi}),dr.data=vi)),aee(Lt,f,Je,S,Et)}$F(Lt,m)})}function C_(f,m,S){return{instance:f,listener:m,currentTarget:S}}function tA(f,m){for(var S=m+"Capture",A=[];f!==null;){var I=f,B=I.stateNode;I=I.tag,I!==5&&I!==26&&I!==27||B===null||(I=$l(f,S),I!=null&&A.unshift(C_(f,I,B)),I=$l(f,m),I!=null&&A.push(C_(f,I,B))),f=f.return}return A}function Vy(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5&&f.tag!==27);return f||null}function t5(f,m,S,A,I){for(var B=m._reactName,ie=[];S!==null&&S!==A;){var ve=S,Le=ve.alternate,Je=ve.stateNode;if(ve=ve.tag,Le!==null&&Le===A)break;ve!==5&&ve!==26&&ve!==27||Je===null||(Le=Je,I?(Je=$l(S,B),Je!=null&&ie.unshift(C_(S,Je,Le))):I||(Je=$l(S,B),Je!=null&&ie.push(C_(S,Je,Le)))),S=S.return}ie.length!==0&&f.push({event:m,listeners:ie})}var uee=/\r\n?/g,hee=/\u0000|\uFFFD/g;function i5(f){return(typeof f=="string"?f:""+f).replace(uee,`
`).replace(hee,"")}function r5(f,m){return m=i5(m),i5(f)===m}function iA(){}function cn(f,m,S,A,I,B){switch(S){case"children":typeof A=="string"?m==="body"||m==="textarea"&&A===""||_s(f,A):(typeof A=="number"||typeof A=="bigint")&&m!=="body"&&_s(f,""+A);break;case"className":me(f,"class",A);break;case"tabIndex":me(f,"tabindex",A);break;case"dir":case"role":case"viewBox":case"width":case"height":me(f,S,A);break;case"style":af(f,A,B);break;case"data":if(m!=="object"){me(f,"data",A);break}case"src":case"href":if(A===""&&(m!=="a"||S!=="href")){f.removeAttribute(S);break}if(A==null||typeof A=="function"||typeof A=="symbol"||typeof A=="boolean"){f.removeAttribute(S);break}A=pl(""+A),f.setAttribute(S,A);break;case"action":case"formAction":if(typeof A=="function"){f.setAttribute(S,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof B=="function"&&(S==="formAction"?(m!=="input"&&cn(f,m,"name",I.name,I,null),cn(f,m,"formEncType",I.formEncType,I,null),cn(f,m,"formMethod",I.formMethod,I,null),cn(f,m,"formTarget",I.formTarget,I,null)):(cn(f,m,"encType",I.encType,I,null),cn(f,m,"method",I.method,I,null),cn(f,m,"target",I.target,I,null)));if(A==null||typeof A=="symbol"||typeof A=="boolean"){f.removeAttribute(S);break}A=pl(""+A),f.setAttribute(S,A);break;case"onClick":A!=null&&(f.onclick=iA);break;case"onScroll":A!=null&&Sr("scroll",f);break;case"onScrollEnd":A!=null&&Sr("scrollend",f);break;case"dangerouslySetInnerHTML":if(A!=null){if(typeof A!="object"||!("__html"in A))throw Error(r(61));if(S=A.__html,S!=null){if(I.children!=null)throw Error(r(60));f.innerHTML=S}}break;case"multiple":f.multiple=A&&typeof A!="function"&&typeof A!="symbol";break;case"muted":f.muted=A&&typeof A!="function"&&typeof A!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(A==null||typeof A=="function"||typeof A=="boolean"||typeof A=="symbol"){f.removeAttribute("xlink:href");break}S=pl(""+A),f.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",S);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":A!=null&&typeof A!="function"&&typeof A!="symbol"?f.setAttribute(S,""+A):f.removeAttribute(S);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":A&&typeof A!="function"&&typeof A!="symbol"?f.setAttribute(S,""):f.removeAttribute(S);break;case"capture":case"download":A===!0?f.setAttribute(S,""):A!==!1&&A!=null&&typeof A!="function"&&typeof A!="symbol"?f.setAttribute(S,A):f.removeAttribute(S);break;case"cols":case"rows":case"size":case"span":A!=null&&typeof A!="function"&&typeof A!="symbol"&&!isNaN(A)&&1<=A?f.setAttribute(S,A):f.removeAttribute(S);break;case"rowSpan":case"start":A==null||typeof A=="function"||typeof A=="symbol"||isNaN(A)?f.removeAttribute(S):f.setAttribute(S,A);break;case"popover":Sr("beforetoggle",f),Sr("toggle",f),Ae(f,"popover",A);break;case"xlinkActuate":Ne(f,"http://www.w3.org/1999/xlink","xlink:actuate",A);break;case"xlinkArcrole":Ne(f,"http://www.w3.org/1999/xlink","xlink:arcrole",A);break;case"xlinkRole":Ne(f,"http://www.w3.org/1999/xlink","xlink:role",A);break;case"xlinkShow":Ne(f,"http://www.w3.org/1999/xlink","xlink:show",A);break;case"xlinkTitle":Ne(f,"http://www.w3.org/1999/xlink","xlink:title",A);break;case"xlinkType":Ne(f,"http://www.w3.org/1999/xlink","xlink:type",A);break;case"xmlBase":Ne(f,"http://www.w3.org/XML/1998/namespace","xml:base",A);break;case"xmlLang":Ne(f,"http://www.w3.org/XML/1998/namespace","xml:lang",A);break;case"xmlSpace":Ne(f,"http://www.w3.org/XML/1998/namespace","xml:space",A);break;case"is":Ae(f,"is",A);break;case"innerText":case"textContent":break;default:(!(2<S.length)||S[0]!=="o"&&S[0]!=="O"||S[1]!=="n"&&S[1]!=="N")&&(S=Ug.get(S)||S,Ae(f,S,A))}}function pR(f,m,S,A,I,B){switch(S){case"style":af(f,A,B);break;case"dangerouslySetInnerHTML":if(A!=null){if(typeof A!="object"||!("__html"in A))throw Error(r(61));if(S=A.__html,S!=null){if(I.children!=null)throw Error(r(60));f.innerHTML=S}}break;case"children":typeof A=="string"?_s(f,A):(typeof A=="number"||typeof A=="bigint")&&_s(f,""+A);break;case"onScroll":A!=null&&Sr("scroll",f);break;case"onScrollEnd":A!=null&&Sr("scrollend",f);break;case"onClick":A!=null&&(f.onclick=iA);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Dt.hasOwnProperty(S))e:{if(S[0]==="o"&&S[1]==="n"&&(I=S.endsWith("Capture"),m=S.slice(2,I?S.length-7:void 0),B=f[it]||null,B=B!=null?B[S]:null,typeof B=="function"&&f.removeEventListener(m,B,I),typeof A=="function")){typeof B!="function"&&B!==null&&(S in f?f[S]=null:f.hasAttribute(S)&&f.removeAttribute(S)),f.addEventListener(m,A,I);break e}S in f?f[S]=A:A===!0?f.setAttribute(S,""):Ae(f,S,A)}}}function Wa(f,m,S){switch(m){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Sr("error",f),Sr("load",f);var A=!1,I=!1,B;for(B in S)if(S.hasOwnProperty(B)){var ie=S[B];if(ie!=null)switch(B){case"src":A=!0;break;case"srcSet":I=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,m));default:cn(f,m,B,ie,S,null)}}I&&cn(f,m,"srcSet",S.srcSet,S,null),A&&cn(f,m,"src",S.src,S,null);return;case"input":Sr("invalid",f);var ve=B=ie=I=null,Le=null,Je=null;for(A in S)if(S.hasOwnProperty(A)){var Et=S[A];if(Et!=null)switch(A){case"name":I=Et;break;case"type":ie=Et;break;case"checked":Le=Et;break;case"defaultChecked":Je=Et;break;case"value":B=Et;break;case"defaultValue":ve=Et;break;case"children":case"dangerouslySetInnerHTML":if(Et!=null)throw Error(r(137,m));break;default:cn(f,m,A,Et,S,null)}}Vn(f,B,ve,Le,Je,ie,I,!1),Li(f);return;case"select":Sr("invalid",f),A=ie=B=null;for(I in S)if(S.hasOwnProperty(I)&&(ve=S[I],ve!=null))switch(I){case"value":B=ve;break;case"defaultValue":ie=ve;break;case"multiple":A=ve;default:cn(f,m,I,ve,S,null)}m=B,S=ie,f.multiple=!!A,m!=null?mn(f,!!A,m,!1):S!=null&&mn(f,!!A,S,!0);return;case"textarea":Sr("invalid",f),B=I=A=null;for(ie in S)if(S.hasOwnProperty(ie)&&(ve=S[ie],ve!=null))switch(ie){case"value":A=ve;break;case"defaultValue":I=ve;break;case"children":B=ve;break;case"dangerouslySetInnerHTML":if(ve!=null)throw Error(r(91));break;default:cn(f,m,ie,ve,S,null)}ha(f,A,I,B),Li(f);return;case"option":for(Le in S)if(S.hasOwnProperty(Le)&&(A=S[Le],A!=null))switch(Le){case"selected":f.selected=A&&typeof A!="function"&&typeof A!="symbol";break;default:cn(f,m,Le,A,S,null)}return;case"dialog":Sr("cancel",f),Sr("close",f);break;case"iframe":case"object":Sr("load",f);break;case"video":case"audio":for(A=0;A<T_.length;A++)Sr(T_[A],f);break;case"image":Sr("error",f),Sr("load",f);break;case"details":Sr("toggle",f);break;case"embed":case"source":case"link":Sr("error",f),Sr("load",f);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Je in S)if(S.hasOwnProperty(Je)&&(A=S[Je],A!=null))switch(Je){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,m));default:cn(f,m,Je,A,S,null)}return;default:if(Zl(m)){for(Et in S)S.hasOwnProperty(Et)&&(A=S[Et],A!==void 0&&pR(f,m,Et,A,S,void 0));return}}for(ve in S)S.hasOwnProperty(ve)&&(A=S[ve],A!=null&&cn(f,m,ve,A,S,null))}function dee(f,m,S,A){switch(m){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var I=null,B=null,ie=null,ve=null,Le=null,Je=null,Et=null;for(wt in S){var Lt=S[wt];if(S.hasOwnProperty(wt)&&Lt!=null)switch(wt){case"checked":break;case"value":break;case"defaultValue":Le=Lt;default:A.hasOwnProperty(wt)||cn(f,m,wt,null,A,Lt)}}for(var gt in A){var wt=A[gt];if(Lt=S[gt],A.hasOwnProperty(gt)&&(wt!=null||Lt!=null))switch(gt){case"type":B=wt;break;case"name":I=wt;break;case"checked":Je=wt;break;case"defaultChecked":Et=wt;break;case"value":ie=wt;break;case"defaultValue":ve=wt;break;case"children":case"dangerouslySetInnerHTML":if(wt!=null)throw Error(r(137,m));break;default:wt!==Lt&&cn(f,m,gt,wt,A,Lt)}}Or(f,ie,ve,Le,Je,Et,B,I);return;case"select":wt=ie=ve=gt=null;for(B in S)if(Le=S[B],S.hasOwnProperty(B)&&Le!=null)switch(B){case"value":break;case"multiple":wt=Le;default:A.hasOwnProperty(B)||cn(f,m,B,null,A,Le)}for(I in A)if(B=A[I],Le=S[I],A.hasOwnProperty(I)&&(B!=null||Le!=null))switch(I){case"value":gt=B;break;case"defaultValue":ve=B;break;case"multiple":ie=B;default:B!==Le&&cn(f,m,I,B,A,Le)}m=ve,S=ie,A=wt,gt!=null?mn(f,!!S,gt,!1):!!A!=!!S&&(m!=null?mn(f,!!S,m,!0):mn(f,!!S,S?[]:"",!1));return;case"textarea":wt=gt=null;for(ve in S)if(I=S[ve],S.hasOwnProperty(ve)&&I!=null&&!A.hasOwnProperty(ve))switch(ve){case"value":break;case"children":break;default:cn(f,m,ve,null,A,I)}for(ie in A)if(I=A[ie],B=S[ie],A.hasOwnProperty(ie)&&(I!=null||B!=null))switch(ie){case"value":gt=I;break;case"defaultValue":wt=I;break;case"children":break;case"dangerouslySetInnerHTML":if(I!=null)throw Error(r(91));break;default:I!==B&&cn(f,m,ie,I,A,B)}On(f,gt,wt);return;case"option":for(var pi in S)if(gt=S[pi],S.hasOwnProperty(pi)&&gt!=null&&!A.hasOwnProperty(pi))switch(pi){case"selected":f.selected=!1;break;default:cn(f,m,pi,null,A,gt)}for(Le in A)if(gt=A[Le],wt=S[Le],A.hasOwnProperty(Le)&&gt!==wt&&(gt!=null||wt!=null))switch(Le){case"selected":f.selected=gt&&typeof gt!="function"&&typeof gt!="symbol";break;default:cn(f,m,Le,gt,A,wt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var qi in S)gt=S[qi],S.hasOwnProperty(qi)&&gt!=null&&!A.hasOwnProperty(qi)&&cn(f,m,qi,null,A,gt);for(Je in A)if(gt=A[Je],wt=S[Je],A.hasOwnProperty(Je)&&gt!==wt&&(gt!=null||wt!=null))switch(Je){case"children":case"dangerouslySetInnerHTML":if(gt!=null)throw Error(r(137,m));break;default:cn(f,m,Je,gt,A,wt)}return;default:if(Zl(m)){for(var ps in S)gt=S[ps],S.hasOwnProperty(ps)&&gt!==void 0&&!A.hasOwnProperty(ps)&&pR(f,m,ps,void 0,A,gt);for(Et in A)gt=A[Et],wt=S[Et],!A.hasOwnProperty(Et)||gt===wt||gt===void 0&&wt===void 0||pR(f,m,Et,gt,A,wt);return}}for(var nt in S)gt=S[nt],S.hasOwnProperty(nt)&&gt!=null&&!A.hasOwnProperty(nt)&&cn(f,m,nt,null,A,gt);for(Lt in A)gt=A[Lt],wt=S[Lt],!A.hasOwnProperty(Lt)||gt===wt||gt==null&&wt==null||cn(f,m,Lt,gt,A,wt)}var mR=null,gR=null;function rA(f){return f.nodeType===9?f:f.ownerDocument}function n5(f){switch(f){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function s5(f,m){if(f===0)switch(m){case"svg":return 1;case"math":return 2;default:return 0}return f===1&&m==="foreignObject"?0:f}function vR(f,m){return f==="textarea"||f==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.children=="bigint"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var yR=null;function fee(){var f=window.event;return f&&f.type==="popstate"?f===yR?!1:(yR=f,!0):(yR=null,!1)}var a5=typeof setTimeout=="function"?setTimeout:void 0,pee=typeof clearTimeout=="function"?clearTimeout:void 0,o5=typeof Promise=="function"?Promise:void 0,mee=typeof queueMicrotask=="function"?queueMicrotask:typeof o5<"u"?function(f){return o5.resolve(null).then(f).catch(gee)}:a5;function gee(f){setTimeout(function(){throw f})}function xR(f,m){var S=m,A=0;do{var I=S.nextSibling;if(f.removeChild(S),I&&I.nodeType===8)if(S=I.data,S==="/$"){if(A===0){f.removeChild(I),U_(m);return}A--}else S!=="$"&&S!=="$?"&&S!=="$!"||A++;S=I}while(S);U_(m)}function bR(f){var m=f.firstChild;for(m&&m.nodeType===10&&(m=m.nextSibling);m;){var S=m;switch(m=m.nextSibling,S.nodeName){case"HTML":case"HEAD":case"BODY":bR(S),Mi(S);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(S.rel.toLowerCase()==="stylesheet")continue}f.removeChild(S)}}function vee(f,m,S,A){for(;f.nodeType===1;){var I=S;if(f.nodeName.toLowerCase()!==m.toLowerCase()){if(!A&&(f.nodeName!=="INPUT"||f.type!=="hidden"))break}else if(A){if(!f[mi])switch(m){case"meta":if(!f.hasAttribute("itemprop"))break;return f;case"link":if(B=f.getAttribute("rel"),B==="stylesheet"&&f.hasAttribute("data-precedence"))break;if(B!==I.rel||f.getAttribute("href")!==(I.href==null?null:I.href)||f.getAttribute("crossorigin")!==(I.crossOrigin==null?null:I.crossOrigin)||f.getAttribute("title")!==(I.title==null?null:I.title))break;return f;case"style":if(f.hasAttribute("data-precedence"))break;return f;case"script":if(B=f.getAttribute("src"),(B!==(I.src==null?null:I.src)||f.getAttribute("type")!==(I.type==null?null:I.type)||f.getAttribute("crossorigin")!==(I.crossOrigin==null?null:I.crossOrigin))&&B&&f.hasAttribute("async")&&!f.hasAttribute("itemprop"))break;return f;default:return f}}else if(m==="input"&&f.type==="hidden"){var B=I.name==null?null:""+I.name;if(I.type==="hidden"&&f.getAttribute("name")===B)return f}else return f;if(f=ju(f.nextSibling),f===null)break}return null}function yee(f,m,S){if(m==="")return null;for(;f.nodeType!==3;)if((f.nodeType!==1||f.nodeName!=="INPUT"||f.type!=="hidden")&&!S||(f=ju(f.nextSibling),f===null))return null;return f}function ju(f){for(;f!=null;f=f.nextSibling){var m=f.nodeType;if(m===1||m===3)break;if(m===8){if(m=f.data,m==="$"||m==="$!"||m==="$?"||m==="F!"||m==="F")break;if(m==="/$")return null}}return f}function l5(f){f=f.previousSibling;for(var m=0;f;){if(f.nodeType===8){var S=f.data;if(S==="$"||S==="$!"||S==="$?"){if(m===0)return f;m--}else S==="/$"&&m++}f=f.previousSibling}return null}function c5(f,m,S){switch(m=rA(S),f){case"html":if(f=m.documentElement,!f)throw Error(r(452));return f;case"head":if(f=m.head,!f)throw Error(r(453));return f;case"body":if(f=m.body,!f)throw Error(r(454));return f;default:throw Error(r(451))}}var Fc=new Map,u5=new Set;function nA(f){return typeof f.getRootNode=="function"?f.getRootNode():f.ownerDocument}var zf=Q.d;Q.d={f:xee,r:bee,D:_ee,C:See,L:wee,m:Mee,X:Aee,S:Eee,M:Tee};function xee(){var f=zf.f(),m=Of();return f||m}function bee(f){var m=de(f);m!==null&&m.tag===5&&m.type==="form"?IE(m):zf.r(f)}var Hy=typeof document>"u"?null:document;function h5(f,m,S){var A=Hy;if(A&&typeof m=="string"&&m){var I=zr(m);I='link[rel="'+f+'"][href="'+I+'"]',typeof S=="string"&&(I+='[crossorigin="'+S+'"]'),u5.has(I)||(u5.add(I),f={rel:f,crossOrigin:S,href:m},A.querySelector(I)===null&&(m=A.createElement("link"),Wa(m,"link",f),Ie(m),A.head.appendChild(m)))}}function _ee(f){zf.D(f),h5("dns-prefetch",f,null)}function See(f,m){zf.C(f,m),h5("preconnect",f,m)}function wee(f,m,S){zf.L(f,m,S);var A=Hy;if(A&&f&&m){var I='link[rel="preload"][as="'+zr(m)+'"]';m==="image"&&S&&S.imageSrcSet?(I+='[imagesrcset="'+zr(S.imageSrcSet)+'"]',typeof S.imageSizes=="string"&&(I+='[imagesizes="'+zr(S.imageSizes)+'"]')):I+='[href="'+zr(f)+'"]';var B=I;switch(m){case"style":B=Gy(f);break;case"script":B=jy(f)}Fc.has(B)||(f=O({rel:"preload",href:m==="image"&&S&&S.imageSrcSet?void 0:f,as:m},S),Fc.set(B,f),A.querySelector(I)!==null||m==="style"&&A.querySelector(D_(B))||m==="script"&&A.querySelector(P_(B))||(m=A.createElement("link"),Wa(m,"link",f),Ie(m),A.head.appendChild(m)))}}function Mee(f,m){zf.m(f,m);var S=Hy;if(S&&f){var A=m&&typeof m.as=="string"?m.as:"script",I='link[rel="modulepreload"][as="'+zr(A)+'"][href="'+zr(f)+'"]',B=I;switch(A){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":B=jy(f)}if(!Fc.has(B)&&(f=O({rel:"modulepreload",href:f},m),Fc.set(B,f),S.querySelector(I)===null)){switch(A){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(S.querySelector(P_(B)))return}A=S.createElement("link"),Wa(A,"link",f),Ie(A),S.head.appendChild(A)}}}function Eee(f,m,S){zf.S(f,m,S);var A=Hy;if(A&&f){var I=rt(A).hoistableStyles,B=Gy(f);m=m||"default";var ie=I.get(B);if(!ie){var ve={loading:0,preload:null};if(ie=A.querySelector(D_(B)))ve.loading=5;else{f=O({rel:"stylesheet",href:f,"data-precedence":m},S),(S=Fc.get(B))&&_R(f,S);var Le=ie=A.createElement("link");Ie(Le),Wa(Le,"link",f),Le._p=new Promise(function(Je,Et){Le.onload=Je,Le.onerror=Et}),Le.addEventListener("load",function(){ve.loading|=1}),Le.addEventListener("error",function(){ve.loading|=2}),ve.loading|=4,sA(ie,m,A)}ie={type:"stylesheet",instance:ie,count:1,state:ve},I.set(B,ie)}}}function Aee(f,m){zf.X(f,m);var S=Hy;if(S&&f){var A=rt(S).hoistableScripts,I=jy(f),B=A.get(I);B||(B=S.querySelector(P_(I)),B||(f=O({src:f,async:!0},m),(m=Fc.get(I))&&SR(f,m),B=S.createElement("script"),Ie(B),Wa(B,"link",f),S.head.appendChild(B)),B={type:"script",instance:B,count:1,state:null},A.set(I,B))}}function Tee(f,m){zf.M(f,m);var S=Hy;if(S&&f){var A=rt(S).hoistableScripts,I=jy(f),B=A.get(I);B||(B=S.querySelector(P_(I)),B||(f=O({src:f,async:!0,type:"module"},m),(m=Fc.get(I))&&SR(f,m),B=S.createElement("script"),Ie(B),Wa(B,"link",f),S.head.appendChild(B)),B={type:"script",instance:B,count:1,state:null},A.set(I,B))}}function d5(f,m,S,A){var I=(I=Te.current)?nA(I):null;if(!I)throw Error(r(446));switch(f){case"meta":case"title":return null;case"style":return typeof S.precedence=="string"&&typeof S.href=="string"?(m=Gy(S.href),S=rt(I).hoistableStyles,A=S.get(m),A||(A={type:"style",instance:null,count:0,state:null},S.set(m,A)),A):{type:"void",instance:null,count:0,state:null};case"link":if(S.rel==="stylesheet"&&typeof S.href=="string"&&typeof S.precedence=="string"){f=Gy(S.href);var B=rt(I).hoistableStyles,ie=B.get(f);if(ie||(I=I.ownerDocument||I,ie={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},B.set(f,ie),(B=I.querySelector(D_(f)))&&!B._p&&(ie.instance=B,ie.state.loading=5),Fc.has(f)||(S={rel:"preload",as:"style",href:S.href,crossOrigin:S.crossOrigin,integrity:S.integrity,media:S.media,hrefLang:S.hrefLang,referrerPolicy:S.referrerPolicy},Fc.set(f,S),B||Cee(I,f,S,ie.state))),m&&A===null)throw Error(r(528,""));return ie}if(m&&A!==null)throw Error(r(529,""));return null;case"script":return m=S.async,S=S.src,typeof S=="string"&&m&&typeof m!="function"&&typeof m!="symbol"?(m=jy(S),S=rt(I).hoistableScripts,A=S.get(m),A||(A={type:"script",instance:null,count:0,state:null},S.set(m,A)),A):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,f))}}function Gy(f){return'href="'+zr(f)+'"'}function D_(f){return'link[rel="stylesheet"]['+f+"]"}function f5(f){return O({},f,{"data-precedence":f.precedence,precedence:null})}function Cee(f,m,S,A){f.querySelector('link[rel="preload"][as="style"]['+m+"]")?A.loading=1:(m=f.createElement("link"),A.preload=m,m.addEventListener("load",function(){return A.loading|=1}),m.addEventListener("error",function(){return A.loading|=2}),Wa(m,"link",S),Ie(m),f.head.appendChild(m))}function jy(f){return'[src="'+zr(f)+'"]'}function P_(f){return"script[async]"+f}function p5(f,m,S){if(m.count++,m.instance===null)switch(m.type){case"style":var A=f.querySelector('style[data-href~="'+zr(S.href)+'"]');if(A)return m.instance=A,Ie(A),A;var I=O({},S,{"data-href":S.href,"data-precedence":S.precedence,href:null,precedence:null});return A=(f.ownerDocument||f).createElement("style"),Ie(A),Wa(A,"style",I),sA(A,S.precedence,f),m.instance=A;case"stylesheet":I=Gy(S.href);var B=f.querySelector(D_(I));if(B)return m.state.loading|=4,m.instance=B,Ie(B),B;A=f5(S),(I=Fc.get(I))&&_R(A,I),B=(f.ownerDocument||f).createElement("link"),Ie(B);var ie=B;return ie._p=new Promise(function(ve,Le){ie.onload=ve,ie.onerror=Le}),Wa(B,"link",A),m.state.loading|=4,sA(B,S.precedence,f),m.instance=B;case"script":return B=jy(S.src),(I=f.querySelector(P_(B)))?(m.instance=I,Ie(I),I):(A=S,(I=Fc.get(B))&&(A=O({},S),SR(A,I)),f=f.ownerDocument||f,I=f.createElement("script"),Ie(I),Wa(I,"link",A),f.head.appendChild(I),m.instance=I);case"void":return null;default:throw Error(r(443,m.type))}else m.type==="stylesheet"&&(m.state.loading&4)===0&&(A=m.instance,m.state.loading|=4,sA(A,S.precedence,f));return m.instance}function sA(f,m,S){for(var A=S.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),I=A.length?A[A.length-1]:null,B=I,ie=0;ie<A.length;ie++){var ve=A[ie];if(ve.dataset.precedence===m)B=ve;else if(B!==I)break}B?B.parentNode.insertBefore(f,B.nextSibling):(m=S.nodeType===9?S.head:S,m.insertBefore(f,m.firstChild))}function _R(f,m){f.crossOrigin==null&&(f.crossOrigin=m.crossOrigin),f.referrerPolicy==null&&(f.referrerPolicy=m.referrerPolicy),f.title==null&&(f.title=m.title)}function SR(f,m){f.crossOrigin==null&&(f.crossOrigin=m.crossOrigin),f.referrerPolicy==null&&(f.referrerPolicy=m.referrerPolicy),f.integrity==null&&(f.integrity=m.integrity)}var aA=null;function m5(f,m,S){if(aA===null){var A=new Map,I=aA=new Map;I.set(S,A)}else I=aA,A=I.get(S),A||(A=new Map,I.set(S,A));if(A.has(f))return A;for(A.set(f,null),S=S.getElementsByTagName(f),I=0;I<S.length;I++){var B=S[I];if(!(B[mi]||B[qe]||f==="link"&&B.getAttribute("rel")==="stylesheet")&&B.namespaceURI!=="http://www.w3.org/2000/svg"){var ie=B.getAttribute(m)||"";ie=f+ie;var ve=A.get(ie);ve?ve.push(B):A.set(ie,[B])}}return A}function g5(f,m,S){f=f.ownerDocument||f,f.head.insertBefore(S,m==="title"?f.querySelector("head > title"):null)}function Dee(f,m,S){if(S===1||m.itemProp!=null)return!1;switch(f){case"meta":case"title":return!0;case"style":if(typeof m.precedence!="string"||typeof m.href!="string"||m.href==="")break;return!0;case"link":if(typeof m.rel!="string"||typeof m.href!="string"||m.href===""||m.onLoad||m.onError)break;switch(m.rel){case"stylesheet":return f=m.disabled,typeof m.precedence=="string"&&f==null;default:return!0}case"script":if(m.async&&typeof m.async!="function"&&typeof m.async!="symbol"&&!m.onLoad&&!m.onError&&m.src&&typeof m.src=="string")return!0}return!1}function v5(f){return!(f.type==="stylesheet"&&(f.state.loading&3)===0)}var R_=null;function Pee(){}function Ree(f,m,S){if(R_===null)throw Error(r(475));var A=R_;if(m.type==="stylesheet"&&(typeof S.media!="string"||matchMedia(S.media).matches!==!1)&&(m.state.loading&4)===0){if(m.instance===null){var I=Gy(S.href),B=f.querySelector(D_(I));if(B){f=B._p,f!==null&&typeof f=="object"&&typeof f.then=="function"&&(A.count++,A=oA.bind(A),f.then(A,A)),m.state.loading|=4,m.instance=B,Ie(B);return}B=f.ownerDocument||f,S=f5(S),(I=Fc.get(I))&&_R(S,I),B=B.createElement("link"),Ie(B);var ie=B;ie._p=new Promise(function(ve,Le){ie.onload=ve,ie.onerror=Le}),Wa(B,"link",S),m.instance=B}A.stylesheets===null&&(A.stylesheets=new Map),A.stylesheets.set(m,f),(f=m.state.preload)&&(m.state.loading&3)===0&&(A.count++,m=oA.bind(A),f.addEventListener("load",m),f.addEventListener("error",m))}}function Oee(){if(R_===null)throw Error(r(475));var f=R_;return f.stylesheets&&f.count===0&&wR(f,f.stylesheets),0<f.count?function(m){var S=setTimeout(function(){if(f.stylesheets&&wR(f,f.stylesheets),f.unsuspend){var A=f.unsuspend;f.unsuspend=null,A()}},6e4);return f.unsuspend=m,function(){f.unsuspend=null,clearTimeout(S)}}:null}function oA(){if(this.count--,this.count===0){if(this.stylesheets)wR(this,this.stylesheets);else if(this.unsuspend){var f=this.unsuspend;this.unsuspend=null,f()}}}var lA=null;function wR(f,m){f.stylesheets=null,f.unsuspend!==null&&(f.count++,lA=new Map,m.forEach(Lee,f),lA=null,oA.call(f))}function Lee(f,m){if(!(m.state.loading&4)){var S=lA.get(f);if(S)var A=S.get(null);else{S=new Map,lA.set(f,S);for(var I=f.querySelectorAll("link[data-precedence],style[data-precedence]"),B=0;B<I.length;B++){var ie=I[B];(ie.nodeName==="LINK"||ie.getAttribute("media")!=="not all")&&(S.set(ie.dataset.precedence,ie),A=ie)}A&&S.set(null,A)}I=m.instance,ie=I.getAttribute("data-precedence"),B=S.get(ie)||A,B===A&&S.set(null,I),S.set(ie,I),this.count++,A=oA.bind(this),I.addEventListener("load",A),I.addEventListener("error",A),B?B.parentNode.insertBefore(I,B.nextSibling):(f=f.nodeType===9?f.head:f,f.insertBefore(I,f.firstChild)),m.state.loading|=4}}var O_={$$typeof:p,Provider:null,Consumer:null,_currentValue:ae,_currentValue2:ae,_threadCount:0};function Iee(f,m,S,A,I,B,ie,ve){this.tag=1,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ni(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ni(0),this.hiddenUpdates=Ni(null),this.identifierPrefix=A,this.onUncaughtError=I,this.onCaughtError=B,this.onRecoverableError=ie,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ve,this.incompleteTransitions=new Map}function y5(f,m,S,A,I,B,ie,ve,Le,Je,Et,Lt){return f=new Iee(f,m,S,ie,ve,Le,Je,Lt),m=1,B===!0&&(m|=24),B=Zn(3,null,null,m),f.current=B,B.stateNode=f,m=Zb(),m.refCount++,f.pooledCache=m,m.refCount++,B.memoizedState={element:A,isDehydrated:S,cache:m},ka(B),f}function x5(f){return f?(f=Uh,f):Uh}function b5(f,m,S,A,I,B){I=x5(I),A.context===null?A.context=I:A.pendingContext=I,A=Wo(m),A.payload={element:S},B=B===void 0?null:B,B!==null&&(A.callback=B),S=qo(f,A,m),S!==null&&(fs(S,f,m),ed(S,f,m))}function _5(f,m){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var S=f.retryLane;f.retryLane=S!==0&&S<m?S:m}}function MR(f,m){_5(f,m),(f=f.alternate)&&_5(f,m)}function S5(f){if(f.tag===13){var m=_u(f,67108864);m!==null&&fs(m,f,67108864),MR(f,67108864)}}var cA=!0;function zee(f,m,S,A){var I=R.T;R.T=null;var B=Q.p;try{Q.p=2,ER(f,m,S,A)}finally{Q.p=B,R.T=I}}function Uee(f,m,S,A){var I=R.T;R.T=null;var B=Q.p;try{Q.p=8,ER(f,m,S,A)}finally{Q.p=B,R.T=I}}function ER(f,m,S,A){if(cA){var I=AR(A);if(I===null)fR(f,m,A,uA,S),M5(f,A);else if(Nee(I,f,m,S,A))A.stopPropagation();else if(M5(f,A),m&4&&-1<Bee.indexOf(f)){for(;I!==null;){var B=de(I);if(B!==null)switch(B.tag){case 3:if(B=B.stateNode,B.current.memoizedState.isDehydrated){var ie=ot(B.pendingLanes);if(ie!==0){var ve=B;for(ve.pendingLanes|=2,ve.entangledLanes|=2;ie;){var Le=1<<31-Pt(ie);ve.entanglements[1]|=Le,ie&=~Le}$r(B),(ki&6)===0&&(ur=pe()+500,hr(0))}}break;case 13:ve=_u(B,2),ve!==null&&fs(ve,B,2),Of(),MR(B,2)}if(B=AR(A),B===null&&fR(f,m,A,uA,S),B===I)break;I=B}I!==null&&A.stopPropagation()}else fR(f,m,A,null,S)}}function AR(f){return f=Jl(f),TR(f)}var uA=null;function TR(f){if(uA=null,f=hi(f),f!==null){var m=Y(f);if(m===null)f=null;else{var S=m.tag;if(S===13){if(f=re(m),f!==null)return f;f=null}else if(S===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;f=null}else m!==f&&(f=null)}}return uA=f,null}function w5(f){switch(f){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(we()){case J:return 2;case He:return 8;case je:case Ye:return 32;case Ve:return 268435456;default:return 32}default:return 32}}var CR=!1,vm=null,ym=null,xm=null,L_=new Map,I_=new Map,bm=[],Bee="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function M5(f,m){switch(f){case"focusin":case"focusout":vm=null;break;case"dragenter":case"dragleave":ym=null;break;case"mouseover":case"mouseout":xm=null;break;case"pointerover":case"pointerout":L_.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":I_.delete(m.pointerId)}}function z_(f,m,S,A,I,B){return f===null||f.nativeEvent!==B?(f={blockedOn:m,domEventName:S,eventSystemFlags:A,nativeEvent:B,targetContainers:[I]},m!==null&&(m=de(m),m!==null&&S5(m)),f):(f.eventSystemFlags|=A,m=f.targetContainers,I!==null&&m.indexOf(I)===-1&&m.push(I),f)}function Nee(f,m,S,A,I){switch(m){case"focusin":return vm=z_(vm,f,m,S,A,I),!0;case"dragenter":return ym=z_(ym,f,m,S,A,I),!0;case"mouseover":return xm=z_(xm,f,m,S,A,I),!0;case"pointerover":var B=I.pointerId;return L_.set(B,z_(L_.get(B)||null,f,m,S,A,I)),!0;case"gotpointercapture":return B=I.pointerId,I_.set(B,z_(I_.get(B)||null,f,m,S,A,I)),!0}return!1}function E5(f){var m=hi(f.target);if(m!==null){var S=Y(m);if(S!==null){if(m=S.tag,m===13){if(m=re(S),m!==null){f.blockedOn=m,tt(f.priority,function(){if(S.tag===13){var A=ja(),I=_u(S,A);I!==null&&fs(I,S,A),MR(S,A)}});return}}else if(m===3&&S.stateNode.current.memoizedState.isDehydrated){f.blockedOn=S.tag===3?S.stateNode.containerInfo:null;return}}}f.blockedOn=null}function hA(f){if(f.blockedOn!==null)return!1;for(var m=f.targetContainers;0<m.length;){var S=AR(f.nativeEvent);if(S===null){S=f.nativeEvent;var A=new S.constructor(S.type,S);Kl=A,S.target.dispatchEvent(A),Kl=null}else return m=de(S),m!==null&&S5(m),f.blockedOn=S,!1;m.shift()}return!0}function A5(f,m,S){hA(f)&&S.delete(m)}function Fee(){CR=!1,vm!==null&&hA(vm)&&(vm=null),ym!==null&&hA(ym)&&(ym=null),xm!==null&&hA(xm)&&(xm=null),L_.forEach(A5),I_.forEach(A5)}function dA(f,m){f.blockedOn===m&&(f.blockedOn=null,CR||(CR=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Fee)))}var fA=null;function T5(f){fA!==f&&(fA=f,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){fA===f&&(fA=null);for(var m=0;m<f.length;m+=3){var S=f[m],A=f[m+1],I=f[m+2];if(typeof A!="function"){if(TR(A||S)===null)continue;break}var B=de(S);B!==null&&(f.splice(m,3),m-=3,s_(B,{pending:!0,data:I,method:S.method,action:A},A,I))}}))}function U_(f){function m(Le){return dA(Le,f)}vm!==null&&dA(vm,f),ym!==null&&dA(ym,f),xm!==null&&dA(xm,f),L_.forEach(m),I_.forEach(m);for(var S=0;S<bm.length;S++){var A=bm[S];A.blockedOn===f&&(A.blockedOn=null)}for(;0<bm.length&&(S=bm[0],S.blockedOn===null);)E5(S),S.blockedOn===null&&bm.shift();if(S=(f.ownerDocument||f).$$reactFormReplay,S!=null)for(A=0;A<S.length;A+=3){var I=S[A],B=S[A+1],ie=I[it]||null;if(typeof B=="function")ie||T5(S);else if(ie){var ve=null;if(B&&B.hasAttribute("formAction")){if(I=B,ie=B[it]||null)ve=ie.formAction;else if(TR(I)!==null)continue}else ve=ie.action;typeof ve=="function"?S[A+1]=ve:(S.splice(A,3),A-=3),T5(S)}}}function DR(f){this._internalRoot=f}pA.prototype.render=DR.prototype.render=function(f){var m=this._internalRoot;if(m===null)throw Error(r(409));var S=m.current,A=ja();b5(S,A,f,m,null,null)},pA.prototype.unmount=DR.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var m=f.containerInfo;f.tag===0&&Ut(),b5(f.current,2,null,f,null,null),Of(),m[Gt]=null}};function pA(f){this._internalRoot=f}pA.prototype.unstable_scheduleHydration=function(f){if(f){var m=_e();f={blockedOn:null,target:f,priority:m};for(var S=0;S<bm.length&&m!==0&&m<bm[S].priority;S++);bm.splice(S,0,f),S===0&&E5(f)}};var C5=e.version;if(C5!=="19.0.0")throw Error(r(527,C5,"19.0.0"));Q.findDOMNode=function(f){var m=f._reactInternals;if(m===void 0)throw typeof f.render=="function"?Error(r(188)):(f=Object.keys(f).join(","),Error(r(268,f)));return f=j(m),f=f!==null?ee(f):null,f=f===null?null:f.stateNode,f};var kee={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:R,findFiberByHostInstance:hi,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var mA=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!mA.isDisabled&&mA.supportsFiber)try{ut=mA.inject(kee),ht=mA}catch{}}return N_.createRoot=function(f,m){if(!n(f))throw Error(r(299));var S=!1,A="",I=HE,B=GE,ie=jE,ve=null;return m!=null&&(m.unstable_strictMode===!0&&(S=!0),m.identifierPrefix!==void 0&&(A=m.identifierPrefix),m.onUncaughtError!==void 0&&(I=m.onUncaughtError),m.onCaughtError!==void 0&&(B=m.onCaughtError),m.onRecoverableError!==void 0&&(ie=m.onRecoverableError),m.unstable_transitionCallbacks!==void 0&&(ve=m.unstable_transitionCallbacks)),m=y5(f,1,!1,null,null,S,A,I,B,ie,ve,null),f[Gt]=m.current,dR(f.nodeType===8?f.parentNode:f),new DR(m)},N_.hydrateRoot=function(f,m,S){if(!n(f))throw Error(r(299));var A=!1,I="",B=HE,ie=GE,ve=jE,Le=null,Je=null;return S!=null&&(S.unstable_strictMode===!0&&(A=!0),S.identifierPrefix!==void 0&&(I=S.identifierPrefix),S.onUncaughtError!==void 0&&(B=S.onUncaughtError),S.onCaughtError!==void 0&&(ie=S.onCaughtError),S.onRecoverableError!==void 0&&(ve=S.onRecoverableError),S.unstable_transitionCallbacks!==void 0&&(Le=S.unstable_transitionCallbacks),S.formState!==void 0&&(Je=S.formState)),m=y5(f,1,!0,m,S??null,A,I,B,ie,ve,Le,Je),m.context=x5(null),S=m.current,A=ja(),I=Wo(A),I.callback=null,qo(S,I,A),m.current.lanes=A,Oi(m,A),$r(m),f[Gt]=m.current,dR(f),new pA(m)},N_.version="19.0.0",N_}var N5;function Yee(){if(N5)return OR.exports;N5=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),OR.exports=Xee(),OR.exports}var Qee=Yee(),F_={},F5;function Zee(){if(F5)return F_;F5=1,Object.defineProperty(F_,"__esModule",{value:!0}),F_.parse=a,F_.serialize=c;const t=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,i=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,r=/^[\u0020-\u003A\u003D-\u007E]*$/,n=Object.prototype.toString,s=(()=>{const d=function(){};return d.prototype=Object.create(null),d})();function a(d,p){const g=new s,x=d.length;if(x<2)return g;const v=(p==null?void 0:p.decode)||u;let b=0;do{const w=d.indexOf("=",b);if(w===-1)break;const M=d.indexOf(";",b),E=M===-1?x:M;if(w>E){b=d.lastIndexOf(";",w-1)+1;continue}const D=o(d,b,w),T=l(d,w,D),L=d.slice(D,T);if(g[L]===void 0){let P=o(d,w+1,E),R=l(d,E,P);const O=v(d.slice(P,R));g[L]=O}b=E+1}while(b<x);return g}function o(d,p,g){do{const x=d.charCodeAt(p);if(x!==32&&x!==9)return p}while(++p<g);return g}function l(d,p,g){for(;p>g;){const x=d.charCodeAt(--p);if(x!==32&&x!==9)return p+1}return g}function c(d,p,g){const x=(g==null?void 0:g.encode)||encodeURIComponent;if(!t.test(d))throw new TypeError(`argument name is invalid: ${d}`);const v=x(p);if(!e.test(v))throw new TypeError(`argument val is invalid: ${p}`);let b=d+"="+v;if(!g)return b;if(g.maxAge!==void 0){if(!Number.isInteger(g.maxAge))throw new TypeError(`option maxAge is invalid: ${g.maxAge}`);b+="; Max-Age="+g.maxAge}if(g.domain){if(!i.test(g.domain))throw new TypeError(`option domain is invalid: ${g.domain}`);b+="; Domain="+g.domain}if(g.path){if(!r.test(g.path))throw new TypeError(`option path is invalid: ${g.path}`);b+="; Path="+g.path}if(g.expires){if(!h(g.expires)||!Number.isFinite(g.expires.valueOf()))throw new TypeError(`option expires is invalid: ${g.expires}`);b+="; Expires="+g.expires.toUTCString()}if(g.httpOnly&&(b+="; HttpOnly"),g.secure&&(b+="; Secure"),g.partitioned&&(b+="; Partitioned"),g.priority)switch(typeof g.priority=="string"?g.priority.toLowerCase():void 0){case"low":b+="; Priority=Low";break;case"medium":b+="; Priority=Medium";break;case"high":b+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${g.priority}`)}if(g.sameSite)switch(typeof g.sameSite=="string"?g.sameSite.toLowerCase():g.sameSite){case!0:case"strict":b+="; SameSite=Strict";break;case"lax":b+="; SameSite=Lax";break;case"none":b+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${g.sameSite}`)}return b}function u(d){if(d.indexOf("%")===-1)return d;try{return decodeURIComponent(d)}catch{return d}}function h(d){return n.call(d)==="[object Date]"}return F_}Zee();/**
 * react-router v7.4.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var k5="popstate";function Kee(t={}){function e(r,n){let{pathname:s,search:a,hash:o}=r.location;return dz("",{pathname:s,search:a,hash:o},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function i(r,n){return typeof n=="string"?n:_w(n)}return $ee(e,i,null,t)}function rs(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Hd(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Jee(){return Math.random().toString(36).substring(2,10)}function V5(t,e){return{usr:t.state,key:t.key,idx:e}}function dz(t,e,i=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?eb(e):e,state:i,key:e&&e.key||r||Jee()}}function _w({pathname:t="/",search:e="",hash:i=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),i&&i!=="#"&&(t+=i.charAt(0)==="#"?i:"#"+i),t}function eb(t){let e={};if(t){let i=t.indexOf("#");i>=0&&(e.hash=t.substring(i),t=t.substring(0,i));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function $ee(t,e,i,r={}){let{window:n=document.defaultView,v5Compat:s=!1}=r,a=n.history,o="POP",l=null,c=u();c==null&&(c=0,a.replaceState({...a.state,idx:c},""));function u(){return(a.state||{idx:null}).idx}function h(){o="POP";let v=u(),b=v==null?null:v-c;c=v,l&&l({action:o,location:x.location,delta:b})}function d(v,b){o="PUSH";let w=dz(x.location,v,b);c=u()+1;let M=V5(w,c),E=x.createHref(w);try{a.pushState(M,"",E)}catch(D){if(D instanceof DOMException&&D.name==="DataCloneError")throw D;n.location.assign(E)}s&&l&&l({action:o,location:x.location,delta:1})}function p(v,b){o="REPLACE";let w=dz(x.location,v,b);c=u();let M=V5(w,c),E=x.createHref(w);a.replaceState(M,"",E),s&&l&&l({action:o,location:x.location,delta:0})}function g(v){let b=n.location.origin!=="null"?n.location.origin:n.location.href,w=typeof v=="string"?v:_w(v);return w=w.replace(/ $/,"%20"),rs(b,`No window.location.(origin|href) available to create URL for href: ${w}`),new URL(w,b)}let x={get action(){return o},get location(){return t(n,a)},listen(v){if(l)throw new Error("A history only accepts one active listener");return n.addEventListener(k5,h),l=v,()=>{n.removeEventListener(k5,h),l=null}},createHref(v){return e(n,v)},createURL:g,encodeLocation(v){let b=g(v);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:d,replace:p,go(v){return a.go(v)}};return x}function Q9(t,e,i="/"){return ete(t,e,i,!1)}function ete(t,e,i,r){let n=typeof e=="string"?eb(e):e,s=Ep(n.pathname||"/",i);if(s==null)return null;let a=Z9(t);tte(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let c=dte(s);o=ute(a[l],c,r)}return o}function Z9(t,e=[],i=[],r=""){let n=(s,a,o)=>{let l={relativePath:o===void 0?s.path||"":o,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};l.relativePath.startsWith("/")&&(rs(l.relativePath.startsWith(r),`Absolute route path "${l.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(r.length));let c=bp([r,l.relativePath]),u=i.concat(l);s.children&&s.children.length>0&&(rs(s.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${c}".`),Z9(s.children,e,u,c)),!(s.path==null&&!s.index)&&e.push({path:c,score:lte(c,s.index),routesMeta:u})};return t.forEach((s,a)=>{var o;if(s.path===""||!((o=s.path)!=null&&o.includes("?")))n(s,a);else for(let l of K9(s.path))n(s,a,l)}),e}function K9(t){let e=t.split("/");if(e.length===0)return[];let[i,...r]=e,n=i.endsWith("?"),s=i.replace(/\?$/,"");if(r.length===0)return n?[s,""]:[s];let a=K9(r.join("/")),o=[];return o.push(...a.map(l=>l===""?s:[s,l].join("/"))),n&&o.push(...a),o.map(l=>t.startsWith("/")&&l===""?"/":l)}function tte(t){t.sort((e,i)=>e.score!==i.score?i.score-e.score:cte(e.routesMeta.map(r=>r.childrenIndex),i.routesMeta.map(r=>r.childrenIndex)))}var ite=/^:[\w-]+$/,rte=3,nte=2,ste=1,ate=10,ote=-2,H5=t=>t==="*";function lte(t,e){let i=t.split("/"),r=i.length;return i.some(H5)&&(r+=ote),e&&(r+=nte),i.filter(n=>!H5(n)).reduce((n,s)=>n+(ite.test(s)?rte:s===""?ste:ate),r)}function cte(t,e){return t.length===e.length&&t.slice(0,-1).every((r,n)=>r===e[n])?t[t.length-1]-e[e.length-1]:0}function ute(t,e,i=!1){let{routesMeta:r}=t,n={},s="/",a=[];for(let o=0;o<r.length;++o){let l=r[o],c=o===r.length-1,u=s==="/"?e:e.slice(s.length)||"/",h=xC({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),d=l.route;if(!h&&c&&i&&!r[r.length-1].route.index&&(h=xC({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!h)return null;Object.assign(n,h.params),a.push({params:n,pathname:bp([s,h.pathname]),pathnameBase:gte(bp([s,h.pathnameBase])),route:d}),h.pathnameBase!=="/"&&(s=bp([s,h.pathnameBase]))}return a}function xC(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[i,r]=hte(t.path,t.caseSensitive,t.end),n=e.match(i);if(!n)return null;let s=n[0],a=s.replace(/(.)\/+$/,"$1"),o=n.slice(1);return{params:r.reduce((c,{paramName:u,isOptional:h},d)=>{if(u==="*"){let g=o[d]||"";a=s.slice(0,s.length-g.length).replace(/(.)\/+$/,"$1")}const p=o[d];return h&&!p?c[u]=void 0:c[u]=(p||"").replace(/%2F/g,"/"),c},{}),pathname:s,pathnameBase:a,pattern:t}}function hte(t,e=!1,i=!0){Hd(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],n="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(r.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),n+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?n+="\\/*$":t!==""&&t!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,e?void 0:"i"),r]}function dte(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Hd(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Ep(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let i=e.endsWith("/")?e.length-1:e.length,r=t.charAt(i);return r&&r!=="/"?null:t.slice(i)||"/"}function fte(t,e="/"){let{pathname:i,search:r="",hash:n=""}=typeof t=="string"?eb(t):t;return{pathname:i?i.startsWith("/")?i:pte(i,e):e,search:vte(r),hash:yte(n)}}function pte(t,e){let i=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(n=>{n===".."?i.length>1&&i.pop():n!=="."&&i.push(n)}),i.length>1?i.join("/"):"/"}function UR(t,e,i,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${i}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function mte(t){return t.filter((e,i)=>i===0||e.route.path&&e.route.path.length>0)}function J9(t){let e=mte(t);return e.map((i,r)=>r===e.length-1?i.pathname:i.pathnameBase)}function $9(t,e,i,r=!1){let n;typeof t=="string"?n=eb(t):(n={...t},rs(!n.pathname||!n.pathname.includes("?"),UR("?","pathname","search",n)),rs(!n.pathname||!n.pathname.includes("#"),UR("#","pathname","hash",n)),rs(!n.search||!n.search.includes("#"),UR("#","search","hash",n)));let s=t===""||n.pathname==="",a=s?"/":n.pathname,o;if(a==null)o=i;else{let h=e.length-1;if(!r&&a.startsWith("..")){let d=a.split("/");for(;d[0]==="..";)d.shift(),h-=1;n.pathname=d.join("/")}o=h>=0?e[h]:"/"}let l=fte(n,o),c=a&&a!=="/"&&a.endsWith("/"),u=(s||a===".")&&i.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}var bp=t=>t.join("/").replace(/\/\/+/g,"/"),gte=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),vte=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,yte=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function xte(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var e7=["POST","PUT","PATCH","DELETE"];new Set(e7);var bte=["GET",...e7];new Set(bte);var tb=Me.createContext(null);tb.displayName="DataRouter";var b3=Me.createContext(null);b3.displayName="DataRouterState";var t7=Me.createContext({isTransitioning:!1});t7.displayName="ViewTransition";var _te=Me.createContext(new Map);_te.displayName="Fetchers";var Ste=Me.createContext(null);Ste.displayName="Await";var Kd=Me.createContext(null);Kd.displayName="Navigation";var fM=Me.createContext(null);fM.displayName="Location";var Jd=Me.createContext({outlet:null,matches:[],isDataRoute:!1});Jd.displayName="Route";var tN=Me.createContext(null);tN.displayName="RouteError";function wte(t,{relative:e}={}){rs(pM(),"useHref() may be used only in the context of a <Router> component.");let{basename:i,navigator:r}=Me.useContext(Kd),{hash:n,pathname:s,search:a}=mM(t,{relative:e}),o=s;return i!=="/"&&(o=s==="/"?i:bp([i,s])),r.createHref({pathname:o,search:a,hash:n})}function pM(){return Me.useContext(fM)!=null}function Up(){return rs(pM(),"useLocation() may be used only in the context of a <Router> component."),Me.useContext(fM).location}var i7="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function r7(t){Me.useContext(Kd).static||Me.useLayoutEffect(t)}function iN(){let{isDataRoute:t}=Me.useContext(Jd);return t?Bte():Mte()}function Mte(){rs(pM(),"useNavigate() may be used only in the context of a <Router> component.");let t=Me.useContext(tb),{basename:e,navigator:i}=Me.useContext(Kd),{matches:r}=Me.useContext(Jd),{pathname:n}=Up(),s=JSON.stringify(J9(r)),a=Me.useRef(!1);return r7(()=>{a.current=!0}),Me.useCallback((l,c={})=>{if(Hd(a.current,i7),!a.current)return;if(typeof l=="number"){i.go(l);return}let u=$9(l,JSON.parse(s),n,c.relative==="path");t==null&&e!=="/"&&(u.pathname=u.pathname==="/"?e:bp([e,u.pathname])),(c.replace?i.replace:i.push)(u,c.state,c)},[e,i,s,n,t])}Me.createContext(null);function Ete(){let{matches:t}=Me.useContext(Jd),e=t[t.length-1];return e?e.params:{}}function mM(t,{relative:e}={}){let{matches:i}=Me.useContext(Jd),{pathname:r}=Up(),n=JSON.stringify(J9(i));return Me.useMemo(()=>$9(t,JSON.parse(n),r,e==="path"),[t,n,r,e])}function Ate(t,e){return n7(t,e)}function n7(t,e,i,r){var w;rs(pM(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:n,static:s}=Me.useContext(Kd),{matches:a}=Me.useContext(Jd),o=a[a.length-1],l=o?o.params:{},c=o?o.pathname:"/",u=o?o.pathnameBase:"/",h=o&&o.route;{let M=h&&h.path||"";s7(c,!h||M.endsWith("*")||M.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${M}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${M}"> to <Route path="${M==="/"?"*":`${M}/*`}">.`)}let d=Up(),p;if(e){let M=typeof e=="string"?eb(e):e;rs(u==="/"||((w=M.pathname)==null?void 0:w.startsWith(u)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${M.pathname}" was given in the \`location\` prop.`),p=M}else p=d;let g=p.pathname||"/",x=g;if(u!=="/"){let M=u.replace(/^\//,"").split("/");x="/"+g.replace(/^\//,"").split("/").slice(M.length).join("/")}let v=!s&&i&&i.matches&&i.matches.length>0?i.matches:Q9(t,{pathname:x});Hd(h||v!=null,`No routes matched location "${p.pathname}${p.search}${p.hash}" `),Hd(v==null||v[v.length-1].route.element!==void 0||v[v.length-1].route.Component!==void 0||v[v.length-1].route.lazy!==void 0,`Matched leaf route at location "${p.pathname}${p.search}${p.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let b=Rte(v&&v.map(M=>Object.assign({},M,{params:Object.assign({},l,M.params),pathname:bp([u,n.encodeLocation?n.encodeLocation(M.pathname).pathname:M.pathname]),pathnameBase:M.pathnameBase==="/"?u:bp([u,n.encodeLocation?n.encodeLocation(M.pathnameBase).pathname:M.pathnameBase])})),a,i,r);return e&&b?Me.createElement(fM.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...p},navigationType:"POP"}},b):b}function Tte(){let t=Ute(),e=xte(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),i=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",n={padding:"0.5rem",backgroundColor:r},s={padding:"2px 4px",backgroundColor:r},a=null;return console.error("Error handled by React Router default ErrorBoundary:",t),a=Me.createElement(Me.Fragment,null,Me.createElement("p",null," Hey developer "),Me.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Me.createElement("code",{style:s},"ErrorBoundary")," or"," ",Me.createElement("code",{style:s},"errorElement")," prop on your route.")),Me.createElement(Me.Fragment,null,Me.createElement("h2",null,"Unexpected Application Error!"),Me.createElement("h3",{style:{fontStyle:"italic"}},e),i?Me.createElement("pre",{style:n},i):null,a)}var Cte=Me.createElement(Tte,null),Dte=class extends Me.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return this.state.error!==void 0?Me.createElement(Jd.Provider,{value:this.props.routeContext},Me.createElement(tN.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Pte({routeContext:t,match:e,children:i}){let r=Me.useContext(tb);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),Me.createElement(Jd.Provider,{value:t},i)}function Rte(t,e=[],i=null,r=null){if(t==null){if(!i)return null;if(i.errors)t=i.matches;else if(e.length===0&&!i.initialized&&i.matches.length>0)t=i.matches;else return null}let n=t,s=i==null?void 0:i.errors;if(s!=null){let l=n.findIndex(c=>c.route.id&&(s==null?void 0:s[c.route.id])!==void 0);rs(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),n=n.slice(0,Math.min(n.length,l+1))}let a=!1,o=-1;if(i)for(let l=0;l<n.length;l++){let c=n[l];if((c.route.HydrateFallback||c.route.hydrateFallbackElement)&&(o=l),c.route.id){let{loaderData:u,errors:h}=i,d=c.route.loader&&!u.hasOwnProperty(c.route.id)&&(!h||h[c.route.id]===void 0);if(c.route.lazy||d){a=!0,o>=0?n=n.slice(0,o+1):n=[n[0]];break}}}return n.reduceRight((l,c,u)=>{let h,d=!1,p=null,g=null;i&&(h=s&&c.route.id?s[c.route.id]:void 0,p=c.route.errorElement||Cte,a&&(o<0&&u===0?(s7("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),d=!0,g=null):o===u&&(d=!0,g=c.route.hydrateFallbackElement||null)));let x=e.concat(n.slice(0,u+1)),v=()=>{let b;return h?b=p:d?b=g:c.route.Component?b=Me.createElement(c.route.Component,null):c.route.element?b=c.route.element:b=l,Me.createElement(Pte,{match:c,routeContext:{outlet:l,matches:x,isDataRoute:i!=null},children:b})};return i&&(c.route.ErrorBoundary||c.route.errorElement||u===0)?Me.createElement(Dte,{location:i.location,revalidation:i.revalidation,component:p,error:h,children:v(),routeContext:{outlet:null,matches:x,isDataRoute:!0}}):v()},null)}function rN(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Ote(t){let e=Me.useContext(tb);return rs(e,rN(t)),e}function Lte(t){let e=Me.useContext(b3);return rs(e,rN(t)),e}function Ite(t){let e=Me.useContext(Jd);return rs(e,rN(t)),e}function nN(t){let e=Ite(t),i=e.matches[e.matches.length-1];return rs(i.route.id,`${t} can only be used on routes that contain a unique "id"`),i.route.id}function zte(){return nN("useRouteId")}function Ute(){var r;let t=Me.useContext(tN),e=Lte("useRouteError"),i=nN("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[i]}function Bte(){let{router:t}=Ote("useNavigate"),e=nN("useNavigate"),i=Me.useRef(!1);return r7(()=>{i.current=!0}),Me.useCallback(async(n,s={})=>{Hd(i.current,i7),i.current&&(typeof n=="number"?t.navigate(n):await t.navigate(n,{fromRouteId:e,...s}))},[t,e])}var G5={};function s7(t,e,i){!e&&!G5[t]&&(G5[t]=!0,Hd(!1,i))}Me.memo(Nte);function Nte({routes:t,future:e,state:i}){return n7(t,void 0,i,e)}function Wm(t){rs(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Fte({basename:t="/",children:e=null,location:i,navigationType:r="POP",navigator:n,static:s=!1}){rs(!pM(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=t.replace(/^\/*/,"/"),o=Me.useMemo(()=>({basename:a,navigator:n,static:s,future:{}}),[a,n,s]);typeof i=="string"&&(i=eb(i));let{pathname:l="/",search:c="",hash:u="",state:h=null,key:d="default"}=i,p=Me.useMemo(()=>{let g=Ep(l,a);return g==null?null:{location:{pathname:g,search:c,hash:u,state:h,key:d},navigationType:r}},[a,l,c,u,h,d,r]);return Hd(p!=null,`<Router basename="${a}"> is not able to match the URL "${l}${c}${u}" because it does not start with the basename, so the <Router> won't render anything.`),p==null?null:Me.createElement(Kd.Provider,{value:o},Me.createElement(fM.Provider,{children:e,value:p}))}function kte({children:t,location:e}){return Ate(fz(t),e)}function fz(t,e=[]){let i=[];return Me.Children.forEach(t,(r,n)=>{if(!Me.isValidElement(r))return;let s=[...e,n];if(r.type===Me.Fragment){i.push.apply(i,fz(r.props.children,s));return}rs(r.type===Wm,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),rs(!r.props.index||!r.props.children,"An index route cannot have child routes.");let a={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=fz(r.props.children,s)),i.push(a)}),i}var kT="get",VT="application/x-www-form-urlencoded";function _3(t){return t!=null&&typeof t.tagName=="string"}function Vte(t){return _3(t)&&t.tagName.toLowerCase()==="button"}function Hte(t){return _3(t)&&t.tagName.toLowerCase()==="form"}function Gte(t){return _3(t)&&t.tagName.toLowerCase()==="input"}function jte(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function Wte(t,e){return t.button===0&&(!e||e==="_self")&&!jte(t)}var vA=null;function qte(){if(vA===null)try{new FormData(document.createElement("form"),0),vA=!1}catch{vA=!0}return vA}var Xte=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function BR(t){return t!=null&&!Xte.has(t)?(Hd(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${VT}"`),null):t}function Yte(t,e){let i,r,n,s,a;if(Hte(t)){let o=t.getAttribute("action");r=o?Ep(o,e):null,i=t.getAttribute("method")||kT,n=BR(t.getAttribute("enctype"))||VT,s=new FormData(t)}else if(Vte(t)||Gte(t)&&(t.type==="submit"||t.type==="image")){let o=t.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=t.getAttribute("formaction")||o.getAttribute("action");if(r=l?Ep(l,e):null,i=t.getAttribute("formmethod")||o.getAttribute("method")||kT,n=BR(t.getAttribute("formenctype"))||BR(o.getAttribute("enctype"))||VT,s=new FormData(o,t),!qte()){let{name:c,type:u,value:h}=t;if(u==="image"){let d=c?`${c}.`:"";s.append(`${d}x`,"0"),s.append(`${d}y`,"0")}else c&&s.append(c,h)}}else{if(_3(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');i=kT,r=null,n=VT,a=t}return s&&n==="text/plain"&&(a=s,s=void 0),{action:r,method:i.toLowerCase(),encType:n,formData:s,body:a}}function sN(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}async function Qte(t,e){if(t.id in e)return e[t.id];try{let i=await import(t.module);return e[t.id]=i,i}catch(i){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(i),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Zte(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function Kte(t,e,i){let r=await Promise.all(t.map(async n=>{let s=e.routes[n.route.id];if(s){let a=await Qte(s,i);return a.links?a.links():[]}return[]}));return tie(r.flat(1).filter(Zte).filter(n=>n.rel==="stylesheet"||n.rel==="preload").map(n=>n.rel==="stylesheet"?{...n,rel:"prefetch",as:"style"}:{...n,rel:"prefetch"}))}function j5(t,e,i,r,n,s){let a=(l,c)=>i[c]?l.route.id!==i[c].route.id:!0,o=(l,c)=>{var u;return i[c].pathname!==l.pathname||((u=i[c].route.path)==null?void 0:u.endsWith("*"))&&i[c].params["*"]!==l.params["*"]};return s==="assets"?e.filter((l,c)=>a(l,c)||o(l,c)):s==="data"?e.filter((l,c)=>{var h;let u=r.routes[l.route.id];if(!u||!u.hasLoader)return!1;if(a(l,c)||o(l,c))return!0;if(l.route.shouldRevalidate){let d=l.route.shouldRevalidate({currentUrl:new URL(n.pathname+n.search+n.hash,window.origin),currentParams:((h=i[0])==null?void 0:h.params)||{},nextUrl:new URL(t,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof d=="boolean")return d}return!0}):[]}function Jte(t,e,{includeHydrateFallback:i}={}){return $te(t.map(r=>{let n=e.routes[r.route.id];if(!n)return[];let s=[n.module];return n.clientActionModule&&(s=s.concat(n.clientActionModule)),n.clientLoaderModule&&(s=s.concat(n.clientLoaderModule)),i&&n.hydrateFallbackModule&&(s=s.concat(n.hydrateFallbackModule)),n.imports&&(s=s.concat(n.imports)),s}).flat(1))}function $te(t){return[...new Set(t)]}function eie(t){let e={},i=Object.keys(t).sort();for(let r of i)e[r]=t[r];return e}function tie(t,e){let i=new Set;return new Set(e),t.reduce((r,n)=>{let s=JSON.stringify(eie(n));return i.has(s)||(i.add(s),r.push({key:s,link:n})),r},[])}function iie(t,e){let i=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return i.pathname==="/"?i.pathname="_root.data":e&&Ep(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.data`:i.pathname=`${i.pathname.replace(/\/$/,"")}.data`,i}function a7(){let t=Me.useContext(tb);return sN(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function rie(){let t=Me.useContext(b3);return sN(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var aN=Me.createContext(void 0);aN.displayName="FrameworkContext";function o7(){let t=Me.useContext(aN);return sN(t,"You must render this element inside a <HydratedRouter> element"),t}function nie(t,e){let i=Me.useContext(aN),[r,n]=Me.useState(!1),[s,a]=Me.useState(!1),{onFocus:o,onBlur:l,onMouseEnter:c,onMouseLeave:u,onTouchStart:h}=e,d=Me.useRef(null);Me.useEffect(()=>{if(t==="render"&&a(!0),t==="viewport"){let x=b=>{b.forEach(w=>{a(w.isIntersecting)})},v=new IntersectionObserver(x,{threshold:.5});return d.current&&v.observe(d.current),()=>{v.disconnect()}}},[t]),Me.useEffect(()=>{if(r){let x=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(x)}}},[r]);let p=()=>{n(!0)},g=()=>{n(!1),a(!1)};return i?t!=="intent"?[s,d,{}]:[s,d,{onFocus:k_(o,p),onBlur:k_(l,g),onMouseEnter:k_(c,p),onMouseLeave:k_(u,g),onTouchStart:k_(h,p)}]:[!1,d,{}]}function k_(t,e){return i=>{t&&t(i),i.defaultPrevented||e(i)}}function sie({page:t,...e}){let{router:i}=a7(),r=Me.useMemo(()=>Q9(i.routes,t,i.basename),[i.routes,t,i.basename]);return r?Me.createElement(oie,{page:t,matches:r,...e}):null}function aie(t){let{manifest:e,routeModules:i}=o7(),[r,n]=Me.useState([]);return Me.useEffect(()=>{let s=!1;return Kte(t,e,i).then(a=>{s||n(a)}),()=>{s=!0}},[t,e,i]),r}function oie({page:t,matches:e,...i}){let r=Up(),{manifest:n,routeModules:s}=o7(),{basename:a}=a7(),{loaderData:o,matches:l}=rie(),c=Me.useMemo(()=>j5(t,e,l,n,r,"data"),[t,e,l,n,r]),u=Me.useMemo(()=>j5(t,e,l,n,r,"assets"),[t,e,l,n,r]),h=Me.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let g=new Set,x=!1;if(e.forEach(b=>{var M;let w=n.routes[b.route.id];!w||!w.hasLoader||(!c.some(E=>E.route.id===b.route.id)&&b.route.id in o&&((M=s[b.route.id])!=null&&M.shouldRevalidate)||w.hasClientLoader?x=!0:g.add(b.route.id))}),g.size===0)return[];let v=iie(t,a);return x&&g.size>0&&v.searchParams.set("_routes",e.filter(b=>g.has(b.route.id)).map(b=>b.route.id).join(",")),[v.pathname+v.search]},[a,o,r,n,c,e,t,s]),d=Me.useMemo(()=>Jte(u,n),[u,n]),p=aie(u);return Me.createElement(Me.Fragment,null,h.map(g=>Me.createElement("link",{key:g,rel:"prefetch",as:"fetch",href:g,...i})),d.map(g=>Me.createElement("link",{key:g,rel:"modulepreload",href:g,...i})),p.map(({key:g,link:x})=>Me.createElement("link",{key:g,...x})))}function lie(...t){return e=>{t.forEach(i=>{typeof i=="function"?i(e):i!=null&&(i.current=e)})}}var l7=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{l7&&(window.__reactRouterVersion="7.4.0")}catch{}function cie({basename:t,children:e,window:i}){let r=Me.useRef();r.current==null&&(r.current=Kee({window:i,v5Compat:!0}));let n=r.current,[s,a]=Me.useState({action:n.action,location:n.location}),o=Me.useCallback(l=>{Me.startTransition(()=>a(l))},[a]);return Me.useLayoutEffect(()=>n.listen(o),[n,o]),Me.createElement(Fte,{basename:t,children:e,location:s.location,navigationType:s.action,navigator:n})}var c7=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,S3=Me.forwardRef(function({onClick:e,discover:i="render",prefetch:r="none",relative:n,reloadDocument:s,replace:a,state:o,target:l,to:c,preventScrollReset:u,viewTransition:h,...d},p){let{basename:g}=Me.useContext(Kd),x=typeof c=="string"&&c7.test(c),v,b=!1;if(typeof c=="string"&&x&&(v=c,l7))try{let R=new URL(window.location.href),O=c.startsWith("//")?new URL(R.protocol+c):new URL(c),U=Ep(O.pathname,g);O.origin===R.origin&&U!=null?c=U+O.search+O.hash:b=!0}catch{Hd(!1,`<Link to="${c}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let w=wte(c,{relative:n}),[M,E,D]=nie(r,d),T=fie(c,{replace:a,state:o,target:l,preventScrollReset:u,relative:n,viewTransition:h});function L(R){e&&e(R),R.defaultPrevented||T(R)}let P=Me.createElement("a",{...d,...D,href:v||w,onClick:b||s?e:L,ref:lie(p,E),target:l,"data-discover":!x&&i==="render"?"true":void 0});return M&&!x?Me.createElement(Me.Fragment,null,P,Me.createElement(sie,{page:w})):P});S3.displayName="Link";var uie=Me.forwardRef(function({"aria-current":e="page",caseSensitive:i=!1,className:r="",end:n=!1,style:s,to:a,viewTransition:o,children:l,...c},u){let h=mM(a,{relative:c.relative}),d=Up(),p=Me.useContext(b3),{navigator:g,basename:x}=Me.useContext(Kd),v=p!=null&&yie(h)&&o===!0,b=g.encodeLocation?g.encodeLocation(h).pathname:h.pathname,w=d.pathname,M=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;i||(w=w.toLowerCase(),M=M?M.toLowerCase():null,b=b.toLowerCase()),M&&x&&(M=Ep(M,x)||M);const E=b!=="/"&&b.endsWith("/")?b.length-1:b.length;let D=w===b||!n&&w.startsWith(b)&&w.charAt(E)==="/",T=M!=null&&(M===b||!n&&M.startsWith(b)&&M.charAt(b.length)==="/"),L={isActive:D,isPending:T,isTransitioning:v},P=D?e:void 0,R;typeof r=="function"?R=r(L):R=[r,D?"active":null,T?"pending":null,v?"transitioning":null].filter(Boolean).join(" ");let O=typeof s=="function"?s(L):s;return Me.createElement(S3,{...c,"aria-current":P,className:R,ref:u,style:O,to:a,viewTransition:o},typeof l=="function"?l(L):l)});uie.displayName="NavLink";var hie=Me.forwardRef(({discover:t="render",fetcherKey:e,navigate:i,reloadDocument:r,replace:n,state:s,method:a=kT,action:o,onSubmit:l,relative:c,preventScrollReset:u,viewTransition:h,...d},p)=>{let g=gie(),x=vie(o,{relative:c}),v=a.toLowerCase()==="get"?"get":"post",b=typeof o=="string"&&c7.test(o),w=M=>{if(l&&l(M),M.defaultPrevented)return;M.preventDefault();let E=M.nativeEvent.submitter,D=(E==null?void 0:E.getAttribute("formmethod"))||a;g(E||M.currentTarget,{fetcherKey:e,method:D,navigate:i,replace:n,state:s,relative:c,preventScrollReset:u,viewTransition:h})};return Me.createElement("form",{ref:p,method:v,action:x,onSubmit:r?l:w,...d,"data-discover":!b&&t==="render"?"true":void 0})});hie.displayName="Form";function die(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function u7(t){let e=Me.useContext(tb);return rs(e,die(t)),e}function fie(t,{target:e,replace:i,state:r,preventScrollReset:n,relative:s,viewTransition:a}={}){let o=iN(),l=Up(),c=mM(t,{relative:s});return Me.useCallback(u=>{if(Wte(u,e)){u.preventDefault();let h=i!==void 0?i:_w(l)===_w(c);o(t,{replace:h,state:r,preventScrollReset:n,relative:s,viewTransition:a})}},[l,o,c,i,r,e,t,n,s,a])}var pie=0,mie=()=>`__${String(++pie)}__`;function gie(){let{router:t}=u7("useSubmit"),{basename:e}=Me.useContext(Kd),i=zte();return Me.useCallback(async(r,n={})=>{let{action:s,method:a,encType:o,formData:l,body:c}=Yte(r,e);if(n.navigate===!1){let u=n.fetcherKey||mie();await t.fetch(u,i,n.action||s,{preventScrollReset:n.preventScrollReset,formData:l,body:c,formMethod:n.method||a,formEncType:n.encType||o,flushSync:n.flushSync})}else await t.navigate(n.action||s,{preventScrollReset:n.preventScrollReset,formData:l,body:c,formMethod:n.method||a,formEncType:n.encType||o,replace:n.replace,state:n.state,fromRouteId:i,flushSync:n.flushSync,viewTransition:n.viewTransition})},[t,e,i])}function vie(t,{relative:e}={}){let{basename:i}=Me.useContext(Kd),r=Me.useContext(Jd);rs(r,"useFormAction must be used inside a RouteContext");let[n]=r.matches.slice(-1),s={...mM(t||".",{relative:e})},a=Up();if(t==null){s.search=a.search;let o=new URLSearchParams(s.search),l=o.getAll("index");if(l.some(u=>u==="")){o.delete("index"),l.filter(h=>h).forEach(h=>o.append("index",h));let u=o.toString();s.search=u?`?${u}`:""}}return(!t||t===".")&&n.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),i!=="/"&&(s.pathname=s.pathname==="/"?i:bp([i,s.pathname])),_w(s)}function yie(t,e={}){let i=Me.useContext(t7);rs(i!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=u7("useViewTransitionState"),n=mM(t,{relative:e.relative});if(!i.isTransitioning)return!1;let s=Ep(i.currentLocation.pathname,r)||i.currentLocation.pathname,a=Ep(i.nextLocation.pathname,r)||i.nextLocation.pathname;return xC(n.pathname,a)!=null||xC(n.pathname,s)!=null}new TextEncoder;Y9();function W5(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function h7(...t){return e=>{let i=!1;const r=t.map(n=>{const s=W5(n,e);return!i&&typeof s=="function"&&(i=!0),s});if(i)return()=>{for(let n=0;n<r.length;n++){const s=r[n];typeof s=="function"?s():W5(t[n],null)}}}}function d7(...t){return Me.useCallback(h7(...t),t)}var oN=Me.forwardRef((t,e)=>{const{children:i,...r}=t,n=Me.Children.toArray(i),s=n.find(bie);if(s){const a=s.props.children,o=n.map(l=>l===s?Me.Children.count(a)>1?Me.Children.only(null):Me.isValidElement(a)?a.props.children:null:l);return Pe.jsx(pz,{...r,ref:e,children:Me.isValidElement(a)?Me.cloneElement(a,void 0,o):null})}return Pe.jsx(pz,{...r,ref:e,children:i})});oN.displayName="Slot";var pz=Me.forwardRef((t,e)=>{const{children:i,...r}=t;if(Me.isValidElement(i)){const n=Sie(i),s=_ie(r,i.props);return i.type!==Me.Fragment&&(s.ref=e?h7(e,n):n),Me.cloneElement(i,s)}return Me.Children.count(i)>1?Me.Children.only(null):null});pz.displayName="SlotClone";var xie=({children:t})=>Pe.jsx(Pe.Fragment,{children:t});function bie(t){return Me.isValidElement(t)&&t.type===xie}function _ie(t,e){const i={...e};for(const r in e){const n=t[r],s=e[r];/^on[A-Z]/.test(r)?n&&s?i[r]=(...o)=>{s(...o),n(...o)}:n&&(i[r]=n):r==="style"?i[r]={...n,...s}:r==="className"&&(i[r]=[n,s].filter(Boolean).join(" "))}return{...t,...i}}function Sie(t){var r,n;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,i=e&&"isReactWarning"in e&&e.isReactWarning;return i?t.ref:(e=(n=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:n.get,i=e&&"isReactWarning"in e&&e.isReactWarning,i?t.props.ref:t.props.ref||t.ref)}function f7(t){var e,i,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(e=0;e<n;e++)t[e]&&(i=f7(t[e]))&&(r&&(r+=" "),r+=i)}else for(i in t)t[i]&&(r&&(r+=" "),r+=i);return r}function p7(){for(var t,e,i=0,r="",n=arguments.length;i<n;i++)(t=arguments[i])&&(e=f7(t))&&(r&&(r+=" "),r+=e);return r}const q5=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,X5=p7,wie=(t,e)=>i=>{var r;if((e==null?void 0:e.variants)==null)return X5(t,i==null?void 0:i.class,i==null?void 0:i.className);const{variants:n,defaultVariants:s}=e,a=Object.keys(n).map(c=>{const u=i==null?void 0:i[c],h=s==null?void 0:s[c];if(u===null)return null;const d=q5(u)||q5(h);return n[c][d]}),o=i&&Object.entries(i).reduce((c,u)=>{let[h,d]=u;return d===void 0||(c[h]=d),c},{}),l=e==null||(r=e.compoundVariants)===null||r===void 0?void 0:r.reduce((c,u)=>{let{class:h,className:d,...p}=u;return Object.entries(p).every(g=>{let[x,v]=g;return Array.isArray(v)?v.includes({...s,...o}[x]):{...s,...o}[x]===v})?[...c,h,d]:c},[]);return X5(t,a,l,i==null?void 0:i.class,i==null?void 0:i.className)},lN="-",Mie=t=>{const e=Aie(t),{conflictingClassGroups:i,conflictingClassGroupModifiers:r}=t;return{getClassGroupId:a=>{const o=a.split(lN);return o[0]===""&&o.length!==1&&o.shift(),m7(o,e)||Eie(a)},getConflictingClassGroupIds:(a,o)=>{const l=i[a]||[];return o&&r[a]?[...l,...r[a]]:l}}},m7=(t,e)=>{var a;if(t.length===0)return e.classGroupId;const i=t[0],r=e.nextPart.get(i),n=r?m7(t.slice(1),r):void 0;if(n)return n;if(e.validators.length===0)return;const s=t.join(lN);return(a=e.validators.find(({validator:o})=>o(s)))==null?void 0:a.classGroupId},Y5=/^\[(.+)\]$/,Eie=t=>{if(Y5.test(t)){const e=Y5.exec(t)[1],i=e==null?void 0:e.substring(0,e.indexOf(":"));if(i)return"arbitrary.."+i}},Aie=t=>{const{theme:e,classGroups:i}=t,r={nextPart:new Map,validators:[]};for(const n in i)mz(i[n],r,n,e);return r},mz=(t,e,i,r)=>{t.forEach(n=>{if(typeof n=="string"){const s=n===""?e:Q5(e,n);s.classGroupId=i;return}if(typeof n=="function"){if(Tie(n)){mz(n(r),e,i,r);return}e.validators.push({validator:n,classGroupId:i});return}Object.entries(n).forEach(([s,a])=>{mz(a,Q5(e,s),i,r)})})},Q5=(t,e)=>{let i=t;return e.split(lN).forEach(r=>{i.nextPart.has(r)||i.nextPart.set(r,{nextPart:new Map,validators:[]}),i=i.nextPart.get(r)}),i},Tie=t=>t.isThemeGetter,Cie=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,i=new Map,r=new Map;const n=(s,a)=>{i.set(s,a),e++,e>t&&(e=0,r=i,i=new Map)};return{get(s){let a=i.get(s);if(a!==void 0)return a;if((a=r.get(s))!==void 0)return n(s,a),a},set(s,a){i.has(s)?i.set(s,a):n(s,a)}}},gz="!",vz=":",Die=vz.length,Pie=t=>{const{prefix:e,experimentalParseClassName:i}=t;let r=n=>{const s=[];let a=0,o=0,l=0,c;for(let g=0;g<n.length;g++){let x=n[g];if(a===0&&o===0){if(x===vz){s.push(n.slice(l,g)),l=g+Die;continue}if(x==="/"){c=g;continue}}x==="["?a++:x==="]"?a--:x==="("?o++:x===")"&&o--}const u=s.length===0?n:n.substring(l),h=Rie(u),d=h!==u,p=c&&c>l?c-l:void 0;return{modifiers:s,hasImportantModifier:d,baseClassName:h,maybePostfixModifierPosition:p}};if(e){const n=e+vz,s=r;r=a=>a.startsWith(n)?s(a.substring(n.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:a,maybePostfixModifierPosition:void 0}}if(i){const n=r;r=s=>i({className:s,parseClassName:n})}return r},Rie=t=>t.endsWith(gz)?t.substring(0,t.length-1):t.startsWith(gz)?t.substring(1):t,Oie=t=>{const e=Object.fromEntries(t.orderSensitiveModifiers.map(r=>[r,!0]));return r=>{if(r.length<=1)return r;const n=[];let s=[];return r.forEach(a=>{a[0]==="["||e[a]?(n.push(...s.sort(),a),s=[]):s.push(a)}),n.push(...s.sort()),n}},Lie=t=>({cache:Cie(t.cacheSize),parseClassName:Pie(t),sortModifiers:Oie(t),...Mie(t)}),Iie=/\s+/,zie=(t,e)=>{const{parseClassName:i,getClassGroupId:r,getConflictingClassGroupIds:n,sortModifiers:s}=e,a=[],o=t.trim().split(Iie);let l="";for(let c=o.length-1;c>=0;c-=1){const u=o[c],{isExternal:h,modifiers:d,hasImportantModifier:p,baseClassName:g,maybePostfixModifierPosition:x}=i(u);if(h){l=u+(l.length>0?" "+l:l);continue}let v=!!x,b=r(v?g.substring(0,x):g);if(!b){if(!v){l=u+(l.length>0?" "+l:l);continue}if(b=r(g),!b){l=u+(l.length>0?" "+l:l);continue}v=!1}const w=s(d).join(":"),M=p?w+gz:w,E=M+b;if(a.includes(E))continue;a.push(E);const D=n(b,v);for(let T=0;T<D.length;++T){const L=D[T];a.push(M+L)}l=u+(l.length>0?" "+l:l)}return l};function Uie(){let t=0,e,i,r="";for(;t<arguments.length;)(e=arguments[t++])&&(i=g7(e))&&(r&&(r+=" "),r+=i);return r}const g7=t=>{if(typeof t=="string")return t;let e,i="";for(let r=0;r<t.length;r++)t[r]&&(e=g7(t[r]))&&(i&&(i+=" "),i+=e);return i};function Bie(t,...e){let i,r,n,s=a;function a(l){const c=e.reduce((u,h)=>h(u),t());return i=Lie(c),r=i.cache.get,n=i.cache.set,s=o,o(l)}function o(l){const c=r(l);if(c)return c;const u=zie(l,i);return n(l,u),u}return function(){return s(Uie.apply(null,arguments))}}const Sa=t=>{const e=i=>i[t]||[];return e.isThemeGetter=!0,e},v7=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,y7=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Nie=/^\d+\/\d+$/,Fie=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,kie=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Vie=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Hie=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Gie=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Wy=t=>Nie.test(t),vr=t=>!!t&&!Number.isNaN(Number(t)),bv=t=>!!t&&Number.isInteger(Number(t)),Z5=t=>t.endsWith("%")&&vr(t.slice(0,-1)),Sm=t=>Fie.test(t),jie=()=>!0,Wie=t=>kie.test(t)&&!Vie.test(t),cN=()=>!1,qie=t=>Hie.test(t),Xie=t=>Gie.test(t),Yie=t=>!ci(t)&&!ui(t),Qie=t=>ib(t,_7,cN),ci=t=>v7.test(t),_v=t=>ib(t,S7,Wie),NR=t=>ib(t,are,vr),Zie=t=>ib(t,x7,cN),Kie=t=>ib(t,b7,Xie),Jie=t=>ib(t,cN,qie),ui=t=>y7.test(t),yA=t=>rb(t,S7),$ie=t=>rb(t,ore),ere=t=>rb(t,x7),tre=t=>rb(t,_7),ire=t=>rb(t,b7),rre=t=>rb(t,lre,!0),ib=(t,e,i)=>{const r=v7.exec(t);return r?r[1]?e(r[1]):i(r[2]):!1},rb=(t,e,i=!1)=>{const r=y7.exec(t);return r?r[1]?e(r[1]):i:!1},x7=t=>t==="position",nre=new Set(["image","url"]),b7=t=>nre.has(t),sre=new Set(["length","size","percentage"]),_7=t=>sre.has(t),S7=t=>t==="length",are=t=>t==="number",ore=t=>t==="family-name",lre=t=>t==="shadow",cre=()=>{const t=Sa("color"),e=Sa("font"),i=Sa("text"),r=Sa("font-weight"),n=Sa("tracking"),s=Sa("leading"),a=Sa("breakpoint"),o=Sa("container"),l=Sa("spacing"),c=Sa("radius"),u=Sa("shadow"),h=Sa("inset-shadow"),d=Sa("drop-shadow"),p=Sa("blur"),g=Sa("perspective"),x=Sa("aspect"),v=Sa("ease"),b=Sa("animate"),w=()=>["auto","avoid","all","avoid-page","page","left","right","column"],M=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],E=()=>["auto","hidden","clip","visible","scroll"],D=()=>["auto","contain","none"],T=()=>[ui,ci,l],L=()=>[Wy,"full","auto",...T()],P=()=>[bv,"none","subgrid",ui,ci],R=()=>["auto",{span:["full",bv,ui,ci]},ui,ci],O=()=>[bv,"auto",ui,ci],U=()=>["auto","min","max","fr",ui,ci],F=()=>["start","end","center","between","around","evenly","stretch","baseline"],V=()=>["start","end","center","stretch"],k=()=>["auto",...T()],K=()=>[Wy,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...T()],X=()=>[t,ui,ci],$=()=>[Z5,_v],Y=()=>["","none","full",c,ui,ci],re=()=>["",vr,yA,_v],G=()=>["solid","dashed","dotted","double"],j=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ee=()=>["","none",p,ui,ci],oe=()=>["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ui,ci],Q=()=>["none",vr,ui,ci],ae=()=>["none",vr,ui,ci],ne=()=>[vr,ui,ci],ue=()=>[Wy,"full",...T()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Sm],breakpoint:[Sm],color:[jie],container:[Sm],"drop-shadow":[Sm],ease:["in","out","in-out"],font:[Yie],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Sm],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Sm],shadow:[Sm],spacing:["px",vr],text:[Sm],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Wy,ci,ui,x]}],container:["container"],columns:[{columns:[vr,ci,ui,o]}],"break-after":[{"break-after":w()}],"break-before":[{"break-before":w()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...M(),ci,ui]}],overflow:[{overflow:E()}],"overflow-x":[{"overflow-x":E()}],"overflow-y":[{"overflow-y":E()}],overscroll:[{overscroll:D()}],"overscroll-x":[{"overscroll-x":D()}],"overscroll-y":[{"overscroll-y":D()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:L()}],"inset-x":[{"inset-x":L()}],"inset-y":[{"inset-y":L()}],start:[{start:L()}],end:[{end:L()}],top:[{top:L()}],right:[{right:L()}],bottom:[{bottom:L()}],left:[{left:L()}],visibility:["visible","invisible","collapse"],z:[{z:[bv,"auto",ui,ci]}],basis:[{basis:[Wy,"full","auto",o,...T()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[vr,Wy,"auto","initial","none",ci]}],grow:[{grow:["",vr,ui,ci]}],shrink:[{shrink:["",vr,ui,ci]}],order:[{order:[bv,"first","last","none",ui,ci]}],"grid-cols":[{"grid-cols":P()}],"col-start-end":[{col:R()}],"col-start":[{"col-start":O()}],"col-end":[{"col-end":O()}],"grid-rows":[{"grid-rows":P()}],"row-start-end":[{row:R()}],"row-start":[{"row-start":O()}],"row-end":[{"row-end":O()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":U()}],"auto-rows":[{"auto-rows":U()}],gap:[{gap:T()}],"gap-x":[{"gap-x":T()}],"gap-y":[{"gap-y":T()}],"justify-content":[{justify:[...F(),"normal"]}],"justify-items":[{"justify-items":[...V(),"normal"]}],"justify-self":[{"justify-self":["auto",...V()]}],"align-content":[{content:["normal",...F()]}],"align-items":[{items:[...V(),"baseline"]}],"align-self":[{self:["auto",...V(),"baseline"]}],"place-content":[{"place-content":F()}],"place-items":[{"place-items":[...V(),"baseline"]}],"place-self":[{"place-self":["auto",...V()]}],p:[{p:T()}],px:[{px:T()}],py:[{py:T()}],ps:[{ps:T()}],pe:[{pe:T()}],pt:[{pt:T()}],pr:[{pr:T()}],pb:[{pb:T()}],pl:[{pl:T()}],m:[{m:k()}],mx:[{mx:k()}],my:[{my:k()}],ms:[{ms:k()}],me:[{me:k()}],mt:[{mt:k()}],mr:[{mr:k()}],mb:[{mb:k()}],ml:[{ml:k()}],"space-x":[{"space-x":T()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":T()}],"space-y-reverse":["space-y-reverse"],size:[{size:K()}],w:[{w:[o,"screen",...K()]}],"min-w":[{"min-w":[o,"screen","none",...K()]}],"max-w":[{"max-w":[o,"screen","none","prose",{screen:[a]},...K()]}],h:[{h:["screen",...K()]}],"min-h":[{"min-h":["screen","none",...K()]}],"max-h":[{"max-h":["screen",...K()]}],"font-size":[{text:["base",i,yA,_v]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[r,ui,NR]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Z5,ci]}],"font-family":[{font:[$ie,ci,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[n,ui,ci]}],"line-clamp":[{"line-clamp":[vr,"none",ui,NR]}],leading:[{leading:[s,...T()]}],"list-image":[{"list-image":["none",ui,ci]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",ui,ci]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:X()}],"text-color":[{text:X()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...G(),"wavy"]}],"text-decoration-thickness":[{decoration:[vr,"from-font","auto",ui,_v]}],"text-decoration-color":[{decoration:X()}],"underline-offset":[{"underline-offset":[vr,"auto",ui,ci]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:T()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ui,ci]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ui,ci]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...M(),ere,Zie]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","space","round"]}]}],"bg-size":[{bg:["auto","cover","contain",tre,Qie]}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},bv,ui,ci],radial:["",ui,ci],conic:[bv,ui,ci]},ire,Kie]}],"bg-color":[{bg:X()}],"gradient-from-pos":[{from:$()}],"gradient-via-pos":[{via:$()}],"gradient-to-pos":[{to:$()}],"gradient-from":[{from:X()}],"gradient-via":[{via:X()}],"gradient-to":[{to:X()}],rounded:[{rounded:Y()}],"rounded-s":[{"rounded-s":Y()}],"rounded-e":[{"rounded-e":Y()}],"rounded-t":[{"rounded-t":Y()}],"rounded-r":[{"rounded-r":Y()}],"rounded-b":[{"rounded-b":Y()}],"rounded-l":[{"rounded-l":Y()}],"rounded-ss":[{"rounded-ss":Y()}],"rounded-se":[{"rounded-se":Y()}],"rounded-ee":[{"rounded-ee":Y()}],"rounded-es":[{"rounded-es":Y()}],"rounded-tl":[{"rounded-tl":Y()}],"rounded-tr":[{"rounded-tr":Y()}],"rounded-br":[{"rounded-br":Y()}],"rounded-bl":[{"rounded-bl":Y()}],"border-w":[{border:re()}],"border-w-x":[{"border-x":re()}],"border-w-y":[{"border-y":re()}],"border-w-s":[{"border-s":re()}],"border-w-e":[{"border-e":re()}],"border-w-t":[{"border-t":re()}],"border-w-r":[{"border-r":re()}],"border-w-b":[{"border-b":re()}],"border-w-l":[{"border-l":re()}],"divide-x":[{"divide-x":re()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":re()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...G(),"hidden","none"]}],"divide-style":[{divide:[...G(),"hidden","none"]}],"border-color":[{border:X()}],"border-color-x":[{"border-x":X()}],"border-color-y":[{"border-y":X()}],"border-color-s":[{"border-s":X()}],"border-color-e":[{"border-e":X()}],"border-color-t":[{"border-t":X()}],"border-color-r":[{"border-r":X()}],"border-color-b":[{"border-b":X()}],"border-color-l":[{"border-l":X()}],"divide-color":[{divide:X()}],"outline-style":[{outline:[...G(),"none","hidden"]}],"outline-offset":[{"outline-offset":[vr,ui,ci]}],"outline-w":[{outline:["",vr,yA,_v]}],"outline-color":[{outline:[t]}],shadow:[{shadow:["","none",u,rre,Jie]}],"shadow-color":[{shadow:X()}],"inset-shadow":[{"inset-shadow":["none",ui,ci,h]}],"inset-shadow-color":[{"inset-shadow":X()}],"ring-w":[{ring:re()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:X()}],"ring-offset-w":[{"ring-offset":[vr,_v]}],"ring-offset-color":[{"ring-offset":X()}],"inset-ring-w":[{"inset-ring":re()}],"inset-ring-color":[{"inset-ring":X()}],opacity:[{opacity:[vr,ui,ci]}],"mix-blend":[{"mix-blend":[...j(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":j()}],filter:[{filter:["","none",ui,ci]}],blur:[{blur:ee()}],brightness:[{brightness:[vr,ui,ci]}],contrast:[{contrast:[vr,ui,ci]}],"drop-shadow":[{"drop-shadow":["","none",d,ui,ci]}],grayscale:[{grayscale:["",vr,ui,ci]}],"hue-rotate":[{"hue-rotate":[vr,ui,ci]}],invert:[{invert:["",vr,ui,ci]}],saturate:[{saturate:[vr,ui,ci]}],sepia:[{sepia:["",vr,ui,ci]}],"backdrop-filter":[{"backdrop-filter":["","none",ui,ci]}],"backdrop-blur":[{"backdrop-blur":ee()}],"backdrop-brightness":[{"backdrop-brightness":[vr,ui,ci]}],"backdrop-contrast":[{"backdrop-contrast":[vr,ui,ci]}],"backdrop-grayscale":[{"backdrop-grayscale":["",vr,ui,ci]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[vr,ui,ci]}],"backdrop-invert":[{"backdrop-invert":["",vr,ui,ci]}],"backdrop-opacity":[{"backdrop-opacity":[vr,ui,ci]}],"backdrop-saturate":[{"backdrop-saturate":[vr,ui,ci]}],"backdrop-sepia":[{"backdrop-sepia":["",vr,ui,ci]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":T()}],"border-spacing-x":[{"border-spacing-x":T()}],"border-spacing-y":[{"border-spacing-y":T()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",ui,ci]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[vr,"initial",ui,ci]}],ease:[{ease:["linear","initial",v,ui,ci]}],delay:[{delay:[vr,ui,ci]}],animate:[{animate:["none",b,ui,ci]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[g,ui,ci]}],"perspective-origin":[{"perspective-origin":oe()}],rotate:[{rotate:Q()}],"rotate-x":[{"rotate-x":Q()}],"rotate-y":[{"rotate-y":Q()}],"rotate-z":[{"rotate-z":Q()}],scale:[{scale:ae()}],"scale-x":[{"scale-x":ae()}],"scale-y":[{"scale-y":ae()}],"scale-z":[{"scale-z":ae()}],"scale-3d":["scale-3d"],skew:[{skew:ne()}],"skew-x":[{"skew-x":ne()}],"skew-y":[{"skew-y":ne()}],transform:[{transform:[ui,ci,"","none","gpu","cpu"]}],"transform-origin":[{origin:oe()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:ue()}],"translate-x":[{"translate-x":ue()}],"translate-y":[{"translate-y":ue()}],"translate-z":[{"translate-z":ue()}],"translate-none":["translate-none"],accent:[{accent:X()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:X()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ui,ci]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":T()}],"scroll-mx":[{"scroll-mx":T()}],"scroll-my":[{"scroll-my":T()}],"scroll-ms":[{"scroll-ms":T()}],"scroll-me":[{"scroll-me":T()}],"scroll-mt":[{"scroll-mt":T()}],"scroll-mr":[{"scroll-mr":T()}],"scroll-mb":[{"scroll-mb":T()}],"scroll-ml":[{"scroll-ml":T()}],"scroll-p":[{"scroll-p":T()}],"scroll-px":[{"scroll-px":T()}],"scroll-py":[{"scroll-py":T()}],"scroll-ps":[{"scroll-ps":T()}],"scroll-pe":[{"scroll-pe":T()}],"scroll-pt":[{"scroll-pt":T()}],"scroll-pr":[{"scroll-pr":T()}],"scroll-pb":[{"scroll-pb":T()}],"scroll-pl":[{"scroll-pl":T()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ui,ci]}],fill:[{fill:["none",...X()]}],"stroke-w":[{stroke:[vr,yA,_v,NR]}],stroke:[{stroke:["none",...X()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["before","after","placeholder","file","marker","selection","first-line","first-letter","backdrop","*","**"]}},ure=Bie(cre);function Gd(...t){return ure(p7(t))}const hre=wie("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function w3({className:t,variant:e,size:i,asChild:r=!1,...n}){const s=r?oN:"button";return Pe.jsx(s,{"data-slot":"button",className:Gd(hre({variant:e,size:i,className:t})),...n})}function w7({className:t,type:e,...i}){return Pe.jsx("input",{type:e,"data-slot":"input",className:Gd("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...i})}function M7(t,e){return function(){return t.apply(e,arguments)}}const{toString:dre}=Object.prototype,{getPrototypeOf:uN}=Object,M3=(t=>e=>{const i=dre.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Sh=t=>(t=t.toLowerCase(),e=>M3(e)===t),E3=t=>e=>typeof e===t,{isArray:nb}=Array,Sw=E3("undefined");function fre(t){return t!==null&&!Sw(t)&&t.constructor!==null&&!Sw(t.constructor)&&yc(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const E7=Sh("ArrayBuffer");function pre(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&E7(t.buffer),e}const mre=E3("string"),yc=E3("function"),A7=E3("number"),A3=t=>t!==null&&typeof t=="object",gre=t=>t===!0||t===!1,HT=t=>{if(M3(t)!=="object")return!1;const e=uN(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},vre=Sh("Date"),yre=Sh("File"),xre=Sh("Blob"),bre=Sh("FileList"),_re=t=>A3(t)&&yc(t.pipe),Sre=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||yc(t.append)&&((e=M3(t))==="formdata"||e==="object"&&yc(t.toString)&&t.toString()==="[object FormData]"))},wre=Sh("URLSearchParams"),[Mre,Ere,Are,Tre]=["ReadableStream","Request","Response","Headers"].map(Sh),Cre=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function gM(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let r,n;if(typeof t!="object"&&(t=[t]),nb(t))for(r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else{const s=i?Object.getOwnPropertyNames(t):Object.keys(t),a=s.length;let o;for(r=0;r<a;r++)o=s[r],e.call(null,t[o],o,t)}}function T7(t,e){e=e.toLowerCase();const i=Object.keys(t);let r=i.length,n;for(;r-- >0;)if(n=i[r],e===n.toLowerCase())return n;return null}const s0=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,C7=t=>!Sw(t)&&t!==s0;function yz(){const{caseless:t}=C7(this)&&this||{},e={},i=(r,n)=>{const s=t&&T7(e,n)||n;HT(e[s])&&HT(r)?e[s]=yz(e[s],r):HT(r)?e[s]=yz({},r):nb(r)?e[s]=r.slice():e[s]=r};for(let r=0,n=arguments.length;r<n;r++)arguments[r]&&gM(arguments[r],i);return e}const Dre=(t,e,i,{allOwnKeys:r}={})=>(gM(e,(n,s)=>{i&&yc(n)?t[s]=M7(n,i):t[s]=n},{allOwnKeys:r}),t),Pre=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Rre=(t,e,i,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},Ore=(t,e,i,r)=>{let n,s,a;const o={};if(e=e||{},t==null)return e;do{for(n=Object.getOwnPropertyNames(t),s=n.length;s-- >0;)a=n[s],(!r||r(a,t,e))&&!o[a]&&(e[a]=t[a],o[a]=!0);t=i!==!1&&uN(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},Lre=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const r=t.indexOf(e,i);return r!==-1&&r===i},Ire=t=>{if(!t)return null;if(nb(t))return t;let e=t.length;if(!A7(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},zre=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&uN(Uint8Array)),Ure=(t,e)=>{const r=(t&&t[Symbol.iterator]).call(t);let n;for(;(n=r.next())&&!n.done;){const s=n.value;e.call(t,s[0],s[1])}},Bre=(t,e)=>{let i;const r=[];for(;(i=t.exec(e))!==null;)r.push(i);return r},Nre=Sh("HTMLFormElement"),Fre=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,r,n){return r.toUpperCase()+n}),K5=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),kre=Sh("RegExp"),D7=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),r={};gM(i,(n,s)=>{let a;(a=e(n,s,t))!==!1&&(r[s]=a||n)}),Object.defineProperties(t,r)},Vre=t=>{D7(t,(e,i)=>{if(yc(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const r=t[i];if(yc(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},Hre=(t,e)=>{const i={},r=n=>{n.forEach(s=>{i[s]=!0})};return nb(t)?r(t):r(String(t).split(e)),i},Gre=()=>{},jre=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function Wre(t){return!!(t&&yc(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const qre=t=>{const e=new Array(10),i=(r,n)=>{if(A3(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[n]=r;const s=nb(r)?[]:{};return gM(r,(a,o)=>{const l=i(a,n+1);!Sw(l)&&(s[o]=l)}),e[n]=void 0,s}}return r};return i(t,0)},Xre=Sh("AsyncFunction"),Yre=t=>t&&(A3(t)||yc(t))&&yc(t.then)&&yc(t.catch),P7=((t,e)=>t?setImmediate:e?((i,r)=>(s0.addEventListener("message",({source:n,data:s})=>{n===s0&&s===i&&r.length&&r.shift()()},!1),n=>{r.push(n),s0.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",yc(s0.postMessage)),Qre=typeof queueMicrotask<"u"?queueMicrotask.bind(s0):typeof process<"u"&&process.nextTick||P7,_t={isArray:nb,isArrayBuffer:E7,isBuffer:fre,isFormData:Sre,isArrayBufferView:pre,isString:mre,isNumber:A7,isBoolean:gre,isObject:A3,isPlainObject:HT,isReadableStream:Mre,isRequest:Ere,isResponse:Are,isHeaders:Tre,isUndefined:Sw,isDate:vre,isFile:yre,isBlob:xre,isRegExp:kre,isFunction:yc,isStream:_re,isURLSearchParams:wre,isTypedArray:zre,isFileList:bre,forEach:gM,merge:yz,extend:Dre,trim:Cre,stripBOM:Pre,inherits:Rre,toFlatObject:Ore,kindOf:M3,kindOfTest:Sh,endsWith:Lre,toArray:Ire,forEachEntry:Ure,matchAll:Bre,isHTMLForm:Nre,hasOwnProperty:K5,hasOwnProp:K5,reduceDescriptors:D7,freezeMethods:Vre,toObjectSet:Hre,toCamelCase:Fre,noop:Gre,toFiniteNumber:jre,findKey:T7,global:s0,isContextDefined:C7,isSpecCompliantForm:Wre,toJSONObject:qre,isAsyncFn:Xre,isThenable:Yre,setImmediate:P7,asap:Qre};function er(t,e,i,r,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),r&&(this.request=r),n&&(this.response=n,this.status=n.status?n.status:null)}_t.inherits(er,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:_t.toJSONObject(this.config),code:this.code,status:this.status}}});const R7=er.prototype,O7={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{O7[t]={value:t}});Object.defineProperties(er,O7);Object.defineProperty(R7,"isAxiosError",{value:!0});er.from=(t,e,i,r,n,s)=>{const a=Object.create(R7);return _t.toFlatObject(t,a,function(l){return l!==Error.prototype},o=>o!=="isAxiosError"),er.call(a,t.message,e,i,r,n),a.cause=t,a.name=t.name,s&&Object.assign(a,s),a};const Zre=null;function xz(t){return _t.isPlainObject(t)||_t.isArray(t)}function L7(t){return _t.endsWith(t,"[]")?t.slice(0,-2):t}function J5(t,e,i){return t?t.concat(e).map(function(n,s){return n=L7(n),!i&&s?"["+n+"]":n}).join(i?".":""):e}function Kre(t){return _t.isArray(t)&&!t.some(xz)}const Jre=_t.toFlatObject(_t,{},null,function(e){return/^is[A-Z]/.test(e)});function T3(t,e,i){if(!_t.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=_t.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(x,v){return!_t.isUndefined(v[x])});const r=i.metaTokens,n=i.visitor||u,s=i.dots,a=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&_t.isSpecCompliantForm(e);if(!_t.isFunction(n))throw new TypeError("visitor must be a function");function c(g){if(g===null)return"";if(_t.isDate(g))return g.toISOString();if(!l&&_t.isBlob(g))throw new er("Blob is not supported. Use a Buffer instead.");return _t.isArrayBuffer(g)||_t.isTypedArray(g)?l&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function u(g,x,v){let b=g;if(g&&!v&&typeof g=="object"){if(_t.endsWith(x,"{}"))x=r?x:x.slice(0,-2),g=JSON.stringify(g);else if(_t.isArray(g)&&Kre(g)||(_t.isFileList(g)||_t.endsWith(x,"[]"))&&(b=_t.toArray(g)))return x=L7(x),b.forEach(function(M,E){!(_t.isUndefined(M)||M===null)&&e.append(a===!0?J5([x],E,s):a===null?x:x+"[]",c(M))}),!1}return xz(g)?!0:(e.append(J5(v,x,s),c(g)),!1)}const h=[],d=Object.assign(Jre,{defaultVisitor:u,convertValue:c,isVisitable:xz});function p(g,x){if(!_t.isUndefined(g)){if(h.indexOf(g)!==-1)throw Error("Circular reference detected in "+x.join("."));h.push(g),_t.forEach(g,function(b,w){(!(_t.isUndefined(b)||b===null)&&n.call(e,b,_t.isString(w)?w.trim():w,x,d))===!0&&p(b,x?x.concat(w):[w])}),h.pop()}}if(!_t.isObject(t))throw new TypeError("data must be an object");return p(t),e}function $5(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function hN(t,e){this._pairs=[],t&&T3(t,this,e)}const I7=hN.prototype;I7.append=function(e,i){this._pairs.push([e,i])};I7.toString=function(e){const i=e?function(r){return e.call(this,r,$5)}:$5;return this._pairs.map(function(n){return i(n[0])+"="+i(n[1])},"").join("&")};function $re(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function z7(t,e,i){if(!e)return t;const r=i&&i.encode||$re;_t.isFunction(i)&&(i={serialize:i});const n=i&&i.serialize;let s;if(n?s=n(e,i):s=_t.isURLSearchParams(e)?e.toString():new hN(e,i).toString(r),s){const a=t.indexOf("#");a!==-1&&(t=t.slice(0,a)),t+=(t.indexOf("?")===-1?"?":"&")+s}return t}class ek{constructor(){this.handlers=[]}use(e,i,r){return this.handlers.push({fulfilled:e,rejected:i,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){_t.forEach(this.handlers,function(r){r!==null&&e(r)})}}const U7={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ene=typeof URLSearchParams<"u"?URLSearchParams:hN,tne=typeof FormData<"u"?FormData:null,ine=typeof Blob<"u"?Blob:null,rne={isBrowser:!0,classes:{URLSearchParams:ene,FormData:tne,Blob:ine},protocols:["http","https","file","blob","url","data"]},dN=typeof window<"u"&&typeof document<"u",bz=typeof navigator=="object"&&navigator||void 0,nne=dN&&(!bz||["ReactNative","NativeScript","NS"].indexOf(bz.product)<0),sne=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ane=dN&&window.location.href||"http://localhost",one=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:dN,hasStandardBrowserEnv:nne,hasStandardBrowserWebWorkerEnv:sne,navigator:bz,origin:ane},Symbol.toStringTag,{value:"Module"})),Po={...one,...rne};function lne(t,e){return T3(t,new Po.classes.URLSearchParams,Object.assign({visitor:function(i,r,n,s){return Po.isNode&&_t.isBuffer(i)?(this.append(r,i.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function cne(t){return _t.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function une(t){const e={},i=Object.keys(t);let r;const n=i.length;let s;for(r=0;r<n;r++)s=i[r],e[s]=t[s];return e}function B7(t){function e(i,r,n,s){let a=i[s++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),l=s>=i.length;return a=!a&&_t.isArray(n)?n.length:a,l?(_t.hasOwnProp(n,a)?n[a]=[n[a],r]:n[a]=r,!o):((!n[a]||!_t.isObject(n[a]))&&(n[a]=[]),e(i,r,n[a],s)&&_t.isArray(n[a])&&(n[a]=une(n[a])),!o)}if(_t.isFormData(t)&&_t.isFunction(t.entries)){const i={};return _t.forEachEntry(t,(r,n)=>{e(cne(r),n,i,0)}),i}return null}function hne(t,e,i){if(_t.isString(t))try{return(e||JSON.parse)(t),_t.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(i||JSON.stringify)(t)}const vM={transitional:U7,adapter:["xhr","http","fetch"],transformRequest:[function(e,i){const r=i.getContentType()||"",n=r.indexOf("application/json")>-1,s=_t.isObject(e);if(s&&_t.isHTMLForm(e)&&(e=new FormData(e)),_t.isFormData(e))return n?JSON.stringify(B7(e)):e;if(_t.isArrayBuffer(e)||_t.isBuffer(e)||_t.isStream(e)||_t.isFile(e)||_t.isBlob(e)||_t.isReadableStream(e))return e;if(_t.isArrayBufferView(e))return e.buffer;if(_t.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(s){if(r.indexOf("application/x-www-form-urlencoded")>-1)return lne(e,this.formSerializer).toString();if((o=_t.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return T3(o?{"files[]":e}:e,l&&new l,this.formSerializer)}}return s||n?(i.setContentType("application/json",!1),hne(e)):e}],transformResponse:[function(e){const i=this.transitional||vM.transitional,r=i&&i.forcedJSONParsing,n=this.responseType==="json";if(_t.isResponse(e)||_t.isReadableStream(e))return e;if(e&&_t.isString(e)&&(r&&!this.responseType||n)){const a=!(i&&i.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(o){if(a)throw o.name==="SyntaxError"?er.from(o,er.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Po.classes.FormData,Blob:Po.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};_t.forEach(["delete","get","head","post","put","patch"],t=>{vM.headers[t]={}});const dne=_t.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),fne=t=>{const e={};let i,r,n;return t&&t.split(`
`).forEach(function(a){n=a.indexOf(":"),i=a.substring(0,n).trim().toLowerCase(),r=a.substring(n+1).trim(),!(!i||e[i]&&dne[i])&&(i==="set-cookie"?e[i]?e[i].push(r):e[i]=[r]:e[i]=e[i]?e[i]+", "+r:r)}),e},tk=Symbol("internals");function V_(t){return t&&String(t).trim().toLowerCase()}function GT(t){return t===!1||t==null?t:_t.isArray(t)?t.map(GT):String(t)}function pne(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=i.exec(t);)e[r[1]]=r[2];return e}const mne=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function FR(t,e,i,r,n){if(_t.isFunction(r))return r.call(this,e,i);if(n&&(e=i),!!_t.isString(e)){if(_t.isString(r))return e.indexOf(r)!==-1;if(_t.isRegExp(r))return r.test(e)}}function gne(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,r)=>i.toUpperCase()+r)}function vne(t,e){const i=_t.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+i,{value:function(n,s,a){return this[r].call(this,e,n,s,a)},configurable:!0})})}let Wl=class{constructor(e){e&&this.set(e)}set(e,i,r){const n=this;function s(o,l,c){const u=V_(l);if(!u)throw new Error("header name must be a non-empty string");const h=_t.findKey(n,u);(!h||n[h]===void 0||c===!0||c===void 0&&n[h]!==!1)&&(n[h||l]=GT(o))}const a=(o,l)=>_t.forEach(o,(c,u)=>s(c,u,l));if(_t.isPlainObject(e)||e instanceof this.constructor)a(e,i);else if(_t.isString(e)&&(e=e.trim())&&!mne(e))a(fne(e),i);else if(_t.isHeaders(e))for(const[o,l]of e.entries())s(l,o,r);else e!=null&&s(i,e,r);return this}get(e,i){if(e=V_(e),e){const r=_t.findKey(this,e);if(r){const n=this[r];if(!i)return n;if(i===!0)return pne(n);if(_t.isFunction(i))return i.call(this,n,r);if(_t.isRegExp(i))return i.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=V_(e),e){const r=_t.findKey(this,e);return!!(r&&this[r]!==void 0&&(!i||FR(this,this[r],r,i)))}return!1}delete(e,i){const r=this;let n=!1;function s(a){if(a=V_(a),a){const o=_t.findKey(r,a);o&&(!i||FR(r,r[o],o,i))&&(delete r[o],n=!0)}}return _t.isArray(e)?e.forEach(s):s(e),n}clear(e){const i=Object.keys(this);let r=i.length,n=!1;for(;r--;){const s=i[r];(!e||FR(this,this[s],s,e,!0))&&(delete this[s],n=!0)}return n}normalize(e){const i=this,r={};return _t.forEach(this,(n,s)=>{const a=_t.findKey(r,s);if(a){i[a]=GT(n),delete i[s];return}const o=e?gne(s):String(s).trim();o!==s&&delete i[s],i[o]=GT(n),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return _t.forEach(this,(r,n)=>{r!=null&&r!==!1&&(i[n]=e&&_t.isArray(r)?r.join(", "):r)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const r=new this(e);return i.forEach(n=>r.set(n)),r}static accessor(e){const r=(this[tk]=this[tk]={accessors:{}}).accessors,n=this.prototype;function s(a){const o=V_(a);r[o]||(vne(n,a),r[o]=!0)}return _t.isArray(e)?e.forEach(s):s(e),this}};Wl.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);_t.reduceDescriptors(Wl.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[i]=r}}});_t.freezeMethods(Wl);function kR(t,e){const i=this||vM,r=e||i,n=Wl.from(r.headers);let s=r.data;return _t.forEach(t,function(o){s=o.call(i,s,n.normalize(),e?e.status:void 0)}),n.normalize(),s}function N7(t){return!!(t&&t.__CANCEL__)}function sb(t,e,i){er.call(this,t??"canceled",er.ERR_CANCELED,e,i),this.name="CanceledError"}_t.inherits(sb,er,{__CANCEL__:!0});function F7(t,e,i){const r=i.config.validateStatus;!i.status||!r||r(i.status)?t(i):e(new er("Request failed with status code "+i.status,[er.ERR_BAD_REQUEST,er.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function yne(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function xne(t,e){t=t||10;const i=new Array(t),r=new Array(t);let n=0,s=0,a;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),u=r[s];a||(a=c),i[n]=l,r[n]=c;let h=s,d=0;for(;h!==n;)d+=i[h++],h=h%t;if(n=(n+1)%t,n===s&&(s=(s+1)%t),c-a<e)return;const p=u&&c-u;return p?Math.round(d*1e3/p):void 0}}function bne(t,e){let i=0,r=1e3/e,n,s;const a=(c,u=Date.now())=>{i=u,n=null,s&&(clearTimeout(s),s=null),t.apply(null,c)};return[(...c)=>{const u=Date.now(),h=u-i;h>=r?a(c,u):(n=c,s||(s=setTimeout(()=>{s=null,a(n)},r-h)))},()=>n&&a(n)]}const bC=(t,e,i=3)=>{let r=0;const n=xne(50,250);return bne(s=>{const a=s.loaded,o=s.lengthComputable?s.total:void 0,l=a-r,c=n(l),u=a<=o;r=a;const h={loaded:a,total:o,progress:o?a/o:void 0,bytes:l,rate:c||void 0,estimated:c&&o&&u?(o-a)/c:void 0,event:s,lengthComputable:o!=null,[e?"download":"upload"]:!0};t(h)},i)},ik=(t,e)=>{const i=t!=null;return[r=>e[0]({lengthComputable:i,total:t,loaded:r}),e[1]]},rk=t=>(...e)=>_t.asap(()=>t(...e)),_ne=Po.hasStandardBrowserEnv?((t,e)=>i=>(i=new URL(i,Po.origin),t.protocol===i.protocol&&t.host===i.host&&(e||t.port===i.port)))(new URL(Po.origin),Po.navigator&&/(msie|trident)/i.test(Po.navigator.userAgent)):()=>!0,Sne=Po.hasStandardBrowserEnv?{write(t,e,i,r,n,s){const a=[t+"="+encodeURIComponent(e)];_t.isNumber(i)&&a.push("expires="+new Date(i).toGMTString()),_t.isString(r)&&a.push("path="+r),_t.isString(n)&&a.push("domain="+n),s===!0&&a.push("secure"),document.cookie=a.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function wne(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function Mne(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function k7(t,e,i){let r=!wne(e);return t&&(r||i==!1)?Mne(t,e):e}const nk=t=>t instanceof Wl?{...t}:t;function P0(t,e){e=e||{};const i={};function r(c,u,h,d){return _t.isPlainObject(c)&&_t.isPlainObject(u)?_t.merge.call({caseless:d},c,u):_t.isPlainObject(u)?_t.merge({},u):_t.isArray(u)?u.slice():u}function n(c,u,h,d){if(_t.isUndefined(u)){if(!_t.isUndefined(c))return r(void 0,c,h,d)}else return r(c,u,h,d)}function s(c,u){if(!_t.isUndefined(u))return r(void 0,u)}function a(c,u){if(_t.isUndefined(u)){if(!_t.isUndefined(c))return r(void 0,c)}else return r(void 0,u)}function o(c,u,h){if(h in e)return r(c,u);if(h in t)return r(void 0,c)}const l={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(c,u,h)=>n(nk(c),nk(u),h,!0)};return _t.forEach(Object.keys(Object.assign({},t,e)),function(u){const h=l[u]||n,d=h(t[u],e[u],u);_t.isUndefined(d)&&h!==o||(i[u]=d)}),i}const V7=t=>{const e=P0({},t);let{data:i,withXSRFToken:r,xsrfHeaderName:n,xsrfCookieName:s,headers:a,auth:o}=e;e.headers=a=Wl.from(a),e.url=z7(k7(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let l;if(_t.isFormData(i)){if(Po.hasStandardBrowserEnv||Po.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((l=a.getContentType())!==!1){const[c,...u]=l?l.split(";").map(h=>h.trim()).filter(Boolean):[];a.setContentType([c||"multipart/form-data",...u].join("; "))}}if(Po.hasStandardBrowserEnv&&(r&&_t.isFunction(r)&&(r=r(e)),r||r!==!1&&_ne(e.url))){const c=n&&s&&Sne.read(s);c&&a.set(n,c)}return e},Ene=typeof XMLHttpRequest<"u",Ane=Ene&&function(t){return new Promise(function(i,r){const n=V7(t);let s=n.data;const a=Wl.from(n.headers).normalize();let{responseType:o,onUploadProgress:l,onDownloadProgress:c}=n,u,h,d,p,g;function x(){p&&p(),g&&g(),n.cancelToken&&n.cancelToken.unsubscribe(u),n.signal&&n.signal.removeEventListener("abort",u)}let v=new XMLHttpRequest;v.open(n.method.toUpperCase(),n.url,!0),v.timeout=n.timeout;function b(){if(!v)return;const M=Wl.from("getAllResponseHeaders"in v&&v.getAllResponseHeaders()),D={data:!o||o==="text"||o==="json"?v.responseText:v.response,status:v.status,statusText:v.statusText,headers:M,config:t,request:v};F7(function(L){i(L),x()},function(L){r(L),x()},D),v=null}"onloadend"in v?v.onloadend=b:v.onreadystatechange=function(){!v||v.readyState!==4||v.status===0&&!(v.responseURL&&v.responseURL.indexOf("file:")===0)||setTimeout(b)},v.onabort=function(){v&&(r(new er("Request aborted",er.ECONNABORTED,t,v)),v=null)},v.onerror=function(){r(new er("Network Error",er.ERR_NETWORK,t,v)),v=null},v.ontimeout=function(){let E=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const D=n.transitional||U7;n.timeoutErrorMessage&&(E=n.timeoutErrorMessage),r(new er(E,D.clarifyTimeoutError?er.ETIMEDOUT:er.ECONNABORTED,t,v)),v=null},s===void 0&&a.setContentType(null),"setRequestHeader"in v&&_t.forEach(a.toJSON(),function(E,D){v.setRequestHeader(D,E)}),_t.isUndefined(n.withCredentials)||(v.withCredentials=!!n.withCredentials),o&&o!=="json"&&(v.responseType=n.responseType),c&&([d,g]=bC(c,!0),v.addEventListener("progress",d)),l&&v.upload&&([h,p]=bC(l),v.upload.addEventListener("progress",h),v.upload.addEventListener("loadend",p)),(n.cancelToken||n.signal)&&(u=M=>{v&&(r(!M||M.type?new sb(null,t,v):M),v.abort(),v=null)},n.cancelToken&&n.cancelToken.subscribe(u),n.signal&&(n.signal.aborted?u():n.signal.addEventListener("abort",u)));const w=yne(n.url);if(w&&Po.protocols.indexOf(w)===-1){r(new er("Unsupported protocol "+w+":",er.ERR_BAD_REQUEST,t));return}v.send(s||null)})},Tne=(t,e)=>{const{length:i}=t=t?t.filter(Boolean):[];if(e||i){let r=new AbortController,n;const s=function(c){if(!n){n=!0,o();const u=c instanceof Error?c:this.reason;r.abort(u instanceof er?u:new sb(u instanceof Error?u.message:u))}};let a=e&&setTimeout(()=>{a=null,s(new er(`timeout ${e} of ms exceeded`,er.ETIMEDOUT))},e);const o=()=>{t&&(a&&clearTimeout(a),a=null,t.forEach(c=>{c.unsubscribe?c.unsubscribe(s):c.removeEventListener("abort",s)}),t=null)};t.forEach(c=>c.addEventListener("abort",s));const{signal:l}=r;return l.unsubscribe=()=>_t.asap(o),l}},Cne=function*(t,e){let i=t.byteLength;if(i<e){yield t;return}let r=0,n;for(;r<i;)n=r+e,yield t.slice(r,n),r=n},Dne=async function*(t,e){for await(const i of Pne(t))yield*Cne(i,e)},Pne=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:i,value:r}=await e.read();if(i)break;yield r}}finally{await e.cancel()}},sk=(t,e,i,r)=>{const n=Dne(t,e);let s=0,a,o=l=>{a||(a=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:c,value:u}=await n.next();if(c){o(),l.close();return}let h=u.byteLength;if(i){let d=s+=h;i(d)}l.enqueue(new Uint8Array(u))}catch(c){throw o(c),c}},cancel(l){return o(l),n.return()}},{highWaterMark:2})},C3=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",H7=C3&&typeof ReadableStream=="function",Rne=C3&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),G7=(t,...e)=>{try{return!!t(...e)}catch{return!1}},One=H7&&G7(()=>{let t=!1;const e=new Request(Po.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),ak=64*1024,_z=H7&&G7(()=>_t.isReadableStream(new Response("").body)),_C={stream:_z&&(t=>t.body)};C3&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!_C[e]&&(_C[e]=_t.isFunction(t[e])?i=>i[e]():(i,r)=>{throw new er(`Response type '${e}' is not supported`,er.ERR_NOT_SUPPORT,r)})})})(new Response);const Lne=async t=>{if(t==null)return 0;if(_t.isBlob(t))return t.size;if(_t.isSpecCompliantForm(t))return(await new Request(Po.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(_t.isArrayBufferView(t)||_t.isArrayBuffer(t))return t.byteLength;if(_t.isURLSearchParams(t)&&(t=t+""),_t.isString(t))return(await Rne(t)).byteLength},Ine=async(t,e)=>{const i=_t.toFiniteNumber(t.getContentLength());return i??Lne(e)},zne=C3&&(async t=>{let{url:e,method:i,data:r,signal:n,cancelToken:s,timeout:a,onDownloadProgress:o,onUploadProgress:l,responseType:c,headers:u,withCredentials:h="same-origin",fetchOptions:d}=V7(t);c=c?(c+"").toLowerCase():"text";let p=Tne([n,s&&s.toAbortSignal()],a),g;const x=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let v;try{if(l&&One&&i!=="get"&&i!=="head"&&(v=await Ine(u,r))!==0){let D=new Request(e,{method:"POST",body:r,duplex:"half"}),T;if(_t.isFormData(r)&&(T=D.headers.get("content-type"))&&u.setContentType(T),D.body){const[L,P]=ik(v,bC(rk(l)));r=sk(D.body,ak,L,P)}}_t.isString(h)||(h=h?"include":"omit");const b="credentials"in Request.prototype;g=new Request(e,{...d,signal:p,method:i.toUpperCase(),headers:u.normalize().toJSON(),body:r,duplex:"half",credentials:b?h:void 0});let w=await fetch(g);const M=_z&&(c==="stream"||c==="response");if(_z&&(o||M&&x)){const D={};["status","statusText","headers"].forEach(R=>{D[R]=w[R]});const T=_t.toFiniteNumber(w.headers.get("content-length")),[L,P]=o&&ik(T,bC(rk(o),!0))||[];w=new Response(sk(w.body,ak,L,()=>{P&&P(),x&&x()}),D)}c=c||"text";let E=await _C[_t.findKey(_C,c)||"text"](w,t);return!M&&x&&x(),await new Promise((D,T)=>{F7(D,T,{data:E,headers:Wl.from(w.headers),status:w.status,statusText:w.statusText,config:t,request:g})})}catch(b){throw x&&x(),b&&b.name==="TypeError"&&/fetch/i.test(b.message)?Object.assign(new er("Network Error",er.ERR_NETWORK,t,g),{cause:b.cause||b}):er.from(b,b&&b.code,t,g)}}),Sz={http:Zre,xhr:Ane,fetch:zne};_t.forEach(Sz,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const ok=t=>`- ${t}`,Une=t=>_t.isFunction(t)||t===null||t===!1,j7={getAdapter:t=>{t=_t.isArray(t)?t:[t];const{length:e}=t;let i,r;const n={};for(let s=0;s<e;s++){i=t[s];let a;if(r=i,!Une(i)&&(r=Sz[(a=String(i)).toLowerCase()],r===void 0))throw new er(`Unknown adapter '${a}'`);if(r)break;n[a||"#"+s]=r}if(!r){const s=Object.entries(n).map(([o,l])=>`adapter ${o} `+(l===!1?"is not supported by the environment":"is not available in the build"));let a=e?s.length>1?`since :
`+s.map(ok).join(`
`):" "+ok(s[0]):"as no adapter specified";throw new er("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return r},adapters:Sz};function VR(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new sb(null,t)}function lk(t){return VR(t),t.headers=Wl.from(t.headers),t.data=kR.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),j7.getAdapter(t.adapter||vM.adapter)(t).then(function(r){return VR(t),r.data=kR.call(t,t.transformResponse,r),r.headers=Wl.from(r.headers),r},function(r){return N7(r)||(VR(t),r&&r.response&&(r.response.data=kR.call(t,t.transformResponse,r.response),r.response.headers=Wl.from(r.response.headers))),Promise.reject(r)})}const W7="1.8.4",D3={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{D3[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const ck={};D3.transitional=function(e,i,r){function n(s,a){return"[Axios v"+W7+"] Transitional option '"+s+"'"+a+(r?". "+r:"")}return(s,a,o)=>{if(e===!1)throw new er(n(a," has been removed"+(i?" in "+i:"")),er.ERR_DEPRECATED);return i&&!ck[a]&&(ck[a]=!0,console.warn(n(a," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(s,a,o):!0}};D3.spelling=function(e){return(i,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function Bne(t,e,i){if(typeof t!="object")throw new er("options must be an object",er.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let n=r.length;for(;n-- >0;){const s=r[n],a=e[s];if(a){const o=t[s],l=o===void 0||a(o,s,t);if(l!==!0)throw new er("option "+s+" must be "+l,er.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new er("Unknown option "+s,er.ERR_BAD_OPTION)}}const jT={assertOptions:Bne,validators:D3},hd=jT.validators;let v0=class{constructor(e){this.defaults=e,this.interceptors={request:new ek,response:new ek}}async request(e,i){try{return await this._request(e,i)}catch(r){if(r instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const s=n.stack?n.stack.replace(/^.+\n/,""):"";try{r.stack?s&&!String(r.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+s):r.stack=s}catch{}}throw r}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=P0(this.defaults,i);const{transitional:r,paramsSerializer:n,headers:s}=i;r!==void 0&&jT.assertOptions(r,{silentJSONParsing:hd.transitional(hd.boolean),forcedJSONParsing:hd.transitional(hd.boolean),clarifyTimeoutError:hd.transitional(hd.boolean)},!1),n!=null&&(_t.isFunction(n)?i.paramsSerializer={serialize:n}:jT.assertOptions(n,{encode:hd.function,serialize:hd.function},!0)),i.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?i.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:i.allowAbsoluteUrls=!0),jT.assertOptions(i,{baseUrl:hd.spelling("baseURL"),withXsrfToken:hd.spelling("withXSRFToken")},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let a=s&&_t.merge(s.common,s[i.method]);s&&_t.forEach(["delete","get","head","post","put","patch","common"],g=>{delete s[g]}),i.headers=Wl.concat(a,s);const o=[];let l=!0;this.interceptors.request.forEach(function(x){typeof x.runWhen=="function"&&x.runWhen(i)===!1||(l=l&&x.synchronous,o.unshift(x.fulfilled,x.rejected))});const c=[];this.interceptors.response.forEach(function(x){c.push(x.fulfilled,x.rejected)});let u,h=0,d;if(!l){const g=[lk.bind(this),void 0];for(g.unshift.apply(g,o),g.push.apply(g,c),d=g.length,u=Promise.resolve(i);h<d;)u=u.then(g[h++],g[h++]);return u}d=o.length;let p=i;for(h=0;h<d;){const g=o[h++],x=o[h++];try{p=g(p)}catch(v){x.call(this,v);break}}try{u=lk.call(this,p)}catch(g){return Promise.reject(g)}for(h=0,d=c.length;h<d;)u=u.then(c[h++],c[h++]);return u}getUri(e){e=P0(this.defaults,e);const i=k7(e.baseURL,e.url,e.allowAbsoluteUrls);return z7(i,e.params,e.paramsSerializer)}};_t.forEach(["delete","get","head","options"],function(e){v0.prototype[e]=function(i,r){return this.request(P0(r||{},{method:e,url:i,data:(r||{}).data}))}});_t.forEach(["post","put","patch"],function(e){function i(r){return function(s,a,o){return this.request(P0(o||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:s,data:a}))}}v0.prototype[e]=i(),v0.prototype[e+"Form"]=i(!0)});let Nne=class q7{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(s){i=s});const r=this;this.promise.then(n=>{if(!r._listeners)return;let s=r._listeners.length;for(;s-- >0;)r._listeners[s](n);r._listeners=null}),this.promise.then=n=>{let s;const a=new Promise(o=>{r.subscribe(o),s=o}).then(n);return a.cancel=function(){r.unsubscribe(s)},a},e(function(s,a,o){r.reason||(r.reason=new sb(s,a,o),i(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const e=new AbortController,i=r=>{e.abort(r)};return this.subscribe(i),e.signal.unsubscribe=()=>this.unsubscribe(i),e.signal}static source(){let e;return{token:new q7(function(n){e=n}),cancel:e}}};function Fne(t){return function(i){return t.apply(null,i)}}function kne(t){return _t.isObject(t)&&t.isAxiosError===!0}const wz={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(wz).forEach(([t,e])=>{wz[e]=t});function X7(t){const e=new v0(t),i=M7(v0.prototype.request,e);return _t.extend(i,v0.prototype,e,{allOwnKeys:!0}),_t.extend(i,e,null,{allOwnKeys:!0}),i.create=function(n){return X7(P0(t,n))},i}const Rs=X7(vM);Rs.Axios=v0;Rs.CanceledError=sb;Rs.CancelToken=Nne;Rs.isCancel=N7;Rs.VERSION=W7;Rs.toFormData=T3;Rs.AxiosError=er;Rs.Cancel=Rs.CanceledError;Rs.all=function(e){return Promise.all(e)};Rs.spread=Fne;Rs.isAxiosError=kne;Rs.mergeConfig=P0;Rs.AxiosHeaders=Wl;Rs.formToJSON=t=>B7(_t.isHTMLForm(t)?new FormData(t):t);Rs.getAdapter=j7.getAdapter;Rs.HttpStatusCode=wz;Rs.default=Rs;const{Axios:xHe,AxiosError:bHe,CanceledError:_He,isCancel:SHe,CancelToken:wHe,VERSION:MHe,all:EHe,Cancel:AHe,isAxiosError:THe,spread:CHe,toFormData:DHe,AxiosHeaders:PHe,HttpStatusCode:RHe,formToJSON:OHe,getAdapter:LHe,mergeConfig:IHe}=Rs,Vne=["about","after","all","also","am","an","and","another","any","are","as","at","be","because","been","before","being","between","both","but","by","came","can","come","could","did","do","each","for","from","get","got","has","had","he","have","her","here","him","himself","his","how","if","in","into","is","it","like","make","many","me","might","more","most","much","must","my","never","now","of","on","only","or","other","our","out","over","said","same","should","since","some","still","such","take","than","that","the","their","them","then","there","these","they","this","those","through","to","too","under","up","very","was","way","we","well","were","what","where","which","while","who","with","would","you","your","a","i"],Hne=(t,e=Vne)=>{if(!Array.isArray(t)||!Array.isArray(e))throw new Error("expected Arrays try: removeStopwords(Array[, Array])");return t.filter(i=>!e.includes(i.toLowerCase()))},Gne="http://4300showcase.infosci.cornell.edu:5239",fN=Rs.create({baseURL:Gne,headers:{"Content-Type":"application/json"}});function jne(t,e=50){const i=new Map,r=t.toLowerCase().replace(/[^a-z\s]/g,"").split(/\s+/),n=Hne(r);for(const s of n)s.length<=2||i.set(s,(i.get(s)||0)+1);return Array.from(i.entries()).sort((s,a)=>a[1]-s[1]).slice(0,e).map(([s])=>s)}function Wne(t){if(!t||t.length===0)return[];const e=t.map(r=>r.description||"").join(" ");if(!e.trim())return[];const i=jne(e);return i.map(r=>{const n=i.indexOf(r),s=i.length-1,a=3+1*(s-n)/s;return{text:r,size:a}})}const qne=async t=>{try{const e=await fN.get(`/api/search?q=${encodeURIComponent(t)}`);console.log("api results",e.data);const i=e.data,r=Wne(i);return{courses:i,keywords:r}}catch(e){throw console.error("Error searching courses:",e),e}},Xne=async t=>{try{const e=t.replace(/-/g," "),i=await fN.get(`/api/search?q=${encodeURIComponent(e)}`);return i.data&&i.data.length>0&&i.data.find(n=>n.course_code===e)||null}catch(e){throw console.error("Error getting course:",e),e}},Yne=async()=>{try{const t=await fN.get("/api/get_courses");return console.log(t.data),t.data}catch(t){throw console.error("Error getting courses:",t),t}},Qne=(t,e)=>Array.isArray(t)?Object.values(e).some(i=>i.length>0)?t.filter(i=>{if(!i||typeof i!="object")return!1;if(e.semester.length>0){const r=i.term_offered||i.semester||[];if(!Array.isArray(r)||!r.some(n=>typeof n!="string"?!1:e.semester.includes(n.trim())))return!1}if(e.classLevel.length>0){const n=(i.course_code||"").match(/\d{3}/);if(n){const s=n[0][0]+"000",a=parseInt(n[0][0])>=5?"5000+":s;if(!e.classLevel.includes(a))return!1}else return!1}if(e.difficulty.length>0){const r=i.avgDifficulty||0;if(!(e.difficulty.includes("Easy")&&r>0&&r<2.5||e.difficulty.includes("Medium")&&r>=2.5&&r<3.5||e.difficulty.includes("Hard")&&r>=3.5))return!1}if(e.workload.length>0){const r=i.avgWorkload||0;if(!(e.workload.includes("Light")&&r>0&&r<2.5||e.workload.includes("Moderate")&&r>=2.5&&r<3.5||e.workload.includes("Heavy")&&r>=3.5))return!1}return!0}):t:(console.error("filterCourses received non-array input:",t),[]),Y7=()=>{const[t,e]=Me.useState([]),[i,r]=Me.useState(!0),[n,s]=Me.useState(null),[a,o]=Me.useState(0),[l,c]=Me.useState(!1),u=Me.useRef(null),h=Me.useRef(null),d=Me.useRef(null),p=(M,E)=>M.length<=E?M:[...M].sort(()=>.5-Math.random()).slice(0,E);Me.useEffect(()=>{(async()=>{try{r(!0);const E=await Yne();console.log("Fetched courses for CourseWheel:",E);const D=p(E.courses,30);e(D),r(!1)}catch(E){console.error("CourseWheel error:",E),s("Error loading courses. Please try again later."),r(!1)}})()},[]),Me.useEffect(()=>{if(!(t.length===0||i))return g(),()=>{h.current&&clearInterval(h.current)}},[t,i]),Me.useEffect(()=>(l?h.current&&clearInterval(h.current):g(),()=>{h.current&&clearInterval(h.current)}),[l]);const g=()=>{h.current&&clearInterval(h.current),h.current=setInterval(()=>{!l&&t.length>0&&o(M=>M>=t.length-1?0:M+1)},1e3)},x=()=>{c(!l)},v=()=>{c(!0)},b=M=>{if(t.length===0)return;v();const E=M==="up"?a<=0?t.length-1:a-1:a>=t.length-1?0:a+1;o(E)},w=M=>{u.current||(u.current=setTimeout(()=>{u.current=null},100),M.deltaY<0?b("up"):b("down"),M.preventDefault())};return n?Pe.jsx("div",{className:"w-full h-screen flex items-center justify-center",children:Pe.jsxs("div",{className:"text-center text-red-600 p-4 rounded-lg border border-red-300 bg-red-50",children:[Pe.jsx("p",{children:n}),Pe.jsx("button",{className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",onClick:()=>window.location.reload(),children:"Retry"})]})}):Pe.jsxs("div",{ref:d,className:"w-full h-screen bg-transparent",onWheel:w,children:[Pe.jsx("div",{className:"w-full h-full relative overflow-visible pt-0",style:{perspective:"1000px"},children:Pe.jsx("div",{className:"absolute inset-0",children:t.map((M,E)=>{const D=E-a,T=D>t.length/2?D-t.length:D<-t.length/2?D+t.length:D;if(!(Math.abs(T)<=3))return null;const R=160/6,U=T*R*Math.PI/180,F=35,V=60-F*Math.cos(U),k=50+F*Math.sin(U),K=Math.abs(T)*18,X=1-Math.min(Math.abs(T)*.15,.6),$=1-Math.min(Math.abs(T)*.12,.4),Y=T*-12,re=M.classCode||M.course_code||"";return Pe.jsx("div",{className:"absolute cursor-pointer transition-all duration-200 ease-out",style:{left:`${V}%`,top:`${k}%`,transform:`translate(-50%, -50%) 
                             translateZ(${-K}px)
                             rotateY(${Y}deg)
                             scale(${$})`,opacity:X,zIndex:100-Math.abs(T)},onClick:()=>{o(E),v()},children:Pe.jsx("div",{className:`
                  rounded-lg shadow-lg p-4 min-w-[100px] min-h-[60px]
                  border-2 transition-colors duration-300
                  ${T===0?"border-black bg-white/90 text-black":"border-gray-400 bg-[#CACACA] text-gray-800"}
                `,children:Pe.jsx("div",{className:"text-center",children:Pe.jsx("div",{className:`
                      font-bold
                      ${T===0?"text-2xl":"text-xl"}
                    `,children:re})})})},E)})})}),Pe.jsx("button",{className:"absolute bottom-5 right-4 flex items-center gap-4 px-10 py-2 bg-gray-800 text-white rounded-full hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",onClick:x,children:l?Pe.jsxs(Pe.Fragment,{children:[Pe.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:Pe.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"})}),Pe.jsx("span",{className:"text-sm font-medium",children:"Play"})]}):Pe.jsxs(Pe.Fragment,{children:[Pe.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:Pe.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),Pe.jsx("span",{className:"text-sm font-medium",children:"Pause"})]})})]})},Zne="modulepreload",Kne=function(t){return"/"+t},uk={},Cg=function(e,i,r){let n=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(i.map(l=>{if(l=Kne(l),l in uk)return;uk[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const h=document.createElement("link");if(h.rel=c?"stylesheet":Zne,c||(h.as="script"),h.crossOrigin="",h.href=l,o&&h.setAttribute("nonce",o),document.head.appendChild(h),c)return new Promise((d,p)=>{h.addEventListener("load",d),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return n.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return e().catch(s)})};var Jne=Object.create,P3=Object.defineProperty,$ne=Object.getOwnPropertyDescriptor,ese=Object.getOwnPropertyNames,tse=Object.getPrototypeOf,ise=Object.prototype.hasOwnProperty,rse=(t,e,i)=>e in t?P3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Y0=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),nse=(t,e)=>{for(var i in e)P3(t,i,{get:e[i],enumerable:!0})},sse=(t,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of ese(e))!ise.call(t,n)&&n!==i&&P3(t,n,{get:()=>e[n],enumerable:!(r=$ne(e,n))||r.enumerable});return t},Dg=(t,e,i)=>(i=t!=null?Jne(tse(t)):{},sse(e||!t||!t.__esModule?P3(i,"default",{value:t,enumerable:!0}):i,t)),PS=(t,e,i)=>(rse(t,typeof e!="symbol"?e+"":e,i),i),ase=Y0((t,e)=>{(function(i,r){typeof t=="object"?e.exports=r():typeof define=="function"&&define.amd?define(r):i.Alea=r()})(t,function(){return i.importState=function(n){var s=new i;return s.importState(n),s},i;function i(){return function(n){var s=0,a=0,o=0,l=1;n.length==0&&(n=[+new Date]);var c=r();s=c(" "),a=c(" "),o=c(" ");for(var u=0;u<n.length;u++)s-=c(n[u]),s<0&&(s+=1),a-=c(n[u]),a<0&&(a+=1),o-=c(n[u]),o<0&&(o+=1);c=null;var h=function(){var d=2091639*s+l*23283064365386963e-26;return s=a,a=o,o=d-(l=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=n,h.exportState=function(){return[s,a,o,l]},h.importState=function(d){s=+d[0]||0,a=+d[1]||0,o=+d[2]||0,l=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var n=4022871197,s=function(a){a=a.toString();for(var o=0;o<a.length;o++){n+=a.charCodeAt(o);var l=.02519603282416938*n;n=l>>>0,l-=n,l*=n,n=l>>>0,l-=n,n+=l*4294967296}return(n>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})}),Q7=Y0((t,e)=>{(function(i,r){typeof t=="object"&&typeof e<"u"?r(t):typeof define=="function"&&define.amd?define(["exports"],r):r((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})(t,function(i){i.SVD=function(r,n,s,a,o){if(n=n===void 0||n,s=s===void 0||s,o=1e-64/(a=a||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var l,c,u,h,d,p,g,x,v,b,w,M,E=r[0].length,D=r.length;if(D<E)throw new TypeError("Invalid matrix: m < n");for(var T=[],L=[],P=[],R=n==="f"?D:E,O=b=g=0;O<D;O++)L[O]=new Array(R).fill(0);for(O=0;O<E;O++)P[O]=new Array(E).fill(0);var U,F=new Array(E).fill(0);for(O=0;O<D;O++)for(l=0;l<E;l++)L[O][l]=r[O][l];for(O=0;O<E;O++){for(T[O]=g,v=0,u=O+1,l=O;l<D;l++)v+=Math.pow(L[l][O],2);if(v<o)g=0;else for(x=(p=L[O][O])*(g=p<0?Math.sqrt(v):-Math.sqrt(v))-v,L[O][O]=p-g,l=u;l<E;l++){for(v=0,c=O;c<D;c++)v+=L[c][O]*L[c][l];for(p=v/x,c=O;c<D;c++)L[c][l]=L[c][l]+p*L[c][O]}for(F[O]=g,v=0,l=u;l<E;l++)v+=Math.pow(L[O][l],2);if(v<o)g=0;else{for(x=(p=L[O][O+1])*(g=p<0?Math.sqrt(v):-Math.sqrt(v))-v,L[O][O+1]=p-g,l=u;l<E;l++)T[l]=L[O][l]/x;for(l=u;l<D;l++){for(v=0,c=u;c<E;c++)v+=L[l][c]*L[O][c];for(c=u;c<E;c++)L[l][c]=L[l][c]+v*T[c]}}b<(w=Math.abs(F[O])+Math.abs(T[O]))&&(b=w)}if(s)for(O=E-1;0<=O;O--){if(g!==0){for(x=L[O][O+1]*g,l=u;l<E;l++)P[l][O]=L[O][l]/x;for(l=u;l<E;l++){for(v=0,c=u;c<E;c++)v+=L[O][c]*P[c][l];for(c=u;c<E;c++)P[c][l]=P[c][l]+v*P[c][O]}}for(l=u;l<E;l++)P[O][l]=0,P[l][O]=0;P[O][O]=1,g=T[O],u=O}if(n){if(n==="f")for(O=E;O<D;O++){for(l=E;l<D;l++)L[O][l]=0;L[O][O]=1}for(O=E-1;0<=O;O--){for(u=O+1,g=F[O],l=u;l<R;l++)L[O][l]=0;if(g!==0){for(x=L[O][O]*g,l=u;l<R;l++){for(v=0,c=u;c<D;c++)v+=L[c][O]*L[c][l];for(p=v/x,c=O;c<D;c++)L[c][l]=L[c][l]+p*L[c][O]}for(l=O;l<D;l++)L[l][O]=L[l][O]/g}else for(l=O;l<D;l++)L[l][O]=0;L[O][O]=L[O][O]+1}}for(a*=b,c=E-1;0<=c;c--)for(var V=0;V<50;V++){for(U=!1,u=c;0<=u;u--){if(Math.abs(T[u])<=a){U=!0;break}if(Math.abs(F[u-1])<=a)break}if(!U){for(d=0,h=u-(v=1),O=u;O<c+1&&(p=v*T[O],T[O]=d*T[O],!(Math.abs(p)<=a));O++)if(g=F[O],F[O]=Math.sqrt(p*p+g*g),d=g/(x=F[O]),v=-p/x,n)for(l=0;l<D;l++)w=L[l][h],M=L[l][O],L[l][h]=w*d+M*v,L[l][O]=-w*v+M*d}if(M=F[c],u===c){if(M<0&&(F[c]=-M,s))for(l=0;l<E;l++)P[l][c]=-P[l][c];break}for(b=F[u],p=(((w=F[c-1])-M)*(w+M)+((g=T[c-1])-(x=T[c]))*(g+x))/(2*x*w),g=Math.sqrt(p*p+1),p=((b-M)*(b+M)+x*(w/(p<0?p-g:p+g)-x))/b,O=u+(v=d=1);O<c+1;O++){if(g=T[O],w=F[O],x=v*g,g*=d,M=Math.sqrt(p*p+x*x),p=b*(d=p/(T[O-1]=M))+g*(v=x/M),g=-b*v+g*d,x=w*v,w*=d,s)for(l=0;l<E;l++)b=P[l][O-1],M=P[l][O],P[l][O-1]=b*d+M*v,P[l][O]=-b*v+M*d;if(M=Math.sqrt(p*p+x*x),p=(d=p/(F[O-1]=M))*g+(v=x/M)*w,b=-v*g+d*w,n)for(l=0;l<D;l++)w=L[l][O-1],M=L[l][O],L[l][O-1]=w*d+M*v,L[l][O]=-w*v+M*d}T[u]=0,T[c]=p,F[c]=b}for(O=0;O<E;O++)F[O]<a&&(F[O]=0);return{u:L,q:F,v:P}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})})}),ose=Y0((t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;function i(r){if(r===null||r===!0||r===!1)return NaN;var n=Number(r);return isNaN(n)?n:n<0?Math.ceil(n):Math.floor(n)}e.exports=t.default}),lse=Y0((t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;function i(r){var n=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return n.setUTCFullYear(r.getFullYear()),r.getTime()-n.getTime()}e.exports=t.default}),cse=Y0((t,e)=>{function i(s,a){function o(){this.constructor=s}o.prototype=a.prototype,s.prototype=new o}function r(s,a,o,l){this.message=s,this.expected=a,this.found=o,this.location=l,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,r)}i(r,Error),r.buildMessage=function(s,a){var o={literal:function(g){return'"'+c(g.text)+'"'},class:function(g){var x="",v;for(v=0;v<g.parts.length;v++)x+=g.parts[v]instanceof Array?u(g.parts[v][0])+"-"+u(g.parts[v][1]):u(g.parts[v]);return"["+(g.inverted?"^":"")+x+"]"},any:function(g){return"any character"},end:function(g){return"end of input"},other:function(g){return g.description}};function l(g){return g.charCodeAt(0).toString(16).toUpperCase()}function c(g){return g.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(x){return"\\x0"+l(x)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(x){return"\\x"+l(x)})}function u(g){return g.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(x){return"\\x0"+l(x)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(x){return"\\x"+l(x)})}function h(g){return o[g.type](g)}function d(g){var x=new Array(g.length),v,b;for(v=0;v<g.length;v++)x[v]=h(g[v]);if(x.sort(),x.length>0){for(v=1,b=1;v<x.length;v++)x[v-1]!==x[v]&&(x[b]=x[v],b++);x.length=b}switch(x.length){case 1:return x[0];case 2:return x[0]+" or "+x[1];default:return x.slice(0,-1).join(", ")+", or "+x[x.length-1]}}function p(g){return g?'"'+c(g)+'"':"end of input"}return"Expected "+d(s)+" but "+p(a)+" found."};function n(s,a){a=a!==void 0?a:{};var o={},l={svg_path:Kt},c=Kt,u=function(te){if(!te)return[];for(var he=[],Ae=0;Ae<te.length;Ae++)he=he.concat.apply(he,te[Ae]);var me=he[0];return me&&me.code=="m"&&(delete me.relative,me.code="M"),he},h=function(te,he){return Nt(te,he)},d=/^[Mm]/,p=at(["M","m"],!1,!1),g=function(te,he,Ae){var me=ii(te,[he]);return Ae&&(me=me.concat(ii(te=="M"?"L":"l",Ae[1]))),me},x=/^[Zz]/,v=at(["Z","z"],!1,!1),b=function(){return ii("Z")},w=/^[Ll]/,M=at(["L","l"],!1,!1),E=function(te,he){return ii(te,he)},D=/^[Hh]/,T=at(["H","h"],!1,!1),L=function(te,he){return ii(te,he.map(function(Ae){return{x:Ae}}))},P=/^[Vv]/,R=at(["V","v"],!1,!1),O=function(te,he){return ii(te,he.map(function(Ae){return{y:Ae}}))},U=/^[Cc]/,F=at(["C","c"],!1,!1),V=function(te,he,Ae){return{x1:te.x,y1:te.y,x2:he.x,y2:he.y,x:Ae.x,y:Ae.y}},k=/^[Ss]/,K=at(["S","s"],!1,!1),X=function(te,he){return{x2:te.x,y2:te.y,x:he.x,y:he.y}},$=/^[Qq]/,Y=at(["Q","q"],!1,!1),re=function(te,he){return{x1:te.x,y1:te.y,x:he.x,y:he.y}},G=/^[Tt]/,j=at(["T","t"],!1,!1),ee=/^[Aa]/,oe=at(["A","a"],!1,!1),Q=function(te,he,Ae,me,Ne,mt){return{rx:te,ry:he,xAxisRotation:Ae,largeArc:me,sweep:Ne,x:mt.x,y:mt.y}},ae=function(te,he){return{x:te,y:he}},ne=function(te){return te*1},ue=function(te){return te.join("")*1},fe=/^[01]/,xe=at(["0","1"],!1,!1),be=function(te){return te=="1"},Ce=function(){return""},ge=",",Te=Ke(",",!1),ce=function(te){return te.join("")},Ue=".",ze=Ke(".",!1),Xe=/^[eE]/,De=at(["e","E"],!1,!1),Ge=/^[+\-]/,We=at(["+","-"],!1,!1),se=/^[0-9]/,H=at([["0","9"]],!1,!1),Z=function(te){return te.join("")},pe=/^[ \t\n\r]/,we=at([" ","	",`
`,"\r"],!1,!1),J=0,He=[{line:1,column:1}],je=0,Ye=[],Ve;if("startRule"in a){if(!(a.startRule in l))throw new Error(`Can't start parsing from rule "`+a.startRule+'".');c=l[a.startRule]}function Ke(te,he){return{type:"literal",text:te,ignoreCase:he}}function at(te,he,Ae){return{type:"class",parts:te,inverted:he,ignoreCase:Ae}}function ut(){return{type:"end"}}function ht(te){var he=He[te],Ae;if(he)return he;for(Ae=te-1;!He[Ae];)Ae--;for(he=He[Ae],he={line:he.line,column:he.column};Ae<te;)s.charCodeAt(Ae)===10?(he.line++,he.column=1):he.column++,Ae++;return He[te]=he,he}function $e(te,he){var Ae=ht(te),me=ht(he);return{start:{offset:te,line:Ae.line,column:Ae.column},end:{offset:he,line:me.line,column:me.column}}}function St(te){J<je||(J>je&&(je=J,Ye=[]),Ye.push(te))}function Pt(te,he,Ae){return new r(r.buildMessage(te,he),te,he,Ae)}function Kt(){var te,he,Ae,me,Ne;for(te=J,he=[],Ae=xt();Ae!==o;)he.push(Ae),Ae=xt();if(he!==o)if(Ae=le(),Ae===o&&(Ae=null),Ae!==o){for(me=[],Ne=xt();Ne!==o;)me.push(Ne),Ne=xt();me!==o?(he=u(Ae),te=he):(J=te,te=o)}else J=te,te=o;else J=te,te=o;return te}function le(){var te,he,Ae,me,Ne,mt;if(te=J,he=Re(),he!==o){for(Ae=[],me=J,Ne=[],mt=xt();mt!==o;)Ne.push(mt),mt=xt();for(Ne!==o?(mt=Re(),mt!==o?(Ne=[Ne,mt],me=Ne):(J=me,me=o)):(J=me,me=o);me!==o;){for(Ae.push(me),me=J,Ne=[],mt=xt();mt!==o;)Ne.push(mt),mt=xt();Ne!==o?(mt=Re(),mt!==o?(Ne=[Ne,mt],me=Ne):(J=me,me=o)):(J=me,me=o)}Ae!==o?(he=h(he,Ae),te=he):(J=te,te=o)}else J=te,te=o;return te}function Re(){var te,he,Ae,me,Ne,mt;if(te=J,he=Qe(),he!==o){for(Ae=[],me=J,Ne=[],mt=xt();mt!==o;)Ne.push(mt),mt=xt();for(Ne!==o?(mt=Ee(),mt!==o?(Ne=[Ne,mt],me=Ne):(J=me,me=o)):(J=me,me=o);me!==o;){for(Ae.push(me),me=J,Ne=[],mt=xt();mt!==o;)Ne.push(mt),mt=xt();Ne!==o?(mt=Ee(),mt!==o?(Ne=[Ne,mt],me=Ne):(J=me,me=o)):(J=me,me=o)}Ae!==o?(he=h(he,Ae),te=he):(J=te,te=o)}else J=te,te=o;return te}function Ee(){var te;return te=ot(),te===o&&(te=pt(),te===o&&(te=Jt(),te===o&&(te=Ft(),te===o&&(te=Ni(),te===o&&(te=Dn(),te===o&&(te=_e(),te===o&&(te=qe(),te===o&&(te=Gt())))))))),te}function Qe(){var te,he,Ae,me,Ne,mt,ei;if(te=J,d.test(s.charAt(J))?(he=s.charAt(J),J++):(he=o,St(p)),he!==o){for(Ae=[],me=xt();me!==o;)Ae.push(me),me=xt();Ae!==o?(me=ri(),me!==o?(Ne=J,mt=hi(),mt===o&&(mt=null),mt!==o?(ei=Bt(),ei!==o?(mt=[mt,ei],Ne=mt):(J=Ne,Ne=o)):(J=Ne,Ne=o),Ne===o&&(Ne=null),Ne!==o?(he=g(he,me,Ne),te=he):(J=te,te=o)):(J=te,te=o)):(J=te,te=o)}else J=te,te=o;return te}function ot(){var te,he;return te=J,x.test(s.charAt(J))?(he=s.charAt(J),J++):(he=o,St(v)),he!==o&&(he=b()),te=he,te}function pt(){var te,he,Ae,me;if(te=J,w.test(s.charAt(J))?(he=s.charAt(J),J++):(he=o,St(M)),he!==o){for(Ae=[],me=xt();me!==o;)Ae.push(me),me=xt();Ae!==o?(me=Bt(),me!==o?(he=E(he,me),te=he):(J=te,te=o)):(J=te,te=o)}else J=te,te=o;return te}function Bt(){var te,he,Ae,me,Ne,mt;if(te=J,he=ri(),he!==o){for(Ae=[],me=J,Ne=hi(),Ne===o&&(Ne=null),Ne!==o?(mt=ri(),mt!==o?(Ne=[Ne,mt],me=Ne):(J=me,me=o)):(J=me,me=o);me!==o;)Ae.push(me),me=J,Ne=hi(),Ne===o&&(Ne=null),Ne!==o?(mt=ri(),mt!==o?(Ne=[Ne,mt],me=Ne):(J=me,me=o)):(J=me,me=o);Ae!==o?(he=h(he,Ae),te=he):(J=te,te=o)}else J=te,te=o;return te}function Jt(){var te,he,Ae,me;if(te=J,D.test(s.charAt(J))?(he=s.charAt(J),J++):(he=o,St(T)),he!==o){for(Ae=[],me=xt();me!==o;)Ae.push(me),me=xt();Ae!==o?(me=qt(),me!==o?(he=L(he,me),te=he):(J=te,te=o)):(J=te,te=o)}else J=te,te=o;return te}function qt(){var te,he,Ae,me,Ne,mt;if(te=J,he=mi(),he!==o){for(Ae=[],me=J,Ne=hi(),Ne===o&&(Ne=null),Ne!==o?(mt=mi(),mt!==o?(Ne=[Ne,mt],me=Ne):(J=me,me=o)):(J=me,me=o);me!==o;)Ae.push(me),me=J,Ne=hi(),Ne===o&&(Ne=null),Ne!==o?(mt=mi(),mt!==o?(Ne=[Ne,mt],me=Ne):(J=me,me=o)):(J=me,me=o);Ae!==o?(he=h(he,Ae),te=he):(J=te,te=o)}else J=te,te=o;return te}function Ft(){var te,he,Ae,me;if(te=J,P.test(s.charAt(J))?(he=s.charAt(J),J++):(he=o,St(R)),he!==o){for(Ae=[],me=xt();me!==o;)Ae.push(me),me=xt();Ae!==o?(me=qt(),me!==o?(he=O(he,me),te=he):(J=te,te=o)):(J=te,te=o)}else J=te,te=o;return te}function Ni(){var te,he,Ae,me;if(te=J,U.test(s.charAt(J))?(he=s.charAt(J),J++):(he=o,St(F)),he!==o){for(Ae=[],me=xt();me!==o;)Ae.push(me),me=xt();Ae!==o?(me=Oi(),me!==o?(he=E(he,me),te=he):(J=te,te=o)):(J=te,te=o)}else J=te,te=o;return te}function Oi(){var te,he,Ae,me,Ne,mt;if(te=J,he=Tr(),he!==o){for(Ae=[],me=J,Ne=hi(),Ne===o&&(Ne=null),Ne!==o?(mt=Tr(),mt!==o?(Ne=[Ne,mt],me=Ne):(J=me,me=o)):(J=me,me=o);me!==o;)Ae.push(me),me=J,Ne=hi(),Ne===o&&(Ne=null),Ne!==o?(mt=Tr(),mt!==o?(Ne=[Ne,mt],me=Ne):(J=me,me=o)):(J=me,me=o);Ae!==o?(he=h(he,Ae),te=he):(J=te,te=o)}else J=te,te=o;return te}function Tr(){var te,he,Ae,me,Ne,mt;return te=J,he=ri(),he!==o?(Ae=hi(),Ae===o&&(Ae=null),Ae!==o?(me=ri(),me!==o?(Ne=hi(),Ne===o&&(Ne=null),Ne!==o?(mt=ri(),mt!==o?(he=V(he,me,mt),te=he):(J=te,te=o)):(J=te,te=o)):(J=te,te=o)):(J=te,te=o)):(J=te,te=o),te}function Dn(){var te,he,Ae,me;if(te=J,k.test(s.charAt(J))?(he=s.charAt(J),J++):(he=o,St(K)),he!==o){for(Ae=[],me=xt();me!==o;)Ae.push(me),me=xt();Ae!==o?(me=pn(),me!==o?(he=E(he,me),te=he):(J=te,te=o)):(J=te,te=o)}else J=te,te=o;return te}function pn(){var te,he,Ae,me,Ne,mt;if(te=J,he=Fr(),he!==o){for(Ae=[],me=J,Ne=hi(),Ne===o&&(Ne=null),Ne!==o?(mt=Fr(),mt!==o?(Ne=[Ne,mt],me=Ne):(J=me,me=o)):(J=me,me=o);me!==o;)Ae.push(me),me=J,Ne=hi(),Ne===o&&(Ne=null),Ne!==o?(mt=Fr(),mt!==o?(Ne=[Ne,mt],me=Ne):(J=me,me=o)):(J=me,me=o);Ae!==o?(he=h(he,Ae),te=he):(J=te,te=o)}else J=te,te=o;return te}function Fr(){var te,he,Ae,me;return te=J,he=ri(),he!==o?(Ae=hi(),Ae===o&&(Ae=null),Ae!==o?(me=ri(),me!==o?(he=X(he,me),te=he):(J=te,te=o)):(J=te,te=o)):(J=te,te=o),te}function _e(){var te,he,Ae,me;if(te=J,$.test(s.charAt(J))?(he=s.charAt(J),J++):(he=o,St(Y)),he!==o){for(Ae=[],me=xt();me!==o;)Ae.push(me),me=xt();Ae!==o?(me=tt(),me!==o?(he=E(he,me),te=he):(J=te,te=o)):(J=te,te=o)}else J=te,te=o;return te}function tt(){var te,he,Ae,me,Ne,mt;if(te=J,he=ct(),he!==o){for(Ae=[],me=J,Ne=hi(),Ne===o&&(Ne=null),Ne!==o?(mt=ct(),mt!==o?(Ne=[Ne,mt],me=Ne):(J=me,me=o)):(J=me,me=o);me!==o;)Ae.push(me),me=J,Ne=hi(),Ne===o&&(Ne=null),Ne!==o?(mt=ct(),mt!==o?(Ne=[Ne,mt],me=Ne):(J=me,me=o)):(J=me,me=o);Ae!==o?(he=h(he,Ae),te=he):(J=te,te=o)}else J=te,te=o;return te}function ct(){var te,he,Ae,me;return te=J,he=ri(),he!==o?(Ae=hi(),Ae===o&&(Ae=null),Ae!==o?(me=ri(),me!==o?(he=re(he,me),te=he):(J=te,te=o)):(J=te,te=o)):(J=te,te=o),te}function qe(){var te,he,Ae,me;if(te=J,G.test(s.charAt(J))?(he=s.charAt(J),J++):(he=o,St(j)),he!==o){for(Ae=[],me=xt();me!==o;)Ae.push(me),me=xt();Ae!==o?(me=it(),me!==o?(he=E(he,me),te=he):(J=te,te=o)):(J=te,te=o)}else J=te,te=o;return te}function it(){var te,he,Ae,me,Ne,mt;if(te=J,he=ri(),he!==o){for(Ae=[],me=J,Ne=hi(),Ne===o&&(Ne=null),Ne!==o?(mt=ri(),mt!==o?(Ne=[Ne,mt],me=Ne):(J=me,me=o)):(J=me,me=o);me!==o;)Ae.push(me),me=J,Ne=hi(),Ne===o&&(Ne=null),Ne!==o?(mt=ri(),mt!==o?(Ne=[Ne,mt],me=Ne):(J=me,me=o)):(J=me,me=o);Ae!==o?(he=h(he,Ae),te=he):(J=te,te=o)}else J=te,te=o;return te}function Gt(){var te,he,Ae,me;if(te=J,ee.test(s.charAt(J))?(he=s.charAt(J),J++):(he=o,St(oe)),he!==o){for(Ae=[],me=xt();me!==o;)Ae.push(me),me=xt();Ae!==o?(me=oi(),me!==o?(he=E(he,me),te=he):(J=te,te=o)):(J=te,te=o)}else J=te,te=o;return te}function oi(){var te,he,Ae,me,Ne,mt;if(te=J,he=gi(),he!==o){for(Ae=[],me=J,Ne=hi(),Ne===o&&(Ne=null),Ne!==o?(mt=gi(),mt!==o?(Ne=[Ne,mt],me=Ne):(J=me,me=o)):(J=me,me=o);me!==o;)Ae.push(me),me=J,Ne=hi(),Ne===o&&(Ne=null),Ne!==o?(mt=gi(),mt!==o?(Ne=[Ne,mt],me=Ne):(J=me,me=o)):(J=me,me=o);Ae!==o?(he=h(he,Ae),te=he):(J=te,te=o)}else J=te,te=o;return te}function gi(){var te,he,Ae,me,Ne,mt,ei,jr,Li,Pn,Un,_n;return te=J,he=Wi(),he!==o?(Ae=hi(),Ae===o&&(Ae=null),Ae!==o?(me=Wi(),me!==o?(Ne=hi(),Ne===o&&(Ne=null),Ne!==o?(mt=mi(),mt!==o?(ei=hi(),ei!==o?(jr=Mi(),jr!==o?(Li=hi(),Li===o&&(Li=null),Li!==o?(Pn=Mi(),Pn!==o?(Un=hi(),Un===o&&(Un=null),Un!==o?(_n=ri(),_n!==o?(he=Q(he,me,mt,jr,Pn,_n),te=he):(J=te,te=o)):(J=te,te=o)):(J=te,te=o)):(J=te,te=o)):(J=te,te=o)):(J=te,te=o)):(J=te,te=o)):(J=te,te=o)):(J=te,te=o)):(J=te,te=o)):(J=te,te=o),te}function ri(){var te,he,Ae,me;return te=J,he=mi(),he!==o?(Ae=hi(),Ae===o&&(Ae=null),Ae!==o?(me=mi(),me!==o?(he=ae(he,me),te=he):(J=te,te=o)):(J=te,te=o)):(J=te,te=o),te}function Wi(){var te,he;return te=J,he=ke(),he===o&&(he=Dt()),he!==o&&(he=ne(he)),te=he,te}function mi(){var te,he,Ae,me;return te=J,he=J,Ae=Fe(),Ae===o&&(Ae=null),Ae!==o?(me=ke(),me!==o?(Ae=[Ae,me],he=Ae):(J=he,he=o)):(J=he,he=o),he===o&&(he=J,Ae=Fe(),Ae===o&&(Ae=null),Ae!==o?(me=Dt(),me!==o?(Ae=[Ae,me],he=Ae):(J=he,he=o)):(J=he,he=o)),he!==o&&(he=ue(he)),te=he,te}function Mi(){var te,he;return te=J,fe.test(s.charAt(J))?(he=s.charAt(J),J++):(he=o,St(xe)),he!==o&&(he=be(he)),te=he,te}function hi(){var te,he,Ae,me,Ne;if(te=J,he=[],Ae=xt(),Ae!==o)for(;Ae!==o;)he.push(Ae),Ae=xt();else he=o;if(he!==o)if(Ae=de(),Ae===o&&(Ae=null),Ae!==o){for(me=[],Ne=xt();Ne!==o;)me.push(Ne),Ne=xt();me!==o?(he=[he,Ae,me],te=he):(J=te,te=o)}else J=te,te=o;else J=te,te=o;if(te===o){if(te=J,he=J,Ae=de(),Ae!==o){for(me=[],Ne=xt();Ne!==o;)me.push(Ne),Ne=xt();me!==o?(Ae=[Ae,me],he=Ae):(J=he,he=o)}else J=he,he=o;he!==o&&(he=Ce()),te=he}return te}function de(){var te;return s.charCodeAt(J)===44?(te=ge,J++):(te=o,St(Te)),te}function ke(){var te,he,Ae,me;return te=J,he=J,Ae=rt(),Ae!==o?(me=Ie(),me===o&&(me=null),me!==o?(Ae=[Ae,me],he=Ae):(J=he,he=o)):(J=he,he=o),he===o&&(he=J,Ae=Dt(),Ae!==o?(me=Ie(),me!==o?(Ae=[Ae,me],he=Ae):(J=he,he=o)):(J=he,he=o)),he!==o&&(he=ce(he)),te=he,te}function rt(){var te,he,Ae,me,Ne;return te=J,he=J,Ae=Dt(),Ae===o&&(Ae=null),Ae!==o?(s.charCodeAt(J)===46?(me=Ue,J++):(me=o,St(ze)),me!==o?(Ne=Dt(),Ne!==o?(Ae=[Ae,me,Ne],he=Ae):(J=he,he=o)):(J=he,he=o)):(J=he,he=o),he===o&&(he=J,Ae=Dt(),Ae!==o?(s.charCodeAt(J)===46?(me=Ue,J++):(me=o,St(ze)),me!==o?(Ae=[Ae,me],he=Ae):(J=he,he=o)):(J=he,he=o)),he!==o&&(he=ce(he)),te=he,te}function Ie(){var te,he,Ae,me,Ne;return te=J,he=J,Xe.test(s.charAt(J))?(Ae=s.charAt(J),J++):(Ae=o,St(De)),Ae!==o?(me=Fe(),me===o&&(me=null),me!==o?(Ne=Dt(),Ne!==o?(Ae=[Ae,me,Ne],he=Ae):(J=he,he=o)):(J=he,he=o)):(J=he,he=o),he!==o&&(he=ce(he)),te=he,te}function Fe(){var te;return Ge.test(s.charAt(J))?(te=s.charAt(J),J++):(te=o,St(We)),te}function Dt(){var te,he,Ae;if(te=J,he=[],se.test(s.charAt(J))?(Ae=s.charAt(J),J++):(Ae=o,St(H)),Ae!==o)for(;Ae!==o;)he.push(Ae),se.test(s.charAt(J))?(Ae=s.charAt(J),J++):(Ae=o,St(H));else he=o;return he!==o&&(he=Z(he)),te=he,te}function xt(){var te,he;return te=J,pe.test(s.charAt(J))?(he=s.charAt(J),J++):(he=o,St(we)),he!==o&&(he=Ce()),te=he,te}function Nt(te,he){if(!he)return[te];for(var Ae=[te],me=0,Ne=he.length;me<Ne;me++)Ae[me+1]=he[me][1];return Ae}var kt={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var li in kt)kt[li.toUpperCase()]=kt[li];function ii(te,he){he||(he=[{}]);for(var Ae=he.length;Ae--;){var me={code:te,command:kt[te]};te==te.toLowerCase()&&(me.relative=!0);for(var Ne in he[Ae])me[Ne]=he[Ae][Ne];he[Ae]=me}return he}if(Ve=c(),Ve!==o&&J===s.length)return Ve;throw Ve!==o&&J<s.length&&St(ut()),Pt(Ye,je<s.length?s.charAt(je):null,je<s.length?$e(je,je+1):$e(je,je))}e.exports={SyntaxError:r,parse:n}}),Z7=Y0((t,e)=>{var i=cse().parse;i.parseSVG=i,i.makeAbsolute=r,e.exports=i;function r(n){var s,a={x:0,y:0},o={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return n.forEach(function(l){l.command==="moveto"&&(s=l),l.x0=a.x,l.y0=a.y;for(var c in o)c in l&&(l[c]+=l.relative?l[o[c]]:0);"x"in l||(l.x=a.x),"y"in l||(l.y=a.y),l.relative=!1,l.code=l.code.toUpperCase(),l.command=="closepath"&&(l.x=s.x,l.y=s.y),a=l}),n}}),use=Y0((t,e)=>{e.exports=function(i,r){for(var n=i.split("."),s=r.split("."),a=0;a<3;a++){var o=Number(n[a]),l=Number(s[a]);if(o>l)return 1;if(l>o)return-1;if(!isNaN(o)&&isNaN(l))return 1;if(isNaN(o)&&!isNaN(l))return-1}return 0}}),ab="149",kc={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},hse=0,hk=1,dse=2,pN=1,fse=2,RS=3,gh=0,La=1,Oo=2,js=0,y0=1,dk=2,fk=3,pk=4,pse=5,qx=100,mse=101,gse=102,mk=103,gk=104,vse=200,yse=201,xse=202,bse=203,K7=204,J7=205,_se=206,Sse=207,wse=208,Mse=209,Ese=210,Ase=0,Tse=1,Cse=2,Mz=3,Dse=4,Pse=5,Rse=6,Ose=7,$7=0,Lse=1,Ise=2,zd=0,zse=1,Use=2,Bse=3,Nse=4,Fse=5,eq=300,R0=301,O0=302,Ez=303,Az=304,yM=306,fp=1e3,zn=1001,Tz=1002,nr=1003,vk=1004,HR=1005,Ki=1006,kse=1007,P1=1008,zo=1009,Vse=1010,Hse=1011,tq=1012,Gse=1013,pp=1014,rn=1015,Ap=1016,jse=1017,Wse=1018,x0=1020,qse=1021,kn=1023,Xse=1024,Yse=1025,b0=1026,L0=1027,WT=1028,Qse=1029,SC=1030,Zse=1031,iq=1033,GR=33776,jR=33777,WR=33778,qR=33779,yk=35840,xk=35841,bk=35842,_k=35843,Kse=36196,Sk=37492,wk=37496,Mk=37808,Ek=37809,Ak=37810,Tk=37811,Ck=37812,Dk=37813,Pk=37814,Rk=37815,Ok=37816,Lk=37817,Ik=37818,zk=37819,Uk=37820,Bk=37821,XR=36492,Jse=36283,Nk=36284,Fk=36285,kk=36286,rq=2200,nq=2201,mN=2202,wC=2300,MC=2301,YR=2302,$x=2400,e1=2401,EC=2402,gN=2500,$se=2501,vh=3e3,ji=3001,Bp=3200,sq=3201,eae=0,tae=1,Ed="srgb",AC="srgb-linear",QR=7680,iae=519,Cz=35044,rae=35048,Dz="300 es",Pz=1035,lo=class{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;let i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;let i=this._listeners[t];if(i!==void 0){let r=i.indexOf(e);r!==-1&&i.splice(r,1)}}dispatchEvent(t){if(this._listeners===void 0)return;let e=this._listeners[t.type];if(e!==void 0){t.target=this;let i=e.slice(0);for(let r=0,n=i.length;r<n;r++)i[r].call(this,t);t.target=null}}},wo=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Vk=1234567,WS=Math.PI/180,ww=180/Math.PI;function ru(){let t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(wo[t&255]+wo[t>>8&255]+wo[t>>16&255]+wo[t>>24&255]+"-"+wo[e&255]+wo[e>>8&255]+"-"+wo[e>>16&15|64]+wo[e>>24&255]+"-"+wo[i&63|128]+wo[i>>8&255]+"-"+wo[i>>16&255]+wo[i>>24&255]+wo[r&255]+wo[r>>8&255]+wo[r>>16&255]+wo[r>>24&255]).toLowerCase()}function ks(t,e,i){return Math.max(e,Math.min(i,t))}function vN(t,e){return(t%e+e)%e}function nae(t,e,i,r,n){return r+(t-e)*(n-r)/(i-e)}function sae(t,e,i){return t!==e?(i-t)/(e-t):0}function qS(t,e,i){return(1-i)*t+i*e}function aae(t,e,i,r){return qS(t,e,1-Math.exp(-i*r))}function oae(t,e=1){return e-Math.abs(vN(t,e*2)-e)}function lae(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*(3-2*t))}function cae(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*t*(t*(t*6-15)+10))}function uae(t,e){return t+Math.floor(Math.random()*(e-t+1))}function hae(t,e){return t+Math.random()*(e-t)}function dae(t){return t*(.5-Math.random())}function fae(t){t!==void 0&&(Vk=t);let e=Vk+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function pae(t){return t*WS}function mae(t){return t*ww}function Rz(t){return(t&t-1)===0&&t!==0}function aq(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function TC(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function gae(t,e,i,r,n){let s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((e+r)/2),u=a((e+r)/2),h=s((e-r)/2),d=a((e-r)/2),p=s((r-e)/2),g=a((r-e)/2);switch(n){case"XYX":t.set(o*u,l*h,l*d,o*c);break;case"YZY":t.set(l*d,o*u,l*h,o*c);break;case"ZXZ":t.set(l*h,l*d,o*u,o*c);break;case"XZX":t.set(o*u,l*g,l*p,o*c);break;case"YXY":t.set(l*p,o*u,l*g,o*c);break;case"ZYZ":t.set(l*g,l*p,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function mp(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function xn(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}var Qt=Object.freeze({__proto__:null,DEG2RAD:WS,RAD2DEG:ww,ceilPowerOfTwo:aq,clamp:ks,damp:aae,degToRad:pae,denormalize:mp,euclideanModulo:vN,floorPowerOfTwo:TC,generateUUID:ru,inverseLerp:sae,isPowerOfTwo:Rz,lerp:qS,mapLinear:nae,normalize:xn,pingpong:oae,radToDeg:mae,randFloat:hae,randFloatSpread:dae,randInt:uae,seededRandom:fae,setQuaternionFromProperEuler:gae,smootherstep:cae,smoothstep:lae}),Oe=class{constructor(t=0,e=0){Oe.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let e=this.x,i=this.y,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6],this.y=r[1]*e+r[4]*i+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){let i=Math.cos(e),r=Math.sin(e),n=this.x-t.x,s=this.y-t.y;return this.x=n*i-s*r+t.x,this.y=n*r+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Hs=class{constructor(){Hs.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,e,i,r,n,s,a,o,l){let c=this.elements;return c[0]=t,c[1]=r,c[2]=a,c[3]=e,c[4]=n,c[5]=o,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){let e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){let e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let i=t.elements,r=e.elements,n=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],c=i[4],u=i[7],h=i[2],d=i[5],p=i[8],g=r[0],x=r[3],v=r[6],b=r[1],w=r[4],M=r[7],E=r[2],D=r[5],T=r[8];return n[0]=s*g+a*b+o*E,n[3]=s*x+a*w+o*D,n[6]=s*v+a*M+o*T,n[1]=l*g+c*b+u*E,n[4]=l*x+c*w+u*D,n[7]=l*v+c*M+u*T,n[2]=h*g+d*b+p*E,n[5]=h*x+d*w+p*D,n[8]=h*v+d*M+p*T,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){let t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8];return e*s*c-e*a*l-i*n*c+i*a*o+r*n*l-r*s*o}invert(){let t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],u=c*s-a*l,h=a*o-c*n,d=l*n-s*o,p=e*u+i*h+r*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);let g=1/p;return t[0]=u*g,t[1]=(r*l-c*i)*g,t[2]=(a*i-r*s)*g,t[3]=h*g,t[4]=(c*e-r*o)*g,t[5]=(r*n-a*e)*g,t[6]=d*g,t[7]=(i*o-l*e)*g,t[8]=(s*e-i*n)*g,this}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){let e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,r,n,s,a){let o=Math.cos(n),l=Math.sin(n);return this.set(i*o,i*l,-i*(o*s+l*a)+s+t,-r*l,r*o,-r*(-l*s+o*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(ZR.makeScale(t,e)),this}rotate(t){return this.premultiply(ZR.makeRotation(-t)),this}translate(t,e){return this.premultiply(ZR.makeTranslation(t,e)),this}makeTranslation(t,e){return this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){let e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){let e=this.elements,i=t.elements;for(let r=0;r<9;r++)if(e[r]!==i[r])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){let i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}},ZR=new Hs;function oq(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}var vae={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function xA(t,e){return new vae[t](e)}function Mw(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function yae(t,e,i){return new Promise(function(r,n){function s(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:n();break;case t.TIMEOUT_EXPIRED:setTimeout(s,i);break;default:r()}}setTimeout(s,i)})}function _0(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function qT(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}var KR={[Ed]:{[AC]:_0},[AC]:{[Ed]:qT}},Qo={legacyMode:!0,get workingColorSpace(){return AC},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,i){if(this.legacyMode||e===i||!e||!i)return t;if(KR[e]&&KR[e][i]!==void 0){let r=KR[e][i];return t.r=r(t.r),t.g=r(t.g),t.b=r(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},lq={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ks={r:0,g:0,b:0},Wu={h:0,s:0,l:0},bA={h:0,s:0,l:0};function JR(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*6*(2/3-i):t}function _A(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}var bi=class{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,e===void 0&&i===void 0?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=Ed){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Qo.toWorkingColorSpace(this,e),this}setRGB(t,e,i,r=Qo.workingColorSpace){return this.r=t,this.g=e,this.b=i,Qo.toWorkingColorSpace(this,r),this}setHSL(t,e,i,r=Qo.workingColorSpace){if(t=vN(t,1),e=ks(e,0,1),i=ks(i,0,1),e===0)this.r=this.g=this.b=i;else{let n=i<=.5?i*(1+e):i+e-i*e,s=2*i-n;this.r=JR(s,n,t+1/3),this.g=JR(s,n,t),this.b=JR(s,n,t-1/3)}return Qo.toWorkingColorSpace(this,r),this}setStyle(t,e=Ed){function i(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let n,s=r[1],a=r[2];switch(s){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,Qo.toWorkingColorSpace(this,e),i(n[4]),this;if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,Qo.toWorkingColorSpace(this,e),i(n[4]),this;break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){let o=parseFloat(n[1])/360,l=parseFloat(n[2])/100,c=parseFloat(n[3])/100;return i(n[4]),this.setHSL(o,l,c,e)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){let n=r[1],s=n.length;if(s===3)return this.r=parseInt(n.charAt(0)+n.charAt(0),16)/255,this.g=parseInt(n.charAt(1)+n.charAt(1),16)/255,this.b=parseInt(n.charAt(2)+n.charAt(2),16)/255,Qo.toWorkingColorSpace(this,e),this;if(s===6)return this.r=parseInt(n.charAt(0)+n.charAt(1),16)/255,this.g=parseInt(n.charAt(2)+n.charAt(3),16)/255,this.b=parseInt(n.charAt(4)+n.charAt(5),16)/255,Qo.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e=Ed){let i=lq[t.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=_0(t.r),this.g=_0(t.g),this.b=_0(t.b),this}copyLinearToSRGB(t){return this.r=qT(t.r),this.g=qT(t.g),this.b=qT(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Ed){return Qo.fromWorkingColorSpace(_A(this,Ks),t),ks(Ks.r*255,0,255)<<16^ks(Ks.g*255,0,255)<<8^ks(Ks.b*255,0,255)<<0}getHexString(t=Ed){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Qo.workingColorSpace){Qo.fromWorkingColorSpace(_A(this,Ks),e);let i=Ks.r,r=Ks.g,n=Ks.b,s=Math.max(i,r,n),a=Math.min(i,r,n),o,l,c=(a+s)/2;if(a===s)o=0,l=0;else{let u=s-a;switch(l=c<=.5?u/(s+a):u/(2-s-a),s){case i:o=(r-n)/u+(r<n?6:0);break;case r:o=(n-i)/u+2;break;case n:o=(i-r)/u+4;break}o/=6}return t.h=o,t.s=l,t.l=c,t}getRGB(t,e=Qo.workingColorSpace){return Qo.fromWorkingColorSpace(_A(this,Ks),e),t.r=Ks.r,t.g=Ks.g,t.b=Ks.b,t}getStyle(t=Ed){return Qo.fromWorkingColorSpace(_A(this,Ks),t),t!==Ed?`color(${t} ${Ks.r} ${Ks.g} ${Ks.b})`:`rgb(${Ks.r*255|0},${Ks.g*255|0},${Ks.b*255|0})`}offsetHSL(t,e,i){return this.getHSL(Wu),Wu.h+=t,Wu.s+=e,Wu.l+=i,this.setHSL(Wu.h,Wu.s,Wu.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(Wu),t.getHSL(bA);let i=qS(Wu.h,bA.h,e),r=qS(Wu.s,bA.s,e),n=qS(Wu.l,bA.l,e);return this.setHSL(i,r,n),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};bi.NAMES=lq;var qy,cq=class{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{qy===void 0&&(qy=Mw("canvas")),qy.width=t.width,qy.height=t.height;let i=qy.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=qy}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){let e=Mw("canvas");e.width=t.width,e.height=t.height;let i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);let r=i.getImageData(0,0,t.width,t.height),n=r.data;for(let s=0;s<n.length;s++)n[s]=_0(n[s]/255)*255;return i.putImageData(r,0,0),e}else if(t.data){let e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(_0(e[i]/255)*255):e[i]=_0(e[i]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}},uq=class{constructor(e=null){this.isSource=!0,this.uuid=ru(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let r={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let a=0,o=n.length;a<o;a++)n[a].isDataTexture?s.push($R(n[a].image)):s.push($R(n[a]))}else s=$R(n);r.url=s}return i||(e.images[this.uuid]=r),r}};function $R(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?cq.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var xae=0,ns=class extends lo{constructor(t=ns.DEFAULT_IMAGE,e=ns.DEFAULT_MAPPING,i=zn,r=zn,n=Ki,s=P1,a=kn,o=zo,l=ns.DEFAULT_ANISOTROPY,c=vh){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:xae++}),this.uuid=ru(),this.name="",this.source=new uq(t),this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=r,this.magFilter=n,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new Oe(0,0),this.repeat=new Oe(1,1),this.center=new Oe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Hs,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){let e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==eq)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case fp:t.x=t.x-Math.floor(t.x);break;case zn:t.x=t.x<0?0:1;break;case Tz:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case fp:t.y=t.y-Math.floor(t.y);break;case zn:t.y=t.y<0?0:1;break;case Tz:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}};ns.DEFAULT_IMAGE=null;ns.DEFAULT_MAPPING=eq;ns.DEFAULT_ANISOTROPY=1;var Ri=class{constructor(t=0,e=0,i=0,r=1){Ri.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){let e=this.x,i=this.y,r=this.z,n=this.w,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*r+s[12]*n,this.y=s[1]*e+s[5]*i+s[9]*r+s[13]*n,this.z=s[2]*e+s[6]*i+s[10]*r+s[14]*n,this.w=s[3]*e+s[7]*i+s[11]*r+s[15]*n,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);let e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,r,n,s=t.elements,a=s[0],o=s[4],l=s[8],c=s[1],u=s[5],h=s[9],d=s[2],p=s[6],g=s[10];if(Math.abs(o-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(o+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(a+u+g-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;let v=(a+1)/2,b=(u+1)/2,w=(g+1)/2,M=(o+c)/4,E=(l+d)/4,D=(h+p)/4;return v>b&&v>w?v<.01?(i=0,r=.707106781,n=.707106781):(i=Math.sqrt(v),r=M/i,n=E/i):b>w?b<.01?(i=.707106781,r=0,n=.707106781):(r=Math.sqrt(b),i=M/r,n=D/r):w<.01?(i=.707106781,r=.707106781,n=0):(n=Math.sqrt(w),i=E/n,r=D/n),this.set(i,r,n,e),this}let x=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-o)*(c-o));return Math.abs(x)<.001&&(x=1),this.x=(p-h)/x,this.y=(l-d)/x,this.z=(c-o)/x,this.w=Math.acos((a+u+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},yr=class extends lo{constructor(t=1,e=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new Ri(0,0,t,e),this.scissorTest=!1,this.viewport=new Ri(0,0,t,e);let r={width:t,height:e,depth:1};this.texture=new ns(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Ki,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(t,e,i=1){(this.width!==t||this.height!==e||this.depth!==i)&&(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;let e=Object.assign({},t.texture.image);return this.texture.source=new uq(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},hq=class extends ns{constructor(t=null,e=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:r},this.magFilter=nr,this.minFilter=nr,this.wrapR=zn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},bae=class extends ns{constructor(t=null,e=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:r},this.magFilter=nr,this.minFilter=nr,this.wrapR=zn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},dq=class extends yr{constructor(t=1,e=1,i=1,r={}){super(t,e,r),this.isWebGLMultipleRenderTargets=!0;let n=this.texture;this.texture=[];for(let s=0;s<i;s++)this.texture[s]=n.clone(),this.texture[s].isRenderTargetTexture=!0}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let r=0,n=this.texture.length;r<n;r++)this.texture[r].image.width=t,this.texture[r].image.height=e,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(let e=0,i=t.texture.length;e<i;e++)this.texture[e]=t.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}},Ci=class{constructor(t=0,e=0,i=0,r=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=r}static slerpFlat(t,e,i,r,n,s,a){let o=i[r+0],l=i[r+1],c=i[r+2],u=i[r+3],h=n[s+0],d=n[s+1],p=n[s+2],g=n[s+3];if(a===0){t[e+0]=o,t[e+1]=l,t[e+2]=c,t[e+3]=u;return}if(a===1){t[e+0]=h,t[e+1]=d,t[e+2]=p,t[e+3]=g;return}if(u!==g||o!==h||l!==d||c!==p){let x=1-a,v=o*h+l*d+c*p+u*g,b=v>=0?1:-1,w=1-v*v;if(w>Number.EPSILON){let E=Math.sqrt(w),D=Math.atan2(E,v*b);x=Math.sin(x*D)/E,a=Math.sin(a*D)/E}let M=a*b;if(o=o*x+h*M,l=l*x+d*M,c=c*x+p*M,u=u*x+g*M,x===1-a){let E=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=E,l*=E,c*=E,u*=E}}t[e]=o,t[e+1]=l,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,i,r,n,s){let a=i[r],o=i[r+1],l=i[r+2],c=i[r+3],u=n[s],h=n[s+1],d=n[s+2],p=n[s+3];return t[e]=a*p+c*u+o*d-l*h,t[e+1]=o*p+c*h+l*u-a*d,t[e+2]=l*p+c*d+a*h-o*u,t[e+3]=c*p-a*u-o*h-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){let i=t._x,r=t._y,n=t._z,s=t._order,a=Math.cos,o=Math.sin,l=a(i/2),c=a(r/2),u=a(n/2),h=o(i/2),d=o(r/2),p=o(n/2);switch(s){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){let i=e/2,r=Math.sin(i);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){let e=t.elements,i=e[0],r=e[4],n=e[8],s=e[1],a=e[5],o=e[9],l=e[2],c=e[6],u=e[10],h=i+a+u;if(h>0){let d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(c-o)*d,this._y=(n-l)*d,this._z=(s-r)*d}else if(i>a&&i>u){let d=2*Math.sqrt(1+i-a-u);this._w=(c-o)/d,this._x=.25*d,this._y=(r+s)/d,this._z=(n+l)/d}else if(a>u){let d=2*Math.sqrt(1+a-i-u);this._w=(n-l)/d,this._x=(r+s)/d,this._y=.25*d,this._z=(o+c)/d}else{let d=2*Math.sqrt(1+u-i-a);this._w=(s-r)/d,this._x=(n+l)/d,this._y=(o+c)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(ks(this.dot(t),-1,1)))}rotateTowards(t,e){let i=this.angleTo(t);if(i===0)return this;let r=Math.min(1,e/i);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){let i=t._x,r=t._y,n=t._z,s=t._w,a=e._x,o=e._y,l=e._z,c=e._w;return this._x=i*c+s*a+r*l-n*o,this._y=r*c+s*o+n*a-i*l,this._z=n*c+s*l+i*o-r*a,this._w=s*c-i*a-r*o-n*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);let i=this._x,r=this._y,n=this._z,s=this._w,a=s*t._w+i*t._x+r*t._y+n*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=i,this._y=r,this._z=n,this;let o=1-a*a;if(o<=Number.EPSILON){let d=1-e;return this._w=d*s+e*this._w,this._x=d*i+e*this._x,this._y=d*r+e*this._y,this._z=d*n+e*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),c=Math.atan2(l,a),u=Math.sin((1-e)*c)/l,h=Math.sin(e*c)/l;return this._w=s*u+this._w*h,this._x=i*u+this._x*h,this._y=r*u+this._y*h,this._z=n*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){let t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),r=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(e*Math.cos(r),i*Math.sin(n),i*Math.cos(n),e*Math.sin(r))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},W=class{constructor(e=0,i=0,r=0){W.prototype.isVector3=!0,this.x=e,this.y=i,this.z=r}set(e,i,r){return r===void 0&&(r=this.z),this.x=e,this.y=i,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(Hk.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(Hk.setFromAxisAngle(e,i))}applyMatrix3(e){let i=this.x,r=this.y,n=this.z,s=e.elements;return this.x=s[0]*i+s[3]*r+s[6]*n,this.y=s[1]*i+s[4]*r+s[7]*n,this.z=s[2]*i+s[5]*r+s[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let i=this.x,r=this.y,n=this.z,s=e.elements,a=1/(s[3]*i+s[7]*r+s[11]*n+s[15]);return this.x=(s[0]*i+s[4]*r+s[8]*n+s[12])*a,this.y=(s[1]*i+s[5]*r+s[9]*n+s[13])*a,this.z=(s[2]*i+s[6]*r+s[10]*n+s[14])*a,this}applyQuaternion(e){let i=this.x,r=this.y,n=this.z,s=e.x,a=e.y,o=e.z,l=e.w,c=l*i+a*n-o*r,u=l*r+o*i-s*n,h=l*n+s*r-a*i,d=-s*i-a*r-o*n;return this.x=c*l+d*-s+u*-o-h*-a,this.y=u*l+d*-a+h*-s-c*-o,this.z=h*l+d*-o+c*-a-u*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let i=this.x,r=this.y,n=this.z,s=e.elements;return this.x=s[0]*i+s[4]*r+s[8]*n,this.y=s[1]*i+s[5]*r+s[9]*n,this.z=s[2]*i+s[6]*r+s[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){let r=e.x,n=e.y,s=e.z,a=i.x,o=i.y,l=i.z;return this.x=n*l-s*o,this.y=s*a-r*l,this.z=r*o-n*a,this}projectOnVector(e){let i=e.lengthSq();if(i===0)return this.set(0,0,0);let r=e.dot(this)/i;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return eO.copy(this).projectOnVector(e),this.sub(eO)}reflect(e){return this.sub(eO.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;let r=this.dot(e)/i;return Math.acos(ks(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let i=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return i*i+r*r+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,r){let n=Math.sin(i)*e;return this.x=n*Math.sin(r),this.y=Math.cos(i)*e,this.z=n*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,r){return this.x=e*Math.sin(i),this.y=r,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){let i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){let i=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=r,this.z=n,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,i=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(i),this.y=r*Math.sin(i),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},eO=new W,Hk=new Ci,Os=class{constructor(t=new W(1/0,1/0,1/0),e=new W(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.length;o<l;o+=3){let c=t[o],u=t[o+1],h=t[o+2];c<e&&(e=c),u<i&&(i=u),h<r&&(r=h),c>n&&(n=c),u>s&&(s=u),h>a&&(a=h)}return this.min.set(e,i,r),this.max.set(n,s,a),this}setFromBufferAttribute(t){let e=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.count;o<l;o++){let c=t.getX(o),u=t.getY(o),h=t.getZ(o);c<e&&(e=c),u<i&&(i=u),h<r&&(r=h),c>n&&(n=c),u>s&&(s=u),h>a&&(a=h)}return this.min.set(e,i,r),this.max.set(n,s,a),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){let i=Sv.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);let i=t.geometry;if(i!==void 0)if(e&&i.attributes!=null&&i.attributes.position!==void 0){let n=i.attributes.position;for(let s=0,a=n.count;s<a;s++)Sv.fromBufferAttribute(n,s).applyMatrix4(t.matrixWorld),this.expandByPoint(Sv)}else i.boundingBox===null&&i.computeBoundingBox(),tO.copy(i.boundingBox),tO.applyMatrix4(t.matrixWorld),this.union(tO);let r=t.children;for(let n=0,s=r.length;n<s;n++)this.expandByObject(r[n],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Sv),Sv.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(H_),SA.subVectors(this.max,H_),Xy.subVectors(t.a,H_),Yy.subVectors(t.b,H_),Qy.subVectors(t.c,H_),wm.subVectors(Yy,Xy),Mm.subVectors(Qy,Yy),wv.subVectors(Xy,Qy);let e=[0,-wm.z,wm.y,0,-Mm.z,Mm.y,0,-wv.z,wv.y,wm.z,0,-wm.x,Mm.z,0,-Mm.x,wv.z,0,-wv.x,-wm.y,wm.x,0,-Mm.y,Mm.x,0,-wv.y,wv.x,0];return!iO(e,Xy,Yy,Qy,SA)||(e=[1,0,0,0,1,0,0,0,1],!iO(e,Xy,Yy,Qy,SA))?!1:(wA.crossVectors(wm,Mm),e=[wA.x,wA.y,wA.z],iO(e,Xy,Yy,Qy,SA))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Sv.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(Sv).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(Uf[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Uf[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Uf[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Uf[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Uf[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Uf[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Uf[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Uf[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Uf),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},Uf=[new W,new W,new W,new W,new W,new W,new W,new W],Sv=new W,tO=new Os,Xy=new W,Yy=new W,Qy=new W,wm=new W,Mm=new W,wv=new W,H_=new W,SA=new W,wA=new W,Mv=new W;function iO(t,e,i,r,n){for(let s=0,a=t.length-3;s<=a;s+=3){Mv.fromArray(t,s);let o=n.x*Math.abs(Mv.x)+n.y*Math.abs(Mv.y)+n.z*Math.abs(Mv.z),l=e.dot(Mv),c=i.dot(Mv),u=r.dot(Mv);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}var _ae=new Os,G_=new W,rO=new W,Xl=class{constructor(t=new W,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){let i=this.center;e!==void 0?i.copy(e):_ae.setFromPoints(t).getCenter(i);let r=0;for(let n=0,s=t.length;n<s;n++)r=Math.max(r,i.distanceToSquared(t[n]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){let e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){let i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;G_.subVectors(t,this.center);let e=G_.lengthSq();if(e>this.radius*this.radius){let i=Math.sqrt(e),r=(i-this.radius)*.5;this.center.addScaledVector(G_,r/i),this.radius+=r}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(rO.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(G_.copy(t.center).add(rO)),this.expandByPoint(G_.copy(t.center).sub(rO))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}},Bf=new W,nO=new W,MA=new W,Em=new W,sO=new W,EA=new W,aO=new W,ob=class{constructor(t=new W,e=new W(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Bf)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);let i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){let e=Bf.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Bf.copy(this.direction).multiplyScalar(e).add(this.origin),Bf.distanceToSquared(t))}distanceSqToSegment(t,e,i,r){nO.copy(t).add(e).multiplyScalar(.5),MA.copy(e).sub(t).normalize(),Em.copy(this.origin).sub(nO);let n=t.distanceTo(e)*.5,s=-this.direction.dot(MA),a=Em.dot(this.direction),o=-Em.dot(MA),l=Em.lengthSq(),c=Math.abs(1-s*s),u,h,d,p;if(c>0)if(u=s*o-a,h=s*a-o,p=n*c,u>=0)if(h>=-p)if(h<=p){let g=1/c;u*=g,h*=g,d=u*(u+s*h+2*a)+h*(s*u+h+2*o)+l}else h=n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h=-n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h<=-p?(u=Math.max(0,-(-s*n+a)),h=u>0?-n:Math.min(Math.max(-n,-o),n),d=-u*u+h*(h+2*o)+l):h<=p?(u=0,h=Math.min(Math.max(-n,-o),n),d=h*(h+2*o)+l):(u=Math.max(0,-(s*n+a)),h=u>0?n:Math.min(Math.max(-n,-o),n),d=-u*u+h*(h+2*o)+l);else h=s>0?-n:n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(MA).multiplyScalar(h).add(nO),d}intersectSphere(t,e){Bf.subVectors(t.center,this.origin);let i=Bf.dot(this.direction),r=Bf.dot(Bf)-i*i,n=t.radius*t.radius;if(r>n)return null;let s=Math.sqrt(n-r),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){let e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){let i=this.distanceToPlane(t);return i===null?null:this.at(i,e)}intersectsPlane(t){let e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,r,n,s,a,o,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(i=(t.min.x-h.x)*l,r=(t.max.x-h.x)*l):(i=(t.max.x-h.x)*l,r=(t.min.x-h.x)*l),c>=0?(n=(t.min.y-h.y)*c,s=(t.max.y-h.y)*c):(n=(t.max.y-h.y)*c,s=(t.min.y-h.y)*c),i>s||n>r||((n>i||isNaN(i))&&(i=n),(s<r||isNaN(r))&&(r=s),u>=0?(a=(t.min.z-h.z)*u,o=(t.max.z-h.z)*u):(a=(t.max.z-h.z)*u,o=(t.min.z-h.z)*u),i>o||a>r)||((a>i||i!==i)&&(i=a),(o<r||r!==r)&&(r=o),r<0)?null:this.at(i>=0?i:r,e)}intersectsBox(t){return this.intersectBox(t,Bf)!==null}intersectTriangle(t,e,i,r,n){sO.subVectors(e,t),EA.subVectors(i,t),aO.crossVectors(sO,EA);let s=this.direction.dot(aO),a;if(s>0){if(r)return null;a=1}else if(s<0)a=-1,s=-s;else return null;Em.subVectors(this.origin,t);let o=a*this.direction.dot(EA.crossVectors(Em,EA));if(o<0)return null;let l=a*this.direction.dot(sO.cross(Em));if(l<0||o+l>s)return null;let c=-a*Em.dot(aO);return c<0?null:this.at(c/s,n)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Ot=class{constructor(){Ot.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,i,r,n,s,a,o,l,c,u,h,d,p,g,x){let v=this.elements;return v[0]=t,v[4]=e,v[8]=i,v[12]=r,v[1]=n,v[5]=s,v[9]=a,v[13]=o,v[2]=l,v[6]=c,v[10]=u,v[14]=h,v[3]=d,v[7]=p,v[11]=g,v[15]=x,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ot().fromArray(this.elements)}copy(t){let e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){let e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){let e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){let e=this.elements,i=t.elements,r=1/Zy.setFromMatrixColumn(t,0).length(),n=1/Zy.setFromMatrixColumn(t,1).length(),s=1/Zy.setFromMatrixColumn(t,2).length();return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=0,e[4]=i[4]*n,e[5]=i[5]*n,e[6]=i[6]*n,e[7]=0,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){let e=this.elements,i=t.x,r=t.y,n=t.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(r),l=Math.sin(r),c=Math.cos(n),u=Math.sin(n);if(t.order==="XYZ"){let h=s*c,d=s*u,p=a*c,g=a*u;e[0]=o*c,e[4]=-o*u,e[8]=l,e[1]=d+p*l,e[5]=h-g*l,e[9]=-a*o,e[2]=g-h*l,e[6]=p+d*l,e[10]=s*o}else if(t.order==="YXZ"){let h=o*c,d=o*u,p=l*c,g=l*u;e[0]=h+g*a,e[4]=p*a-d,e[8]=s*l,e[1]=s*u,e[5]=s*c,e[9]=-a,e[2]=d*a-p,e[6]=g+h*a,e[10]=s*o}else if(t.order==="ZXY"){let h=o*c,d=o*u,p=l*c,g=l*u;e[0]=h-g*a,e[4]=-s*u,e[8]=p+d*a,e[1]=d+p*a,e[5]=s*c,e[9]=g-h*a,e[2]=-s*l,e[6]=a,e[10]=s*o}else if(t.order==="ZYX"){let h=s*c,d=s*u,p=a*c,g=a*u;e[0]=o*c,e[4]=p*l-d,e[8]=h*l+g,e[1]=o*u,e[5]=g*l+h,e[9]=d*l-p,e[2]=-l,e[6]=a*o,e[10]=s*o}else if(t.order==="YZX"){let h=s*o,d=s*l,p=a*o,g=a*l;e[0]=o*c,e[4]=g-h*u,e[8]=p*u+d,e[1]=u,e[5]=s*c,e[9]=-a*c,e[2]=-l*c,e[6]=d*u+p,e[10]=h-g*u}else if(t.order==="XZY"){let h=s*o,d=s*l,p=a*o,g=a*l;e[0]=o*c,e[4]=-u,e[8]=l*c,e[1]=h*u+g,e[5]=s*c,e[9]=d*u-p,e[2]=p*u-d,e[6]=a*c,e[10]=g*u+h}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Sae,t,wae)}lookAt(t,e,i){let r=this.elements;return hc.subVectors(t,e),hc.lengthSq()===0&&(hc.z=1),hc.normalize(),Am.crossVectors(i,hc),Am.lengthSq()===0&&(Math.abs(i.z)===1?hc.x+=1e-4:hc.z+=1e-4,hc.normalize(),Am.crossVectors(i,hc)),Am.normalize(),AA.crossVectors(hc,Am),r[0]=Am.x,r[4]=AA.x,r[8]=hc.x,r[1]=Am.y,r[5]=AA.y,r[9]=hc.y,r[2]=Am.z,r[6]=AA.z,r[10]=hc.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let i=t.elements,r=e.elements,n=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],c=i[1],u=i[5],h=i[9],d=i[13],p=i[2],g=i[6],x=i[10],v=i[14],b=i[3],w=i[7],M=i[11],E=i[15],D=r[0],T=r[4],L=r[8],P=r[12],R=r[1],O=r[5],U=r[9],F=r[13],V=r[2],k=r[6],K=r[10],X=r[14],$=r[3],Y=r[7],re=r[11],G=r[15];return n[0]=s*D+a*R+o*V+l*$,n[4]=s*T+a*O+o*k+l*Y,n[8]=s*L+a*U+o*K+l*re,n[12]=s*P+a*F+o*X+l*G,n[1]=c*D+u*R+h*V+d*$,n[5]=c*T+u*O+h*k+d*Y,n[9]=c*L+u*U+h*K+d*re,n[13]=c*P+u*F+h*X+d*G,n[2]=p*D+g*R+x*V+v*$,n[6]=p*T+g*O+x*k+v*Y,n[10]=p*L+g*U+x*K+v*re,n[14]=p*P+g*F+x*X+v*G,n[3]=b*D+w*R+M*V+E*$,n[7]=b*T+w*O+M*k+E*Y,n[11]=b*L+w*U+M*K+E*re,n[15]=b*P+w*F+M*X+E*G,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){let t=this.elements,e=t[0],i=t[4],r=t[8],n=t[12],s=t[1],a=t[5],o=t[9],l=t[13],c=t[2],u=t[6],h=t[10],d=t[14],p=t[3],g=t[7],x=t[11],v=t[15];return p*(+n*o*u-r*l*u-n*a*h+i*l*h+r*a*d-i*o*d)+g*(+e*o*d-e*l*h+n*s*h-r*s*d+r*l*c-n*o*c)+x*(+e*l*u-e*a*d-n*s*u+i*s*d+n*a*c-i*l*c)+v*(-r*a*c-e*o*u+e*a*h+r*s*u-i*s*h+i*o*c)}transpose(){let t=this.elements,e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){let r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=i),this}invert(){let t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11],p=t[12],g=t[13],x=t[14],v=t[15],b=u*x*l-g*h*l+g*o*d-a*x*d-u*o*v+a*h*v,w=p*h*l-c*x*l-p*o*d+s*x*d+c*o*v-s*h*v,M=c*g*l-p*u*l+p*a*d-s*g*d-c*a*v+s*u*v,E=p*u*o-c*g*o-p*a*h+s*g*h+c*a*x-s*u*x,D=e*b+i*w+r*M+n*E;if(D===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let T=1/D;return t[0]=b*T,t[1]=(g*h*n-u*x*n-g*r*d+i*x*d+u*r*v-i*h*v)*T,t[2]=(a*x*n-g*o*n+g*r*l-i*x*l-a*r*v+i*o*v)*T,t[3]=(u*o*n-a*h*n-u*r*l+i*h*l+a*r*d-i*o*d)*T,t[4]=w*T,t[5]=(c*x*n-p*h*n+p*r*d-e*x*d-c*r*v+e*h*v)*T,t[6]=(p*o*n-s*x*n-p*r*l+e*x*l+s*r*v-e*o*v)*T,t[7]=(s*h*n-c*o*n+c*r*l-e*h*l-s*r*d+e*o*d)*T,t[8]=M*T,t[9]=(p*u*n-c*g*n-p*i*d+e*g*d+c*i*v-e*u*v)*T,t[10]=(s*g*n-p*a*n+p*i*l-e*g*l-s*i*v+e*a*v)*T,t[11]=(c*a*n-s*u*n-c*i*l+e*u*l+s*i*d-e*a*d)*T,t[12]=E*T,t[13]=(c*g*r-p*u*r+p*i*h-e*g*h-c*i*x+e*u*x)*T,t[14]=(p*a*r-s*g*r-p*i*o+e*g*o+s*i*x-e*a*x)*T,t[15]=(s*u*r-c*a*r+c*i*o-e*u*o-s*i*h+e*a*h)*T,this}scale(t){let e=this.elements,i=t.x,r=t.y,n=t.z;return e[0]*=i,e[4]*=r,e[8]*=n,e[1]*=i,e[5]*=r,e[9]*=n,e[2]*=i,e[6]*=r,e[10]*=n,e[3]*=i,e[7]*=r,e[11]*=n,this}getMaxScaleOnAxis(){let t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){let e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){let e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){let e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){let i=Math.cos(e),r=Math.sin(e),n=1-i,s=t.x,a=t.y,o=t.z,l=n*s,c=n*a;return this.set(l*s+i,l*a-r*o,l*o+r*a,0,l*a+r*o,c*a+i,c*o-r*s,0,l*o-r*a,c*o+r*s,n*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,r,n,s){return this.set(1,i,n,0,t,1,s,0,e,r,1,0,0,0,0,1),this}compose(t,e,i){let r=this.elements,n=e._x,s=e._y,a=e._z,o=e._w,l=n+n,c=s+s,u=a+a,h=n*l,d=n*c,p=n*u,g=s*c,x=s*u,v=a*u,b=o*l,w=o*c,M=o*u,E=i.x,D=i.y,T=i.z;return r[0]=(1-(g+v))*E,r[1]=(d+M)*E,r[2]=(p-w)*E,r[3]=0,r[4]=(d-M)*D,r[5]=(1-(h+v))*D,r[6]=(x+b)*D,r[7]=0,r[8]=(p+w)*T,r[9]=(x-b)*T,r[10]=(1-(h+g))*T,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,i){let r=this.elements,n=Zy.set(r[0],r[1],r[2]).length(),s=Zy.set(r[4],r[5],r[6]).length(),a=Zy.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),t.x=r[12],t.y=r[13],t.z=r[14],qu.copy(this);let o=1/n,l=1/s,c=1/a;return qu.elements[0]*=o,qu.elements[1]*=o,qu.elements[2]*=o,qu.elements[4]*=l,qu.elements[5]*=l,qu.elements[6]*=l,qu.elements[8]*=c,qu.elements[9]*=c,qu.elements[10]*=c,e.setFromRotationMatrix(qu),i.x=n,i.y=s,i.z=a,this}makePerspective(t,e,i,r,n,s){let a=this.elements,o=2*n/(e-t),l=2*n/(i-r),c=(e+t)/(e-t),u=(i+r)/(i-r),h=-(s+n)/(s-n),d=-2*s*n/(s-n);return a[0]=o,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,r,n,s){let a=this.elements,o=1/(e-t),l=1/(i-r),c=1/(s-n),u=(e+t)*o,h=(i+r)*l,d=(s+n)*c;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){let e=this.elements,i=t.elements;for(let r=0;r<16;r++)if(e[r]!==i[r])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){let i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}},Zy=new W,qu=new Ot,Sae=new W(0,0,0),wae=new W(1,1,1),Am=new W,AA=new W,hc=new W,Gk=new Ot,jk=new Ci,ia=class{constructor(t=0,e=0,i=0,r=ia.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,r=this._order){return this._x=t,this._y=e,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){let r=t.elements,n=r[0],s=r[4],a=r[8],o=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(e){case"XYZ":this._y=Math.asin(ks(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ks(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,n),this._z=0);break;case"ZXY":this._x=Math.asin(ks(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,n));break;case"ZYX":this._y=Math.asin(-ks(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,n)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(ks(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,n)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-ks(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return Gk.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Gk,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return jk.setFromEuler(this),this.setFromQuaternion(jk,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};ia.DEFAULT_ORDER="XYZ";var yN=class{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}},Mae=0,Wk=new W,Ky=new Ci,Nf=new Ot,TA=new W,j_=new W,Eae=new W,Aae=new Ci,qk=new W(1,0,0),Xk=new W(0,1,0),Yk=new W(0,0,1),Tae={type:"added"},Qk={type:"removed"},Kr=class extends lo{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Mae++}),this.uuid=ru(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Kr.DEFAULT_UP.clone();let t=new W,e=new ia,i=new Ci,r=new W(1,1,1);function n(){i.setFromEuler(e,!1)}function s(){e.setFromQuaternion(i,void 0,!1)}e._onChange(n),i._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Ot},normalMatrix:{value:new Hs}}),this.matrix=new Ot,this.matrixWorld=new Ot,this.matrixAutoUpdate=Kr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Kr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new yN,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Ky.setFromAxisAngle(t,e),this.quaternion.multiply(Ky),this}rotateOnWorldAxis(t,e){return Ky.setFromAxisAngle(t,e),this.quaternion.premultiply(Ky),this}rotateX(t){return this.rotateOnAxis(qk,t)}rotateY(t){return this.rotateOnAxis(Xk,t)}rotateZ(t){return this.rotateOnAxis(Yk,t)}translateOnAxis(t,e){return Wk.copy(t).applyQuaternion(this.quaternion),this.position.add(Wk.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(qk,t)}translateY(t){return this.translateOnAxis(Xk,t)}translateZ(t){return this.translateOnAxis(Yk,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Nf.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?TA.copy(t):TA.set(t,e,i);let r=this.parent;this.updateWorldMatrix(!0,!1),j_.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Nf.lookAt(j_,TA,this.up):Nf.lookAt(TA,j_,this.up),this.quaternion.setFromRotationMatrix(Nf),r&&(Nf.extractRotation(r.matrixWorld),Ky.setFromRotationMatrix(Nf),this.quaternion.premultiply(Ky.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Tae)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Qk)),this}removeFromParent(){let t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){let e=this.children[t];e.parent=null,e.dispatchEvent(Qk)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Nf.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Nf.multiply(t.parent.matrixWorld)),t.applyMatrix4(Nf),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,r=this.children.length;i<r;i++){let n=this.children[i].getObjectByProperty(t,e);if(n!==void 0)return n}}getObjectsByProperty(t,e){let i=[];this[t]===e&&i.push(this);for(let r=0,n=this.children.length;r<n;r++){let s=this.children[r].getObjectsByProperty(t,e);s.length>0&&(i=i.concat(s))}return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(j_,t,Eae),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(j_,Aae,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);let e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);let e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].traverseVisible(t)}traverseAncestors(t){let e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);let e=this.children;for(let i=0,r=e.length;i<r;i++){let n=e[i];(n.matrixWorldAutoUpdate===!0||t===!0)&&n.updateMatrixWorld(t)}}updateWorldMatrix(t,e){let i=this.parent;if(t===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){let r=this.children;for(let n=0,s=r.length;n<s;n++){let a=r[n];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(t){let e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function n(a,o){return a[o.uuid]===void 0&&(a[o.uuid]=o.toJSON(t)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=n(t.geometries,this.geometry);let a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){let o=a.shapes;if(Array.isArray(o))for(let l=0,c=o.length;l<c;l++){let u=o[l];n(t.shapes,u)}else n(t.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let a=[];for(let o=0,l=this.material.length;o<l;o++)a.push(n(t.materials,this.material[o]));r.material=a}else r.material=n(t.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){let o=this.animations[a];r.animations.push(n(t.animations,o))}}if(e){let a=s(t.geometries),o=s(t.materials),l=s(t.textures),c=s(t.images),u=s(t.shapes),h=s(t.skeletons),d=s(t.animations),p=s(t.nodes);a.length>0&&(i.geometries=a),o.length>0&&(i.materials=o),l.length>0&&(i.textures=l),c.length>0&&(i.images=c),u.length>0&&(i.shapes=u),h.length>0&&(i.skeletons=h),d.length>0&&(i.animations=d),p.length>0&&(i.nodes=p)}return i.object=r,i;function s(a){let o=[];for(let l in a){let c=a[l];delete c.metadata,o.push(c)}return o}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){let r=t.children[i];this.add(r.clone())}return this}};Kr.DEFAULT_UP=new W(0,1,0);Kr.DEFAULT_MATRIX_AUTO_UPDATE=!0;Kr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var Xu=new W,Ff=new W,oO=new W,kf=new W,Jy=new W,$y=new W,Zk=new W,lO=new W,cO=new W,uO=new W,$a=class{constructor(t=new W,e=new W,i=new W){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,r){r.subVectors(i,e),Xu.subVectors(t,e),r.cross(Xu);let n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}static getBarycoord(t,e,i,r,n){Xu.subVectors(r,e),Ff.subVectors(i,e),oO.subVectors(t,e);let s=Xu.dot(Xu),a=Xu.dot(Ff),o=Xu.dot(oO),l=Ff.dot(Ff),c=Ff.dot(oO),u=s*l-a*a;if(u===0)return n.set(-2,-1,-1);let h=1/u,d=(l*o-a*c)*h,p=(s*c-a*o)*h;return n.set(1-d-p,p,d)}static containsPoint(t,e,i,r){return this.getBarycoord(t,e,i,r,kf),kf.x>=0&&kf.y>=0&&kf.x+kf.y<=1}static getUV(t,e,i,r,n,s,a,o){return this.getBarycoord(t,e,i,r,kf),o.set(0,0),o.addScaledVector(n,kf.x),o.addScaledVector(s,kf.y),o.addScaledVector(a,kf.z),o}static isFrontFacing(t,e,i,r){return Xu.subVectors(i,e),Ff.subVectors(t,e),Xu.cross(Ff).dot(r)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,r){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,i,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,r),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Xu.subVectors(this.c,this.b),Ff.subVectors(this.a,this.b),Xu.cross(Ff).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return $a.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return $a.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,r,n){return $a.getUV(t,this.a,this.b,this.c,e,i,r,n)}containsPoint(t){return $a.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return $a.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){let i=this.a,r=this.b,n=this.c,s,a;Jy.subVectors(r,i),$y.subVectors(n,i),lO.subVectors(t,i);let o=Jy.dot(lO),l=$y.dot(lO);if(o<=0&&l<=0)return e.copy(i);cO.subVectors(t,r);let c=Jy.dot(cO),u=$y.dot(cO);if(c>=0&&u<=c)return e.copy(r);let h=o*u-c*l;if(h<=0&&o>=0&&c<=0)return s=o/(o-c),e.copy(i).addScaledVector(Jy,s);uO.subVectors(t,n);let d=Jy.dot(uO),p=$y.dot(uO);if(p>=0&&d<=p)return e.copy(n);let g=d*l-o*p;if(g<=0&&l>=0&&p<=0)return a=l/(l-p),e.copy(i).addScaledVector($y,a);let x=c*p-d*u;if(x<=0&&u-c>=0&&d-p>=0)return Zk.subVectors(n,r),a=(u-c)/(u-c+(d-p)),e.copy(r).addScaledVector(Zk,a);let v=1/(x+g+h);return s=g*v,a=h*v,e.copy(i).addScaledVector(Jy,s).addScaledVector($y,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},Cae=0,xM=class extends lo{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Cae++}),this.uuid=ru(),this.name="",this.type="Material",this.blending=y0,this.side=gh,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=K7,this.blendDst=J7,this.blendEquation=qx,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Mz,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=iae,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=QR,this.stencilZFail=QR,this.stencilZPass=QR,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(let e in t){let i=t[e];if(i===void 0){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}let r=this[e];if(r===void 0){console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[e]=i}}toJSON(t){let e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==y0&&(i.blending=this.blending),this.side!==gh&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(n){let s=[];for(let a in n){let o=n[a];delete o.metadata,s.push(o)}return s}if(e){let n=r(t.textures),s=r(t.images);n.length>0&&(i.textures=n),s.length>0&&(i.images=s)}return i}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;let e=t.clippingPlanes,i=null;if(e!==null){let r=e.length;i=new Array(r);for(let n=0;n!==r;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}},Tp=class extends xM{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new bi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$7,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}},Bs=new W,CA=new Oe,_i=class{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=i,this.usage=Cz,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[t+r]=e.array[i+r];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)CA.fromBufferAttribute(this,e),CA.applyMatrix3(t),this.setXY(e,CA.x,CA.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)Bs.fromBufferAttribute(this,e),Bs.applyMatrix3(t),this.setXYZ(e,Bs.x,Bs.y,Bs.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)Bs.fromBufferAttribute(this,e),Bs.applyMatrix4(t),this.setXYZ(e,Bs.x,Bs.y,Bs.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Bs.fromBufferAttribute(this,e),Bs.applyNormalMatrix(t),this.setXYZ(e,Bs.x,Bs.y,Bs.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Bs.fromBufferAttribute(this,e),Bs.transformDirection(t),this.setXYZ(e,Bs.x,Bs.y,Bs.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=mp(e,this.array)),e}setX(t,e){return this.normalized&&(e=xn(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=mp(e,this.array)),e}setY(t,e){return this.normalized&&(e=xn(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=mp(e,this.array)),e}setZ(t,e){return this.normalized&&(e=xn(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=mp(e,this.array)),e}setW(t,e){return this.normalized&&(e=xn(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=xn(e,this.array),i=xn(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,r){return t*=this.itemSize,this.normalized&&(e=xn(e,this.array),i=xn(i,this.array),r=xn(r,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this}setXYZW(t,e,i,r,n){return t*=this.itemSize,this.normalized&&(e=xn(e,this.array),i=xn(i,this.array),r=xn(r,this.array),n=xn(n,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==Cz&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},fq=class extends _i{constructor(t,e,i){super(new Uint16Array(t),e,i)}},f1=class extends _i{constructor(t,e,i){super(new Uint32Array(t),e,i)}},Wt=class extends _i{constructor(t,e,i){super(new Float32Array(t),e,i)}},Dae=0,Vc=new Ot,hO=new Kr,ex=new W,dc=new Os,W_=new Os,wa=new W,ni=class extends lo{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Dae++}),this.uuid=ru(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(oq(t)?f1:fq)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){let e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let n=new Hs().getNormalMatrix(t);i.applyNormalMatrix(n),i.needsUpdate=!0}let r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(t),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return Vc.makeRotationFromQuaternion(t),this.applyMatrix4(Vc),this}rotateX(t){return Vc.makeRotationX(t),this.applyMatrix4(Vc),this}rotateY(t){return Vc.makeRotationY(t),this.applyMatrix4(Vc),this}rotateZ(t){return Vc.makeRotationZ(t),this.applyMatrix4(Vc),this}translate(t,e,i){return Vc.makeTranslation(t,e,i),this.applyMatrix4(Vc),this}scale(t,e,i){return Vc.makeScale(t,e,i),this.applyMatrix4(Vc),this}lookAt(t){return hO.lookAt(t),hO.updateMatrix(),this.applyMatrix4(hO.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ex).negate(),this.translate(ex.x,ex.y,ex.z),this}setFromPoints(t){let e=[];for(let i=0,r=t.length;i<r;i++){let n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Wt(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Os);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new W(-1/0,-1/0,-1/0),new W(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,r=e.length;i<r;i++){let n=e[i];dc.setFromBufferAttribute(n),this.morphTargetsRelative?(wa.addVectors(this.boundingBox.min,dc.min),this.boundingBox.expandByPoint(wa),wa.addVectors(this.boundingBox.max,dc.max),this.boundingBox.expandByPoint(wa)):(this.boundingBox.expandByPoint(dc.min),this.boundingBox.expandByPoint(dc.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Xl);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new W,1/0);return}if(t){let i=this.boundingSphere.center;if(dc.setFromBufferAttribute(t),e)for(let n=0,s=e.length;n<s;n++){let a=e[n];W_.setFromBufferAttribute(a),this.morphTargetsRelative?(wa.addVectors(dc.min,W_.min),dc.expandByPoint(wa),wa.addVectors(dc.max,W_.max),dc.expandByPoint(wa)):(dc.expandByPoint(W_.min),dc.expandByPoint(W_.max))}dc.getCenter(i);let r=0;for(let n=0,s=t.count;n<s;n++)wa.fromBufferAttribute(t,n),r=Math.max(r,i.distanceToSquared(wa));if(e)for(let n=0,s=e.length;n<s;n++){let a=e[n],o=this.morphTargetsRelative;for(let l=0,c=a.count;l<c;l++)wa.fromBufferAttribute(a,l),o&&(ex.fromBufferAttribute(t,l),wa.add(ex)),r=Math.max(r,i.distanceToSquared(wa))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=t.array,r=e.position.array,n=e.normal.array,s=e.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new _i(new Float32Array(4*a),4));let o=this.getAttribute("tangent").array,l=[],c=[];for(let R=0;R<a;R++)l[R]=new W,c[R]=new W;let u=new W,h=new W,d=new W,p=new Oe,g=new Oe,x=new Oe,v=new W,b=new W;function w(R,O,U){u.fromArray(r,R*3),h.fromArray(r,O*3),d.fromArray(r,U*3),p.fromArray(s,R*2),g.fromArray(s,O*2),x.fromArray(s,U*2),h.sub(u),d.sub(u),g.sub(p),x.sub(p);let F=1/(g.x*x.y-x.x*g.y);!isFinite(F)||(v.copy(h).multiplyScalar(x.y).addScaledVector(d,-g.y).multiplyScalar(F),b.copy(d).multiplyScalar(g.x).addScaledVector(h,-x.x).multiplyScalar(F),l[R].add(v),l[O].add(v),l[U].add(v),c[R].add(b),c[O].add(b),c[U].add(b))}let M=this.groups;M.length===0&&(M=[{start:0,count:i.length}]);for(let R=0,O=M.length;R<O;++R){let U=M[R],F=U.start,V=U.count;for(let k=F,K=F+V;k<K;k+=3)w(i[k+0],i[k+1],i[k+2])}let E=new W,D=new W,T=new W,L=new W;function P(R){T.fromArray(n,R*3),L.copy(T);let O=l[R];E.copy(O),E.sub(T.multiplyScalar(T.dot(O))).normalize(),D.crossVectors(L,O);let U=D.dot(c[R])<0?-1:1;o[R*4]=E.x,o[R*4+1]=E.y,o[R*4+2]=E.z,o[R*4+3]=U}for(let R=0,O=M.length;R<O;++R){let U=M[R],F=U.start,V=U.count;for(let k=F,K=F+V;k<K;k+=3)P(i[k+0]),P(i[k+1]),P(i[k+2])}}computeVertexNormals(){let t=this.index,e=this.getAttribute("position");if(e!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new _i(new Float32Array(e.count*3),3),this.setAttribute("normal",i);else for(let h=0,d=i.count;h<d;h++)i.setXYZ(h,0,0,0);let r=new W,n=new W,s=new W,a=new W,o=new W,l=new W,c=new W,u=new W;if(t)for(let h=0,d=t.count;h<d;h+=3){let p=t.getX(h+0),g=t.getX(h+1),x=t.getX(h+2);r.fromBufferAttribute(e,p),n.fromBufferAttribute(e,g),s.fromBufferAttribute(e,x),c.subVectors(s,n),u.subVectors(r,n),c.cross(u),a.fromBufferAttribute(i,p),o.fromBufferAttribute(i,g),l.fromBufferAttribute(i,x),a.add(c),o.add(c),l.add(c),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(g,o.x,o.y,o.z),i.setXYZ(x,l.x,l.y,l.z)}else for(let h=0,d=e.count;h<d;h+=3)r.fromBufferAttribute(e,h+0),n.fromBufferAttribute(e,h+1),s.fromBufferAttribute(e,h+2),c.subVectors(s,n),u.subVectors(r,n),c.cross(u),i.setXYZ(h+0,c.x,c.y,c.z),i.setXYZ(h+1,c.x,c.y,c.z),i.setXYZ(h+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)wa.fromBufferAttribute(t,e),wa.normalize(),t.setXYZ(e,wa.x,wa.y,wa.z)}toNonIndexed(){function t(a,o){let l=a.array,c=a.itemSize,u=a.normalized,h=new l.constructor(o.length*c),d=0,p=0;for(let g=0,x=o.length;g<x;g++){a.isInterleavedBufferAttribute?d=o[g]*a.data.stride+a.offset:d=o[g]*c;for(let v=0;v<c;v++)h[p++]=l[d++]}return new _i(h,c,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let e=new ni,i=this.index.array,r=this.attributes;for(let a in r){let o=r[a],l=t(o,i);e.setAttribute(a,l)}let n=this.morphAttributes;for(let a in n){let o=[],l=n[a];for(let c=0,u=l.length;c<u;c++){let h=l[c],d=t(h,i);o.push(d)}e.morphAttributes[a]=o}e.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,o=s.length;a<o;a++){let l=s[a];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){let t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){let o=this.parameters;for(let l in o)o[l]!==void 0&&(t[l]=o[l]);return t}t.data={attributes:{}};let e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});let i=this.attributes;for(let o in i){let l=i[o];t.data.attributes[o]=l.toJSON(t.data)}let r={},n=!1;for(let o in this.morphAttributes){let l=this.morphAttributes[o],c=[];for(let u=0,h=l.length;u<h;u++){let d=l[u];c.push(d.toJSON(t.data))}c.length>0&&(r[o]=c,n=!0)}n&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return a!==null&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let e={};this.name=t.name;let i=t.index;i!==null&&this.setIndex(i.clone(e));let r=t.attributes;for(let l in r){let c=r[l];this.setAttribute(l,c.clone(e))}let n=t.morphAttributes;for(let l in n){let c=[],u=n[l];for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone(e));this.morphAttributes[l]=c}this.morphTargetsRelative=t.morphTargetsRelative;let s=t.groups;for(let l=0,c=s.length;l<c;l++){let u=s[l];this.addGroup(u.start,u.count,u.materialIndex)}let a=t.boundingBox;a!==null&&(this.boundingBox=a.clone());let o=t.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,t.parameters!==void 0&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},Kk=new Ot,tx=new ob,dO=new Xl,q_=new W,X_=new W,Y_=new W,fO=new W,DA=new W,PA=new Oe,RA=new Oe,OA=new Oe,pO=new W,LA=new W,bn=class extends Kr{constructor(t=new ni,e=new Tp){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){let t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){let i=t[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}getVertexPosition(t,e){let i=this.geometry,r=i.attributes.position,n=i.morphAttributes.position,s=i.morphTargetsRelative;e.fromBufferAttribute(r,t);let a=this.morphTargetInfluences;if(n&&a){DA.set(0,0,0);for(let o=0,l=n.length;o<l;o++){let c=a[o],u=n[o];c!==0&&(fO.fromBufferAttribute(u,t),s?DA.addScaledVector(fO,c):DA.addScaledVector(fO.sub(e),c))}e.add(DA)}return this.isSkinnedMesh&&this.boneTransform(t,e),e}raycast(t,e){let i=this.geometry,r=this.material,n=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),dO.copy(i.boundingSphere),dO.applyMatrix4(n),t.ray.intersectsSphere(dO)===!1)||(Kk.copy(n).invert(),tx.copy(t.ray).applyMatrix4(Kk),i.boundingBox!==null&&tx.intersectsBox(i.boundingBox)===!1))return;let s,a=i.index,o=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv2,u=i.groups,h=i.drawRange;if(a!==null)if(Array.isArray(r))for(let d=0,p=u.length;d<p;d++){let g=u[d],x=r[g.materialIndex],v=Math.max(g.start,h.start),b=Math.min(a.count,Math.min(g.start+g.count,h.start+h.count));for(let w=v,M=b;w<M;w+=3){let E=a.getX(w),D=a.getX(w+1),T=a.getX(w+2);s=IA(this,x,t,tx,l,c,E,D,T),s&&(s.faceIndex=Math.floor(w/3),s.face.materialIndex=g.materialIndex,e.push(s))}}else{let d=Math.max(0,h.start),p=Math.min(a.count,h.start+h.count);for(let g=d,x=p;g<x;g+=3){let v=a.getX(g),b=a.getX(g+1),w=a.getX(g+2);s=IA(this,r,t,tx,l,c,v,b,w),s&&(s.faceIndex=Math.floor(g/3),e.push(s))}}else if(o!==void 0)if(Array.isArray(r))for(let d=0,p=u.length;d<p;d++){let g=u[d],x=r[g.materialIndex],v=Math.max(g.start,h.start),b=Math.min(o.count,Math.min(g.start+g.count,h.start+h.count));for(let w=v,M=b;w<M;w+=3){let E=w,D=w+1,T=w+2;s=IA(this,x,t,tx,l,c,E,D,T),s&&(s.faceIndex=Math.floor(w/3),s.face.materialIndex=g.materialIndex,e.push(s))}}else{let d=Math.max(0,h.start),p=Math.min(o.count,h.start+h.count);for(let g=d,x=p;g<x;g+=3){let v=g,b=g+1,w=g+2;s=IA(this,r,t,tx,l,c,v,b,w),s&&(s.faceIndex=Math.floor(g/3),e.push(s))}}}};function Pae(t,e,i,r,n,s,a,o){let l;if(e.side===La?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,e.side===gh,o),l===null)return null;LA.copy(o),LA.applyMatrix4(t.matrixWorld);let c=i.ray.origin.distanceTo(LA);return c<i.near||c>i.far?null:{distance:c,point:LA.clone(),object:t}}function IA(t,e,i,r,n,s,a,o,l){t.getVertexPosition(a,q_),t.getVertexPosition(o,X_),t.getVertexPosition(l,Y_);let c=Pae(t,e,i,r,q_,X_,Y_,pO);if(c){n&&(PA.fromBufferAttribute(n,a),RA.fromBufferAttribute(n,o),OA.fromBufferAttribute(n,l),c.uv=$a.getUV(pO,q_,X_,Y_,PA,RA,OA,new Oe)),s&&(PA.fromBufferAttribute(s,a),RA.fromBufferAttribute(s,o),OA.fromBufferAttribute(s,l),c.uv2=$a.getUV(pO,q_,X_,Y_,PA,RA,OA,new Oe));let u={a,b:o,c:l,normal:new W,materialIndex:0};$a.getNormal(q_,X_,Y_,u.normal),c.face=u}return c}var yh=class extends ni{constructor(t=1,e=1,i=1,r=1,n=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:r,heightSegments:n,depthSegments:s};let a=this;r=Math.floor(r),n=Math.floor(n),s=Math.floor(s);let o=[],l=[],c=[],u=[],h=0,d=0;p("z","y","x",-1,-1,i,e,t,s,n,0),p("z","y","x",1,-1,i,e,-t,s,n,1),p("x","z","y",1,1,t,i,e,r,s,2),p("x","z","y",1,-1,t,i,-e,r,s,3),p("x","y","z",1,-1,t,e,i,r,n,4),p("x","y","z",-1,-1,t,e,-i,r,n,5),this.setIndex(o),this.setAttribute("position",new Wt(l,3)),this.setAttribute("normal",new Wt(c,3)),this.setAttribute("uv",new Wt(u,2));function p(g,x,v,b,w,M,E,D,T,L,P){let R=M/T,O=E/L,U=M/2,F=E/2,V=D/2,k=T+1,K=L+1,X=0,$=0,Y=new W;for(let re=0;re<K;re++){let G=re*O-F;for(let j=0;j<k;j++){let ee=j*R-U;Y[g]=ee*b,Y[x]=G*w,Y[v]=V,l.push(Y.x,Y.y,Y.z),Y[g]=0,Y[x]=0,Y[v]=D>0?1:-1,c.push(Y.x,Y.y,Y.z),u.push(j/T),u.push(1-re/L),X+=1}}for(let re=0;re<L;re++)for(let G=0;G<T;G++){let j=h+G+k*re,ee=h+G+k*(re+1),oe=h+(G+1)+k*(re+1),Q=h+(G+1)+k*re;o.push(j,ee,Q),o.push(ee,oe,Q),$+=6}a.addGroup(d,$,P),d+=$,h+=X}}static fromJSON(t){return new yh(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}};function R1(t){let e={};for(let i in t){e[i]={};for(let r in t[i]){let n=t[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?e[i][r]=n.clone():Array.isArray(n)?e[i][r]=n.slice():e[i][r]=n}}return e}function el(t){let e={};for(let i=0;i<t.length;i++){let r=R1(t[i]);for(let n in r)e[n]=r[n]}return e}function Rae(t){let e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}function pq(t){return t.getRenderTarget()===null&&t.outputEncoding===ji?Ed:AC}var lb={clone:R1,merge:el},Oae=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Lae=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,xr=class extends xM{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Oae,this.fragmentShader=Lae,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=R1(t.uniforms),this.uniformsGroups=Rae(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){let e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(let r in this.uniforms){let n=this.uniforms[r].value;n&&n.isTexture?e.uniforms[r]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[r]={type:"m4",value:n.toArray()}:e.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;let i={};for(let r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}},Pg=class extends Kr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ot,this.projectionMatrix=new Ot,this.projectionMatrixInverse=new Ot}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},Do=class extends Pg{constructor(t=50,e=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){let e=.5*this.getFilmHeight()/t;this.fov=ww*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){let t=Math.tan(WS*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return ww*2*Math.atan(Math.tan(WS*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,r,n,s){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=this.near,e=t*Math.tan(WS*.5*this.fov)/this.zoom,i=2*e,r=this.aspect*i,n=-.5*r,s=this.view;if(this.view!==null&&this.view.enabled){let o=s.fullWidth,l=s.fullHeight;n+=s.offsetX*r/o,e-=s.offsetY*i/l,r*=s.width/o,i*=s.height/l}let a=this.filmOffset;a!==0&&(n+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}},ix=-90,rx=1,Iae=class extends Kr{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i;let r=new Do(ix,rx,t,e);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);let n=new Do(ix,rx,t,e);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(-1,0,0),this.add(n);let s=new Do(ix,rx,t,e);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);let a=new Do(ix,rx,t,e);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);let o=new Do(ix,rx,t,e);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(0,0,1),this.add(o);let l=new Do(ix,rx,t,e);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(t,e){this.parent===null&&this.updateMatrixWorld();let i=this.renderTarget,[r,n,s,a,o,l]=this.children,c=t.getRenderTarget(),u=t.toneMapping,h=t.xr.enabled;t.toneMapping=zd,t.xr.enabled=!1;let d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,r),t.setRenderTarget(i,1),t.render(e,n),t.setRenderTarget(i,2),t.render(e,s),t.setRenderTarget(i,3),t.render(e,a),t.setRenderTarget(i,4),t.render(e,o),i.texture.generateMipmaps=d,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(c),t.toneMapping=u,t.xr.enabled=h,i.texture.needsPMREMUpdate=!0}},xN=class extends ns{constructor(t,e,i,r,n,s,a,o,l,c){t=t!==void 0?t:[],e=e!==void 0?e:R0,super(t,e,i,r,n,s,a,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}},zae=class extends yr{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;let i={width:t,height:t,depth:1},r=[i,i,i,i,i,i];this.texture=new xN(r,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:Ki}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new yh(5,5,5),n=new xr({name:"CubemapFromEquirect",uniforms:R1(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:La,blending:js});n.uniforms.tEquirect.value=e;let s=new bn(r,n),a=e.minFilter;return e.minFilter===P1&&(e.minFilter=Ki),new Iae(1,10,this).update(t,s),e.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,i,r){let n=t.getRenderTarget();for(let s=0;s<6;s++)t.setRenderTarget(this,s),t.clear(e,i,r);t.setRenderTarget(n)}},mO=new W,Uae=new W,Bae=new Hs,Bl=class{constructor(t=new W(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,r){return this.normal.set(t,e,i),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){let r=mO.subVectors(i,e).cross(Uae.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){let t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){let i=t.delta(mO),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;let n=-(t.start.dot(this.normal)+this.constant)/r;return n<0||n>1?null:e.copy(i).multiplyScalar(n).add(t.start)}intersectsLine(t){let e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){let i=e||Bae.getNormalMatrix(t),r=this.coplanarPoint(mO).applyMatrix4(t),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}},nx=new Xl,zA=new W,bN=class{constructor(t=new Bl,e=new Bl,i=new Bl,r=new Bl,n=new Bl,s=new Bl){this.planes=[t,e,i,r,n,s]}set(t,e,i,r,n,s){let a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(r),a[4].copy(n),a[5].copy(s),this}copy(t){let e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){let e=this.planes,i=t.elements,r=i[0],n=i[1],s=i[2],a=i[3],o=i[4],l=i[5],c=i[6],u=i[7],h=i[8],d=i[9],p=i[10],g=i[11],x=i[12],v=i[13],b=i[14],w=i[15];return e[0].setComponents(a-r,u-o,g-h,w-x).normalize(),e[1].setComponents(a+r,u+o,g+h,w+x).normalize(),e[2].setComponents(a+n,u+l,g+d,w+v).normalize(),e[3].setComponents(a-n,u-l,g-d,w-v).normalize(),e[4].setComponents(a-s,u-c,g-p,w-b).normalize(),e[5].setComponents(a+s,u+c,g+p,w+b).normalize(),this}intersectsObject(t){let e=t.geometry;return e.boundingSphere===null&&e.computeBoundingSphere(),nx.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(nx)}intersectsSprite(t){return nx.center.set(0,0,0),nx.radius=.7071067811865476,nx.applyMatrix4(t.matrixWorld),this.intersectsSphere(nx)}intersectsSphere(t){let e=this.planes,i=t.center,r=-t.radius;for(let n=0;n<6;n++)if(e[n].distanceToPoint(i)<r)return!1;return!0}intersectsBox(t){let e=this.planes;for(let i=0;i<6;i++){let r=e[i];if(zA.x=r.normal.x>0?t.max.x:t.min.x,zA.y=r.normal.y>0?t.max.y:t.min.y,zA.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(zA)<0)return!1}return!0}containsPoint(t){let e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function mq(){let t=null,e=!1,i=null,r=null;function n(s,a){i(s,a),r=t.requestAnimationFrame(n)}return{start:function(){e!==!0&&i!==null&&(r=t.requestAnimationFrame(n),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){i=s},setContext:function(s){t=s}}}function Nae(t,e){let i=e.isWebGL2,r=new WeakMap;function n(c,u){let h=c.array,d=c.usage,p=t.createBuffer();t.bindBuffer(u,p),t.bufferData(u,h,d),c.onUploadCallback();let g;if(h instanceof Float32Array)g=5126;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(i)g=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else g=5123;else if(h instanceof Int16Array)g=5122;else if(h instanceof Uint32Array)g=5125;else if(h instanceof Int32Array)g=5124;else if(h instanceof Int8Array)g=5120;else if(h instanceof Uint8Array)g=5121;else if(h instanceof Uint8ClampedArray)g=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:p,type:g,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version}}function s(c,u,h){let d=u.array,p=u.updateRange;t.bindBuffer(h,c),p.count===-1?t.bufferSubData(h,0,d):(i?t.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d,p.offset,p.count):t.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d.subarray(p.offset,p.offset+p.count)),p.count=-1),u.onUploadCallback()}function a(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)}function o(c){c.isInterleavedBufferAttribute&&(c=c.data);let u=r.get(c);u&&(t.deleteBuffer(u.buffer),r.delete(c))}function l(c,u){if(c.isGLBufferAttribute){let d=r.get(c);(!d||d.version<c.version)&&r.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);let h=r.get(c);h===void 0?r.set(c,n(c,u)):h.version<c.version&&(s(h.buffer,c,u),h.version=c.version)}return{get:a,remove:o,update:l}}var jd=class extends ni{constructor(t=1,e=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:r};let n=t/2,s=e/2,a=Math.floor(i),o=Math.floor(r),l=a+1,c=o+1,u=t/a,h=e/o,d=[],p=[],g=[],x=[];for(let v=0;v<c;v++){let b=v*h-s;for(let w=0;w<l;w++){let M=w*u-n;p.push(M,-b,0),g.push(0,0,1),x.push(w/a),x.push(1-v/o)}}for(let v=0;v<o;v++)for(let b=0;b<a;b++){let w=b+l*v,M=b+l*(v+1),E=b+1+l*(v+1),D=b+1+l*v;d.push(w,M,D),d.push(M,E,D)}this.setIndex(d),this.setAttribute("position",new Wt(p,3)),this.setAttribute("normal",new Wt(g,3)),this.setAttribute("uv",new Wt(x,2))}static fromJSON(t){return new jd(t.width,t.height,t.widthSegments,t.heightSegments)}},Fae=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,kae=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Vae=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,Hae=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Gae=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,jae=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Wae="vec3 transformed = vec3( position );",qae=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Xae=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,Yae=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Qae=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Zae=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Kae=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Jae=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,$ae=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,eoe=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,toe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,ioe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,roe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,noe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,soe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,aoe=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,ooe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,loe=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,coe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,uoe=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,hoe="gl_FragColor = linearToOutputTexel( gl_FragColor );",doe=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,foe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,poe=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,moe=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,goe=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,voe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,yoe=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,xoe=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,boe=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,_oe=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Soe=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,woe=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Moe=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Eoe=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Aoe=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Toe=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Coe=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,Doe=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Poe=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Roe=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Ooe=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Loe=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,Ioe=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,zoe=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Uoe=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Boe=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,Noe=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Foe=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,koe=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,Voe=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,Hoe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Goe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,joe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Woe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,qoe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Xoe=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Yoe=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Qoe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,Zoe=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,Koe=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,Joe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,$oe=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,ele=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,tle=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,ile=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,rle=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,nle=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,sle=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,ale=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,ole=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,lle=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,cle=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,ule=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,hle=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dle=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,fle=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,ple=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,mle=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,gle=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,vle=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,yle=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,xle=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,ble=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,_le=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,Sle=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,wle=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Mle=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Ele=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Ale=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Tle=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Cle=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,Dle=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,Ple=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,Rle=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,Ole=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,Lle=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,Ile=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,zle=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,Ule=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,Ble=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Nle=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Fle=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,kle=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Vle=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Hle=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Gle=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,jle=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,Wle=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,qle=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Xle=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Yle=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Qle=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Zle=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Kle=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Jle=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$le=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,ece=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,tce=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,ice=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,rce=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,nce=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,sce=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,ace=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,oce=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,lce=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,cce=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,uce=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,hce=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,dce=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,fce=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,pce=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,mce=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,gce=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Xi={alphamap_fragment:Fae,alphamap_pars_fragment:kae,alphatest_fragment:Vae,alphatest_pars_fragment:Hae,aomap_fragment:Gae,aomap_pars_fragment:jae,begin_vertex:Wae,beginnormal_vertex:qae,bsdfs:Xae,iridescence_fragment:Yae,bumpmap_pars_fragment:Qae,clipping_planes_fragment:Zae,clipping_planes_pars_fragment:Kae,clipping_planes_pars_vertex:Jae,clipping_planes_vertex:$ae,color_fragment:eoe,color_pars_fragment:toe,color_pars_vertex:ioe,color_vertex:roe,common:noe,cube_uv_reflection_fragment:soe,defaultnormal_vertex:aoe,displacementmap_pars_vertex:ooe,displacementmap_vertex:loe,emissivemap_fragment:coe,emissivemap_pars_fragment:uoe,encodings_fragment:hoe,encodings_pars_fragment:doe,envmap_fragment:foe,envmap_common_pars_fragment:poe,envmap_pars_fragment:moe,envmap_pars_vertex:goe,envmap_physical_pars_fragment:Coe,envmap_vertex:voe,fog_vertex:yoe,fog_pars_vertex:xoe,fog_fragment:boe,fog_pars_fragment:_oe,gradientmap_pars_fragment:Soe,lightmap_fragment:woe,lightmap_pars_fragment:Moe,lights_lambert_fragment:Eoe,lights_lambert_pars_fragment:Aoe,lights_pars_begin:Toe,lights_toon_fragment:Doe,lights_toon_pars_fragment:Poe,lights_phong_fragment:Roe,lights_phong_pars_fragment:Ooe,lights_physical_fragment:Loe,lights_physical_pars_fragment:Ioe,lights_fragment_begin:zoe,lights_fragment_maps:Uoe,lights_fragment_end:Boe,logdepthbuf_fragment:Noe,logdepthbuf_pars_fragment:Foe,logdepthbuf_pars_vertex:koe,logdepthbuf_vertex:Voe,map_fragment:Hoe,map_pars_fragment:Goe,map_particle_fragment:joe,map_particle_pars_fragment:Woe,metalnessmap_fragment:qoe,metalnessmap_pars_fragment:Xoe,morphcolor_vertex:Yoe,morphnormal_vertex:Qoe,morphtarget_pars_vertex:Zoe,morphtarget_vertex:Koe,normal_fragment_begin:Joe,normal_fragment_maps:$oe,normal_pars_fragment:ele,normal_pars_vertex:tle,normal_vertex:ile,normalmap_pars_fragment:rle,clearcoat_normal_fragment_begin:nle,clearcoat_normal_fragment_maps:sle,clearcoat_pars_fragment:ale,iridescence_pars_fragment:ole,output_fragment:lle,packing:cle,premultiplied_alpha_fragment:ule,project_vertex:hle,dithering_fragment:dle,dithering_pars_fragment:fle,roughnessmap_fragment:ple,roughnessmap_pars_fragment:mle,shadowmap_pars_fragment:gle,shadowmap_pars_vertex:vle,shadowmap_vertex:yle,shadowmask_pars_fragment:xle,skinbase_vertex:ble,skinning_pars_vertex:_le,skinning_vertex:Sle,skinnormal_vertex:wle,specularmap_fragment:Mle,specularmap_pars_fragment:Ele,tonemapping_fragment:Ale,tonemapping_pars_fragment:Tle,transmission_fragment:Cle,transmission_pars_fragment:Dle,uv_pars_fragment:Ple,uv_pars_vertex:Rle,uv_vertex:Ole,uv2_pars_fragment:Lle,uv2_pars_vertex:Ile,uv2_vertex:zle,worldpos_vertex:Ule,background_vert:Ble,background_frag:Nle,backgroundCube_vert:Fle,backgroundCube_frag:kle,cube_vert:Vle,cube_frag:Hle,depth_vert:Gle,depth_frag:jle,distanceRGBA_vert:Wle,distanceRGBA_frag:qle,equirect_vert:Xle,equirect_frag:Yle,linedashed_vert:Qle,linedashed_frag:Zle,meshbasic_vert:Kle,meshbasic_frag:Jle,meshlambert_vert:$le,meshlambert_frag:ece,meshmatcap_vert:tce,meshmatcap_frag:ice,meshnormal_vert:rce,meshnormal_frag:nce,meshphong_vert:sce,meshphong_frag:ace,meshphysical_vert:oce,meshphysical_frag:lce,meshtoon_vert:cce,meshtoon_frag:uce,points_vert:hce,points_frag:dce,shadow_vert:fce,shadow_frag:pce,sprite_vert:mce,sprite_frag:gce},Vt={common:{diffuse:{value:new bi(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Hs},uv2Transform:{value:new Hs},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Oe(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new bi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new bi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Hs}},sprite:{diffuse:{value:new bi(16777215)},opacity:{value:1},center:{value:new Oe(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Hs}}},Td={basic:{uniforms:el([Vt.common,Vt.specularmap,Vt.envmap,Vt.aomap,Vt.lightmap,Vt.fog]),vertexShader:Xi.meshbasic_vert,fragmentShader:Xi.meshbasic_frag},lambert:{uniforms:el([Vt.common,Vt.specularmap,Vt.envmap,Vt.aomap,Vt.lightmap,Vt.emissivemap,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.fog,Vt.lights,{emissive:{value:new bi(0)}}]),vertexShader:Xi.meshlambert_vert,fragmentShader:Xi.meshlambert_frag},phong:{uniforms:el([Vt.common,Vt.specularmap,Vt.envmap,Vt.aomap,Vt.lightmap,Vt.emissivemap,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.fog,Vt.lights,{emissive:{value:new bi(0)},specular:{value:new bi(1118481)},shininess:{value:30}}]),vertexShader:Xi.meshphong_vert,fragmentShader:Xi.meshphong_frag},standard:{uniforms:el([Vt.common,Vt.envmap,Vt.aomap,Vt.lightmap,Vt.emissivemap,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.roughnessmap,Vt.metalnessmap,Vt.fog,Vt.lights,{emissive:{value:new bi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Xi.meshphysical_vert,fragmentShader:Xi.meshphysical_frag},toon:{uniforms:el([Vt.common,Vt.aomap,Vt.lightmap,Vt.emissivemap,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.gradientmap,Vt.fog,Vt.lights,{emissive:{value:new bi(0)}}]),vertexShader:Xi.meshtoon_vert,fragmentShader:Xi.meshtoon_frag},matcap:{uniforms:el([Vt.common,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.fog,{matcap:{value:null}}]),vertexShader:Xi.meshmatcap_vert,fragmentShader:Xi.meshmatcap_frag},points:{uniforms:el([Vt.points,Vt.fog]),vertexShader:Xi.points_vert,fragmentShader:Xi.points_frag},dashed:{uniforms:el([Vt.common,Vt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Xi.linedashed_vert,fragmentShader:Xi.linedashed_frag},depth:{uniforms:el([Vt.common,Vt.displacementmap]),vertexShader:Xi.depth_vert,fragmentShader:Xi.depth_frag},normal:{uniforms:el([Vt.common,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,{opacity:{value:1}}]),vertexShader:Xi.meshnormal_vert,fragmentShader:Xi.meshnormal_frag},sprite:{uniforms:el([Vt.sprite,Vt.fog]),vertexShader:Xi.sprite_vert,fragmentShader:Xi.sprite_frag},background:{uniforms:{uvTransform:{value:new Hs},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Xi.background_vert,fragmentShader:Xi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Xi.backgroundCube_vert,fragmentShader:Xi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Xi.cube_vert,fragmentShader:Xi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Xi.equirect_vert,fragmentShader:Xi.equirect_frag},distanceRGBA:{uniforms:el([Vt.common,Vt.displacementmap,{referencePosition:{value:new W},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Xi.distanceRGBA_vert,fragmentShader:Xi.distanceRGBA_frag},shadow:{uniforms:el([Vt.lights,Vt.fog,{color:{value:new bi(0)},opacity:{value:1}}]),vertexShader:Xi.shadow_vert,fragmentShader:Xi.shadow_frag}};Td.physical={uniforms:el([Td.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Oe(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new bi(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Oe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new bi(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new bi(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Xi.meshphysical_vert,fragmentShader:Xi.meshphysical_frag};var UA={r:0,b:0,g:0};function vce(t,e,i,r,n,s,a){let o=new bi(0),l=s===!0?0:1,c,u,h=null,d=0,p=null;function g(v,b){let w=!1,M=b.isScene===!0?b.background:null;M&&M.isTexture&&(M=(b.backgroundBlurriness>0?i:e).get(M));let E=t.xr,D=E.getSession&&E.getSession();D&&D.environmentBlendMode==="additive"&&(M=null),M===null?x(o,l):M&&M.isColor&&(x(M,1),w=!0),(t.autoClear||w)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),M&&(M.isCubeTexture||M.mapping===yM)?(u===void 0&&(u=new bn(new yh(1,1,1),new xr({name:"BackgroundCubeMaterial",uniforms:R1(Td.backgroundCube.uniforms),vertexShader:Td.backgroundCube.vertexShader,fragmentShader:Td.backgroundCube.fragmentShader,side:La,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(T,L,P){this.matrixWorld.copyPosition(P.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(u)),u.material.uniforms.envMap.value=M,u.material.uniforms.flipEnvMap.value=M.isCubeTexture&&M.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=b.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=b.backgroundIntensity,u.material.toneMapped=M.encoding!==ji,(h!==M||d!==M.version||p!==t.toneMapping)&&(u.material.needsUpdate=!0,h=M,d=M.version,p=t.toneMapping),u.layers.enableAll(),v.unshift(u,u.geometry,u.material,0,0,null)):M&&M.isTexture&&(c===void 0&&(c=new bn(new jd(2,2),new xr({name:"BackgroundMaterial",uniforms:R1(Td.background.uniforms),vertexShader:Td.background.vertexShader,fragmentShader:Td.background.fragmentShader,side:gh,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=M,c.material.uniforms.backgroundIntensity.value=b.backgroundIntensity,c.material.toneMapped=M.encoding!==ji,M.matrixAutoUpdate===!0&&M.updateMatrix(),c.material.uniforms.uvTransform.value.copy(M.matrix),(h!==M||d!==M.version||p!==t.toneMapping)&&(c.material.needsUpdate=!0,h=M,d=M.version,p=t.toneMapping),c.layers.enableAll(),v.unshift(c,c.geometry,c.material,0,0,null))}function x(v,b){v.getRGB(UA,pq(t)),r.buffers.color.setClear(UA.r,UA.g,UA.b,b,a)}return{getClearColor:function(){return o},setClearColor:function(v,b=1){o.set(v),l=b,x(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(v){l=v,x(o,l)},render:g}}function yce(t,e,i,r){let n=t.getParameter(34921),s=r.isWebGL2?null:e.get("OES_vertex_array_object"),a=r.isWebGL2||s!==null,o={},l=v(null),c=l,u=!1;function h(k,K,X,$,Y){let re=!1;if(a){let G=x($,X,K);c!==G&&(c=G,p(c.object)),re=b(k,$,X,Y),re&&w(k,$,X,Y)}else{let G=K.wireframe===!0;(c.geometry!==$.id||c.program!==X.id||c.wireframe!==G)&&(c.geometry=$.id,c.program=X.id,c.wireframe=G,re=!0)}Y!==null&&i.update(Y,34963),(re||u)&&(u=!1,P(k,K,X,$),Y!==null&&t.bindBuffer(34963,i.get(Y).buffer))}function d(){return r.isWebGL2?t.createVertexArray():s.createVertexArrayOES()}function p(k){return r.isWebGL2?t.bindVertexArray(k):s.bindVertexArrayOES(k)}function g(k){return r.isWebGL2?t.deleteVertexArray(k):s.deleteVertexArrayOES(k)}function x(k,K,X){let $=X.wireframe===!0,Y=o[k.id];Y===void 0&&(Y={},o[k.id]=Y);let re=Y[K.id];re===void 0&&(re={},Y[K.id]=re);let G=re[$];return G===void 0&&(G=v(d()),re[$]=G),G}function v(k){let K=[],X=[],$=[];for(let Y=0;Y<n;Y++)K[Y]=0,X[Y]=0,$[Y]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:K,enabledAttributes:X,attributeDivisors:$,object:k,attributes:{},index:null}}function b(k,K,X,$){let Y=c.attributes,re=K.attributes,G=0,j=X.getAttributes();for(let ee in j)if(j[ee].location>=0){let oe=Y[ee],Q=re[ee];if(Q===void 0&&(ee==="instanceMatrix"&&k.instanceMatrix&&(Q=k.instanceMatrix),ee==="instanceColor"&&k.instanceColor&&(Q=k.instanceColor)),oe===void 0||oe.attribute!==Q||Q&&oe.data!==Q.data)return!0;G++}return c.attributesNum!==G||c.index!==$}function w(k,K,X,$){let Y={},re=K.attributes,G=0,j=X.getAttributes();for(let ee in j)if(j[ee].location>=0){let oe=re[ee];oe===void 0&&(ee==="instanceMatrix"&&k.instanceMatrix&&(oe=k.instanceMatrix),ee==="instanceColor"&&k.instanceColor&&(oe=k.instanceColor));let Q={};Q.attribute=oe,oe&&oe.data&&(Q.data=oe.data),Y[ee]=Q,G++}c.attributes=Y,c.attributesNum=G,c.index=$}function M(){let k=c.newAttributes;for(let K=0,X=k.length;K<X;K++)k[K]=0}function E(k){D(k,0)}function D(k,K){let X=c.newAttributes,$=c.enabledAttributes,Y=c.attributeDivisors;X[k]=1,$[k]===0&&(t.enableVertexAttribArray(k),$[k]=1),Y[k]!==K&&((r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](k,K),Y[k]=K)}function T(){let k=c.newAttributes,K=c.enabledAttributes;for(let X=0,$=K.length;X<$;X++)K[X]!==k[X]&&(t.disableVertexAttribArray(X),K[X]=0)}function L(k,K,X,$,Y,re){r.isWebGL2===!0&&(X===5124||X===5125)?t.vertexAttribIPointer(k,K,X,Y,re):t.vertexAttribPointer(k,K,X,$,Y,re)}function P(k,K,X,$){if(r.isWebGL2===!1&&(k.isInstancedMesh||$.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;M();let Y=$.attributes,re=X.getAttributes(),G=K.defaultAttributeValues;for(let j in re){let ee=re[j];if(ee.location>=0){let oe=Y[j];if(oe===void 0&&(j==="instanceMatrix"&&k.instanceMatrix&&(oe=k.instanceMatrix),j==="instanceColor"&&k.instanceColor&&(oe=k.instanceColor)),oe!==void 0){let Q=oe.normalized,ae=oe.itemSize,ne=i.get(oe);if(ne===void 0)continue;let ue=ne.buffer,fe=ne.type,xe=ne.bytesPerElement;if(oe.isInterleavedBufferAttribute){let be=oe.data,Ce=be.stride,ge=oe.offset;if(be.isInstancedInterleavedBuffer){for(let Te=0;Te<ee.locationSize;Te++)D(ee.location+Te,be.meshPerAttribute);k.isInstancedMesh!==!0&&$._maxInstanceCount===void 0&&($._maxInstanceCount=be.meshPerAttribute*be.count)}else for(let Te=0;Te<ee.locationSize;Te++)E(ee.location+Te);t.bindBuffer(34962,ue);for(let Te=0;Te<ee.locationSize;Te++)L(ee.location+Te,ae/ee.locationSize,fe,Q,Ce*xe,(ge+ae/ee.locationSize*Te)*xe)}else{if(oe.isInstancedBufferAttribute){for(let be=0;be<ee.locationSize;be++)D(ee.location+be,oe.meshPerAttribute);k.isInstancedMesh!==!0&&$._maxInstanceCount===void 0&&($._maxInstanceCount=oe.meshPerAttribute*oe.count)}else for(let be=0;be<ee.locationSize;be++)E(ee.location+be);t.bindBuffer(34962,ue);for(let be=0;be<ee.locationSize;be++)L(ee.location+be,ae/ee.locationSize,fe,Q,ae*xe,ae/ee.locationSize*be*xe)}}else if(G!==void 0){let Q=G[j];if(Q!==void 0)switch(Q.length){case 2:t.vertexAttrib2fv(ee.location,Q);break;case 3:t.vertexAttrib3fv(ee.location,Q);break;case 4:t.vertexAttrib4fv(ee.location,Q);break;default:t.vertexAttrib1fv(ee.location,Q)}}}}T()}function R(){F();for(let k in o){let K=o[k];for(let X in K){let $=K[X];for(let Y in $)g($[Y].object),delete $[Y];delete K[X]}delete o[k]}}function O(k){if(o[k.id]===void 0)return;let K=o[k.id];for(let X in K){let $=K[X];for(let Y in $)g($[Y].object),delete $[Y];delete K[X]}delete o[k.id]}function U(k){for(let K in o){let X=o[K];if(X[k.id]===void 0)continue;let $=X[k.id];for(let Y in $)g($[Y].object),delete $[Y];delete X[k.id]}}function F(){V(),u=!0,c!==l&&(c=l,p(c.object))}function V(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:F,resetDefaultState:V,dispose:R,releaseStatesOfGeometry:O,releaseStatesOfProgram:U,initAttributes:M,enableAttribute:E,disableUnusedAttributes:T}}function xce(t,e,i,r){let n=r.isWebGL2,s;function a(c){s=c}function o(c,u){t.drawArrays(s,c,u),i.update(u,s,1)}function l(c,u,h){if(h===0)return;let d,p;if(n)d=t,p="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[p](s,c,u,h),i.update(u,s,h)}this.setMode=a,this.render=o,this.renderInstances=l}function bce(t,e,i){let r;function n(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){let L=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(L.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(L){if(L==="highp"){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";L="mediump"}return L==="mediump"&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let a=typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext,o=i.precision!==void 0?i.precision:"highp",l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let c=a||e.has("WEBGL_draw_buffers"),u=i.logarithmicDepthBuffer===!0,h=t.getParameter(34930),d=t.getParameter(35660),p=t.getParameter(3379),g=t.getParameter(34076),x=t.getParameter(34921),v=t.getParameter(36347),b=t.getParameter(36348),w=t.getParameter(36349),M=d>0,E=a||e.has("OES_texture_float"),D=M&&E,T=a?t.getParameter(36183):0;return{isWebGL2:a,drawBuffers:c,getMaxAnisotropy:n,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:g,maxAttributes:x,maxVertexUniforms:v,maxVaryings:b,maxFragmentUniforms:w,vertexTextures:M,floatFragmentTextures:E,floatVertexTextures:D,maxSamples:T}}function _ce(t){let e=this,i=null,r=0,n=!1,s=!1,a=new Bl,o=new Hs,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){let p=h.length!==0||d||r!==0||n;return n=d,r=h.length,p},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){i=u(h,d,0)},this.setState=function(h,d,p){let g=h.clippingPlanes,x=h.clipIntersection,v=h.clipShadows,b=t.get(h);if(!n||g===null||g.length===0||s&&!v)s?u(null):c();else{let w=s?0:r,M=w*4,E=b.clippingState||null;l.value=E,E=u(g,d,M,p);for(let D=0;D!==M;++D)E[D]=i[D];b.clippingState=E,this.numIntersection=x?this.numPlanes:0,this.numPlanes+=w}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(h,d,p,g){let x=h!==null?h.length:0,v=null;if(x!==0){if(v=l.value,g!==!0||v===null){let b=p+x*4,w=d.matrixWorldInverse;o.getNormalMatrix(w),(v===null||v.length<b)&&(v=new Float32Array(b));for(let M=0,E=p;M!==x;++M,E+=4)a.copy(h[M]).applyMatrix4(w,o),a.normal.toArray(v,E),v[E+3]=a.constant}l.value=v,l.needsUpdate=!0}return e.numPlanes=x,e.numIntersection=0,v}}function Sce(t){let e=new WeakMap;function i(a,o){return o===Ez?a.mapping=R0:o===Az&&(a.mapping=O0),a}function r(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){let o=a.mapping;if(o===Ez||o===Az)if(e.has(a)){let l=e.get(a).texture;return i(l,a.mapping)}else{let l=a.image;if(l&&l.height>0){let c=new zae(l.height/2);return c.fromEquirectangularTexture(t,a),e.set(a,c),a.addEventListener("dispose",n),i(c.texture,a.mapping)}else return null}}return a}function n(a){let o=a.target;o.removeEventListener("dispose",n);let l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function s(){e=new WeakMap}return{get:r,dispose:s}}var R3=class extends Pg{constructor(t=-1,e=1,i=1,r=-1,n=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=r,this.near=n,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,i,r,n,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-t,s=i+t,a=r+e,o=r-e;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=l*this.view.offsetX,s=n+l*this.view.width,a-=c*this.view.offsetY,o=a-c*this.view.height}this.projectionMatrix.makeOrthographic(n,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}},t1=4,Jk=[.125,.215,.35,.446,.526,.582],Jv=20,gO=new R3,$k=new bi,vO=null,Wv=(1+Math.sqrt(5))/2,sx=1/Wv,eV=[new W(1,1,1),new W(-1,1,1),new W(1,1,-1),new W(-1,1,-1),new W(0,Wv,sx),new W(0,Wv,-sx),new W(sx,0,Wv),new W(-sx,0,Wv),new W(Wv,sx,0),new W(-Wv,sx,0)],tV=class{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,r=100){vO=this._renderer.getRenderTarget(),this._setSize(256);let n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(t,i,r,n),e>0&&this._blur(n,0,0,e),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=nV(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=rV(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(vO),t.scissorTest=!1,BA(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===R0||t.mapping===O0?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),vO=this._renderer.getRenderTarget();let i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:Ki,minFilter:Ki,generateMipmaps:!1,type:Ap,format:kn,encoding:vh,depthBuffer:!1},r=iV(t,e,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=iV(t,e,i);let{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=wce(n)),this._blurMaterial=Mce(n,t,e)}return r}_compileMaterial(t){let e=new bn(this._lodPlanes[0],t);this._renderer.compile(e,gO)}_sceneToCubeUV(t,e,i,r){let n=new Do(90,1,e,i),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor($k),o.toneMapping=zd,o.autoClear=!1;let u=new Tp({name:"PMREM.Background",side:La,depthWrite:!1,depthTest:!1}),h=new bn(new yh,u),d=!1,p=t.background;p?p.isColor&&(u.color.copy(p),t.background=null,d=!0):(u.color.copy($k),d=!0);for(let g=0;g<6;g++){let x=g%3;x===0?(n.up.set(0,s[g],0),n.lookAt(a[g],0,0)):x===1?(n.up.set(0,0,s[g]),n.lookAt(0,a[g],0)):(n.up.set(0,s[g],0),n.lookAt(0,0,a[g]));let v=this._cubeSize;BA(r,x*v,g>2?v:0,v,v),o.setRenderTarget(r),d&&o.render(h,n),o.render(t,n)}h.geometry.dispose(),h.material.dispose(),o.toneMapping=c,o.autoClear=l,t.background=p}_textureToCubeUV(t,e){let i=this._renderer,r=t.mapping===R0||t.mapping===O0;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=nV()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=rV());let n=r?this._cubemapMaterial:this._equirectMaterial,s=new bn(this._lodPlanes[0],n),a=n.uniforms;a.envMap.value=t;let o=this._cubeSize;BA(e,0,0,3*o,2*o),i.setRenderTarget(e),i.render(s,gO)}_applyPMREM(t){let e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){let n=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),s=eV[(r-1)%eV.length];this._blur(t,r-1,r,n,s)}e.autoClear=i}_blur(t,e,i,r,n){let s=this._pingPongRenderTarget;this._halfBlur(t,s,e,i,r,"latitudinal",n),this._halfBlur(s,t,i,i,r,"longitudinal",n)}_halfBlur(t,e,i,r,n,s,a){let o=this._renderer,l=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let c=3,u=new bn(this._lodPlanes[r],l),h=l.uniforms,d=this._sizeLods[i]-1,p=isFinite(n)?Math.PI/(2*d):2*Math.PI/(2*Jv-1),g=n/p,x=isFinite(n)?1+Math.floor(c*g):Jv;x>Jv&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${x} samples when the maximum is set to ${Jv}`);let v=[],b=0;for(let T=0;T<Jv;++T){let L=T/g,P=Math.exp(-L*L/2);v.push(P),T===0?b+=P:T<x&&(b+=2*P)}for(let T=0;T<v.length;T++)v[T]=v[T]/b;h.envMap.value=t.texture,h.samples.value=x,h.weights.value=v,h.latitudinal.value=s==="latitudinal",a&&(h.poleAxis.value=a);let{_lodMax:w}=this;h.dTheta.value=p,h.mipInt.value=w-i;let M=this._sizeLods[r],E=3*M*(r>w-t1?r-w+t1:0),D=4*(this._cubeSize-M);BA(e,E,D,3*M,2*M),o.setRenderTarget(e),o.render(u,gO)}};function wce(t){let e=[],i=[],r=[],n=t,s=t-t1+1+Jk.length;for(let a=0;a<s;a++){let o=Math.pow(2,n);i.push(o);let l=1/o;a>t-t1?l=Jk[a-t+t1-1]:a===0&&(l=0),r.push(l);let c=1/(o-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],p=6,g=6,x=3,v=2,b=1,w=new Float32Array(x*g*p),M=new Float32Array(v*g*p),E=new Float32Array(b*g*p);for(let T=0;T<p;T++){let L=T%3*2/3-1,P=T>2?0:-1,R=[L,P,0,L+2/3,P,0,L+2/3,P+1,0,L,P,0,L+2/3,P+1,0,L,P+1,0];w.set(R,x*g*T),M.set(d,v*g*T);let O=[T,T,T,T,T,T];E.set(O,b*g*T)}let D=new ni;D.setAttribute("position",new _i(w,x)),D.setAttribute("uv",new _i(M,v)),D.setAttribute("faceIndex",new _i(E,b)),e.push(D),n>t1&&n--}return{lodPlanes:e,sizeLods:i,sigmas:r}}function iV(t,e,i){let r=new yr(t,e,i);return r.texture.mapping=yM,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function BA(t,e,i,r,n){t.viewport.set(e,i,r,n),t.scissor.set(e,i,r,n)}function Mce(t,e,i){let r=new Float32Array(Jv),n=new W(0,1,0);return new xr({name:"SphericalGaussianBlur",defines:{n:Jv,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:_N(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:js,depthTest:!1,depthWrite:!1})}function rV(){return new xr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:_N(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:js,depthTest:!1,depthWrite:!1})}function nV(){return new xr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:_N(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:js,depthTest:!1,depthWrite:!1})}function _N(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Ece(t){let e=new WeakMap,i=null;function r(o){if(o&&o.isTexture){let l=o.mapping,c=l===Ez||l===Az,u=l===R0||l===O0;if(c||u)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let h=e.get(o);return i===null&&(i=new tV(t)),h=c?i.fromEquirectangular(o,h):i.fromCubemap(o,h),e.set(o,h),h.texture}else{if(e.has(o))return e.get(o).texture;{let h=o.image;if(c&&h&&h.height>0||u&&h&&n(h)){i===null&&(i=new tV(t));let d=c?i.fromEquirectangular(o):i.fromCubemap(o);return e.set(o,d),o.addEventListener("dispose",s),d.texture}else return null}}}return o}function n(o){let l=0,c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function s(o){let l=o.target;l.removeEventListener("dispose",s);let c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function a(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function Ace(t){let e={};function i(r){if(e[r]!==void 0)return e[r];let n;switch(r){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(r)}return e[r]=n,n}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){let n=i(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function Tce(t,e,i,r){let n={},s=new WeakMap;function a(h){let d=h.target;d.index!==null&&e.remove(d.index);for(let g in d.attributes)e.remove(d.attributes[g]);d.removeEventListener("dispose",a),delete n[d.id];let p=s.get(d);p&&(e.remove(p),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(h,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function l(h){let d=h.attributes;for(let g in d)e.update(d[g],34962);let p=h.morphAttributes;for(let g in p){let x=p[g];for(let v=0,b=x.length;v<b;v++)e.update(x[v],34962)}}function c(h){let d=[],p=h.index,g=h.attributes.position,x=0;if(p!==null){let w=p.array;x=p.version;for(let M=0,E=w.length;M<E;M+=3){let D=w[M+0],T=w[M+1],L=w[M+2];d.push(D,T,T,L,L,D)}}else{let w=g.array;x=g.version;for(let M=0,E=w.length/3-1;M<E;M+=3){let D=M+0,T=M+1,L=M+2;d.push(D,T,T,L,L,D)}}let v=new(oq(d)?f1:fq)(d,1);v.version=x;let b=s.get(h);b&&e.remove(b),s.set(h,v)}function u(h){let d=s.get(h);if(d){let p=h.index;p!==null&&d.version<p.version&&c(h)}else c(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function Cce(t,e,i,r){let n=r.isWebGL2,s;function a(d){s=d}let o,l;function c(d){o=d.type,l=d.bytesPerElement}function u(d,p){t.drawElements(s,p,o,d*l),i.update(p,s,1)}function h(d,p,g){if(g===0)return;let x,v;if(n)x=t,v="drawElementsInstanced";else if(x=e.get("ANGLE_instanced_arrays"),v="drawElementsInstancedANGLE",x===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}x[v](s,p,o,d*l,g),i.update(p,s,g)}this.setMode=a,this.setIndex=c,this.render=u,this.renderInstances=h}function Dce(t){let e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case 4:i.triangles+=o*(s/3);break;case 1:i.lines+=o*(s/2);break;case 3:i.lines+=o*(s-1);break;case 2:i.lines+=o*s;break;case 0:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:n,update:r}}function Pce(t,e){return t[0]-e[0]}function Rce(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Oce(t,e,i){let r={},n=new Float32Array(8),s=new WeakMap,a=new Ri,o=[];for(let c=0;c<8;c++)o[c]=[c,0];function l(c,u,h,d){let p=c.morphTargetInfluences;if(e.isWebGL2===!0){let g=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,x=g!==void 0?g.length:0,v=s.get(u);if(v===void 0||v.count!==x){let M=function(){k.dispose(),s.delete(u),u.removeEventListener("dispose",M)};v!==void 0&&v.texture.dispose();let E=u.morphAttributes.position!==void 0,D=u.morphAttributes.normal!==void 0,T=u.morphAttributes.color!==void 0,L=u.morphAttributes.position||[],P=u.morphAttributes.normal||[],R=u.morphAttributes.color||[],O=0;E===!0&&(O=1),D===!0&&(O=2),T===!0&&(O=3);let U=u.attributes.position.count*O,F=1;U>e.maxTextureSize&&(F=Math.ceil(U/e.maxTextureSize),U=e.maxTextureSize);let V=new Float32Array(U*F*4*x),k=new hq(V,U,F,x);k.type=rn,k.needsUpdate=!0;let K=O*4;for(let X=0;X<x;X++){let $=L[X],Y=P[X],re=R[X],G=U*F*4*X;for(let j=0;j<$.count;j++){let ee=j*K;E===!0&&(a.fromBufferAttribute($,j),V[G+ee+0]=a.x,V[G+ee+1]=a.y,V[G+ee+2]=a.z,V[G+ee+3]=0),D===!0&&(a.fromBufferAttribute(Y,j),V[G+ee+4]=a.x,V[G+ee+5]=a.y,V[G+ee+6]=a.z,V[G+ee+7]=0),T===!0&&(a.fromBufferAttribute(re,j),V[G+ee+8]=a.x,V[G+ee+9]=a.y,V[G+ee+10]=a.z,V[G+ee+11]=re.itemSize===4?a.w:1)}}v={count:x,texture:k,size:new Oe(U,F)},s.set(u,v),u.addEventListener("dispose",M)}let b=0;for(let M=0;M<p.length;M++)b+=p[M];let w=u.morphTargetsRelative?1:1-b;d.getUniforms().setValue(t,"morphTargetBaseInfluence",w),d.getUniforms().setValue(t,"morphTargetInfluences",p),d.getUniforms().setValue(t,"morphTargetsTexture",v.texture,i),d.getUniforms().setValue(t,"morphTargetsTextureSize",v.size)}else{let g=p===void 0?0:p.length,x=r[u.id];if(x===void 0||x.length!==g){x=[];for(let E=0;E<g;E++)x[E]=[E,0];r[u.id]=x}for(let E=0;E<g;E++){let D=x[E];D[0]=E,D[1]=p[E]}x.sort(Rce);for(let E=0;E<8;E++)E<g&&x[E][1]?(o[E][0]=x[E][0],o[E][1]=x[E][1]):(o[E][0]=Number.MAX_SAFE_INTEGER,o[E][1]=0);o.sort(Pce);let v=u.morphAttributes.position,b=u.morphAttributes.normal,w=0;for(let E=0;E<8;E++){let D=o[E],T=D[0],L=D[1];T!==Number.MAX_SAFE_INTEGER&&L?(v&&u.getAttribute("morphTarget"+E)!==v[T]&&u.setAttribute("morphTarget"+E,v[T]),b&&u.getAttribute("morphNormal"+E)!==b[T]&&u.setAttribute("morphNormal"+E,b[T]),n[E]=L,w+=L):(v&&u.hasAttribute("morphTarget"+E)===!0&&u.deleteAttribute("morphTarget"+E),b&&u.hasAttribute("morphNormal"+E)===!0&&u.deleteAttribute("morphNormal"+E),n[E]=0)}let M=u.morphTargetsRelative?1:1-w;d.getUniforms().setValue(t,"morphTargetBaseInfluence",M),d.getUniforms().setValue(t,"morphTargetInfluences",n)}}return{update:l}}function Lce(t,e,i,r){let n=new WeakMap;function s(l){let c=r.render.frame,u=l.geometry,h=e.get(l,u);return n.get(h)!==c&&(e.update(h),n.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.update(l.instanceMatrix,34962),l.instanceColor!==null&&i.update(l.instanceColor,34962)),h}function a(){n=new WeakMap}function o(l){let c=l.target;c.removeEventListener("dispose",o),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:a}}var gq=new ns,vq=new hq,yq=new bae,xq=new xN,sV=[],aV=[],oV=new Float32Array(16),lV=new Float32Array(9),cV=new Float32Array(4);function cb(t,e,i){let r=t[0];if(r==null||r<=0||r>0)return t;let n=e*i,s=sV[n];if(s===void 0&&(s=new Float32Array(n),sV[n]=s),e!==0){r.toArray(s,0);for(let a=1,o=0;a!==e;++a)o+=i,t[a].toArray(s,o)}return s}function aa(t,e){if(t.length!==e.length)return!1;for(let i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}function oa(t,e){for(let i=0,r=e.length;i<r;i++)t[i]=e[i]}function O3(t,e){let i=aV[e];i===void 0&&(i=new Int32Array(e),aV[e]=i);for(let r=0;r!==e;++r)i[r]=t.allocateTextureUnit();return i}function Ice(t,e){let i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function zce(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(aa(i,e))return;t.uniform2fv(this.addr,e),oa(i,e)}}function Uce(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(aa(i,e))return;t.uniform3fv(this.addr,e),oa(i,e)}}function Bce(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(aa(i,e))return;t.uniform4fv(this.addr,e),oa(i,e)}}function Nce(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(aa(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),oa(i,e)}else{if(aa(i,r))return;cV.set(r),t.uniformMatrix2fv(this.addr,!1,cV),oa(i,r)}}function Fce(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(aa(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),oa(i,e)}else{if(aa(i,r))return;lV.set(r),t.uniformMatrix3fv(this.addr,!1,lV),oa(i,r)}}function kce(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(aa(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),oa(i,e)}else{if(aa(i,r))return;oV.set(r),t.uniformMatrix4fv(this.addr,!1,oV),oa(i,r)}}function Vce(t,e){let i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function Hce(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(aa(i,e))return;t.uniform2iv(this.addr,e),oa(i,e)}}function Gce(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(aa(i,e))return;t.uniform3iv(this.addr,e),oa(i,e)}}function jce(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(aa(i,e))return;t.uniform4iv(this.addr,e),oa(i,e)}}function Wce(t,e){let i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function qce(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(aa(i,e))return;t.uniform2uiv(this.addr,e),oa(i,e)}}function Xce(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(aa(i,e))return;t.uniform3uiv(this.addr,e),oa(i,e)}}function Yce(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(aa(i,e))return;t.uniform4uiv(this.addr,e),oa(i,e)}}function Qce(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(e||gq,n)}function Zce(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(e||yq,n)}function Kce(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(e||xq,n)}function Jce(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(e||vq,n)}function $ce(t){switch(t){case 5126:return Ice;case 35664:return zce;case 35665:return Uce;case 35666:return Bce;case 35674:return Nce;case 35675:return Fce;case 35676:return kce;case 5124:case 35670:return Vce;case 35667:case 35671:return Hce;case 35668:case 35672:return Gce;case 35669:case 35673:return jce;case 5125:return Wce;case 36294:return qce;case 36295:return Xce;case 36296:return Yce;case 35678:case 36198:case 36298:case 36306:case 35682:return Qce;case 35679:case 36299:case 36307:return Zce;case 35680:case 36300:case 36308:case 36293:return Kce;case 36289:case 36303:case 36311:case 36292:return Jce}}function eue(t,e){t.uniform1fv(this.addr,e)}function tue(t,e){let i=cb(e,this.size,2);t.uniform2fv(this.addr,i)}function iue(t,e){let i=cb(e,this.size,3);t.uniform3fv(this.addr,i)}function rue(t,e){let i=cb(e,this.size,4);t.uniform4fv(this.addr,i)}function nue(t,e){let i=cb(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function sue(t,e){let i=cb(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function aue(t,e){let i=cb(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function oue(t,e){t.uniform1iv(this.addr,e)}function lue(t,e){t.uniform2iv(this.addr,e)}function cue(t,e){t.uniform3iv(this.addr,e)}function uue(t,e){t.uniform4iv(this.addr,e)}function hue(t,e){t.uniform1uiv(this.addr,e)}function due(t,e){t.uniform2uiv(this.addr,e)}function fue(t,e){t.uniform3uiv(this.addr,e)}function pue(t,e){t.uniform4uiv(this.addr,e)}function mue(t,e,i){let r=this.cache,n=e.length,s=O3(i,n);aa(r,s)||(t.uniform1iv(this.addr,s),oa(r,s));for(let a=0;a!==n;++a)i.setTexture2D(e[a]||gq,s[a])}function gue(t,e,i){let r=this.cache,n=e.length,s=O3(i,n);aa(r,s)||(t.uniform1iv(this.addr,s),oa(r,s));for(let a=0;a!==n;++a)i.setTexture3D(e[a]||yq,s[a])}function vue(t,e,i){let r=this.cache,n=e.length,s=O3(i,n);aa(r,s)||(t.uniform1iv(this.addr,s),oa(r,s));for(let a=0;a!==n;++a)i.setTextureCube(e[a]||xq,s[a])}function yue(t,e,i){let r=this.cache,n=e.length,s=O3(i,n);aa(r,s)||(t.uniform1iv(this.addr,s),oa(r,s));for(let a=0;a!==n;++a)i.setTexture2DArray(e[a]||vq,s[a])}function xue(t){switch(t){case 5126:return eue;case 35664:return tue;case 35665:return iue;case 35666:return rue;case 35674:return nue;case 35675:return sue;case 35676:return aue;case 5124:case 35670:return oue;case 35667:case 35671:return lue;case 35668:case 35672:return cue;case 35669:case 35673:return uue;case 5125:return hue;case 36294:return due;case 36295:return fue;case 36296:return pue;case 35678:case 36198:case 36298:case 36306:case 35682:return mue;case 35679:case 36299:case 36307:return gue;case 35680:case 36300:case 36308:case 36293:return vue;case 36289:case 36303:case 36311:case 36292:return yue}}var bue=class{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=$ce(e.type)}},_ue=class{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=xue(e.type)}},Sue=class{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,i){if(e===void 0)return;let r=this.seq;for(let n=0,s=r.length;n!==s;++n){let a=r[n];a.setValue(t,e[a.id],i)}}},yO=/(\w+)(\])?(\[|\.)?/g;function uV(t,e){t.seq.push(e),t.map[e.id]=e}function wue(t,e,i){let r=t.name,n=r.length;for(yO.lastIndex=0;;){let s=yO.exec(r),a=yO.lastIndex,o=s[1],l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===n){uV(i,c===void 0?new bue(o,t,e):new _ue(o,t,e));break}else{let u=i.map[o];u===void 0&&(u=new Sue(o),uV(i,u)),i=u}}}var XT=class{constructor(t,e){this.seq=[],this.map={};let i=t.getProgramParameter(e,35718);for(let r=0;r<i;++r){let n=t.getActiveUniform(e,r),s=t.getUniformLocation(e,n.name);wue(n,s,this)}}setValue(t,e,i,r){let n=this.map[e];n!==void 0&&n.setValue(t,i,r)}setOptional(t,e,i){let r=e[i];r!==void 0&&this.setValue(t,i,r)}static upload(t,e,i,r){for(let n=0,s=e.length;n!==s;++n){let a=e[n],o=i[a.id];o.needsUpdate!==!1&&a.setValue(t,o.value,r)}}static seqWithValue(t,e){let i=[];for(let r=0,n=t.length;r!==n;++r){let s=t[r];s.id in e&&i.push(s)}return i}};function hV(t,e,i){let r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}var Mue=0;function Eue(t,e){let i=t.split(`
`),r=[],n=Math.max(e-6,0),s=Math.min(e+6,i.length);for(let a=n;a<s;a++){let o=a+1;r.push(`${o===e?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}function Aue(t){switch(t){case vh:return["Linear","( value )"];case ji:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function dV(t,e,i){let r=t.getShaderParameter(e,35713),n=t.getShaderInfoLog(e).trim();if(r&&n==="")return"";let s=/ERROR: 0:(\d+)/.exec(n);if(s){let a=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+Eue(t.getShaderSource(e),a)}else return n}function Tue(t,e){let i=Aue(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Cue(t,e){let i;switch(e){case zse:i="Linear";break;case Use:i="Reinhard";break;case Bse:i="OptimizedCineon";break;case Nse:i="ACESFilmic";break;case Fse:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Due(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||t.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(OS).join(`
`)}function Pue(t){let e=[];for(let i in t){let r=t[i];r!==!1&&e.push("#define "+i+" "+r)}return e.join(`
`)}function Rue(t,e){let i={},r=t.getProgramParameter(e,35721);for(let n=0;n<r;n++){let s=t.getActiveAttrib(e,n),a=s.name,o=1;s.type===35674&&(o=2),s.type===35675&&(o=3),s.type===35676&&(o=4),i[a]={type:s.type,location:t.getAttribLocation(e,a),locationSize:o}}return i}function OS(t){return t!==""}function fV(t,e){let i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function pV(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var Oue=/^[ \t]*#include +<([\w\d./]+)>/gm;function Oz(t){return t.replace(Oue,Lue)}function Lue(t,e){let i=Xi[e];if(i===void 0)throw new Error("Can not resolve #include <"+e+">");return Oz(i)}var Iue=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function mV(t){return t.replace(Iue,zue)}function zue(t,e,i,r){let n="";for(let s=parseInt(e);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function gV(t){let e="precision "+t.precision+` float;
precision `+t.precision+" int;";return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Uue(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===pN?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===fse?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===RS&&(e="SHADOWMAP_TYPE_VSM"),e}function Bue(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case R0:case O0:e="ENVMAP_TYPE_CUBE";break;case yM:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Nue(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case O0:e="ENVMAP_MODE_REFRACTION";break}return e}function Fue(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case $7:e="ENVMAP_BLENDING_MULTIPLY";break;case Lse:e="ENVMAP_BLENDING_MIX";break;case Ise:e="ENVMAP_BLENDING_ADD";break}return e}function kue(t){let e=t.envMapCubeUVHeight;if(e===null)return null;let i=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function Vue(t,e,i,r){let n=t.getContext(),s=i.defines,a=i.vertexShader,o=i.fragmentShader,l=Uue(i),c=Bue(i),u=Nue(i),h=Fue(i),d=kue(i),p=i.isWebGL2?"":Due(i),g=Pue(s),x=n.createProgram(),v,b,w=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(v=[g].filter(OS).join(`
`),v.length>0&&(v+=`
`),b=[p,g].filter(OS).join(`
`),b.length>0&&(b+=`
`)):(v=[gV(i),"#define SHADER_NAME "+i.shaderName,g,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(OS).join(`
`),b=[p,gV(i),"#define SHADER_NAME "+i.shaderName,g,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==zd?"#define TONE_MAPPING":"",i.toneMapping!==zd?Xi.tonemapping_pars_fragment:"",i.toneMapping!==zd?Cue("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Xi.encodings_pars_fragment,Tue("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(OS).join(`
`)),a=Oz(a),a=fV(a,i),a=pV(a,i),o=Oz(o),o=fV(o,i),o=pV(o,i),a=mV(a),o=mV(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(w=`#version 300 es
`,v=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,b=["#define varying in",i.glslVersion===Dz?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===Dz?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+b);let M=w+v+a,E=w+b+o,D=hV(n,35633,M),T=hV(n,35632,E);if(n.attachShader(x,D),n.attachShader(x,T),i.index0AttributeName!==void 0?n.bindAttribLocation(x,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(x,0,"position"),n.linkProgram(x),t.debug.checkShaderErrors){let R=n.getProgramInfoLog(x).trim(),O=n.getShaderInfoLog(D).trim(),U=n.getShaderInfoLog(T).trim(),F=!0,V=!0;if(n.getProgramParameter(x,35714)===!1){F=!1;let k=dV(n,D,"vertex"),K=dV(n,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(x,35715)+`

Program Info Log: `+R+`
`+k+`
`+K)}else R!==""?console.warn("THREE.WebGLProgram: Program Info Log:",R):(O===""||U==="")&&(V=!1);V&&(this.diagnostics={runnable:F,programLog:R,vertexShader:{log:O,prefix:v},fragmentShader:{log:U,prefix:b}})}n.deleteShader(D),n.deleteShader(T);let L;this.getUniforms=function(){return L===void 0&&(L=new XT(n,x)),L};let P;return this.getAttributes=function(){return P===void 0&&(P=Rue(n,x)),P},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(x),this.program=void 0},this.name=i.shaderName,this.id=Mue++,this.cacheKey=e,this.usedTimes=1,this.program=x,this.vertexShader=D,this.fragmentShader=T,this}var Hue=0,Gue=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){let e=t.vertexShader,i=t.fragmentShader,r=this._getShaderStage(e),n=this._getShaderStage(i),s=this._getShaderCacheForMaterial(t);return s.has(r)===!1&&(s.add(r),r.usedTimes++),s.has(n)===!1&&(s.add(n),n.usedTimes++),this}remove(t){let e=this.materialCache.get(t);for(let i of e)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){let e=this.materialCache,i=e.get(t);return i===void 0&&(i=new Set,e.set(t,i)),i}_getShaderStage(t){let e=this.shaderCache,i=e.get(t);return i===void 0&&(i=new jue(t),e.set(t,i)),i}},jue=class{constructor(t){this.id=Hue++,this.code=t,this.usedTimes=0}};function Wue(t,e,i,r,n,s,a){let o=new yN,l=new Gue,c=[],u=n.isWebGL2,h=n.logarithmicDepthBuffer,d=n.vertexTextures,p=n.precision,g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function x(P,R,O,U,F){let V=U.fog,k=F.geometry,K=P.isMeshStandardMaterial?U.environment:null,X=(P.isMeshStandardMaterial?i:e).get(P.envMap||K),$=X&&X.mapping===yM?X.image.height:null,Y=g[P.type];P.precision!==null&&(p=n.getMaxPrecision(P.precision),p!==P.precision&&console.warn("THREE.WebGLProgram.getParameters:",P.precision,"not supported, using",p,"instead."));let re=k.morphAttributes.position||k.morphAttributes.normal||k.morphAttributes.color,G=re!==void 0?re.length:0,j=0;k.morphAttributes.position!==void 0&&(j=1),k.morphAttributes.normal!==void 0&&(j=2),k.morphAttributes.color!==void 0&&(j=3);let ee,oe,Q,ae;if(Y){let be=Td[Y];ee=be.vertexShader,oe=be.fragmentShader}else ee=P.vertexShader,oe=P.fragmentShader,l.update(P),Q=l.getVertexShaderID(P),ae=l.getFragmentShaderID(P);let ne=t.getRenderTarget(),ue=P.alphaTest>0,fe=P.clearcoat>0,xe=P.iridescence>0;return{isWebGL2:u,shaderID:Y,shaderName:P.type,vertexShader:ee,fragmentShader:oe,defines:P.defines,customVertexShaderID:Q,customFragmentShaderID:ae,isRawShaderMaterial:P.isRawShaderMaterial===!0,glslVersion:P.glslVersion,precision:p,instancing:F.isInstancedMesh===!0,instancingColor:F.isInstancedMesh===!0&&F.instanceColor!==null,supportsVertexTextures:d,outputEncoding:ne===null?t.outputEncoding:ne.isXRRenderTarget===!0?ne.texture.encoding:vh,map:!!P.map,matcap:!!P.matcap,envMap:!!X,envMapMode:X&&X.mapping,envMapCubeUVHeight:$,lightMap:!!P.lightMap,aoMap:!!P.aoMap,emissiveMap:!!P.emissiveMap,bumpMap:!!P.bumpMap,normalMap:!!P.normalMap,objectSpaceNormalMap:P.normalMapType===tae,tangentSpaceNormalMap:P.normalMapType===eae,decodeVideoTexture:!!P.map&&P.map.isVideoTexture===!0&&P.map.encoding===ji,clearcoat:fe,clearcoatMap:fe&&!!P.clearcoatMap,clearcoatRoughnessMap:fe&&!!P.clearcoatRoughnessMap,clearcoatNormalMap:fe&&!!P.clearcoatNormalMap,iridescence:xe,iridescenceMap:xe&&!!P.iridescenceMap,iridescenceThicknessMap:xe&&!!P.iridescenceThicknessMap,displacementMap:!!P.displacementMap,roughnessMap:!!P.roughnessMap,metalnessMap:!!P.metalnessMap,specularMap:!!P.specularMap,specularIntensityMap:!!P.specularIntensityMap,specularColorMap:!!P.specularColorMap,opaque:P.transparent===!1&&P.blending===y0,alphaMap:!!P.alphaMap,alphaTest:ue,gradientMap:!!P.gradientMap,sheen:P.sheen>0,sheenColorMap:!!P.sheenColorMap,sheenRoughnessMap:!!P.sheenRoughnessMap,transmission:P.transmission>0,transmissionMap:!!P.transmissionMap,thicknessMap:!!P.thicknessMap,combine:P.combine,vertexTangents:!!P.normalMap&&!!k.attributes.tangent,vertexColors:P.vertexColors,vertexAlphas:P.vertexColors===!0&&!!k.attributes.color&&k.attributes.color.itemSize===4,vertexUvs:!!P.map||!!P.bumpMap||!!P.normalMap||!!P.specularMap||!!P.alphaMap||!!P.emissiveMap||!!P.roughnessMap||!!P.metalnessMap||!!P.clearcoatMap||!!P.clearcoatRoughnessMap||!!P.clearcoatNormalMap||!!P.iridescenceMap||!!P.iridescenceThicknessMap||!!P.displacementMap||!!P.transmissionMap||!!P.thicknessMap||!!P.specularIntensityMap||!!P.specularColorMap||!!P.sheenColorMap||!!P.sheenRoughnessMap,uvsVertexOnly:!(P.map||P.bumpMap||P.normalMap||P.specularMap||P.alphaMap||P.emissiveMap||P.roughnessMap||P.metalnessMap||P.clearcoatNormalMap||P.iridescenceMap||P.iridescenceThicknessMap||P.transmission>0||P.transmissionMap||P.thicknessMap||P.specularIntensityMap||P.specularColorMap||P.sheen>0||P.sheenColorMap||P.sheenRoughnessMap)&&!!P.displacementMap,fog:!!V,useFog:P.fog===!0,fogExp2:V&&V.isFogExp2,flatShading:!!P.flatShading,sizeAttenuation:P.sizeAttenuation,logarithmicDepthBuffer:h,skinning:F.isSkinnedMesh===!0,morphTargets:k.morphAttributes.position!==void 0,morphNormals:k.morphAttributes.normal!==void 0,morphColors:k.morphAttributes.color!==void 0,morphTargetsCount:G,morphTextureStride:j,numDirLights:R.directional.length,numPointLights:R.point.length,numSpotLights:R.spot.length,numSpotLightMaps:R.spotLightMap.length,numRectAreaLights:R.rectArea.length,numHemiLights:R.hemi.length,numDirLightShadows:R.directionalShadowMap.length,numPointLightShadows:R.pointShadowMap.length,numSpotLightShadows:R.spotShadowMap.length,numSpotLightShadowsWithMaps:R.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:P.dithering,shadowMapEnabled:t.shadowMap.enabled&&O.length>0,shadowMapType:t.shadowMap.type,toneMapping:P.toneMapped?t.toneMapping:zd,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:P.premultipliedAlpha,doubleSided:P.side===Oo,flipSided:P.side===La,useDepthPacking:!!P.depthPacking,depthPacking:P.depthPacking||0,index0AttributeName:P.index0AttributeName,extensionDerivatives:P.extensions&&P.extensions.derivatives,extensionFragDepth:P.extensions&&P.extensions.fragDepth,extensionDrawBuffers:P.extensions&&P.extensions.drawBuffers,extensionShaderTextureLOD:P.extensions&&P.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),customProgramCacheKey:P.customProgramCacheKey()}}function v(P){let R=[];if(P.shaderID?R.push(P.shaderID):(R.push(P.customVertexShaderID),R.push(P.customFragmentShaderID)),P.defines!==void 0)for(let O in P.defines)R.push(O),R.push(P.defines[O]);return P.isRawShaderMaterial===!1&&(b(R,P),w(R,P),R.push(t.outputEncoding)),R.push(P.customProgramCacheKey),R.join()}function b(P,R){P.push(R.precision),P.push(R.outputEncoding),P.push(R.envMapMode),P.push(R.envMapCubeUVHeight),P.push(R.combine),P.push(R.vertexUvs),P.push(R.fogExp2),P.push(R.sizeAttenuation),P.push(R.morphTargetsCount),P.push(R.morphAttributeCount),P.push(R.numDirLights),P.push(R.numPointLights),P.push(R.numSpotLights),P.push(R.numSpotLightMaps),P.push(R.numHemiLights),P.push(R.numRectAreaLights),P.push(R.numDirLightShadows),P.push(R.numPointLightShadows),P.push(R.numSpotLightShadows),P.push(R.numSpotLightShadowsWithMaps),P.push(R.shadowMapType),P.push(R.toneMapping),P.push(R.numClippingPlanes),P.push(R.numClipIntersection),P.push(R.depthPacking)}function w(P,R){o.disableAll(),R.isWebGL2&&o.enable(0),R.supportsVertexTextures&&o.enable(1),R.instancing&&o.enable(2),R.instancingColor&&o.enable(3),R.map&&o.enable(4),R.matcap&&o.enable(5),R.envMap&&o.enable(6),R.lightMap&&o.enable(7),R.aoMap&&o.enable(8),R.emissiveMap&&o.enable(9),R.bumpMap&&o.enable(10),R.normalMap&&o.enable(11),R.objectSpaceNormalMap&&o.enable(12),R.tangentSpaceNormalMap&&o.enable(13),R.clearcoat&&o.enable(14),R.clearcoatMap&&o.enable(15),R.clearcoatRoughnessMap&&o.enable(16),R.clearcoatNormalMap&&o.enable(17),R.iridescence&&o.enable(18),R.iridescenceMap&&o.enable(19),R.iridescenceThicknessMap&&o.enable(20),R.displacementMap&&o.enable(21),R.specularMap&&o.enable(22),R.roughnessMap&&o.enable(23),R.metalnessMap&&o.enable(24),R.gradientMap&&o.enable(25),R.alphaMap&&o.enable(26),R.alphaTest&&o.enable(27),R.vertexColors&&o.enable(28),R.vertexAlphas&&o.enable(29),R.vertexUvs&&o.enable(30),R.vertexTangents&&o.enable(31),R.uvsVertexOnly&&o.enable(32),P.push(o.mask),o.disableAll(),R.fog&&o.enable(0),R.useFog&&o.enable(1),R.flatShading&&o.enable(2),R.logarithmicDepthBuffer&&o.enable(3),R.skinning&&o.enable(4),R.morphTargets&&o.enable(5),R.morphNormals&&o.enable(6),R.morphColors&&o.enable(7),R.premultipliedAlpha&&o.enable(8),R.shadowMapEnabled&&o.enable(9),R.physicallyCorrectLights&&o.enable(10),R.doubleSided&&o.enable(11),R.flipSided&&o.enable(12),R.useDepthPacking&&o.enable(13),R.dithering&&o.enable(14),R.specularIntensityMap&&o.enable(15),R.specularColorMap&&o.enable(16),R.transmission&&o.enable(17),R.transmissionMap&&o.enable(18),R.thicknessMap&&o.enable(19),R.sheen&&o.enable(20),R.sheenColorMap&&o.enable(21),R.sheenRoughnessMap&&o.enable(22),R.decodeVideoTexture&&o.enable(23),R.opaque&&o.enable(24),P.push(o.mask)}function M(P){let R=g[P.type],O;if(R){let U=Td[R];O=lb.clone(U.uniforms)}else O=P.uniforms;return O}function E(P,R){let O;for(let U=0,F=c.length;U<F;U++){let V=c[U];if(V.cacheKey===R){O=V,++O.usedTimes;break}}return O===void 0&&(O=new Vue(t,R,P,s),c.push(O)),O}function D(P){if(--P.usedTimes===0){let R=c.indexOf(P);c[R]=c[c.length-1],c.pop(),P.destroy()}}function T(P){l.remove(P)}function L(){l.dispose()}return{getParameters:x,getProgramCacheKey:v,getUniforms:M,acquireProgram:E,releaseProgram:D,releaseShaderCache:T,programs:c,dispose:L}}function que(){let t=new WeakMap;function e(s){let a=t.get(s);return a===void 0&&(a={},t.set(s,a)),a}function i(s){t.delete(s)}function r(s,a,o){t.get(s)[a]=o}function n(){t=new WeakMap}return{get:e,remove:i,update:r,dispose:n}}function Xue(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function vV(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function yV(){let t=[],e=0,i=[],r=[],n=[];function s(){e=0,i.length=0,r.length=0,n.length=0}function a(h,d,p,g,x,v){let b=t[e];return b===void 0?(b={id:h.id,object:h,geometry:d,material:p,groupOrder:g,renderOrder:h.renderOrder,z:x,group:v},t[e]=b):(b.id=h.id,b.object=h,b.geometry=d,b.material=p,b.groupOrder=g,b.renderOrder=h.renderOrder,b.z=x,b.group=v),e++,b}function o(h,d,p,g,x,v){let b=a(h,d,p,g,x,v);p.transmission>0?r.push(b):p.transparent===!0?n.push(b):i.push(b)}function l(h,d,p,g,x,v){let b=a(h,d,p,g,x,v);p.transmission>0?r.unshift(b):p.transparent===!0?n.unshift(b):i.unshift(b)}function c(h,d){i.length>1&&i.sort(h||Xue),r.length>1&&r.sort(d||vV),n.length>1&&n.sort(d||vV)}function u(){for(let h=e,d=t.length;h<d;h++){let p=t[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:u,sort:c}}function Yue(){let t=new WeakMap;function e(r,n){let s=t.get(r),a;return s===void 0?(a=new yV,t.set(r,[a])):n>=s.length?(a=new yV,s.push(a)):a=s[n],a}function i(){t=new WeakMap}return{get:e,dispose:i}}function Que(){let t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new W,color:new bi};break;case"SpotLight":i={position:new W,direction:new W,color:new bi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new W,color:new bi,distance:0,decay:0};break;case"HemisphereLight":i={direction:new W,skyColor:new bi,groundColor:new bi};break;case"RectAreaLight":i={color:new bi,position:new W,halfWidth:new W,halfHeight:new W};break}return t[e.id]=i,i}}}function Zue(){let t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Oe};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Oe};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Oe,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=i,i}}}var Kue=0;function Jue(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function $ue(t,e){let i=new Que,r=Zue(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)n.probe.push(new W);let s=new W,a=new Ot,o=new Ot;function l(u,h){let d=0,p=0,g=0;for(let U=0;U<9;U++)n.probe[U].set(0,0,0);let x=0,v=0,b=0,w=0,M=0,E=0,D=0,T=0,L=0,P=0;u.sort(Jue);let R=h!==!0?Math.PI:1;for(let U=0,F=u.length;U<F;U++){let V=u[U],k=V.color,K=V.intensity,X=V.distance,$=V.shadow&&V.shadow.map?V.shadow.map.texture:null;if(V.isAmbientLight)d+=k.r*K*R,p+=k.g*K*R,g+=k.b*K*R;else if(V.isLightProbe)for(let Y=0;Y<9;Y++)n.probe[Y].addScaledVector(V.sh.coefficients[Y],K);else if(V.isDirectionalLight){let Y=i.get(V);if(Y.color.copy(V.color).multiplyScalar(V.intensity*R),V.castShadow){let re=V.shadow,G=r.get(V);G.shadowBias=re.bias,G.shadowNormalBias=re.normalBias,G.shadowRadius=re.radius,G.shadowMapSize=re.mapSize,n.directionalShadow[x]=G,n.directionalShadowMap[x]=$,n.directionalShadowMatrix[x]=V.shadow.matrix,E++}n.directional[x]=Y,x++}else if(V.isSpotLight){let Y=i.get(V);Y.position.setFromMatrixPosition(V.matrixWorld),Y.color.copy(k).multiplyScalar(K*R),Y.distance=X,Y.coneCos=Math.cos(V.angle),Y.penumbraCos=Math.cos(V.angle*(1-V.penumbra)),Y.decay=V.decay,n.spot[b]=Y;let re=V.shadow;if(V.map&&(n.spotLightMap[L]=V.map,L++,re.updateMatrices(V),V.castShadow&&P++),n.spotLightMatrix[b]=re.matrix,V.castShadow){let G=r.get(V);G.shadowBias=re.bias,G.shadowNormalBias=re.normalBias,G.shadowRadius=re.radius,G.shadowMapSize=re.mapSize,n.spotShadow[b]=G,n.spotShadowMap[b]=$,T++}b++}else if(V.isRectAreaLight){let Y=i.get(V);Y.color.copy(k).multiplyScalar(K),Y.halfWidth.set(V.width*.5,0,0),Y.halfHeight.set(0,V.height*.5,0),n.rectArea[w]=Y,w++}else if(V.isPointLight){let Y=i.get(V);if(Y.color.copy(V.color).multiplyScalar(V.intensity*R),Y.distance=V.distance,Y.decay=V.decay,V.castShadow){let re=V.shadow,G=r.get(V);G.shadowBias=re.bias,G.shadowNormalBias=re.normalBias,G.shadowRadius=re.radius,G.shadowMapSize=re.mapSize,G.shadowCameraNear=re.camera.near,G.shadowCameraFar=re.camera.far,n.pointShadow[v]=G,n.pointShadowMap[v]=$,n.pointShadowMatrix[v]=V.shadow.matrix,D++}n.point[v]=Y,v++}else if(V.isHemisphereLight){let Y=i.get(V);Y.skyColor.copy(V.color).multiplyScalar(K*R),Y.groundColor.copy(V.groundColor).multiplyScalar(K*R),n.hemi[M]=Y,M++}}w>0&&(e.isWebGL2||t.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Vt.LTC_FLOAT_1,n.rectAreaLTC2=Vt.LTC_FLOAT_2):t.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=Vt.LTC_HALF_1,n.rectAreaLTC2=Vt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=p,n.ambient[2]=g;let O=n.hash;(O.directionalLength!==x||O.pointLength!==v||O.spotLength!==b||O.rectAreaLength!==w||O.hemiLength!==M||O.numDirectionalShadows!==E||O.numPointShadows!==D||O.numSpotShadows!==T||O.numSpotMaps!==L)&&(n.directional.length=x,n.spot.length=b,n.rectArea.length=w,n.point.length=v,n.hemi.length=M,n.directionalShadow.length=E,n.directionalShadowMap.length=E,n.pointShadow.length=D,n.pointShadowMap.length=D,n.spotShadow.length=T,n.spotShadowMap.length=T,n.directionalShadowMatrix.length=E,n.pointShadowMatrix.length=D,n.spotLightMatrix.length=T+L-P,n.spotLightMap.length=L,n.numSpotLightShadowsWithMaps=P,O.directionalLength=x,O.pointLength=v,O.spotLength=b,O.rectAreaLength=w,O.hemiLength=M,O.numDirectionalShadows=E,O.numPointShadows=D,O.numSpotShadows=T,O.numSpotMaps=L,n.version=Kue++)}function c(u,h){let d=0,p=0,g=0,x=0,v=0,b=h.matrixWorldInverse;for(let w=0,M=u.length;w<M;w++){let E=u[w];if(E.isDirectionalLight){let D=n.directional[d];D.direction.setFromMatrixPosition(E.matrixWorld),s.setFromMatrixPosition(E.target.matrixWorld),D.direction.sub(s),D.direction.transformDirection(b),d++}else if(E.isSpotLight){let D=n.spot[g];D.position.setFromMatrixPosition(E.matrixWorld),D.position.applyMatrix4(b),D.direction.setFromMatrixPosition(E.matrixWorld),s.setFromMatrixPosition(E.target.matrixWorld),D.direction.sub(s),D.direction.transformDirection(b),g++}else if(E.isRectAreaLight){let D=n.rectArea[x];D.position.setFromMatrixPosition(E.matrixWorld),D.position.applyMatrix4(b),o.identity(),a.copy(E.matrixWorld),a.premultiply(b),o.extractRotation(a),D.halfWidth.set(E.width*.5,0,0),D.halfHeight.set(0,E.height*.5,0),D.halfWidth.applyMatrix4(o),D.halfHeight.applyMatrix4(o),x++}else if(E.isPointLight){let D=n.point[p];D.position.setFromMatrixPosition(E.matrixWorld),D.position.applyMatrix4(b),p++}else if(E.isHemisphereLight){let D=n.hemi[v];D.direction.setFromMatrixPosition(E.matrixWorld),D.direction.transformDirection(b),v++}}}return{setup:l,setupView:c,state:n}}function xV(t,e){let i=new $ue(t,e),r=[],n=[];function s(){r.length=0,n.length=0}function a(u){r.push(u)}function o(u){n.push(u)}function l(u){i.setup(r,u)}function c(u){i.setupView(r,u)}return{init:s,state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:l,setupLightsView:c,pushLight:a,pushShadow:o}}function ehe(t,e){let i=new WeakMap;function r(s,a=0){let o=i.get(s),l;return o===void 0?(l=new xV(t,e),i.set(s,[l])):a>=o.length?(l=new xV(t,e),o.push(l)):l=o[a],l}function n(){i=new WeakMap}return{get:r,dispose:n}}var bq=class extends xM{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Bp,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}},the=class extends xM{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new W,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}},ihe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,rhe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function nhe(t,e,i){let r=new bN,n=new Oe,s=new Oe,a=new Ri,o=new bq({depthPacking:sq}),l=new the,c={},u=i.maxTextureSize,h={[gh]:La,[La]:gh,[Oo]:Oo},d=new xr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Oe},radius:{value:4}},vertexShader:ihe,fragmentShader:rhe}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let g=new ni;g.setAttribute("position",new _i(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let x=new bn(g,d),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=pN,this.render=function(E,D,T){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||E.length===0)return;let L=t.getRenderTarget(),P=t.getActiveCubeFace(),R=t.getActiveMipmapLevel(),O=t.state;O.setBlending(js),O.buffers.color.setClear(1,1,1,1),O.buffers.depth.setTest(!0),O.setScissorTest(!1);for(let U=0,F=E.length;U<F;U++){let V=E[U],k=V.shadow;if(k===void 0){console.warn("THREE.WebGLShadowMap:",V,"has no shadow.");continue}if(k.autoUpdate===!1&&k.needsUpdate===!1)continue;n.copy(k.mapSize);let K=k.getFrameExtents();if(n.multiply(K),s.copy(k.mapSize),(n.x>u||n.y>u)&&(n.x>u&&(s.x=Math.floor(u/K.x),n.x=s.x*K.x,k.mapSize.x=s.x),n.y>u&&(s.y=Math.floor(u/K.y),n.y=s.y*K.y,k.mapSize.y=s.y)),k.map===null){let $=this.type!==RS?{minFilter:nr,magFilter:nr}:{};k.map=new yr(n.x,n.y,$),k.map.texture.name=V.name+".shadowMap",k.camera.updateProjectionMatrix()}t.setRenderTarget(k.map),t.clear();let X=k.getViewportCount();for(let $=0;$<X;$++){let Y=k.getViewport($);a.set(s.x*Y.x,s.y*Y.y,s.x*Y.z,s.y*Y.w),O.viewport(a),k.updateMatrices(V,$),r=k.getFrustum(),M(D,T,k.camera,V,this.type)}k.isPointLightShadow!==!0&&this.type===RS&&b(k,T),k.needsUpdate=!1}v.needsUpdate=!1,t.setRenderTarget(L,P,R)};function b(E,D){let T=e.update(x);d.defines.VSM_SAMPLES!==E.blurSamples&&(d.defines.VSM_SAMPLES=E.blurSamples,p.defines.VSM_SAMPLES=E.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),E.mapPass===null&&(E.mapPass=new yr(n.x,n.y)),d.uniforms.shadow_pass.value=E.map.texture,d.uniforms.resolution.value=E.mapSize,d.uniforms.radius.value=E.radius,t.setRenderTarget(E.mapPass),t.clear(),t.renderBufferDirect(D,null,T,d,x,null),p.uniforms.shadow_pass.value=E.mapPass.texture,p.uniforms.resolution.value=E.mapSize,p.uniforms.radius.value=E.radius,t.setRenderTarget(E.map),t.clear(),t.renderBufferDirect(D,null,T,p,x,null)}function w(E,D,T,L,P,R){let O=null,U=T.isPointLight===!0?E.customDistanceMaterial:E.customDepthMaterial;if(U!==void 0)O=U;else if(O=T.isPointLight===!0?l:o,t.localClippingEnabled&&D.clipShadows===!0&&Array.isArray(D.clippingPlanes)&&D.clippingPlanes.length!==0||D.displacementMap&&D.displacementScale!==0||D.alphaMap&&D.alphaTest>0||D.map&&D.alphaTest>0){let F=O.uuid,V=D.uuid,k=c[F];k===void 0&&(k={},c[F]=k);let K=k[V];K===void 0&&(K=O.clone(),k[V]=K),O=K}return O.visible=D.visible,O.wireframe=D.wireframe,R===RS?O.side=D.shadowSide!==null?D.shadowSide:D.side:O.side=D.shadowSide!==null?D.shadowSide:h[D.side],O.alphaMap=D.alphaMap,O.alphaTest=D.alphaTest,O.map=D.map,O.clipShadows=D.clipShadows,O.clippingPlanes=D.clippingPlanes,O.clipIntersection=D.clipIntersection,O.displacementMap=D.displacementMap,O.displacementScale=D.displacementScale,O.displacementBias=D.displacementBias,O.wireframeLinewidth=D.wireframeLinewidth,O.linewidth=D.linewidth,T.isPointLight===!0&&O.isMeshDistanceMaterial===!0&&(O.referencePosition.setFromMatrixPosition(T.matrixWorld),O.nearDistance=L,O.farDistance=P),O}function M(E,D,T,L,P){if(E.visible===!1)return;if(E.layers.test(D.layers)&&(E.isMesh||E.isLine||E.isPoints)&&(E.castShadow||E.receiveShadow&&P===RS)&&(!E.frustumCulled||r.intersectsObject(E))){E.modelViewMatrix.multiplyMatrices(T.matrixWorldInverse,E.matrixWorld);let O=e.update(E),U=E.material;if(Array.isArray(U)){let F=O.groups;for(let V=0,k=F.length;V<k;V++){let K=F[V],X=U[K.materialIndex];if(X&&X.visible){let $=w(E,X,L,T.near,T.far,P);t.renderBufferDirect(T,null,O,$,E,K)}}}else if(U.visible){let F=w(E,U,L,T.near,T.far,P);t.renderBufferDirect(T,null,O,F,E,null)}}let R=E.children;for(let O=0,U=R.length;O<U;O++)M(R[O],D,T,L,P)}}function she(t,e,i){let r=i.isWebGL2;function n(){let le=!1,Re=new Ri,Ee=null,Qe=new Ri(0,0,0,0);return{setMask:function(ot){Ee!==ot&&!le&&(t.colorMask(ot,ot,ot,ot),Ee=ot)},setLocked:function(ot){le=ot},setClear:function(ot,pt,Bt,Jt,qt){qt===!0&&(ot*=Jt,pt*=Jt,Bt*=Jt),Re.set(ot,pt,Bt,Jt),Qe.equals(Re)===!1&&(t.clearColor(ot,pt,Bt,Jt),Qe.copy(Re))},reset:function(){le=!1,Ee=null,Qe.set(-1,0,0,0)}}}function s(){let le=!1,Re=null,Ee=null,Qe=null;return{setTest:function(ot){ot?ue(2929):fe(2929)},setMask:function(ot){Re!==ot&&!le&&(t.depthMask(ot),Re=ot)},setFunc:function(ot){if(Ee!==ot){switch(ot){case Ase:t.depthFunc(512);break;case Tse:t.depthFunc(519);break;case Cse:t.depthFunc(513);break;case Mz:t.depthFunc(515);break;case Dse:t.depthFunc(514);break;case Pse:t.depthFunc(518);break;case Rse:t.depthFunc(516);break;case Ose:t.depthFunc(517);break;default:t.depthFunc(515)}Ee=ot}},setLocked:function(ot){le=ot},setClear:function(ot){Qe!==ot&&(t.clearDepth(ot),Qe=ot)},reset:function(){le=!1,Re=null,Ee=null,Qe=null}}}function a(){let le=!1,Re=null,Ee=null,Qe=null,ot=null,pt=null,Bt=null,Jt=null,qt=null;return{setTest:function(Ft){le||(Ft?ue(2960):fe(2960))},setMask:function(Ft){Re!==Ft&&!le&&(t.stencilMask(Ft),Re=Ft)},setFunc:function(Ft,Ni,Oi){(Ee!==Ft||Qe!==Ni||ot!==Oi)&&(t.stencilFunc(Ft,Ni,Oi),Ee=Ft,Qe=Ni,ot=Oi)},setOp:function(Ft,Ni,Oi){(pt!==Ft||Bt!==Ni||Jt!==Oi)&&(t.stencilOp(Ft,Ni,Oi),pt=Ft,Bt=Ni,Jt=Oi)},setLocked:function(Ft){le=Ft},setClear:function(Ft){qt!==Ft&&(t.clearStencil(Ft),qt=Ft)},reset:function(){le=!1,Re=null,Ee=null,Qe=null,ot=null,pt=null,Bt=null,Jt=null,qt=null}}}let o=new n,l=new s,c=new a,u=new WeakMap,h=new WeakMap,d={},p={},g=new WeakMap,x=[],v=null,b=!1,w=null,M=null,E=null,D=null,T=null,L=null,P=null,R=!1,O=null,U=null,F=null,V=null,k=null,K=t.getParameter(35661),X=!1,$=0,Y=t.getParameter(7938);Y.indexOf("WebGL")!==-1?($=parseFloat(/^WebGL (\d)/.exec(Y)[1]),X=$>=1):Y.indexOf("OpenGL ES")!==-1&&($=parseFloat(/^OpenGL ES (\d)/.exec(Y)[1]),X=$>=2);let re=null,G={},j=t.getParameter(3088),ee=t.getParameter(2978),oe=new Ri().fromArray(j),Q=new Ri().fromArray(ee);function ae(le,Re,Ee){let Qe=new Uint8Array(4),ot=t.createTexture();t.bindTexture(le,ot),t.texParameteri(le,10241,9728),t.texParameteri(le,10240,9728);for(let pt=0;pt<Ee;pt++)t.texImage2D(Re+pt,0,6408,1,1,0,6408,5121,Qe);return ot}let ne={};ne[3553]=ae(3553,3553,1),ne[34067]=ae(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),ue(2929),l.setFunc(Mz),ze(!1),Xe(hk),ue(2884),ce(js);function ue(le){d[le]!==!0&&(t.enable(le),d[le]=!0)}function fe(le){d[le]!==!1&&(t.disable(le),d[le]=!1)}function xe(le,Re){return p[le]!==Re?(t.bindFramebuffer(le,Re),p[le]=Re,r&&(le===36009&&(p[36160]=Re),le===36160&&(p[36009]=Re)),!0):!1}function be(le,Re){let Ee=x,Qe=!1;if(le)if(Ee=g.get(Re),Ee===void 0&&(Ee=[],g.set(Re,Ee)),le.isWebGLMultipleRenderTargets){let ot=le.texture;if(Ee.length!==ot.length||Ee[0]!==36064){for(let pt=0,Bt=ot.length;pt<Bt;pt++)Ee[pt]=36064+pt;Ee.length=ot.length,Qe=!0}}else Ee[0]!==36064&&(Ee[0]=36064,Qe=!0);else Ee[0]!==1029&&(Ee[0]=1029,Qe=!0);Qe&&(i.isWebGL2?t.drawBuffers(Ee):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Ee))}function Ce(le){return v!==le?(t.useProgram(le),v=le,!0):!1}let ge={[qx]:32774,[mse]:32778,[gse]:32779};if(r)ge[mk]=32775,ge[gk]=32776;else{let le=e.get("EXT_blend_minmax");le!==null&&(ge[mk]=le.MIN_EXT,ge[gk]=le.MAX_EXT)}let Te={[vse]:0,[yse]:1,[xse]:768,[K7]:770,[Ese]:776,[wse]:774,[_se]:772,[bse]:769,[J7]:771,[Mse]:775,[Sse]:773};function ce(le,Re,Ee,Qe,ot,pt,Bt,Jt){if(le===js){b===!0&&(fe(3042),b=!1);return}if(b===!1&&(ue(3042),b=!0),le!==pse){if(le!==w||Jt!==R){if((M!==qx||T!==qx)&&(t.blendEquation(32774),M=qx,T=qx),Jt)switch(le){case y0:t.blendFuncSeparate(1,771,1,771);break;case dk:t.blendFunc(1,1);break;case fk:t.blendFuncSeparate(0,769,0,1);break;case pk:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",le);break}else switch(le){case y0:t.blendFuncSeparate(770,771,1,771);break;case dk:t.blendFunc(770,1);break;case fk:t.blendFuncSeparate(0,769,0,1);break;case pk:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",le);break}E=null,D=null,L=null,P=null,w=le,R=Jt}return}ot=ot||Re,pt=pt||Ee,Bt=Bt||Qe,(Re!==M||ot!==T)&&(t.blendEquationSeparate(ge[Re],ge[ot]),M=Re,T=ot),(Ee!==E||Qe!==D||pt!==L||Bt!==P)&&(t.blendFuncSeparate(Te[Ee],Te[Qe],Te[pt],Te[Bt]),E=Ee,D=Qe,L=pt,P=Bt),w=le,R=!1}function Ue(le,Re){le.side===Oo?fe(2884):ue(2884);let Ee=le.side===La;Re&&(Ee=!Ee),ze(Ee),le.blending===y0&&le.transparent===!1?ce(js):ce(le.blending,le.blendEquation,le.blendSrc,le.blendDst,le.blendEquationAlpha,le.blendSrcAlpha,le.blendDstAlpha,le.premultipliedAlpha),l.setFunc(le.depthFunc),l.setTest(le.depthTest),l.setMask(le.depthWrite),o.setMask(le.colorWrite);let Qe=le.stencilWrite;c.setTest(Qe),Qe&&(c.setMask(le.stencilWriteMask),c.setFunc(le.stencilFunc,le.stencilRef,le.stencilFuncMask),c.setOp(le.stencilFail,le.stencilZFail,le.stencilZPass)),Ge(le.polygonOffset,le.polygonOffsetFactor,le.polygonOffsetUnits),le.alphaToCoverage===!0?ue(32926):fe(32926)}function ze(le){O!==le&&(le?t.frontFace(2304):t.frontFace(2305),O=le)}function Xe(le){le!==hse?(ue(2884),le!==U&&(le===hk?t.cullFace(1029):le===dse?t.cullFace(1028):t.cullFace(1032))):fe(2884),U=le}function De(le){le!==F&&(X&&t.lineWidth(le),F=le)}function Ge(le,Re,Ee){le?(ue(32823),(V!==Re||k!==Ee)&&(t.polygonOffset(Re,Ee),V=Re,k=Ee)):fe(32823)}function We(le){le?ue(3089):fe(3089)}function se(le){le===void 0&&(le=33984+K-1),re!==le&&(t.activeTexture(le),re=le)}function H(le,Re,Ee){Ee===void 0&&(re===null?Ee=33984+K-1:Ee=re);let Qe=G[Ee];Qe===void 0&&(Qe={type:void 0,texture:void 0},G[Ee]=Qe),(Qe.type!==le||Qe.texture!==Re)&&(re!==Ee&&(t.activeTexture(Ee),re=Ee),t.bindTexture(le,Re||ne[le]),Qe.type=le,Qe.texture=Re)}function Z(){let le=G[re];le!==void 0&&le.type!==void 0&&(t.bindTexture(le.type,null),le.type=void 0,le.texture=void 0)}function pe(){try{t.compressedTexImage2D.apply(t,arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function we(){try{t.compressedTexImage3D.apply(t,arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function J(){try{t.texSubImage2D.apply(t,arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function He(){try{t.texSubImage3D.apply(t,arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function je(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function Ye(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function Ve(){try{t.texStorage2D.apply(t,arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function Ke(){try{t.texStorage3D.apply(t,arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function at(){try{t.texImage2D.apply(t,arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function ut(){try{t.texImage3D.apply(t,arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function ht(le){oe.equals(le)===!1&&(t.scissor(le.x,le.y,le.z,le.w),oe.copy(le))}function $e(le){Q.equals(le)===!1&&(t.viewport(le.x,le.y,le.z,le.w),Q.copy(le))}function St(le,Re){let Ee=h.get(Re);Ee===void 0&&(Ee=new WeakMap,h.set(Re,Ee));let Qe=Ee.get(le);Qe===void 0&&(Qe=t.getUniformBlockIndex(Re,le.name),Ee.set(le,Qe))}function Pt(le,Re){let Ee=h.get(Re).get(le);u.get(Re)!==Ee&&(t.uniformBlockBinding(Re,Ee,le.__bindingPointIndex),u.set(Re,Ee))}function Kt(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),r===!0&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),d={},re=null,G={},p={},g=new WeakMap,x=[],v=null,b=!1,w=null,M=null,E=null,D=null,T=null,L=null,P=null,R=!1,O=null,U=null,F=null,V=null,k=null,oe.set(0,0,t.canvas.width,t.canvas.height),Q.set(0,0,t.canvas.width,t.canvas.height),o.reset(),l.reset(),c.reset()}return{buffers:{color:o,depth:l,stencil:c},enable:ue,disable:fe,bindFramebuffer:xe,drawBuffers:be,useProgram:Ce,setBlending:ce,setMaterial:Ue,setFlipSided:ze,setCullFace:Xe,setLineWidth:De,setPolygonOffset:Ge,setScissorTest:We,activeTexture:se,bindTexture:H,unbindTexture:Z,compressedTexImage2D:pe,compressedTexImage3D:we,texImage2D:at,texImage3D:ut,updateUBOMapping:St,uniformBlockBinding:Pt,texStorage2D:Ve,texStorage3D:Ke,texSubImage2D:J,texSubImage3D:He,compressedTexSubImage2D:je,compressedTexSubImage3D:Ye,scissor:ht,viewport:$e,reset:Kt}}function ahe(t,e,i,r,n,s,a){let o=n.isWebGL2,l=n.maxTextures,c=n.maxCubemapSize,u=n.maxTextureSize,h=n.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,p=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),g=new WeakMap,x,v=new WeakMap,b=!1;try{b=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function w(H,Z){return b?new OffscreenCanvas(H,Z):Mw("canvas")}function M(H,Z,pe,we){let J=1;if((H.width>we||H.height>we)&&(J=we/Math.max(H.width,H.height)),J<1||Z===!0)if(typeof HTMLImageElement<"u"&&H instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&H instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&H instanceof ImageBitmap){let He=Z?TC:Math.floor,je=He(J*H.width),Ye=He(J*H.height);x===void 0&&(x=w(je,Ye));let Ve=pe?w(je,Ye):x;return Ve.width=je,Ve.height=Ye,Ve.getContext("2d").drawImage(H,0,0,je,Ye),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+H.width+"x"+H.height+") to ("+je+"x"+Ye+")."),Ve}else return"data"in H&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+H.width+"x"+H.height+")."),H;return H}function E(H){return Rz(H.width)&&Rz(H.height)}function D(H){return o?!1:H.wrapS!==zn||H.wrapT!==zn||H.minFilter!==nr&&H.minFilter!==Ki}function T(H,Z){return H.generateMipmaps&&Z&&H.minFilter!==nr&&H.minFilter!==Ki}function L(H){t.generateMipmap(H)}function P(H,Z,pe,we,J=!1){if(o===!1)return Z;if(H!==null){if(t[H]!==void 0)return t[H];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+H+"'")}let He=Z;return Z===6403&&(pe===5126&&(He=33326),pe===5131&&(He=33325),pe===5121&&(He=33321)),Z===33319&&(pe===5126&&(He=33328),pe===5131&&(He=33327),pe===5121&&(He=33323)),Z===6408&&(pe===5126&&(He=34836),pe===5131&&(He=34842),pe===5121&&(He=we===ji&&J===!1?35907:32856),pe===32819&&(He=32854),pe===32820&&(He=32855)),(He===33325||He===33326||He===33327||He===33328||He===34842||He===34836)&&e.get("EXT_color_buffer_float"),He}function R(H,Z,pe){return T(H,pe)===!0||H.isFramebufferTexture&&H.minFilter!==nr&&H.minFilter!==Ki?Math.log2(Math.max(Z.width,Z.height))+1:H.mipmaps!==void 0&&H.mipmaps.length>0?H.mipmaps.length:H.isCompressedTexture&&Array.isArray(H.image)?Z.mipmaps.length:1}function O(H){return H===nr||H===vk||H===HR?9728:9729}function U(H){let Z=H.target;Z.removeEventListener("dispose",U),V(Z),Z.isVideoTexture&&g.delete(Z)}function F(H){let Z=H.target;Z.removeEventListener("dispose",F),K(Z)}function V(H){let Z=r.get(H);if(Z.__webglInit===void 0)return;let pe=H.source,we=v.get(pe);if(we){let J=we[Z.__cacheKey];J.usedTimes--,J.usedTimes===0&&k(H),Object.keys(we).length===0&&v.delete(pe)}r.remove(H)}function k(H){let Z=r.get(H);t.deleteTexture(Z.__webglTexture);let pe=H.source,we=v.get(pe);delete we[Z.__cacheKey],a.memory.textures--}function K(H){let Z=H.texture,pe=r.get(H),we=r.get(Z);if(we.__webglTexture!==void 0&&(t.deleteTexture(we.__webglTexture),a.memory.textures--),H.depthTexture&&H.depthTexture.dispose(),H.isWebGLCubeRenderTarget)for(let J=0;J<6;J++)t.deleteFramebuffer(pe.__webglFramebuffer[J]),pe.__webglDepthbuffer&&t.deleteRenderbuffer(pe.__webglDepthbuffer[J]);else{if(t.deleteFramebuffer(pe.__webglFramebuffer),pe.__webglDepthbuffer&&t.deleteRenderbuffer(pe.__webglDepthbuffer),pe.__webglMultisampledFramebuffer&&t.deleteFramebuffer(pe.__webglMultisampledFramebuffer),pe.__webglColorRenderbuffer)for(let J=0;J<pe.__webglColorRenderbuffer.length;J++)pe.__webglColorRenderbuffer[J]&&t.deleteRenderbuffer(pe.__webglColorRenderbuffer[J]);pe.__webglDepthRenderbuffer&&t.deleteRenderbuffer(pe.__webglDepthRenderbuffer)}if(H.isWebGLMultipleRenderTargets)for(let J=0,He=Z.length;J<He;J++){let je=r.get(Z[J]);je.__webglTexture&&(t.deleteTexture(je.__webglTexture),a.memory.textures--),r.remove(Z[J])}r.remove(Z),r.remove(H)}let X=0;function $(){X=0}function Y(){let H=X;return H>=l&&console.warn("THREE.WebGLTextures: Trying to use "+H+" texture units while this GPU supports only "+l),X+=1,H}function re(H){let Z=[];return Z.push(H.wrapS),Z.push(H.wrapT),Z.push(H.wrapR||0),Z.push(H.magFilter),Z.push(H.minFilter),Z.push(H.anisotropy),Z.push(H.internalFormat),Z.push(H.format),Z.push(H.type),Z.push(H.generateMipmaps),Z.push(H.premultiplyAlpha),Z.push(H.flipY),Z.push(H.unpackAlignment),Z.push(H.encoding),Z.join()}function G(H,Z){let pe=r.get(H);if(H.isVideoTexture&&We(H),H.isRenderTargetTexture===!1&&H.version>0&&pe.__version!==H.version){let we=H.image;if(we===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(we.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{fe(pe,H,Z);return}}i.bindTexture(3553,pe.__webglTexture,33984+Z)}function j(H,Z){let pe=r.get(H);if(H.version>0&&pe.__version!==H.version){fe(pe,H,Z);return}i.bindTexture(35866,pe.__webglTexture,33984+Z)}function ee(H,Z){let pe=r.get(H);if(H.version>0&&pe.__version!==H.version){fe(pe,H,Z);return}i.bindTexture(32879,pe.__webglTexture,33984+Z)}function oe(H,Z){let pe=r.get(H);if(H.version>0&&pe.__version!==H.version){xe(pe,H,Z);return}i.bindTexture(34067,pe.__webglTexture,33984+Z)}let Q={[fp]:10497,[zn]:33071,[Tz]:33648},ae={[nr]:9728,[vk]:9984,[HR]:9986,[Ki]:9729,[kse]:9985,[P1]:9987};function ne(H,Z,pe){if(pe?(t.texParameteri(H,10242,Q[Z.wrapS]),t.texParameteri(H,10243,Q[Z.wrapT]),(H===32879||H===35866)&&t.texParameteri(H,32882,Q[Z.wrapR]),t.texParameteri(H,10240,ae[Z.magFilter]),t.texParameteri(H,10241,ae[Z.minFilter])):(t.texParameteri(H,10242,33071),t.texParameteri(H,10243,33071),(H===32879||H===35866)&&t.texParameteri(H,32882,33071),(Z.wrapS!==zn||Z.wrapT!==zn)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(H,10240,O(Z.magFilter)),t.texParameteri(H,10241,O(Z.minFilter)),Z.minFilter!==nr&&Z.minFilter!==Ki&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){let we=e.get("EXT_texture_filter_anisotropic");if(Z.magFilter===nr||Z.minFilter!==HR&&Z.minFilter!==P1||Z.type===rn&&e.has("OES_texture_float_linear")===!1||o===!1&&Z.type===Ap&&e.has("OES_texture_half_float_linear")===!1)return;(Z.anisotropy>1||r.get(Z).__currentAnisotropy)&&(t.texParameterf(H,we.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Z.anisotropy,n.getMaxAnisotropy())),r.get(Z).__currentAnisotropy=Z.anisotropy)}}function ue(H,Z){let pe=!1;H.__webglInit===void 0&&(H.__webglInit=!0,Z.addEventListener("dispose",U));let we=Z.source,J=v.get(we);J===void 0&&(J={},v.set(we,J));let He=re(Z);if(He!==H.__cacheKey){J[He]===void 0&&(J[He]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,pe=!0),J[He].usedTimes++;let je=J[H.__cacheKey];je!==void 0&&(J[H.__cacheKey].usedTimes--,je.usedTimes===0&&k(Z)),H.__cacheKey=He,H.__webglTexture=J[He].texture}return pe}function fe(H,Z,pe){let we=3553;(Z.isDataArrayTexture||Z.isCompressedArrayTexture)&&(we=35866),Z.isData3DTexture&&(we=32879);let J=ue(H,Z),He=Z.source;i.bindTexture(we,H.__webglTexture,33984+pe);let je=r.get(He);if(He.version!==je.__version||J===!0){i.activeTexture(33984+pe),t.pixelStorei(37440,Z.flipY),t.pixelStorei(37441,Z.premultiplyAlpha),t.pixelStorei(3317,Z.unpackAlignment),t.pixelStorei(37443,0);let Ye=D(Z)&&E(Z.image)===!1,Ve=M(Z.image,Ye,!1,u);Ve=se(Z,Ve);let Ke=E(Ve)||o,at=s.convert(Z.format,Z.encoding),ut=s.convert(Z.type),ht=P(Z.internalFormat,at,ut,Z.encoding,Z.isVideoTexture);ne(we,Z,Ke);let $e,St=Z.mipmaps,Pt=o&&Z.isVideoTexture!==!0,Kt=je.__version===void 0||J===!0,le=R(Z,Ve,Ke);if(Z.isDepthTexture)ht=6402,o?Z.type===rn?ht=36012:Z.type===pp?ht=33190:Z.type===x0?ht=35056:ht=33189:Z.type===rn&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Z.format===b0&&ht===6402&&Z.type!==tq&&Z.type!==pp&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Z.type=pp,ut=s.convert(Z.type)),Z.format===L0&&ht===6402&&(ht=34041,Z.type!==x0&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Z.type=x0,ut=s.convert(Z.type))),Kt&&(Pt?i.texStorage2D(3553,1,ht,Ve.width,Ve.height):i.texImage2D(3553,0,ht,Ve.width,Ve.height,0,at,ut,null));else if(Z.isDataTexture)if(St.length>0&&Ke){Pt&&Kt&&i.texStorage2D(3553,le,ht,St[0].width,St[0].height);for(let Re=0,Ee=St.length;Re<Ee;Re++)$e=St[Re],Pt?i.texSubImage2D(3553,Re,0,0,$e.width,$e.height,at,ut,$e.data):i.texImage2D(3553,Re,ht,$e.width,$e.height,0,at,ut,$e.data);Z.generateMipmaps=!1}else Pt?(Kt&&i.texStorage2D(3553,le,ht,Ve.width,Ve.height),i.texSubImage2D(3553,0,0,0,Ve.width,Ve.height,at,ut,Ve.data)):i.texImage2D(3553,0,ht,Ve.width,Ve.height,0,at,ut,Ve.data);else if(Z.isCompressedTexture)if(Z.isCompressedArrayTexture){Pt&&Kt&&i.texStorage3D(35866,le,ht,St[0].width,St[0].height,Ve.depth);for(let Re=0,Ee=St.length;Re<Ee;Re++)$e=St[Re],Z.format!==kn?at!==null?Pt?i.compressedTexSubImage3D(35866,Re,0,0,0,$e.width,$e.height,Ve.depth,at,$e.data,0,0):i.compressedTexImage3D(35866,Re,ht,$e.width,$e.height,Ve.depth,0,$e.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Pt?i.texSubImage3D(35866,Re,0,0,0,$e.width,$e.height,Ve.depth,at,ut,$e.data):i.texImage3D(35866,Re,ht,$e.width,$e.height,Ve.depth,0,at,ut,$e.data)}else{Pt&&Kt&&i.texStorage2D(3553,le,ht,St[0].width,St[0].height);for(let Re=0,Ee=St.length;Re<Ee;Re++)$e=St[Re],Z.format!==kn?at!==null?Pt?i.compressedTexSubImage2D(3553,Re,0,0,$e.width,$e.height,at,$e.data):i.compressedTexImage2D(3553,Re,ht,$e.width,$e.height,0,$e.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Pt?i.texSubImage2D(3553,Re,0,0,$e.width,$e.height,at,ut,$e.data):i.texImage2D(3553,Re,ht,$e.width,$e.height,0,at,ut,$e.data)}else if(Z.isDataArrayTexture)Pt?(Kt&&i.texStorage3D(35866,le,ht,Ve.width,Ve.height,Ve.depth),i.texSubImage3D(35866,0,0,0,0,Ve.width,Ve.height,Ve.depth,at,ut,Ve.data)):i.texImage3D(35866,0,ht,Ve.width,Ve.height,Ve.depth,0,at,ut,Ve.data);else if(Z.isData3DTexture)Pt?(Kt&&i.texStorage3D(32879,le,ht,Ve.width,Ve.height,Ve.depth),i.texSubImage3D(32879,0,0,0,0,Ve.width,Ve.height,Ve.depth,at,ut,Ve.data)):i.texImage3D(32879,0,ht,Ve.width,Ve.height,Ve.depth,0,at,ut,Ve.data);else if(Z.isFramebufferTexture){if(Kt)if(Pt)i.texStorage2D(3553,le,ht,Ve.width,Ve.height);else{let Re=Ve.width,Ee=Ve.height;for(let Qe=0;Qe<le;Qe++)i.texImage2D(3553,Qe,ht,Re,Ee,0,at,ut,null),Re>>=1,Ee>>=1}}else if(St.length>0&&Ke){Pt&&Kt&&i.texStorage2D(3553,le,ht,St[0].width,St[0].height);for(let Re=0,Ee=St.length;Re<Ee;Re++)$e=St[Re],Pt?i.texSubImage2D(3553,Re,0,0,at,ut,$e):i.texImage2D(3553,Re,ht,at,ut,$e);Z.generateMipmaps=!1}else Pt?(Kt&&i.texStorage2D(3553,le,ht,Ve.width,Ve.height),i.texSubImage2D(3553,0,0,0,at,ut,Ve)):i.texImage2D(3553,0,ht,at,ut,Ve);T(Z,Ke)&&L(we),je.__version=He.version,Z.onUpdate&&Z.onUpdate(Z)}H.__version=Z.version}function xe(H,Z,pe){if(Z.image.length!==6)return;let we=ue(H,Z),J=Z.source;i.bindTexture(34067,H.__webglTexture,33984+pe);let He=r.get(J);if(J.version!==He.__version||we===!0){i.activeTexture(33984+pe),t.pixelStorei(37440,Z.flipY),t.pixelStorei(37441,Z.premultiplyAlpha),t.pixelStorei(3317,Z.unpackAlignment),t.pixelStorei(37443,0);let je=Z.isCompressedTexture||Z.image[0].isCompressedTexture,Ye=Z.image[0]&&Z.image[0].isDataTexture,Ve=[];for(let Re=0;Re<6;Re++)!je&&!Ye?Ve[Re]=M(Z.image[Re],!1,!0,c):Ve[Re]=Ye?Z.image[Re].image:Z.image[Re],Ve[Re]=se(Z,Ve[Re]);let Ke=Ve[0],at=E(Ke)||o,ut=s.convert(Z.format,Z.encoding),ht=s.convert(Z.type),$e=P(Z.internalFormat,ut,ht,Z.encoding),St=o&&Z.isVideoTexture!==!0,Pt=He.__version===void 0||we===!0,Kt=R(Z,Ke,at);ne(34067,Z,at);let le;if(je){St&&Pt&&i.texStorage2D(34067,Kt,$e,Ke.width,Ke.height);for(let Re=0;Re<6;Re++){le=Ve[Re].mipmaps;for(let Ee=0;Ee<le.length;Ee++){let Qe=le[Ee];Z.format!==kn?ut!==null?St?i.compressedTexSubImage2D(34069+Re,Ee,0,0,Qe.width,Qe.height,ut,Qe.data):i.compressedTexImage2D(34069+Re,Ee,$e,Qe.width,Qe.height,0,Qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):St?i.texSubImage2D(34069+Re,Ee,0,0,Qe.width,Qe.height,ut,ht,Qe.data):i.texImage2D(34069+Re,Ee,$e,Qe.width,Qe.height,0,ut,ht,Qe.data)}}}else{le=Z.mipmaps,St&&Pt&&(le.length>0&&Kt++,i.texStorage2D(34067,Kt,$e,Ve[0].width,Ve[0].height));for(let Re=0;Re<6;Re++)if(Ye){St?i.texSubImage2D(34069+Re,0,0,0,Ve[Re].width,Ve[Re].height,ut,ht,Ve[Re].data):i.texImage2D(34069+Re,0,$e,Ve[Re].width,Ve[Re].height,0,ut,ht,Ve[Re].data);for(let Ee=0;Ee<le.length;Ee++){let Qe=le[Ee].image[Re].image;St?i.texSubImage2D(34069+Re,Ee+1,0,0,Qe.width,Qe.height,ut,ht,Qe.data):i.texImage2D(34069+Re,Ee+1,$e,Qe.width,Qe.height,0,ut,ht,Qe.data)}}else{St?i.texSubImage2D(34069+Re,0,0,0,ut,ht,Ve[Re]):i.texImage2D(34069+Re,0,$e,ut,ht,Ve[Re]);for(let Ee=0;Ee<le.length;Ee++){let Qe=le[Ee];St?i.texSubImage2D(34069+Re,Ee+1,0,0,ut,ht,Qe.image[Re]):i.texImage2D(34069+Re,Ee+1,$e,ut,ht,Qe.image[Re])}}}T(Z,at)&&L(34067),He.__version=J.version,Z.onUpdate&&Z.onUpdate(Z)}H.__version=Z.version}function be(H,Z,pe,we,J){let He=s.convert(pe.format,pe.encoding),je=s.convert(pe.type),Ye=P(pe.internalFormat,He,je,pe.encoding);r.get(Z).__hasExternalTextures||(J===32879||J===35866?i.texImage3D(J,0,Ye,Z.width,Z.height,Z.depth,0,He,je,null):i.texImage2D(J,0,Ye,Z.width,Z.height,0,He,je,null)),i.bindFramebuffer(36160,H),Ge(Z)?d.framebufferTexture2DMultisampleEXT(36160,we,J,r.get(pe).__webglTexture,0,De(Z)):(J===3553||J>=34069&&J<=34074)&&t.framebufferTexture2D(36160,we,J,r.get(pe).__webglTexture,0),i.bindFramebuffer(36160,null)}function Ce(H,Z,pe){if(t.bindRenderbuffer(36161,H),Z.depthBuffer&&!Z.stencilBuffer){let we=33189;if(pe||Ge(Z)){let J=Z.depthTexture;J&&J.isDepthTexture&&(J.type===rn?we=36012:J.type===pp&&(we=33190));let He=De(Z);Ge(Z)?d.renderbufferStorageMultisampleEXT(36161,He,we,Z.width,Z.height):t.renderbufferStorageMultisample(36161,He,we,Z.width,Z.height)}else t.renderbufferStorage(36161,we,Z.width,Z.height);t.framebufferRenderbuffer(36160,36096,36161,H)}else if(Z.depthBuffer&&Z.stencilBuffer){let we=De(Z);pe&&Ge(Z)===!1?t.renderbufferStorageMultisample(36161,we,35056,Z.width,Z.height):Ge(Z)?d.renderbufferStorageMultisampleEXT(36161,we,35056,Z.width,Z.height):t.renderbufferStorage(36161,34041,Z.width,Z.height),t.framebufferRenderbuffer(36160,33306,36161,H)}else{let we=Z.isWebGLMultipleRenderTargets===!0?Z.texture:[Z.texture];for(let J=0;J<we.length;J++){let He=we[J],je=s.convert(He.format,He.encoding),Ye=s.convert(He.type),Ve=P(He.internalFormat,je,Ye,He.encoding),Ke=De(Z);pe&&Ge(Z)===!1?t.renderbufferStorageMultisample(36161,Ke,Ve,Z.width,Z.height):Ge(Z)?d.renderbufferStorageMultisampleEXT(36161,Ke,Ve,Z.width,Z.height):t.renderbufferStorage(36161,Ve,Z.width,Z.height)}}t.bindRenderbuffer(36161,null)}function ge(H,Z){if(Z&&Z.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,H),!(Z.depthTexture&&Z.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(Z.depthTexture).__webglTexture||Z.depthTexture.image.width!==Z.width||Z.depthTexture.image.height!==Z.height)&&(Z.depthTexture.image.width=Z.width,Z.depthTexture.image.height=Z.height,Z.depthTexture.needsUpdate=!0),G(Z.depthTexture,0);let pe=r.get(Z.depthTexture).__webglTexture,we=De(Z);if(Z.depthTexture.format===b0)Ge(Z)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,pe,0,we):t.framebufferTexture2D(36160,36096,3553,pe,0);else if(Z.depthTexture.format===L0)Ge(Z)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,pe,0,we):t.framebufferTexture2D(36160,33306,3553,pe,0);else throw new Error("Unknown depthTexture format")}function Te(H){let Z=r.get(H),pe=H.isWebGLCubeRenderTarget===!0;if(H.depthTexture&&!Z.__autoAllocateDepthBuffer){if(pe)throw new Error("target.depthTexture not supported in Cube render targets");ge(Z.__webglFramebuffer,H)}else if(pe){Z.__webglDepthbuffer=[];for(let we=0;we<6;we++)i.bindFramebuffer(36160,Z.__webglFramebuffer[we]),Z.__webglDepthbuffer[we]=t.createRenderbuffer(),Ce(Z.__webglDepthbuffer[we],H,!1)}else i.bindFramebuffer(36160,Z.__webglFramebuffer),Z.__webglDepthbuffer=t.createRenderbuffer(),Ce(Z.__webglDepthbuffer,H,!1);i.bindFramebuffer(36160,null)}function ce(H,Z,pe){let we=r.get(H);Z!==void 0&&be(we.__webglFramebuffer,H,H.texture,36064,3553),pe!==void 0&&Te(H)}function Ue(H){let Z=H.texture,pe=r.get(H),we=r.get(Z);H.addEventListener("dispose",F),H.isWebGLMultipleRenderTargets!==!0&&(we.__webglTexture===void 0&&(we.__webglTexture=t.createTexture()),we.__version=Z.version,a.memory.textures++);let J=H.isWebGLCubeRenderTarget===!0,He=H.isWebGLMultipleRenderTargets===!0,je=E(H)||o;if(J){pe.__webglFramebuffer=[];for(let Ye=0;Ye<6;Ye++)pe.__webglFramebuffer[Ye]=t.createFramebuffer()}else{if(pe.__webglFramebuffer=t.createFramebuffer(),He)if(n.drawBuffers){let Ye=H.texture;for(let Ve=0,Ke=Ye.length;Ve<Ke;Ve++){let at=r.get(Ye[Ve]);at.__webglTexture===void 0&&(at.__webglTexture=t.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&H.samples>0&&Ge(H)===!1){let Ye=He?Z:[Z];pe.__webglMultisampledFramebuffer=t.createFramebuffer(),pe.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,pe.__webglMultisampledFramebuffer);for(let Ve=0;Ve<Ye.length;Ve++){let Ke=Ye[Ve];pe.__webglColorRenderbuffer[Ve]=t.createRenderbuffer(),t.bindRenderbuffer(36161,pe.__webglColorRenderbuffer[Ve]);let at=s.convert(Ke.format,Ke.encoding),ut=s.convert(Ke.type),ht=P(Ke.internalFormat,at,ut,Ke.encoding,H.isXRRenderTarget===!0),$e=De(H);t.renderbufferStorageMultisample(36161,$e,ht,H.width,H.height),t.framebufferRenderbuffer(36160,36064+Ve,36161,pe.__webglColorRenderbuffer[Ve])}t.bindRenderbuffer(36161,null),H.depthBuffer&&(pe.__webglDepthRenderbuffer=t.createRenderbuffer(),Ce(pe.__webglDepthRenderbuffer,H,!0)),i.bindFramebuffer(36160,null)}}if(J){i.bindTexture(34067,we.__webglTexture),ne(34067,Z,je);for(let Ye=0;Ye<6;Ye++)be(pe.__webglFramebuffer[Ye],H,Z,36064,34069+Ye);T(Z,je)&&L(34067),i.unbindTexture()}else if(He){let Ye=H.texture;for(let Ve=0,Ke=Ye.length;Ve<Ke;Ve++){let at=Ye[Ve],ut=r.get(at);i.bindTexture(3553,ut.__webglTexture),ne(3553,at,je),be(pe.__webglFramebuffer,H,at,36064+Ve,3553),T(at,je)&&L(3553)}i.unbindTexture()}else{let Ye=3553;(H.isWebGL3DRenderTarget||H.isWebGLArrayRenderTarget)&&(o?Ye=H.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(Ye,we.__webglTexture),ne(Ye,Z,je),be(pe.__webglFramebuffer,H,Z,36064,Ye),T(Z,je)&&L(Ye),i.unbindTexture()}H.depthBuffer&&Te(H)}function ze(H){let Z=E(H)||o,pe=H.isWebGLMultipleRenderTargets===!0?H.texture:[H.texture];for(let we=0,J=pe.length;we<J;we++){let He=pe[we];if(T(He,Z)){let je=H.isWebGLCubeRenderTarget?34067:3553,Ye=r.get(He).__webglTexture;i.bindTexture(je,Ye),L(je),i.unbindTexture()}}}function Xe(H){if(o&&H.samples>0&&Ge(H)===!1){let Z=H.isWebGLMultipleRenderTargets?H.texture:[H.texture],pe=H.width,we=H.height,J=16384,He=[],je=H.stencilBuffer?33306:36096,Ye=r.get(H),Ve=H.isWebGLMultipleRenderTargets===!0;if(Ve)for(let Ke=0;Ke<Z.length;Ke++)i.bindFramebuffer(36160,Ye.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+Ke,36161,null),i.bindFramebuffer(36160,Ye.__webglFramebuffer),t.framebufferTexture2D(36009,36064+Ke,3553,null,0);i.bindFramebuffer(36008,Ye.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,Ye.__webglFramebuffer);for(let Ke=0;Ke<Z.length;Ke++){He.push(36064+Ke),H.depthBuffer&&He.push(je);let at=Ye.__ignoreDepthValues!==void 0?Ye.__ignoreDepthValues:!1;if(at===!1&&(H.depthBuffer&&(J|=256),H.stencilBuffer&&(J|=1024)),Ve&&t.framebufferRenderbuffer(36008,36064,36161,Ye.__webglColorRenderbuffer[Ke]),at===!0&&(t.invalidateFramebuffer(36008,[je]),t.invalidateFramebuffer(36009,[je])),Ve){let ut=r.get(Z[Ke]).__webglTexture;t.framebufferTexture2D(36009,36064,3553,ut,0)}t.blitFramebuffer(0,0,pe,we,0,0,pe,we,J,9728),p&&t.invalidateFramebuffer(36008,He)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),Ve)for(let Ke=0;Ke<Z.length;Ke++){i.bindFramebuffer(36160,Ye.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+Ke,36161,Ye.__webglColorRenderbuffer[Ke]);let at=r.get(Z[Ke]).__webglTexture;i.bindFramebuffer(36160,Ye.__webglFramebuffer),t.framebufferTexture2D(36009,36064+Ke,3553,at,0)}i.bindFramebuffer(36009,Ye.__webglMultisampledFramebuffer)}}function De(H){return Math.min(h,H.samples)}function Ge(H){let Z=r.get(H);return o&&H.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&Z.__useRenderToTexture!==!1}function We(H){let Z=a.render.frame;g.get(H)!==Z&&(g.set(H,Z),H.update())}function se(H,Z){let pe=H.encoding,we=H.format,J=H.type;return H.isCompressedTexture===!0||H.isVideoTexture===!0||H.format===Pz||pe!==vh&&(pe===ji?o===!1?e.has("EXT_sRGB")===!0&&we===kn?(H.format=Pz,H.minFilter=Ki,H.generateMipmaps=!1):Z=cq.sRGBToLinear(Z):(we!==kn||J!==zo)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",pe)),Z}this.allocateTextureUnit=Y,this.resetTextureUnits=$,this.setTexture2D=G,this.setTexture2DArray=j,this.setTexture3D=ee,this.setTextureCube=oe,this.rebindTextures=ce,this.setupRenderTarget=Ue,this.updateRenderTargetMipmap=ze,this.updateMultisampleRenderTarget=Xe,this.setupDepthRenderbuffer=Te,this.setupFrameBufferTexture=be,this.useMultisampledRTT=Ge}function ohe(t,e,i){let r=i.isWebGL2;function n(s,a=null){let o;if(s===zo)return 5121;if(s===jse)return 32819;if(s===Wse)return 32820;if(s===Vse)return 5120;if(s===Hse)return 5122;if(s===tq)return 5123;if(s===Gse)return 5124;if(s===pp)return 5125;if(s===rn)return 5126;if(s===Ap)return r?5131:(o=e.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===qse)return 6406;if(s===kn)return 6408;if(s===Xse)return 6409;if(s===Yse)return 6410;if(s===b0)return 6402;if(s===L0)return 34041;if(s===Pz)return o=e.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===WT)return 6403;if(s===Qse)return 36244;if(s===SC)return 33319;if(s===Zse)return 33320;if(s===iq)return 36249;if(s===GR||s===jR||s===WR||s===qR)if(a===ji)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===GR)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===jR)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===WR)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===qR)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===GR)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===jR)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===WR)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===qR)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===yk||s===xk||s===bk||s===_k)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===yk)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===xk)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===bk)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===_k)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===Kse)return o=e.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===Sk||s===wk)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(s===Sk)return a===ji?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===wk)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===Mk||s===Ek||s===Ak||s===Tk||s===Ck||s===Dk||s===Pk||s===Rk||s===Ok||s===Lk||s===Ik||s===zk||s===Uk||s===Bk)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(s===Mk)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===Ek)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===Ak)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===Tk)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===Ck)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===Dk)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===Pk)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===Rk)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===Ok)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===Lk)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===Ik)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===zk)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===Uk)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===Bk)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===XR)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(s===XR)return a===ji?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===Jse||s===Nk||s===Fk||s===kk)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(s===XR)return o.COMPRESSED_RED_RGTC1_EXT;if(s===Nk)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===Fk)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===kk)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===x0?r?34042:(o=e.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):t[s]!==void 0?t[s]:null}return{convert:n}}var lhe=class extends Do{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}},gp=class extends Kr{constructor(){super(),this.isGroup=!0,this.type="Group"}},che={type:"move"},xO=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new gp,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new gp,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new W,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new W),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new gp,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new W,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new W),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){let e=this._hand;if(e)for(let i of t.hand.values())this._getHandJoint(e,i)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,i){let r=null,n=null,s=null,a=this._targetRay,o=this._grip,l=this._hand;if(t&&e.session.visibilityState!=="visible-blurred"){if(l&&t.hand){s=!0;for(let g of t.hand.values()){let x=e.getJointPose(g,i),v=this._getHandJoint(l,g);x!==null&&(v.matrix.fromArray(x.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.jointRadius=x.radius),v.visible=x!==null}let c=l.joints["index-finger-tip"],u=l.joints["thumb-tip"],h=c.position.distanceTo(u.position),d=.02,p=.005;l.inputState.pinching&&h>d+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&h<=d-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else o!==null&&t.gripSpace&&(n=e.getPose(t.gripSpace,i),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1));a!==null&&(r=e.getPose(t.targetRaySpace,i),r===null&&n!==null&&(r=n),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(che)))}return a!==null&&(a.visible=r!==null),o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),this}_getHandJoint(t,e){if(t.joints[e.jointName]===void 0){let i=new gp;i.matrixAutoUpdate=!1,i.visible=!1,t.joints[e.jointName]=i,t.add(i)}return t.joints[e.jointName]}},O1=class extends ns{constructor(t,e,i,r,n,s,a,o,l,c){if(c=c!==void 0?c:b0,c!==b0&&c!==L0)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&c===b0&&(i=pp),i===void 0&&c===L0&&(i=x0),super(null,r,n,s,a,o,c,i,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=a!==void 0?a:nr,this.minFilter=o!==void 0?o:nr,this.flipY=!1,this.generateMipmaps=!1}},uhe=class extends lo{constructor(t,e){super();let i=this,r=null,n=1,s=null,a="local-floor",o=1,l=null,c=null,u=null,h=null,d=null,p=null,g=e.getContextAttributes(),x=null,v=null,b=[],w=[],M=new Set,E=new Map,D=new Do;D.layers.enable(1),D.viewport=new Ri;let T=new Do;T.layers.enable(2),T.viewport=new Ri;let L=[D,T],P=new lhe;P.layers.enable(1),P.layers.enable(2);let R=null,O=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(j){let ee=b[j];return ee===void 0&&(ee=new xO,b[j]=ee),ee.getTargetRaySpace()},this.getControllerGrip=function(j){let ee=b[j];return ee===void 0&&(ee=new xO,b[j]=ee),ee.getGripSpace()},this.getHand=function(j){let ee=b[j];return ee===void 0&&(ee=new xO,b[j]=ee),ee.getHandSpace()};function U(j){let ee=w.indexOf(j.inputSource);if(ee===-1)return;let oe=b[ee];oe!==void 0&&oe.dispatchEvent({type:j.type,data:j.inputSource})}function F(){r.removeEventListener("select",U),r.removeEventListener("selectstart",U),r.removeEventListener("selectend",U),r.removeEventListener("squeeze",U),r.removeEventListener("squeezestart",U),r.removeEventListener("squeezeend",U),r.removeEventListener("end",F),r.removeEventListener("inputsourceschange",V);for(let j=0;j<b.length;j++){let ee=w[j];ee!==null&&(w[j]=null,b[j].disconnect(ee))}R=null,O=null,t.setRenderTarget(x),d=null,h=null,u=null,r=null,v=null,G.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(j){n=j,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(j){a=j,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(j){l=j},this.getBaseLayer=function(){return h!==null?h:d},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(j){if(r=j,r!==null){if(x=t.getRenderTarget(),r.addEventListener("select",U),r.addEventListener("selectstart",U),r.addEventListener("selectend",U),r.addEventListener("squeeze",U),r.addEventListener("squeezestart",U),r.addEventListener("squeezeend",U),r.addEventListener("end",F),r.addEventListener("inputsourceschange",V),g.xrCompatible!==!0&&await e.makeXRCompatible(),r.renderState.layers===void 0||t.capabilities.isWebGL2===!1){let ee={antialias:r.renderState.layers===void 0?g.antialias:!0,alpha:g.alpha,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:n};d=new XRWebGLLayer(r,e,ee),r.updateRenderState({baseLayer:d}),v=new yr(d.framebufferWidth,d.framebufferHeight,{format:kn,type:zo,encoding:t.outputEncoding,stencilBuffer:g.stencil})}else{let ee=null,oe=null,Q=null;g.depth&&(Q=g.stencil?35056:33190,ee=g.stencil?L0:b0,oe=g.stencil?x0:pp);let ae={colorFormat:32856,depthFormat:Q,scaleFactor:n};u=new XRWebGLBinding(r,e),h=u.createProjectionLayer(ae),r.updateRenderState({layers:[h]}),v=new yr(h.textureWidth,h.textureHeight,{format:kn,type:zo,depthTexture:new O1(h.textureWidth,h.textureHeight,oe,void 0,void 0,void 0,void 0,void 0,void 0,ee),stencilBuffer:g.stencil,encoding:t.outputEncoding,samples:g.antialias?4:0});let ne=t.properties.get(v);ne.__ignoreDepthValues=h.ignoreDepthValues}v.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await r.requestReferenceSpace(a),G.setContext(r),G.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function V(j){for(let ee=0;ee<j.removed.length;ee++){let oe=j.removed[ee],Q=w.indexOf(oe);Q>=0&&(w[Q]=null,b[Q].disconnect(oe))}for(let ee=0;ee<j.added.length;ee++){let oe=j.added[ee],Q=w.indexOf(oe);if(Q===-1){for(let ne=0;ne<b.length;ne++)if(ne>=w.length){w.push(oe),Q=ne;break}else if(w[ne]===null){w[ne]=oe,Q=ne;break}if(Q===-1)break}let ae=b[Q];ae&&ae.connect(oe)}}let k=new W,K=new W;function X(j,ee,oe){k.setFromMatrixPosition(ee.matrixWorld),K.setFromMatrixPosition(oe.matrixWorld);let Q=k.distanceTo(K),ae=ee.projectionMatrix.elements,ne=oe.projectionMatrix.elements,ue=ae[14]/(ae[10]-1),fe=ae[14]/(ae[10]+1),xe=(ae[9]+1)/ae[5],be=(ae[9]-1)/ae[5],Ce=(ae[8]-1)/ae[0],ge=(ne[8]+1)/ne[0],Te=ue*Ce,ce=ue*ge,Ue=Q/(-Ce+ge),ze=Ue*-Ce;ee.matrixWorld.decompose(j.position,j.quaternion,j.scale),j.translateX(ze),j.translateZ(Ue),j.matrixWorld.compose(j.position,j.quaternion,j.scale),j.matrixWorldInverse.copy(j.matrixWorld).invert();let Xe=ue+Ue,De=fe+Ue,Ge=Te-ze,We=ce+(Q-ze),se=xe*fe/De*Xe,H=be*fe/De*Xe;j.projectionMatrix.makePerspective(Ge,We,se,H,Xe,De)}function $(j,ee){ee===null?j.matrixWorld.copy(j.matrix):j.matrixWorld.multiplyMatrices(ee.matrixWorld,j.matrix),j.matrixWorldInverse.copy(j.matrixWorld).invert()}this.updateCamera=function(j){if(r===null)return;P.near=T.near=D.near=j.near,P.far=T.far=D.far=j.far,(R!==P.near||O!==P.far)&&(r.updateRenderState({depthNear:P.near,depthFar:P.far}),R=P.near,O=P.far);let ee=j.parent,oe=P.cameras;$(P,ee);for(let ae=0;ae<oe.length;ae++)$(oe[ae],ee);P.matrixWorld.decompose(P.position,P.quaternion,P.scale),j.matrix.copy(P.matrix),j.matrix.decompose(j.position,j.quaternion,j.scale);let Q=j.children;for(let ae=0,ne=Q.length;ae<ne;ae++)Q[ae].updateMatrixWorld(!0);oe.length===2?X(P,D,T):P.projectionMatrix.copy(D.projectionMatrix)},this.getCamera=function(){return P},this.getFoveation=function(){if(!(h===null&&d===null))return o},this.setFoveation=function(j){o=j,h!==null&&(h.fixedFoveation=j),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=j)},this.getPlanes=function(){return M};let Y=null;function re(j,ee){if(c=ee.getViewerPose(l||s),p=ee,c!==null){let oe=c.views;d!==null&&(t.setRenderTargetFramebuffer(v,d.framebuffer),t.setRenderTarget(v));let Q=!1;oe.length!==P.cameras.length&&(P.cameras.length=0,Q=!0);for(let ae=0;ae<oe.length;ae++){let ne=oe[ae],ue=null;if(d!==null)ue=d.getViewport(ne);else{let xe=u.getViewSubImage(h,ne);ue=xe.viewport,ae===0&&(t.setRenderTargetTextures(v,xe.colorTexture,h.ignoreDepthValues?void 0:xe.depthStencilTexture),t.setRenderTarget(v))}let fe=L[ae];fe===void 0&&(fe=new Do,fe.layers.enable(ae),fe.viewport=new Ri,L[ae]=fe),fe.matrix.fromArray(ne.transform.matrix),fe.projectionMatrix.fromArray(ne.projectionMatrix),fe.viewport.set(ue.x,ue.y,ue.width,ue.height),ae===0&&P.matrix.copy(fe.matrix),Q===!0&&P.cameras.push(fe)}}for(let oe=0;oe<b.length;oe++){let Q=w[oe],ae=b[oe];Q!==null&&ae!==void 0&&ae.update(Q,ee,l||s)}if(Y&&Y(j,ee),ee.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:ee.detectedPlanes});let oe=null;for(let Q of M)ee.detectedPlanes.has(Q)||(oe===null&&(oe=[]),oe.push(Q));if(oe!==null)for(let Q of oe)M.delete(Q),E.delete(Q),i.dispatchEvent({type:"planeremoved",data:Q});for(let Q of ee.detectedPlanes)if(!M.has(Q))M.add(Q),E.set(Q,ee.lastChangedTime),i.dispatchEvent({type:"planeadded",data:Q});else{let ae=E.get(Q);Q.lastChangedTime>ae&&(E.set(Q,Q.lastChangedTime),i.dispatchEvent({type:"planechanged",data:Q}))}}p=null}let G=new mq;G.setAnimationLoop(re),this.setAnimationLoop=function(j){Y=j},this.dispose=function(){}}};function hhe(t,e){function i(x,v){v.color.getRGB(x.fogColor.value,pq(t)),v.isFog?(x.fogNear.value=v.near,x.fogFar.value=v.far):v.isFogExp2&&(x.fogDensity.value=v.density)}function r(x,v,b,w,M){v.isMeshBasicMaterial||v.isMeshLambertMaterial?n(x,v):v.isMeshToonMaterial?(n(x,v),u(x,v)):v.isMeshPhongMaterial?(n(x,v),c(x,v)):v.isMeshStandardMaterial?(n(x,v),h(x,v),v.isMeshPhysicalMaterial&&d(x,v,M)):v.isMeshMatcapMaterial?(n(x,v),p(x,v)):v.isMeshDepthMaterial?n(x,v):v.isMeshDistanceMaterial?(n(x,v),g(x,v)):v.isMeshNormalMaterial?n(x,v):v.isLineBasicMaterial?(s(x,v),v.isLineDashedMaterial&&a(x,v)):v.isPointsMaterial?o(x,v,b,w):v.isSpriteMaterial?l(x,v):v.isShadowMaterial?(x.color.value.copy(v.color),x.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}function n(x,v){x.opacity.value=v.opacity,v.color&&x.diffuse.value.copy(v.color),v.emissive&&x.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(x.map.value=v.map),v.alphaMap&&(x.alphaMap.value=v.alphaMap),v.bumpMap&&(x.bumpMap.value=v.bumpMap,x.bumpScale.value=v.bumpScale,v.side===La&&(x.bumpScale.value*=-1)),v.displacementMap&&(x.displacementMap.value=v.displacementMap,x.displacementScale.value=v.displacementScale,x.displacementBias.value=v.displacementBias),v.emissiveMap&&(x.emissiveMap.value=v.emissiveMap),v.normalMap&&(x.normalMap.value=v.normalMap,x.normalScale.value.copy(v.normalScale),v.side===La&&x.normalScale.value.negate()),v.specularMap&&(x.specularMap.value=v.specularMap),v.alphaTest>0&&(x.alphaTest.value=v.alphaTest);let b=e.get(v).envMap;if(b&&(x.envMap.value=b,x.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,x.reflectivity.value=v.reflectivity,x.ior.value=v.ior,x.refractionRatio.value=v.refractionRatio),v.lightMap){x.lightMap.value=v.lightMap;let E=t.physicallyCorrectLights!==!0?Math.PI:1;x.lightMapIntensity.value=v.lightMapIntensity*E}v.aoMap&&(x.aoMap.value=v.aoMap,x.aoMapIntensity.value=v.aoMapIntensity);let w;v.map?w=v.map:v.specularMap?w=v.specularMap:v.displacementMap?w=v.displacementMap:v.normalMap?w=v.normalMap:v.bumpMap?w=v.bumpMap:v.roughnessMap?w=v.roughnessMap:v.metalnessMap?w=v.metalnessMap:v.alphaMap?w=v.alphaMap:v.emissiveMap?w=v.emissiveMap:v.clearcoatMap?w=v.clearcoatMap:v.clearcoatNormalMap?w=v.clearcoatNormalMap:v.clearcoatRoughnessMap?w=v.clearcoatRoughnessMap:v.iridescenceMap?w=v.iridescenceMap:v.iridescenceThicknessMap?w=v.iridescenceThicknessMap:v.specularIntensityMap?w=v.specularIntensityMap:v.specularColorMap?w=v.specularColorMap:v.transmissionMap?w=v.transmissionMap:v.thicknessMap?w=v.thicknessMap:v.sheenColorMap?w=v.sheenColorMap:v.sheenRoughnessMap&&(w=v.sheenRoughnessMap),w!==void 0&&(w.isWebGLRenderTarget&&(w=w.texture),w.matrixAutoUpdate===!0&&w.updateMatrix(),x.uvTransform.value.copy(w.matrix));let M;v.aoMap?M=v.aoMap:v.lightMap&&(M=v.lightMap),M!==void 0&&(M.isWebGLRenderTarget&&(M=M.texture),M.matrixAutoUpdate===!0&&M.updateMatrix(),x.uv2Transform.value.copy(M.matrix))}function s(x,v){x.diffuse.value.copy(v.color),x.opacity.value=v.opacity}function a(x,v){x.dashSize.value=v.dashSize,x.totalSize.value=v.dashSize+v.gapSize,x.scale.value=v.scale}function o(x,v,b,w){x.diffuse.value.copy(v.color),x.opacity.value=v.opacity,x.size.value=v.size*b,x.scale.value=w*.5,v.map&&(x.map.value=v.map),v.alphaMap&&(x.alphaMap.value=v.alphaMap),v.alphaTest>0&&(x.alphaTest.value=v.alphaTest);let M;v.map?M=v.map:v.alphaMap&&(M=v.alphaMap),M!==void 0&&(M.matrixAutoUpdate===!0&&M.updateMatrix(),x.uvTransform.value.copy(M.matrix))}function l(x,v){x.diffuse.value.copy(v.color),x.opacity.value=v.opacity,x.rotation.value=v.rotation,v.map&&(x.map.value=v.map),v.alphaMap&&(x.alphaMap.value=v.alphaMap),v.alphaTest>0&&(x.alphaTest.value=v.alphaTest);let b;v.map?b=v.map:v.alphaMap&&(b=v.alphaMap),b!==void 0&&(b.matrixAutoUpdate===!0&&b.updateMatrix(),x.uvTransform.value.copy(b.matrix))}function c(x,v){x.specular.value.copy(v.specular),x.shininess.value=Math.max(v.shininess,1e-4)}function u(x,v){v.gradientMap&&(x.gradientMap.value=v.gradientMap)}function h(x,v){x.roughness.value=v.roughness,x.metalness.value=v.metalness,v.roughnessMap&&(x.roughnessMap.value=v.roughnessMap),v.metalnessMap&&(x.metalnessMap.value=v.metalnessMap),e.get(v).envMap&&(x.envMapIntensity.value=v.envMapIntensity)}function d(x,v,b){x.ior.value=v.ior,v.sheen>0&&(x.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),x.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(x.sheenColorMap.value=v.sheenColorMap),v.sheenRoughnessMap&&(x.sheenRoughnessMap.value=v.sheenRoughnessMap)),v.clearcoat>0&&(x.clearcoat.value=v.clearcoat,x.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(x.clearcoatMap.value=v.clearcoatMap),v.clearcoatRoughnessMap&&(x.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap),v.clearcoatNormalMap&&(x.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),x.clearcoatNormalMap.value=v.clearcoatNormalMap,v.side===La&&x.clearcoatNormalScale.value.negate())),v.iridescence>0&&(x.iridescence.value=v.iridescence,x.iridescenceIOR.value=v.iridescenceIOR,x.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],x.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(x.iridescenceMap.value=v.iridescenceMap),v.iridescenceThicknessMap&&(x.iridescenceThicknessMap.value=v.iridescenceThicknessMap)),v.transmission>0&&(x.transmission.value=v.transmission,x.transmissionSamplerMap.value=b.texture,x.transmissionSamplerSize.value.set(b.width,b.height),v.transmissionMap&&(x.transmissionMap.value=v.transmissionMap),x.thickness.value=v.thickness,v.thicknessMap&&(x.thicknessMap.value=v.thicknessMap),x.attenuationDistance.value=v.attenuationDistance,x.attenuationColor.value.copy(v.attenuationColor)),x.specularIntensity.value=v.specularIntensity,x.specularColor.value.copy(v.specularColor),v.specularIntensityMap&&(x.specularIntensityMap.value=v.specularIntensityMap),v.specularColorMap&&(x.specularColorMap.value=v.specularColorMap)}function p(x,v){v.matcap&&(x.matcap.value=v.matcap)}function g(x,v){x.referencePosition.value.copy(v.referencePosition),x.nearDistance.value=v.nearDistance,x.farDistance.value=v.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function dhe(t,e,i,r){let n={},s={},a=[],o=i.isWebGL2?t.getParameter(35375):0;function l(w,M){let E=M.program;r.uniformBlockBinding(w,E)}function c(w,M){let E=n[w.id];E===void 0&&(g(w),E=u(w),n[w.id]=E,w.addEventListener("dispose",v));let D=M.program;r.updateUBOMapping(w,D);let T=e.render.frame;s[w.id]!==T&&(d(w),s[w.id]=T)}function u(w){let M=h();w.__bindingPointIndex=M;let E=t.createBuffer(),D=w.__size,T=w.usage;return t.bindBuffer(35345,E),t.bufferData(35345,D,T),t.bindBuffer(35345,null),t.bindBufferBase(35345,M,E),E}function h(){for(let w=0;w<o;w++)if(a.indexOf(w)===-1)return a.push(w),w;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(w){let M=n[w.id],E=w.uniforms,D=w.__cache;t.bindBuffer(35345,M);for(let T=0,L=E.length;T<L;T++){let P=E[T];if(p(P,T,D)===!0){let R=P.__offset,O=Array.isArray(P.value)?P.value:[P.value],U=0;for(let F=0;F<O.length;F++){let V=O[F],k=x(V);typeof V=="number"?(P.__data[0]=V,t.bufferSubData(35345,R+U,P.__data)):V.isMatrix3?(P.__data[0]=V.elements[0],P.__data[1]=V.elements[1],P.__data[2]=V.elements[2],P.__data[3]=V.elements[0],P.__data[4]=V.elements[3],P.__data[5]=V.elements[4],P.__data[6]=V.elements[5],P.__data[7]=V.elements[0],P.__data[8]=V.elements[6],P.__data[9]=V.elements[7],P.__data[10]=V.elements[8],P.__data[11]=V.elements[0]):(V.toArray(P.__data,U),U+=k.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(35345,R,P.__data)}}t.bindBuffer(35345,null)}function p(w,M,E){let D=w.value;if(E[M]===void 0){if(typeof D=="number")E[M]=D;else{let T=Array.isArray(D)?D:[D],L=[];for(let P=0;P<T.length;P++)L.push(T[P].clone());E[M]=L}return!0}else if(typeof D=="number"){if(E[M]!==D)return E[M]=D,!0}else{let T=Array.isArray(E[M])?E[M]:[E[M]],L=Array.isArray(D)?D:[D];for(let P=0;P<T.length;P++){let R=T[P];if(R.equals(L[P])===!1)return R.copy(L[P]),!0}}return!1}function g(w){let M=w.uniforms,E=0,D=16,T=0;for(let L=0,P=M.length;L<P;L++){let R=M[L],O={boundary:0,storage:0},U=Array.isArray(R.value)?R.value:[R.value];for(let F=0,V=U.length;F<V;F++){let k=U[F],K=x(k);O.boundary+=K.boundary,O.storage+=K.storage}if(R.__data=new Float32Array(O.storage/Float32Array.BYTES_PER_ELEMENT),R.__offset=E,L>0){T=E%D;let F=D-T;T!==0&&F-O.boundary<0&&(E+=D-T,R.__offset=E)}E+=O.storage}return T=E%D,T>0&&(E+=D-T),w.__size=E,w.__cache={},this}function x(w){let M={boundary:0,storage:0};return typeof w=="number"?(M.boundary=4,M.storage=4):w.isVector2?(M.boundary=8,M.storage=8):w.isVector3||w.isColor?(M.boundary=16,M.storage=12):w.isVector4?(M.boundary=16,M.storage=16):w.isMatrix3?(M.boundary=48,M.storage=48):w.isMatrix4?(M.boundary=64,M.storage=64):w.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",w),M}function v(w){let M=w.target;M.removeEventListener("dispose",v);let E=a.indexOf(M.__bindingPointIndex);a.splice(E,1),t.deleteBuffer(n[M.id]),delete n[M.id],delete s[M.id]}function b(){for(let w in n)t.deleteBuffer(n[w]);a=[],n={},s={}}return{bind:l,update:c,dispose:b}}function fhe(){let t=Mw("canvas");return t.style.display="block",t}function _q(t={}){this.isWebGLRenderer=!0;let e=t.canvas!==void 0?t.canvas:fhe(),i=t.context!==void 0?t.context:null,r=t.depth!==void 0?t.depth:!0,n=t.stencil!==void 0?t.stencil:!0,s=t.antialias!==void 0?t.antialias:!1,a=t.premultipliedAlpha!==void 0?t.premultipliedAlpha:!0,o=t.preserveDrawingBuffer!==void 0?t.preserveDrawingBuffer:!1,l=t.powerPreference!==void 0?t.powerPreference:"default",c=t.failIfMajorPerformanceCaveat!==void 0?t.failIfMajorPerformanceCaveat:!1,u;i!==null?u=i.getContextAttributes().alpha:u=t.alpha!==void 0?t.alpha:!1;let h=null,d=null,p=[],g=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=vh,this.physicallyCorrectLights=!1,this.toneMapping=zd,this.toneMappingExposure=1;let x=this,v=!1,b=0,w=0,M=null,E=-1,D=null,T=new Ri,L=new Ri,P=null,R=e.width,O=e.height,U=1,F=null,V=null,k=new Ri(0,0,R,O),K=new Ri(0,0,R,O),X=!1,$=new bN,Y=!1,re=!1,G=null,j=new Ot,ee=new Oe,oe=new W,Q={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ae(){return M===null?U:1}let ne=i;function ue(_e,tt){for(let ct=0;ct<_e.length;ct++){let qe=_e[ct],it=e.getContext(qe,tt);if(it!==null)return it}return null}try{let _e={alpha:!0,depth:r,stencil:n,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${ab}`),e.addEventListener("webglcontextlost",ht,!1),e.addEventListener("webglcontextrestored",$e,!1),e.addEventListener("webglcontextcreationerror",St,!1),ne===null){let tt=["webgl2","webgl","experimental-webgl"];if(x.isWebGL1Renderer===!0&&tt.shift(),ne=ue(tt,_e),ne===null)throw ue(tt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}ne.getShaderPrecisionFormat===void 0&&(ne.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(_e){throw console.error("THREE.WebGLRenderer: "+_e.message),_e}let fe,xe,be,Ce,ge,Te,ce,Ue,ze,Xe,De,Ge,We,se,H,Z,pe,we,J,He,je,Ye,Ve,Ke;function at(){fe=new Ace(ne),xe=new bce(ne,fe,t),fe.init(xe),Ye=new ohe(ne,fe,xe),be=new she(ne,fe,xe),Ce=new Dce,ge=new que,Te=new ahe(ne,fe,be,ge,xe,Ye,Ce),ce=new Sce(x),Ue=new Ece(x),ze=new Nae(ne,xe),Ve=new yce(ne,fe,ze,xe),Xe=new Tce(ne,ze,Ce,Ve),De=new Lce(ne,Xe,ze,Ce),J=new Oce(ne,xe,Te),Z=new _ce(ge),Ge=new Wue(x,ce,Ue,fe,xe,Ve,Z),We=new hhe(x,ge),se=new Yue,H=new ehe(fe,xe),we=new vce(x,ce,Ue,be,De,u,a),pe=new nhe(x,De,xe),Ke=new dhe(ne,Ce,xe,be),He=new xce(ne,fe,Ce,xe),je=new Cce(ne,fe,Ce,xe),Ce.programs=Ge.programs,x.capabilities=xe,x.extensions=fe,x.properties=ge,x.renderLists=se,x.shadowMap=pe,x.state=be,x.info=Ce}at();let ut=new uhe(x,ne);this.xr=ut,this.getContext=function(){return ne},this.getContextAttributes=function(){return ne.getContextAttributes()},this.forceContextLoss=function(){let _e=fe.get("WEBGL_lose_context");_e&&_e.loseContext()},this.forceContextRestore=function(){let _e=fe.get("WEBGL_lose_context");_e&&_e.restoreContext()},this.getPixelRatio=function(){return U},this.setPixelRatio=function(_e){_e!==void 0&&(U=_e,this.setSize(R,O,!1))},this.getSize=function(_e){return _e.set(R,O)},this.setSize=function(_e,tt,ct){if(ut.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}R=_e,O=tt,e.width=Math.floor(_e*U),e.height=Math.floor(tt*U),ct!==!1&&(e.style.width=_e+"px",e.style.height=tt+"px"),this.setViewport(0,0,_e,tt)},this.getDrawingBufferSize=function(_e){return _e.set(R*U,O*U).floor()},this.setDrawingBufferSize=function(_e,tt,ct){R=_e,O=tt,U=ct,e.width=Math.floor(_e*ct),e.height=Math.floor(tt*ct),this.setViewport(0,0,_e,tt)},this.getCurrentViewport=function(_e){return _e.copy(T)},this.getViewport=function(_e){return _e.copy(k)},this.setViewport=function(_e,tt,ct,qe){_e.isVector4?k.set(_e.x,_e.y,_e.z,_e.w):k.set(_e,tt,ct,qe),be.viewport(T.copy(k).multiplyScalar(U).floor())},this.getScissor=function(_e){return _e.copy(K)},this.setScissor=function(_e,tt,ct,qe){_e.isVector4?K.set(_e.x,_e.y,_e.z,_e.w):K.set(_e,tt,ct,qe),be.scissor(L.copy(K).multiplyScalar(U).floor())},this.getScissorTest=function(){return X},this.setScissorTest=function(_e){be.setScissorTest(X=_e)},this.setOpaqueSort=function(_e){F=_e},this.setTransparentSort=function(_e){V=_e},this.getClearColor=function(_e){return _e.copy(we.getClearColor())},this.setClearColor=function(){we.setClearColor.apply(we,arguments)},this.getClearAlpha=function(){return we.getClearAlpha()},this.setClearAlpha=function(){we.setClearAlpha.apply(we,arguments)},this.clear=function(_e=!0,tt=!0,ct=!0){let qe=0;_e&&(qe|=16384),tt&&(qe|=256),ct&&(qe|=1024),ne.clear(qe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",ht,!1),e.removeEventListener("webglcontextrestored",$e,!1),e.removeEventListener("webglcontextcreationerror",St,!1),se.dispose(),H.dispose(),ge.dispose(),ce.dispose(),Ue.dispose(),De.dispose(),Ve.dispose(),Ke.dispose(),Ge.dispose(),ut.dispose(),ut.removeEventListener("sessionstart",Qe),ut.removeEventListener("sessionend",ot),G&&(G.dispose(),G=null),pt.stop()};function ht(_e){_e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function $e(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;let _e=Ce.autoReset,tt=pe.enabled,ct=pe.autoUpdate,qe=pe.needsUpdate,it=pe.type;at(),Ce.autoReset=_e,pe.enabled=tt,pe.autoUpdate=ct,pe.needsUpdate=qe,pe.type=it}function St(_e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",_e.statusMessage)}function Pt(_e){let tt=_e.target;tt.removeEventListener("dispose",Pt),Kt(tt)}function Kt(_e){le(_e),ge.remove(_e)}function le(_e){let tt=ge.get(_e).programs;tt!==void 0&&(tt.forEach(function(ct){Ge.releaseProgram(ct)}),_e.isShaderMaterial&&Ge.releaseShaderCache(_e))}this.renderBufferDirect=function(_e,tt,ct,qe,it,Gt){tt===null&&(tt=Q);let oi=it.isMesh&&it.matrixWorld.determinant()<0,gi=Dn(_e,tt,ct,qe,it);be.setMaterial(qe,oi);let ri=ct.index,Wi=1;qe.wireframe===!0&&(ri=Xe.getWireframeAttribute(ct),Wi=2);let mi=ct.drawRange,Mi=ct.attributes.position,hi=mi.start*Wi,de=(mi.start+mi.count)*Wi;Gt!==null&&(hi=Math.max(hi,Gt.start*Wi),de=Math.min(de,(Gt.start+Gt.count)*Wi)),ri!==null?(hi=Math.max(hi,0),de=Math.min(de,ri.count)):Mi!=null&&(hi=Math.max(hi,0),de=Math.min(de,Mi.count));let ke=de-hi;if(ke<0||ke===1/0)return;Ve.setup(it,qe,gi,ct,ri);let rt,Ie=He;if(ri!==null&&(rt=ze.get(ri),Ie=je,Ie.setIndex(rt)),it.isMesh)qe.wireframe===!0?(be.setLineWidth(qe.wireframeLinewidth*ae()),Ie.setMode(1)):Ie.setMode(4);else if(it.isLine){let Fe=qe.linewidth;Fe===void 0&&(Fe=1),be.setLineWidth(Fe*ae()),it.isLineSegments?Ie.setMode(1):it.isLineLoop?Ie.setMode(2):Ie.setMode(3)}else it.isPoints?Ie.setMode(0):it.isSprite&&Ie.setMode(4);if(it.isInstancedMesh)Ie.renderInstances(hi,ke,it.count);else if(ct.isInstancedBufferGeometry){let Fe=ct._maxInstanceCount!==void 0?ct._maxInstanceCount:1/0,Dt=Math.min(ct.instanceCount,Fe);Ie.renderInstances(hi,ke,Dt)}else Ie.render(hi,ke)},this.compile=function(_e,tt){function ct(qe,it,Gt){qe.transparent===!0&&qe.side===Oo&&qe.forceSinglePass===!1?(qe.side=La,qe.needsUpdate=!0,Oi(qe,it,Gt),qe.side=gh,qe.needsUpdate=!0,Oi(qe,it,Gt),qe.side=Oo):Oi(qe,it,Gt)}d=H.get(_e),d.init(),g.push(d),_e.traverseVisible(function(qe){qe.isLight&&qe.layers.test(tt.layers)&&(d.pushLight(qe),qe.castShadow&&d.pushShadow(qe))}),d.setupLights(x.physicallyCorrectLights),_e.traverse(function(qe){let it=qe.material;if(it)if(Array.isArray(it))for(let Gt=0;Gt<it.length;Gt++){let oi=it[Gt];ct(oi,_e,qe)}else ct(it,_e,qe)}),g.pop(),d=null};let Re=null;function Ee(_e){Re&&Re(_e)}function Qe(){pt.stop()}function ot(){pt.start()}let pt=new mq;pt.setAnimationLoop(Ee),typeof self<"u"&&pt.setContext(self),this.setAnimationLoop=function(_e){Re=_e,ut.setAnimationLoop(_e),_e===null?pt.stop():pt.start()},ut.addEventListener("sessionstart",Qe),ut.addEventListener("sessionend",ot),this.render=function(_e,tt){if(tt!==void 0&&tt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(v===!0)return;_e.matrixWorldAutoUpdate===!0&&_e.updateMatrixWorld(),tt.parent===null&&tt.matrixWorldAutoUpdate===!0&&tt.updateMatrixWorld(),ut.enabled===!0&&ut.isPresenting===!0&&(ut.cameraAutoUpdate===!0&&ut.updateCamera(tt),tt=ut.getCamera()),_e.isScene===!0&&_e.onBeforeRender(x,_e,tt,M),d=H.get(_e,g.length),d.init(),g.push(d),j.multiplyMatrices(tt.projectionMatrix,tt.matrixWorldInverse),$.setFromProjectionMatrix(j),re=this.localClippingEnabled,Y=Z.init(this.clippingPlanes,re),h=se.get(_e,p.length),h.init(),p.push(h),Bt(_e,tt,0,x.sortObjects),h.finish(),x.sortObjects===!0&&h.sort(F,V),Y===!0&&Z.beginShadows();let ct=d.state.shadowsArray;if(pe.render(ct,_e,tt),Y===!0&&Z.endShadows(),this.info.autoReset===!0&&this.info.reset(),we.render(h,_e),d.setupLights(x.physicallyCorrectLights),tt.isArrayCamera){let qe=tt.cameras;for(let it=0,Gt=qe.length;it<Gt;it++){let oi=qe[it];Jt(h,_e,oi,oi.viewport)}}else Jt(h,_e,tt);M!==null&&(Te.updateMultisampleRenderTarget(M),Te.updateRenderTargetMipmap(M)),_e.isScene===!0&&_e.onAfterRender(x,_e,tt),Ve.resetDefaultState(),E=-1,D=null,g.pop(),g.length>0?d=g[g.length-1]:d=null,p.pop(),p.length>0?h=p[p.length-1]:h=null};function Bt(_e,tt,ct,qe){if(_e.visible===!1)return;if(_e.layers.test(tt.layers)){if(_e.isGroup)ct=_e.renderOrder;else if(_e.isLOD)_e.autoUpdate===!0&&_e.update(tt);else if(_e.isLight)d.pushLight(_e),_e.castShadow&&d.pushShadow(_e);else if(_e.isSprite){if(!_e.frustumCulled||$.intersectsSprite(_e)){qe&&oe.setFromMatrixPosition(_e.matrixWorld).applyMatrix4(j);let Gt=De.update(_e),oi=_e.material;oi.visible&&h.push(_e,Gt,oi,ct,oe.z,null)}}else if((_e.isMesh||_e.isLine||_e.isPoints)&&(_e.isSkinnedMesh&&_e.skeleton.frame!==Ce.render.frame&&(_e.skeleton.update(),_e.skeleton.frame=Ce.render.frame),!_e.frustumCulled||$.intersectsObject(_e))){qe&&oe.setFromMatrixPosition(_e.matrixWorld).applyMatrix4(j);let Gt=De.update(_e),oi=_e.material;if(Array.isArray(oi)){let gi=Gt.groups;for(let ri=0,Wi=gi.length;ri<Wi;ri++){let mi=gi[ri],Mi=oi[mi.materialIndex];Mi&&Mi.visible&&h.push(_e,Gt,Mi,ct,oe.z,mi)}}else oi.visible&&h.push(_e,Gt,oi,ct,oe.z,null)}}let it=_e.children;for(let Gt=0,oi=it.length;Gt<oi;Gt++)Bt(it[Gt],tt,ct,qe)}function Jt(_e,tt,ct,qe){let it=_e.opaque,Gt=_e.transmissive,oi=_e.transparent;d.setupLightsView(ct),Y===!0&&Z.setGlobalState(x.clippingPlanes,ct),Gt.length>0&&qt(it,tt,ct),qe&&be.viewport(T.copy(qe)),it.length>0&&Ft(it,tt,ct),Gt.length>0&&Ft(Gt,tt,ct),oi.length>0&&Ft(oi,tt,ct),be.buffers.depth.setTest(!0),be.buffers.depth.setMask(!0),be.buffers.color.setMask(!0),be.setPolygonOffset(!1)}function qt(_e,tt,ct){let qe=xe.isWebGL2;G===null&&(G=new yr(1,1,{generateMipmaps:!0,type:fe.has("EXT_color_buffer_half_float")?Ap:zo,minFilter:P1,samples:qe&&s===!0?4:0})),x.getDrawingBufferSize(ee),qe?G.setSize(ee.x,ee.y):G.setSize(TC(ee.x),TC(ee.y));let it=x.getRenderTarget();x.setRenderTarget(G),x.clear();let Gt=x.toneMapping;x.toneMapping=zd,Ft(_e,tt,ct),x.toneMapping=Gt,Te.updateMultisampleRenderTarget(G),Te.updateRenderTargetMipmap(G),x.setRenderTarget(it)}function Ft(_e,tt,ct){let qe=tt.isScene===!0?tt.overrideMaterial:null;for(let it=0,Gt=_e.length;it<Gt;it++){let oi=_e[it],gi=oi.object,ri=oi.geometry,Wi=qe===null?oi.material:qe,mi=oi.group;gi.layers.test(ct.layers)&&Ni(gi,tt,ct,ri,Wi,mi)}}function Ni(_e,tt,ct,qe,it,Gt){_e.onBeforeRender(x,tt,ct,qe,it,Gt),_e.modelViewMatrix.multiplyMatrices(ct.matrixWorldInverse,_e.matrixWorld),_e.normalMatrix.getNormalMatrix(_e.modelViewMatrix),it.onBeforeRender(x,tt,ct,qe,_e,Gt),it.transparent===!0&&it.side===Oo&&it.forceSinglePass===!1?(it.side=La,it.needsUpdate=!0,x.renderBufferDirect(ct,tt,qe,it,_e,Gt),it.side=gh,it.needsUpdate=!0,x.renderBufferDirect(ct,tt,qe,it,_e,Gt),it.side=Oo):x.renderBufferDirect(ct,tt,qe,it,_e,Gt),_e.onAfterRender(x,tt,ct,qe,it,Gt)}function Oi(_e,tt,ct){tt.isScene!==!0&&(tt=Q);let qe=ge.get(_e),it=d.state.lights,Gt=d.state.shadowsArray,oi=it.state.version,gi=Ge.getParameters(_e,it.state,Gt,tt,ct),ri=Ge.getProgramCacheKey(gi),Wi=qe.programs;qe.environment=_e.isMeshStandardMaterial?tt.environment:null,qe.fog=tt.fog,qe.envMap=(_e.isMeshStandardMaterial?Ue:ce).get(_e.envMap||qe.environment),Wi===void 0&&(_e.addEventListener("dispose",Pt),Wi=new Map,qe.programs=Wi);let mi=Wi.get(ri);if(mi!==void 0){if(qe.currentProgram===mi&&qe.lightsStateVersion===oi)return Tr(_e,gi),mi}else gi.uniforms=Ge.getUniforms(_e),_e.onBuild(ct,gi,x),_e.onBeforeCompile(gi,x),mi=Ge.acquireProgram(gi,ri),Wi.set(ri,mi),qe.uniforms=gi.uniforms;let Mi=qe.uniforms;(!_e.isShaderMaterial&&!_e.isRawShaderMaterial||_e.clipping===!0)&&(Mi.clippingPlanes=Z.uniform),Tr(_e,gi),qe.needsLights=Fr(_e),qe.lightsStateVersion=oi,qe.needsLights&&(Mi.ambientLightColor.value=it.state.ambient,Mi.lightProbe.value=it.state.probe,Mi.directionalLights.value=it.state.directional,Mi.directionalLightShadows.value=it.state.directionalShadow,Mi.spotLights.value=it.state.spot,Mi.spotLightShadows.value=it.state.spotShadow,Mi.rectAreaLights.value=it.state.rectArea,Mi.ltc_1.value=it.state.rectAreaLTC1,Mi.ltc_2.value=it.state.rectAreaLTC2,Mi.pointLights.value=it.state.point,Mi.pointLightShadows.value=it.state.pointShadow,Mi.hemisphereLights.value=it.state.hemi,Mi.directionalShadowMap.value=it.state.directionalShadowMap,Mi.directionalShadowMatrix.value=it.state.directionalShadowMatrix,Mi.spotShadowMap.value=it.state.spotShadowMap,Mi.spotLightMatrix.value=it.state.spotLightMatrix,Mi.spotLightMap.value=it.state.spotLightMap,Mi.pointShadowMap.value=it.state.pointShadowMap,Mi.pointShadowMatrix.value=it.state.pointShadowMatrix);let hi=mi.getUniforms(),de=XT.seqWithValue(hi.seq,Mi);return qe.currentProgram=mi,qe.uniformsList=de,mi}function Tr(_e,tt){let ct=ge.get(_e);ct.outputEncoding=tt.outputEncoding,ct.instancing=tt.instancing,ct.skinning=tt.skinning,ct.morphTargets=tt.morphTargets,ct.morphNormals=tt.morphNormals,ct.morphColors=tt.morphColors,ct.morphTargetsCount=tt.morphTargetsCount,ct.numClippingPlanes=tt.numClippingPlanes,ct.numIntersection=tt.numClipIntersection,ct.vertexAlphas=tt.vertexAlphas,ct.vertexTangents=tt.vertexTangents,ct.toneMapping=tt.toneMapping}function Dn(_e,tt,ct,qe,it){tt.isScene!==!0&&(tt=Q),Te.resetTextureUnits();let Gt=tt.fog,oi=qe.isMeshStandardMaterial?tt.environment:null,gi=M===null?x.outputEncoding:M.isXRRenderTarget===!0?M.texture.encoding:vh,ri=(qe.isMeshStandardMaterial?Ue:ce).get(qe.envMap||oi),Wi=qe.vertexColors===!0&&!!ct.attributes.color&&ct.attributes.color.itemSize===4,mi=!!qe.normalMap&&!!ct.attributes.tangent,Mi=!!ct.morphAttributes.position,hi=!!ct.morphAttributes.normal,de=!!ct.morphAttributes.color,ke=qe.toneMapped?x.toneMapping:zd,rt=ct.morphAttributes.position||ct.morphAttributes.normal||ct.morphAttributes.color,Ie=rt!==void 0?rt.length:0,Fe=ge.get(qe),Dt=d.state.lights;if(Y===!0&&(re===!0||_e!==D)){let me=_e===D&&qe.id===E;Z.setState(qe,_e,me)}let xt=!1;qe.version===Fe.__version?(Fe.needsLights&&Fe.lightsStateVersion!==Dt.state.version||Fe.outputEncoding!==gi||it.isInstancedMesh&&Fe.instancing===!1||!it.isInstancedMesh&&Fe.instancing===!0||it.isSkinnedMesh&&Fe.skinning===!1||!it.isSkinnedMesh&&Fe.skinning===!0||Fe.envMap!==ri||qe.fog===!0&&Fe.fog!==Gt||Fe.numClippingPlanes!==void 0&&(Fe.numClippingPlanes!==Z.numPlanes||Fe.numIntersection!==Z.numIntersection)||Fe.vertexAlphas!==Wi||Fe.vertexTangents!==mi||Fe.morphTargets!==Mi||Fe.morphNormals!==hi||Fe.morphColors!==de||Fe.toneMapping!==ke||xe.isWebGL2===!0&&Fe.morphTargetsCount!==Ie)&&(xt=!0):(xt=!0,Fe.__version=qe.version);let Nt=Fe.currentProgram;xt===!0&&(Nt=Oi(qe,tt,it));let kt=!1,li=!1,ii=!1,te=Nt.getUniforms(),he=Fe.uniforms;if(be.useProgram(Nt.program)&&(kt=!0,li=!0,ii=!0),qe.id!==E&&(E=qe.id,li=!0),kt||D!==_e){if(te.setValue(ne,"projectionMatrix",_e.projectionMatrix),xe.logarithmicDepthBuffer&&te.setValue(ne,"logDepthBufFC",2/(Math.log(_e.far+1)/Math.LN2)),D!==_e&&(D=_e,li=!0,ii=!0),qe.isShaderMaterial||qe.isMeshPhongMaterial||qe.isMeshToonMaterial||qe.isMeshStandardMaterial||qe.envMap){let me=te.map.cameraPosition;me!==void 0&&me.setValue(ne,oe.setFromMatrixPosition(_e.matrixWorld))}(qe.isMeshPhongMaterial||qe.isMeshToonMaterial||qe.isMeshLambertMaterial||qe.isMeshBasicMaterial||qe.isMeshStandardMaterial||qe.isShaderMaterial)&&te.setValue(ne,"isOrthographic",_e.isOrthographicCamera===!0),(qe.isMeshPhongMaterial||qe.isMeshToonMaterial||qe.isMeshLambertMaterial||qe.isMeshBasicMaterial||qe.isMeshStandardMaterial||qe.isShaderMaterial||qe.isShadowMaterial||it.isSkinnedMesh)&&te.setValue(ne,"viewMatrix",_e.matrixWorldInverse)}if(it.isSkinnedMesh){te.setOptional(ne,it,"bindMatrix"),te.setOptional(ne,it,"bindMatrixInverse");let me=it.skeleton;me&&(xe.floatVertexTextures?(me.boneTexture===null&&me.computeBoneTexture(),te.setValue(ne,"boneTexture",me.boneTexture,Te),te.setValue(ne,"boneTextureSize",me.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let Ae=ct.morphAttributes;if((Ae.position!==void 0||Ae.normal!==void 0||Ae.color!==void 0&&xe.isWebGL2===!0)&&J.update(it,ct,qe,Nt),(li||Fe.receiveShadow!==it.receiveShadow)&&(Fe.receiveShadow=it.receiveShadow,te.setValue(ne,"receiveShadow",it.receiveShadow)),qe.isMeshGouraudMaterial&&qe.envMap!==null&&(he.envMap.value=ri,he.flipEnvMap.value=ri.isCubeTexture&&ri.isRenderTargetTexture===!1?-1:1),li&&(te.setValue(ne,"toneMappingExposure",x.toneMappingExposure),Fe.needsLights&&pn(he,ii),Gt&&qe.fog===!0&&We.refreshFogUniforms(he,Gt),We.refreshMaterialUniforms(he,qe,U,O,G),XT.upload(ne,Fe.uniformsList,he,Te)),qe.isShaderMaterial&&qe.uniformsNeedUpdate===!0&&(XT.upload(ne,Fe.uniformsList,he,Te),qe.uniformsNeedUpdate=!1),qe.isSpriteMaterial&&te.setValue(ne,"center",it.center),te.setValue(ne,"modelViewMatrix",it.modelViewMatrix),te.setValue(ne,"normalMatrix",it.normalMatrix),te.setValue(ne,"modelMatrix",it.matrixWorld),it.previousModelViewMatrix&&te.setValue(ne,"previousModelViewMatrix",it.previousModelViewMatrix),_e.previousProjectionMatrix&&te.setValue(ne,"previousProjectionMatrix",_e.previousProjectionMatrix),qe.isShaderMaterial||qe.isRawShaderMaterial){let me=qe.uniformsGroups;for(let Ne=0,mt=me.length;Ne<mt;Ne++)if(xe.isWebGL2){let ei=me[Ne];Ke.update(ei,Nt),Ke.bind(ei,Nt)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Nt}function pn(_e,tt){_e.ambientLightColor.needsUpdate=tt,_e.lightProbe.needsUpdate=tt,_e.directionalLights.needsUpdate=tt,_e.directionalLightShadows.needsUpdate=tt,_e.pointLights.needsUpdate=tt,_e.pointLightShadows.needsUpdate=tt,_e.spotLights.needsUpdate=tt,_e.spotLightShadows.needsUpdate=tt,_e.rectAreaLights.needsUpdate=tt,_e.hemisphereLights.needsUpdate=tt}function Fr(_e){return _e.isMeshLambertMaterial||_e.isMeshToonMaterial||_e.isMeshPhongMaterial||_e.isMeshStandardMaterial||_e.isShadowMaterial||_e.isShaderMaterial&&_e.lights===!0}this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(_e,tt,ct){ge.get(_e.texture).__webglTexture=tt,ge.get(_e.depthTexture).__webglTexture=ct;let qe=ge.get(_e);qe.__hasExternalTextures=!0,qe.__hasExternalTextures&&(qe.__autoAllocateDepthBuffer=ct===void 0,qe.__autoAllocateDepthBuffer||fe.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),qe.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(_e,tt){let ct=ge.get(_e);ct.__webglFramebuffer=tt,ct.__useDefaultFramebuffer=tt===void 0},this.setRenderTarget=function(_e,tt=0,ct=0){M=_e,b=tt,w=ct;let qe=!0,it=null,Gt=!1,oi=!1;if(_e){let gi=ge.get(_e);gi.__useDefaultFramebuffer!==void 0?(be.bindFramebuffer(36160,null),qe=!1):gi.__webglFramebuffer===void 0?Te.setupRenderTarget(_e):gi.__hasExternalTextures&&Te.rebindTextures(_e,ge.get(_e.texture).__webglTexture,ge.get(_e.depthTexture).__webglTexture);let ri=_e.texture;(ri.isData3DTexture||ri.isDataArrayTexture||ri.isCompressedArrayTexture)&&(oi=!0);let Wi=ge.get(_e).__webglFramebuffer;_e.isWebGLCubeRenderTarget?(it=Wi[tt],Gt=!0):xe.isWebGL2&&_e.samples>0&&Te.useMultisampledRTT(_e)===!1?it=ge.get(_e).__webglMultisampledFramebuffer:it=Wi,T.copy(_e.viewport),L.copy(_e.scissor),P=_e.scissorTest}else T.copy(k).multiplyScalar(U).floor(),L.copy(K).multiplyScalar(U).floor(),P=X;if(be.bindFramebuffer(36160,it)&&xe.drawBuffers&&qe&&be.drawBuffers(_e,it),be.viewport(T),be.scissor(L),be.setScissorTest(P),Gt){let gi=ge.get(_e.texture);ne.framebufferTexture2D(36160,36064,34069+tt,gi.__webglTexture,ct)}else if(oi){let gi=ge.get(_e.texture),ri=tt||0;ne.framebufferTextureLayer(36160,36064,gi.__webglTexture,ct||0,ri)}E=-1},this.readRenderTargetPixels=function(_e,tt,ct,qe,it,Gt,oi){if(!(_e&&_e.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let gi=ge.get(_e).__webglFramebuffer;if(_e.isWebGLCubeRenderTarget&&oi!==void 0&&(gi=gi[oi]),gi){be.bindFramebuffer(36160,gi);try{let ri=_e.texture,Wi=ri.format,mi=ri.type;if(Wi!==kn&&Ye.convert(Wi)!==ne.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let Mi=mi===Ap&&(fe.has("EXT_color_buffer_half_float")||xe.isWebGL2&&fe.has("EXT_color_buffer_float"));if(mi!==zo&&Ye.convert(mi)!==ne.getParameter(35738)&&!(mi===rn&&(xe.isWebGL2||fe.has("OES_texture_float")||fe.has("WEBGL_color_buffer_float")))&&!Mi){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}tt>=0&&tt<=_e.width-qe&&ct>=0&&ct<=_e.height-it&&ne.readPixels(tt,ct,qe,it,Ye.convert(Wi),Ye.convert(mi),Gt)}finally{let ri=M!==null?ge.get(M).__webglFramebuffer:null;be.bindFramebuffer(36160,ri)}}},this.readRenderTargetPixelsAsync=async function(_e,tt,ct,qe,it,Gt,oi){if(!(_e&&_e.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let gi=ge.get(_e).__webglFramebuffer;if(_e.isWebGLCubeRenderTarget&&oi!==void 0&&(gi=gi[oi]),gi){let ri=_e.texture,Wi=ri.format,mi=ri.type;if(tt>=0&&tt<=_e.width-qe&&ct>=0&&ct<=_e.height-it){be.bindFramebuffer(ne.FRAMEBUFFER,gi);let Mi=ne.createBuffer();ne.bindBuffer(ne.PIXEL_PACK_BUFFER,Mi),ne.bufferData(ne.PIXEL_PACK_BUFFER,Gt.byteLength,ne.STREAM_READ),ne.readPixels(tt,ct,qe,it,Ye.convert(Wi),Ye.convert(mi),0);let hi=M!==null?ge.get(M).__webglFramebuffer:null;be.bindFramebuffer(ne.FRAMEBUFFER,hi);let de=ne.fenceSync(ne.SYNC_GPU_COMMANDS_COMPLETE,0);return ne.flush(),await yae(ne,de,4),ne.bindBuffer(ne.PIXEL_PACK_BUFFER,Mi),ne.getBufferSubData(ne.PIXEL_PACK_BUFFER,0,Gt),ne.deleteBuffer(Mi),ne.deleteSync(de),Gt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(_e,tt,ct=0){let qe=Math.pow(2,-ct),it=Math.floor(tt.image.width*qe),Gt=Math.floor(tt.image.height*qe);Te.setTexture2D(tt,0),ne.copyTexSubImage2D(3553,ct,0,0,_e.x,_e.y,it,Gt),be.unbindTexture()},this.copyTextureToTexture=function(_e,tt,ct,qe=0){let it=tt.image.width,Gt=tt.image.height,oi=Ye.convert(ct.format),gi=Ye.convert(ct.type);Te.setTexture2D(ct,0),ne.pixelStorei(37440,ct.flipY),ne.pixelStorei(37441,ct.premultiplyAlpha),ne.pixelStorei(3317,ct.unpackAlignment),tt.isDataTexture?ne.texSubImage2D(3553,qe,_e.x,_e.y,it,Gt,oi,gi,tt.image.data):tt.isCompressedTexture?ne.compressedTexSubImage2D(3553,qe,_e.x,_e.y,tt.mipmaps[0].width,tt.mipmaps[0].height,oi,tt.mipmaps[0].data):ne.texSubImage2D(3553,qe,_e.x,_e.y,oi,gi,tt.image),qe===0&&ct.generateMipmaps&&ne.generateMipmap(3553),be.unbindTexture()},this.copyTextureToTexture3D=function(_e,tt,ct,qe,it=0){if(x.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let Gt=_e.max.x-_e.min.x+1,oi=_e.max.y-_e.min.y+1,gi=_e.max.z-_e.min.z+1,ri=Ye.convert(qe.format),Wi=Ye.convert(qe.type),mi;if(qe.isData3DTexture)Te.setTexture3D(qe,0),mi=32879;else if(qe.isDataArrayTexture)Te.setTexture2DArray(qe,0),mi=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}ne.pixelStorei(37440,qe.flipY),ne.pixelStorei(37441,qe.premultiplyAlpha),ne.pixelStorei(3317,qe.unpackAlignment);let Mi=ne.getParameter(3314),hi=ne.getParameter(32878),de=ne.getParameter(3316),ke=ne.getParameter(3315),rt=ne.getParameter(32877),Ie=ct.isCompressedTexture?ct.mipmaps[0]:ct.image;ne.pixelStorei(3314,Ie.width),ne.pixelStorei(32878,Ie.height),ne.pixelStorei(3316,_e.min.x),ne.pixelStorei(3315,_e.min.y),ne.pixelStorei(32877,_e.min.z),ct.isDataTexture||ct.isData3DTexture?ne.texSubImage3D(mi,it,tt.x,tt.y,tt.z,Gt,oi,gi,ri,Wi,Ie.data):ct.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ne.compressedTexSubImage3D(mi,it,tt.x,tt.y,tt.z,Gt,oi,gi,ri,Ie.data)):ne.texSubImage3D(mi,it,tt.x,tt.y,tt.z,Gt,oi,gi,ri,Wi,Ie),ne.pixelStorei(3314,Mi),ne.pixelStorei(32878,hi),ne.pixelStorei(3316,de),ne.pixelStorei(3315,ke),ne.pixelStorei(32877,rt),it===0&&qe.generateMipmaps&&ne.generateMipmap(mi),be.unbindTexture()},this.initRenderTarget=function(_e){ge.get(_e).__webglFramebuffer===void 0&&Te.setupRenderTarget(_e)},this.initTexture=function(_e){_e.isCubeTexture?Te.setTextureCube(_e,0):_e.isData3DTexture?Te.setTexture3D(_e,0):_e.isDataArrayTexture||_e.isCompressedArrayTexture?Te.setTexture2DArray(_e,0):Te.setTexture2D(_e,0),be.unbindTexture()},this.resetState=function(){b=0,w=0,M=null,be.reset(),Ve.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var phe=class extends _q{};phe.prototype.isWebGL1Renderer=!0;var Sq=class{constructor(t,e=1,i=1e3){this.isFog=!0,this.name="",this.color=new bi(t),this.near=e,this.far=i}clone(){return new Sq(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},ql=class extends Kr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){let e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(t){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=t}},mhe=class{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=Cz,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ru()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let r=0,n=this.stride;r<n;r++)this.array[t+r]=e.array[i+r];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ru()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ru()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},Zo=new W,Lz=class{constructor(t,e,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)Zo.fromBufferAttribute(this,e),Zo.applyMatrix4(t),this.setXYZ(e,Zo.x,Zo.y,Zo.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Zo.fromBufferAttribute(this,e),Zo.applyNormalMatrix(t),this.setXYZ(e,Zo.x,Zo.y,Zo.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Zo.fromBufferAttribute(this,e),Zo.transformDirection(t),this.setXYZ(e,Zo.x,Zo.y,Zo.z);return this}setX(t,e){return this.normalized&&(e=xn(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=xn(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=xn(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=xn(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=mp(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=mp(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=mp(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=mp(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=xn(e,this.array),i=xn(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=xn(e,this.array),i=xn(i,this.array),r=xn(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this}setXYZW(t,e,i,r,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=xn(e,this.array),i=xn(i,this.array),r=xn(r,this.array),n=xn(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this.data.array[t+3]=n,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[r+n])}return new _i(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Lz(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[r+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},wq=class extends Kr{constructor(){super(),this.isBone=!0,this.type="Bone"}},al=class extends ns{constructor(t=null,e=1,i=1,r,n,s,a,o,l=nr,c=nr,u,h){super(null,s,a,o,l,c,r,n,u,h),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},bV=new Ot,ghe=new Ot,SN=class{constructor(t=[],e=[]){this.uuid=ru(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),e.length===0)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new Ot)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){let i=new Ot;this.bones[t]&&i.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){let i=this.bones[t];i&&i.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){let i=this.bones[t];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let t=this.bones,e=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let n=0,s=t.length;n<s;n++){let a=t[n]?t[n].matrixWorld:ghe;bV.multiplyMatrices(a,e[n]),bV.toArray(i,n*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new SN(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=aq(t),t=Math.max(t,4);let e=new Float32Array(t*t*4);e.set(this.boneMatrices);let i=new al(e,t,t,kn,rn);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){let r=this.bones[e];if(r.name===t)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,r=t.bones.length;i<r;i++){let n=t.bones[i],s=e[n];s===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),s=new wq),this.bones.push(s),this.boneInverses.push(new Ot().fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){let t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;let e=this.bones,i=this.boneInverses;for(let r=0,n=e.length;r<n;r++){let s=e[r];t.bones.push(s.uuid);let a=i[r];t.boneInverses.push(a.toArray())}return t}},Ew=class extends _i{constructor(t,e,i,r=1){super(t,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){let t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}},_V=new Ot,SV=new Ot,NA=[],vhe=new Ot,Q_=new bn,yhe=class extends bn{constructor(t,e,i){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new Ew(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let r=0;r<i;r++)this.setMatrixAt(r,vhe)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}raycast(t,e){let i=this.matrixWorld,r=this.count;if(Q_.geometry=this.geometry,Q_.material=this.material,Q_.material!==void 0)for(let n=0;n<r;n++){this.getMatrixAt(n,_V),SV.multiplyMatrices(i,_V),Q_.matrixWorld=SV,Q_.raycast(t,NA);for(let s=0,a=NA.length;s<a;s++){let o=NA[s];o.instanceId=n,o.object=this,e.push(o)}NA.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new Ew(new Float32Array(this.instanceMatrix.count*3),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},Rg=class extends xM{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new bi(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}},wV=new W,MV=new W,EV=new Ot,bO=new ob,FA=new Xl,CC=class extends Kr{constructor(t=new ni,e=new Rg){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){let t=this.geometry;if(t.index===null){let e=t.attributes.position,i=[0];for(let r=1,n=e.count;r<n;r++)wV.fromBufferAttribute(e,r-1),MV.fromBufferAttribute(e,r),i[r]=i[r-1],i[r]+=wV.distanceTo(MV);t.setAttribute("lineDistance",new Wt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){let i=this.geometry,r=this.matrixWorld,n=t.params.Line.threshold,s=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),FA.copy(i.boundingSphere),FA.applyMatrix4(r),FA.radius+=n,t.ray.intersectsSphere(FA)===!1)return;EV.copy(r).invert(),bO.copy(t.ray).applyMatrix4(EV);let a=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new W,c=new W,u=new W,h=new W,d=this.isLineSegments?2:1,p=i.index,g=i.attributes.position;if(p!==null){let x=Math.max(0,s.start),v=Math.min(p.count,s.start+s.count);for(let b=x,w=v-1;b<w;b+=d){let M=p.getX(b),E=p.getX(b+1);if(l.fromBufferAttribute(g,M),c.fromBufferAttribute(g,E),bO.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);let D=t.ray.origin.distanceTo(h);D<t.near||D>t.far||e.push({distance:D,point:u.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}else{let x=Math.max(0,s.start),v=Math.min(g.count,s.start+s.count);for(let b=x,w=v-1;b<w;b+=d){if(l.fromBufferAttribute(g,b),c.fromBufferAttribute(g,b+1),bO.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);let M=t.ray.origin.distanceTo(h);M<t.near||M>t.far||e.push({distance:M,point:u.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){let i=t[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}},AV=new W,TV=new W,bM=class extends CC{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let t=this.geometry;if(t.index===null){let e=t.attributes.position,i=[];for(let r=0,n=e.count;r<n;r+=2)AV.fromBufferAttribute(e,r),TV.fromBufferAttribute(e,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+AV.distanceTo(TV);t.setAttribute("lineDistance",new Wt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},xhe=class extends ns{constructor(t,e,i,r,n,s,a,o,l){super(t,e,i,r,n,s,a,o,l),this.isVideoTexture=!0,this.minFilter=s!==void 0?s:Ki,this.magFilter=n!==void 0?n:Ki,this.generateMipmaps=!1;let c=this;function u(){c.needsUpdate=!0,t.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){let t=this.image;!("requestVideoFrameCallback"in t)&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},bhe=class extends ns{constructor(t,e,i,r,n,s,a,o,l){super(t,e,i,r,n,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},$d=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){let i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){let e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){let e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){let t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let e=[],i,r=this.getPoint(0),n=0;e.push(0);for(let s=1;s<=t;s++)i=this.getPoint(s/t),n+=i.distanceTo(r),e.push(n),r=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){let i=this.getLengths(),r=0,n=i.length,s;e?s=e:s=t*i[n-1];let a=0,o=n-1,l;for(;a<=o;)if(r=Math.floor(a+(o-a)/2),l=i[r]-s,l<0)a=r+1;else if(l>0)o=r-1;else{o=r;break}if(r=o,i[r]===s)return r/(n-1);let c=i[r],u=i[r+1]-c,h=(s-c)/u;return(r+h)/(n-1)}getTangent(t,e){let i=t-1e-4,r=t+1e-4;i<0&&(i=0),r>1&&(r=1);let n=this.getPoint(i),s=this.getPoint(r),a=e||(n.isVector2?new Oe:new W);return a.copy(s).sub(n).normalize(),a}getTangentAt(t,e){let i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){let i=new W,r=[],n=[],s=[],a=new W,o=new Ot;for(let d=0;d<=t;d++){let p=d/t;r[d]=this.getTangentAt(p,new W)}n[0]=new W,s[0]=new W;let l=Number.MAX_VALUE,c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,i.set(1,0,0)),u<=l&&(l=u,i.set(0,1,0)),h<=l&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),n[0].crossVectors(r[0],a),s[0].crossVectors(r[0],n[0]);for(let d=1;d<=t;d++){if(n[d]=n[d-1].clone(),s[d]=s[d-1].clone(),a.crossVectors(r[d-1],r[d]),a.length()>Number.EPSILON){a.normalize();let p=Math.acos(ks(r[d-1].dot(r[d]),-1,1));n[d].applyMatrix4(o.makeRotationAxis(a,p))}s[d].crossVectors(r[d],n[d])}if(e===!0){let d=Math.acos(ks(n[0].dot(n[t]),-1,1));d/=t,r[0].dot(a.crossVectors(n[0],n[t]))>0&&(d=-d);for(let p=1;p<=t;p++)n[p].applyMatrix4(o.makeRotationAxis(r[p],d*p)),s[p].crossVectors(r[p],n[p])}return{tangents:r,normals:n,binormals:s}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){let t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}},L3=class extends $d{constructor(t=0,e=0,i=1,r=1,n=0,s=Math.PI*2,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(t,e){let i=e||new Oe,r=Math.PI*2,n=this.aEndAngle-this.aStartAngle,s=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(s?n=0:n=r),this.aClockwise===!0&&!s&&(n===r?n=-r:n=n-r);let a=this.aStartAngle+t*n,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=o-this.aX,d=l-this.aY;o=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return i.set(o,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){let t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}},_he=class extends L3{constructor(t,e,i,r,n,s){super(t,e,i,i,r,n,s),this.isArcCurve=!0,this.type="ArcCurve"}};function wN(){let t=0,e=0,i=0,r=0;function n(s,a,o,l){t=s,e=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){n(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,u,h){let d=(a-s)/c-(o-s)/(c+u)+(o-a)/u,p=(o-a)/u-(l-a)/(u+h)+(l-o)/h;d*=u,p*=u,n(a,o,d,p)},calc:function(s){let a=s*s,o=a*s;return t+e*s+i*a+r*o}}}var kA=new W,_O=new wN,SO=new wN,wO=new wN,She=class extends $d{constructor(t=[],e=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=r}getPoint(t,e=new W){let i=e,r=this.points,n=r.length,s=(n-(this.closed?0:1))*t,a=Math.floor(s),o=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/n)+1)*n:o===0&&a===n-1&&(a=n-2,o=1);let l,c;this.closed||a>0?l=r[(a-1)%n]:(kA.subVectors(r[0],r[1]).add(r[0]),l=kA);let u=r[a%n],h=r[(a+1)%n];if(this.closed||a+2<n?c=r[(a+2)%n]:(kA.subVectors(r[n-1],r[n-2]).add(r[n-1]),c=kA),this.curveType==="centripetal"||this.curveType==="chordal"){let d=this.curveType==="chordal"?.5:.25,p=Math.pow(l.distanceToSquared(u),d),g=Math.pow(u.distanceToSquared(h),d),x=Math.pow(h.distanceToSquared(c),d);g<1e-4&&(g=1),p<1e-4&&(p=g),x<1e-4&&(x=g),_O.initNonuniformCatmullRom(l.x,u.x,h.x,c.x,p,g,x),SO.initNonuniformCatmullRom(l.y,u.y,h.y,c.y,p,g,x),wO.initNonuniformCatmullRom(l.z,u.z,h.z,c.z,p,g,x)}else this.curveType==="catmullrom"&&(_O.initCatmullRom(l.x,u.x,h.x,c.x,this.tension),SO.initCatmullRom(l.y,u.y,h.y,c.y,this.tension),wO.initCatmullRom(l.z,u.z,h.z,c.z,this.tension));return i.set(_O.calc(o),SO.calc(o),wO.calc(o)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let r=t.points[e];this.points.push(r.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){let t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){let r=this.points[e];t.points.push(r.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let r=t.points[e];this.points.push(new W().fromArray(r))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}};function CV(t,e,i,r,n){let s=(r-e)*.5,a=(n-i)*.5,o=t*t,l=t*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*t+i}function whe(t,e){let i=1-t;return i*i*e}function Mhe(t,e){return 2*(1-t)*t*e}function Ehe(t,e){return t*t*e}function XS(t,e,i,r){return whe(t,e)+Mhe(t,i)+Ehe(t,r)}function Ahe(t,e){let i=1-t;return i*i*i*e}function The(t,e){let i=1-t;return 3*i*i*t*e}function Che(t,e){return 3*(1-t)*t*t*e}function Dhe(t,e){return t*t*t*e}function YS(t,e,i,r,n){return Ahe(t,e)+The(t,i)+Che(t,r)+Dhe(t,n)}var uh=class extends $d{constructor(t=new Oe,e=new Oe,i=new Oe,r=new Oe){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=r}getPoint(t,e=new Oe){let i=e,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(YS(t,r.x,n.x,s.x,a.x),YS(t,r.y,n.y,s.y,a.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},YT=class extends $d{constructor(t=new W,e=new W,i=new W,r=new W){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=r}getPoint(t,e=new W){let i=e,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(YS(t,r.x,n.x,s.x,a.x),YS(t,r.y,n.y,s.y,a.y),YS(t,r.z,n.z,s.z,a.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},ph=class extends $d{constructor(t=new Oe,e=new Oe){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Oe){let i=e;return t===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){let i=e||new Oe;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},Mq=class extends $d{constructor(t=new W,e=new W){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new W){let i=e;return t===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},_g=class extends $d{constructor(t=new Oe,e=new Oe,i=new Oe){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new Oe){let i=e,r=this.v0,n=this.v1,s=this.v2;return i.set(XS(t,r.x,n.x,s.x),XS(t,r.y,n.y,s.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},Phe=class extends $d{constructor(t=new W,e=new W,i=new W){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new W){let i=e,r=this.v0,n=this.v1,s=this.v2;return i.set(XS(t,r.x,n.x,s.x),XS(t,r.y,n.y,s.y),XS(t,r.z,n.z,s.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},MN=class extends $d{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new Oe){let i=e,r=this.points,n=(r.length-1)*t,s=Math.floor(n),a=n-s,o=r[s===0?s:s-1],l=r[s],c=r[s>r.length-2?r.length-1:s+1],u=r[s>r.length-3?r.length-1:s+2];return i.set(CV(a,o.x,l.x,c.x,u.x),CV(a,o.y,l.y,c.y,u.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let r=t.points[e];this.points.push(r.clone())}return this}toJSON(){let t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){let r=this.points[e];t.points.push(r.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let r=t.points[e];this.points.push(new Oe().fromArray(r))}return this}},Rhe=Object.freeze({__proto__:null,ArcCurve:_he,CatmullRomCurve3:She,CubicBezierCurve:uh,CubicBezierCurve3:YT,EllipseCurve:L3,LineCurve:ph,LineCurve3:Mq,QuadraticBezierCurve:_g,QuadraticBezierCurve3:Phe,SplineCurve:MN}),Eq=class extends $d{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){let t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new ph(e,t))}getPoint(t,e){let i=t*this.getLength(),r=this.getCurveLengths(),n=0;for(;n<r.length;){if(r[n]>=i){let s=r[n]-i,a=this.curves[n],o=a.getLength(),l=o===0?0:1-s/o;return a.getPointAt(l,e)}n++}return null}getLength(){let t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let t=[],e=0;for(let i=0,r=this.curves.length;i<r;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){let e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){let e=[],i;for(let r=0,n=this.curves;r<n.length;r++){let s=n[r],a=s.isEllipseCurve?t*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,o=s.getPoints(a);for(let l=0;l<o.length;l++){let c=o[l];i&&i.equals(c)||(e.push(c),i=c)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){let r=t.curves[e];this.curves.push(r.clone())}return this.autoClose=t.autoClose,this}toJSON(){let t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){let r=this.curves[e];t.curves.push(r.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){let r=t.curves[e];this.curves.push(new Rhe[r.type]().fromJSON(r))}return this}},DC=class extends Eq{constructor(t){super(),this.type="Path",this.currentPoint=new Oe,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){let i=new ph(this.currentPoint.clone(),new Oe(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,r){let n=new _g(this.currentPoint.clone(),new Oe(t,e),new Oe(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this}bezierCurveTo(t,e,i,r,n,s){let a=new uh(this.currentPoint.clone(),new Oe(t,e),new Oe(i,r),new Oe(n,s));return this.curves.push(a),this.currentPoint.set(n,s),this}splineThru(t){let e=[this.currentPoint.clone()].concat(t),i=new MN(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,r,n,s){let a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+a,e+o,i,r,n,s),this}absarc(t,e,i,r,n,s){return this.absellipse(t,e,i,i,r,n,s),this}ellipse(t,e,i,r,n,s,a,o){let l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,i,r,n,s,a,o),this}absellipse(t,e,i,r,n,s,a,o){let l=new L3(t,e,i,r,n,s,a,o);if(this.curves.length>0){let u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);let c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){let t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}},Aq=class extends ni{constructor(t=[new Oe(0,-.5),new Oe(.5,0),new Oe(0,.5)],e=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:r},e=Math.floor(e),r=ks(r,0,Math.PI*2);let n=[],s=[],a=[],o=[],l=[],c=1/e,u=new W,h=new Oe,d=new W,p=new W,g=new W,x=0,v=0;for(let b=0;b<=t.length-1;b++)switch(b){case 0:x=t[b+1].x-t[b].x,v=t[b+1].y-t[b].y,d.x=v*1,d.y=-x,d.z=v*0,g.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case t.length-1:o.push(g.x,g.y,g.z);break;default:x=t[b+1].x-t[b].x,v=t[b+1].y-t[b].y,d.x=v*1,d.y=-x,d.z=v*0,p.copy(d),d.x+=g.x,d.y+=g.y,d.z+=g.z,d.normalize(),o.push(d.x,d.y,d.z),g.copy(p)}for(let b=0;b<=e;b++){let w=i+b*c*r,M=Math.sin(w),E=Math.cos(w);for(let D=0;D<=t.length-1;D++){u.x=t[D].x*M,u.y=t[D].y,u.z=t[D].x*E,s.push(u.x,u.y,u.z),h.x=b/e,h.y=D/(t.length-1),a.push(h.x,h.y);let T=o[3*D+0]*M,L=o[3*D+1],P=o[3*D+0]*E;l.push(T,L,P)}}for(let b=0;b<e;b++)for(let w=0;w<t.length-1;w++){let M=w+b*t.length,E=M,D=M+t.length,T=M+t.length+1,L=M+1;n.push(E,D,L),n.push(T,L,D)}this.setIndex(n),this.setAttribute("position",new Wt(s,3)),this.setAttribute("uv",new Wt(a,2)),this.setAttribute("normal",new Wt(l,3))}static fromJSON(t){return new Aq(t.points,t.segments,t.phiStart,t.phiLength)}},EN=class extends ni{constructor(t=1,e=1,i=1,r=32,n=1,s=!1,a=0,o=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o};let l=this;r=Math.floor(r),n=Math.floor(n);let c=[],u=[],h=[],d=[],p=0,g=[],x=i/2,v=0;b(),s===!1&&(t>0&&w(!0),e>0&&w(!1)),this.setIndex(c),this.setAttribute("position",new Wt(u,3)),this.setAttribute("normal",new Wt(h,3)),this.setAttribute("uv",new Wt(d,2));function b(){let M=new W,E=new W,D=0,T=(e-t)/i;for(let L=0;L<=n;L++){let P=[],R=L/n,O=R*(e-t)+t;for(let U=0;U<=r;U++){let F=U/r,V=F*o+a,k=Math.sin(V),K=Math.cos(V);E.x=O*k,E.y=-R*i+x,E.z=O*K,u.push(E.x,E.y,E.z),M.set(k,T,K).normalize(),h.push(M.x,M.y,M.z),d.push(F,1-R),P.push(p++)}g.push(P)}for(let L=0;L<r;L++)for(let P=0;P<n;P++){let R=g[P][L],O=g[P+1][L],U=g[P+1][L+1],F=g[P][L+1];c.push(R,O,F),c.push(O,U,F),D+=6}l.addGroup(v,D,0),v+=D}function w(M){let E=p,D=new Oe,T=new W,L=0,P=M===!0?t:e,R=M===!0?1:-1;for(let U=1;U<=r;U++)u.push(0,x*R,0),h.push(0,R,0),d.push(.5,.5),p++;let O=p;for(let U=0;U<=r;U++){let F=U/r*o+a,V=Math.cos(F),k=Math.sin(F);T.x=P*k,T.y=x*R,T.z=P*V,u.push(T.x,T.y,T.z),h.push(0,R,0),D.x=V*.5+.5,D.y=k*.5*R+.5,d.push(D.x,D.y),p++}for(let U=0;U<r;U++){let F=E+U,V=O+U;M===!0?c.push(V,V+1,F):c.push(V+1,V,F),L+=3}l.addGroup(v,L,M===!0?1:2),v+=L}}static fromJSON(t){return new EN(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}},AN=class extends EN{constructor(t=1,e=1,i=32,r=1,n=!1,s=0,a=Math.PI*2){super(0,t,e,i,r,n,s,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:s,thetaLength:a}}static fromJSON(t){return new AN(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}},TN=class extends ni{constructor(t=[],e=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:r};let n=[],s=[];a(r),l(i),c(),this.setAttribute("position",new Wt(n,3)),this.setAttribute("normal",new Wt(n.slice(),3)),this.setAttribute("uv",new Wt(s,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(b){let w=new W,M=new W,E=new W;for(let D=0;D<e.length;D+=3)d(e[D+0],w),d(e[D+1],M),d(e[D+2],E),o(w,M,E,b)}function o(b,w,M,E){let D=E+1,T=[];for(let L=0;L<=D;L++){T[L]=[];let P=b.clone().lerp(M,L/D),R=w.clone().lerp(M,L/D),O=D-L;for(let U=0;U<=O;U++)U===0&&L===D?T[L][U]=P:T[L][U]=P.clone().lerp(R,U/O)}for(let L=0;L<D;L++)for(let P=0;P<2*(D-L)-1;P++){let R=Math.floor(P/2);P%2===0?(h(T[L][R+1]),h(T[L+1][R]),h(T[L][R])):(h(T[L][R+1]),h(T[L+1][R+1]),h(T[L+1][R]))}}function l(b){let w=new W;for(let M=0;M<n.length;M+=3)w.x=n[M+0],w.y=n[M+1],w.z=n[M+2],w.normalize().multiplyScalar(b),n[M+0]=w.x,n[M+1]=w.y,n[M+2]=w.z}function c(){let b=new W;for(let w=0;w<n.length;w+=3){b.x=n[w+0],b.y=n[w+1],b.z=n[w+2];let M=x(b)/2/Math.PI+.5,E=v(b)/Math.PI+.5;s.push(M,1-E)}p(),u()}function u(){for(let b=0;b<s.length;b+=6){let w=s[b+0],M=s[b+2],E=s[b+4],D=Math.max(w,M,E),T=Math.min(w,M,E);D>.9&&T<.1&&(w<.2&&(s[b+0]+=1),M<.2&&(s[b+2]+=1),E<.2&&(s[b+4]+=1))}}function h(b){n.push(b.x,b.y,b.z)}function d(b,w){let M=b*3;w.x=t[M+0],w.y=t[M+1],w.z=t[M+2]}function p(){let b=new W,w=new W,M=new W,E=new W,D=new Oe,T=new Oe,L=new Oe;for(let P=0,R=0;P<n.length;P+=9,R+=6){b.set(n[P+0],n[P+1],n[P+2]),w.set(n[P+3],n[P+4],n[P+5]),M.set(n[P+6],n[P+7],n[P+8]),D.set(s[R+0],s[R+1]),T.set(s[R+2],s[R+3]),L.set(s[R+4],s[R+5]),E.copy(b).add(w).add(M).divideScalar(3);let O=x(E);g(D,R+0,b,O),g(T,R+2,w,O),g(L,R+4,M,O)}}function g(b,w,M,E){E<0&&b.x===1&&(s[w]=b.x-1),M.x===0&&M.z===0&&(s[w]=E/2/Math.PI+.5)}function x(b){return Math.atan2(b.z,-b.x)}function v(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}static fromJSON(t){return new TN(t.vertices,t.indices,t.radius,t.details)}},Tq=class extends TN{constructor(t=1,e=0){let i=(1+Math.sqrt(5))/2,r=1/i,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(n,s,t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Tq(t.radius,t.detail)}},PC=class extends DC{constructor(t){super(t),this.uuid=ru(),this.type="Shape",this.holes=[]}getPointsHoles(t){let e=[];for(let i=0,r=this.holes.length;i<r;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){let r=t.holes[e];this.holes.push(r.clone())}return this}toJSON(){let t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){let r=this.holes[e];t.holes.push(r.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){let r=t.holes[e];this.holes.push(new DC().fromJSON(r))}return this}},Ohe={triangulate:function(t,e,i=2){let r=e&&e.length,n=r?e[0]*i:t.length,s=Cq(t,0,n,i,!0),a=[];if(!s||s.next===s.prev)return a;let o,l,c,u,h,d,p;if(r&&(s=Bhe(t,e,s,i)),t.length>80*i){o=c=t[0],l=u=t[1];for(let g=i;g<n;g+=i)h=t[g],d=t[g+1],h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-o,u-l),p=p!==0?32767/p:0}return Aw(s,a,i,o,l,p,0),a}};function Cq(t,e,i,r,n){let s,a;if(n===Yhe(t,e,i,r)>0)for(s=e;s<i;s+=r)a=DV(s,t[s],t[s+1],a);else for(s=i-r;s>=e;s-=r)a=DV(s,t[s],t[s+1],a);return a&&I3(a,a.next)&&(Cw(a),a=a.next),a}function I0(t,e){if(!t)return t;e||(e=t);let i=t,r;do if(r=!1,!i.steiner&&(I3(i,i.next)||es(i.prev,i,i.next)===0)){if(Cw(i),i=e=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==e);return e}function Aw(t,e,i,r,n,s,a){if(!t)return;!a&&s&&Hhe(t,r,n,s);let o=t,l,c;for(;t.prev!==t.next;){if(l=t.prev,c=t.next,s?Ihe(t,r,n,s):Lhe(t)){e.push(l.i/i|0),e.push(t.i/i|0),e.push(c.i/i|0),Cw(t),t=c.next,o=c.next;continue}if(t=c,t===o){a?a===1?(t=zhe(I0(t),e,i),Aw(t,e,i,r,n,s,2)):a===2&&Uhe(t,e,i,r,n,s):Aw(I0(t),e,i,r,n,s,1);break}}}function Lhe(t){let e=t.prev,i=t,r=t.next;if(es(e,i,r)>=0)return!1;let n=e.x,s=i.x,a=r.x,o=e.y,l=i.y,c=r.y,u=n<s?n<a?n:a:s<a?s:a,h=o<l?o<c?o:c:l<c?l:c,d=n>s?n>a?n:a:s>a?s:a,p=o>l?o>c?o:c:l>c?l:c,g=r.next;for(;g!==e;){if(g.x>=u&&g.x<=d&&g.y>=h&&g.y<=p&&i1(n,o,s,l,a,c,g.x,g.y)&&es(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function Ihe(t,e,i,r){let n=t.prev,s=t,a=t.next;if(es(n,s,a)>=0)return!1;let o=n.x,l=s.x,c=a.x,u=n.y,h=s.y,d=a.y,p=o<l?o<c?o:c:l<c?l:c,g=u<h?u<d?u:d:h<d?h:d,x=o>l?o>c?o:c:l>c?l:c,v=u>h?u>d?u:d:h>d?h:d,b=Iz(p,g,e,i,r),w=Iz(x,v,e,i,r),M=t.prevZ,E=t.nextZ;for(;M&&M.z>=b&&E&&E.z<=w;){if(M.x>=p&&M.x<=x&&M.y>=g&&M.y<=v&&M!==n&&M!==a&&i1(o,u,l,h,c,d,M.x,M.y)&&es(M.prev,M,M.next)>=0||(M=M.prevZ,E.x>=p&&E.x<=x&&E.y>=g&&E.y<=v&&E!==n&&E!==a&&i1(o,u,l,h,c,d,E.x,E.y)&&es(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;M&&M.z>=b;){if(M.x>=p&&M.x<=x&&M.y>=g&&M.y<=v&&M!==n&&M!==a&&i1(o,u,l,h,c,d,M.x,M.y)&&es(M.prev,M,M.next)>=0)return!1;M=M.prevZ}for(;E&&E.z<=w;){if(E.x>=p&&E.x<=x&&E.y>=g&&E.y<=v&&E!==n&&E!==a&&i1(o,u,l,h,c,d,E.x,E.y)&&es(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function zhe(t,e,i){let r=t;do{let n=r.prev,s=r.next.next;!I3(n,s)&&Dq(n,r,r.next,s)&&Tw(n,s)&&Tw(s,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(s.i/i|0),Cw(r),Cw(r.next),r=t=s),r=r.next}while(r!==t);return I0(r)}function Uhe(t,e,i,r,n,s){let a=t;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&Whe(a,o)){let l=Pq(a,o);a=I0(a,a.next),l=I0(l,l.next),Aw(a,e,i,r,n,s,0),Aw(l,e,i,r,n,s,0);return}o=o.next}a=a.next}while(a!==t)}function Bhe(t,e,i,r){let n=[],s,a,o,l,c;for(s=0,a=e.length;s<a;s++)o=e[s]*r,l=s<a-1?e[s+1]*r:t.length,c=Cq(t,o,l,r,!1),c===c.next&&(c.steiner=!0),n.push(jhe(c));for(n.sort(Nhe),s=0;s<n.length;s++)i=Fhe(n[s],i);return i}function Nhe(t,e){return t.x-e.x}function Fhe(t,e){let i=khe(t,e);if(!i)return e;let r=Pq(i,t);return I0(r,r.next),I0(i,i.next)}function khe(t,e){let i=e,r=-1/0,n,s=t.x,a=t.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){let d=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>r&&(r=d,n=i.x<i.next.x?i:i.next,d===s))return n}i=i.next}while(i!==e);if(!n)return null;let o=n,l=n.x,c=n.y,u=1/0,h;i=n;do s>=i.x&&i.x>=l&&s!==i.x&&i1(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),Tw(i,t)&&(h<u||h===u&&(i.x>n.x||i.x===n.x&&Vhe(n,i)))&&(n=i,u=h)),i=i.next;while(i!==o);return n}function Vhe(t,e){return es(t.prev,t,e.prev)<0&&es(e.next,t,t.next)<0}function Hhe(t,e,i,r){let n=t;do n.z===0&&(n.z=Iz(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,Ghe(n)}function Ghe(t){let e,i,r,n,s,a,o,l,c=1;do{for(i=t,t=null,s=null,a=0;i;){for(a++,r=i,o=0,e=0;e<c&&(o++,r=r.nextZ,!!r);e++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(a>1);return t}function Iz(t,e,i,r,n){return t=(t-i)*n|0,e=(e-r)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function jhe(t){let e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function i1(t,e,i,r,n,s,a,o){return(n-a)*(e-o)>=(t-a)*(s-o)&&(t-a)*(r-o)>=(i-a)*(e-o)&&(i-a)*(s-o)>=(n-a)*(r-o)}function Whe(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!qhe(t,e)&&(Tw(t,e)&&Tw(e,t)&&Xhe(t,e)&&(es(t.prev,t,e.prev)||es(t,e.prev,e))||I3(t,e)&&es(t.prev,t,t.next)>0&&es(e.prev,e,e.next)>0)}function es(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function I3(t,e){return t.x===e.x&&t.y===e.y}function Dq(t,e,i,r){let n=HA(es(t,e,i)),s=HA(es(t,e,r)),a=HA(es(i,r,t)),o=HA(es(i,r,e));return!!(n!==s&&a!==o||n===0&&VA(t,i,e)||s===0&&VA(t,r,e)||a===0&&VA(i,t,r)||o===0&&VA(i,e,r))}function VA(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function HA(t){return t>0?1:t<0?-1:0}function qhe(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Dq(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function Tw(t,e){return es(t.prev,t,t.next)<0?es(t,e,t.next)>=0&&es(t,t.prev,e)>=0:es(t,e,t.prev)<0||es(t,t.next,e)<0}function Xhe(t,e){let i=t,r=!1,n=(t.x+e.x)/2,s=(t.y+e.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==t);return r}function Pq(t,e){let i=new zz(t.i,t.x,t.y),r=new zz(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function DV(t,e,i,r){let n=new zz(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Cw(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function zz(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Yhe(t,e,i,r){let n=0;for(let s=e,a=i-r;s<i;s+=r)n+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return n}var Rq=class{static area(t){let e=t.length,i=0;for(let r=e-1,n=0;n<e;r=n++)i+=t[r].x*t[n].y-t[n].x*t[r].y;return i*.5}static isClockWise(t){return Rq.area(t)<0}static triangulateShape(t,e){let i=[],r=[],n=[];PV(t),RV(i,t);let s=t.length;e.forEach(PV);for(let o=0;o<e.length;o++)r.push(s),s+=e[o].length,RV(i,e[o]);let a=Ohe.triangulate(i,r);for(let o=0;o<a.length;o+=3)n.push(a.slice(o,o+3));return n}};function PV(t){let e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function RV(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}var Oq=class extends TN{constructor(t=1,e=0){let i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,n,t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Oq(t.radius,t.detail)}},p1=class extends ni{constructor(t=1,e=32,i=16,r=0,n=Math.PI*2,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:r,phiLength:n,thetaStart:s,thetaLength:a},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));let o=Math.min(s+a,Math.PI),l=0,c=[],u=new W,h=new W,d=[],p=[],g=[],x=[];for(let v=0;v<=i;v++){let b=[],w=v/i,M=0;v==0&&s==0?M=.5/e:v==i&&o==Math.PI&&(M=-.5/e);for(let E=0;E<=e;E++){let D=E/e;u.x=-t*Math.cos(r+D*n)*Math.sin(s+w*a),u.y=t*Math.cos(s+w*a),u.z=t*Math.sin(r+D*n)*Math.sin(s+w*a),p.push(u.x,u.y,u.z),h.copy(u).normalize(),g.push(h.x,h.y,h.z),x.push(D+M,1-w),b.push(l++)}c.push(b)}for(let v=0;v<i;v++)for(let b=0;b<e;b++){let w=c[v][b+1],M=c[v][b],E=c[v+1][b],D=c[v+1][b+1];(v!==0||s>0)&&d.push(w,M,D),(v!==i-1||o<Math.PI)&&d.push(M,E,D)}this.setIndex(d),this.setAttribute("position",new Wt(p,3)),this.setAttribute("normal",new Wt(g,3)),this.setAttribute("uv",new Wt(x,2))}static fromJSON(t){return new p1(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}},Lq=class extends ni{constructor(t=1,e=.4,i=12,r=48,n=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:r,arc:n},i=Math.floor(i),r=Math.floor(r);let s=[],a=[],o=[],l=[],c=new W,u=new W,h=new W;for(let d=0;d<=i;d++)for(let p=0;p<=r;p++){let g=p/r*n,x=d/i*Math.PI*2;u.x=(t+e*Math.cos(x))*Math.cos(g),u.y=(t+e*Math.cos(x))*Math.sin(g),u.z=e*Math.sin(x),a.push(u.x,u.y,u.z),c.x=t*Math.cos(g),c.y=t*Math.sin(g),h.subVectors(u,c).normalize(),o.push(h.x,h.y,h.z),l.push(p/r),l.push(d/i)}for(let d=1;d<=i;d++)for(let p=1;p<=r;p++){let g=(r+1)*d+p-1,x=(r+1)*(d-1)+p-1,v=(r+1)*(d-1)+p,b=(r+1)*d+p;s.push(g,x,b),s.push(x,v,b)}this.setIndex(s),this.setAttribute("position",new Wt(a,3)),this.setAttribute("normal",new Wt(o,3)),this.setAttribute("uv",new Wt(l,2))}static fromJSON(t){return new Lq(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}},Iq=class extends ni{constructor(t=1,e=.4,i=64,r=8,n=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:r,p:n,q:s},i=Math.floor(i),r=Math.floor(r);let a=[],o=[],l=[],c=[],u=new W,h=new W,d=new W,p=new W,g=new W,x=new W,v=new W;for(let w=0;w<=i;++w){let M=w/i*n*Math.PI*2;b(M,n,s,t,d),b(M+.01,n,s,t,p),x.subVectors(p,d),v.addVectors(p,d),g.crossVectors(x,v),v.crossVectors(g,x),g.normalize(),v.normalize();for(let E=0;E<=r;++E){let D=E/r*Math.PI*2,T=-e*Math.cos(D),L=e*Math.sin(D);u.x=d.x+(T*v.x+L*g.x),u.y=d.y+(T*v.y+L*g.y),u.z=d.z+(T*v.z+L*g.z),o.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(w/i),c.push(E/r)}}for(let w=1;w<=i;w++)for(let M=1;M<=r;M++){let E=(r+1)*(w-1)+(M-1),D=(r+1)*w+(M-1),T=(r+1)*w+M,L=(r+1)*(w-1)+M;a.push(E,D,L),a.push(D,T,L)}this.setIndex(a),this.setAttribute("position",new Wt(o,3)),this.setAttribute("normal",new Wt(l,3)),this.setAttribute("uv",new Wt(c,2));function b(w,M,E,D,T){let L=Math.cos(w),P=Math.sin(w),R=E/M*w,O=Math.cos(R);T.x=D*(2+O)*.5*L,T.y=D*(2+O)*P*.5,T.z=D*Math.sin(R)*.5}}static fromJSON(t){return new Iq(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}},Qhe=class extends xr{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}};function Tm(t,e,i){return zq(t)?new t.constructor(t.subarray(e,i!==void 0?i:t.length)):t.slice(e,i)}function GA(t,e,i){return!t||t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)}function zq(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Zhe(t){function e(n,s){return t[n]-t[s]}let i=t.length,r=new Array(i);for(let n=0;n!==i;++n)r[n]=n;return r.sort(e),r}function OV(t,e,i){let r=t.length,n=new t.constructor(r);for(let s=0,a=0;a!==r;++s){let o=i[s]*e;for(let l=0;l!==e;++l)n[a++]=t[o+l]}return n}function Uq(t,e,i,r){let n=1,s=t[0];for(;s!==void 0&&s[r]===void 0;)s=t[n++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(e.push(s.time),i.push.apply(i,a)),s=t[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(e.push(s.time),a.toArray(i,i.length)),s=t[n++];while(s!==void 0);else do a=s[r],a!==void 0&&(e.push(s.time),i.push(a)),s=t[n++];while(s!==void 0)}var z3=class{constructor(t,e,i,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){let e=this.parameterPositions,i=this._cachedIndex,r=e[i],n=e[i-1];e:{t:{let s;i:{r:if(!(t<r)){for(let a=i+2;;){if(r===void 0){if(t<n)break r;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(n=r,r=e[++i],t<r)break t}s=e.length;break i}if(!(t>=n)){let a=e[1];t<a&&(i=2,n=a);for(let o=i-2;;){if(n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===o)break;if(r=n,n=e[--i-1],t>=n)break t}s=i,i=0;break i}break e}for(;i<s;){let a=i+s>>>1;t<e[a]?s=a:i=a+1}if(r=e[i],n=e[i-1],n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){let e=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=t*r;for(let s=0;s!==r;++s)e[s]=i[n+s];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},Khe=class extends z3{constructor(t,e,i,r){super(t,e,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:$x,endingEnd:$x}}intervalChanged_(t,e,i){let r=this.parameterPositions,n=t-2,s=t+1,a=r[n],o=r[s];if(a===void 0)switch(this.getSettings_().endingStart){case e1:n=t,a=2*e-i;break;case EC:n=r.length-2,a=e+r[n]-r[n+1];break;default:n=t,a=i}if(o===void 0)switch(this.getSettings_().endingEnd){case e1:s=t,o=2*i-e;break;case EC:s=1,o=i+r[1]-r[0];break;default:s=t-1,o=e}let l=(i-e)*.5,c=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(o-i),this._offsetPrev=n*c,this._offsetNext=s*c}interpolate_(t,e,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(i-e)/(r-e),g=p*p,x=g*p,v=-h*x+2*h*g-h*p,b=(1+h)*x+(-1.5-2*h)*g+(-.5+h)*p+1,w=(-1-d)*x+(1.5+d)*g+.5*p,M=d*x-d*g;for(let E=0;E!==a;++E)n[E]=v*s[c+E]+b*s[l+E]+w*s[o+E]+M*s[u+E];return n}},Bq=class extends z3{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t,e,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=(i-e)/(r-e),u=1-c;for(let h=0;h!==a;++h)n[h]=s[l+h]*u+s[o+h]*c;return n}},Jhe=class extends z3{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t){return this.copySampleValue_(t-1)}},ef=class{constructor(t,e,i,r){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=GA(e,this.TimeBufferType),this.values=GA(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){let e=t.constructor,i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:GA(t.times,Array),values:GA(t.values,Array)};let r=t.getInterpolation();r!==t.DefaultInterpolation&&(i.interpolation=r)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new Jhe(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Bq(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Khe(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case wC:e=this.InterpolantFactoryMethodDiscrete;break;case MC:e=this.InterpolantFactoryMethodLinear;break;case YR:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return wC;case this.InterpolantFactoryMethodLinear:return MC;case this.InterpolantFactoryMethodSmooth:return YR}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){let e=this.times;for(let i=0,r=e.length;i!==r;++i)e[i]+=t}return this}scale(t){if(t!==1){let e=this.times;for(let i=0,r=e.length;i!==r;++i)e[i]*=t}return this}trim(t,e){let i=this.times,r=i.length,n=0,s=r-1;for(;n!==r&&i[n]<t;)++n;for(;s!==-1&&i[s]>e;)--s;if(++s,n!==0||s!==r){n>=s&&(s=Math.max(s,1),n=s-1);let a=this.getValueSize();this.times=Tm(i,n,s),this.values=Tm(this.values,n*a,s*a)}return this}validate(){let t=!0,e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);let i=this.times,r=this.values,n=i.length;n===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let a=0;a!==n;a++){let o=i[a];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,o),t=!1;break}if(s!==null&&s>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,o,s),t=!1;break}s=o}if(r!==void 0&&zq(r))for(let a=0,o=r.length;a!==o;++a){let l=r[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),t=!1;break}}return t}optimize(){let t=Tm(this.times),e=Tm(this.values),i=this.getValueSize(),r=this.getInterpolation()===YR,n=t.length-1,s=1;for(let a=1;a<n;++a){let o=!1,l=t[a],c=t[a+1];if(l!==c&&(a!==1||l!==t[0]))if(r)o=!0;else{let u=a*i,h=u-i,d=u+i;for(let p=0;p!==i;++p){let g=e[u+p];if(g!==e[h+p]||g!==e[d+p]){o=!0;break}}}if(o){if(a!==s){t[s]=t[a];let u=a*i,h=s*i;for(let d=0;d!==i;++d)e[h+d]=e[u+d]}++s}}if(n>0){t[s]=t[n];for(let a=n*i,o=s*i,l=0;l!==i;++l)e[o+l]=e[a+l];++s}return s!==t.length?(this.times=Tm(t,0,s),this.values=Tm(e,0,s*i)):(this.times=t,this.values=e),this}clone(){let t=Tm(this.times,0),e=Tm(this.values,0),i=this.constructor,r=new i(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}};ef.prototype.TimeBufferType=Float32Array;ef.prototype.ValueBufferType=Float32Array;ef.prototype.DefaultInterpolation=MC;var ub=class extends ef{};ub.prototype.ValueTypeName="bool";ub.prototype.ValueBufferType=Array;ub.prototype.DefaultInterpolation=wC;ub.prototype.InterpolantFactoryMethodLinear=void 0;ub.prototype.InterpolantFactoryMethodSmooth=void 0;var Nq=class extends ef{};Nq.prototype.ValueTypeName="color";var RC=class extends ef{};RC.prototype.ValueTypeName="number";var $he=class extends z3{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t,e,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-e)/(r-e),l=t*a;for(let c=l+a;l!==c;l+=4)Ci.slerpFlat(n,0,s,l-a,s,l,o);return n}},_M=class extends ef{InterpolantFactoryMethodLinear(t){return new $he(this.times,this.values,this.getValueSize(),t)}};_M.prototype.ValueTypeName="quaternion";_M.prototype.DefaultInterpolation=MC;_M.prototype.InterpolantFactoryMethodSmooth=void 0;var hb=class extends ef{};hb.prototype.ValueTypeName="string";hb.prototype.ValueBufferType=Array;hb.prototype.DefaultInterpolation=wC;hb.prototype.InterpolantFactoryMethodLinear=void 0;hb.prototype.InterpolantFactoryMethodSmooth=void 0;var OC=class extends ef{};OC.prototype.ValueTypeName="vector";var Uz=class{constructor(t,e=-1,i,r=gN){this.name=t,this.tracks=i,this.duration=e,this.blendMode=r,this.uuid=ru(),this.duration<0&&this.resetDuration()}static parse(t){let e=[],i=t.tracks,r=1/(t.fps||1);for(let s=0,a=i.length;s!==a;++s)e.push(tde(i[s]).scale(r));let n=new this(t.name,t.duration,e,t.blendMode);return n.uuid=t.uuid,n}static toJSON(t){let e=[],i=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let n=0,s=i.length;n!==s;++n)e.push(ef.toJSON(i[n]));return r}static CreateFromMorphTargetSequence(t,e,i,r){let n=e.length,s=[];for(let a=0;a<n;a++){let o=[],l=[];o.push((a+n-1)%n,a,(a+1)%n),l.push(0,1,0);let c=Zhe(o);o=OV(o,1,c),l=OV(l,1,c),!r&&o[0]===0&&(o.push(n),l.push(l[0])),s.push(new RC(".morphTargetInfluences["+e[a].name+"]",o,l).scale(1/i))}return new this(t,-1,s)}static findByName(t,e){let i=t;if(!Array.isArray(t)){let r=t;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===e)return i[r];return null}static CreateClipsFromMorphTargetSequences(t,e,i){let r={},n=/^([\w-]*?)([\d]+)$/;for(let a=0,o=t.length;a<o;a++){let l=t[a],c=l.name.match(n);if(c&&c.length>1){let u=c[1],h=r[u];h||(r[u]=h=[]),h.push(l)}}let s=[];for(let a in r)s.push(this.CreateFromMorphTargetSequence(a,r[a],e,i));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(c,u,h,d,p){if(h.length!==0){let g=[],x=[];Uq(h,g,x,d),g.length!==0&&p.push(new c(u,g,x))}},r=[],n=t.name||"default",s=t.fps||30,a=t.blendMode,o=t.length||-1,l=t.hierarchy||[];for(let c=0;c<l.length;c++){let u=l[c].keys;if(!(!u||u.length===0))if(u[0].morphTargets){let h={},d;for(d=0;d<u.length;d++)if(u[d].morphTargets)for(let p=0;p<u[d].morphTargets.length;p++)h[u[d].morphTargets[p]]=-1;for(let p in h){let g=[],x=[];for(let v=0;v!==u[d].morphTargets.length;++v){let b=u[d];g.push(b.time),x.push(b.morphTarget===p?1:0)}r.push(new RC(".morphTargetInfluence["+p+"]",g,x))}o=h.length*s}else{let h=".bones["+e[c].name+"]";i(OC,h+".position",u,"pos",r),i(_M,h+".quaternion",u,"rot",r),i(OC,h+".scale",u,"scl",r)}}return r.length===0?null:new this(n,o,r,a)}resetDuration(){let t=this.tracks,e=0;for(let i=0,r=t.length;i!==r;++i){let n=this.tracks[i];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){let t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function ede(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return RC;case"vector":case"vector2":case"vector3":case"vector4":return OC;case"color":return Nq;case"quaternion":return _M;case"bool":case"boolean":return ub;case"string":return hb}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function tde(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let e=ede(t.type);if(t.times===void 0){let i=[],r=[];Uq(t.keys,i,r,"value"),t.times=i,t.values=r}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}var LC={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},Fq=class{constructor(t,e,i){let r=this,n=!1,s=0,a=0,o,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(c){a++,n===!1&&r.onStart!==void 0&&r.onStart(c,s,a),n=!0},this.itemEnd=function(c){s++,r.onProgress!==void 0&&r.onProgress(c,s,a),s===a&&(n=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(c){r.onError!==void 0&&r.onError(c)},this.resolveURL=function(c){return o?o(c):c},this.setURLModifier=function(c){return o=c,this},this.addHandler=function(c,u){return l.push(c,u),this},this.removeHandler=function(c){let u=l.indexOf(c);return u!==-1&&l.splice(u,2),this},this.getHandler=function(c){for(let u=0,h=l.length;u<h;u+=2){let d=l[u],p=l[u+1];if(d.global&&(d.lastIndex=0),d.test(c))return p}return null}}},ide=new Fq,SM=class{constructor(t){this.manager=t!==void 0?t:ide,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){let i=this;return new Promise(function(r,n){i.load(t,r,e,n)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}},Vf={},rde=class extends Error{constructor(t,e){super(t),this.response=e}},Bz=class extends SM{constructor(t){super(t)}load(t,e,i,r){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);let n=LC.get(t);if(n!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(n),this.manager.itemEnd(t)},0),n;if(Vf[t]!==void 0){Vf[t].push({onLoad:e,onProgress:i,onError:r});return}Vf[t]=[],Vf[t].push({onLoad:e,onProgress:i,onError:r});let s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;let c=Vf[t],u=l.body.getReader(),h=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),d=h?parseInt(h):0,p=d!==0,g=0,x=new ReadableStream({start(v){b();function b(){u.read().then(({done:w,value:M})=>{if(w)v.close();else{g+=M.byteLength;let E=new ProgressEvent("progress",{lengthComputable:p,loaded:g,total:d});for(let D=0,T=c.length;D<T;D++){let L=c[D];L.onProgress&&L.onProgress(E)}v.enqueue(M),b()}})}}});return new Response(x)}else throw new rde(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(o){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(c=>new DOMParser().parseFromString(c,a));case"json":return l.json();default:if(a===void 0)return l.text();{let c=/charset="?([^;"\s]*)"?/i.exec(a),u=c&&c[1]?c[1].toLowerCase():void 0,h=new TextDecoder(u);return l.arrayBuffer().then(d=>h.decode(d))}}}).then(l=>{LC.add(t,l);let c=Vf[t];delete Vf[t];for(let u=0,h=c.length;u<h;u++){let d=c[u];d.onLoad&&d.onLoad(l)}}).catch(l=>{let c=Vf[t];if(c===void 0)throw this.manager.itemError(t),l;delete Vf[t];for(let u=0,h=c.length;u<h;u++){let d=c[u];d.onError&&d.onError(l)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}},nde=class extends SM{constructor(t){super(t)}load(t,e,i,r){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);let n=this,s=LC.get(t);if(s!==void 0)return n.manager.itemStart(t),setTimeout(function(){e&&e(s),n.manager.itemEnd(t)},0),s;let a=Mw("img");function o(){c(),LC.add(t,this),e&&e(this),n.manager.itemEnd(t)}function l(u){c(),r&&r(u),n.manager.itemError(t),n.manager.itemEnd(t)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(t),a.src=t,a}},sde=class extends SM{constructor(t){super(t)}load(t,e,i,r){let n=new ns,s=new nde(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,function(a){n.image=a,n.needsUpdate=!0,e!==void 0&&e(n)},i,r),n}},wM=class extends Kr{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new bi(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){let e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}},ade=class extends wM{constructor(t,e,i){super(t,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Kr.DEFAULT_UP),this.updateMatrix(),this.groundColor=new bi(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}},MO=new Ot,LV=new W,IV=new W,CN=class{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Oe(512,512),this.map=null,this.mapPass=null,this.matrix=new Ot,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new bN,this._frameExtents=new Oe(1,1),this._viewportCount=1,this._viewports=[new Ri(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){let e=this.camera,i=this.matrix;LV.setFromMatrixPosition(t.matrixWorld),e.position.copy(LV),IV.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(IV),e.updateMatrixWorld(),MO.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(MO),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(MO)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}},ode=class extends CN{constructor(){super(new Do(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){let e=this.camera,i=ww*2*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,n=t.distance||e.far;(i!==e.fov||r!==e.aspect||n!==e.far)&&(e.fov=i,e.aspect=r,e.far=n,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}},lde=class extends wM{constructor(e,i,r=0,n=Math.PI/3,s=0,a=2){super(e,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Kr.DEFAULT_UP),this.updateMatrix(),this.target=new Kr,this.distance=r,this.angle=n,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new ode}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},zV=new Ot,Z_=new W,EO=new W,cde=class extends CN{constructor(){super(new Do(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Oe(4,2),this._viewportCount=6,this._viewports=[new Ri(2,1,1,1),new Ri(0,1,1,1),new Ri(3,1,1,1),new Ri(1,1,1,1),new Ri(3,0,1,1),new Ri(1,0,1,1)],this._cubeDirections=[new W(1,0,0),new W(-1,0,0),new W(0,0,1),new W(0,0,-1),new W(0,1,0),new W(0,-1,0)],this._cubeUps=[new W(0,1,0),new W(0,1,0),new W(0,1,0),new W(0,1,0),new W(0,0,1),new W(0,0,-1)]}updateMatrices(t,e=0){let i=this.camera,r=this.matrix,n=t.distance||i.far;n!==i.far&&(i.far=n,i.updateProjectionMatrix()),Z_.setFromMatrixPosition(t.matrixWorld),i.position.copy(Z_),EO.copy(i.position),EO.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(EO),i.updateMatrixWorld(),r.makeTranslation(-Z_.x,-Z_.y,-Z_.z),zV.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(zV)}},ude=class extends wM{constructor(t,e,i=0,r=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new cde}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}},hde=class extends CN{constructor(){super(new R3(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},dde=class extends wM{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Kr.DEFAULT_UP),this.updateMatrix(),this.target=new Kr,this.shadow=new hde}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}},kq=class extends ni{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){let t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}},Vq=class extends SM{constructor(t){super(t)}load(t,e,i,r){let n=this,s=new Bz(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(t,function(a){try{e(n.parse(JSON.parse(a)))}catch(o){r?r(o):console.error(o),n.manager.itemError(t)}},i,r)}parse(t){let e={},i={};function r(h,d){if(e[d]!==void 0)return e[d];let p=h.interleavedBuffers[d],g=n(h,p.buffer),x=xA(p.type,g),v=new mhe(x,p.stride);return v.uuid=p.uuid,e[d]=v,v}function n(h,d){if(i[d]!==void 0)return i[d];let p=h.arrayBuffers[d],g=new Uint32Array(p).buffer;return i[d]=g,g}let s=t.isInstancedBufferGeometry?new kq:new ni,a=t.data.index;if(a!==void 0){let h=xA(a.type,a.array);s.setIndex(new _i(h,1))}let o=t.data.attributes;for(let h in o){let d=o[h],p;if(d.isInterleavedBufferAttribute){let g=r(t.data,d.data);p=new Lz(g,d.itemSize,d.offset,d.normalized)}else{let g=xA(d.type,d.array),x=d.isInstancedBufferAttribute?Ew:_i;p=new x(g,d.itemSize,d.normalized)}d.name!==void 0&&(p.name=d.name),d.usage!==void 0&&p.setUsage(d.usage),d.updateRange!==void 0&&(p.updateRange.offset=d.updateRange.offset,p.updateRange.count=d.updateRange.count),s.setAttribute(h,p)}let l=t.data.morphAttributes;if(l)for(let h in l){let d=l[h],p=[];for(let g=0,x=d.length;g<x;g++){let v=d[g],b;if(v.isInterleavedBufferAttribute){let w=r(t.data,v.data);b=new Lz(w,v.itemSize,v.offset,v.normalized)}else{let w=xA(v.type,v.array);b=new _i(w,v.itemSize,v.normalized)}v.name!==void 0&&(b.name=v.name),p.push(b)}s.morphAttributes[h]=p}t.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let c=t.data.groups||t.data.drawcalls||t.data.offsets;if(c!==void 0)for(let h=0,d=c.length;h!==d;++h){let p=c[h];s.addGroup(p.start,p.count,p.materialIndex)}let u=t.data.boundingSphere;if(u!==void 0){let h=new W;u.center!==void 0&&h.fromArray(u.center),s.boundingSphere=new Xl(h,u.radius)}return t.name&&(s.name=t.name),t.userData&&(s.userData=t.userData),s}},fde=class{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=UV(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let e=UV();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}};function UV(){return(typeof performance>"u"?Date:performance).now()}var pde=class{constructor(t,e,i){this.binding=t,this.valueSize=i;let r,n,s;switch(e){case"quaternion":r=this._slerp,n=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,n=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,n=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=n,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){let i=this.buffer,r=this.valueSize,n=t*r+r,s=this.cumulativeWeight;if(s===0){for(let a=0;a!==r;++a)i[n+a]=i[a];s=e}else{s+=e;let a=e/s;this._mixBufferRegion(i,n,0,a,r)}this.cumulativeWeight=s}accumulateAdditive(t){let e=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){let e=this.valueSize,i=this.buffer,r=t*e+e,n=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){let o=e*this._origIndex;this._mixBufferRegion(i,r,o,1-n,e)}s>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*e,1,e);for(let o=e,l=e+e;o!==l;++o)if(i[o]!==i[o+e]){a.setValue(i,r);break}}saveOriginalState(){let t=this.binding,e=this.buffer,i=this.valueSize,r=i*this._origIndex;t.getValue(e,r);for(let n=i,s=r;n!==s;++n)e[n]=e[r+n%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){let t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,r,n){if(r>=.5)for(let s=0;s!==n;++s)t[e+s]=t[i+s]}_slerp(t,e,i,r){Ci.slerpFlat(t,e,t,e,t,i,r)}_slerpAdditive(t,e,i,r,n){let s=this._workIndex*n;Ci.multiplyQuaternionsFlat(t,s,t,e,t,i),Ci.slerpFlat(t,e,t,e,t,s,r)}_lerp(t,e,i,r,n){let s=1-r;for(let a=0;a!==n;++a){let o=e+a;t[o]=t[o]*s+t[i+a]*r}}_lerpAdditive(t,e,i,r,n){for(let s=0;s!==n;++s){let a=e+s;t[a]=t[a]+t[i+s]*r}}},DN="\\[\\]\\.:\\/",mde=new RegExp("["+DN+"]","g"),PN="[^"+DN+"]",gde="[^"+DN.replace("\\.","")+"]",vde=/((?:WC+[\/:])*)/.source.replace("WC",PN),yde=/(WCOD+)?/.source.replace("WCOD",gde),xde=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",PN),bde=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",PN),_de=new RegExp("^"+vde+yde+xde+bde+"$"),Sde=["material","materials","bones","map"],wde=class{constructor(t,e,i){let r=i||un.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}getValue(t,e){this.bind();let i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(t,e)}setValue(t,e){let i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(t,e)}bind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},un=class{constructor(t,e,i){this.path=e,this.parsedPath=i||un.parseTrackName(e),this.node=un.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new un.Composite(t,e,i):new un(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(mde,"")}static parseTrackName(t){let e=_de.exec(t);if(e===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);let i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){let n=i.nodeName.substring(r+1);Sde.indexOf(n)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=n)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(e===void 0||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){let i=t.skeleton.getBoneByName(e);if(i!==void 0)return i}if(t.children){let i=function(n){for(let s=0;s<n.length;s++){let a=n[s];if(a.name===e||a.uuid===e)return a;let o=i(a.children);if(o)return o}return null},r=i(t.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)t[e++]=i[r]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=t[e++]}_setValue_array_setNeedsUpdate(t,e){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node,e=this.parsedPath,i=e.objectName,r=e.propertyName,n=e.propertyIndex;if(t||(t=un.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let l=e.objectIndex;switch(i){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let c=0;c<t.length;c++)if(t[c].name===l){l=c;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[i]}if(l!==void 0){if(t[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[l]}}let s=t[r];if(s===void 0){let l=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+r+" but it wasn't found.",t);return}let a=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(n!==void 0){if(r==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[n]!==void 0&&(n=t.morphTargetDictionary[n])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else s.fromArray!==void 0&&s.toArray!==void 0?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};un.Composite=wde;un.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};un.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};un.prototype.GetterByBindingType=[un.prototype._getValue_direct,un.prototype._getValue_array,un.prototype._getValue_arrayElement,un.prototype._getValue_toArray];un.prototype.SetterByBindingTypeAndVersioning=[[un.prototype._setValue_direct,un.prototype._setValue_direct_setNeedsUpdate,un.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[un.prototype._setValue_array,un.prototype._setValue_array_setNeedsUpdate,un.prototype._setValue_array_setMatrixWorldNeedsUpdate],[un.prototype._setValue_arrayElement,un.prototype._setValue_arrayElement_setNeedsUpdate,un.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[un.prototype._setValue_fromArray,un.prototype._setValue_fromArray_setNeedsUpdate,un.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Mde=class{constructor(t,e,i=null,r=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=r;let n=e.tracks,s=n.length,a=new Array(s),o={endingStart:$x,endingEnd:$x};for(let l=0;l!==s;++l){let c=n[l].createInterpolant(null);a[l]=c,c.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=nq,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){let r=this._clip.duration,n=t._clip.duration,s=n/r,a=r/n;t.warp(1,s,e),this.warp(a,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){let t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){let r=this._mixer,n=r.time,s=this.timeScale,a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);let o=a.parameterPositions,l=a.sampleValues;return o[0]=n,o[1]=n+i,l[0]=t/s,l[1]=e/s,this}stopWarping(){let t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,r){if(!this.enabled){this._updateWeight(t);return}let n=this._startTime;if(n!==null){let o=(t-n)*i;o<0||i===0?e=0:(this._startTime=null,e=i*o)}e*=this._updateTimeScale(t);let s=this._updateTime(e),a=this._updateWeight(t);if(a>0){let o=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case $se:for(let c=0,u=o.length;c!==u;++c)o[c].evaluate(s),l[c].accumulateAdditive(a);break;case gN:default:for(let c=0,u=o.length;c!==u;++c)o[c].evaluate(s),l[c].accumulate(r,a)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;let i=this._weightInterpolant;if(i!==null){let r=i.evaluate(t)[0];e*=r,t>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;let i=this._timeScaleInterpolant;if(i!==null){let r=i.evaluate(t)[0];e*=r,t>i.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){let e=this._clip.duration,i=this.loop,r=this.time+t,n=this._loopCount,s=i===mN;if(t===0)return n===-1?r:s&&(n&1)===1?e-r:r;if(i===rq){n===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=e)r=e;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(n===-1&&(t>=0?(n=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),r>=e||r<0){let a=Math.floor(r/e);r-=e*a,n+=Math.abs(a);let o=this.repetitions-n;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(o===1){let l=t<0;this._setEndings(l,!l,s)}else this._setEndings(!1,!1,s);this._loopCount=n,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(s&&(n&1)===1)return e-r}return r}_setEndings(t,e,i){let r=this._interpolantSettings;i?(r.endingStart=e1,r.endingEnd=e1):(t?r.endingStart=this.zeroSlopeAtStart?e1:$x:r.endingStart=EC,e?r.endingEnd=this.zeroSlopeAtEnd?e1:$x:r.endingEnd=EC)}_scheduleFading(t,e,i){let r=this._mixer,n=r.time,s=this._weightInterpolant;s===null&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);let a=s.parameterPositions,o=s.sampleValues;return a[0]=n,o[0]=e,a[1]=n+t,o[1]=i,this}},Ede=new Float32Array(1),Ade=class extends lo{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){let i=t._localRoot||this._root,r=t._clip.tracks,n=r.length,s=t._propertyBindings,a=t._interpolants,o=i.uuid,l=this._bindingsByRootAndName,c=l[o];c===void 0&&(c={},l[o]=c);for(let u=0;u!==n;++u){let h=r[u],d=h.name,p=c[d];if(p!==void 0)++p.referenceCount,s[u]=p;else{if(p=s[u],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,o,d));continue}let g=e&&e._propertyBindings[u].binding.parsedPath;p=new pde(un.create(i,d,g),h.ValueTypeName,h.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,o,d),s[u]=p}a[u].resultBuffer=p.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){let i=(t._localRoot||this._root).uuid,r=t._clip.uuid,n=this._actionsByClip[r];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,r,i)}let e=t._propertyBindings;for(let i=0,r=e.length;i!==r;++i){let n=e[i];n.useCount++===0&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){let e=t._propertyBindings;for(let i=0,r=e.length;i!==r;++i){let n=e[i];--n.useCount===0&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){let e=t._cacheIndex;return e!==null&&e<this._nActiveActions}_addInactiveAction(t,e,i){let r=this._actions,n=this._actionsByClip,s=n[e];if(s===void 0)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,n[e]=s;else{let a=s.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=r.length,r.push(t),s.actionByRoot[i]=t}_removeInactiveAction(t){let e=this._actions,i=e[e.length-1],r=t._cacheIndex;i._cacheIndex=r,e[r]=i,e.pop(),t._cacheIndex=null;let n=t._clip.uuid,s=this._actionsByClip,a=s[n],o=a.knownActions,l=o[o.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),t._byClipCacheIndex=null;let u=a.actionByRoot,h=(t._localRoot||this._root).uuid;delete u[h],o.length===0&&delete s[n],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){let e=t._propertyBindings;for(let i=0,r=e.length;i!==r;++i){let n=e[i];--n.referenceCount===0&&this._removeInactiveBinding(n)}}_lendAction(t){let e=this._actions,i=t._cacheIndex,r=this._nActiveActions++,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_takeBackAction(t){let e=this._actions,i=t._cacheIndex,r=--this._nActiveActions,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_addInactiveBinding(t,e,i){let r=this._bindingsByRootAndName,n=this._bindings,s=r[e];s===void 0&&(s={},r[e]=s),s[i]=t,t._cacheIndex=n.length,n.push(t)}_removeInactiveBinding(t){let e=this._bindings,i=t.binding,r=i.rootNode.uuid,n=i.path,s=this._bindingsByRootAndName,a=s[r],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete a[n],Object.keys(a).length===0&&delete s[r]}_lendBinding(t){let e=this._bindings,i=t._cacheIndex,r=this._nActiveBindings++,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_takeBackBinding(t){let e=this._bindings,i=t._cacheIndex,r=--this._nActiveBindings,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_lendControlInterpolant(){let t=this._controlInterpolants,e=this._nActiveControlInterpolants++,i=t[e];return i===void 0&&(i=new Bq(new Float32Array(2),new Float32Array(2),1,Ede),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){let e=this._controlInterpolants,i=t.__cacheIndex,r=--this._nActiveControlInterpolants,n=e[r];t.__cacheIndex=r,e[r]=t,n.__cacheIndex=i,e[i]=n}clipAction(t,e,i){let r=e||this._root,n=r.uuid,s=typeof t=="string"?Uz.findByName(r,t):t,a=s!==null?s.uuid:t,o=this._actionsByClip[a],l=null;if(i===void 0&&(s!==null?i=s.blendMode:i=gN),o!==void 0){let u=o.actionByRoot[n];if(u!==void 0&&u.blendMode===i)return u;l=o.knownActions[0],s===null&&(s=l._clip)}if(s===null)return null;let c=new Mde(this,s,e,i);return this._bindAction(c,l),this._addInactiveAction(c,a,n),c}existingAction(t,e){let i=e||this._root,r=i.uuid,n=typeof t=="string"?Uz.findByName(i,t):t,s=n?n.uuid:t,a=this._actionsByClip[s];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){let t=this._actions,e=this._nActiveActions;for(let i=e-1;i>=0;--i)t[i].stop();return this}update(t){t*=this.timeScale;let e=this._actions,i=this._nActiveActions,r=this.time+=t,n=Math.sign(t),s=this._accuIndex^=1;for(let l=0;l!==i;++l)e[l]._update(r,t,n,s);let a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){let e=this._actions,i=t.uuid,r=this._actionsByClip,n=r[i];if(n!==void 0){let s=n.knownActions;for(let a=0,o=s.length;a!==o;++a){let l=s[a];this._deactivateAction(l);let c=l._cacheIndex,u=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,e[c]=u,e.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}}uncacheRoot(t){let e=t.uuid,i=this._actionsByClip;for(let s in i){let a=i[s].actionByRoot,o=a[e];o!==void 0&&(this._deactivateAction(o),this._removeInactiveAction(o))}let r=this._bindingsByRootAndName,n=r[e];if(n!==void 0)for(let s in n){let a=n[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(t,e){let i=this.existingAction(t,e);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}},At=class{constructor(t){this.value=t}clone(){return new At(this.value.clone===void 0?this.value:this.value.clone())}},Hq=class{constructor(t,e,i=0,r=1/0){this.ray=new ob(t,e),this.near=i,this.far=r,this.camera=null,this.layers=new yN,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,i=[]){return Nz(t,this,i,e),i.sort(BV),i}intersectObjects(t,e=!0,i=[]){for(let r=0,n=t.length;r<n;r++)Nz(t[r],this,i,e);return i.sort(BV),i}};function BV(t,e){return t.distance-e.distance}function Nz(t,e,i,r){if(t.layers.test(e.layers)&&t.raycast(e,i),r===!0){let n=t.children;for(let s=0,a=n.length;s<a;s++)Nz(n[s],e,i,!0)}}var NV=class{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(ks(e/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},FV=new Oe,RN=class{constructor(t=new Oe(1/0,1/0),e=new Oe(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){let i=FV.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return FV.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},kV=new W,jA=new W,nu=class{constructor(t=new W,e=new W){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){kV.subVectors(t,this.start),jA.subVectors(this.end,this.start);let i=jA.dot(jA),r=jA.dot(kV)/i;return e&&(r=ks(r,0,1)),r}closestPointToPoint(t,e,i){let r=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},VV=new W,Tde=class extends Kr{constructor(t,e){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";let i=new ni,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,o=32;s<o;s++,a++){let l=s/o*Math.PI*2,c=a/o*Math.PI*2;r.push(Math.cos(l),Math.sin(l),1,Math.cos(c),Math.sin(c),1)}i.setAttribute("position",new Wt(r,3));let n=new Rg({fog:!1,toneMapped:!1});this.cone=new bM(i,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),VV.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(VV),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Cde=class extends bn{constructor(t,e,i){let r=new p1(e,4,2),n=new Tp({wireframe:!0,fog:!1,toneMapped:!1});super(r,n),this.light=t,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},HV=new W,WA=new W,GV=new W,Dde=class extends Kr{constructor(t,e,i){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",e===void 0&&(e=1);let r=new ni;r.setAttribute("position",new Wt([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));let n=new Rg({fog:!1,toneMapped:!1});this.lightPlane=new CC(r,n),this.add(this.lightPlane),r=new ni,r.setAttribute("position",new Wt([0,0,0,0,0,1],3)),this.targetLine=new CC(r,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),HV.setFromMatrixPosition(this.light.matrixWorld),WA.setFromMatrixPosition(this.light.target.matrixWorld),GV.subVectors(WA,HV),this.lightPlane.lookAt(WA),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(WA),this.targetLine.scale.z=GV.length()}},qA=new W,ms=new Pg,IC=class extends bM{constructor(t){let e=new ni,i=new Rg({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(p,g){o(p),o(g)}function o(p){r.push(0,0,0),n.push(0,0,0),s[p]===void 0&&(s[p]=[]),s[p].push(r.length/3-1)}e.setAttribute("position",new Wt(r,3)),e.setAttribute("color",new Wt(n,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();let l=new bi(16755200),c=new bi(16711680),u=new bi(43775),h=new bi(16777215),d=new bi(3355443);this.setColors(l,c,u,h,d)}setColors(t,e,i,r,n){let s=this.geometry.getAttribute("color");s.setXYZ(0,t.r,t.g,t.b),s.setXYZ(1,t.r,t.g,t.b),s.setXYZ(2,t.r,t.g,t.b),s.setXYZ(3,t.r,t.g,t.b),s.setXYZ(4,t.r,t.g,t.b),s.setXYZ(5,t.r,t.g,t.b),s.setXYZ(6,t.r,t.g,t.b),s.setXYZ(7,t.r,t.g,t.b),s.setXYZ(8,t.r,t.g,t.b),s.setXYZ(9,t.r,t.g,t.b),s.setXYZ(10,t.r,t.g,t.b),s.setXYZ(11,t.r,t.g,t.b),s.setXYZ(12,t.r,t.g,t.b),s.setXYZ(13,t.r,t.g,t.b),s.setXYZ(14,t.r,t.g,t.b),s.setXYZ(15,t.r,t.g,t.b),s.setXYZ(16,t.r,t.g,t.b),s.setXYZ(17,t.r,t.g,t.b),s.setXYZ(18,t.r,t.g,t.b),s.setXYZ(19,t.r,t.g,t.b),s.setXYZ(20,t.r,t.g,t.b),s.setXYZ(21,t.r,t.g,t.b),s.setXYZ(22,t.r,t.g,t.b),s.setXYZ(23,t.r,t.g,t.b),s.setXYZ(24,e.r,e.g,e.b),s.setXYZ(25,e.r,e.g,e.b),s.setXYZ(26,e.r,e.g,e.b),s.setXYZ(27,e.r,e.g,e.b),s.setXYZ(28,e.r,e.g,e.b),s.setXYZ(29,e.r,e.g,e.b),s.setXYZ(30,e.r,e.g,e.b),s.setXYZ(31,e.r,e.g,e.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,n.r,n.g,n.b),s.setXYZ(41,n.r,n.g,n.b),s.setXYZ(42,n.r,n.g,n.b),s.setXYZ(43,n.r,n.g,n.b),s.setXYZ(44,n.r,n.g,n.b),s.setXYZ(45,n.r,n.g,n.b),s.setXYZ(46,n.r,n.g,n.b),s.setXYZ(47,n.r,n.g,n.b),s.setXYZ(48,n.r,n.g,n.b),s.setXYZ(49,n.r,n.g,n.b),s.needsUpdate=!0}update(){let t=this.geometry,e=this.pointMap,i=1,r=1;ms.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ms("c",e,t,ms,0,0,-1),Ms("t",e,t,ms,0,0,1),Ms("n1",e,t,ms,-1,-1,-1),Ms("n2",e,t,ms,i,-1,-1),Ms("n3",e,t,ms,-1,r,-1),Ms("n4",e,t,ms,i,r,-1),Ms("f1",e,t,ms,-1,-1,1),Ms("f2",e,t,ms,i,-1,1),Ms("f3",e,t,ms,-1,r,1),Ms("f4",e,t,ms,i,r,1),Ms("u1",e,t,ms,i*.7,r*1.1,-1),Ms("u2",e,t,ms,-1*.7,r*1.1,-1),Ms("u3",e,t,ms,0,r*2,-1),Ms("cf1",e,t,ms,-1,0,1),Ms("cf2",e,t,ms,i,0,1),Ms("cf3",e,t,ms,0,-1,1),Ms("cf4",e,t,ms,0,r,1),Ms("cn1",e,t,ms,-1,0,-1),Ms("cn2",e,t,ms,i,0,-1),Ms("cn3",e,t,ms,0,-1,-1),Ms("cn4",e,t,ms,0,r,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Ms(t,e,i,r,n,s,a){qA.set(n,s,a).unproject(r);let o=e[t];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],qA.x,qA.y,qA.z)}}var zC=class extends bM{constructor(t,e=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],n=new ni;n.setIndex(new _i(i,1)),n.setAttribute("position",new Wt(r,3)),super(n,new Rg({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){let e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}},Pde=class extends bM{constructor(t=1){let e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new ni;r.setAttribute("position",new Wt(e,3)),r.setAttribute("color",new Wt(i,3));let n=new Rg({vertexColors:!0,toneMapped:!1});super(r,n),this.type="AxesHelper"}setColors(t,e,i){let r=new bi,n=this.geometry.attributes.color.array;return r.set(t),r.toArray(n,0),r.toArray(n,3),r.set(e),r.toArray(n,6),r.toArray(n,9),r.set(i),r.toArray(n,12),r.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},cp=Rde();function Rde(){let t=new ArrayBuffer(4),e=new Float32Array(t),i=new Uint32Array(t),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){let c=l-127;c<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(r[l]=1024>>-c-14,r[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(r[l]=c+15<<10,r[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}let s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;(c&8388608)===0;)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:e,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function Ode(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=ks(t,-65504,65504),cp.floatView[0]=t;let e=cp.uint32View[0],i=e>>23&511;return cp.baseTable[i]+((e&8388607)>>cp.shiftTable[i])}function Lde(t){let e=t>>10;return cp.uint32View[0]=cp.mantissaTable[cp.offsetTable[e]+(t&1023)]+cp.exponentTable[e],cp.floatView[0]}var Ide=Object.freeze({__proto__:null,fromHalfFloat:Lde,toHalfFloat:Ode});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ab}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ab);var K_=".",ON=Symbol("target"),Gq=Symbol("unsubscribe");function Fz(t){return t instanceof Date||t instanceof Set||t instanceof Map||t instanceof WeakSet||t instanceof WeakMap||ArrayBuffer.isView(t)}function zde(t){return(typeof t=="object"?t===null:typeof t!="function")||t instanceof RegExp}var Dd=Array.isArray;function LN(t){return typeof t=="symbol"}var Ude={after:(t,e)=>Dd(t)?t.slice(e.length):e===""?t:t.slice(e.length+1),concat:(t,e)=>Dd(t)?(t=[...t],e&&t.push(e),t):e&&e.toString!==void 0?(t!==""&&(t+=K_),LN(e)?t+e.toString():t+e):t,initial:t=>{if(Dd(t))return t.slice(0,-1);if(t==="")return t;let e=t.lastIndexOf(K_);return e===-1?"":t.slice(0,e)},last:t=>{if(Dd(t))return t[t.length-1]||"";if(t==="")return t;let e=t.lastIndexOf(K_);return e===-1?t:t.slice(e+1)},walk:(t,e)=>{if(Dd(t))for(let i of t)e(i);else if(t!==""){let i=0,r=t.indexOf(K_);if(r===-1)e(t);else for(;i<t.length;)r===-1&&(r=t.length),e(t.slice(i,r)),i=r+1,r=t.indexOf(K_,i)}},get(t,e){return this.walk(e,i=>{t&&(t=t[i])}),t}},Qc=Ude;function Bde(t){return typeof t=="object"&&typeof t.next=="function"}function Nde(t,e,i,r,n){let s=t.next;if(e.name==="entries")t.next=function(){let a=s.call(this);return a.done===!1&&(a.value[0]=n(a.value[0],e,a.value[0],r),a.value[1]=n(a.value[1],e,a.value[0],r)),a};else if(e.name==="values"){let a=i[ON].keys();t.next=function(){let o=s.call(this);return o.done===!1&&(o.value=n(o.value,e,a.next().value,r)),o}}else t.next=function(){let a=s.call(this);return a.done===!1&&(a.value=n(a.value,e,a.value,r)),a};return t}function jV(t,e,i){return t.isUnsubscribed||e.ignoreSymbols&&LN(i)||e.ignoreUnderscores&&i.charAt(0)==="_"||"ignoreKeys"in e&&e.ignoreKeys.includes(i)}var Fde=class{constructor(t){this._equals=t,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(t){let e=this._getDescriptorCache(),i=e.get(t);return i===void 0&&(i={},e.set(t,i)),i}_getOwnPropertyDescriptor(t,e){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(t,e);let i=this._getProperties(t),r=i[e];return r===void 0&&(r=Reflect.getOwnPropertyDescriptor(t,e),i[e]=r),r}getProxy(t,e,i,r){if(this.isUnsubscribed)return t;let n=t[r],s=n||t;this._pathCache.set(s,e);let a=this._proxyCache.get(s);return a===void 0&&(a=n===void 0?new Proxy(t,i):t,this._proxyCache.set(s,a)),a}getPath(t){return this.isUnsubscribed?void 0:this._pathCache.get(t)}isDetached(t,e){return!Object.is(t,Qc.get(e,this.getPath(t)))}defineProperty(t,e,i){return Reflect.defineProperty(t,e,i)?(this.isUnsubscribed||(this._getProperties(t)[e]=i),!0):!1}setProperty(t,e,i,r,n){if(!this._equals(n,i)||!(e in t)){let s=this._getOwnPropertyDescriptor(t,e);return s!==void 0&&"set"in s?Reflect.set(t,e,i,r):Reflect.set(t,e,i)}return!0}deleteProperty(t,e,i){if(Reflect.deleteProperty(t,e)){if(!this.isUnsubscribed){let r=this._getDescriptorCache().get(t);r&&(delete r[e],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(t,e,i){let r=this._getOwnPropertyDescriptor(e,i);return t!==void 0&&r!==void 0&&Object.is(t.value,r.value)&&(t.writable||!1)===(r.writable||!1)&&(t.enumerable||!1)===(r.enumerable||!1)&&(t.configurable||!1)===(r.configurable||!1)&&t.get===r.get&&t.set===r.set}isGetInvariant(t,e){let i=this._getOwnPropertyDescriptor(t,e);return i!==void 0&&i.configurable!==!0&&i.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function kz(t){return toString.call(t)==="[object Object]"}function XA(){return!0}function ax(t,e){return t.length!==e.length||t.some((i,r)=>e[r]!==i)}var jq=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),kde=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),Wq={push:XA,pop:XA,shift:XA,unshift:XA,copyWithin:ax,reverse:ax,sort:ax,splice:ax,flat:ax,fill:ax},Vde=new Set([...jq,...kde,...Object.keys(Wq)]);function YA(t,e){if(t.size!==e.size)return!0;for(let i of t)if(!e.has(i))return!0;return!1}var qq=["keys","values","entries"],Xq=new Set(["has","toString"]),Yq={add:YA,clear:YA,delete:YA,forEach:YA},Hde=new Set([...Xq,...Object.keys(Yq),...qq]);function QA(t,e){if(t.size!==e.size)return!0;let i;for(let[r,n]of t)if(i=e.get(r),i!==n||i===void 0&&!e.has(r))return!0;return!1}var Gde=new Set([...Xq,"get"]),Qq={set:QA,clear:QA,delete:QA,forEach:QA},jde=new Set([...Gde,...Object.keys(Qq),...qq]),Sg=class{constructor(t,e,i,r){this._path=e,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=r,this._changes=r?[]:null,this.clone=e===void 0?t:this._shallowClone(t)}static isHandledMethod(t){return jq.has(t)}_shallowClone(t){let e=t;if(kz(t))e={...t};else if(Dd(t))e=[...t];else if(t instanceof Date)e=new Date(t);else if(t instanceof Set)e=new Set([...t].map(i=>this._shallowClone(i)));else if(t instanceof Map){e=new Map;for(let[i,r]of t.entries())e.set(i,this._shallowClone(r))}return this._clonedCache.add(e),e}preferredThisArg(t,e,i,r){return t?(Dd(r)?this._onIsChanged=Wq[e]:r instanceof Set?this._onIsChanged=Yq[e]:r instanceof Map&&(this._onIsChanged=Qq[e]),r):i}update(t,e,i){let r=Qc.after(t,this._path);if(e!=="length"){let n=this.clone;Qc.walk(r,s=>{n&&n[s]&&(this._clonedCache.has(n[s])||(n[s]=this._shallowClone(n[s])),n=n[s])}),this._hasOnValidate&&this._changes.push({path:r,property:e,previous:i}),n&&n[e]&&(n[e]=i)}this._isChanged=!0}undo(t){let e;for(let i=this._changes.length-1;i!==-1;i--)e=this._changes[i],Qc.get(t,e.path)[e.property]=e.previous}isChanged(t){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,t)}},WV=class extends Sg{static isHandledMethod(t){return Vde.has(t)}},Wde=class extends Sg{undo(t){t.setTime(this.clone.getTime())}isChanged(t,e){return!e(this.clone.valueOf(),t.valueOf())}},qV=class extends Sg{static isHandledMethod(t){return Hde.has(t)}undo(t){for(let e of this.clone)t.add(e);for(let e of t)this.clone.has(e)||t.delete(e)}},XV=class extends Sg{static isHandledMethod(t){return jde.has(t)}undo(t){for(let[e,i]of this.clone.entries())t.set(e,i);for(let e of t.keys())this.clone.has(e)||t.delete(e)}},qde=class extends Sg{constructor(t,e,i,r){super(void 0,e,i,r),this._arg1=i[0],this._weakValue=t.has(this._arg1)}isChanged(t){return this._weakValue!==t.has(this._arg1)}undo(t){this._weakValue&&!t.has(this._arg1)?t.add(this._arg1):t.delete(this._arg1)}},Xde=class extends Sg{constructor(t,e,i,r){super(void 0,e,i,r),this._weakKey=i[0],this._weakHas=t.has(this._weakKey),this._weakValue=t.get(this._weakKey)}isChanged(t){return this._weakValue!==t.get(this._weakKey)}undo(t){let e=t.has(this._weakKey);this._weakHas&&!e?t.set(this._weakKey,this._weakValue):!this._weakHas&&e?t.delete(this._weakKey):this._weakValue!==t.get(this._weakKey)&&t.set(this._weakKey,this._weakValue)}},Xx=class{constructor(t){this._stack=[],this._hasOnValidate=t}static isHandledType(t){return kz(t)||Dd(t)||Fz(t)}static isHandledMethod(t,e){return kz(t)?Sg.isHandledMethod(e):Dd(t)?WV.isHandledMethod(e):t instanceof Set?qV.isHandledMethod(e):t instanceof Map?XV.isHandledMethod(e):Fz(t)}get isCloning(){return this._stack.length>0}start(t,e,i){let r=Sg;Dd(t)?r=WV:t instanceof Date?r=Wde:t instanceof Set?r=qV:t instanceof Map?r=XV:t instanceof WeakSet?r=qde:t instanceof WeakMap&&(r=Xde),this._stack.push(new r(t,e,i,this._hasOnValidate))}update(t,e,i){this._stack[this._stack.length-1].update(t,e,i)}preferredThisArg(t,e,i){let{name:r}=t,n=Xx.isHandledMethod(i,r);return this._stack[this._stack.length-1].preferredThisArg(n,r,e,i)}isChanged(t,e,i){return this._stack[this._stack.length-1].isChanged(t,e,i)}undo(t){this._previousClone!==void 0&&this._previousClone.undo(t)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},Yde={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},IN=(t,e,i={})=>{i={...Yde,...i};let r=Symbol("ProxyTarget"),{equals:n,isShallow:s,ignoreDetached:a,details:o}=i,l=new Fde(n),c=typeof i.onValidate=="function",u=new Xx(c),h=(w,M,E,D,T)=>!c||u.isCloning||i.onValidate(Qc.concat(l.getPath(w),M),E,D,T)===!0,d=(w,M,E,D)=>{!jV(l,i,M)&&!(a&&l.isDetached(w,t))&&p(l.getPath(w),M,E,D)},p=(w,M,E,D,T)=>{u.isCloning?u.update(w,M,D):e(Qc.concat(w,M),E,D,T)},g=w=>w&&(w[r]||w),x=(w,M,E,D)=>zde(w)||E==="constructor"||s&&!Xx.isHandledMethod(M,E)||jV(l,i,E)||l.isGetInvariant(M,E)||a&&l.isDetached(M,t)?w:(D===void 0&&(D=l.getPath(M)),l.getProxy(w,Qc.concat(D,E),v,r)),v={get(w,M,E){if(LN(M)){if(M===r||M===ON)return w;if(M===Gq&&!l.isUnsubscribed&&l.getPath(w).length===0)return l.unsubscribe(),w}let D=Fz(w)?Reflect.get(w,M):Reflect.get(w,M,E);return x(D,w,M)},set(w,M,E,D){E=g(E);let T=w[r]||w,L=T[M];if(n(L,E)&&M in w)return!0;let P=h(w,M,E,L);return P&&l.setProperty(T,M,E,D,L)?(d(w,M,w[M],L),!0):!P},defineProperty(w,M,E){if(!l.isSameDescriptor(E,w,M)){let D=w[M];h(w,M,E.value,D)&&l.defineProperty(w,M,E,D)&&d(w,M,E.value,D)}return!0},deleteProperty(w,M){if(!Reflect.has(w,M))return!0;let E=Reflect.get(w,M),D=h(w,M,void 0,E);return D&&l.deleteProperty(w,M,E)?(d(w,M,void 0,E),!0):!D},apply(w,M,E){let D=M[r]||M;if(l.isUnsubscribed)return Reflect.apply(w,D,E);if((o===!1||o!==!0&&!o.includes(w.name))&&Xx.isHandledType(D)){let T=Qc.initial(l.getPath(w)),L=Xx.isHandledMethod(D,w.name);u.start(D,T,E);let P=Reflect.apply(w,u.preferredThisArg(w,M,D),L?E.map(U=>g(U)):E),R=u.isChanged(D,n),O=u.stop();if(Xx.isHandledType(P)&&L&&(M instanceof Map&&w.name==="get"&&(T=Qc.concat(T,E[0])),P=l.getProxy(P,T,v)),R){let U={name:w.name,args:E,result:P},F=u.isCloning?Qc.initial(T):T,V=u.isCloning?Qc.last(T):"";h(Qc.get(t,F),V,D,O,U)?p(F,V,D,O,U):u.undo(D)}return(M instanceof Map||M instanceof Set)&&Bde(P)?Nde(P,w,M,T,x):P}return Reflect.apply(w,M,E)}},b=l.getProxy(t,i.pathAsArray?[]:"",v);return e=e.bind(b),c&&(i.onValidate=i.onValidate.bind(b)),b};IN.target=t=>t&&t[ON]||t;IN.unsubscribe=t=>t[Gq]||t;var YV=IN,Qde=typeof global=="object"&&global&&global.Object===Object&&global,Zq=Qde,Zde=typeof self=="object"&&self&&self.Object===Object&&self,Kde=Zq||Zde||Function("return this")(),wh=Kde,Jde=wh.Symbol,ou=Jde,Kq=Object.prototype,$de=Kq.hasOwnProperty,efe=Kq.toString,J_=ou?ou.toStringTag:void 0;function tfe(t){var e=$de.call(t,J_),i=t[J_];try{t[J_]=void 0;var r=!0}catch{}var n=efe.call(t);return r&&(e?t[J_]=i:delete t[J_]),n}var ife=tfe,rfe=Object.prototype,nfe=rfe.toString;function sfe(t){return nfe.call(t)}var afe=sfe,ofe="[object Null]",lfe="[object Undefined]",QV=ou?ou.toStringTag:void 0;function cfe(t){return t==null?t===void 0?lfe:ofe:QV&&QV in Object(t)?ife(t):afe(t)}var Q0=cfe;function ufe(t){return t!=null&&typeof t=="object"}var Cp=ufe,hfe="[object Symbol]";function dfe(t){return typeof t=="symbol"||Cp(t)&&Q0(t)==hfe}var MM=dfe;function ffe(t,e){for(var i=-1,r=t==null?0:t.length,n=Array(r);++i<r;)n[i]=e(t[i],i,t);return n}var Jq=ffe,pfe=Array.isArray,Wd=pfe,ZV=ou?ou.prototype:void 0,KV=ZV?ZV.toString:void 0;function $q(t){if(typeof t=="string")return t;if(Wd(t))return Jq(t,$q)+"";if(MM(t))return KV?KV.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var mfe=$q,gfe=/\s/;function vfe(t){for(var e=t.length;e--&&gfe.test(t.charAt(e)););return e}var yfe=vfe,xfe=/^\s+/;function bfe(t){return t&&t.slice(0,yfe(t)+1).replace(xfe,"")}var _fe=bfe;function Sfe(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var xh=Sfe,JV=NaN,wfe=/^[-+]0x[0-9a-f]+$/i,Mfe=/^0b[01]+$/i,Efe=/^0o[0-7]+$/i,Afe=parseInt;function Tfe(t){if(typeof t=="number")return t;if(MM(t))return JV;if(xh(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=xh(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=_fe(t);var i=Mfe.test(t);return i||Efe.test(t)?Afe(t.slice(2),i?2:8):wfe.test(t)?JV:+t}var $V=Tfe;function Cfe(t){return t}var eX=Cfe,Dfe="[object AsyncFunction]",Pfe="[object Function]",Rfe="[object GeneratorFunction]",Ofe="[object Proxy]";function Lfe(t){if(!xh(t))return!1;var e=Q0(t);return e==Pfe||e==Rfe||e==Dfe||e==Ofe}var tX=Lfe,Ife=wh["__core-js_shared__"],AO=Ife,e6=function(){var t=/[^.]+$/.exec(AO&&AO.keys&&AO.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function zfe(t){return!!e6&&e6 in t}var Ufe=zfe,Bfe=Function.prototype,Nfe=Bfe.toString;function Ffe(t){if(t!=null){try{return Nfe.call(t)}catch{}try{return t+""}catch{}}return""}var Z0=Ffe,kfe=/[\\^$.*+?()[\]{}|]/g,Vfe=/^\[object .+?Constructor\]$/,Hfe=Function.prototype,Gfe=Object.prototype,jfe=Hfe.toString,Wfe=Gfe.hasOwnProperty,qfe=RegExp("^"+jfe.call(Wfe).replace(kfe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Xfe(t){if(!xh(t)||Ufe(t))return!1;var e=tX(t)?qfe:Vfe;return e.test(Z0(t))}var Yfe=Xfe;function Qfe(t,e){return t==null?void 0:t[e]}var Zfe=Qfe;function Kfe(t,e){var i=Zfe(t,e);return Yfe(i)?i:void 0}var K0=Kfe,Jfe=K0(wh,"WeakMap"),Vz=Jfe,t6=Object.create,$fe=function(){function t(){}return function(e){if(!xh(e))return{};if(t6)return t6(e);t.prototype=e;var i=new t;return t.prototype=void 0,i}}(),epe=$fe;function tpe(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}var ipe=tpe;function rpe(t,e){var i=-1,r=t.length;for(e||(e=Array(r));++i<r;)e[i]=t[i];return e}var npe=rpe,spe=800,ape=16,ope=Date.now;function lpe(t){var e=0,i=0;return function(){var r=ope(),n=ape-(r-i);if(i=r,n>0){if(++e>=spe)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var cpe=lpe;function upe(t){return function(){return t}}var hpe=upe,dpe=function(){try{var t=K0(Object,"defineProperty");return t({},"",{}),t}catch{}}(),UC=dpe,fpe=UC?function(t,e){return UC(t,"toString",{configurable:!0,enumerable:!1,value:hpe(e),writable:!0})}:eX,ppe=fpe,mpe=cpe(ppe),gpe=mpe;function vpe(t,e){for(var i=-1,r=t==null?0:t.length;++i<r&&e(t[i],i,t)!==!1;);return t}var ype=vpe,xpe=9007199254740991,bpe=/^(?:0|[1-9]\d*)$/;function _pe(t,e){var i=typeof t;return e=e??xpe,!!e&&(i=="number"||i!="symbol"&&bpe.test(t))&&t>-1&&t%1==0&&t<e}var zN=_pe;function Spe(t,e,i){e=="__proto__"&&UC?UC(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}var iX=Spe;function wpe(t,e){return t===e||t!==t&&e!==e}var UN=wpe,Mpe=Object.prototype,Epe=Mpe.hasOwnProperty;function Ape(t,e,i){var r=t[e];(!(Epe.call(t,e)&&UN(r,i))||i===void 0&&!(e in t))&&iX(t,e,i)}var BN=Ape;function Tpe(t,e,i,r){var n=!i;i||(i={});for(var s=-1,a=e.length;++s<a;){var o=e[s],l=r?r(i[o],t[o],o,i,t):void 0;l===void 0&&(l=t[o]),n?iX(i,o,l):BN(i,o,l)}return i}var EM=Tpe,i6=Math.max;function Cpe(t,e,i){return e=i6(e===void 0?t.length-1:e,0),function(){for(var r=arguments,n=-1,s=i6(r.length-e,0),a=Array(s);++n<s;)a[n]=r[e+n];n=-1;for(var o=Array(e+1);++n<e;)o[n]=r[n];return o[e]=i(a),ipe(t,this,o)}}var Dpe=Cpe,Ppe=9007199254740991;function Rpe(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Ppe}var NN=Rpe;function Ope(t){return t!=null&&NN(t.length)&&!tX(t)}var rX=Ope,Lpe=Object.prototype;function Ipe(t){var e=t&&t.constructor,i=typeof e=="function"&&e.prototype||Lpe;return t===i}var FN=Ipe;function zpe(t,e){for(var i=-1,r=Array(t);++i<t;)r[i]=e(i);return r}var Upe=zpe,Bpe="[object Arguments]";function Npe(t){return Cp(t)&&Q0(t)==Bpe}var r6=Npe,nX=Object.prototype,Fpe=nX.hasOwnProperty,kpe=nX.propertyIsEnumerable,Vpe=r6(function(){return arguments}())?r6:function(t){return Cp(t)&&Fpe.call(t,"callee")&&!kpe.call(t,"callee")},kN=Vpe;function Hpe(){return!1}var Gpe=Hpe,sX=typeof exports=="object"&&exports&&!exports.nodeType&&exports,n6=sX&&typeof module=="object"&&module&&!module.nodeType&&module,jpe=n6&&n6.exports===sX,s6=jpe?wh.Buffer:void 0,Wpe=s6?s6.isBuffer:void 0,qpe=Wpe||Gpe,BC=qpe,Xpe="[object Arguments]",Ype="[object Array]",Qpe="[object Boolean]",Zpe="[object Date]",Kpe="[object Error]",Jpe="[object Function]",$pe="[object Map]",eme="[object Number]",tme="[object Object]",ime="[object RegExp]",rme="[object Set]",nme="[object String]",sme="[object WeakMap]",ame="[object ArrayBuffer]",ome="[object DataView]",lme="[object Float32Array]",cme="[object Float64Array]",ume="[object Int8Array]",hme="[object Int16Array]",dme="[object Int32Array]",fme="[object Uint8Array]",pme="[object Uint8ClampedArray]",mme="[object Uint16Array]",gme="[object Uint32Array]",In={};In[lme]=In[cme]=In[ume]=In[hme]=In[dme]=In[fme]=In[pme]=In[mme]=In[gme]=!0;In[Xpe]=In[Ype]=In[ame]=In[Qpe]=In[ome]=In[Zpe]=In[Kpe]=In[Jpe]=In[$pe]=In[eme]=In[tme]=In[ime]=In[rme]=In[nme]=In[sme]=!1;function vme(t){return Cp(t)&&NN(t.length)&&!!In[Q0(t)]}var yme=vme;function xme(t){return function(e){return t(e)}}var VN=xme,aX=typeof exports=="object"&&exports&&!exports.nodeType&&exports,QS=aX&&typeof module=="object"&&module&&!module.nodeType&&module,bme=QS&&QS.exports===aX,TO=bme&&Zq.process,_me=function(){try{var t=QS&&QS.require&&QS.require("util").types;return t||TO&&TO.binding&&TO.binding("util")}catch{}}(),L1=_me,a6=L1&&L1.isTypedArray,Sme=a6?VN(a6):yme,oX=Sme,wme=Object.prototype,Mme=wme.hasOwnProperty;function Eme(t,e){var i=Wd(t),r=!i&&kN(t),n=!i&&!r&&BC(t),s=!i&&!r&&!n&&oX(t),a=i||r||n||s,o=a?Upe(t.length,String):[],l=o.length;for(var c in t)(e||Mme.call(t,c))&&!(a&&(c=="length"||n&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||zN(c,l)))&&o.push(c);return o}var lX=Eme;function Ame(t,e){return function(i){return t(e(i))}}var cX=Ame,Tme=cX(Object.keys,Object),Cme=Tme,Dme=Object.prototype,Pme=Dme.hasOwnProperty;function Rme(t){if(!FN(t))return Cme(t);var e=[];for(var i in Object(t))Pme.call(t,i)&&i!="constructor"&&e.push(i);return e}var Ome=Rme;function Lme(t){return rX(t)?lX(t):Ome(t)}var HN=Lme;function Ime(t){var e=[];if(t!=null)for(var i in Object(t))e.push(i);return e}var zme=Ime,Ume=Object.prototype,Bme=Ume.hasOwnProperty;function Nme(t){if(!xh(t))return zme(t);var e=FN(t),i=[];for(var r in t)r=="constructor"&&(e||!Bme.call(t,r))||i.push(r);return i}var Fme=Nme;function kme(t){return rX(t)?lX(t,!0):Fme(t)}var a0=kme,Vme=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hme=/^\w*$/;function Gme(t,e){if(Wd(t))return!1;var i=typeof t;return i=="number"||i=="symbol"||i=="boolean"||t==null||MM(t)?!0:Hme.test(t)||!Vme.test(t)||e!=null&&t in Object(e)}var jme=Gme,Wme=K0(Object,"create"),Dw=Wme;function qme(){this.__data__=Dw?Dw(null):{},this.size=0}var Xme=qme;function Yme(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Qme=Yme,Zme="__lodash_hash_undefined__",Kme=Object.prototype,Jme=Kme.hasOwnProperty;function $me(t){var e=this.__data__;if(Dw){var i=e[t];return i===Zme?void 0:i}return Jme.call(e,t)?e[t]:void 0}var ege=$me,tge=Object.prototype,ige=tge.hasOwnProperty;function rge(t){var e=this.__data__;return Dw?e[t]!==void 0:ige.call(e,t)}var nge=rge,sge="__lodash_hash_undefined__";function age(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=Dw&&e===void 0?sge:e,this}var oge=age;function db(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}db.prototype.clear=Xme;db.prototype.delete=Qme;db.prototype.get=ege;db.prototype.has=nge;db.prototype.set=oge;var o6=db;function lge(){this.__data__=[],this.size=0}var cge=lge;function uge(t,e){for(var i=t.length;i--;)if(UN(t[i][0],e))return i;return-1}var U3=uge,hge=Array.prototype,dge=hge.splice;function fge(t){var e=this.__data__,i=U3(e,t);if(i<0)return!1;var r=e.length-1;return i==r?e.pop():dge.call(e,i,1),--this.size,!0}var pge=fge;function mge(t){var e=this.__data__,i=U3(e,t);return i<0?void 0:e[i][1]}var gge=mge;function vge(t){return U3(this.__data__,t)>-1}var yge=vge;function xge(t,e){var i=this.__data__,r=U3(i,t);return r<0?(++this.size,i.push([t,e])):i[r][1]=e,this}var bge=xge;function fb(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}fb.prototype.clear=cge;fb.prototype.delete=pge;fb.prototype.get=gge;fb.prototype.has=yge;fb.prototype.set=bge;var B3=fb,_ge=K0(wh,"Map"),Pw=_ge;function Sge(){this.size=0,this.__data__={hash:new o6,map:new(Pw||B3),string:new o6}}var wge=Sge;function Mge(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var Ege=Mge;function Age(t,e){var i=t.__data__;return Ege(e)?i[typeof e=="string"?"string":"hash"]:i.map}var N3=Age;function Tge(t){var e=N3(this,t).delete(t);return this.size-=e?1:0,e}var Cge=Tge;function Dge(t){return N3(this,t).get(t)}var Pge=Dge;function Rge(t){return N3(this,t).has(t)}var Oge=Rge;function Lge(t,e){var i=N3(this,t),r=i.size;return i.set(t,e),this.size+=i.size==r?0:1,this}var Ige=Lge;function pb(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}pb.prototype.clear=wge;pb.prototype.delete=Cge;pb.prototype.get=Pge;pb.prototype.has=Oge;pb.prototype.set=Ige;var F3=pb,zge="Expected a function";function GN(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(zge);var i=function(){var r=arguments,n=e?e.apply(this,r):r[0],s=i.cache;if(s.has(n))return s.get(n);var a=t.apply(this,r);return i.cache=s.set(n,a)||s,a};return i.cache=new(GN.Cache||F3),i}GN.Cache=F3;var Uge=GN,Bge=500;function Nge(t){var e=Uge(t,function(r){return i.size===Bge&&i.clear(),r}),i=e.cache;return e}var Fge=Nge,kge=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Vge=/\\(\\)?/g,Hge=Fge(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(kge,function(i,r,n,s){e.push(n?s.replace(Vge,"$1"):r||i)}),e}),Gge=Hge;function jge(t){return t==null?"":mfe(t)}var Wge=jge;function qge(t,e){return Wd(t)?t:jme(t,e)?[t]:Gge(Wge(t))}var mb=qge;function Xge(t){if(typeof t=="string"||MM(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var k3=Xge;function Yge(t,e){e=mb(e,t);for(var i=0,r=e.length;t!=null&&i<r;)t=t[k3(e[i++])];return i&&i==r?t:void 0}var uX=Yge;function Qge(t,e){for(var i=-1,r=e.length,n=t.length;++i<r;)t[n+i]=e[i];return t}var jN=Qge,l6=ou?ou.isConcatSpreadable:void 0;function Zge(t){return Wd(t)||kN(t)||!!(l6&&t&&t[l6])}var Kge=Zge;function hX(t,e,i,r,n){var s=-1,a=t.length;for(i||(i=Kge),n||(n=[]);++s<a;){var o=t[s];e>0&&i(o)?e>1?hX(o,e-1,i,r,n):jN(n,o):r||(n[n.length]=o)}return n}var Jge=hX;function $ge(t){var e=t==null?0:t.length;return e?Jge(t,1):[]}var eve=$ge;function tve(t){return gpe(Dpe(t,void 0,eve),t+"")}var dX=tve,ive=cX(Object.getPrototypeOf,Object),WN=ive,rve="[object Object]",nve=Function.prototype,sve=Object.prototype,fX=nve.toString,ave=sve.hasOwnProperty,ove=fX.call(Object);function lve(t){if(!Cp(t)||Q0(t)!=rve)return!1;var e=WN(t);if(e===null)return!0;var i=ave.call(e,"constructor")&&e.constructor;return typeof i=="function"&&i instanceof i&&fX.call(i)==ove}var cve=lve;function uve(t,e,i){var r=-1,n=t.length;e<0&&(e=-e>n?0:n+e),i=i>n?n:i,i<0&&(i+=n),n=e>i?0:i-e>>>0,e>>>=0;for(var s=Array(n);++r<n;)s[r]=t[r+e];return s}var hve=uve;function dve(){this.__data__=new B3,this.size=0}var fve=dve;function pve(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}var mve=pve;function gve(t){return this.__data__.get(t)}var vve=gve;function yve(t){return this.__data__.has(t)}var xve=yve,bve=200;function _ve(t,e){var i=this.__data__;if(i instanceof B3){var r=i.__data__;if(!Pw||r.length<bve-1)return r.push([t,e]),this.size=++i.size,this;i=this.__data__=new F3(r)}return i.set(t,e),this.size=i.size,this}var Sve=_ve;function gb(t){var e=this.__data__=new B3(t);this.size=e.size}gb.prototype.clear=fve;gb.prototype.delete=mve;gb.prototype.get=vve;gb.prototype.has=xve;gb.prototype.set=Sve;var QT=gb;function wve(t,e){return t&&EM(e,HN(e),t)}var Mve=wve;function Eve(t,e){return t&&EM(e,a0(e),t)}var Ave=Eve,pX=typeof exports=="object"&&exports&&!exports.nodeType&&exports,c6=pX&&typeof module=="object"&&module&&!module.nodeType&&module,Tve=c6&&c6.exports===pX,u6=Tve?wh.Buffer:void 0,h6=u6?u6.allocUnsafe:void 0;function Cve(t,e){if(e)return t.slice();var i=t.length,r=h6?h6(i):new t.constructor(i);return t.copy(r),r}var Dve=Cve;function Pve(t,e){for(var i=-1,r=t==null?0:t.length,n=0,s=[];++i<r;){var a=t[i];e(a,i,t)&&(s[n++]=a)}return s}var Rve=Pve;function Ove(){return[]}var mX=Ove,Lve=Object.prototype,Ive=Lve.propertyIsEnumerable,d6=Object.getOwnPropertySymbols,zve=d6?function(t){return t==null?[]:(t=Object(t),Rve(d6(t),function(e){return Ive.call(t,e)}))}:mX,qN=zve;function Uve(t,e){return EM(t,qN(t),e)}var Bve=Uve,Nve=Object.getOwnPropertySymbols,Fve=Nve?function(t){for(var e=[];t;)jN(e,qN(t)),t=WN(t);return e}:mX,gX=Fve;function kve(t,e){return EM(t,gX(t),e)}var Vve=kve;function Hve(t,e,i){var r=e(t);return Wd(t)?r:jN(r,i(t))}var vX=Hve;function Gve(t){return vX(t,HN,qN)}var Hz=Gve;function jve(t){return vX(t,a0,gX)}var yX=jve,Wve=K0(wh,"DataView"),Gz=Wve,qve=K0(wh,"Promise"),jz=qve,Xve=K0(wh,"Set"),Wz=Xve,f6="[object Map]",Yve="[object Object]",p6="[object Promise]",m6="[object Set]",g6="[object WeakMap]",v6="[object DataView]",Qve=Z0(Gz),Zve=Z0(Pw),Kve=Z0(jz),Jve=Z0(Wz),$ve=Z0(Vz),qv=Q0;(Gz&&qv(new Gz(new ArrayBuffer(1)))!=v6||Pw&&qv(new Pw)!=f6||jz&&qv(jz.resolve())!=p6||Wz&&qv(new Wz)!=m6||Vz&&qv(new Vz)!=g6)&&(qv=function(t){var e=Q0(t),i=e==Yve?t.constructor:void 0,r=i?Z0(i):"";if(r)switch(r){case Qve:return v6;case Zve:return f6;case Kve:return p6;case Jve:return m6;case $ve:return g6}return e});var Rw=qv,e0e=Object.prototype,t0e=e0e.hasOwnProperty;function i0e(t){var e=t.length,i=new t.constructor(e);return e&&typeof t[0]=="string"&&t0e.call(t,"index")&&(i.index=t.index,i.input=t.input),i}var r0e=i0e,n0e=wh.Uint8Array,NC=n0e;function s0e(t){var e=new t.constructor(t.byteLength);return new NC(e).set(new NC(t)),e}var XN=s0e;function a0e(t,e){var i=e?XN(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}var o0e=a0e,l0e=/\w*$/;function c0e(t){var e=new t.constructor(t.source,l0e.exec(t));return e.lastIndex=t.lastIndex,e}var u0e=c0e,y6=ou?ou.prototype:void 0,x6=y6?y6.valueOf:void 0;function h0e(t){return x6?Object(x6.call(t)):{}}var d0e=h0e;function f0e(t,e){var i=e?XN(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}var p0e=f0e,m0e="[object Boolean]",g0e="[object Date]",v0e="[object Map]",y0e="[object Number]",x0e="[object RegExp]",b0e="[object Set]",_0e="[object String]",S0e="[object Symbol]",w0e="[object ArrayBuffer]",M0e="[object DataView]",E0e="[object Float32Array]",A0e="[object Float64Array]",T0e="[object Int8Array]",C0e="[object Int16Array]",D0e="[object Int32Array]",P0e="[object Uint8Array]",R0e="[object Uint8ClampedArray]",O0e="[object Uint16Array]",L0e="[object Uint32Array]";function I0e(t,e,i){var r=t.constructor;switch(e){case w0e:return XN(t);case m0e:case g0e:return new r(+t);case M0e:return o0e(t,i);case E0e:case A0e:case T0e:case C0e:case D0e:case P0e:case R0e:case O0e:case L0e:return p0e(t,i);case v0e:return new r;case y0e:case _0e:return new r(t);case x0e:return u0e(t);case b0e:return new r;case S0e:return d0e(t)}}var z0e=I0e;function U0e(t){return typeof t.constructor=="function"&&!FN(t)?epe(WN(t)):{}}var B0e=U0e,N0e="[object Map]";function F0e(t){return Cp(t)&&Rw(t)==N0e}var k0e=F0e,b6=L1&&L1.isMap,V0e=b6?VN(b6):k0e,H0e=V0e,G0e="[object Set]";function j0e(t){return Cp(t)&&Rw(t)==G0e}var W0e=j0e,_6=L1&&L1.isSet,q0e=_6?VN(_6):W0e,X0e=q0e,Y0e=1,Q0e=2,Z0e=4,xX="[object Arguments]",K0e="[object Array]",J0e="[object Boolean]",$0e="[object Date]",eye="[object Error]",bX="[object Function]",tye="[object GeneratorFunction]",iye="[object Map]",rye="[object Number]",_X="[object Object]",nye="[object RegExp]",sye="[object Set]",aye="[object String]",oye="[object Symbol]",lye="[object WeakMap]",cye="[object ArrayBuffer]",uye="[object DataView]",hye="[object Float32Array]",dye="[object Float64Array]",fye="[object Int8Array]",pye="[object Int16Array]",mye="[object Int32Array]",gye="[object Uint8Array]",vye="[object Uint8ClampedArray]",yye="[object Uint16Array]",xye="[object Uint32Array]",An={};An[xX]=An[K0e]=An[cye]=An[uye]=An[J0e]=An[$0e]=An[hye]=An[dye]=An[fye]=An[pye]=An[mye]=An[iye]=An[rye]=An[_X]=An[nye]=An[sye]=An[aye]=An[oye]=An[gye]=An[vye]=An[yye]=An[xye]=!0;An[eye]=An[bX]=An[lye]=!1;function ZT(t,e,i,r,n,s){var a,o=e&Y0e,l=e&Q0e,c=e&Z0e;if(i&&(a=n?i(t,r,n,s):i(t)),a!==void 0)return a;if(!xh(t))return t;var u=Wd(t);if(u){if(a=r0e(t),!o)return npe(t,a)}else{var h=Rw(t),d=h==bX||h==tye;if(BC(t))return Dve(t,o);if(h==_X||h==xX||d&&!n){if(a=l||d?{}:B0e(t),!o)return l?Vve(t,Ave(a,t)):Bve(t,Mve(a,t))}else{if(!An[h])return n?t:{};a=z0e(t,h,o)}}s||(s=new QT);var p=s.get(t);if(p)return p;s.set(t,a),X0e(t)?t.forEach(function(v){a.add(ZT(v,e,i,v,t,s))}):H0e(t)&&t.forEach(function(v,b){a.set(b,ZT(v,e,i,b,t,s))});var g=c?l?yX:Hz:l?a0:HN,x=u?void 0:g(t);return ype(x||t,function(v,b){x&&(b=v,v=t[b]),BN(a,b,ZT(v,e,i,b,t,s))}),a}var SX=ZT,bye=1,_ye=4;function Sye(t){return SX(t,bye|_ye)}var V3=Sye,wye="__lodash_hash_undefined__";function Mye(t){return this.__data__.set(t,wye),this}var Eye=Mye;function Aye(t){return this.__data__.has(t)}var Tye=Aye;function FC(t){var e=-1,i=t==null?0:t.length;for(this.__data__=new F3;++e<i;)this.add(t[e])}FC.prototype.add=FC.prototype.push=Eye;FC.prototype.has=Tye;var Cye=FC;function Dye(t,e){for(var i=-1,r=t==null?0:t.length;++i<r;)if(e(t[i],i,t))return!0;return!1}var Pye=Dye;function Rye(t,e){return t.has(e)}var Oye=Rye,Lye=1,Iye=2;function zye(t,e,i,r,n,s){var a=i&Lye,o=t.length,l=e.length;if(o!=l&&!(a&&l>o))return!1;var c=s.get(t),u=s.get(e);if(c&&u)return c==e&&u==t;var h=-1,d=!0,p=i&Iye?new Cye:void 0;for(s.set(t,e),s.set(e,t);++h<o;){var g=t[h],x=e[h];if(r)var v=a?r(x,g,h,e,t,s):r(g,x,h,t,e,s);if(v!==void 0){if(v)continue;d=!1;break}if(p){if(!Pye(e,function(b,w){if(!Oye(p,w)&&(g===b||n(g,b,i,r,s)))return p.push(w)})){d=!1;break}}else if(!(g===x||n(g,x,i,r,s))){d=!1;break}}return s.delete(t),s.delete(e),d}var wX=zye;function Uye(t){var e=-1,i=Array(t.size);return t.forEach(function(r,n){i[++e]=[n,r]}),i}var Bye=Uye;function Nye(t){var e=-1,i=Array(t.size);return t.forEach(function(r){i[++e]=r}),i}var Fye=Nye,kye=1,Vye=2,Hye="[object Boolean]",Gye="[object Date]",jye="[object Error]",Wye="[object Map]",qye="[object Number]",Xye="[object RegExp]",Yye="[object Set]",Qye="[object String]",Zye="[object Symbol]",Kye="[object ArrayBuffer]",Jye="[object DataView]",S6=ou?ou.prototype:void 0,CO=S6?S6.valueOf:void 0;function $ye(t,e,i,r,n,s,a){switch(i){case Jye:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Kye:return!(t.byteLength!=e.byteLength||!s(new NC(t),new NC(e)));case Hye:case Gye:case qye:return UN(+t,+e);case jye:return t.name==e.name&&t.message==e.message;case Xye:case Qye:return t==e+"";case Wye:var o=Bye;case Yye:var l=r&kye;if(o||(o=Fye),t.size!=e.size&&!l)return!1;var c=a.get(t);if(c)return c==e;r|=Vye,a.set(t,e);var u=wX(o(t),o(e),r,n,s,a);return a.delete(t),u;case Zye:if(CO)return CO.call(t)==CO.call(e)}return!1}var exe=$ye,txe=1,ixe=Object.prototype,rxe=ixe.hasOwnProperty;function nxe(t,e,i,r,n,s){var a=i&txe,o=Hz(t),l=o.length,c=Hz(e),u=c.length;if(l!=u&&!a)return!1;for(var h=l;h--;){var d=o[h];if(!(a?d in e:rxe.call(e,d)))return!1}var p=s.get(t),g=s.get(e);if(p&&g)return p==e&&g==t;var x=!0;s.set(t,e),s.set(e,t);for(var v=a;++h<l;){d=o[h];var b=t[d],w=e[d];if(r)var M=a?r(w,b,d,e,t,s):r(b,w,d,t,e,s);if(!(M===void 0?b===w||n(b,w,i,r,s):M)){x=!1;break}v||(v=d=="constructor")}if(x&&!v){var E=t.constructor,D=e.constructor;E!=D&&"constructor"in t&&"constructor"in e&&!(typeof E=="function"&&E instanceof E&&typeof D=="function"&&D instanceof D)&&(x=!1)}return s.delete(t),s.delete(e),x}var sxe=nxe,axe=1,w6="[object Arguments]",M6="[object Array]",ZA="[object Object]",oxe=Object.prototype,E6=oxe.hasOwnProperty;function lxe(t,e,i,r,n,s){var a=Wd(t),o=Wd(e),l=a?M6:Rw(t),c=o?M6:Rw(e);l=l==w6?ZA:l,c=c==w6?ZA:c;var u=l==ZA,h=c==ZA,d=l==c;if(d&&BC(t)){if(!BC(e))return!1;a=!0,u=!1}if(d&&!u)return s||(s=new QT),a||oX(t)?wX(t,e,i,r,n,s):exe(t,e,l,i,r,n,s);if(!(i&axe)){var p=u&&E6.call(t,"__wrapped__"),g=h&&E6.call(e,"__wrapped__");if(p||g){var x=p?t.value():t,v=g?e.value():e;return s||(s=new QT),n(x,v,i,r,s)}}return d?(s||(s=new QT),sxe(t,e,i,r,n,s)):!1}var cxe=lxe;function MX(t,e,i,r,n){return t===e?!0:t==null||e==null||!Cp(t)&&!Cp(e)?t!==t&&e!==e:cxe(t,e,i,r,MX,n)}var uxe=MX;function hxe(t,e){return t!=null&&e in Object(t)}var dxe=hxe;function fxe(t,e,i){e=mb(e,t);for(var r=-1,n=e.length,s=!1;++r<n;){var a=k3(e[r]);if(!(s=t!=null&&i(t,a)))break;t=t[a]}return s||++r!=n?s:(n=t==null?0:t.length,!!n&&NN(n)&&zN(a,n)&&(Wd(t)||kN(t)))}var pxe=fxe;function mxe(t,e){return t!=null&&pxe(t,e,dxe)}var gxe=mxe,vxe=function(){return wh.Date.now()},DO=vxe,yxe="Expected a function",xxe=Math.max,bxe=Math.min;function _xe(t,e,i){var r,n,s,a,o,l,c=0,u=!1,h=!1,d=!0;if(typeof t!="function")throw new TypeError(yxe);e=$V(e)||0,xh(i)&&(u=!!i.leading,h="maxWait"in i,s=h?xxe($V(i.maxWait)||0,e):s,d="trailing"in i?!!i.trailing:d);function p(T){var L=r,P=n;return r=n=void 0,c=T,a=t.apply(P,L),a}function g(T){return c=T,o=setTimeout(b,e),u?p(T):a}function x(T){var L=T-l,P=T-c,R=e-L;return h?bxe(R,s-P):R}function v(T){var L=T-l,P=T-c;return l===void 0||L>=e||L<0||h&&P>=s}function b(){var T=DO();if(v(T))return w(T);o=setTimeout(b,x(T))}function w(T){return o=void 0,d&&r?p(T):(r=n=void 0,a)}function M(){o!==void 0&&clearTimeout(o),c=0,r=l=n=o=void 0}function E(){return o===void 0?a:w(DO())}function D(){var T=DO(),L=v(T);if(r=arguments,n=this,l=T,L){if(o===void 0)return g(l);if(h)return clearTimeout(o),o=setTimeout(b,e),p(l)}return o===void 0&&(o=setTimeout(b,e)),a}return D.cancel=M,D.flush=E,D}var Ow=_xe;function Sxe(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}var wxe=Sxe;function Mxe(t,e){return t>e}var Exe=Mxe;function Axe(t,e){return e.length<2?t:uX(t,hve(e,0,-1))}var Txe=Axe;function Cxe(t,e){return uxe(t,e)}var YN=Cxe;function Dxe(t,e,i){for(var r=-1,n=t.length;++r<n;){var s=t[r],a=e(s);if(a!=null&&(o===void 0?a===a&&!MM(a):i(a,o)))var o=a,l=s}return l}var Pxe=Dxe;function Rxe(t){return t&&t.length?Pxe(t,eX,Exe):void 0}var Oxe=Rxe;function Lxe(t,e){return e=mb(e,t),t=Txe(t,e),t==null||delete t[k3(wxe(e))]}var Ixe=Lxe;function zxe(t){return cve(t)?void 0:t}var Uxe=zxe,Bxe=1,Nxe=2,Fxe=4,kxe=dX(function(t,e){var i={};if(t==null)return i;var r=!1;e=Jq(e,function(s){return s=mb(s,t),r||(r=s.length>1),s}),EM(t,yX(t),i),r&&(i=SX(i,Bxe|Nxe|Fxe,Uxe));for(var n=e.length;n--;)Ixe(i,e[n]);return i}),qz=kxe;function Vxe(t,e,i,r){if(!xh(t))return t;e=mb(e,t);for(var n=-1,s=e.length,a=s-1,o=t;o!=null&&++n<s;){var l=k3(e[n]),c=i;if(l==="__proto__"||l==="constructor"||l==="prototype")return t;if(n!=a){var u=o[l];c=r?r(u,l,o):void 0,c===void 0&&(c=xh(u)?u:zN(e[n+1])?[]:{})}BN(o,l,c),o=o[l]}return t}var Hxe=Vxe;function Gxe(t,e,i){for(var r=-1,n=e.length,s={};++r<n;){var a=e[r],o=uX(t,a);i(o,a)&&Hxe(s,mb(a,t),o)}return s}var jxe=Gxe;function Wxe(t,e){return jxe(t,e,function(i,r){return gxe(t,r)})}var qxe=Wxe,Xxe=dX(function(t,e){return t==null?{}:qxe(t,e)}),Ud=Xxe,Yxe="Expected a function";function Qxe(t,e,i){var r=!0,n=!0;if(typeof t!="function")throw new TypeError(Yxe);return xh(i)&&(r="leading"in i?!!i.leading:r,n="trailing"in i?!!i.trailing:n),Ow(t,e,{leading:r,maxWait:e,trailing:n})}var Zxe=Qxe;function EX(t){for(let e of Object.keys(t))t[e]===void 0&&delete t[e];return t}function lu(t,e){return Object.setPrototypeOf(t,e),t}var Kxe=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes(" electron/"),Jxe=()=>typeof window>"u"?!1:window.navigator.platform.toUpperCase().includes("MAC"),$xe=()=>typeof window>"u"?!1:/iPad|iPhone|iPod/.test(window.navigator.userAgent)||H3&&"ontouchend"in document,e1e=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,t1e=()=>typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0,i1e=()=>{if(typeof window>"u")return!1;let t=navigator.userAgent,e=navigator.vendor;return/Safari/i.test(t)&&/Apple Computer/.test(e)},r1e=()=>{if(typeof window>"u")return null;let t=navigator.userAgent.match(/Version\/(\d+\.\d)/);return t&&t[1]},n1e=()=>{if(typeof window>"u")return;let t=new URLSearchParams(window.location.search).get("desktop-app-version");return t?(window.localStorage.setItem("desktop-app-version",t),t):window.localStorage.getItem("desktop-app-version")??"0.0.6"},AX=Kxe();AX&&n1e();var H3=Jxe(),AM=$xe(),s1e=e1e(),vc=t1e(),A6=i1e(),a1e=Number(r1e());function TX(t){return Array.isArray(t)?t:[t]}function CX(t,e){let i=0;for(;i<t.length&&i<e.length;){if(t[i]<e[i])return-1;if(t[i]>e[i])return 1;i+=1}return i!==e.length?-1:i!==t.length?1:0}function KA(t){return H3?t.metaKey:t.ctrlKey}function o1e(t){return t.wheelDeltaY===0||t.deltaY===0?H3&&t.shiftKey&&Math.abs(t.wheelDeltaX)>=120?!1:t.wheelDeltaX?t.wheelDeltaX===-3*t.deltaX||t.wheelDeltaX===-3*window.devicePixelRatio*t.deltaX:t.deltaMode===0:t.wheelDeltaY?t.wheelDeltaY===-3*t.deltaY||t.wheelDeltaY===-3*window.devicePixelRatio*t.deltaY:t.deltaMode===0}var Ai=[],kC={},LS={},KT={};function DX(t){Ai.includes(t)||Ai.push(t)}function m1(t){delete kC[t.pointerId];for(let e=0;e<Ai.length;e++)if(Ai[e].pointerId===t.pointerId){Ai.splice(e,1);break}}function l1e(){Ai.splice(0,Ai.length)}function VC(t){if(t.pointerType!=="touch")return;let e=kC[t.pointerId];e===void 0&&(e={x:0,y:0},kC[t.pointerId]=e),e.x=t.pageX,e.y=t.pageY}function PO(t){let e=t.pointerId===Ai[0].pointerId?Ai[1]:Ai[0];return kC[e.pointerId]}function PX(t){LS[t.key]=!0,KT[t.key]=KT[t.key]===void 0?1:KT[t.key]+1}function RX(t){if(H3&&LS.Meta)for(let e in LS)LS[e]=!1;else LS[t.key]=!1;KT={}}function c1e(t){t.addEventListener("pointerdown",DX,!0),t.addEventListener("pointerdown",VC,!0),t.addEventListener("pointermove",VC,!0),t.addEventListener("pointerup",m1,!0),t.addEventListener("pointercancel",m1,!0),t.addEventListener("pointerleave",m1,!0),window.addEventListener("keydown",PX,!0),window.addEventListener("keyup",RX,!0)}function u1e(t){t.removeEventListener("pointerdown",DX,!0),t.removeEventListener("pointerdown",VC,!0),t.removeEventListener("pointermove",VC,!0),t.removeEventListener("pointerup",m1,!0),t.removeEventListener("pointercancel",m1,!0),t.removeEventListener("pointerleave",m1,!0),window.removeEventListener("keydown",PX,!0),window.removeEventListener("keyup",RX,!0)}var OX,h1e=new Promise(t=>{OX=t}),JA;function d1e(){if(JA)return JA;async function t(){let e="https://unpkg.com/@splinetool/navmesh-wasm@1.9.82/build",i=Cg(()=>import("./navmesh-BFd9Mv4x.js"),[]),[r,n]=await Promise.all([i,fetch(`${e}/navmesh.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});OX(a)}return JA=t(),JA}var LX,f1e=new Promise(t=>{LX=t}),$A;function p1e(){if($A)return $A;async function t(){let e=await Cg(()=>import("./physics-BM4kW-A5.js"),[]);await e.init(),LX(e)}return $A=t(),$A}var xi=class{modifyById(t,e){let i=this;if(i[t]===void 0)throw new Error("not expected");{let r={...i,[t]:e};return Object.setPrototypeOf(r,xi.prototype),r}}add(t,e){var i;return((i=this.runOp({type:1,id:t,data:e}))==null?void 0:i.data)??this}runOp(t){let e=this;if(t.type===1){let i=e[t.id],r;i===void 0?r={type:2,id:t.id}:r={type:1,id:t.id,data:i};let{id:n,data:s}=t,a={...e,[n]:s};return Object.setPrototypeOf(a,xi.prototype),{data:a,actual:t,reverse:r}}else if(t.type===2){let{id:i}=t,r=e[i];if(r===void 0)return null;{let n={...e};return Object.setPrototypeOf(n,xi.prototype),delete n[i],{data:n,actual:t,reverse:{type:1,id:i,data:r}}}}return null}};function QN(t){if(t.deepFreeze!==void 0){t.deepFreeze(t);return}let e=Object.getOwnPropertyNames(t);for(let i of e){let r=t[i];r&&typeof r=="object"&&QN(r)}return Object.freeze(t)}function m1e(t,e){let i=0;for(;i<t.length&&i<e.length;){if(t[i]<e[i])return-1;if(t[i]>e[i])return 1;i+=1}return i!==e.length?-1:i!==t.length?1:0}var IX=class extends Error{};function RO(t){let e={...t};return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),e}function ng(t,e,i){if(t===void 0?e===void 0?(t=0,e=10):t=e-10:e===void 0&&(e=t+10),t>e){let s=t;t=e,e=s}let r=[],n=1/(i+1);for(let s=0;s<i;s++){let a=t+(e-t)*(s+.75+Math.random()*.5)*n;r.push(a)}return r}function ZN(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array}function g1e(){return typeof process<"u"}function zX(t,e){for(let i of t)e(i.id,i.data)!==!0&&zX(i.children,e)}function UX(t,e){if(e(t.id,t.data)!==!0)for(let i of t.children)UX(i,e)}var eo=class extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,eo.prototype)}deepFreeze(){let t=0;for(;t<this.length;)QN(this[t]),t++}fillCaches0(t,e){this.objCaches.set(t.id,t),this.parentCaches.set(t.id,e);for(let i of t.children)this.fillCaches0(i,t.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let t of this)this.fillCaches0(t,null)}}randomId(){this.fillCaches();let t=Array.from(this.objCaches.keys());if(t.length!==0)return t[Math.max(0,Math.floor(Math.random()*t.length)-1)]}nonExistOrDescendantOf(t,e){if(!this.has(t))return!0;for(;t;){let i=this.parent(t);if(i===e)return!0;t=i}return!1}rootAcestor(t){for(;t;){let e=this.parent(t);if(e)t=e;else return t}return t}isDescendantOf(t,e){for(;t;){let i=this.parent(t);if(i===e)return!0;t=i}return!1}data(t){var e;return(e=this.get(t))==null?void 0:e.data}has(t){return this.childrenOf(t)!==void 0}get(t){return this.fillCaches(),this.objCaches.get(t)}childrenOf(t){var e;return t===null?this:(e=this.get(t))==null?void 0:e.children}traverseFrom(t,e){if(t===null)this.traverse(e);else{let i=this.get(t);i&&UX(i,e)}}traverse(t){zX(this,t)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(t){return this.fillCaches(),this.parentCaches.get(t)}childrenArray(t){return t===null?this:this.get(t).children}modifyById(t,e){if(this.get(t)===void 0)throw new Error("not expected");{let i=this.parent(t),r=this.childrenArray(i),n=r.findIndex(a=>a.id===t);if(n<0)throw new Error("not expected");let s=r[n];return r=[...r],r[n]={...s,data:e},this.modifyArrayBy(i,r)}}modifyArrayBy(t,e){let i=t,r=e;for(;i!==null;){let s=r,a=i;if(i=this.parent(i),i===void 0)throw new Error;r=this.childrenArray(i);let o=r.findIndex(l=>l.id===a);if(o<0)throw new Error;r=[...r],r[o]={...r[o],children:s}}Object.setPrototypeOf(r,eo.prototype);let n=r;return n.fillCaches(),n}runOp(t){switch(t.type){case 7:return this.addOp(t);case 8:return this.deleteOp(t);case 9:return this.moveOp(t)}return null}checkDuplicatedIdRec({id:t,children:e}){if(this.get(t)!==void 0)return!0;for(let i of e)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(t){let{parent:e,fi:i,id:r,data:n,children:s}=t;if(e!==null&&this.get(e)===void 0||this.checkDuplicatedIdRec(t))return null;{let a=e,o=this.childrenArray(a),l={fi:i,id:r,data:n,children:s};return o=[...o,l],o.sort((c,u)=>c.fi-u.fi),t.localIndex=o.indexOf(l),{data:this.modifyArrayBy(a,o),actual:t,reverse:{type:8,id:r}}}}deleteOp(t){let{id:e}=t;if(this.get(e)===null)return null;{let i=this.parent(e);if(i===void 0)return null;let r=this.childrenArray(i),n=r.findIndex(a=>a.id===e);t.localIndex=n,r=[...r];let s=r.splice(n,1)[0];return{data:this.modifyArrayBy(i,r),actual:t,reverse:{type:7,...s,parent:i}}}}moveOp(t){let{parent:e,fi:i,id:r}=t;if(e!==null&&this.get(e)===void 0)return this.deleteOp({type:8,id:r});if(e!==null){let h=e;for(;h!==null;){if(h===void 0)throw new Error;if(h===r)throw new IX("cyclic tree");h=this.parent(h)}}let n=this.parent(r);if(n===void 0)return null;let s=n,a=this.childrenArray(n),o=a.findIndex(h=>h.id===r);a=[...a];let l=a.splice(o,1)[0],c=this.modifyArrayBy(n,a);n=e,a=c.childrenArray(n);let u=l.fi;return l={...l,fi:i},a=[...a,l],a.sort((h,d)=>h.fi-d.fi),t.localIndex=a.indexOf(l),c=c.modifyArrayBy(n,a),{data:c,actual:t,reverse:{type:9,parent:s,fi:u,id:r}}}previous(t,e){if(e===null){let r=this.childrenArray(t);return r.length===0?null:r[r.length-1].id}let i=null;for(let r of this.childrenArray(t)){if(r.id===e)return i;i=r.id}return null}traverseSortNext(t){let e=this.parent(t);if(e!==void 0){let i=this.childrenArray(e),r=i.findIndex(n=>n.id===t)+1;if(r<i.length)return i[r].id;if(e)return this.traverseSortNext(e)}}sortNext(t){let e=this.childrenArray(t);return e.length>0?e[0].id:this.traverseSortNext(t)}traverseSortPrevious(t){let e=this.childrenArray(t);return e.length>0?this.traverseSortPrevious(e[e.length-1].id):t}sortPrevious(t){let e=this.parent(t);if(e!==void 0){let i=this.childrenArray(e),r=i.findIndex(n=>n.id===t)-1;return r>=0?this.traverseSortPrevious(i[r].id):e}}getAllSorted(t){let e=[];for(let i of t){let r=this.getWithSortKey(i.id);r!==void 0&&e.push({...i,...r})}e.sort((i,r)=>m1e(i.sortKey,r.sortKey));for(let i of e)delete i.sortKey;return e}getWithSortKey(t){var e=t;let i=[],r=this.get(e),n=r;if(r!==void 0){for(;e;)i.splice(0,0,r.fi),e=this.parent(e),e!==null&&(r=this.get(e));return{...n,sortKey:i}}}insertBeforeHelper(t,e,i){return this.insertAfterHelper(t,this.previous(t,e),i)}insertAfterHelper(t,e,i){let r=this.childrenArray(t);if(e===null){if(r.length===0)return ng(0,i,i);{let n=r[0].fi;return ng(n-i,n,i)}}else{let n=this.get(e);if(n===void 0||this.parent(e)!==t)throw new Error("illegal args");let s=r.find(a=>a.fi>n.fi);if(s===void 0){let a=r[r.length-1].fi;return ng(a,a+i,i)}else return ng(n.fi,s.fi,i)}}},HC;(t=>{function e(i,r){if(r.type!==0)return null;if(Array.isArray(i)){let n=r.props,s={},a=[...i],o=!1;if(n)for(let l of Object.keys(n)){let c=parseInt(l);if(isNaN(c))throw new Error("wrong index");s[l]=a[c],a[c]=n[l],o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}else{let n=r.props,s={},a={...i},o=!1;if(n)for(let l of Object.keys(n)){s[l]=a[l];let c=n[l];c===void 0?delete a[l]:a[l]=c,o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}}t.runOp=e})(HC||(HC={}));var ai=class extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,ai.prototype)}deepFreeze(){let t=0;for(;t<this.length;)QN(this[t]),t++}fillCaches0(t){this.objCaches.set(t.id,t)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let t of this)this.fillCaches0(t)}}randomId(){this.fillCaches();let t=Array.from(this.objCaches.keys());if(t.length!==0)return t[Math.max(0,Math.floor(Math.random()*t.length)-1)]}data(t){var e;return(e=this.get(t))==null?void 0:e.data}get(t){return this.fillCaches(),this.objCaches.get(t)}modifyById(t,e){if(this.get(t)===void 0)throw new Error("not expected");{let i=this,r=i.findIndex(s=>s.id===t);if(r<0)throw new Error("not expected");let n=i[r];return i=[...i],i[r]={...n,data:e},this.modifyArrayBy(i)}}modifyArrayBy(t){Object.setPrototypeOf(t,ai.prototype);let e=t;return g1e()||e.fillCaches(),e}runOp(t){switch(t.type){case 4:return this.addOp(t);case 5:return this.deleteOp(t);case 6:return this.moveOp(t)}return null}addOp(t){let{fi:e,id:i,data:r}=t,n=this,s={fi:e,id:i,data:r};return n=[...n,s],n.sort((a,o)=>a.fi-o.fi),t.localIndex=n.indexOf(s),{data:this.modifyArrayBy(n),actual:t,reverse:{type:5,id:i}}}deleteOp(t){let{id:e}=t,i=this,r=i.findIndex(s=>s.id===e);if(r===-1)return null;t.localIndex=r,i=[...i];let n=i.splice(r,1)[0];return{data:this.modifyArrayBy(i),actual:t,reverse:{type:4,...n}}}moveOp(t){let{fi:e,id:i}=t,r=this;r=[...r];let n=r.findIndex(o=>o.id===i);if(n===-1)return null;let s=r[n].fi,a={...r[n],fi:e};return r[n]=a,r.sort((o,l)=>o.fi-l.fi),t.localIndex=r.indexOf(a),{data:this.modifyArrayBy(r),actual:t,reverse:{type:6,fi:s,id:i}}}previous(t){if(t===null)return this.length===0?null:this[this.length-1].id;let e=null;for(let i of this){if(i.id===t)return e;e=i.id}return null}insertBeforeHelper(t,e){return this.insertAfterHelper(this.previous(t),e)}insertAfterHelper(t,e){let i=this;if(t===null){if(i.length===0)return ng(0,e,e);{let r=i[0].fi;return ng(r-e,r,e)}}else{let r=this.get(t);if(r===void 0)throw new Error("illegal args");let n=i.find(s=>s.fi>r.fi);if(n===void 0){let s=i[i.length-1].fi;return ng(s,s+e,e)}else return ng(r.fi,n.fi,e)}}};function I1(t){return t&&typeof t=="object"&&t instanceof Ws}var Ws=class{unusedFunOverridesTable(t){}runOp(t){let e=[],i=this,r=0,n={};for(;r<t.path.length;){if(e.push(i),i=i===void 0?void 0:i[t.path[r]],i!==void 0&&!I1(i))return null;r+=1}i=i?RO(i):new Ws;for(let[o,l]of Object.entries(t.props)){let c=i[o];n[o]=c,l===void 0?delete i[o]:i[o]=l}for(;r>0;){if(Object.keys(i).length===0){let o=e[r-1];o&&(i=RO(o),delete i[t.path[r-1]])}else{let o=e[r-1];if(o){let l=RO(o);l[t.path[r-1]]=i,i=l}else{let l=new Ws;l[t.path[r-1]]=i,i=l}}r-=1}let s=Object.setPrototypeOf(i,Ws.prototype),a={...t,props:n};return{data:s,actual:t,reverse:a}}},pg;(t=>{function e(n,s){return Lw(n,s)??n}t.apply=e;function i(n,s){return JN(n,s)}t.merge=i;function r(n,s){let a=0,o=s.path,l=n;for(;a<o.length&&l!==void 0;){if(l=ra.zoomOnce(l,o[a]),l===void 0)return s;if(!I1(l))return;a+=1}if(l===void 0)return s;if(I1(l))if(s.type===0){let c={...s.props};for(let u of Object.keys(l))delete c[u];return{...s,props:c}}else if(s.type===1||s.type===4||s.type===7){let c=KN([s],l);return c?(console.log(c),c):s}else return s}t.filterOp=r})(pg||(pg={}));function KN(t,e){if(e===void 0)return;let i=!1,r=t.map(n=>{let s=n.id,a=Lw(n.data,e[s]);if(i=i||a!==void 0,a===void 0&&(a=n.data),n.children){let o=KN(n.children,e);return o!==void 0?i=!0:o=n.children,{...n,id:s,data:a,children:o}}else return{...n,id:s,data:a}});if(i)return r}function v1e(t,e){if(e===void 0)return;let i=!1,r=t.map(n=>{let s=n.id,a=Lw(n.data,e[s]);return i=i||a!==void 0,a===void 0&&(a=n.data),{...n,id:s,data:a}});if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r}function Lw(t,e){if(!I1(e))return e;if(t instanceof eo){let i=KN(t,e);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(t)),i}else{if(t instanceof ai)return v1e(t,e);if(Array.isArray(t)){let i=!1,r=t.map((n,s)=>{let a=Lw(n,e[s]);return i=i||a!==void 0,a===void 0&&(a=n),a});return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r):void 0}else{if(t instanceof Ws)return JN(t,e);if(t&&typeof t=="object"){let i={},r=!1;for(let[n,s]of Object.entries(t)){let a=Lw(s,e[n]);r=r||a!==void 0,a===void 0&&(a=s),i[n]=a}return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(t)),i):void 0}}}}function JN(t,e){if(t===void 0)return e;if(e===void 0)return t;if(!I1(e))return e;if(!I1(t))return pg.apply(t,e);let i=new Set;for(let n of Object.keys(t))i.add(n);for(let n of Object.keys(e))i.add(n);let r=new Ws;for(let n of i){let s=JN(t===void 0?void 0:t[n],e===void 0?void 0:e[n]);r[n]=s}return r}function y1e(t,e){let i={cur:[],result:[],len:0};return t=Iw(t,e,i)??t,[t,i.result]}function GC(t,e){return t===null?null:(t.cur[t.len]=e,t.len+=1,t)}function jC(t){t&&(t.len-=1)}function x1e(t){if(t===null)return null;t.result.push(t.cur.slice(0,t.len))}function BX(t,e,i){let r=!1,n=t.map(s=>{let a=s.id,o=e[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=Iw(s.data,e,GC(i,a));jC(i),r=r||l!==void 0,l===void 0&&(l=s.data);let c=BX(s.children,e,i);return c!==void 0?r=!0:c=s.children,{...s,id:a,data:l,children:c}});if(r)return n}function b1e(t,e,i){let r=!1,n=t.map(s=>{let a=s.id,o=e[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=Iw(s.data,e,GC(i,a));return jC(i),r=r||l!==void 0,l===void 0&&(l=s.data),{...s,id:a,data:l}});if(r)return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),n}function Iw(t,e,i){if(t instanceof eo){let r=BX(t,e,i);return r!==void 0&&Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r}else{if(t instanceof ai)return b1e(t,e,i);if(Array.isArray(t)){let r=!1,n=t.map((s,a)=>{let o=Iw(s,e,GC(i,a));return jC(i),r=r||o!==void 0,o===void 0&&(o=s),o});return r?(Object.setPrototypeOf(n,Object.getPrototypeOf(t)),n):void 0}else if(t&&typeof t=="object"&&!ZN(t)){let r={},n=!1;for(let[s,a]of Object.entries(t))if(s!=="name"&&s!=="variableId"){let o=e[s];if(typeof o=="string"){if(i!==null)throw new Error("not supported");n=!0,s=o}let l=Iw(a,e,GC(i,s));jC(i),n=n||l!==void 0,l===void 0&&(l=a),r[s]=l}else r[s]=a;return n?(Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r):void 0}else if(typeof t=="string"){let r=e[t];return r!==void 0&&x1e(i),r}else return}}var WC;(t=>{function e(i,r){let n=ra.zoom(r,i.path);if(typeof n=="object"){let s={};for(let a of Object.keys(i.props))s[a]=n[a];return{...i,props:s}}else return{...i,props:{}}}t.replaceProps=e})(WC||(WC={}));var Ra;(t=>{function e(l,c){return{...l,path:l.path.slice(c)}}t.drop=e;function i(l,c){var u;return((u=r(l,c))==null?void 0:u.data)??l}t.applySimple=i;function r(l,c){var d,p;let u=c.path;for(var h=[];;){let g;if(l instanceof Ws&&c.type===0&&(g=l.runOp({...c,path:u.slice(h.length)}),g===null&&(g=void 0)),g===void 0&&h.length===u.length&&(l instanceof eo||l instanceof ai||l instanceof xi?g=l.runOp(c):g=HC.runOp(l,c)),g!==void 0)if(g!==null){let b=g.data;for(let w=h.length-1;w>=0;w--){let M=u[w],E=h[w];if(E instanceof eo){if(typeof M=="number")throw new Error("illegal arg");b=E.modifyById(M,b)}else if(E instanceof ai){if(typeof M=="number")throw new Error("illegal arg");b=E.modifyById(M,b)}else if(E instanceof xi){if(typeof M=="number")throw new Error("illegal arg");b=E.modifyById(M,b)}else if(E instanceof Ws){let D={...E,[M]:b};b=Object.setPrototypeOf(D,Ws.prototype)}else if(typeof E=="object")if(Array.isArray(E)){if(typeof M=="string"&&(M=parseInt(M),isNaN(M)))throw new Error("Invalid path");let D=b;b=[...E],b[M]=D}else b={...E,[M]:b};else return null}return{data:b,actual:{...g.actual,path:u},reverse:{...g.reverse,path:u}}}else return null;let x=u[h.length],v;if(l instanceof eo){if(typeof x=="number")throw new Error("");v=(d=l.get(x))==null?void 0:d.data}else if(l instanceof ai){if(typeof x=="number")throw new Error("");v=(p=l.get(x))==null?void 0:p.data}else l!==null&&(v=l[x]);if(v!==void 0)h.push(l),l=v;else return null}}t.apply=r;function n(l,c){for(let u=0;u<l.length&&u<c.length;u++)if(l[u]!==c[u])return!0;return!1}t.pathDisjoint=n;function s(l,c){if(l.length!==c.length)return!1;for(let u=0;u<l.length;u++)if(l[u]!==c[u])return!1;return!0}t.pathEq=s;function a(l,c){return n(l.path,c.path)}t.commutative=a;function o(l,c){return l.type===0&&c.type===0&&s(l.path,c.path)?Object.keys(l.props).every(u=>c.props[u]!==void 0):!1}t.subsumed=o})(Ra||(Ra={}));var Xz;(t=>{function e(){return[]}t.empty=e;function i(c,u){let h=[];for(let d of c){let[p,...g]=d.path;p===u&&h.push({...d,path:g})}return h}t.removePrefix=i;function r(c,u){return c.map(h=>({...h,path:[u,...h.path]}))}t.addPrefix=r;function n(c,u){return[...c,...u]}t.concat=n;function s(c,u){return[...c.filter(h=>!u.some(d=>Ra.subsumed(h,d))),...u]}t.compress=s;function a(c,u){return c.every(h=>u.every(d=>Ra.commutative(h,d)))}t.commutative=a;function o(c,u){for(let h of u){let d=l(c,h);d!==null&&(c=d.data)}return c}t.applyAll=o;function l(c,u){var h=c;let d=[],p=[];for(let g of u)try{if(g.type===3||g.type===5&&g.path[g.path.length-1]==="variables"){let x,v,b;if(g.type===3?(x=ra.zoom(h,[...g.path,g.id]),b=Ra.apply(h,{...g,type:2})):(x=ra.zoom(h,[...g.path,g.id,"value"]),b=Ra.apply(h,g)),b!==null){h=b.data;let[w,M]=y1e(h,{[g.id]:x});h=w;for(let E=0;E<M.length;E++){let D=M[E],T=D.pop();if(typeof T=="number"){let L=[T];for(let R=E+1;R<M.length;R++){let O=M[R],U=O[O.length-1];if(typeof U=="number"&&ra.equal(D,O.slice(0,O.length-1)))L.push(U),M.splice(R,1);else break}let P=ra.zoom(h,D);v=P.map((R,O)=>L.includes(O)?g.id:R),x=P,T=D.pop()}else{if(T==="alphaOverride"||T==="alpha"){x/=100;let L=x,P=ra.zoom(h,D.slice(0,D.length-2)),R=P.layers.map(O=>O.id===D[D.length-1]?{...O,data:{...O.data,[T]:L}}:O);Object.setPrototypeOf(R,Object.getPrototypeOf(P.layers)),P.layers=R}v=g.id}d.push({type:0,path:D,props:{[T]:x}}),p.push({type:0,path:D,props:{[T]:v}})}p.push(b.reverse),d.push(b.actual)}}else{let x=Ra.apply(h,g);x!==null&&(d.push(x.actual),h=x.data,p.push(x.reverse))}}catch(x){if(x instanceof IX)return null;throw x}return{data:h,actual:d,reverse:p.reverse()}}t.apply=l})(Xz||(Xz={}));var NX=Symbol(),_1e=Symbol(),G3=Symbol(),TM=class{reportOp(t,e,i=[]){let r=this;if(e===null)return;r._current=e.data;let n=i;for(;!(r instanceof kX);){let s=r._path,a=r._current;if(s!==""&&n.splice(0,0,s),r=r._parent,r===null)return;r.update(s,a)}r.push(n,t,e.actual,e.reverse)}deleteChildren(t){if(this._children){let e=this._children[t];if(e){let i=e[G3];i&&i(),delete this._children[t]}}}},S1e=class extends TM{constructor(t,e,i){super(),this._parent=t,this._path=e,this._current=i}update(t,e){if(Array.isArray(this._current)){if(typeof t=="string"&&(t=parseInt(t),isNaN(t)))throw new Error("Invalid path");this._current=[...this._current],this._current[t]=e}else this._current={...this._current,[t]:e}}runOp(t){this.reportOp(t,HC.runOp(this._current,t),t.path)}},w1e=class extends TM{constructor(t,e,i){super(),this._parent=t,this._path=e,this._current=i}update(t,e){this._current={...this._current,[t]:e},Object.setPrototypeOf(this._current,xi.prototype)}runOp(t){this.reportOp(t,this._current.runOp(t))}},FX={get(t,e){if(e===G3)return()=>{t._parent=null};if(e===NX)return t._current;if(e===_1e)return t;let{_current:i,_children:r}=t;if(e==="push"&&Array.isArray(i))throw new Error("not supported to expand array");let n=r===void 0?void 0:r[e];if(n!==void 0)return n;let s=i[e],a=j3(t,e,s);return a!==s?(r===void 0&&(r={},t._children=r),r[e]=a,a):s},has(t,e){return e in t._current},ownKeys(t){return Reflect.ownKeys(t._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(t){return Object.getPrototypeOf(t._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(t,e){let i=t._current,r=Reflect.getOwnPropertyDescriptor(i,e);return r&&{writable:!0,configurable:!0,enumerable:r.enumerable,value:i[e]}}},M1e={...FX,set(t,e,i){let r={type:0,props:{[e]:Ds(i)??i}};return t.deleteChildren(e),t.runOp(r),!0},deleteProperty(t,e){let i={type:0,props:{[e]:void 0}};return t.deleteChildren(e),t.runOp(i),!0}},E1e={...FX,set(t,e,i){return i===void 0?this.deleteProperty(t,e):(t.deleteChildren(e),t.runOp({type:1,id:e,data:i})),!0},deleteProperty(t,e){return t.runOp({type:2,id:e}),!0}},$N=class extends TM{constructor(t,e,i){super(),this._children={},this._parent=t,this._path=e,this._current=i,this[G3]=()=>{this._parent=null}}unproxy(){return this._current}update(t,e){this._current=this._current.modifyById(t,e)}runOp(t){this.reportOp(t,this._current.runOp(t))}randomId(){return this._current.randomId()}isDescendantOf(t,e){return this._current.isDescendantOf(t,e)}childrenOf(t){return this._current.childrenOf(t)}traverse(t){return this._current.traverse(t)}get(t){return this._current.get(t)}parent(t){return this._current.parent(t)}traverse(t){this._current.traverse((e,i)=>{t(e,this.data(e))})}data(t){var a;let{_current:e,_children:i}=this,r=i===void 0?void 0:i[t];if(r!==void 0)return r;let n=(a=e.get(t))==null?void 0:a.data,s=j3(this,t,n);return s!==n?(i===void 0&&(i={},this._children=i),i[t]=s,s):n}add(t,e,i,r,n){this.runOp({type:7,parent:t,fi:e,id:i,data:r,children:n})}move(t,e,i){this.runOp({type:9,parent:t,fi:e,id:i})}insertAfter(t,e,i){let r=this._current.insertAfterHelper(t,e,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(t,r[n],s.id,s.data,s.children)}}insertBefore(t,e,i){let r=this._current.insertBeforeHelper(t,e,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(t,r[n],s.id,s.data,s.children)}}moveAfter(t,e,i){let r=this._current.insertAfterHelper(t,e,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(t,r[n],s)}}moveBefore(t,e,i){let r=this._current.insertBeforeHelper(t,e,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(t,r[n],s)}}delete(t){this.deleteChildren(t),this.runOp({type:8,id:t})}sortNext(t){return this._current.sortNext(t)}sortPrevious(t){return this._current.sortPrevious(t)}getAllSorted(t){return this._current.getAllSorted(t)}},e4=class extends TM{constructor(t,e,i){super(),this._children={},this._parent=t,this._path=e,this._current=i,this[G3]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(t){let e=this.length;for(let i=0;i<e;i++){let r=this._current[i].id,n=this._current[i].fi;t(this.data(this._current[i].id),r,n)}}find(t){let e=this.length;for(let i=0;i<e;i++){let r=this._current[i].id;if(t(this.data(r),r))return this.get(r)}}update(t,e){this._current=this._current.modifyById(t,e)}randomId(){return this._current.randomId()}get(t){return{...this._current.get(t),data:this.data(t)}}data(t){var a;let{_current:e,_children:i}=this,r=i===void 0?void 0:i[t];if(r!==void 0)return r;let n=(a=e.get(t))==null?void 0:a.data,s=j3(this,t,n);return s!==n?(i===void 0&&(i={},this._children=i),i[t]=s,s):n}runOp(t){this.reportOp(t,this._current.runOp(t))}add(t,e,i){this.runOp({type:4,fi:t,id:e,data:i})}move(t,e){this.runOp({type:6,fi:t,id:e})}insertAfter(t,e){let i=this._current.insertAfterHelper(t,e.length);for(let r=0;r<e.length;r++){let n=e[r];this.add(i[r],n.id,n.data)}}insertBefore(t,e){let i=this._current.insertBeforeHelper(t,e.length);for(let r=0;r<e.length;r++){let n=e[r];this.add(i[r],n.id,n.data)}}moveAfter(t,e){let i=this._current.insertAfterHelper(t,e.length);for(let r=0;r<e.length;r++){let n=e[r];this.move(i[r],n)}}moveBefore(t,e){let i=this._current.insertBeforeHelper(t,e.length);for(let r=0;r<e.length;r++){let n=e[r];this.move(i[r],n)}}delete(t){this.deleteChildren(t),this.runOp({type:5,id:t})}};function OO(t,e,i){if(t.length>0){let r=t[t.length-1];if(r.type===0&&e.type===0&&ra.equal(r.path,i)){Object.assign(r.props,e.props);return}}t.push({...e,path:i})}var kX=class extends TM{constructor(t){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=t}update(t,e){if(t!=="")throw new Error("");this._current=e}push(t,e,i,r){OO(this.ts,e,t),OO(this.actual,i,t),OO(this.reverse,r,t)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function j3(t,e,i){return i instanceof eo?new $N(t,e,i):i instanceof ai?new e4(t,e,i):i instanceof xi?new Proxy(new w1e(t,e,i),E1e):i!==null&&typeof i=="object"?ZN(i)?i:new Proxy(new S1e(t,e,i),M1e):i}function VX(t){let e=new kX(t);return[j3(e,"",t),e]}function zw(t,e){let[i,r]=VX(t);return e(i),r.result()}function Ds(t){return t instanceof $N||t instanceof e4?t._current:t!==null&&typeof t=="object"?t[NX]:t}var ra;(t=>{function e(s,a){if(a.length===s.length)for(var o=0;o<s.length;){if(s[o]!==a[o])return!1;o+=1}else return!1;return!0}t.equal=e;function i(s,a,o){let l=n(o,s);if(l!==void 0&&typeof l=="object"&&l!==null){let c={...a};return Object.keys(l).forEach(u=>{delete c[u]}),c}else return a}t.removeOverridden=i;function r(s,a){if((s instanceof eo||s instanceof $N)&&typeof a=="string"||(s instanceof ai||s instanceof e4)&&typeof a=="string")return s.data(a);if(typeof a=="number"&&Array.isArray(s)||typeof a=="string"&&typeof s=="object"&&s!==null)return s[a]}t.zoomOnce=r;function n(s,a,o=0){for(;o<a.length&&s!==void 0;)s=r(s,a[o]),o+=1;return s}t.zoom=n})(ra||(ra={}));function A1e(t,e){let i=[];if(e.length===t.length)for(var r=0;r<t.length;){if(e[r]==="*")i.push(t[r]);else if(t[r]!==e[r])return null;r+=1}else return null;return i}function dn(t,e){let i=[];if(e.length<=t.length)for(var r=0;r<e.length;){if(e[r]==="*")i.push(t[r]);else if(t[r]!==e[r])return null;r+=1}else return null;return i}var HX=class{},T6=class extends HX{constructor(t){super(),this.id=t}},C6=class extends HX{constructor(t){super(),this.data=t}},Yz;try{Yz=new TextDecoder}catch{}var ti,mg,lt=0,Fl={},Nr,sg,Zc=0,Pd=0,gc,_p,ul=[],Qr,D6={useRecords:!1,mapsAsObjects:!0},GX=class{},jX=new GX;jX.name="MessagePack 0xC1";var z1=!1,qC=class{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0)),Object.assign(this,t)}unpack(t,e){if(ti)return ZX(()=>(Zz(),this?this.unpack(t,e):qC.prototype.unpack.call(D6,t,e)));mg=e>-1?e:t.length,lt=0,Pd=0,sg=null,gc=null,ti=t;try{Qr=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(i){throw ti=null,t instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof qC){if(Fl=this,this.structures)return Nr=this.structures,e2();(!Nr||Nr.length>0)&&(Nr=[])}else Fl=D6,(!Nr||Nr.length>0)&&(Nr=[]);return e2()}unpackMultiple(t,e){let i,r=0;try{z1=!0;let n=t.length,s=this?this.unpack(t,n):q3.unpack(t,n);if(e){for(e(s);lt<n;)if(r=lt,e(e2())===!1)return}else{for(i=[s];lt<n;)r=lt,i.push(e2());return i}}catch(n){throw n.lastPosition=r,n.values=i,n}finally{z1=!1,Zz()}}_mergeStructures(t,e){t=t||[];for(let i=0,r=t.length;i<r;i++){let n=t[i];n&&(n.isShared=!0,i>=32&&(n.highByte=i-32>>5))}t.sharedLength=t.length;for(let i in e||[])if(i>=0){let r=t[i],n=e[i];n&&(r&&((t.restoreStructures||(t.restoreStructures=[]))[i]=r),t[i]=n)}return this.structures=t}decode(t,e){return this.unpack(t,e)}};function e2(){try{if(!Fl.trusted&&!z1){let e=Nr.sharedLength||0;e<Nr.length&&(Nr.length=e)}let t=ys();if(lt==mg)Nr.restoreStructures&&P6(),Nr=null,ti=null,_p&&(_p=null);else if(lt>mg){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}else if(!z1)throw new Error("Data read, but end of buffer not reached");return t}catch(t){throw Nr.restoreStructures&&P6(),Zz(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer"))&&(t.incomplete=!0),t}}function P6(){for(let t in Nr.restoreStructures)Nr[t]=Nr.restoreStructures[t];Nr.restoreStructures=null}function ys(){let t=ti[lt++];if(t<160)if(t<128){if(t<64)return t;{let e=Nr[t&63]||Fl.getStructures&&WX()[t&63];return e?(e.read||(e.read=t4(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,Fl.mapsAsObjects){let e={};for(let i=0;i<t;i++)e[XX()]=ys();return e}else{let e=new Map;for(let i=0;i<t;i++)e.set(ys(),ys());return e}else{t-=144;let e=new Array(t);for(let i=0;i<t;i++)e[i]=ys();return e}else if(t<192){let e=t-160;if(Pd>=lt)return sg.slice(lt-Zc,(lt+=e)-Zc);if(Pd==0&&mg<140){let i=e<16?i4(e):qX(e);if(i!=null)return i}return Qz(e)}else{let e;switch(t){case 192:return null;case 193:return gc?(e=ys(),e>0?gc[1].slice(gc.position1,gc.position1+=e):gc[0].slice(gc.position0,gc.position0-=e)):jX;case 194:return!1;case 195:return!0;case 196:return LO(ti[lt++]);case 197:return e=Qr.getUint16(lt),lt+=2,LO(e);case 198:return e=Qr.getUint32(lt),lt+=4,LO(e);case 199:return Ev(ti[lt++]);case 200:return e=Qr.getUint16(lt),lt+=2,Ev(e);case 201:return e=Qr.getUint32(lt),lt+=4,Ev(e);case 202:if(e=Qr.getFloat32(lt),Fl.useFloat32>2){let i=r4[(ti[lt]&127)<<1|ti[lt+1]>>7];return lt+=4,(i*e+(e>0?.5:-.5)>>0)/i}return lt+=4,e;case 203:return e=Qr.getFloat64(lt),lt+=8,e;case 204:return ti[lt++];case 205:return e=Qr.getUint16(lt),lt+=2,e;case 206:return e=Qr.getUint32(lt),lt+=4,e;case 207:return Fl.int64AsNumber?(e=Qr.getUint32(lt)*4294967296,e+=Qr.getUint32(lt+4)):e=Qr.getBigUint64(lt),lt+=8,e;case 208:return Qr.getInt8(lt++);case 209:return e=Qr.getInt16(lt),lt+=2,e;case 210:return e=Qr.getInt32(lt),lt+=4,e;case 211:return Fl.int64AsNumber?(e=Qr.getInt32(lt)*4294967296,e+=Qr.getUint32(lt+4)):e=Qr.getBigInt64(lt),lt+=8,e;case 212:if(e=ti[lt++],e==114)return z6(ti[lt++]&63);{let i=ul[e];if(i)return i.read?(lt++,i.read(ys())):i.noBuffer?(lt++,i()):i(ti.subarray(lt,++lt));throw new Error("Unknown extension "+e)}case 213:return e=ti[lt],e==114?(lt++,z6(ti[lt++]&63,ti[lt++])):Ev(2);case 214:return Ev(4);case 215:return Ev(8);case 216:return Ev(16);case 217:return e=ti[lt++],Pd>=lt?sg.slice(lt-Zc,(lt+=e)-Zc):C1e(e);case 218:return e=Qr.getUint16(lt),lt+=2,Pd>=lt?sg.slice(lt-Zc,(lt+=e)-Zc):D1e(e);case 219:return e=Qr.getUint32(lt),lt+=4,Pd>=lt?sg.slice(lt-Zc,(lt+=e)-Zc):P1e(e);case 220:return e=Qr.getUint16(lt),lt+=2,O6(e);case 221:return e=Qr.getUint32(lt),lt+=4,O6(e);case 222:return e=Qr.getUint16(lt),lt+=2,L6(e);case 223:return e=Qr.getUint32(lt),lt+=4,L6(e);default:if(t>=224)return t-256;if(t===void 0){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+t)}}}var T1e=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function t4(t,e){function i(){if(i.count++>2){let n=t.read=new Function("r","return function(){return {"+t.map(s=>T1e.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"}}")(ys);return t.highByte===0&&(t.read=R6(e,t.read)),n()}let r={};for(let n=0,s=t.length;n<s;n++){let a=t[n];r[a]=ys()}return r}return i.count=0,t.highByte===0?R6(e,i):i}var R6=(t,e)=>function(){let i=ti[lt++];if(i===0)return e();let r=t<32?-(t+(i<<5)):t+(i<<5),n=Nr[r]||WX()[r];if(!n)throw new Error("Record id is not defined for "+r);return n.read||(n.read=t4(n,t)),n.read()};function WX(){let t=ZX(()=>(ti=null,Fl.getStructures()));return Nr=Fl._mergeStructures(t,Nr)}var Qz=W3,C1e=W3,D1e=W3,P1e=W3;function W3(t){let e;if(t<16&&(e=i4(t)))return e;if(t>64&&Yz)return Yz.decode(ti.subarray(lt,lt+=t));let i=lt+t,r=[];for(e="";lt<i;){let n=ti[lt++];if((n&128)===0)r.push(n);else if((n&224)===192){let s=ti[lt++]&63;r.push((n&31)<<6|s)}else if((n&240)===224){let s=ti[lt++]&63,a=ti[lt++]&63;r.push((n&31)<<12|s<<6|a)}else if((n&248)===240){let s=ti[lt++]&63,a=ti[lt++]&63,o=ti[lt++]&63,l=(n&7)<<18|s<<12|a<<6|o;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(n);r.length>=4096&&(e+=Aa.apply(String,r),r.length=0)}return r.length>0&&(e+=Aa.apply(String,r)),e}function O6(t){let e=new Array(t);for(let i=0;i<t;i++)e[i]=ys();return e}function L6(t){if(Fl.mapsAsObjects){let e={};for(let i=0;i<t;i++)e[XX()]=ys();return e}else{let e=new Map;for(let i=0;i<t;i++)e.set(ys(),ys());return e}}var Aa=String.fromCharCode;function qX(t){let e=lt,i=new Array(t);for(let r=0;r<t;r++){let n=ti[lt++];if((n&128)>0){lt=e;return}i[r]=n}return Aa.apply(String,i)}function i4(t){if(t<4)if(t<2){if(t===0)return"";{let e=ti[lt++];if((e&128)>1){lt-=1;return}return Aa(e)}}else{let e=ti[lt++],i=ti[lt++];if((e&128)>0||(i&128)>0){lt-=2;return}if(t<3)return Aa(e,i);let r=ti[lt++];if((r&128)>0){lt-=3;return}return Aa(e,i,r)}else{let e=ti[lt++],i=ti[lt++],r=ti[lt++],n=ti[lt++];if((e&128)>0||(i&128)>0||(r&128)>0||(n&128)>0){lt-=4;return}if(t<6){if(t===4)return Aa(e,i,r,n);{let s=ti[lt++];if((s&128)>0){lt-=5;return}return Aa(e,i,r,n,s)}}else if(t<8){let s=ti[lt++],a=ti[lt++];if((s&128)>0||(a&128)>0){lt-=6;return}if(t<7)return Aa(e,i,r,n,s,a);let o=ti[lt++];if((o&128)>0){lt-=7;return}return Aa(e,i,r,n,s,a,o)}else{let s=ti[lt++],a=ti[lt++],o=ti[lt++],l=ti[lt++];if((s&128)>0||(a&128)>0||(o&128)>0||(l&128)>0){lt-=8;return}if(t<10){if(t===8)return Aa(e,i,r,n,s,a,o,l);{let c=ti[lt++];if((c&128)>0){lt-=9;return}return Aa(e,i,r,n,s,a,o,l,c)}}else if(t<12){let c=ti[lt++],u=ti[lt++];if((c&128)>0||(u&128)>0){lt-=10;return}if(t<11)return Aa(e,i,r,n,s,a,o,l,c,u);let h=ti[lt++];if((h&128)>0){lt-=11;return}return Aa(e,i,r,n,s,a,o,l,c,u,h)}else{let c=ti[lt++],u=ti[lt++],h=ti[lt++],d=ti[lt++];if((c&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){lt-=12;return}if(t<14){if(t===12)return Aa(e,i,r,n,s,a,o,l,c,u,h,d);{let p=ti[lt++];if((p&128)>0){lt-=13;return}return Aa(e,i,r,n,s,a,o,l,c,u,h,d,p)}}else{let p=ti[lt++],g=ti[lt++];if((p&128)>0||(g&128)>0){lt-=14;return}if(t<15)return Aa(e,i,r,n,s,a,o,l,c,u,h,d,p,g);let x=ti[lt++];if((x&128)>0){lt-=15;return}return Aa(e,i,r,n,s,a,o,l,c,u,h,d,p,g,x)}}}}}function LO(t){return Fl.copyBuffers?Uint8Array.prototype.slice.call(ti,lt,lt+=t):ti.subarray(lt,lt+=t)}function Ev(t){let e=ti[lt++];if(ul[e])return ul[e](ti.subarray(lt,lt+=t));throw new Error("Unknown extension type "+e)}var I6=new Array(4096);function XX(){let t=ti[lt++];if(t>=160&&t<192){if(t=t-160,Pd>=lt)return sg.slice(lt-Zc,(lt+=t)-Zc);if(!(Pd==0&&mg<180))return Qz(t)}else return lt--,ys();let e=(t<<5^(t>1?Qr.getUint16(lt):t>0?ti[lt]:0))&4095,i=I6[e],r=lt,n=lt+t-3,s,a=0;if(i&&i.bytes==t){for(;r<n;){if(s=Qr.getUint32(r),s!=i[a++]){r=1879048192;break}r+=4}for(n+=3;r<n;)if(s=ti[r++],s!=i[a++]){r=1879048192;break}if(r===n)return lt=r,i.string;n-=3,r=lt}for(i=[],I6[e]=i,i.bytes=t;r<n;)s=Qr.getUint32(r),i.push(s),r+=4;for(n+=3;r<n;)s=ti[r++],i.push(s);let o=t<16?i4(t):qX(t);return o!=null?i.string=o:i.string=Qz(t)}var z6=(t,e)=>{var i=ys();let r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,i.highByte=e);let n=Nr[t];return n&&n.isShared&&((Nr.restoreStructures||(Nr.restoreStructures=[]))[t]=n),Nr[t]=i,i.read=t4(i,r),i.read()},YX=typeof self=="object"?self:global;ul[0]=()=>{};ul[0].noBuffer=!0;ul[101]=()=>{let t=ys();return(YX[t[0]]||Error)(t[1])};ul[105]=t=>{let e=Qr.getUint32(lt-4);_p||(_p=new Map);let i=ti[lt],r;i>=144&&i<160||i==220||i==221?r=[]:r={};let n={target:r};_p.set(e,n);let s=ys();return n.used?Object.assign(r,s):(n.target=s,s)};ul[112]=t=>{let e=Qr.getUint32(lt-4),i=_p.get(e);return i.used=!0,i.target};ul[115]=()=>new Set(ys());var QX=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");ul[116]=t=>{let e=t[0],i=QX[e];if(!i)throw new Error("Could not find typed array for code "+e);return new YX[i](Uint8Array.prototype.slice.call(t,1).buffer)};ul[120]=()=>{let t=ys();return new RegExp(t[0],t[1])};ul[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],i=lt;lt+=e-4,gc=[ys(),ys()],gc.position0=0,gc.position1=0;let r=lt;lt=i;try{return ys()}finally{lt=r}};ul[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function ZX(t){let e=mg,i=lt,r=Zc,n=Pd,s=sg,a=_p,o=gc,l=new Uint8Array(ti.slice(0,mg)),c=Nr,u=Nr.slice(0,Nr.length),h=Fl,d=z1,p=t();return mg=e,lt=i,Zc=r,Pd=n,sg=s,_p=a,gc=o,ti=l,z1=d,Nr=c,Nr.splice(0,Nr.length,...u),Fl=h,Qr=new DataView(ti.buffer,ti.byteOffset,ti.byteLength),p}function Zz(){ti=null,_p=null,Nr=null}function R1e(t){t.unpack?ul[t.type]=t.unpack:ul[t.type]=t}var r4=new Array(147);for(let t=0;t<256;t++)r4[t]=+("1e"+Math.floor(45.15-t*.30103));var q3=new qC({useRecords:!1});q3.unpack;q3.unpackMultiple;q3.unpack;var O1e=new Float32Array(1);new Uint8Array(O1e.buffer,0,4);var JT;try{JT=new TextEncoder}catch{}var XC,n4,X3=typeof Buffer<"u",IO=X3?Buffer.allocUnsafeSlow:Uint8Array,KX=X3?Buffer:Uint8Array,U6=X3?4294967296:2144337920,Ct,Es,yt=0,dd,fd=null,L1e=/[\u0080-\uFFFF]/,$_=Symbol("record-id"),JX=class extends qC{constructor(t){super(t),this.offset=0;let e,i,r,n,s,a=0,o=KX.prototype.utf8Write?function(T,L,P){return Ct.utf8Write(T,L,P)}:JT&&JT.encodeInto?function(T,L){return JT.encodeInto(T,Ct.subarray(L)).written}:!1,l=this;t||(t={});let c=t&&t.sequential,u=t.structures||t.saveStructures,h=t.maxSharedStructures;if(h==null&&(h=u?32:0),h>8160)throw new Error("Maximum maxSharedStructure is 8160");let d=t.maxOwnStructures;d==null&&(d=u?32:64),c&&!t.saveStructures&&(this.structures=[]);let p=h>32||d+h>64,g=h+64,x=h+d+64;if(x>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let v=[],b=0,w=0;this.pack=this.encode=function(T,L){if(Ct||(Ct=new IO(8192),Es=new DataView(Ct.buffer,0,8192),yt=0),dd=Ct.length-10,dd-yt<2048?(Ct=new IO(Ct.length),Es=new DataView(Ct.buffer,0,Ct.length),dd=Ct.length-10,yt=0):yt=yt+7&2147483640,e=yt,s=l.structuredClone?new Map:null,l.bundleStrings?(fd=["",""],Ct[yt++]=214,Ct[yt++]=98,fd.position=yt-e,yt+=4):fd=null,i=l.structures,i){i.uninitialized&&(i=l._mergeStructures(l.getStructures()));let P=i.sharedLength||0;if(P>h)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let R=0;R<P;R++){let O=i[R];if(!O)continue;let U,F=i.transitions;for(let V=0,k=O.length;V<k;V++){let K=O[V];U=F[K],U||(U=F[K]=Object.create(null)),F=U}F[$_]=R+64}a=P}c||(i.nextId=P+64)}r&&(r=!1),n=i||[];try{if(M(T),fd){Es.setUint32(fd.position+e,yt-fd.position-e);let P=fd;fd=null,M(P[0]),M(P[1])}if(l.offset=yt,s&&s.idsToInsert){yt+=s.idsToInsert.length*6,yt>dd&&D(yt),l.offset=yt;let P=z1e(Ct.subarray(e,yt),s.idsToInsert);return s=null,P}return L&U1e?(Ct.start=e,Ct.end=yt,Ct):Ct.subarray(e,yt)}finally{if(i){if(w<10&&w++,b>1e4)i.transitions=null,w=0,b=0,v.length>0&&(v=[]);else if(v.length>0&&!c){for(let P=0,R=v.length;P<R;P++)v[P][$_]=0;v=[]}if(r&&l.saveStructures){let P=i.sharedLength||h;i.length>P&&(i=i.slice(0,P));let R=Ct.subarray(e,yt);return l.saveStructures(i,a)===!1?(l._mergeStructures(l.getStructures()),l.pack(T)):(a=P,R)}}L&B1e&&(yt=e)}};let M=T=>{yt>dd&&(Ct=D(yt));var L=typeof T,P;if(L==="string"){let R=T.length;if(fd&&R>=8&&R<4096){let F=L1e.test(T);fd[F?0:1]+=T,Ct[yt++]=193,M(F?-R:R);return}let O;R<32?O=1:R<256?O=2:R<65536?O=3:O=5;let U=R*3;if(yt+U>dd&&(Ct=D(yt+U)),R<64||!o){let F,V,k,K=yt+O;for(F=0;F<R;F++)V=T.charCodeAt(F),V<128?Ct[K++]=V:V<2048?(Ct[K++]=V>>6|192,Ct[K++]=V&63|128):(V&64512)===55296&&((k=T.charCodeAt(F+1))&64512)===56320?(V=65536+((V&1023)<<10)+(k&1023),F++,Ct[K++]=V>>18|240,Ct[K++]=V>>12&63|128,Ct[K++]=V>>6&63|128,Ct[K++]=V&63|128):(Ct[K++]=V>>12|224,Ct[K++]=V>>6&63|128,Ct[K++]=V&63|128);P=K-yt-O}else P=o(T,yt+O,U);P<32?Ct[yt++]=160|P:P<256?(O<2&&Ct.copyWithin(yt+2,yt+1,yt+1+P),Ct[yt++]=217,Ct[yt++]=P):P<65536?(O<3&&Ct.copyWithin(yt+3,yt+2,yt+2+P),Ct[yt++]=218,Ct[yt++]=P>>8,Ct[yt++]=P&255):(O<5&&Ct.copyWithin(yt+5,yt+3,yt+3+P),Ct[yt++]=219,Es.setUint32(yt,P),yt+=4),yt+=P}else if(L==="number")if(T>>>0===T)T<64?Ct[yt++]=T:T<256?(Ct[yt++]=204,Ct[yt++]=T):T<65536?(Ct[yt++]=205,Ct[yt++]=T>>8,Ct[yt++]=T&255):(Ct[yt++]=206,Es.setUint32(yt,T),yt+=4);else if(T>>0===T)T>=-32?Ct[yt++]=256+T:T>=-128?(Ct[yt++]=208,Ct[yt++]=T+256):T>=-32768?(Ct[yt++]=209,Es.setInt16(yt,T),yt+=2):(Ct[yt++]=210,Es.setInt32(yt,T),yt+=4);else{let R;if((R=this.useFloat32)>0&&T<4294967296&&T>=-2147483648){Ct[yt++]=202,Es.setFloat32(yt,T);let O;if(R<4||(O=T*r4[(Ct[yt]&127)<<1|Ct[yt+1]>>7])>>0===O){yt+=4;return}else yt--}Ct[yt++]=203,Es.setFloat64(yt,T),yt+=8}else if(L==="object")if(!T)Ct[yt++]=192;else{if(s){let O=s.get(T);if(O){if(!O.id){let U=s.idsToInsert||(s.idsToInsert=[]);O.id=U.push(O)}Ct[yt++]=214,Ct[yt++]=112,Es.setUint32(yt,O.id),yt+=4;return}else s.set(T,{offset:yt-e})}let R=T.constructor;if(R===Object)E(T,!0);else if(R===Array){P=T.length,P<16?Ct[yt++]=144|P:P<65536?(Ct[yt++]=220,Ct[yt++]=P>>8,Ct[yt++]=P&255):(Ct[yt++]=221,Es.setUint32(yt,P),yt+=4);for(let O=0;O<P;O++)M(T[O])}else if(R===Map){P=T.size,P<16?Ct[yt++]=128|P:P<65536?(Ct[yt++]=222,Ct[yt++]=P>>8,Ct[yt++]=P&255):(Ct[yt++]=223,Es.setUint32(yt,P),yt+=4);for(let[O,U]of T)M(O),M(U)}else{for(let O=0,U=XC.length;O<U;O++){let F=n4[O];if(T instanceof F){let V=XC[O];if(V.write){V.type&&(Ct[yt++]=212,Ct[yt++]=V.type,Ct[yt++]=0),M(V.write.call(this,T));return}let k=Ct,K=Es,X=yt;Ct=null;let $;try{$=V.pack.call(this,T,Y=>(Ct=k,k=null,yt+=Y,yt>dd&&D(yt),{target:Ct,targetView:Es,position:yt-Y}),M)}finally{k&&(Ct=k,Es=K,yt=X,dd=Ct.length-10)}$&&($.length+yt>dd&&D($.length+yt),yt=I1e($,Ct,yt,V.type));return}}E(T,!T.hasOwnProperty)}}else if(L==="boolean")Ct[yt++]=T?195:194;else if(L==="bigint"){if(T<BigInt(1)<<BigInt(63)&&T>=-(BigInt(1)<<BigInt(63)))Ct[yt++]=211,Es.setBigInt64(yt,T);else if(T<BigInt(1)<<BigInt(64)&&T>0)Ct[yt++]=207,Es.setBigUint64(yt,T);else if(this.largeBigIntToFloat)Ct[yt++]=203,Es.setFloat64(yt,Number(T));else throw new RangeError(T+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");yt+=8}else if(L==="undefined")this.encodeUndefinedAsNil?Ct[yt++]=192:(Ct[yt++]=212,Ct[yt++]=0,Ct[yt++]=0);else if(L==="function")M(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+L)},E=this.useRecords===!1?this.variableMapSize?T=>{let L=Object.keys(T),P=L.length;P<16?Ct[yt++]=128|P:P<65536?(Ct[yt++]=222,Ct[yt++]=P>>8,Ct[yt++]=P&255):(Ct[yt++]=223,Es.setUint32(yt,P),yt+=4);let R;for(let O=0;O<P;O++)M(R=L[O]),M(T[R])}:(T,L)=>{Ct[yt++]=222;let P=yt-e;yt+=2;let R=0;for(let O in T)(L||T.hasOwnProperty(O))&&(M(O),M(T[O]),R++);Ct[P+++e]=R>>8,Ct[P+e]=R&255}:T=>{let L=Object.keys(T),P,R=n.transitions||(n.transitions=Object.create(null)),O=0;for(let F=0,V=L.length;F<V;F++){let k=L[F];P=R[k],P||(P=R[k]=Object.create(null),O++),R=P}let U=R[$_];if(U)U>=96&&p?(Ct[yt++]=((U-=96)&31)+96,Ct[yt++]=U>>5):Ct[yt++]=U;else{U=n.nextId,U||(U=64),U<g&&this.shouldShareStructure&&!this.shouldShareStructure(L)?(U=n.nextOwnId,U<x||(U=g),n.nextOwnId=U+1):(U>=x&&(U=g),n.nextId=U+1);let F=L.highByte=U>=96&&p?U-96>>5:-1;R[$_]=U,n[U-64]=L,U<g?(L.isShared=!0,n.sharedLength=U-63,r=!0,F>=0?(Ct[yt++]=(U&31)+96,Ct[yt++]=F):Ct[yt++]=U):(F>=0?(Ct[yt++]=213,Ct[yt++]=114,Ct[yt++]=(U&31)+96,Ct[yt++]=F):(Ct[yt++]=212,Ct[yt++]=114,Ct[yt++]=U),O&&(b+=w*O),v.length>=d&&(v.shift()[$_]=0),v.push(R),M(L))}for(let F=0,V=L.length;F<V;F++)M(T[L[F]])},D=T=>{let L;if(T>16777216){if(T-e>U6)throw new Error("Packed buffer would be larger than maximum buffer size");L=Math.min(U6,Math.round(Math.max((T-e)*(T>67108864?1.25:2),4194304)/4096)*4096)}else L=(Math.max(T-e<<2,Ct.length-1)>>12)+1<<12;let P=new IO(L);return Es=new DataView(P.buffer,0,L),Ct.copy?Ct.copy(P,0,e,T):P.set(Ct.slice(e,T)),yt-=e,e=0,dd=P.length-10,Ct=P}}useBuffer(t){Ct=t,Es=new DataView(Ct.buffer,Ct.byteOffset,Ct.byteLength),yt=0}};n4=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,GX];XC=[{pack(t,e,i){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:n,targetView:s,position:a}=e(6);n[a++]=214,n[a++]=255,s.setUint32(a,r)}else if(r>0&&r<17179869184){let{target:n,targetView:s,position:a}=e(10);n[a++]=215,n[a++]=255,s.setUint32(a,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(a+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),i(this.onInvalidDate());let{target:n,targetView:s,position:a}=e(3);n[a++]=212,n[a++]=255,n[a++]=255}else{let{target:n,targetView:s,position:a}=e(15);n[a++]=199,n[a++]=12,n[a++]=255,s.setUint32(a,t.getMilliseconds()*1e6),s.setBigInt64(a+4,BigInt(Math.floor(r)))}}},{pack(t,e,i){let r=Array.from(t),{target:n,position:s}=e(this.structuredClone?3:0);this.structuredClone&&(n[s++]=212,n[s++]=115,n[s++]=0),i(r)}},{pack(t,e,i){let{target:r,position:n}=e(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=101,r[n++]=0),i([t.name,t.message])}},{pack(t,e,i){let{target:r,position:n}=e(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=120,r[n++]=0),i([t.source,t.flags])}},{pack(t,e){this.structuredClone?B6(t,16,e):N6(X3?Buffer.from(t):new Uint8Array(t),e)}},{pack(t,e){let i=t.constructor;i!==KX&&this.structuredClone?B6(t,QX.indexOf(i.name),e):N6(t,e)}},{pack(t,e){let{target:i,position:r}=e(1);i[r]=193}}];function B6(t,e,i,r){let n=t.byteLength;if(n+1<256){var{target:s,position:a}=i(4+n);s[a++]=199,s[a++]=n+1}else if(n+1<65536){var{target:s,position:a}=i(5+n);s[a++]=200,s[a++]=n+1>>8,s[a++]=n+1&255}else{var{target:s,position:a,targetView:o}=i(7+n);s[a++]=201,o.setUint32(a,n+1),a+=4}s[a++]=116,s[a++]=e,s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),a)}function N6(t,e){let i=t.byteLength;var r,n;if(i<256){var{target:r,position:n}=e(i+2);r[n++]=196,r[n++]=i}else if(i<65536){var{target:r,position:n}=e(i+3);r[n++]=197,r[n++]=i>>8,r[n++]=i&255}else{var{target:r,position:n,targetView:s}=e(i+5);r[n++]=198,s.setUint32(n,i),n+=4}r.set(t,n)}function I1e(t,e,i,r){let n=t.length;switch(n){case 1:e[i++]=212;break;case 2:e[i++]=213;break;case 4:e[i++]=214;break;case 8:e[i++]=215;break;case 16:e[i++]=216;break;default:n<256?(e[i++]=199,e[i++]=n):n<65536?(e[i++]=200,e[i++]=n>>8,e[i++]=n&255):(e[i++]=201,e[i++]=n>>24,e[i++]=n>>16&255,e[i++]=n>>8&255,e[i++]=n&255)}return e[i++]=r,e.set(t,i),i+=n,i}function z1e(t,e){let i,r=e.length*6,n=t.length-r;for(e.sort((s,a)=>s.offset>a.offset?1:-1);i=e.pop();){let s=i.offset,a=i.id;t.copyWithin(s+r,s,n),r-=6;let o=s+r;t[o++]=214,t[o++]=105,t[o++]=a>>24,t[o++]=a>>16&255,t[o++]=a>>8&255,t[o++]=a&255,n=s}return t}function vb(t){if(t.Class){if(!t.pack&&!t.write)throw new Error("Extension has no pack or write function");if(t.pack&&!t.type)throw new Error("Extension has no type (numeric code to identify the extension)");n4.unshift(t.Class),XC.unshift(t)}R1e(t)}var $X=new JX({useRecords:!1});$X.pack;$X.pack;var U1e=512,B1e=1024,F6=new JX({structuredClone:!0});vb({Class:xi.prototype.constructor,type:1,write(t){return{...t}},read(t){return Object.setPrototypeOf(t,xi.prototype),t}});vb({Class:ai.prototype.constructor,type:2,write(t){return[...t]},read(t){return Object.setPrototypeOf(t,ai.prototype),t}});vb({Class:eo.prototype.constructor,type:3,write(t){return[...t]},read(t){return Object.setPrototypeOf(t,eo.prototype),t}});vb({Class:T6.prototype.constructor,type:4,write(t){return t.id},read(t){return new T6(t)}});vb({Class:C6.prototype.constructor,type:5,write(t){return t.data},read(t){return new C6(t)}});vb({Class:Ws.prototype.constructor,type:6,write(t){return{...t}},read(t){return Object.setPrototypeOf(t,Ws.prototype),t}});function N1e(t){var e=0;if(t.length===0)return e;for(let i=0;i<t.length;i++){let r=t[i];e=(e<<5)-e+r,e=e&e}return e}function Kz(t){if(ZN(t))return t;if(Array.isArray(t))return t.map(Kz);if(typeof t=="object"&&t!==null){let e={};for(let i of Object.keys(t).sort())e[i]=Kz(t[i]);return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),e}else return t}var Jz;(t=>{function e(n){return F6.pack(n)}t.serialize=e;function i(n){return F6.unpack(n)}t.deserialize=i;function r(n){return N1e(e(Kz(n))).toString()}t.checksum=r})(Jz||(Jz={}));var k6;(t=>{function e(r){return r.type==="Conditional"?r.condition.type==="Distance"?"Distance":"StateChange":r.type}t.toEventUIType=e;function i(r){return r==="Distance"||r==="StateChange"?"Conditional":r}t.fromEventUIType=i})(k6||(k6={}));function V6(t){return t==="MouseDown"||t==="MouseUp"||t==="KeyDown"||t==="KeyUp"||t==="Collision"||t==="Trigger"}var Mo={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseHover:["Transition","Animation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Start:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Conditional:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MousePress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyPress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],GameControl:["Transition","Animation","Audio","Particles","Create","Conditional"],Collision:["Transition","Animation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Trigger:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Resize:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],VariableChange:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],API:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],WEBHOOK:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],AIAssistantListener:["SetVariable"],AIAssistantTrigger:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"]},H6;(t=>{function e(r){return r.type==="MouseDown"||r.type==="MouseUp"||r.type==="MousePress"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="KeyPress"}t.is=e;function i(r){return r==="MouseDown"||r==="MouseUp"||r==="MousePress"?{type:r,mode:"Object",disabled:!1,actions:new ai}:{type:r,disabled:!1,key:void 0,actions:new ai}}t.defaultData=i})(H6||(H6={}));var YC;(t=>{function e(i){return{type:"Property",value:[i??null,"position","x"]}}t.propertyDefaultData=e,t.valueDefaultData={type:"Literal",value:0}})(YC||(YC={}));var $z;(t=>{function e(n){return{type:"Comparison",operator:"==",lOperand:YC.propertyDefaultData(n),rOperand:{...YC.valueDefaultData}}}t.comparisonDefaultData=e;function i(n){return{type:"Distance",toObject:n??null,fromObject:n??null,distance:200}}t.distanceDefaultData=i;function r(n,s){return{type:"State",object:n??null,state:s??null}}t.stateDefaultData=r})($z||($z={}));var G6;(t=>{function e(i){return i.find(r=>r==="ifActions"||r==="elseActions")!==void 0}t.isConditionalSubActions=e})(G6||(G6={}));var j6;(t=>{function e(r){return r.type==="Conditional"}t.is=e;function i(r){return{type:"Conditional",disabled:!1,inActions:new ai,outActions:new ai,condition:$z.distanceDefaultData(r)}}t.defaultData=i})(j6||(j6={}));var W6;(t=>t.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new ai,drop:new ai}})(W6||(W6={}));var eU;(t=>t.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new ai})(eU||(eU={}));var tU;(t=>t.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5})(tU||(tU={}));var q6;(t=>{function e(r){return r.type==="MouseHover"}t.is=e;function i(){return{type:"MouseHover",disabled:!1,actions:new ai}}t.defaultData=i})(q6||(q6={}));var X6;(t=>{function e(r){return r.type==="Scroll"}t.is=e;function i(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new ai}}t.defaultData=i})(X6||(X6={}));var Y6;(t=>{function e(r){return r.type==="Start"}t.is=e;function i(){return{type:"Start",disabled:!1,actions:new ai}}t.defaultData=i})(Y6||(Y6={}));var Q6;(t=>{function e(r){return r.type==="Collision"}t.is=e;function i(){return{type:"Collision",disabled:!1,target:"character",actions:new ai}}t.defaultData=i})(Q6||(Q6={}));var Z6;(t=>{function e(r){return r.type==="Trigger"}t.is=e;function i(r,n){return{type:"Trigger",disabled:!1,target:"all",triggeringObjects:[],actions:new ai,triggerZone:"box",position:n.toArray(),rotation:[0,0,0],size:r.toArray(),radius:r.length()/2,helperVisible:!0}}t.defaultData=i})(Z6||(Z6={}));var iU;(t=>{t.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]};function e(a){return a.type==="Resize"}t.is=e;function i(a){return typeof a=="string"?a:"custom"}t.sizeToDevice=i;function r(a){return typeof a=="string"?[...t.defaultSizes[a]]:[...a]}t.deviceToSize=r;function n(){let a={size:"mobile",operator:"<",actions:new ai},o={size:"tablet",operator:"<",actions:new ai},l={size:[...t.defaultSizes.custom],operator:"<>",actions:new ai},c=new ai;return c.push({id:Qt.generateUUID(),fi:0,data:a},{id:Qt.generateUUID(),fi:1,data:o},{id:Qt.generateUUID(),fi:2,data:l}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:c}}t.defaultData=n;function s(){return{size:[...t.defaultSizes.custom],operator:"<>",actions:new ai}}t.defaultBreakpointData=s})(iU||(iU={}));var rU;(t=>{t.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]};function e(r){return r.type==="VariableChange"}t.is=e;function i(){return{disabled:!1,type:"VariableChange",actions:new ai,variableId:"",objectId:null,property:"Position X"}}t.defaultData=i})(rU||(rU={}));var K6;(t=>{function e(r){return r.type==="API"}t.is=e;function i(){return{disabled:!1,type:"API",successActions:new ai,errorActions:new ai,userAPIId:""}}t.defaultData=i})(K6||(K6={}));var J6;(t=>{function e(r){return r.type==="WEBHOOK"}t.is=e;function i(){return{disabled:!1,type:"WEBHOOK",actions:new ai,userWebhookId:""}}t.defaultData=i})(J6||(J6={}));var $6;(t=>{function e(r){return r.type==="AIAssistantListener"}t.is=e;function i(){return{disabled:!1,type:"AIAssistantListener",actions:new ai,analysis:"average",analysisRange:[0,71],analysisSingle:0}}t.defaultData=i})($6||($6={}));var eH;(t=>{function e(r){return r.type==="AIAssistantTrigger"}t.is=e;function i(){return{disabled:!1,description:"",type:"AIAssistantTrigger",actions:new ai}}t.defaultData=i})(eH||(eH={}));var yb="personal camera",ZS="a218fcc3-276b-49b9-b485-49037fd14f5f",F1e=2960946,_c=5526619,vp;(t=>{function e(g,x){return g[0]===x[0]&&g[1]===x[1]}t.isEqual=e;function i(g,x,v){return[g[0]+(x[0]-g[0])*v,g[1]+(x[1]-g[1])*v]}t.lerp=i;function r(g,x){return[g[0]+x[0],g[1]+x[1]]}t.add=r;function n(g,x){return[g[0]-x[0],g[1]-x[1]]}t.sub=n;function s(g,x){return[g[0]*x[0],g[1]*x[1]]}t.multiply=s;function a(g,x){return[g[0]/x[0],g[1]/x[1]]}t.divide=a;function o(g,x){return Math.pow(x[0]-g[0],2)+Math.pow(x[1]-g[1],2)}t.distanceSquared=o;function l(g,x){return Math.sqrt(o(g,x))}t.distance=l;function c(g,x){return g[0]*x[0]+g[1]*x[1]}t.dot=c;function u(g,x){return[g[0]*x,g[1]*x]}t.scalarMultiply=u;function h(g,x,v){let b=t.sub(x,g),w=t.sub(v,g),M=t.dot(b,w)/t.dot(b,b),E=t.scalarMultiply(b,M);return t.add(g,E)}t.projectionOnto=h;function d(g,x,v){return l(g,h(g,x,v))}t.projectionOntoDistance=d;function p(g,x){return[(g[0]+x[0])*.5,(g[1]+x[1])*.5]}t.center=p})(vp||(vp={}));var S0;(t=>{function e(l,c){return l[0]===c[0]&&l[1]===c[1]&&l[2]===c[2]}t.isEqual=e;function i(l,c){return[l[0]+c[0],l[1]+c[1],l[2]+c[2]]}t.add=i;function r(l,c){return[l[0]-c[0],l[1]-c[1],l[2]-c[2]]}t.sub=r;function n(l,c){return[l[0]/c[0],l[1]/c[1],l[2]/c[2]]}t.div=n;function s(l,c){return[l[0]*c[0],l[1]*c[1],l[2]*c[2]]}t.mul=s;function a(l,c){return Math.hypot(l[0]-c[0],l[1]-c[1],l[2]-c[2])}t.dist=a;function o(l,c,u){return[l[0]+(c[0]-l[0])*u,l[1]+(c[1]-l[1])*u,l[2]+(c[2]-l[2])*u]}t.lerp=o})(S0||(S0={}));var QC;(t=>{function e(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]}t.isEqual=e;function i(r,n,s){return[r[0]+(n[0]-r[0])*s,r[1]+(n[1]-r[1])*s,r[2]+(n[2]-r[2])*s,r[3]+(n[3]-r[3])*s]}t.lerp=i})(QC||(QC={}));var tH;(t=>{let e=180/Math.PI,i=Math.PI/180;function r(o){return typeof o=="number"?o*e:o}function n(o){return typeof o=="number"?o*i:o}function s(o){return[r(o[0]),r(o[1]),r(o[2])]}t.radToDeg=s;function a(o){return[n(o[0]),n(o[1]),n(o[2])]}t.degToRad=a})(tH||(tH={}));var U1;(t=>{t.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function e(n,s){for(let a=0;a<16;a++)if(n[a]!==s[a])return!1;return!0}t.isEqual=e;function i(n){return n??t.identity}t.simplify=i;function r(n,s){let a=s.slice(0);for(var o=0,l=s.length;o<l;o+=3){let c=n[3]*s[o]+n[7]*s[o+1]+n[11]*s[o+2]+n[15];a[o]=(n[0]*s[o]+n[4]*s[o+1]+n[8]*s[o+2]+n[12])/c,a[o+1]=(n[1]*s[o]+n[5]*s[o+1]+n[9]*s[o+2]+n[13])/c,a[o+2]=(n[2]*s[o]+n[6]*s[o+1]+n[10]*s[o+2]+n[14])/c}return a}t.applyMatrix4=r})(U1||(U1={}));var Ja;(t=>{function e(c){return typeof c=="object"&&typeof c.r=="number"&&typeof c.g=="number"&&typeof c.b=="number"}t.isRGB=e,t.white={r:1,g:1,b:1},t.red={r:1,g:0,b:0},t.black={r:0,g:0,b:0};function i(c){return{r:Math.round(c.r*255),g:Math.round(c.g*255),b:Math.round(c.b*255),a:1}}t.toRgb255a1=i;function r(c){return{r:c.r,g:c.g,b:c.b}}t.clone=r;function n(c){return c=Math.floor(c),{r:(c>>16&255)/255,g:(c>>8&255)/255,b:(c&255)/255}}t.fromHex=n;function s(c){return Math.round(c.r*255)*65536+Math.round(c.g*255)*256+Math.round(c.b*255)}t.toHex=s;function a(c,u){return c.r===u.r&&c.g===u.g&&c.b===u.b}t.equals=a;function o(c,u){return c.r.toFixed(2)===u.r.toFixed(2)&&c.g.toFixed(2)===u.g.toFixed(2)&&c.b.toFixed(2)===u.b.toFixed(2)}t.equalsFixed=o;function l(c,u,h){return{r:c.r+(u.r-c.r)*h,g:c.g+(u.g-c.g)*h,b:c.b+(u.b-c.b)*h}}t.lerp=l})(Ja||(Ja={}));var sn;(t=>{t.white={...Ja.white,a:1},t.transparent={...Ja.white,a:0};function e(l){return{r:l[0],g:l[1],b:l[2],a:l[3]}}t.from0to1=e;function i(l,c){return{...Ja.fromHex(l),a:c}}t.fromHexAndA=i;function r(l){return{r:Math.round(l.r*255),g:Math.round(l.g*255),b:Math.round(l.b*255),a:l.a}}t.toRgb255a1=r;function n(l,c){return Ja.equals(l,c)&&l.a===c.a}t.equals=n;function s(l,c){return Ja.equalsFixed(l,c)&&l.a.toFixed(2)===c.a.toFixed(2)}t.equalsFixed=s;function a(l,c,u){return{r:l.r+(c.r-l.r)*u,g:l.g+(c.g-l.g)*u,b:l.b+(c.b-l.b)*u,a:l.a+(c.a-l.a)*u}}t.lerp=a;function o({r:l,g:c,b:u,a:h}=t.white){return`rgba(${l*255}, ${c*255}, ${u*255}, ${h})`}t.toStyle=o})(sn||(sn={}));var nU;(t=>t.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(nU||(nU={}));var iH;(t=>t.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(iH||(iH={}));var rH;(t=>t.defaultData={control1:[.5,0],control2:[.5,1]})(rH||(rH={}));var qm;(t=>(t.linear=[0,0,1,1],t.ease=[.25,.1,.25,1],t.easeIn=[.42,0,1,1],t.easeOut=[0,0,.58,1],t.easeInOut=[.42,0,.58,1]))(qm||(qm={}));function nH(t){return typeof t=="string"&&t.length===36?/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t):!1}var z0;(t=>{t.all=["PerspectiveCamera","OrthographicCamera"];function e(i){return t.all.includes(i)}t.is=e})(z0||(z0={}));var B1;(t=>{t.DefaultUp=[0,1,0],t.DefaultTargetOffset=1e3,t.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:t.DefaultUp,isUpVectorFlipped:!1,targetOffset:t.DefaultTargetOffset};function e(i){var r,n;return i.type==="PerspectiveCamera"?((r=i.perspective)==null?void 0:r.zoom)??1:((n=i.orthographic)==null?void 0:n.zoom)??1}t.getZoom=e})(B1||(B1={}));var ag;(t=>{function e(r,n=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(r[0],r[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[r[0]+r[0]*n,0,0]},grid:{count:[2,2,2],size:r.map(s=>s*(1+n)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}t.defaultData=e;function i(r,n){let s={...r};if(eY.forEach(a=>{Object.assign(s,{[a]:n[a]??r[a]})}),s.radial={...r.radial},n.radial){let a=r.radial,o=n.radial;tY.forEach(l=>{Object.assign(s.radial,{[l]:o[l]??a[l]})})}if(s.linear={...r.linear},n.linear){let a=r.linear,o=n.linear;iY.forEach(l=>{Object.assign(s.linear,{[l]:o[l]??a[l]})})}if(s.grid={...r.grid},n.grid){let a=r.grid,o=n.grid;rY.forEach(l=>{Object.assign(s.grid,{[l]:o[l]??a[l]})})}if(s.toObject={...r.toObject},n.toObject){let a=r.toObject,o=n.toObject;nY.forEach(l=>{Object.assign(s.toObject,{[l]:o[l]??a[l]})})}if(s.randomnessObject={...r.randomnessObject},n.randomnessObject){let a=r.randomnessObject,o=n.randomnessObject;sY.forEach(l=>{Object.assign(s.randomnessObject,{[l]:o[l]??a[l]})})}return s}t.merge=i})(ag||(ag={}));var sU;(t=>{t.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let e=["radial","linear","grid","toObject","randomnessObject"];function i(r,n){let s=[];r.count!==void 0&&s.push({type:0,path:n,props:{count:r.count}});for(let a of e){let o=r[a];o&&Object.keys(o).length>0&&s.push({type:0,path:[...n,a],props:o})}return s}t.toOps=i})(sU||(sU={}));var eY=["count"],tY=["radius","start","end","position","scale","rotation"],iY=["position","scale","rotation"],rY=["count","size"],nY=["count","position","scale","rotation"],sY=["strength","scale","rotation","position","movement","seed","freqScale"],aU;(t=>{t.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function e(i){return t.all.includes(i)}t.is=e})(aU||(aU={}));var oU;(t=>{function e(r){return i(r)}t.defaultData=e;function i(r){if(r==="PointLight")return{type:r,color:sn.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if(r==="SpotLight")return{type:r,color:sn.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if(r==="DirectionalLight")return{type:r,color:sn.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(oU||(oU={}));var ZC;(t=>(t.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},t.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},t.defaultData={renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:t.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeDuration:1,...t.defaultCollisionData}))(ZC||(ZC={}));var N1;(t=>t.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(N1||(N1={}));var lU;(t=>{t.defaultData={castShadow:!0,receiveShadow:!0};function e(i,r){return i.castShadow===r.castShadow&&i.receiveShadow===r.receiveShadow}t.equals=e})(lU||(lU={}));var cU;(t=>{t.defaultData={flatShading:!1,wireframe:!1,side:0};function e(i,r){return i.flatShading===r.flatShading&&i.side===r.side&&i.wireframe===r.wireframe}t.equals=e})(cU||(cU={}));var uU;(t=>t.defaultData={...cU.defaultData,...lU.defaultData})(uU||(uU={}));var sH;(t=>{function e(i,r){var s,a;let n=[];if("material"in i){let o=typeof i.material=="string"?r.materials[i.material]??((s=r.lib.materials[i.material])==null?void 0:s.asset):i.material;o&&n.push(o)}else if("materials"in i)for(let o of i.materials){let l=typeof o=="string"?r.materials[o]??((a=r.lib.materials[o])==null?void 0:a.asset):o;l&&n.push(l)}return n}t.getMaterialData=e})(sH||(sH={}));var KC;(t=>(t.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},t.maxSize=3e7))(KC||(KC={}));var aH;(t=>{function e(i){return i==="texture"||i==="video"||i==="color"||i==="depth"||i==="normal"||i==="gradient"||i==="noise"||i==="fresnel"||i==="rainbow"||i==="toon"||i==="outline"||i==="particle"||i==="transmission"||i==="matcap"||i==="displace"||i==="pattern"||i==="light"}t.is=e})(aH||(aH={}));function k1e(t){return t.type!=="displace"}var oH;(t=>{function e(i){return i==="phong"||i==="toon"||i==="lambert"||i==="physical"}t.is=e})(oH||(oH={}));var aY=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],V1e=["wrapping","image","video","name","minFilter","magFilter"],Ta;(t=>{function e(s,a){let{texture:o,...l}=a;if(Object.assign(s,l),o){let c=s.texture;c&&Object.assign(c,o)}}t.patch=e;function i(s,a){return s==="light"&&a?r(a):n(s)}t.defaultData=i;function r(s){let a={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(s){case"phong":return{...a,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...a,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...a,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...a,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}function n(s){let a={alpha:1,mode:0,isMask:!1,visible:!0};switch(s){case"texture":return{...a,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"video":return{...a,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:KC.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"color":return{...a,type:"color",color:Ja.fromHex(_c)};case"depth":return{...a,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...a,type:"normal",cnormal:[1,1,1]};case"gradient":return{...a,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...a,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...Ja.fromHex(6710886),a:1},colorB:{...Ja.fromHex(6710886),a:1},colorC:{...Ja.fromHex(16777215),a:1},colorD:{...Ja.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...a,type:"fresnel",color:sn.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...a,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...a,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:sn.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...a,type:"outline",outlineColor:sn.fromHexAndA(0,1),contourColor:sn.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...a,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006}};case"transmission":return{...a,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...a,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...Ja.fromHex(0),a:1},colorB:{...Ja.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}})(Ta||(Ta={}));var Oa;(t=>{function e(u){return!u.layers.some(h=>h.data.type==="texture"&&h.data.projection!==0||h.data.type==="depth"&&!h.data.isWorldSpace||h.data.type==="noise"||h.data.type==="displace")}t.isMergable=e;function i(u){let h="";return u.layers.forEach(d=>{Object.entries(d.data).forEach(([p,g])=>{h+=`${p}${g}`,Array.isArray(g)?g.forEach(x=>h+=`${x}`):typeof g=="object"?Object.values(g).forEach(x=>{typeof x=="number"?h+=`${x.toFixed(4)}`:h+=`${x}`}):h+=`${g}`})}),h}t.getHash=i;function r(){return{layers:new ai}}t.defaultEmptyData=r;function n(u="layer1",h="layer2"){return a("phong",u,h)}t.defaultData=n;function s(u,h){return{...u,name:h}}t.withName=s;function a(u,h="layer1",d="layer2"){let p=new ai;return p.push({fi:0,data:Ta.defaultData("light",u),id:h}),p.push({fi:1,data:Ta.defaultData("color"),id:d}),{layers:p}}t.defaultTwoLayerData=a;function o(u){let h=Ta.defaultData("texture");u&&Object.assign(h.texture,{image:u});let d=new ai;return d.push({fi:0,data:h,id:"layer1"}),d.push({fi:1,data:{...Ta.defaultData("transmission"),alpha:1},id:"layer2"}),d.push({fi:2,data:{...Ta.defaultData("light","lambert"),alpha:0},id:"layer3"}),{layers:d}}t.defaultUIObjectMaterial=o;function l(u,h="phong",d="layer1",p="layer2"){let g=Ta.defaultData("texture");Object.assign(g.texture,{image:u});let x=new ai;return x.push({fi:0,data:g,id:d}),x.push({fi:1,data:Ta.defaultData("light",h),id:p}),{layers:x}}t.defaultTwoLayerTextureData=l;function c(u,h="phong",d="layer1",p="layer2"){let g=Ta.defaultData("video");Object.assign(g.texture,{video:u});let x=new ai;return x.push({fi:0,data:g,id:d}),x.push({fi:1,data:Ta.defaultData("light",h),id:p}),{layers:x}}t.defaultTwoLayerVideoTextureData=c})(Oa||(Oa={}));var JC;(t=>{function e(){return{points:new ai,roundness:0,shapeHoles:[],isClosed:!1}}t.defaultData=e})(JC||(JC={}));var $C;(t=>{function e(){return{points:new ai,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}t.defaultData=e})($C||($C={}));var oY={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0},hU;(t=>{function e(i,r){let n={...i};return cY.forEach(s=>{Object.assign(n,{[s]:r[s]??i[s]})}),n}t.merge=e})(hU||(hU={}));var lY={shape:oY,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},cY=["depth","offset","angle","twist","startScale","endScale"],eD;(t=>{function e(r){return r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="UIGeometry"}t.is2DParametricMesh=e;function i(r){return r==="PolygonGeometry"||r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="PathGeometry"||r==="VectorGeometry"||r==="ConeGeometry"||r==="CubeGeometry"||r==="CylinderGeometry"||r==="DodecahedronGeometry"||r==="HelixGeometry"||r==="IcosahedronGeometry"||r==="LatheGeometry"||r==="PyramidGeometry"||r==="SphereGeometry"||r==="PlaneGeometry"||r==="BackdropGeometry"||r==="TorusGeometry"||r==="TorusKnotGeometry"||r==="BooleanGeometry"||r==="TextGeometry"||r==="InputGeometry"}t.isParametricMesh=i})(eD||(eD={}));var dU;(t=>{function e(i,r){let n={...i};return Object.assign(n,r),n.type==="PathGeometry"&&"extrusion"in r&&r.extrusion&&(n.extrusion={...i.extrusion},Object.assign(n.extrusion,hU.merge(n.extrusion,r.extrusion))),n}t.merge=e})(dU||(dU={}));var Qm;(t=>{function e(i){if(i==="RectangleGeometry")return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="UIGeometry")return{type:i,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if(i==="PathGeometry")return{type:i,width:1,height:1,depth:1,path:$C.defaultData(),extrusion:lY};if(i==="VectorGeometry")return{width:1,height:1,type:i,subdivisions:12,shape:JC.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="BooleanGeometry")return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if(i==="ShapeBlendGeometry")return{type:i,width:0,height:0,depth:0,resolutionLevel:6,blendRange:100,useChildrenColors:!1};if(i==="TextGeometry")return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",editable:!1,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="InputGeometry")return{...t.defaultData("TextGeometry"),type:i,editable:!0};if(i==="SphereGeometry")return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}t.defaultData=e})(Qm||(Qm={}));var zO=["width","height","depth"],fU;(t=>t.defaultData={enabled:!1,useBackgroundColor:!1,color:Ja.white,near:.1,far:2e3})(fU||(fU={}));var tD;(t=>{let e={opacity:1,blendFunction:13,enabled:!1};t.defaultData={enabled:!1,pixelation:{...e,blendFunction:16,granularity:15},bloom:{...e,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...e,offset:[2,2]},vignette:{...e,darkness:1,offset:0},hueSaturation:{...e,hue:3,saturation:0},brightnessContrast:{...e,brightness:.25,contrast:0},depthOfField:{...e,focusDistance:100,focalLength:20,bokehScale:5},noise:{...e,blendFunction:16}}})(tD||(tD={}));var pU;(t=>t.defaultData={softShadowQuality:"low"})(pU||(pU={}));var mU;(t=>t.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75})(mU||(mU={}));var gU;(t=>t.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}})(gU||(gU={}));var F1;(t=>t.defaultData={usePhysics:!1,gravity:-10})(F1||(F1={}));var vU;(t=>t.defaultData={playCamera:yb,gameControlObject:null})(vU||(vU={}));var yU;(t=>t.defaultData={backgroundColor:sn.fromHexAndA(F1e,1),postprocessing:tD.defaultData,fog:fU.defaultData,globalPhysics:F1.defaultData,ambient:mU.defaultData,ao:gU.defaultData,shadow:pU.defaultData,publish:vU.defaultData})(yU||(yU={}));var xU;(t=>t.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95})(xU||(xU={}));var lH;(t=>{function e(r){return r==="Component"||r==="Instance"}t.isComponentRelated=e;function i(r){return r==="Empty"||r==="Instance"}t.isEmptyOrComponent=i})(lH||(lH={}));var k1;(t=>{t.identity={...nU.identity,hiddenMatrix:U1.identity};function e(n){return{position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix}}t.fromObject=e;function i(n,s){return{position:(s==null?void 0:s.position)||n.position,rotation:(s==null?void 0:s.rotation)||n.rotation,scale:(s==null?void 0:s.scale)||n.scale,hiddenMatrix:(s==null?void 0:s.hiddenMatrix)||n.hiddenMatrix}}t.merge=i;function r(n,s){return EX({position:S0.isEqual(n.position,s.position)?void 0:s.position,rotation:S0.isEqual(n.rotation,s.rotation)?void 0:s.rotation,scale:S0.isEqual(n.scale,s.scale)?null:s.scale,hiddenMatrix:U1.isEqual(n.hiddenMatrix,s.hiddenMatrix)?void 0:s.hiddenMatrix})}t.diff=r})(k1||(k1={}));var na;(t=>t.defaultData={states:new ai,events:new ai,visible:!0,raycastLock:!1,physics:N1.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...k1.identity,cloner:null})(na||(na={}));var bU;(t=>t.defaultData={type:"Empty",...na.defaultData})(bU||(bU={}));var cH;(t=>t.defaultData={type:"ParticleCollider",...xU.defaultData,...na.defaultData})(cH||(cH={}));var uH;(t=>t.defaultData={type:"Component",...na.defaultData})(uH||(uH={}));var hH;(t=>t.defaultData={type:"Particle",...na.defaultData,...ZC.defaultData})(hH||(hH={}));var Zm;(t=>t.defaultData={type:"Mesh",...na.defaultData,...uU.defaultData})(Zm||(Zm={}));var Uw;(t=>t.defaultData={...na.defaultData,...k1.identity,position:[0,0,B1.DefaultTargetOffset],...B1.defaultData})(Uw||(Uw={}));var _U;(t=>{function e(i){return{...na.defaultData,...oU.defaultData(i)}}t.defaultData=e,t.defaultDirectionalLightData={...t.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(_U||(_U={}));var iD;(t=>{function e(r,n,s=0){for(;s<n.length;){let a=r?r[n[s]]:void 0;if(n.length===s+1)return a;if(a)r=a.descendants,s+=1;else return}}t.resolveWithDes=e;function i(r,n,s=0){let a=e(r,n,s);if(a){let o=Object.keys(a);if(o.length===1&&o[0]==="descendants")return}return a}t.resolve=i})(iD||(iD={}));var og;(t=>{t.rootOverrideProps=["physics","events"],t.compositeNonOptionalOverrideProps=["geometry"],t.compositeEntireOverrideOverrideProps=["material"];function e(r,n){return{...na.defaultData,...n,component:r,overrides:new Ws,physics:void 0,events:void 0,type:"Instance"}}t.ofComponent=e;function i(r){let n=k1.fromObject(r.data);return e(r.id,n)}t.fromComponentData=i})(og||(og={}));var V1;(t=>{t.defaultData={type:"Page",...na.defaultData,physics:{...N1.defaultData,fusedBody:!1},...yU.defaultData,camera:Uw.defaultData};function e(i){return i.uiScene!==void 0}t.isUIPage=e})(V1||(V1={}));var SU;(t=>(t.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:U1.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:N1.defaultData,states:new ai,events:new ai,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...B1.defaultData},t.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},t.defaultMeshObject={name:"Rectangle",...na.defaultData,...Zm.defaultData,geometry:Qm.defaultData("RectangleGeometry"),material:Oa.defaultTwoLayerData("phong","layer1","layer2")},t.defaultBooleanObject={name:"Boolean",...na.defaultData,...Zm.defaultData,geometry:Qm.defaultData("BooleanGeometry"),material:Oa.defaultTwoLayerData("phong","layer1","layer2")},t.defaultShapeBlendObject={name:"Shape Blend",...na.defaultData,...Zm.defaultData,geometry:Qm.defaultData("ShapeBlendGeometry"),material:Oa.defaultTwoLayerData("phong","layer1","layer2")},t.defaultTextObject={name:"Text",...na.defaultData,...Zm.defaultData,geometry:Qm.defaultData("TextGeometry"),material:Oa.defaultTwoLayerData("phong","layer1","layer2")},t.defaultInputObject={name:"Input",...na.defaultData,...Zm.defaultData,geometry:Qm.defaultData("InputGeometry"),material:Oa.defaultTwoLayerData("phong","layer1","layer2")}))(SU||(SU={}));var o0;(t=>{function e(s,a){let o={name:a};return s.type==="Mesh"?(o.geometry={},"material"in s&&(o.material={layers:new Ws}),"materials"in s&&(o.materials=s.materials.map(l=>({layers:new Ws})))):z0.is(s.type)&&(o.perspective={},o.orthographic={}),o}t.newEmpty=e;function i(s,a){if(a===void 0)return s;let o={...s};return"material"in o&&"material"in a&&a.material&&(o.material=zw(o.material,l=>{if(typeof l!="string")for(let[c,u]of Object.entries(a.material.layers)){let h=l.layers.data(c);h&&Ta.patch(h,u)}}).data),o.materials&&a.materials&&(o.materials=zw(o.materials,l=>{var c,u;for(let h=0;h<o.materials.length;h++){let d=a.materials[h];if(typeof d!="string")for(let[p,g]of Object.entries(d.layers)){let x=(u=(c=l[h])==null?void 0:c.layers)==null?void 0:u.data(p);x&&Ta.patch(x,g)}}}).data),o}function r(s,a){let o,l=[],c={orthographic:0,perspective:0,geometry:0};function u(h,d){for(let[p,g]of Object.entries(d.layers)){let{texture:x,...v}=g;if(x!==void 0&&Object.keys(x).length>0){let b={path:[...h,"layers",p,"texture"],props:x,type:0};l.push(b)}if(Object.keys(v).length>0){let b={path:[...h,"layers",p],props:v,type:0};l.push(b)}}}for(let[h,d]of Object.entries(a))if(h!=="name")if(h==="cloner")l.push(...sU.toOps(d,["cloner"]));else if(h==="pathSnapping")l.push({path:[h],props:{slide:d.slide,offset:d.offset},type:0});else if(h==="material")u(["material"],d);else if(h==="materials")for(let[p,g]of Object.entries(d))u(["materials",p],g);else if(c[h]===0){if(h==="geometry"&&d.extrusion!==void 0){let p={path:[h,"extrusion"],props:d.extrusion,type:0};l.push(p),d={...d},delete d.extrusion}if(Object.keys(d).length>0){let p={path:[h],props:d,type:0};l.push(p)}}else o===void 0&&(o={path:[],props:{},type:0},l.push(o)),o.props[h]=d;return l}t.toOps=r;function n(s,a){var l,c,u,h,d,p;if(a===void 0)return s;let o={...s};if(Object.assign(o,k1.merge(o,a)),Object.assign(o,{pathSnapping:Object.assign({},o.pathSnapping,{slide:((l=a.pathSnapping)==null?void 0:l.slide)??((c=o.pathSnapping)==null?void 0:c.slide)??0,offset:((u=a.pathSnapping)==null?void 0:u.offset)??((h=o.pathSnapping)==null?void 0:h.offset)??0})}),z0.is(s.type)){o.orthographic={...o.orthographic},o.perspective={...o.perspective};let g=a;((d=g.orthographic)==null?void 0:d.zoom)!==void 0&&(o.orthographic.zoom=g.orthographic.zoom),((p=g.perspective)==null?void 0:p.zoom)!==void 0&&(o.perspective.zoom=g.perspective.zoom),g.isUpVectorFlipped!==void 0&&(o.isUpVectorFlipped=g.isUpVectorFlipped),g.targetOffset!==void 0&&(o.targetOffset=g.targetOffset)}else if(s.type==="Mesh")"geometry"in a&&Object.assign(o,{geometry:dU.merge(o.geometry,a.geometry)}),(a.material||a.materials)&&(o=i(o,a)),o.cloner&&"cloner"in a&&Object.assign(o,{cloner:ag.merge(o.cloner,a.cloner)});else if(s.type==="Empty")o.cloner&&"cloner"in a&&Object.assign(o,{cloner:ag.merge(o.cloner,a.cloner)});else if(aU.is(s.type)){let g=a;g.intensity!==void 0&&(o.intensity=g.intensity),g.color!==void 0&&(typeof g.color=="string"?o.color=g.color:o.color=Ja.clone(g.color))}return o}t.patch=n})(o0||(o0={}));var rD;(t=>t.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0})(rD||(rD={}));var lg;(t=>t.defaultData={orbitControls:rD.defaultData,playPage:ZS,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((e,i)=>{let r=0,n=0;return i<5?n=-30:i<10&&(n=30),i===0||i===10||i===5?r=30:(i===4||i===11||i===9)&&(r=-30),[120,[r,n],"show"]}),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1,imageQuality:70}},stopRaycast:!0,hdTransmission:!1})(lg||(lg={}));var wU;(t=>t.defaultData={id:"basic",label:"Basic",style:"None",prompt:""})(wU||(wU={}));var MU;(t=>t.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0})(MU||(MU={}));var l0;(t=>(t.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...wU.defaultData},isRandomSeed:!0,seed:t.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:MU.defaultData}),t.generateSeed=()=>Math.round(Math.random()*1e5)))(l0||(l0={}));var Bw;(t=>{function e(r){return r.find(n=>n.data.type==="Page"&&n.data.globalPhysics.usePhysics)!==void 0}t.physicsEnabled=e;function i(r,n,s){r.scene.objects.traverseFrom(n,(a,o)=>{var l;if(o.type==="Instance"){let c=(l=aD.getComponentData(r,o.component))==null?void 0:l.data;c&&s(a,o,c.events)}else s(a,o,o.events)})}t.traverseModuleInstances=i})(Bw||(Bw={}));var c0;(t=>{t.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",t.defaultLight={fi:-1,data:_U.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]};function e(n=!0,s=[]){let a=[],o=SU.defaultMeshObject;n&&(a.push({...t.defaultLight}),a.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:o,children:[]})),a.push(...s);let l=new eo;return l.push({fi:1,id:ZS,data:{...V1.defaultData,name:"Scene 1"},children:a}),l}t.createDefaultObjectTreeWithPage=e,t.defaultData={objects:e(),publish:lg.defaultData,styles:l0.defaultData()},t.emptyDataWithoutPage=function(){return{objects:new eo,publish:lg.defaultData,styles:l0.defaultData()}},t.emptyDataWithPage=function(n=!0){return{objects:e(n),publish:lg.defaultData,styles:l0.defaultData()}},t.emptyData=function(){return{objects:new eo,publish:{...lg.defaultData},styles:l0.defaultData()}};function i(n){return{...t.defaultData,objects:lu(n,eo.prototype)}}t.withObjs=i;function r(n,s){return i([{id:n,data:s,children:[],fi:0}])}t.withObj=r})(c0||(c0={}));var KS;(t=>t.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}})(KS||(KS={}));var EU;(t=>(t.defaultData=e=>({url:e,name:"New Webhook",parametersSchemas:new ai}),t.defaultParameterValueByType=e=>e==="number"?0:e==="boolean"?!1:""))(EU||(EU={}));var dH;(t=>t.defaultData=(e,i="GET")=>({url:e,method:i,name:"New API",headers:new ai,queries:new ai,autoStart:!0}))(dH||(dH={}));var to;(t=>{function e(a){return a.textValue!==void 0}t.isTextValue=e;function i(a){return typeof a=="number"}t.isNumber=i;function r(a){return typeof a=="boolean"}t.isBoolean=r;function n(a){return e(a)?"string":r(a)?"boolean":"number"}t.typeOfVariable=n;function s(a){return t.isTextValue(a)?Array.isArray(a.textValue)?a.textValue.map(o=>o.toString().padStart(a.padding??2,"0")).join(a.deliminator??":")+(a.suffix!==void 0?" "+a.suffix:""):a.textValue.toString():t.isBoolean(a)?a?"True":"False":t.isNumber(a)?parseFloat(a.toFixed(3)).toString():a.toString()}t.getDisplayedValue=s})(to||(to={}));var AU;(t=>t.all=["images","videos","colors","audios","particles","fonts","materials","variables"])(AU||(AU={}));var fH;(t=>t.all=[...AU.all,"components"])(fH||(fH={}));var pH;(t=>{function e(){return{images:new xi,videos:new xi,colors:new xi,audios:new xi,particles:new xi,fonts:new xi,materials:new xi,components:new xi,variables:new xi,userAPIs:new xi,userWebhooks:new xi}}t.defaultData=e})(pH||(pH={}));var Dp;(t=>{function e(){return{images:new xi,videos:new xi,colors:new xi,audios:new xi,particles:new xi,fonts:new xi,materials:new xi,components:new xi,variables:new xi,userAPIs:new xi,userWebhooks:new xi}}t.defaultData=e})(Dp||(Dp={}));var Kc;(t=>{function e(){let a={};return a["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},lu(a,xi.prototype)}t.defaultColors=e;function i(){return lu({},xi.prototype)}t.defaultImages=i;function r(){return{catelogs:new xi,materials:new xi,images:new xi,videos:new xi,colors:new xi,audios:new xi,particles:new xi,fonts:new xi,variables:new ai,userAPIs:new xi,userWebhooks:new xi,lib:Dp.defaultData()}}t.emptyData=r;function n(a){switch(a){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let o=[0,0,0];return{name:"Time",value:{textValue:o,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:o,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",a)}}t.defaultVariables=n;function s(a,o){if(o.format==="HH:mm:ss"){let l=Math.floor(a/3600),c=Math.floor((a-l*3600)/60),u=Math.round(a-l*3600-c*60);return{textValue:[l,c,u]}}else if(o.format==="mm:ss"){let l=Math.floor(a/60),c=Math.round(a-l*60);return{textValue:[l,c]}}else return o.format==="number"?a=Math.round(a):a=Math.round(a*1e3)/1e3,a}t.getFormattedTimerTime=s})(Kc||(Kc={}));var nD;(t=>t.list=["idle","move","jump","run"])(nD||(nD={}));var sD;(t=>(t.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},t.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX",""],["rotPosY",""],["rotNegX",""],["rotNegY",""],["jump","Space"],["run",""],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:t.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new ai,move:new ai,jump:new ai,run:new ai},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:sn.fromHexAndA(3728051,1)}}))(sD||(sD={}));function mH(t){t.layers.forEach(e=>{if(e.type==="depth"&&e.colorA!==void 0){let i=e.colorA,r=e.colorB,n=[[i.r,i.g,i.b,i.a],[r.r,r.g,r.b,r.a]],s=[0,1];for(let o=2;o<10;o++)n.push(n[1]),s.push(1);let a={...Ud(Ds(e),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,e.near),far:Math.max(0,e.far),colors:n,steps:s,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(e,a)}else if(e.type==="depth"&&e.gradientType===1&&(e.near<0||e.far<0)){let i={...Ds(e),near:Math.max(e.near,0),far:Math.max(e.far,0)};Object.assign(e,i)}})}function Km(t,e){Object.values(t.shared.materials).forEach(i=>e(i))}function Jm(t,e){t.scene.objects.traverse((i,r)=>{"materials"in r?r.materials.forEach((n,s)=>{n===void 0&&(r.materials[s]=Oa.defaultData(),n=r.materials[s]),typeof n!="string"&&e(n)}):"material"in r?typeof r.material!="string"&&(r.material===void 0&&(r.material=Oa.defaultData()),e(r.material)):r.type==="Mesh"&&(r.material===void 0&&(r.material=Oa.defaultData()),e(r.material)),"overrides"in r&&Object.values(r.overrides).forEach(n=>{n.material&&typeof n.material!="string"&&Object.getPrototypeOf(n.material)!==Ws.prototype&&e(n.material)})})}function H1e(t){Object.assign(t.scene.publish,{orbitControls:{...rD.defaultData,...Ds(t.scene.publish.orbitControls)}})}function G1e(t){Object.assign(t.scene.publish.settings,{video:{...lg.defaultData.settings.video,...Ds(t.scene.publish.settings.video)}})}function j1e(t){function e(i){if(i.layers){for(let r of Object.values(i.layers))if(r){for(let[n,s]of Object.entries(r))if((aY.includes(n)||typeof s=="boolean")&&delete r[n],n==="texture")for(let[a,o]of Object.entries(s))(V1e.includes(a)||typeof o=="boolean")&&delete s[a]}}}t.scene.objects.traverse((i,r)=>{r.states.forEach(n=>{let s=n;s.material?e(s.material):s.materials&&s.materials.forEach(a=>{e(a)})})})}function W1e(t){t.scene.publish.withBackground=!0}function q1e(t){t.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function X1e(t){t.scene.objects.traverse((e,i)=>{let r=i.cloner;r&&(r.radial.scale=r.radial.scale.map(n=>n+1),r.linear.scale=r.linear.scale.map(n=>n+1))})}function Y1e(t){t.scene.objects.traverse((e,i)=>{let r=i.geometry;r&&(r.type==="DodecahedronGeometry"||r.type==="IcosahedronGeometry")&&(r.detail=Math.round(r.detail))})}function Q1e(t){t.scene.objects.traverse((e,i)=>{let r=t.scene.objects.unproxy().parent(e);if(r){let n=Ds(t.scene.objects.data(r));n&&n.type==="Mesh"&&n.geometry.type==="BooleanGeometry"&&i.type==="Mesh"&&(i.visible=Ds(i).booleanExclude!==!0)}})}function Z1e(t){t.scene.objects.traverse((e,i)=>{if(i.type==="Mesh"){let r=i;i.geometry.type==="NonParametricGeometry"?r.material!==void 0&&delete r.material:r.materials!==void 0&&delete r.materials}})}function K1e(t){function e(r){Object.setPrototypeOf(r,Ws.prototype),r.texture&&Object.setPrototypeOf(r.texture,Ws.prototype)}function i(r){Object.setPrototypeOf(r,Ws.prototype);for(let n in r)e(r[n])}t.scene.objects.traverse((r,n)=>{n.states.forEach(s=>{let a=s;if(a.material){let o=Ds(a.material).layers;i(o),a.material.layers=o}if(a.materials)for(let o=0;o<a.materials.length;o++){let l=a.materials[o],c=Ds(l).layers;i(c),l.layers=c}})})}function gH(t){t.layers===void 0&&Object.assign(t,Oa.defaultTwoLayerData("lambert"))}function UO(t){!t.layers||t.layers.forEach(e=>{if(e.type==="depth"&&e.colors.length===10){let i=[...e.colors];i.push(e.colors[9]);let r=[...e.steps];r.push(e.steps[9]);let n={...Ds(e),colors:i,steps:r};Object.assign(e,n)}})}function J1e(t){t.scene.objects.traverse((e,i)=>{i.type==="Mesh"&&(i.geometry.type==="BooleanGeometry"||i.geometry.type==="SubdivGeometry")&&(i.geometry.phongAngle=35)})}function vH(t){t.scene.objects.traverse((e,i)=>{"materials"in i?i.materials.forEach(r=>{typeof r!="string"&&UO(r)}):"material"in i&&typeof i.material!="string"&&UO(i.material)}),Object.values(t.shared.materials).forEach(e=>UO(e))}function $1e(t){t.scene.environment.ambientLight.softShadows=!1,t.scene.environment.ambientLight.softShadowQuality="low",t.scene.objects.traverse((e,i)=>{(i.type==="DirectionalLight"||i.type==="SpotLight")&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),t.shared.penumbraSize=new Array(5).fill(.5)}function ebe(t){t.shared.audios=lu({},xi.prototype)}function tbe(t){t.shared.videos=lu({},xi.prototype)}function ibe(t){let e=t.shared.materials;Object.entries(e).forEach(([i,r])=>{if(!r.layers){let n={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(e,{[i]:n})}})}function rbe(t){Object.entries(Ds(t.shared.images)).filter(e=>e[1].asset===!1).map(e=>e[0]).forEach(e=>{delete t.shared.images[e]}),Object.entries(Ds(t.shared.audios)).filter(e=>e[1].asset===!1).map(e=>e[0]).forEach(e=>{delete t.shared.audios[e]})}function nbe(t){t.scene.publish.settings.web.preload=!1}function yH(t){t.layers&&t.layers.forEach(e=>{e.type==="depth"&&e.num!==void 0&&(e.colors=e.colors.slice(0,e.num),e.steps=e.steps.slice(0,e.num),delete e.num)})}function xH(t){t.layers&&t.layers.forEach(e=>{k1e(e)&&e.isMask===void 0&&(e.isMask=!1),(e.type==="texture"||e.type==="video")&&e.blending===void 0&&(e.blending=0),(e.type==="noise"||e.type==="displace"&&e.displacementType==="noise")&&(e.voronoiStyle===void 0&&(e.voronoiStyle=0),e.highCut===void 0&&(e.highCut=1),e.lowCut===void 0&&(e.lowCut=0),e.smoothness===void 0&&(e.smoothness=.3),e.seed===void 0&&(e.seed=0),e.quality===void 0&&(e.quality=1))})}function sbe(t){t.shared.fonts=lu({},xi.prototype)}function abe(t){return t.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function obe(t){let e=[];t.scene.objects.traverse((i,r)=>{let n=r;if(n.type==="TextFrame"){let s=Oa.defaultTwoLayerData("phong"),a=typeof n.color=="string"?t.shared.colors[n.color]:n.color;s.layers[1].data.color={r:a.r,g:a.g,b:a.b},s.layers[1].data.alpha=n.alpha;let o=abe(n.font);t.shared.fonts[o]===void 0&&(t.shared.fonts[o]={name:o});let l={name:n.name,...na.defaultData,...Zm.defaultData,flatShading:!1,wireframe:!1,geometry:{...Qm.defaultData("TextGeometry"),width:n.width,height:n.height,font:o,depth:0,horizontalAlign:n.horizontalAlign,verticalAlign:n.verticalAlign,fontSize:n.fontSize*1.40625,lineHeight:n.lineHeight/1.40625,letterSpacing:n.letterSpacing-1,text:n.text,textTransform:n.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:s,states:Ds(n.states),events:Ds(n.events),visible:n.visible,raycastLock:n.raycastLock,position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix},c=Ds(t.scene.objects).parent(i);t.scene.objects.insertAfter(c??null,i,[{id:i+"new",data:l,children:[]}]),e.push(i)}}),e.forEach(i=>{t.scene.objects.delete(i)})}function lbe(t){let e={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};t.scene.objects.traverse((i,r)=>{r.events.forEach(n=>{if(e[Number(n.type)])if(Object.assign(n,{type:e[Number(n.type)]}),n.type==="Audio"&&"audioEvent"in n&&(Object.assign(n,{playAudio:n.audioEvent}),delete n.audioEvent),n.type==="GameControl")Object.assign(n,{gameActions:{idle:new ai,move:new ai,jump:new ai}});else{let s=new ai;Object.assign(n,{actions:s}),(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp")&&"url"in n&&s.push({fi:0,id:Qt.generateUUID(),data:{type:"Link",url:n.url,delay:0}}),"targets"in n&&(n.targets.forEach((a,o,l)=>{let c={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},u={easing:a.easing,duration:a.duration};a.easing===6?Object.assign(u,Ud(a,"mass","stiffness","damping","velocity")):a.easing===5&&Object.assign(u,{control1:{...a.control1},control2:{...a.control2}});let h={repeat:a.repeat?-1:0,delay:a.delay,delayDirection:a.delayDirection,direction:a.cycle&&a.rewind?"pingpong-rewind":a.cycle?"pingpong":"normal"},d={state:a.state,...h,...u},p={allowSlerp:!0,type:"Transition",object:a.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new ai({fi:0,id:Qt.generateUUID(),data:c},{fi:1,id:Qt.generateUUID(),data:d})};s.push({fi:l,id:o,data:p})}),delete n.targets)}})})}function cbe(t){t.scene.objects.traverse((e,i)=>{function r(n,s){var l;let a=new ai,o=[];if(i.events.forEach((c,u,h)=>{if(c.type==="Audio"&&c.trigger===s){let d;o.push(u),c.interaction==="play"?d={...Ud(c,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in c?c.after:void 0,toggle:"after"in c?c.toggle:void 0,type:"Audio"}:(c.interaction==="pause"||c.interaction==="stop")&&(d={...Ud(c,"interaction","delay","object","playAudio"),type:"Audio"}),d&&a.push({fi:h,id:u,data:d})}}),o.forEach(c=>i.events.delete(c)),a.length){let c=(l=i.events.find(u=>u.type===n))==null?void 0:l.data;c?"actions"in c&&c.actions.insertBefore(null,a):i.events.insertBefore(null,[{id:Qt.generateUUID(),data:{type:n,actions:a}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")})}function bH(t){var i;let e=(i=t.layers.find(r=>r.type==="light"))==null?void 0:i.data;if((e==null?void 0:e.category)==="basic"){let r=Ta.defaultData("light","phong"),n=e;Object.assign(n,r),n.visible=!1}}function _H(t){Km(t,bH),Jm(t,bH)}function ube(t){t.scene.objects.traverse((e,i)=>{i.type==="Mesh"&&i.geometry.type==="SubdivGeometry"&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}function hbe(t){t.scene.objects.traverse((e,i)=>{(i.type==="Empty"||i.type==="Mesh")&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner={...i.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}function dbe(t){t.scene.objects.traverse((e,i)=>{i.type==="Mesh"&&i.geometry.type==="NonParametricGeometry"&&!("material"in i)&&!("materials"in i)&&(i.material=Oa.defaultTwoLayerData("phong"))})}function fbe(t){t.scene.publish.orbitControls.autoZoom===void 0&&(t.scene.publish.orbitControls.autoZoom=!1),t.scene.objects.traverse((e,i)=>{(i.type==="OrthographicCamera"||i.type==="PerspectiveCamera")&&(i.orthographic.autoZoom===void 0&&(i.orthographic.autoZoom=!1),i.orthographic.autoZoomFrustumSize===void 0&&(i.orthographic.autoZoomFrustumSize=790))})}function pbe(t){t.scene.objects.traverse((e,i)=>{i.pathSnapping===void 0&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),i.pathSnapping.offset===void 0&&(i.pathSnapping.offset=0)})}function mbe(t){t.scene.publish.mouseEventTarget===void 0&&(t.scene.publish.mouseEventTarget="canvas"),t.scene.publish.settings.web.hint===void 0&&(t.scene.publish.settings.web.hint=!1)}function gbe(t){let{video:e}=t.scene.publish.settings;e.format==="gif"&&e.fps>48&&(e.fps=15)}function vbe(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.resetYPosition=Math.abs(r.resetYPosition-i.position[1]))})})}function ybe(t){let e=t.scene.environment.usePhysics;t.scene.objects.traverse((i,r)=>{e&&r.physics===null?r.collision=!1:r.collision="visibility"})}function xbe(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.navmesh=sD.defaultDataThirdPerson.navmesh)})})}function bbe(t){t.scene.styles||(t.scene.styles=l0.defaultData())}function SH(t){t.layers.forEach(e=>{e.type==="light"&&e.category!=="toon"&&e.occlusion===void 0&&(e.occlusion=!0)})}function _be(t){t.scene.environment.ambientLight.occlusion===void 0&&(t.scene.environment.ambientLight.occlusion=!1),t.scene.environment.ambientLight.aoFullRes===void 0&&(t.scene.environment.ambientLight.aoFullRes=!1),t.scene.environment.ambientLight.radius===void 0&&(t.scene.environment.ambientLight.radius=256),t.scene.environment.ambientLight.bias===void 0&&(t.scene.environment.ambientLight.bias=.5),t.scene.environment.ambientLight.aoColor===void 0&&(t.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),Jm(t,SH),Km(t,SH)}function Sbe(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&Object.assign(r.gameActions,{run:new ai})})})}function wbe(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.keyAssignments=[...r.keyAssignments,["run",""],["none","Ctrl"]])})})}function wH(t){t.layers&&t.layers.forEach(e=>{e.type==="light"&&e.bumpMapIntensity===void 0&&(e.bumpMapIntensity=5)})}function Mbe(t,e){if(e<1&&(Jm(t,mH),Km(t,mH),t.schema=1),e<2&&(H1e(t),t.schema=2),e<3&&(j1e(t),t.schema=3),e<4&&(W1e(t),t.schema=4),e<5&&(q1e(t),t.schema=5),e<6&&(X1e(t),t.schema=6),e<7&&(Y1e(t),t.schema=7),e<8&&(t.schema=8),e<9&&(vH(t),t.schema=9),e<10&&(J1e(t),t.schema=10),e<11&&($1e(t),t.schema=11),e<12&&(vH(t),t.schema=12),e<13&&(ebe(t),t.schema=13),e<14&&(ibe(t),t.schema=14),e<15&&(rbe(t),t.schema=15),e<16&&(nbe(t),t.schema=16),e<17&&(Jm(t,yH),Km(t,yH),t.schema=17),e<18&&(Jm(t,gH),Km(t,gH),t.schema=18),e<19&&(G1e(t),t.schema=19),e<20&&(sbe(t),obe(t),t.schema=20),e<21&&(lbe(t),cbe(t),t.schema=21),e<22&&(_H(t),t.schema=22),e<23&&(ube(t),t.schema=23),e<24&&(hbe(t),t.schema=24),(e<25||t.shared.videos===void 0)&&(tbe(t),e<25&&(t.schema=25)),e<26&&(Q1e(t),t.schema=26),e<27&&(Z1e(t),t.schema=27),e<28&&(_H(t),t.schema=28),e<29&&(K1e(t),t.schema=29),e<30&&(dbe(t),t.schema=30),e<31&&(fbe(t),t.schema=31),e<33&&(pbe(t),t.schema=33),e<34&&(mbe(t),t.schema=34),e<35&&(gbe(t),t.schema=35),e<36&&(vbe(t),t.schema=36),e<37&&(ybe(t),t.schema=37),e<38&&(Jm(t,xH),Km(t,xH),t.schema=38),e<39&&(xbe(t),t.schema=39),e<40&&(bbe(t),t.schema=40),e<41&&(_be(t),t.schema=41),e<42&&(Sbe(t),t.schema=42),e<43&&(wbe(t),t.schema=43),e<99){Jm(t,wH),Km(t,wH),t.scene.publish.playCamera===null&&(t.scene.publish.playCamera=yb);let i=Ds(t.scene.objects),r=t.scene.objects;t.scene.publish.playPage=ZS,r.insertBefore(null,null,[{id:ZS,data:{...V1.defaultData,backgroundColor:t.scene.backgroundColor,fog:t.scene.fog,postprocessing:t.scene.postprocessing,ao:Ud(t.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:t.scene.publish.playCamera,gameControlObject:t.scene.publish.gameControlObject},shadow:Ud(t.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...F1.defaultData,...Ud(t.scene.environment,"usePhysics","gravity")},camera:Ds(t.scene.ownerCamera)??V1.defaultData.camera,name:"Scene"},children:[]}]);for(let a of i)a.id!==c0.TRASH_CAN_ID&&r.move(ZS,a.fi,a.id);let n=0,s=0;t.shared.penumbraSize&&t.scene.objects.traverse((a,o)=>{o.type==="DirectionalLight"?(o.penumbraSize=t.shared.penumbraSize[Math.min(n,2)],n+=1):o.type==="SpotLight"&&(o.penumbraSize=t.shared.penumbraSize[3+Math.min(s,1)],s+=1),(o.physics===void 0||o.physics===null)&&o.type!=="Instance"&&(o.physics={},Object.assign(o.physics,N1.defaultData)),o.physics!==void 0&&o.physics!==null&&(o.physics.enabled=o.collision??"visibility",delete o.collision)}),t.schema=99}}function MH(t){t.layers&&t.layers.forEach(e=>{e.type==="light"&&e.alphaOverride===void 0&&(e.alphaOverride=1)})}function Ebe(t){t.scene.objects.traverse((e,i)=>{let r=i.geometry;r&&r.type==="PathGeometry"&&(r.extrusion.capType="flat",r.extrusion.bevel=50,r.extrusion.bevelSides=6,r.extrusion.shape.type==="Custom"&&(r.extrusion.shape.shapeQuality="low"))})}function Abe(t){var e;Array.isArray(Ds(t.events))&&((e=t.events)==null||e.forEach(i=>{"disabled"in i||(i.disabled=!1),(i.type==="MouseDown"||i.type==="MouseUp"||i.type==="MousePress")&&(i.mode=i.mode||"Object")}))}var Yx=180/Math.PI;function EH(t){t.rotation=t.rotation.slice(0,3).map(e=>e*Yx)}function uY(t){var i,r;EH(t),t.type==="Page"&&EH(t.camera),(i=t.states)==null||i.forEach(n=>{n.rotation===void 0||n.rotation===null||(n.rotation=n.rotation.slice(0,3).map(s=>s*Yx))});let e=t.geometry;e&&e.type==="SphereGeometry"&&(e.thetaLength=(e.thetaLength??180)*Yx),e&&e.type==="TorusGeometry"&&(e.arc=e.arc*Yx),e&&e.type==="PathGeometry"&&(e.extrusion.angle*=Yx,e.extrusion.twist*=Yx),t.type==="Mesh"&&t.geometry.type==="TextGeometry"&&(t.geometry.text={textValue:t.geometry.text}),Array.isArray(Ds(t.events))&&((r=t.events)==null||r.forEach(n=>{(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="MousePress"||n.type==="KeyDown"||n.type==="KeyUp"||n.type==="KeyPress"||n.type==="Collision"||n.type==="Trigger")&&(n.runMode=n.toggle?"Toggle":"Repeat")}))}function Tbe(t){t.shared.variables=lu({},xi.prototype)}function Cbe(t){let e=Ds(t.shared.variables);t.shared.variables=lu(Object.entries(e??{}).map(([i,r],n)=>({fi:n,id:i,data:r})),ai.prototype)}var sp=115;function hY(t,e){e(t.data);for(let i of t.children)hY(i,e)}function Dbe(t){let e=t.schema??104;e!==sp&&e<105&&(hY(t.asset,uY),t.schema=105)}function Pbe(t){t.shared.particles=lu({},xi.prototype),t.shared.lib&&(t.shared.lib.particles=Dp.defaultData().particles)}function Rbe(t){t.scene.objects.traverse((e,i)=>{i.type==="Particle"&&typeof i.renderMaterial.size=="number"&&Object.assign(i.renderMaterial,{size:[i.renderMaterial.size,i.renderMaterial.size]})})}function Obe(t){t.scene.objects.traverse((e,i)=>{i.type==="Page"&&(i.postprocessing.depthOfField.focusDistance=100,i.postprocessing.depthOfField.focalLength=20,i.postprocessing.depthOfField.bokehScale=5)})}function Lbe(t){t.scene.objects.traverse((e,i)=>{var r;Array.isArray(Ds(i.events))!==!1&&((r=i.events)==null||r.forEach(n=>{var a,o,l,c,u,h,d,p,g,x,v;let s=n.runMode;n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp"||n.type==="Collision"||n.type==="Trigger"?(a=n.actions)==null||a.forEach(b=>{b.type==="Transition"&&(b.runMode=s??"Repeat"),(b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode=s==="Toggle"?"Toggle":"Normal")}):n.type==="MouseHover"||n.type==="MousePress"||n.type==="KeyPress"?(o=n.actions)==null||o.forEach(b=>{(b.type==="Transition"||b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Toggle")}):n.type==="GameControl"?(delete n.actions,Object.keys(n.gameActions).forEach(b=>{var w;(w=n.gameActions[b])==null||w.forEach(M=>{M.type==="Transition"&&(M.runMode="Repeat"),M.type==="Animation"&&(M.runMode="Normal")})})):n.type==="DragDrop"?(delete n.actions,(c=(l=n.dragDropActions)==null?void 0:l.drag)==null||c.forEach(b=>{(b.type==="Transition"||b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Toggle")}),(h=(u=n.dragDropActions)==null?void 0:u.drop)==null||h.forEach(b=>{(b.type==="Transition"||b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Toggle")})):n.type==="Resize"?(delete n.actions,(d=n.breakpoints)==null||d.forEach(b=>{var w;(w=b.actions)==null||w.forEach(M=>{(M.type==="Transition"||M.type==="Animation"||M.type==="SwitchCamera")&&(M.runMode="Toggle")})})):n.type==="Start"?(p=n.actions)==null||p.forEach(b=>{b.type==="Transition"&&(b.runMode="Once"),(b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Normal")}):n.type==="VariableChange"||n.type==="Scroll"?(g=n.actions)==null||g.forEach(b=>{b.type==="Transition"&&(b.runMode="Repeat"),(b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Normal")}):n.type==="Conditional"&&(delete n.actions,(x=n.inActions)==null||x.forEach(b=>{b.type==="Transition"&&(b.runMode="Repeat"),(b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Normal")}),(v=n.outActions)==null||v.forEach(b=>{b.type==="Transition"&&(b.runMode="Repeat"),(b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Normal")}))}))})}function Ibe(t){t.shared.userAPIs=lu({},xi.prototype),t.shared.userWebhooks=lu({},xi.prototype),t.shared.lib&&(t.shared.lib.userAPIs=Dp.defaultData().userAPIs,t.shared.lib.userWebhooks=Dp.defaultData().userWebhooks)}function dY(t){let e=t.schema??0;if(e!==sp){console.warn("updating from ",e,"to ",sp),Mbe(t,e),e<100&&(t.scene.publish.joystickSizeAndXYOffset===void 0&&(t.scene.publish.joystickSizeAndXYOffset=lg.defaultData.joystickSizeAndXYOffset),t.schema=100),e<101&&(Jm(t,MH),Km(t,MH),t.schema=101),e<102&&(Ebe(t),t.schema=102),e<104&&(t.shared.catelogs=new xi,t.shared.lib=Dp.defaultData(),t.schema=104),e<105&&(Tbe(t),t.scene.objects.traverse((i,r)=>{uY(r)}),t.schema=105);for(let i of Object.values(t.shared.lib.components))Dbe(i);e<106&&(Cbe(t),t.schema=106),e<107&&(t.shared.lib.variables=Dp.defaultData().variables,t.schema=107),e<109&&(Pbe(t),t.schema=109),e<110&&(Rbe(t),t.schema=110),e<111&&(t.scene.objects.traverse((i,r)=>{Abe(r)}),t.schema=111),e<112&&(Obe(t),t.schema=112),e<113&&(Lbe(t),t.schema=113),e<114&&(t.scene.publish.settings.web.imageQuality===void 0&&(t.scene.publish.settings.web.imageQuality=70),t.schema=114),e<115&&(Ibe(t),t.schema=115)}}var aD;(t=>{t.defaultData={schema:sp,scene:c0.defaultData,frames:new xi().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",KS.defaultData),shared:{...Kc.emptyData(),colors:Kc.defaultColors()}},t.emptyDataForImports=function(){let s=c0.emptyDataWithPage();return{schema:sp,scene:s,frames:new xi().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",KS.defaultData),shared:{...Kc.emptyData(),colors:Kc.defaultColors(),images:Kc.defaultImages()}}},t.emptyData=function(){return{schema:sp,scene:c0.emptyDataWithPage(),frames:new xi().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",KS.defaultData),shared:Kc.emptyData()}},t.clipboard2dData=function(){return{schema:sp,scene:c0.emptyData(),frames:new xi,shared:Kc.emptyData()}},t.collabHelper={...Xz,updateSchema(s){return(s.schema??0)<sp?zw(s,dY):(s.schema??0)-sp}};function e(s){let a=t.collabHelper.updateSchema(s);return typeof a=="number"?a===0?s:null:a.data}t.updateSchemaDirectly=e;function i(s){return{...s,shared:{...s.shared,lib:Dp.defaultData()}}}t.withoutLib=i;function r(s,a){let o=s.scene.objects.get(a);if(o&&o.data.type==="Component")return o;{let l=s.shared.lib.components[a];if(l)return l.asset}}t.getComponentData=r;function n(s){let a=Object.values(s.shared.userAPIs);for(let o of a){let l=o.headers;for(let c of l)if(c.data.key.toLowerCase()==="authorization"&&c.data.value!=="")return!0}return!1}t.hasSensitiveData=n})(aD||(aD={}));var TU;(t=>t.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"})(TU||(TU={}));var AH;(t=>{function e(i){return!0}t.is=e})(AH||(AH={}));var oD;(t=>{t.defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]};function e(r,n){return{position:(n==null?void 0:n.position)??r.position,rotation:(n==null?void 0:n.rotation)??r.rotation,scale:(n==null?void 0:n.scale)??r.scale,shear:(n==null?void 0:n.shear)??r.shear}}t.merge=e;function i(r,n){return EX({position:vp.isEqual(r.position,n.position)?void 0:n.position,rotation:r.rotation===n.rotation?void 0:n.rotation,scale:vp.isEqual(r.scale,n.scale)?void 0:n.scale,shear:r.shear&&n.shear&&vp.isEqual(r.shear,n.shear)?void 0:n.shear})}t.diff=i})(oD||(oD={}));var CU;(t=>t.defaultData={horizontalConstraint:0,verticalConstraint:0})(CU||(CU={}));var TH;(t=>t.defaultData={direction:"row",wrap:"unwrap",align:"top-left",gap:10,rowGap:10,autoGap:!1,autoRowGap:!1,leftPadding:8,rightPadding:8,topPadding:8,bottomPadding:8})(TH||(TH={}));var lD;(t=>t.defaultData={opacity:1,fill:{color:sn.fromHexAndA(_c,1),enabled:!0},stroke:{color:sn.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:sn.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:sn.from0to1([0,0,0,1]),enabled:!1,spread:0}})(lD||(lD={}));var u0;(t=>{function e(a,o){return{name:o}}t.newEmpty=e;function i(a,o){if(o===void 0)return a;let l={...a},c=["width","height","cornerRadius"];for(let u of c)u in l&&u in o&&o[u]!==void 0&&Object.assign(l,{[u]:o[u]});return l}function r(a,o){if(o===void 0)return a;let l={...a};return"fill"in l&&"fill"in o&&o.fill!==void 0&&Object.assign(l,{fill:{...l.fill,...o.fill}}),"stroke"in l&&"stroke"in o&&o.stroke!==void 0&&Object.assign(l,{stroke:{...l.stroke,...o.stroke}}),"layerBlur"in l&&"layerBlur"in o&&o.layerBlur!==void 0&&Object.assign(l,{layerBlur:{...l.layerBlur,...o.layerBlur}}),"backgroundBlur"in l&&"backgroundBlur"in o&&o.backgroundBlur!==void 0&&Object.assign(l,{backgroundBlur:{...l.backgroundBlur,...o.backgroundBlur}}),"dropShadow"in l&&"dropShadow"in o&&o.dropShadow!==void 0&&Object.assign(l,{dropShadow:{...l.dropShadow,...o.dropShadow}}),"innerShadow"in l&&"innerShadow"in o&&o.innerShadow!==void 0&&Object.assign(l,{innerShadow:{...l.innerShadow,...o.innerShadow}}),l}function n(a,o){if(o===void 0)return a;let l={...a};return Object.assign(l,oD.merge(l,o)),l=i(l,o),l=r(l,o),l}t.patch=n;function s(a,o){let l,c=[];for(let[u,h]of Object.entries(o))u!=="name"&&(l===void 0&&(l={path:[],props:{},type:0},c.push(l)),l.props[u]=h);return c}t.toOps=s})(u0||(u0={}));var Nw;(t=>t.defaultData={...oD.defaultData,...CU.defaultData,states:new ai,events:new ai,visible:!0,raycastLock:!1})(Nw||(Nw={}));var H1;(t=>t.defaultData={...Nw.defaultData,...lD.defaultData})(H1||(H1={}));var cD;(t=>t.defaultData={cornerRadius:[0,0,0,0]})(cD||(cD={}));var DU;(t=>t.defaultData={...H1.defaultData,type:"ellipse2d",width:100,height:100,name:"Ellipse"})(DU||(DU={}));var Fw;(t=>t.defaultData={...H1.defaultData,...cD.defaultData,type:"rectangle2d",width:100,height:100,name:"Rectangle"})(Fw||(Fw={}));var PU;(t=>t.defaultData={...H1.defaultData,type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"})(PU||(PU={}));var RU;(t=>t.defaultData={...H1.defaultData,type:"path2d",path:"",name:"Path"})(RU||(RU={}));var CH;(t=>{function e(i){return i.type==="ellipse2d"||i.type==="rectangle2d"||i.type==="text2d"||i.type==="vector2d"||i.type==="path2d"}t.is=e})(CH||(CH={}));var uD;(t=>t.defaultData={...Nw.defaultData,name:"Group",type:"group2d"})(uD||(uD={}));var OU;(t=>t.defaultData=()=>({...Nw.defaultData,...cD.defaultData,...lD.defaultData,name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:sn.fromHexAndA(4737101,1),enabled:!0},stroke:{color:sn.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}}))(OU||(OU={}));var w0;(t=>{function e(a){switch(a){case"rectangle2d":return{...Fw.defaultData};case"ellipse2d":return{...DU.defaultData};case"text2d":return{...PU.defaultData};case"vector2d":return{...Fw.defaultData};case"path2d":return{...RU.defaultData};case"frame2d":return{...OU.defaultData()};case"group2d":return{...uD.defaultData}}}t.defaultData=e;function i(a){return"width"in a&&"height"in a?[typeof a.width=="number"?a.width*.5:0,typeof a.height=="number"?a.height*.5:0]:[0,0]}t.getPivot=i;function r(a){return a.type==="rectangle2d"||a.type==="ellipse2d"||a.type==="text2d"||a.type==="frame2d"}t.isResizeable=r;function n(a){return a.type==="frame2d"&&a.autoLayout!==void 0}t.isAutoLayoutable=n;function s(a){return a.type==="rectangle2d"||a.type==="frame2d"}t.hasCorners=s})(w0||(w0={}));var LU;(t=>(t.defaultData={name:"UI",type:"scene2d",objects:new eo},t.emptyData=function(){return{type:"scene2d",objects:new eo}}))(LU||(LU={}));function h0(t,e=!1){let i=t[0].index!==null,r=new Set(Object.keys(t[0].attributes)),n=new Set(Object.keys(t[0].morphAttributes)),s={},a={},o=t[0].morphTargetsRelative,l=new ni,c=0;for(let u=0;u<t.length;++u){let h=t[u],d=0;if(i!==(h.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let p in h.attributes){if(!r.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;s[p]===void 0&&(s[p]=[]),s[p].push(h.attributes[p]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(o!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let p in h.morphAttributes){if(!n.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;a[p]===void 0&&(a[p]=[]),a[p].push(h.morphAttributes[p])}if(e){let p;if(i)p=h.index.count;else if(h.attributes.position!==void 0)p=h.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,p,u),c+=p}}if(i){let u=0,h=[];for(let d=0;d<t.length;++d){let p=t[d].index;for(let g=0;g<p.count;++g)h.push(p.getX(g)+u);u+=t[d].attributes.position.count}l.setIndex(h)}for(let u in s){let h=DH(s[u]);if(!h)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" attribute."),null;l.setAttribute(u,h)}for(let u in a){let h=a[u][0].length;if(h===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[u]=[];for(let d=0;d<h;++d){let p=[];for(let x=0;x<a[u].length;++x)p.push(a[u][x][d]);let g=DH(p);if(!g)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" morphAttribute."),null;l.morphAttributes[u].push(g)}}return l}function DH(t){let e,i,r,n=0;for(let o=0;o<t.length;++o){let l=t[o];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=l.array.constructor),e!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=l.itemSize),i!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=l.normalized),r!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;n+=l.array.length}let s=new e(n),a=0;for(let o=0;o<t.length;++o)s.set(t[o].array,a),a+=t[o].array.length;return new _i(s,i,r)}var zbe=Math.pow(2,-24),t2=class{constructor(){}};function Rd(t,e,i){return i.min.x=e[t],i.min.y=e[t+1],i.min.z=e[t+2],i.max.x=e[t+3],i.max.y=e[t+4],i.max.z=e[t+5],i}function PH(t){let e=-1,i=-1/0;for(let r=0;r<3;r++){let n=t[r+3]-t[r];n>i&&(i=n,e=r)}return e}function RH(t,e){e.set(t)}function OH(t,e,i){let r,n;for(let s=0;s<3;s++){let a=s+3;r=t[s],n=e[s],i[s]=r<n?r:n,r=t[a],n=e[a],i[a]=r>n?r:n}}function i2(t,e,i){for(let r=0;r<3;r++){let n=e[t+2*r],s=e[t+2*r+1],a=n-s,o=n+s;a<i[r]&&(i[r]=a),o>i[r+3]&&(i[r+3]=o)}}function eS(t){let e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2];return 2*(e*i+i*r+r*e)}function Ube(t,e){if(!t.index){let i=t.attributes.position.count,r=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n;i>65535?n=new Uint32Array(new r(4*i)):n=new Uint16Array(new r(2*i)),t.setIndex(new _i(n,1));for(let s=0;s<i;s++)n[s]=s}}function Bbe(t){if(!t.groups||!t.groups.length)return[{offset:0,count:t.index.count/3}];let e=[],i=new Set;for(let n of t.groups)i.add(n.start),i.add(n.start+n.count);let r=Array.from(i.values()).sort((n,s)=>n-s);for(let n=0;n<r.length-1;n++){let s=r[n],a=r[n+1];e.push({offset:s/3,count:(a-s)/3})}return e}function BO(t,e,i,r,n=null){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,u=-1/0,h=1/0,d=1/0,p=1/0,g=-1/0,x=-1/0,v=-1/0,b=n!==null;for(let w=e*6,M=(e+i)*6;w<M;w+=6){let E=t[w+0],D=t[w+1],T=E-D,L=E+D;T<s&&(s=T),L>l&&(l=L),b&&E<h&&(h=E),b&&E>g&&(g=E);let P=t[w+2],R=t[w+3],O=P-R,U=P+R;O<a&&(a=O),U>c&&(c=U),b&&P<d&&(d=P),b&&P>x&&(x=P);let F=t[w+4],V=t[w+5],k=F-V,K=F+V;k<o&&(o=k),K>u&&(u=K),b&&F<p&&(p=F),b&&F>v&&(v=F)}r[0]=s,r[1]=a,r[2]=o,r[3]=l,r[4]=c,r[5]=u,b&&(n[0]=h,n[1]=d,n[2]=p,n[3]=g,n[4]=x,n[5]=v)}function Nbe(t,e,i,r){let n=1/0,s=1/0,a=1/0,o=-1/0,l=-1/0,c=-1/0;for(let u=e*6,h=(e+i)*6;u<h;u+=6){let d=t[u+0];d<n&&(n=d),d>o&&(o=d);let p=t[u+2];p<s&&(s=p),p>l&&(l=p);let g=t[u+4];g<a&&(a=g),g>c&&(c=g)}r[0]=n,r[1]=s,r[2]=a,r[3]=o,r[4]=l,r[5]=c}function Fbe(t,e,i,r,n){let s=i,a=i+r-1,o=n.pos,l=n.axis*2;for(;;){for(;s<=a&&e[s*6+l]<o;)s++;for(;s<=a&&e[a*6+l]>=o;)a--;if(s<a){for(let c=0;c<3;c++){let u=t[s*3+c];t[s*3+c]=t[a*3+c],t[a*3+c]=u;let h=e[s*6+c*2+0];e[s*6+c*2+0]=e[a*6+c*2+0],e[a*6+c*2+0]=h;let d=e[s*6+c*2+1];e[s*6+c*2+1]=e[a*6+c*2+1],e[a*6+c*2+1]=d}s++,a--}else return s}}var ep=32,kbe=(t,e)=>t.candidate-e.candidate,Cm=new Array(ep).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),r2=new Float32Array(6);function Vbe(t,e,i,r,n,s){let a=-1,o=0;if(s===0)a=PH(e),a!==-1&&(o=(e[a]+e[a+3])/2);else if(s===1)a=PH(t),a!==-1&&(o=Hbe(i,r,n,a));else if(s===2){let l=eS(t),c=1.25*n,u=r*6,h=(r+n)*6;for(let d=0;d<3;d++){let p=e[d],g=(e[d+3]-p)/ep;if(n<ep/4){let x=[...Cm];x.length=n;let v=0;for(let w=u;w<h;w+=6,v++){let M=x[v];M.candidate=i[w+2*d],M.count=0;let{bounds:E,leftCacheBounds:D,rightCacheBounds:T}=M;for(let L=0;L<3;L++)T[L]=1/0,T[L+3]=-1/0,D[L]=1/0,D[L+3]=-1/0,E[L]=1/0,E[L+3]=-1/0;i2(w,i,E)}x.sort(kbe);let b=n;for(let w=0;w<b;w++){let M=x[w];for(;w+1<b&&x[w+1].candidate===M.candidate;)x.splice(w+1,1),b--}for(let w=u;w<h;w+=6){let M=i[w+2*d];for(let E=0;E<b;E++){let D=x[E];M>=D.candidate?i2(w,i,D.rightCacheBounds):(i2(w,i,D.leftCacheBounds),D.count++)}}for(let w=0;w<b;w++){let M=x[w],E=M.count,D=n-M.count,T=M.leftCacheBounds,L=M.rightCacheBounds,P=0;E!==0&&(P=eS(T)/l);let R=0;D!==0&&(R=eS(L)/l);let O=1+1.25*(P*E+R*D);O<c&&(a=d,c=O,o=M.candidate)}}else{for(let b=0;b<ep;b++){let w=Cm[b];w.count=0,w.candidate=p+g+b*g;let M=w.bounds;for(let E=0;E<3;E++)M[E]=1/0,M[E+3]=-1/0}for(let b=u;b<h;b+=6){let w=~~((i[b+2*d]-p)/g);w>=ep&&(w=ep-1);let M=Cm[w];M.count++,i2(b,i,M.bounds)}let x=Cm[ep-1];RH(x.bounds,x.rightCacheBounds);for(let b=ep-2;b>=0;b--){let w=Cm[b],M=Cm[b+1];OH(w.bounds,M.rightCacheBounds,w.rightCacheBounds)}let v=0;for(let b=0;b<ep-1;b++){let w=Cm[b],M=w.count,E=w.bounds,D=Cm[b+1].rightCacheBounds;M!==0&&(v===0?RH(E,r2):OH(E,r2,r2)),v+=M;let T=0,L=0;v!==0&&(T=eS(r2)/l);let P=n-v;P!==0&&(L=eS(D)/l);let R=1+1.25*(T*v+L*P);R<c&&(a=d,c=R,o=w.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:a,pos:o}}function Hbe(t,e,i,r){let n=0;for(let s=e,a=e+i;s<a;s++)n+=t[s*6+r*2];return n/i}function Gbe(t,e){let i=t.attributes.position,r=t.index.array,n=r.length/3,s=new Float32Array(n*6),a=i.normalized,o=i.array,l=i.offset||0,c=3;i.isInterleavedBufferAttribute&&(c=i.data.stride);let u=["getX","getY","getZ"];for(let h=0;h<n;h++){let d=h*3,p=h*6,g,x,v;a?(g=r[d+0],x=r[d+1],v=r[d+2]):(g=r[d+0]*c+l,x=r[d+1]*c+l,v=r[d+2]*c+l);for(let b=0;b<3;b++){let w,M,E;a?(w=i[u[b]](g),M=i[u[b]](x),E=i[u[b]](v)):(w=o[g+b],M=o[x+b],E=o[v+b]);let D=w;M<D&&(D=M),E<D&&(D=E);let T=w;M>T&&(T=M),E>T&&(T=E);let L=(T-D)/2,P=b*2;s[p+P+0]=D+L,s[p+P+1]=L+(Math.abs(D)+L)*zbe,D<e[b]&&(e[b]=D),T>e[b+3]&&(e[b+3]=T)}}return s}function jbe(t,e){function i(b){d&&d(b/p)}function r(b,w,M,E=null,D=0){if(!g&&D>=l&&(g=!0,c&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),M<=u||D>=l)return i(w+M),b.offset=w,b.count=M,b;let T=Vbe(b.boundingData,E,a,w,M,h);if(T.axis===-1)return i(w+M),b.offset=w,b.count=M,b;let L=Fbe(o,a,w,M,T);if(L===w||L===w+M)i(w+M),b.offset=w,b.count=M;else{b.splitAxis=T.axis;let P=new t2,R=w,O=L-w;b.left=P,P.boundingData=new Float32Array(6),BO(a,R,O,P.boundingData,s),r(P,R,O,s,D+1);let U=new t2,F=L,V=M-O;b.right=U,U.boundingData=new Float32Array(6),BO(a,F,V,U.boundingData,s),r(U,F,V,s,D+1)}return b}Ube(t,e);let n=new Float32Array(6),s=new Float32Array(6),a=Gbe(t,n),o=t.index.array,l=e.maxDepth,c=e.verbose,u=e.maxLeafTris,h=e.strategy,d=e.onProgress,p=t.index.count/3,g=!1,x=[],v=Bbe(t);if(v.length===1){let b=v[0],w=new t2;w.boundingData=n,Nbe(a,b.offset,b.count,s),r(w,b.offset,b.count,s),x.push(w)}else for(let b of v){let w=new t2;w.boundingData=new Float32Array(6),BO(a,b.offset,b.count,w.boundingData,s),r(w,b.offset,b.count,s),x.push(w)}return x}function Wbe(t,e){let i=jbe(t,e),r,n,s,a=[],o=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let u=0;u<i.length;u++){let h=i[u],d=l(h),p=new o(32*d);r=new Float32Array(p),n=new Uint32Array(p),s=new Uint16Array(p),c(0,h),a.push(p)}return a;function l(u){return u.count?1:1+l(u.left)+l(u.right)}function c(u,h){let d=u/4,p=u/2,g=!!h.count,x=h.boundingData;for(let v=0;v<6;v++)r[d+v]=x[v];if(g){let v=h.offset,b=h.count;return n[d+6]=v,s[p+14]=b,s[p+15]=65535,u+32}else{let v=h.left,b=h.right,w=h.splitAxis,M;if(M=c(u+32,v),M/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[d+6]=M/4,M=c(M,b),n[d+7]=w,M}}}var Pp=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let i=1/0,r=-1/0;for(let n=0,s=t.length;n<s;n++){let a=t[n][e];i=a<i?a:i,r=a>r?a:r}this.min=i,this.max=r}setFromPoints(t,e){let i=1/0,r=-1/0;for(let n=0,s=e.length;n<s;n++){let a=e[n],o=t.dot(a);i=o<i?o:i,r=o>r?o:r}this.min=i,this.max=r}isSeparated(t){return this.min>t.max||t.min>this.max}};Pp.prototype.setFromBox=function(){let t=new W;return function(e,i){let r=i.min,n=i.max,s=1/0,a=-1/0;for(let o=0;o<=1;o++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){t.x=r.x*o+n.x*(1-o),t.y=r.y*l+n.y*(1-l),t.z=r.z*c+n.z*(1-c);let u=e.dot(t);s=Math.min(u,s),a=Math.max(u,a)}this.min=s,this.max=a}}();var qbe=function(){let t=new W,e=new W,i=new W;return function(r,n,s){let a=r.start,o=t,l=n.start,c=e;i.subVectors(a,l),t.subVectors(r.end,r.start),e.subVectors(n.end,n.start);let u=i.dot(c),h=c.dot(o),d=c.dot(c),p=i.dot(o),g=o.dot(o)*d-h*h,x,v;g!==0?x=(u*h-p*d)/g:x=0,v=(u+x*h)/d,s.x=x,s.y=v}}(),s4=function(){let t=new Oe,e=new W,i=new W;return function(r,n,s,a){qbe(r,n,t);let o=t.x,l=t.y;if(o>=0&&o<=1&&l>=0&&l<=1){r.at(o,s),n.at(l,a);return}else if(o>=0&&o<=1){l<0?n.at(0,a):n.at(1,a),r.closestPointToPoint(a,!0,s);return}else if(l>=0&&l<=1){o<0?r.at(0,s):r.at(1,s),n.closestPointToPoint(s,!0,a);return}else{let c;o<0?c=r.start:c=r.end;let u;l<0?u=n.start:u=n.end;let h=e,d=i;if(r.closestPointToPoint(u,!0,e),n.closestPointToPoint(c,!0,i),h.distanceToSquared(u)<=d.distanceToSquared(c)){s.copy(h),a.copy(u);return}else{s.copy(c),a.copy(d);return}}}}(),Xbe=function(){let t=new W,e=new W,i=new Bl,r=new nu;return function(n,s){let{radius:a,center:o}=n,{a:l,b:c,c:u}=s;if(r.start=l,r.end=c,r.closestPointToPoint(o,!0,t).distanceTo(o)<=a||(r.start=l,r.end=u,r.closestPointToPoint(o,!0,t).distanceTo(o)<=a)||(r.start=c,r.end=u,r.closestPointToPoint(o,!0,t).distanceTo(o)<=a))return!0;let h=s.getPlane(i);if(Math.abs(h.distanceToPoint(o))<=a){let d=h.projectPoint(o,e);if(s.containsPoint(d))return!0}return!1}}(),Ybe=1e-15;function ox(t){return Math.abs(t)<Ybe}var Rp=class extends $a{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new W),this.satBounds=new Array(4).fill().map(()=>new Pp),this.points=[this.a,this.b,this.c],this.sphere=new Xl,this.plane=new Bl,this.needsUpdate=!0}intersectsSphere(t){return Xbe(t,this)}update(){let t=this.a,e=this.b,i=this.c,r=this.points,n=this.satAxes,s=this.satBounds,a=n[0],o=s[0];this.getNormal(a),o.setFromPoints(a,r);let l=n[1],c=s[1];l.subVectors(t,e),c.setFromPoints(l,r);let u=n[2],h=s[2];u.subVectors(e,i),h.setFromPoints(u,r);let d=n[3],p=s[3];d.subVectors(i,t),p.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,t),this.needsUpdate=!1}};Rp.prototype.closestPointToSegment=function(){let t=new W,e=new W,i=new nu;return function(r,n=null,s=null){let{start:a,end:o}=r,l=this.points,c,u=1/0;for(let h=0;h<3;h++){let d=(h+1)%3;i.start.copy(l[h]),i.end.copy(l[d]),s4(i,r,t,e),c=t.distanceToSquared(e),c<u&&(u=c,n&&n.copy(t),s&&s.copy(e))}return this.closestPointToPoint(a,t),c=a.distanceToSquared(t),c<u&&(u=c,n&&n.copy(t),s&&s.copy(a)),this.closestPointToPoint(o,t),c=o.distanceToSquared(t),c<u&&(u=c,n&&n.copy(t),s&&s.copy(o)),Math.sqrt(u)}}();Rp.prototype.intersectsTriangle=function(){let t=new Rp,e=new Array(3),i=new Array(3),r=new Pp,n=new Pp,s=new W,a=new W,o=new W,l=new W,c=new nu,u=new nu,h=new nu;return function(d,p=null,g=!1){this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(t.copy(d),t.update(),d=t);let x=this.plane,v=d.plane;if(Math.abs(x.normal.dot(v.normal))>1-1e-10){let b=this.satBounds,w=this.satAxes;i[0]=d.a,i[1]=d.b,i[2]=d.c;for(let D=0;D<4;D++){let T=b[D],L=w[D];if(r.setFromPoints(L,i),T.isSeparated(r))return!1}let M=d.satBounds,E=d.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let D=0;D<4;D++){let T=M[D],L=E[D];if(r.setFromPoints(L,e),T.isSeparated(r))return!1}for(let D=0;D<4;D++){let T=w[D];for(let L=0;L<4;L++){let P=E[L];if(s.crossVectors(T,P),r.setFromPoints(s,e),n.setFromPoints(s,i),r.isSeparated(n))return!1}}return p&&(g||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}else{let b=this.points,w=!1,M=0;for(let V=0;V<3;V++){let k=b[V],K=b[(V+1)%3];c.start.copy(k),c.end.copy(K),c.delta(a);let X=w?u.start:u.end,$=ox(v.distanceToPoint(k));if(ox(v.normal.dot(a))&&$){u.copy(c),M=2;break}if((v.intersectLine(c,X)||$)&&!ox(X.distanceTo(K))){if(M++,w)break;w=!0}}if(M===1&&d.containsPoint(u.end))return p&&(p.start.copy(u.end),p.end.copy(u.end)),!0;if(M!==2)return!1;let E=d.points,D=!1,T=0;for(let V=0;V<3;V++){let k=E[V],K=E[(V+1)%3];c.start.copy(k),c.end.copy(K),c.delta(o);let X=D?h.start:h.end,$=ox(x.distanceToPoint(k));if(ox(x.normal.dot(o))&&$){h.copy(c),T=2;break}if((x.intersectLine(c,X)||$)&&!ox(X.distanceTo(K))){if(T++,D)break;D=!0}}if(T===1&&this.containsPoint(h.end))return p&&(p.start.copy(h.end),p.end.copy(h.end)),!0;if(T!==2)return!1;if(u.delta(a),h.delta(o),a.dot(o)<0){let V=h.start;h.start=h.end,h.end=V}let L=u.start.dot(a),P=u.end.dot(a),R=h.start.dot(a),O=h.end.dot(a),U=P<R,F=L<O;return L!==O&&R!==P&&U===F?!1:(p&&(l.subVectors(u.start,h.start),l.dot(a)>0?p.start.copy(u.start):p.start.copy(h.start),l.subVectors(u.end,h.end),l.dot(a)<0?p.end.copy(u.end):p.end.copy(h.end)),!0)}}}();Rp.prototype.distanceToPoint=function(){let t=new W;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}();Rp.prototype.distanceToTriangle=function(){let t=new W,e=new W,i=["a","b","c"],r=new nu,n=new nu;return function(s,a=null,o=null){let l=a||o?r:null;if(this.intersectsTriangle(s,l))return(a||o)&&(a&&l.getCenter(a),o&&l.getCenter(o)),0;let c=1/0;for(let u=0;u<3;u++){let h,d=i[u],p=s[d];this.closestPointToPoint(p,t),h=p.distanceToSquared(t),h<c&&(c=h,a&&a.copy(t),o&&o.copy(p));let g=this[d];s.closestPointToPoint(g,t),h=g.distanceToSquared(t),h<c&&(c=h,a&&a.copy(g),o&&o.copy(t))}for(let u=0;u<3;u++){let h=i[u],d=i[(u+1)%3];r.set(this[h],this[d]);for(let p=0;p<3;p++){let g=i[p],x=i[(p+1)%3];n.set(s[g],s[x]),s4(r,n,t,e);let v=t.distanceToSquared(e);v<c&&(c=v,a&&a.copy(t),o&&o.copy(e))}}return Math.sqrt(c)}}();var qd=class{constructor(t,e,i){this.isOrientedBox=!0,this.min=new W,this.max=new W,this.matrix=new Ot,this.invMatrix=new Ot,this.points=new Array(8).fill().map(()=>new W),this.satAxes=new Array(3).fill().map(()=>new W),this.satBounds=new Array(3).fill().map(()=>new Pp),this.alignedSatBounds=new Array(3).fill().map(()=>new Pp),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),i&&this.matrix.copy(i)}set(t,e,i){this.min.copy(t),this.max.copy(e),this.matrix.copy(i),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}};qd.prototype.update=function(){return function(){let t=this.matrix,e=this.min,i=this.max,r=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){let h=1*l|2*c|4*u,d=r[h];d.x=l?i.x:e.x,d.y=c?i.y:e.y,d.z=u?i.z:e.z,d.applyMatrix4(t)}let n=this.satBounds,s=this.satAxes,a=r[0];for(let l=0;l<3;l++){let c=s[l],u=n[l],h=1<<l,d=r[h];c.subVectors(a,d),u.setFromPoints(c,r)}let o=this.alignedSatBounds;o[0].setFromPointsField(r,"x"),o[1].setFromPointsField(r,"y"),o[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();qd.prototype.intersectsBox=function(){let t=new Pp;return function(e){this.needsUpdate&&this.update();let i=e.min,r=e.max,n=this.satBounds,s=this.satAxes,a=this.alignedSatBounds;if(t.min=i.x,t.max=r.x,a[0].isSeparated(t)||(t.min=i.y,t.max=r.y,a[1].isSeparated(t))||(t.min=i.z,t.max=r.z,a[2].isSeparated(t)))return!1;for(let o=0;o<3;o++){let l=s[o],c=n[o];if(t.setFromBox(l,e),c.isSeparated(t))return!1}return!0}}();qd.prototype.intersectsTriangle=function(){let t=new Rp,e=new Array(3),i=new Pp,r=new Pp,n=new W;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(t.copy(s),t.update(),s=t);let a=this.satBounds,o=this.satAxes;e[0]=s.a,e[1]=s.b,e[2]=s.c;for(let h=0;h<3;h++){let d=a[h],p=o[h];if(i.setFromPoints(p,e),d.isSeparated(i))return!1}let l=s.satBounds,c=s.satAxes,u=this.points;for(let h=0;h<3;h++){let d=l[h],p=c[h];if(i.setFromPoints(p,u),d.isSeparated(i))return!1}for(let h=0;h<3;h++){let d=o[h];for(let p=0;p<4;p++){let g=c[p];if(n.crossVectors(d,g),i.setFromPoints(n,e),r.setFromPoints(n,u),i.isSeparated(r))return!1}}return!0}}();qd.prototype.closestPointToPoint=function(){return function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}();qd.prototype.distanceToPoint=function(){let t=new W;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}();qd.prototype.distanceToBox=function(){let t=["x","y","z"],e=new Array(12).fill().map(()=>new nu),i=new Array(12).fill().map(()=>new nu),r=new W,n=new W;return function(s,a=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||l)&&(s.getCenter(n),this.closestPointToPoint(n,r),s.closestPointToPoint(r,n),o&&o.copy(r),l&&l.copy(n)),0;let c=a*a,u=s.min,h=s.max,d=this.points,p=1/0;for(let x=0;x<8;x++){let v=d[x];n.copy(v).clamp(u,h);let b=v.distanceToSquared(n);if(b<p&&(p=b,o&&o.copy(v),l&&l.copy(n),b<c))return Math.sqrt(b)}let g=0;for(let x=0;x<3;x++)for(let v=0;v<=1;v++)for(let b=0;b<=1;b++){let w=(x+1)%3,M=(x+2)%3,E=v<<w|b<<M,D=1<<x|v<<w|b<<M,T=d[E],L=d[D];e[g].set(T,L);let P=t[x],R=t[w],O=t[M],U=i[g],F=U.start,V=U.end;F[P]=u[P],F[R]=v?u[R]:h[R],F[O]=b?u[O]:h[R],V[P]=h[P],V[R]=v?u[R]:h[R],V[O]=b?u[O]:h[R],g++}for(let x=0;x<=1;x++)for(let v=0;v<=1;v++)for(let b=0;b<=1;b++){n.x=x?h.x:u.x,n.y=v?h.y:u.y,n.z=b?h.z:u.z,this.closestPointToPoint(n,r);let w=n.distanceToSquared(r);if(w<p&&(p=w,o&&o.copy(r),l&&l.copy(n),w<c))return Math.sqrt(w)}for(let x=0;x<12;x++){let v=e[x];for(let b=0;b<12;b++){let w=i[b];s4(v,w,r,n);let M=r.distanceToSquared(n);if(M<p&&(p=M,o&&o.copy(r),l&&l.copy(n),M<c))return Math.sqrt(M)}}return Math.sqrt(p)}}();var lx=new W,cx=new W,ux=new W,n2=new Oe,s2=new Oe,a2=new Oe,LH=new W,IH=new W,zH=new W,o2=new W;function Qbe(t,e,i,r,n,s){let a;return s===La?a=t.intersectTriangle(r,i,e,!0,n):a=t.intersectTriangle(e,i,r,s!==Oo,n),a===null?null:{distance:t.origin.distanceTo(n),point:n.clone()}}function Zbe(t,e,i,r,n,s,a,o,l){lx.fromBufferAttribute(e,s),cx.fromBufferAttribute(e,a),ux.fromBufferAttribute(e,o);let c=Qbe(t,lx,cx,ux,o2,l);if(c){r&&(n2.fromBufferAttribute(r,s),s2.fromBufferAttribute(r,a),a2.fromBufferAttribute(r,o),c.uv=$a.getInterpolation(o2,lx,cx,ux,n2,s2,a2,new Oe)),n&&(n2.fromBufferAttribute(n,s),s2.fromBufferAttribute(n,a),a2.fromBufferAttribute(n,o),c.uv1=$a.getInterpolation(o2,lx,cx,ux,n2,s2,a2,new Oe)),i&&(LH.fromBufferAttribute(i,s),IH.fromBufferAttribute(i,a),zH.fromBufferAttribute(i,o),c.normal=$a.getInterpolation(o2,lx,cx,ux,LH,IH,zH,new W),c.normal.dot(t.direction)>0&&c.normal.multiplyScalar(-1));let u={a:s,b:a,c:o,normal:new W,materialIndex:0};$a.getNormal(lx,cx,ux,u.normal),c.face=u,c.faceIndex=s}return c}function fY(t,e,i,r,n){let s=r*3,a=t.index.getX(s),o=t.index.getX(s+1),l=t.index.getX(s+2),{position:c,normal:u,uv:h,uv1:d}=t.attributes,p=Zbe(i,c,u,h,d,a,o,l,e);return p?(p.faceIndex=r,n&&n.push(p),p):null}function Kbe(t,e,i,r,n,s){for(let a=r,o=r+n;a<o;a++)fY(t,e,i,a,s)}function Jbe(t,e,i,r,n){let s=1/0,a=null;for(let o=r,l=r+n;o<l;o++){let c=fY(t,e,i,o);c&&c.distance<s&&(a=c,s=c.distance)}return a}function Cd(t,e,i,r){let n=t.a,s=t.b,a=t.c,o=e,l=e+1,c=e+2;i&&(o=i.getX(e),l=i.getX(e+1),c=i.getX(e+2)),n.x=r.getX(o),n.y=r.getY(o),n.z=r.getZ(o),s.x=r.getX(l),s.y=r.getY(l),s.z=r.getZ(l),a.x=r.getX(c),a.y=r.getY(c),a.z=r.getZ(c)}function UH(t,e,i,r,n,s,a){let o=i.index,l=i.attributes.position;for(let c=t,u=e+t;c<u;c++)if(Cd(a,c*3,o,l),a.needsUpdate=!0,r(a,c,n,s))return!0;return!1}var pY=class{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){let t=this._primitives;return t.length===0?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}};function $m(t,e){return e[t+15]===65535}function g1(t,e){return e[t+6]}function kw(t,e){return e[t+14]}function Vw(t){return t+8}function Hw(t,e){return e[t+6]}function $be(t,e){return e[t+7]}var r1=new Os,hD=new W,e_e=["x","y","z"];function IU(t,e,i,r,n){let s=t*2,a=xb,o=gg,l=vg;if($m(s,o)){let c=g1(t,l),u=kw(s,o);Kbe(e,i,r,c,u,n)}else{let c=Vw(t);dD(c,a,r,hD)&&IU(c,e,i,r,n);let u=Hw(t,l);dD(u,a,r,hD)&&IU(u,e,i,r,n)}}function zU(t,e,i,r){let n=t*2,s=xb,a=gg,o=vg;if($m(n,a)){let l=g1(t,o),c=kw(n,a);return Jbe(e,i,r,l,c)}else{let l=$be(t,o),c=e_e[l],u=r.direction[c]>=0,h,d;u?(h=Vw(t),d=Hw(t,o)):(h=Hw(t,o),d=Vw(t));let p=dD(h,s,r,hD)?zU(h,e,i,r):null;if(p){let x=p.point[c];if(u?x<=s[d+l]:x>=s[d+l+3])return p}let g=dD(d,s,r,hD)?zU(d,e,i,r):null;return p&&g?p.distance<=g.distance?p:g:p||g||null}}var t_e=function(){let t,e,i=[],r=new pY(()=>new Os);return function(...s){t=r.getPrimitive(),e=r.getPrimitive(),i.push(t,e);let a=n(...s);r.releasePrimitive(t),r.releasePrimitive(e),i.pop(),i.pop();let o=i.length;return o>0&&(e=i[o-1],t=i[o-2]),a};function n(s,a,o,l,c=null,u=0,h=0){function d(w){let M=w*2,E=gg,D=vg;for(;!$m(M,E);)w=Vw(w),M=w*2;return g1(w,D)}function p(w){let M=w*2,E=gg,D=vg;for(;!$m(M,E);)w=Hw(w,D),M=w*2;return g1(w,D)+kw(M,E)}let g=s*2,x=xb,v=gg,b=vg;if($m(g,v)){let w=g1(s,b),M=kw(g,v);return Rd(s,x,t),l(w,M,!1,h,u+s,t)}else{let w=Vw(s),M=Hw(s,b),E=w,D=M,T,L,P,R;if(c&&(P=t,R=e,Rd(E,x,P),Rd(D,x,R),T=c(P),L=c(R),L<T)){E=M,D=w;let X=T;T=L,L=X,P=R}P||(P=t,Rd(E,x,P));let O=$m(E*2,v),U=o(P,O,T,h+1,u+E),F;if(U===2){let X=d(E),$=p(E)-X;F=l(X,$,!0,h+1,u+E,P)}else F=U&&n(E,a,o,l,c,u,h+1);if(F)return!0;R=e,Rd(D,x,R);let V=$m(D*2,v),k=o(R,V,L,h+1,u+D),K;if(k===2){let X=d(D),$=p(D)-X;K=l(X,$,!0,h+1,u+D,R)}else K=k&&n(D,a,o,l,c,u,h+1);return!!K}}}(),i_e=function(){let t=new Rp,e=new Rp,i=new Ot,r=new qd,n=new qd;return function s(a,o,l,c,u=null){let h=a*2,d=xb,p=gg,g=vg;if(u===null&&(l.boundingBox||l.computeBoundingBox(),r.set(l.boundingBox.min,l.boundingBox.max,c),u=r),$m(h,p)){let x=o,v=x.index,b=x.attributes.position,w=l.index,M=l.attributes.position,E=g1(a,g),D=kw(h,p);if(i.copy(c).invert(),l.boundsTree)return Rd(a,d,n),n.matrix.copy(i),n.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:T=>n.intersectsBox(T),intersectsTriangle:T=>{T.a.applyMatrix4(c),T.b.applyMatrix4(c),T.c.applyMatrix4(c),T.needsUpdate=!0;for(let L=E*3,P=(D+E)*3;L<P;L+=3)if(Cd(e,L,v,b),e.needsUpdate=!0,T.intersectsTriangle(e))return!0;return!1}});for(let T=E*3,L=D+E*3;T<L;T+=3){Cd(t,T,v,b),t.a.applyMatrix4(i),t.b.applyMatrix4(i),t.c.applyMatrix4(i),t.needsUpdate=!0;for(let P=0,R=w.count;P<R;P+=3)if(Cd(e,P,w,M),e.needsUpdate=!0,t.intersectsTriangle(e))return!0}}else{let x=a+8,v=g[a+6];return Rd(x,d,r1),!!(u.intersectsBox(r1)&&s(x,o,l,c,u)||(Rd(v,d,r1),u.intersectsBox(r1)&&s(v,o,l,c,u)))}}}();function dD(t,e,i,r){return Rd(t,e,r1),i.intersectBox(r1,r)}var UU=[],$T,xb,gg,vg;function IS(t){$T&&UU.push($T),$T=t,xb=new Float32Array(t),gg=new Uint16Array(t),vg=new Uint32Array(t)}function l2(){$T=null,xb=null,gg=null,vg=null,UU.length&&IS(UU.pop())}var NO=Symbol("skip tree generation"),FO=new Os,kO=new Os,hx=new Ot,Av=new qd,tS=new qd,iS=new W,c2=new W,r_e=new W,n_e=new W,s_e=new W,BH=new Os,pd=new pY(()=>new Rp),JS=class{static serialize(t,e={}){if(e.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),JS.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});e={cloneBuffers:!0,...e};let i=t.geometry,r=t._roots,n=i.getIndex(),s;return e.cloneBuffers?s={roots:r.map(a=>a.slice()),index:n.array.slice()}:s={roots:r,index:n.array},s}static deserialize(t,e,i={}){if(typeof i=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),JS.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});i={setIndex:!0,...i};let{index:r,roots:n}=t,s=new JS(e,{...i,[NO]:!0});if(s._roots=n,i.setIndex){let a=e.getIndex();if(a===null){let o=new _i(t.index,1,!1);e.setIndex(o)}else a.array!==r&&(a.array.set(r),a.needsUpdate=!0)}return s}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[NO]:!1},e),e.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,e[NO]||(this._roots=Wbe(t,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new Os))),this.geometry=t}refit(t=null){t&&Array.isArray(t)&&(t=new Set(t));let e=this.geometry,i=e.index.array,r=e.attributes.position,n,s,a,o,l=0,c=this._roots;for(let h=0,d=c.length;h<d;h++)n=c[h],s=new Uint32Array(n),a=new Uint16Array(n),o=new Float32Array(n),u(0,l),l+=n.byteLength;function u(h,d,p=!1){let g=h*2;if(a[g+15]===65535){let x=s[h+6],v=a[g+14],b=1/0,w=1/0,M=1/0,E=-1/0,D=-1/0,T=-1/0;for(let L=3*x,P=3*(x+v);L<P;L++){let R=i[L],O=r.getX(R),U=r.getY(R),F=r.getZ(R);O<b&&(b=O),O>E&&(E=O),U<w&&(w=U),U>D&&(D=U),F<M&&(M=F),F>T&&(T=F)}return o[h+0]!==b||o[h+1]!==w||o[h+2]!==M||o[h+3]!==E||o[h+4]!==D||o[h+5]!==T?(o[h+0]=b,o[h+1]=w,o[h+2]=M,o[h+3]=E,o[h+4]=D,o[h+5]=T,!0):!1}else{let x=h+8,v=s[h+6],b=x+d,w=v+d,M=p,E=!1,D=!1;t?M||(E=t.has(b),D=t.has(w),M=!E&&!D):(E=!0,D=!0);let T=M||E,L=M||D,P=!1;T&&(P=u(x,d,M));let R=!1;L&&(R=u(v,d,M));let O=P||R;if(O)for(let U=0;U<3;U++){let F=x+U,V=v+U,k=o[F],K=o[F+3],X=o[V],$=o[V+3];o[h+U]=k<X?k:X,o[h+U+3]=K>$?K:$}return O}}}traverse(t,e=0){let i=this._roots[e],r=new Uint32Array(i),n=new Uint16Array(i);s(0);function s(a,o=0){let l=a*2,c=n[l+15]===65535;if(c){let u=r[a+6],h=n[l+14];t(o,c,new Float32Array(i,a*4,6),u,h)}else{let u=a+8,h=r[a+6],d=r[a+7];t(o,c,new Float32Array(i,a*4,6),d)||(s(u,o+1),s(h,o+1))}}}raycast(t,e=gh){let i=this._roots,r=this.geometry,n=[],s=e.isMaterial,a=Array.isArray(e),o=r.groups,l=s?e.side:e;for(let c=0,u=i.length;c<u;c++){let h=a?e[o[c].materialIndex].side:l,d=n.length;if(IS(i[c]),IU(0,r,h,t,n),l2(),a){let p=o[c].materialIndex;for(let g=d,x=n.length;g<x;g++)n[g].face.materialIndex=p}}return n}raycastFirst(t,e=gh){let i=this._roots,r=this.geometry,n=e.isMaterial,s=Array.isArray(e),a=null,o=r.groups,l=n?e.side:e;for(let c=0,u=i.length;c<u;c++){let h=s?e[o[c].materialIndex].side:l;IS(i[c]);let d=zU(0,r,h,t);l2(),d!=null&&(a==null||d.distance<a.distance)&&(a=d,s&&(d.face.materialIndex=o[c].materialIndex))}return a}intersectsGeometry(t,e){let i=this.geometry,r=!1;for(let n of this._roots)if(IS(n),r=i_e(0,i,t,e),l2(),r)break;return r}shapecast(t,e,i){let r=this.geometry;if(t instanceof Function){if(e){let h=e;e=(d,p,g,x)=>{let v=p*3;return h(d,v,v+1,v+2,g,x)}}t={boundsTraverseOrder:i,intersectsBounds:t,intersectsTriangle:e,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let n=pd.getPrimitive(),{boundsTraverseOrder:s,intersectsBounds:a,intersectsRange:o,intersectsTriangle:l}=t;if(o&&l){let h=o;o=(d,p,g,x,v)=>h(d,p,g,x,v)?!0:UH(d,p,r,l,g,x,n)}else o||(l?o=(h,d,p,g)=>UH(h,d,r,l,p,g,n):o=(h,d,p)=>p);let c=!1,u=0;for(let h of this._roots){if(IS(h),c=t_e(0,r,a,o,s,u),l2(),c)break;u+=h.byteLength}return pd.releasePrimitive(n),c}bvhcast(t,e,i){let{intersectsRanges:r,intersectsTriangles:n}=i,s=this.geometry.index,a=this.geometry.attributes.position,o=t.geometry.index,l=t.geometry.attributes.position;hx.copy(e).invert();let c=pd.getPrimitive(),u=pd.getPrimitive();if(n){let d=function(p,g,x,v,b,w,M,E){for(let D=x,T=x+v;D<T;D++){Cd(u,D*3,o,l),u.a.applyMatrix4(e),u.b.applyMatrix4(e),u.c.applyMatrix4(e),u.needsUpdate=!0;for(let L=p,P=p+g;L<P;L++)if(Cd(c,L*3,s,a),c.needsUpdate=!0,n(c,u,L,D,b,w,M,E))return!0}return!1};if(r){let p=r;r=function(g,x,v,b,w,M,E,D){return p(g,x,v,b,w,M,E,D)?!0:d(g,x,v,b,w,M,E,D)}}else r=d}t.getBoundingBox(kO),kO.applyMatrix4(e);let h=this.shapecast({intersectsBounds:d=>kO.intersectsBox(d),intersectsRange:(d,p,g,x,v,b)=>(FO.copy(b),FO.applyMatrix4(hx),t.shapecast({intersectsBounds:w=>FO.intersectsBox(w),intersectsRange:(w,M,E,D,T)=>r(d,p,w,M,x,v,D,T)}))});return pd.releasePrimitive(c),pd.releasePrimitive(u),h}intersectsBox(t,e){return Av.set(t.min,t.max,e),Av.needsUpdate=!0,this.shapecast({intersectsBounds:i=>Av.intersectsBox(i),intersectsTriangle:i=>Av.intersectsTriangle(i)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,i={},r={},n=0,s=1/0){t.boundingBox||t.computeBoundingBox(),Av.set(t.boundingBox.min,t.boundingBox.max,e),Av.needsUpdate=!0;let a=this.geometry,o=a.attributes.position,l=a.index,c=t.attributes.position,u=t.index,h=pd.getPrimitive(),d=pd.getPrimitive(),p=c2,g=r_e,x=null,v=null;r&&(x=n_e,v=s_e);let b=1/0,w=null,M=null;return hx.copy(e).invert(),tS.matrix.copy(hx),this.shapecast({boundsTraverseOrder:E=>Av.distanceToBox(E),intersectsBounds:(E,D,T)=>T<b&&T<s?(D&&(tS.min.copy(E.min),tS.max.copy(E.max),tS.needsUpdate=!0),!0):!1,intersectsRange:(E,D)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:T=>tS.distanceToBox(T),intersectsBounds:(T,L,P)=>P<b&&P<s,intersectsRange:(T,L)=>{for(let P=T*3,R=(T+L)*3;P<R;P+=3){Cd(d,P,u,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let O=E*3,U=(E+D)*3;O<U;O+=3){Cd(h,O,l,o),h.needsUpdate=!0;let F=h.distanceToTriangle(d,p,x);if(F<b&&(g.copy(p),v&&v.copy(x),b=F,w=O/3,M=P/3),F<n)return!0}}}});{let T=u?u.count:c.count;for(let L=0,P=T;L<P;L+=3){Cd(d,L,u,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let R=E*3,O=(E+D)*3;R<O;R+=3){Cd(h,R,l,o),h.needsUpdate=!0;let U=h.distanceToTriangle(d,p,x);if(U<b&&(g.copy(p),v&&v.copy(x),b=U,w=R/3,M=L/3),U<n)return!0}}}}}),pd.releasePrimitive(h),pd.releasePrimitive(d),b===1/0?null:(i.point?i.point.copy(g):i.point=g.clone(),i.distance=b,i.faceIndex=w,r&&(r.point?r.point.copy(v):r.point=v.clone(),r.point.applyMatrix4(hx),g.applyMatrix4(hx),r.distance=g.sub(r.point).length(),r.faceIndex=M),i)}closestPointToPoint(t,e={},i=0,r=1/0){let n=i*i,s=r*r,a=1/0,o=null;if(this.shapecast({boundsTraverseOrder:c=>(iS.copy(t).clamp(c.min,c.max),iS.distanceToSquared(t)),intersectsBounds:(c,u,h)=>h<a&&h<s,intersectsTriangle:(c,u)=>{c.closestPointToPoint(t,iS);let h=t.distanceToSquared(iS);return h<a&&(c2.copy(iS),a=h,o=u),h<n}}),a===1/0)return null;let l=Math.sqrt(a);return e.point?e.point.copy(c2):e.point=c2.clone(),e.distance=l,e.faceIndex=o,e}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(e=>{Rd(0,new Float32Array(e),BH),t.union(BH)}),t}},BU=Dg(ase()),a_e=.5*(Math.sqrt(3)-1),rS=(3-Math.sqrt(3))/6,o_e=1/3,md=1/6,$S=t=>Math.floor(t)|0,NH=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),VO=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function l_e(t=Math.random){let e=mY(t),i=new Float64Array(e).map(n=>NH[n%12*2]),r=new Float64Array(e).map(n=>NH[n%12*2+1]);return function(n,s){let a=0,o=0,l=0,c=(n+s)*a_e,u=$S(n+c),h=$S(s+c),d=(u+h)*rS,p=u-d,g=h-d,x=n-p,v=s-g,b,w;x>v?(b=1,w=0):(b=0,w=1);let M=x-b+rS,E=v-w+rS,D=x-1+2*rS,T=v-1+2*rS,L=u&255,P=h&255,R=.5-x*x-v*v;if(R>=0){let F=L+e[P],V=i[F],k=r[F];R*=R,a=R*R*(V*x+k*v)}let O=.5-M*M-E*E;if(O>=0){let F=L+b+e[P+w],V=i[F],k=r[F];O*=O,o=O*O*(V*M+k*E)}let U=.5-D*D-T*T;if(U>=0){let F=L+1+e[P+1],V=i[F],k=r[F];U*=U,l=U*U*(V*D+k*T)}return 70*(a+o+l)}}function c_e(t=Math.random){let e=mY(t),i=new Float64Array(e).map(s=>VO[s%12*3]),r=new Float64Array(e).map(s=>VO[s%12*3+1]),n=new Float64Array(e).map(s=>VO[s%12*3+2]);return function(s,a,o){let l,c,u,h,d=(s+a+o)*o_e,p=$S(s+d),g=$S(a+d),x=$S(o+d),v=(p+g+x)*md,b=p-v,w=g-v,M=x-v,E=s-b,D=a-w,T=o-M,L,P,R,O,U,F;E>=D?D>=T?(L=1,P=0,R=0,O=1,U=1,F=0):E>=T?(L=1,P=0,R=0,O=1,U=0,F=1):(L=0,P=0,R=1,O=1,U=0,F=1):D<T?(L=0,P=0,R=1,O=0,U=1,F=1):E<T?(L=0,P=1,R=0,O=0,U=1,F=1):(L=0,P=1,R=0,O=1,U=1,F=0);let V=E-L+md,k=D-P+md,K=T-R+md,X=E-O+2*md,$=D-U+2*md,Y=T-F+2*md,re=E-1+3*md,G=D-1+3*md,j=T-1+3*md,ee=p&255,oe=g&255,Q=x&255,ae=.6-E*E-D*D-T*T;if(ae<0)l=0;else{let xe=ee+e[oe+e[Q]];ae*=ae,l=ae*ae*(i[xe]*E+r[xe]*D+n[xe]*T)}let ne=.6-V*V-k*k-K*K;if(ne<0)c=0;else{let xe=ee+L+e[oe+P+e[Q+R]];ne*=ne,c=ne*ne*(i[xe]*V+r[xe]*k+n[xe]*K)}let ue=.6-X*X-$*$-Y*Y;if(ue<0)u=0;else{let xe=ee+O+e[oe+U+e[Q+F]];ue*=ue,u=ue*ue*(i[xe]*X+r[xe]*$+n[xe]*Y)}let fe=.6-re*re-G*G-j*j;if(fe<0)h=0;else{let xe=ee+1+e[oe+1+e[Q+1]];fe*=fe,h=fe*fe*(i[xe]*re+r[xe]*G+n[xe]*j)}return 32*(l+c+u+h)}}function mY(t){let e=new Uint8Array(512);for(let i=0;i<512/2;i++)e[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(t()*(256-i)),n=e[i];e[i]=e[r],e[r]=n}for(let i=256;i<512;i++)e[i]=e[i-256];return e}var Yu=new $a,u_e=class{constructor(t){this.weightAttribute=null;let e=t.geometry;if(!e.isBufferGeometry||e.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");e.index&&(e=e.toNonIndexed()),this.geometry=e,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let t=this.positionAttribute,e=new Float32Array(t.count/3);for(let r=0;r<t.count;r+=3){let n=1;Yu.a.fromBufferAttribute(t,r),Yu.b.fromBufferAttribute(t,r+1),Yu.c.fromBufferAttribute(t,r+2),n*=Yu.getArea(),e[r/3]=n}this.distribution=new Float32Array(t.count/3);let i=0;for(let r=0;r<e.length;r++)i+=e[r],this.distribution[r]=i;return this}setRandomGenerator(t){return this.randomFunction=t,this}sample(t,e){if(this.distribution){let i=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*i);return this.sampleFace(r,t,e)}}binarySearch(t){if(!this.distribution)return 0;let e=this.distribution,i=0,r=e.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||e[s-1]<=t&&e[s]>t){n=s;break}else t<e[s]?r=s-1:i=s+1}return n}sampleFace(t,e,i){let r=this.randomFunction(),n=this.randomFunction();return r+n>1&&(r=1-r,n=1-n),Yu.a.fromBufferAttribute(this.positionAttribute,t*3),Yu.b.fromBufferAttribute(this.positionAttribute,t*3+1),Yu.c.fromBufferAttribute(this.positionAttribute,t*3+2),e.set(0,0,0).addScaledVector(Yu.a,r).addScaledVector(Yu.b,n).addScaledVector(Yu.c,1-(r+n)),Yu.getNormal(i),this}},h_e=Dg(Q7()),d_e=new Ot,f_e=new Ot,p_e=new Ot,U0;(t=>{function e(i){return i&&i.__isSPEObject}t.is=e})(U0||(U0={}));var a4=t=>class extends t{constructor(){super(...arguments),this.previousModelViewMatrix=new Ot,this.copyPreviousMatrix=!0,this.hiddenMatrix=new Ot,this.matrixWorldRigid=new Ot,this.shearScale=new Ot,this.shearScaleInv=new Ot}get __isSPEObject(){return!0}isDescendantOf(e){e instanceof Kr&&(e=e.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===e)return!0;i=i.parent}return!1}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);for(let i of this.children)i.updateMatrixWorld(e)}updateWorldMatrix(e,i){let r=this.parent;if(e&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let n of this.children)n.updateWorldMatrix(!1,!0)}traverseChildren(e,i=0){for(let r of this.children)U0.is(r)&&r.traverseObject(e,i+1)}traverseObject(e,i=0){if(e(this,i)!==!0)for(let r of this.children)U0.is(r)&&r.traverseObject(e,i+1)}updateMatrixWorldSVD(){let e=this.matrixWorld.elements,i=[[e[0],e[4],e[8]],[e[1],e[5],e[9]],[e[2],e[6],e[10]]],{u:r,v:n,q:s}=(0,h_e.SVD)(i),a=d_e.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),o=f_e.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),l=p_e.copy(o).transpose();this.shearScale.makeScale(s[0],s[1],s[2]).multiply(l).premultiply(o),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(a,l).copyPosition(this.matrixWorld),s.every(c=>Math.abs(s[0]-c)<.01)?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(e,i){this.updateWorldMatrix(!0,!1);let r=new Ot().copy(this.matrixWorld).invert();return e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),r.multiply(e.parent.matrixWorld)),"hiddenMatrix"in e&&e.hiddenMatrix instanceof Ot?e.hiddenMatrix.premultiply(r):e.applyMatrix4(r),e.updateWorldMatrix(!1,!1),this.add(e),i!==void 0&&(this.children.pop(),this.children.splice(i,0,e)),this}copy(e,i=!1){return super.copy(e,i),this.hasNonUniformScale=e.hasNonUniformScale,this}onAfterRender(e,i,r,n,s,a){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},m_e=class extends a4(Kr){},g_e=t=>t.type==="Mesh",io=class extends m_e{constructor(t){super(),this.object=t,this.matrixAutoUpdate=!1,this.hasNonUniformScale=t.hasNonUniformScale}raycast(t,e){}expand(){let t=0,e=this.object.entityChildren(t);for(;e;){let i=this.children[t];(i==null?void 0:i.object)!==e&&(i&&this.remove(i),i=new io(e),this.add(i),this.children.splice(t,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=e.matrix,i.hiddenMatrix=e.hiddenMatrix),i.expand(),t+=1,e=this.object.entityChildren(t)}for(;this.children.length>t;)this.remove(this.children[t])}get visible(){var t;return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&((t=this.object.dataPatched.cloner)==null?void 0:t.hideBase)===!0}set visible(t){}get castShadow(){return this.object.castShadow}set castShadow(t){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(t){}get isMesh(){return g_e(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(t){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},$v=new W,e0=new W,v1=new Ot,gY=[new W(-1,1,1),new W(-1,-1,1),new W(1,-1,1),new W(1,1,1),new W(-1,1,-1),new W(-1,-1,-1),new W(1,-1,-1),new W(1,1,-1)],v_e=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],y_e=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],FH=(t,e,i)=>{t.updateEntityBoxSize($v,e0),v1.copy(e).multiply(t.matrixWorld),e0.x===0&&e0.y===0&&e0.z===0?i.push(new W($v.x,$v.y,$v.z).applyMatrix4(v1)):gY.forEach(r=>{i.push(r.clone().multiply(e0).add($v).applyMatrix4(v1))})},kH=class extends Os{constructor(){super(...arguments),this.matrix=new Ot,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(t){return super.copy(t),this.matrix.copy(t.matrix),this.vertices=t.vertices.map(e=>e.clone()),this.faces=t.faces.map(e=>e.clone()),this.edges=t.edges.map(e=>e.clone()),this.centerEdges=t.centerEdges.map(e=>e.clone()),this}setFromObjectSize(t,e=!1){t.updateWorldMatrix(!1,e),this.makeEmpty(),this.matrix.copy(t.matrixWorld);let i=new Ot().copy(t.matrixWorld).invert();return this.expandByObjectSize(t,i,e)}expandByObjectSize(t,e,i=!1){let r=[];return i===!0?t.traverseEntity(n=>{if(n.visible||n.cloner&&n.data.visible){if(!("geometry"in n)){r.push(new W);return}FH(n,e,r)}}):FH(t,e,r),this.setFromPoints(r)}getCenter(t){return t=super.getCenter(t),t.applyMatrix4(this.matrix),t}getPositionToCenter(t){return t=super.getCenter(t),t.applyMatrix4(v1.copy(this.matrix).setPosition(0,0,0)),t}computeVertices(){this.getSize(e0).multiplyScalar(.5),this.getCenter($v),v1.copy(this.matrix).setPosition($v),this.vertices=gY.map(t=>t.clone().multiply(e0).applyMatrix4(v1))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=v_e.map(([t,e])=>new nu(this.vertices[t],this.vertices[e])),this.centerEdges=this.edges.map(t=>t.getCenter(new W))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=y_e.map(([t,e])=>this.vertices[t].clone().add(this.vertices[e]).multiplyScalar(.5))}},cg={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},x_e=class extends Eq{constructor(){super()}getPoints(t=12){let e=[],i,r=this.getCurveLengths(),n=r[r.length-1]/r.length;for(let s=0,a=this.curves;s<a.length;s++){let o=a[s],l=s===0?r[s]:r[s]-r[s-1],c=Math.ceil(t*l/n),u=o.getPoints(c);for(let h=0;h<u.length;h++){let d=u[h];i&&i.equals(d)||(e.push(d),i=d)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}},NU=.001;function FU(t,e,i){return e.clone().sub(t).cross(e.clone().sub(i)).length()<=NU}function HO(t,e){let i=new W(...t.position),r=new W(...t.controlNext.position),n=new W(...e.controlPrevious.position),s=new W(...e.position);return FU(i,r,s)&&FU(i,n,s)}function vY(t){let e=t.points.map(u=>new W(...u.data.position)),i=[t.points[0]],r=new W(...i[0].data.position);for(let u=0;u<t.points.length-1;u++)FU(r,e[u],e[u+1])||(i.push(t.points[u]),r=e[u]);i.push(t.points[t.points.length-1]);let n=t.isClosed,s=i.length-(n?0:1),a=i.length,o=[];for(let u=0;u<a;u++){let h=i[u].data,d=new W(...h.position),p=new W(...h.controlPrevious.position),g=new W(...h.controlNext.position),x={position:d,baseRoundness:h.roundness,controlPrevious:p,controlNext:g};if(h.roundness===0||!t.isClosed&&(u===0||u===a-1)){o[u]={...x,removedLength:0};continue}let v=n&&u==0?a-1:u-1,b=n&&u==a-1?0:u+1,w=i[v].data,M=i[b].data,E=new W(...w.position),D=new W(...M.position),T=E.clone().sub(d).normalize(),L=D.clone().sub(d).normalize();Object.assign(x,{prevDir:T,nextDir:L});let P=HO(w,h),R=HO(h,M);if(!P||!R)o[u]={...x,removedLength:0};else{let O=T.clone().add(L).normalize(),U=O.clone().cross(T).length()/T.dot(O);o[u]={...x,tan:U,removedLength:h.roundness/U}}}for(let u=0;u<s;u++){let h=u,d=n&&u===a-1?0:u+1,p=o[h],g=o[d];if(p.removedLength!==0||g.removedLength!==0){let x=p.position.distanceTo(g.position);p.removedLength=Math.min(p.removedLength,x/2),g.removedLength=Math.min(g.removedLength,x/2)}}let l=[];for(let u=0;u<s;u++){let h=u,d=n&&u===a-1?0:u+1,p=o[h],g=o[d],x=null;if(!HO(i[h].data,i[d].data))p.position.distanceTo(g.position)>NU&&(x=new YT(p.position,p.controlNext,g.controlPrevious,g.position));else{let v=p.position.clone(),b=g.position.clone();(p.removedLength!==0||g.removedLength!==0)&&(p.nextDir&&v.add(p.nextDir.clone().setLength(p.removedLength)),g.prevDir&&b.add(g.prevDir.clone().setLength(g.removedLength))),v.distanceTo(b)>NU&&(x=new YT(v,v.clone().lerp(b,.3),b.clone().lerp(v,.3),b))}l[2*u+1]=x}for(let u=0;u<a;u++){let h=o[u];if(h.removedLength===0){l[2*u]=null;continue}let d=h.position,p=h.prevDir.clone().multiplyScalar(h.removedLength).add(d),g=h.nextDir.clone().multiplyScalar(h.removedLength).add(d),x=h.tan*h.removedLength,v=h.prevDir.clone().add(h.nextDir).normalize(),b=p.clone().lerp(g,.5),w=p.distanceTo(g)/2,M=v.clone().multiplyScalar(Math.sqrt(Math.pow(x,2)-Math.pow(w,2))).add(b),E=v.clone().multiplyScalar(-x).add(M),D=d.distanceTo(E)/d.distanceTo(b),T=h.prevDir.clone().multiplyScalar(D*d.distanceTo(p)).add(d),L=T.clone().lerp(E,2),P=p.clone().lerp(T,4/3),R=g.clone().lerp(L,4/3);l[2*u]=new YT(p,P,R,g)}let c=new x_e;return l.forEach(u=>{u&&c.add(u)}),c}var gr;(t=>{function e(i){return i&&i.__isEntity}t.is=e})(gr||(gr={}));var ap=t=>gr.is(t),b_e={type:"completeState",isfromEntity:!0},__e=["x","y","z"],GO=new W,S_e=new W().set(0,1,0),o4=t=>class extends a4(t){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new kH,this._recursiveBBox=new kH,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(e){let i=this.children[e];if(gr.is(i))return i}entityChildrenCount(){let e=this.children.length;for(;e--;)if(gr.is(this.children[e]))return e+1;return 0}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let e=this;for(;e.data.type!=="Instance";){let i=e.parent;if(gr.is(i))e=i;else return}return e}forInstancesRec(e){this.instances.forEach(i=>{i.disposed||e(i),i.forInstancesRec(e)})}super_Entity(e,i){typeof e=="string"&&(this.uuid=e),this.identity=e,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(e,i,r=!1){if(!(this.data.states.length===0&&!r)){for(let n of this.data.states)o0.toOps(this.data,n.data).forEach(s=>{let a=WC.replaceProps(s,this.data);this.dataPatched=this.data,this.updateByPatchedOp(a,this.data,i)});if(e!==null){let n=this.data.states.data(e);n&&(this.dataPatched=o0.patch(this.data,n),o0.toOps(this.data,n).forEach(s=>{this.updateByPatchedOp(s,this.dataPatched,i)}))}r&&this.updateTransformState(this.dataPatched,i),this.stateSelection=e,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(e,i){e.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(e=>{ap(e)&&e.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(e=>{e.resetBBoxNeedsUpdateSelf()})}find(e){let i;return this.traverseEntity(r=>{r.uuid===e&&(i=r)}),i}traverseSortNextHelper(){let e=this.parent;if(e){let i=e.children,r=i.indexOf(this)+1;if(gr.is(i[r]))return i[r];if(gr.is(e))return e.traverseSortNextHelper()}}sortNext(){let e=this.children;return this.children.length>0&&gr.is(this.children[0])?e[0]:this.traverseSortNextHelper()}goUp(e){let i=this;for(;e>0&&i!==null;)i=i.parent,e-=1;return i}hasAnccestorOrSelf(e){return this===e||this.hasAnccestor(e)}hasAnccestor(e){let i=this.parent;for(;i;){if(e===i)return!0;i=i.parent}return!1}countToAccestor(e){let i=0,r=this;for(;r!==e;){if(r===null)return-1;r=r.parent,i+=1}return i}forEachEntity(e){for(let i of this.children)ap(i)&&e(i)}traverseEntityAncestors(e){this.traverseAncestors(i=>{gr.is(i)&&e(i)})}traverseConcreteEntity(e,i=0){if(e(this,i)!==!0)for(let r of this.children)ap(r)&&r.isConcreteEntity&&r.traverseEntity(e,i+1)}traverseEntity(e,i=0){if(e(this,i)!==!0)for(let r of this.children)ap(r)&&r.traverseEntity(e,i+1)}traverseVisibleEntity(e){e(this);for(let i of this.children)ap(i)&&i.visible&&i.traverseVisibleEntity(e)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(e){super.updateMatrixWorld(e),this.dispatchEvent({type:"updateMatrixWorld"})}copy(e,i=!1){return super.copy(e,i),this.dataPatched=e.dataPatched,this.raycastLock=e.raycastLock,this.scaleLock=e.scaleLock,this.hiddenMatrix.copy(e.hiddenMatrix),this}hasEntityChild(){return this.children.some(e=>ap(e))}isAncestorOf(e){if(this.uuid===e)return!1;let i=!1;return this.traverseEntity(r=>{r.uuid===e&&(i=!0)}),i}toObjectTransformState(e=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x*Qt.RAD2DEG,this.rotation.y*Qt.RAD2DEG,this.rotation.z*Qt.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return qz(i,e)}getTransformValues(e,i,r){return i[e].map((n,s)=>(r==null?void 0:r.shared.getVariable(n,[this.uuid,e,__e[s]]))??n)}updateTransformState(e,i){let r=!1;return e.position&&(this.position.fromArray(this.getTransformValues("position",e,i)),r=!0),e.rotation&&(GO.fromArray(this.getTransformValues("rotation",e,i)).multiplyScalar(Qt.DEG2RAD),this.rotation.setFromVector3(GO),r=!0),e.scale&&(this.scale.fromArray(this.getTransformValues("scale",e,i)),r=!0),e.hiddenMatrix!==void 0&&(r=!0,this.hiddenMatrix.fromArray(e.hiddenMatrix??U1.identity)),r&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(n=>{n.invalidateClonerTransform(this)})),e.position&&e.rotation&&e.scale&&e.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),r}onVariableUpdate(e=!1){if(e){this.resetBBoxNeedsUpdate();return}this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(i=>{i.invalidateClonerTransform(this)})}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let e of this.children)gr.is(e)&&e.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(e=>{gr.is(e)&&e.disposeRecursively()})}toState(e=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(e)};return qz(i,e)}updateByObjUpdateOp(e,i){e!==void 0&&this.updateByOp({type:0,props:e,path:[]},{...this.data,...e},i,!1)}updateByOp(e,i,r,n){let s=this.data;this.data=i;let a=e,o=dn(e.path,["states","*"]);if(o!==null){if(e.type===0){let[l]=o;if((this==null?void 0:this.stateSelection)===l){let c={...e.props};if(delete c.name,Object.values(e.props).some(u=>u===void 0)){let u=this.data;if(u!==void 0){let h=ra.zoom(u,e.path.slice(2));if(h)for(let d in e.props)e.props[d]===void 0&&d in h&&(c[d]=h[d])}}a={...e,props:c,path:e.path.slice(2)}}}}else if(e.type===0){let l=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(l!==void 0){if(e.props.name!==void 0&&l.name){let{name:u,...h}=l;l=h}if(e.props.material!==void 0&&"material"in l){let{material:u,...h}=l;l=h}let c=ra.removeOverridden(e.path,e.props,l);a={...e,props:c}}}if(this.updateByPatchedOpBase(a,o0.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),r),dn(e.path,["overrides"])){let l=[],c=[...e.path];for(l.push(c[1]),c.splice(0,2);c.length>0&&c[0]==="descendants";)l.push(c[1]),c.splice(0,2);if(l[l.length-1]===void 0){if(e.type===0)for(let u of Object.keys(e.props)){l[l.length-1]=u;let h=r.scene.findInstance([this.uuid,...l]);h&&(h.overrideData=e.props[u],h.updateState(pg.apply(h.component.data,h.overrideData),r))}}else{let u=r.scene.findInstance([this.uuid,...l]);if(u){let h=ra.zoom(u.component.data,c);if(e={...e,path:c},e.type===0){let d=e.props;if(h)for(let[p,g]of Object.entries(e.props))g===void 0&&(d===e.props&&(d={...e.props}),d[p]=h[p]);e={...e,props:d}}u.overrideData=iD.resolve(i.overrides,l),u.updateByOp(e,Ra.applySimple(u.data,e),r,!1)}}}else if(this.instances.length>0){let l;if(e.path.length===0&&e.type===0){let c;for(let u of og.rootOverrideProps)u in e.props&&(c===void 0&&(c={}),c[u]=e.props[u]);c&&(l={...e,props:c})}else for(let c of og.rootOverrideProps)if(dn(e.path,[c])){l=e;break}l!==void 0&&this.instances.forEach(c=>{if(c.isInstanceRoot){let u=pg.filterOp(c.overrideData,l);u&&c.updateByOp(u,Ra.applySimple(c.data,u),r,!0)}}),this.instances.forEach(c=>{if(!c.isInstanceRoot){let u=pg.filterOp(c.overrideData,e);if(u){let h;s===c.data&&e===u?h=i:h=Ra.applySimple(c.data,u),c.updateByOp(u,h,r,!0)}}})}}updateByPatchedOpBase(e,i,r){if(this.dataPatched=i,e.path.length===0&&e.type===0)e.props.type!==void 0&&!z0.is(e.props.type)&&cg.changeEntityProptotype(this,i,r);else if(e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&"type"in e.props){cg.changeEntityProptotype(this,i,r);for(let n of this.children)gr.is(n)&&n.updateVisible(r.scene)}this.updateByPatchedOp(e,i,r)}updateByPatchedOp(e,i,r){var n;if(e.path.length===0&&e.type===0?this.updateState(e.props,r):e.type===0&&("resolutionLevel"in e.props||"useChildrenColors"in e.props)&&this.updateState(i,r),e.path[0]==="morphTargetInfluences"&&e.type===0){let s=(n=i.morphTargetInfluences.get(e.path[1]))==null?void 0:n.data.name;s&&this.updateMorphInfluences(s,r.shared.getVariable(e.props.value,[this.uuid,"morphTargetInfluences",s]))}if(dn(e.path,["pathSnapping"])!==null&&this.updatePathSnapping(i.pathSnapping),dn(e.path,["cloner"])!==null){let s=Ra.drop(e,1);s.path.length===0&&s.type===0&&s.props.disabled===!0?this.setFromClonerState(null,r):this.cloner?this.cloner.updateState(i.cloner,r.scene):(this.setFromClonerState(i.cloner,r),this.expandCloner(r.scene)),this.updateVisible(r.scene)}}updatePathSnapping(e=this.dataPatched.pathSnapping){this._updatedPathSnapping=e,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(e){var g,x,v,b,w;let i=((g=this._updatedPathSnapping)==null?void 0:g.pathId)??this.dataPatched.pathSnapping.pathId,r=((x=this._updatedPathSnapping)==null?void 0:x.slide)??this.dataPatched.pathSnapping.slide??0,n=((v=this._updatedPathSnapping)==null?void 0:v.offset)??this.dataPatched.pathSnapping.offset??0,s=((b=this._updatedPathSnapping)==null?void 0:b.orientation)??this.dataPatched.pathSnapping.orientation;if(i===null)return;let a=e.find(i);if(!a||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let o=a.data;if(o.geometry.path.points.length<=1)return;let l=vY(o.geometry.path),c=(r+n)%1;r+n===1&&c===0&&(c=1);let u=null;try{u=l.curves.length?l.getPointAt(c):null}catch{}if(u===null)return;let h=this.parent?(w=this.parent)==null?void 0:w.matrixWorld:new Ot;a.updateMatrixWorld();let d=new Ot().multiplyMatrices(h.clone().invert(),a.matrixWorld);u.applyMatrix4(d);let p={position:u.toArray(),rotation:o.rotation};if(s==="tangential"){let M=new Ot().extractRotation(a.matrixWorld),E=l.getTangentAt(c).applyMatrix4(M).add(u),D=new Ot().lookAt(u,E,S_e),T=GO.setFromEuler(new ia().setFromRotationMatrix(D)).multiplyScalar(Qt.RAD2DEG);p={...p,rotation:T.toArray()}}this.updateTransformState(p),this.traverseEntity(M=>{M._cameraType&&M.dispatchEvent(b_e)})}updateVisible(e){var r;if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||((r=this.dataPatched.cloner)==null?void 0:r.hideBase)!==!0),!e)return;let i=!1;this.traverseEntity(n=>{if(n.data.type==="Splat")return i=!0,!0}),i&&e.reloadSplats()}updateState_Entity(e,i){e.name!==void 0&&(this.name=e.name),e.raycastLock!==void 0&&(this.raycastLock=e.raycastLock),e.visible!==void 0&&(this.updateVisible(i==null?void 0:i.scene),this.resetBBoxNeedsUpdate()),i&&"cloner"in e&&e.cloner!==void 0&&(this.setFromClonerState(e.cloner,i),this.updateVisible(i.scene)),this.updateTransformState(e,i)}get attachedSurfaceCloners(){return this.children.filter(e=>e instanceof cg.Cloner&&e.parameters.type==="toObject")}setFromClonerState(e,i){this.disposed||(e===null||e.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new cg.Cloner(this,e),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(e,i.scene))}expandCloner(e){!this.disposed&&this.cloner&&this.cloner.expandClones(e)}invalidateClonerTransform(e){this.cloner&&this.cloner.invalidateTransform(e)}requestRender(){this.dispatchEvent({type:"requestRender"})}},yY=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){var l,c;let i=(l=t.parameters)==null?void 0:l.radiusTop,r=(c=t.parameters)==null?void 0:c.radiusBottom,n=Object.assign({},(e==null?void 0:e.parameters)??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},t.parameters);n.thetaLength=Qt.clamp(n.thetaLength,0,360);let s=n.width/2,a=n.radiusTop??s,o=n.radiusBottom??s;if(a===o?(a=s,o=s):a>o?(a=s,o=o*s/a):(a=a*s/o,o=s),n.shapeBlendNode){a=i??s,o=r??s;let u=Math.max(a,o)*2;n.width=u,n.depth=u}return{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??n.width),radiusTop:a,radiusBottom:o})}}static build(t){let{width:e,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,radiusTop:c,radiusBottom:u,cornerRadius:h,cornerSegments:d,hollow:p}=t.parameters,g;return l===0?(g=new ni,g.setAttribute("position",new Wt([],3))):h||p?g=new xY(c,u,r,n,s,a,o,l*Math.PI/180,h,h,d,p):g=new EN(c,u,r,n,s,a,o,l*Math.PI/180),g.scale(1,1,i/e),Object.assign(g,{userData:{...t,type:"CylinderGeometry"}})}};function Dm(t,e,i){i.x=t.x*e.x,i.y=t.y,i.z=t.x*e.y}function VH(t){return new Oe(t.y,-t.x)}var xY=class extends ni{constructor(t,e,i,r,n,s,a,o,l,c,u,h,d=!1){super(),this.type="RoundedCylinderBufferGeometry",t=t!==void 0?t:1,e=e!==void 0?e:1,i=i||1,r=Math.floor(r)||8,n=Math.floor(n)||1,s=s!==void 0?s:!1,a=a!==void 0?a:0,o=o!==void 0?o:Math.PI*2,s&&(l=0,c=0);let p=[],g=[],x=[],v=[],b=0,w=i/2,M=new W,E=new W;d&&t==0&&(t=l),d&&e==0&&(e=c);let D=new Oe(t,w),T=new Oe(e,-w),L=null,P=null,R=null,O=null,U=D.clone().sub(T),F=0,V=0,k=0;h>0&&(F=Math.min(t,e)*(1-h),V=t-F,k=e-F);let K=D.clone();K.x-=F;let X=Math.PI-U.angle(),$=U.angle(),Y=Math.tan($/2),re=Math.tan(X/2),G=Y+re,j=h?G:re,ee=h?G:Y;if(l=Math.min(l,(t-V)/j,U.length()/G),c=Math.min(c,(e-k)/ee,U.length()/G),l>0){let fe=l/Y;L=D.clone().sub(new Oe(fe,l)),h&&(R=L.clone(),R.x-=F-G*l),D.sub(U.clone().setLength(fe))}if(c>0){let fe=c/re;P=T.clone().sub(new Oe(fe,-c)),T.add(U.clone().setLength(fe)),h&&(O=P.clone(),O.x-=F-G*c,K.sub(U.clone().setLength(fe)))}U=D.clone().sub(T);let oe=U.length()<.5,Q=[];for(let fe=0;fe<=r;fe++){let xe=[],be=fe/r,Ce=be*o+a,ge=new Oe(Math.sin(Ce),Math.cos(Ce));O&&P?(ae(xe,be,ge,X,c,O,-1,!0),ae(xe,be,ge,$,c,P,-1,!1)):P?(ne(xe,ge,P.x,0,-1),ae(xe,be,ge,$,c,P,-1,!1)):s||ne(xe,ge,e,k,-1);let Te=VH(U).normalize();if(Dm(Te,ge,M),!oe)for(let ce=0;ce<=n;ce++){let Ue=ce/n,ze=U.clone().multiplyScalar(Ue).add(T);Dm(ze,ge,E),g.push(E.x,E.y,E.z),x.push(M.x,M.y,M.z),v.push(be,.5+E.y/i),xe.push(b++)}if(R&&L?(ae(xe,be,ge,X,l,L,1,!1),ae(xe,be,ge,$,l,R,1,!0)):L?(ae(xe,be,ge,X,l,L,1,!1),ne(xe,ge,L.x,0,1)):s||ne(xe,ge,t,V,1),h&&!oe){let ce=VH(U).multiplyScalar(-1).normalize();Dm(ce,ge,M);for(let Ue=0;Ue<=n;Ue++){let ze=Ue/n,Xe=U.clone().multiplyScalar(-ze).add(K);Dm(Xe,ge,E),g.push(E.x,E.y,E.z),x.push(M.x,M.y,M.z),v.push(be,.5+E.y/i),xe.push(b++)}}h&&!s&&xe.push(xe[0]),Q.push(xe)}for(let fe=0;fe<Q.length-1;fe++)for(let xe=0;xe<Q[0].length-1;xe++){if(s&&h&&xe==n)continue;let be=Q[fe][xe],Ce=Q[fe+1][xe],ge=Q[fe+1][xe+1],Te=Q[fe][xe+1],ce=g[ge*3+0],Ue=g[ge*3+2];p.push(be,Ce,Te),(ce!=0||Ue!=0)&&p.push(Ce,ge,Te)}o<Math.PI*2&&(ue(-1,Q[0],a),ue(1,Q[Q.length-1],a+o)),this.setIndex(p),this.setAttribute("position",new Wt(g,3)),this.setAttribute("normal",new Wt(x,3)),this.setAttribute("uv",new Wt(v,2));function ae(fe,xe,be,Ce,ge,Te,ce,Ue){for(let ze=0;ze<u+1;ze++){let Xe=ze/u,De=ce<0?Xe:1-Xe;Ue&&(De-=1),De*=Ce;let Ge=new Oe(Math.sin(De),Math.cos(De)*ce),We=Ge.clone().multiplyScalar(ge).add(Te);Dm(We,be,E),g.push(E.x,E.y,E.z),Dm(Ge,be,M),x.push(M.x,M.y,M.z),v.push(xe,.5+E.y/i),fe.push(b++)}}function ne(fe,xe,be,Ce,ge){let Te=new W,ce=new Oe,Ue=[be,Ce];ge<0&&Ue.reverse();for(let ze of Ue)ce.set(ze,w*ge),Dm(ce,xe,Te),g.push(Te.x,Te.y,Te.z),x.push(0,ge,0),v.push(.5,.5),fe.push(b++)}function ue(fe,xe,be){let Ce=new Oe(Math.sin(be),Math.cos(be)),ge=new Oe(-Math.cos(be),Math.sin(be)),Te=new W,ce=fe<0?(Xe,De,Ge)=>p.push(Xe,De,Ge):(Xe,De,Ge)=>p.push(Xe,Ge,De),Ue=new Oe((t+e+V+k)/4,0);Dm(Ue,Ce,Te),g.push(Te.x,Te.y,Te.z),x.push(ge.x,0,ge.y),v.push(.5,.5);let ze=b++;for(let Xe of xe){let De=g.slice(Xe*3,Xe*3+3);g.push(...De),x.push(ge.x,0,ge.y);let Ge=v.slice(Xe*2,Xe*2+2);v.push(...Ge),b++}for(let Xe=ze+1;Xe<b-1;Xe++)ce(ze,Xe,Xe+1);ce(ze,b-1,ze+1)}}},w_e=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},t.parameters);return i.thetaLength=Qt.clamp(i.thetaLength,0,360),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,cornerRadiusTop:c,cornerRadiusBottom:u,cornerSegments:h}=t.parameters,d;return l===0?(d=new ni,d.setAttribute("position",new Wt([],3))):c>0||u>0||l<360?d=new xY(0,e/2,r,n,s,a,o,l*Math.PI/180,c,u,h,0,!0):d=new AN(e/2,r,n,s,a),d.scale(1,1,i/e),Object.assign(d,{userData:{...t,type:"ConeGeometry"}})}},M_e=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a,cornerRadius:o,cornerSegments:l}=t.parameters,c;return o===0?c=new yh(e,i,r,n,s,a):c=new E_e(e,i,r,n,s,a,o,l),Object.assign(c,{userData:{...t,type:"CubeGeometry"}})}},jO=Math.PI/2,E_e=class extends ni{constructor(t=1,e=1,i=1,r=1,n=1,s=1,a=0,o=4){super(),this.type="BoxGeometry",r=Math.floor(r),n=Math.floor(n),s=Math.floor(s),o=Math.floor(o),a=Math.min(a,t/2,e/2,i/2);let l=[],c=[],u=[],h=[],d=0;p("z","y","x",-1,-1,i,e,t,s,n),p("z","y","x",1,-1,i,e,-t,s,n),p("x","z","y",1,1,t,i,e,r,s),p("x","z","y",1,-1,t,i,-e,r,s),p("x","y","z",1,-1,t,e,i,r,n),p("x","y","z",-1,-1,t,e,-i,r,n),a>0&&(g("z","y","x",-1,-1,1,i,e,t,s),g("z","y","x",1,-1,-1,i,e,t,s),g("z","y","x",-1,1,-1,i,e,t,s),g("z","y","x",1,1,1,i,e,t,s),g("x","y","z",-1,-1,-1,t,e,i,r),g("x","y","z",1,-1,1,t,e,i,r),g("x","y","z",-1,1,1,t,e,i,r),g("x","y","z",1,1,-1,t,e,i,r),g("y","x","z",-1,-1,1,e,t,i,n),g("y","x","z",1,-1,-1,e,t,i,n),g("y","x","z",1,1,1,e,t,i,n),g("y","x","z",-1,1,-1,e,t,i,n),x(1,1,1),x(-1,1,1),x(1,-1,1),x(-1,-1,1),x(1,1,-1),x(-1,1,-1),x(1,-1,-1),x(-1,-1,-1)),this.setIndex(l),this.setAttribute("position",new Wt(c,3)),this.setAttribute("normal",new Wt(u,3)),this.setAttribute("uv",new Wt(h,2));function p(v,b,w,M,E,D,T,L,P,R){let O=(D-2*a)/P,U=(T-2*a)/R,F=D/2-a,V=T/2-a,k=L/2,K=P+1,X=R+1,$=0,Y=new W;for(let re=0;re<X;re++){let G=re*U-V;for(let j=0;j<K;j++){let ee=j*O-F;Y[v]=ee*M,Y[b]=G*E,Y[w]=k,c.push(Y.x,Y.y,Y.z),Y[v]=0,Y[b]=0,Y[w]=L>0?1:-1,u.push(Y.x,Y.y,Y.z),h.push(j/P),h.push(1-re/R),$+=1}}for(let re=0;re<R;re++)for(let G=0;G<P;G++){let j=d+G+K*re,ee=d+G+K*(re+1),oe=d+(G+1)+K*(re+1),Q=d+(G+1)+K*re;l.push(j,ee,Q),l.push(ee,oe,Q)}d+=$}function g(v,b,w,M,E,D,T,L,P,R){let O=(T-2*a)/R,U=T/2-a,F=L/2-a,V=P/2,k=R+1,K=0,X=new W,$=new W;for(let Y=0;Y<o+1;Y++){let re=Y/o*jO,G=Math.sin(re)*a,j=(1-Math.cos(re))*a,ee=Math.sin(re),oe=Math.cos(re);X[b]=(F+G)*E,X[w]=(V-j)*D,$[v]=0,$[b]=ee*Math.sign(X[b]),$[w]=oe*Math.sign(X[w]);for(let Q=0;Q<k;Q++){let ae=Q*O-U;X[v]=ae*M,c.push(X.x,X.y,X.z),u.push($.x,$.y,$.z),h.push(Q/R),h.push(0),K+=1}}for(let Y=0;Y<o;Y++)for(let re=0;re<R;re++){let G=d+re+k*Y,j=d+re+k*(Y+1),ee=d+(re+1)+k*(Y+1),oe=d+(re+1)+k*Y;l.push(G,j,oe),l.push(j,ee,oe)}d+=K}function x(v,b,w){let M=new W,E=new W(t/2,e/2,i/2);E.subScalar(a);let D=[],T=v*b*w>0?(P,R,O)=>l.push(P,R,O):(P,R,O)=>l.push(P,O,R);for(let P=0;P<=o;P++){let R=[],O=jO*(1-P/o),U=Math.cos(O),F=Math.sin(O),V=0;for(let k=0;k<=P;k++){let K=Math.cos(V),X=Math.sin(V);M.x=U*K,M.y=F,M.z=U*X;let $=E.clone().addScaledVector(M,a);c.push(v*$.x,b*$.y,w*$.z),u.push(v*M.x,b*M.y,w*M.z),h.push(0,0),R.push(d++),V+=jO/P}D.push(R)}let L=D.length-1;for(let P=0;P<L;P++){let R=D[P],O=D[P+1],U=R.length-1;T(R[0],O[1],O[0]);for(let F=1;F<=U;F++)T(R[F-1],R[F],O[F]),T(R[F],O[F+1],O[F])}}}},l4=class extends ni{constructor(t=[],e=[],i="",r=1,n=.2,s=4){super(),this.type="PolyhedronGeometryRound";let a=[],o=[],l=[];c(),u(),this.setAttribute("position",new Wt(a,3)),this.setAttribute("normal",new Wt(l,3)),this.setAttribute("uv",new Wt(o,2));return;function c(){var $;n=Math.min(1-1e-5,n),n==0&&(s=0);let h={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],d=new W,p=d.clone(),g=new $a,x=n*r,v=r-x,b=s+1,w=new W,M=(Y,re)=>w.subVectors(Y,re).normalize(),E=(Y,re)=>Array(Y).fill(void 0).map(re),D=E(t.length/3,(Y,re)=>new W().fromArray(t,re*3).setLength(r)),T=[],L=1e6;for(let Y=0;Y<D.length;Y++){let re=D[Y],G=[],j,ee,oe,Q=1e10,ae=-1;for(;(ae=e.indexOf(Y,ae+1))!=-1;){let xe=ae-ae%3;j=e[xe+(ae+1)%3],ee=e[xe+(ae+2)%3],oe=re.distanceToSquared(D[j]),Q=Math.min(Q,oe),G.push([j,ee,oe])}Q+=1e-6;let ne=[],ue=0,fe=G.length;for(let xe=0;xe<fe;xe++){[j,ee,oe]=G[ue];let be=(($=T[j])==null?void 0:$.includes(Y))==!0;oe<=Q&&ne.push(j+ +be*L),ue=G.findIndex(Ce=>Ce[0]==ee)}T.push(ne)}let P=[];{let Y=0,re=0,G,j,ee=h==3;for(let oe=0;oe<=s;oe++){G=oe*(oe+1)/2,j=(oe+1)*(oe+2)/2;for(let Q=0;Q<s-oe;Q++)[Y,re]=[G+Q+oe+2,j+Q+oe+3],P.push(G,j,...ee?[re,G]:[Y,j],re,Y),[G,j]=[Y,re];P.push(G,j,G+s+2)}}let R=d.clone(),O=d.clone(),U=d.clone(),F=d.clone(),V=d.clone(),k=[],K=E(D.length,()=>E(h,()=>d.clone()));for(let Y=0;Y<D.length;Y++){d.copy(D[Y]).normalize(),R.copy(d).multiplyScalar(v);let re=T[Y];for(let ne=0;ne<re.length;ne++){let ue=re[ne],fe=re[(ne+1)%h];g.setFromPointsAndIndices(D,Y,ue%L,fe%L),g.b.sub(g.a).setLength(1e10).add(g.a),g.c.sub(g.a).setLength(1e10).add(g.a),g.closestPointToPoint(R,K[Y][ne])}let G=[],j=[],ee=[],oe=new W;s==0&&[...K[Y]].reduce((ne,ue)=>ne.add(ue),oe).multiplyScalar(1/h);for(let ne=0;ne<h;ne++){let ue=[],fe=(ne-1+h)%h,xe=K[Y][fe],be=K[Y][ne];d.copy(xe).sub(R),p.copy(be).sub(R);let Ce=R.angleTo(d),ge=d.angleTo(p),Te=Math.cos(Ce)*x;s==0?O.copy(oe):O.copy(R).setLength(v+Te),j.push(Te);let ce=[O,xe,be];for(let Ue=0;Ue<2;Ue++){let ze=ce[Ue],Xe=ce[Ue+1];F.subVectors(ze,R),V.subVectors(Xe,R),U.crossVectors(F,V).normalize();for(let De=0;De<b;De++){let Ge=[Ce,ge][Ue]*De/b;d.copy(F).applyAxisAngle(U,Ge).add(R),G.push(d.clone()),Ue&&(M(d,R),ue.push([De==0?ze:d.clone(),w.clone()]))}Ue&&(M(Xe,R),ue.push([Xe,w.clone()]))}ee.push(ue)}k.push(ee);let Q=2*b,ae=2;for(let ne=0;ne<h;ne++){let ue=Q*ne,fe=Q*((ne+1)%h),xe=[G[ue]];for(let Ce=1;Ce<b;Ce++){F=G[ue+Ce],V=G[fe+Ce],xe.push(F);for(let ge=1,Te=Ce-ae+1;ge<=Te;ge++)d.lerpVectors(F,V,ge/(Te+1)),d.sub(R).setLength(j[ne]).add(R),xe.push(d.clone());xe.push(V)}for(let Ce=0;Ce<b;Ce++)xe.push(G[Ce+b+ue]);xe.push(G[fe+b]);let be=P.map(Ce=>xe[Ce]);a.push(...be.map(Ce=>[Ce.x,Ce.y,Ce.z]).flat()),l.push(...be.map(Ce=>(M(Ce,R),[w.x,w.y,w.z])).flat())}}let X=[];for(let Y=0;Y<T.length;Y++)for(let re=0;re<h;re++){let G=T[Y][re];if(G<L){let j=T[G].findIndex(Q=>Q%L==Y),ee=k[Y][re],oe=k[G][j];for(let Q=0;Q<b;Q++){let ae=ee[Q],ne=oe[b-Q],ue=ee[Q+1],fe=oe[b-(Q+1)];[ae,ne,ue,ue,ne,fe].forEach(xe=>{a.push(xe[0].x,xe[0].y,xe[0].z),l.push(xe[1].x,xe[1].y,xe[1].z)})}X.push(ee[0][0],oe[b][0],ee[b][0],oe[0][0])}}for(;X.length;){let Y,re,G,j;[Y,re]=X.splice(0,2);let ee=[Y];for(;Y!=re;)ee.push(re),G=X.indexOf(re),j=G%2,re=X.splice(G-j,2)[1-j];w.subVectors(ee[0],ee[1]).cross(d.subVectors(ee[0],ee[2])).normalize();let oe=w.dot(ee[0])<0;oe&&w.negate();for(let Q=1;Q<=ee.length-2;Q++)[ee[Q+ +oe],ee[Q+1-+oe],ee[0]].forEach(ae=>{a.push(ae.x,ae.y,ae.z),l.push(w.x,w.y,w.z)})}}function u(){let h=new W;for(let T=0;T<a.length;T+=3){h.x=a[T+0],h.y=a[T+1],h.z=a[T+2];let L=E(h)/2/Math.PI+.5,P=D(h)/Math.PI+.5;o.push(L,1-P)}let d=new W,p=new W,g=new W,x=new W,v=new Oe,b=new Oe,w=new Oe,M=(T,L,P,R)=>{R<0&&T.x===1&&(o[L]=T.x-1),P.x===0&&P.z===0&&(o[L]=R/2/Math.PI+.5)};for(let T=0,L=0;T<a.length;T+=9,L+=6){d.set(a[T+0],a[T+1],a[T+2]),p.set(a[T+3],a[T+4],a[T+5]),g.set(a[T+6],a[T+7],a[T+8]),v.set(o[L+0],o[L+1]),b.set(o[L+2],o[L+3]),w.set(o[L+4],o[L+5]),x.copy(d).add(p).add(g).divideScalar(3);let P=E(x);M(v,L+0,d,P),M(b,L+2,p,P),M(w,L+4,g,P)}for(let T=0;T<o.length;T+=6){let L=o[T+0],P=o[T+2],R=o[T+4],O=Math.max(L,P,R),U=Math.min(L,P,R);O>.9&&U<.1&&(L<.2&&(o[T+0]+=1),P<.2&&(o[T+2]+=1),R<.2&&(o[T+4]+=1))}function E(T){return Math.atan2(T.z,-T.x)}function D(T){return Math.atan2(-T.y,Math.sqrt(T.x*T.x+T.z*T.z))}}}static fromJSON(t){return new l4(t.vertices,t.indices,t.radius,t.corner,t.cornerSides)}},A_e=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,detail:0,corner:0,cornerSides:4},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,detail:n,corner:s,cornerSides:a}=t.parameters,o=n===0&&s!==0?new bY(e*.5,s,a):new Tq(e*.5,n);return o.scale(1,i/e,r/e),Object.assign(o,{userData:{...t,type:"DodecahedronGeometry"}})}},bY=class extends l4{constructor(t=1,e=.2,i=4){let r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o="DodecahedronGeometry";super(s,a,o,t,e,i),this.type=o}static fromJSON(t){return new bY(t.radius,t.corner,t.cornerSides)}},nS=1e-12,c4=class{constructor(t){this.position=new Oe,this.startPosition=new Oe,this.uuid=Qt.generateUUID(),this.position=t.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(t){this.position.copy(this.startPosition).add(t)}copy(t){return this.position.copy(t.position),this.startPosition.copy(t.startPosition),this}clone(){return new c4(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},kU=class extends c4{constructor(t){super(t.position),this.parent=t}copy(t){return super.copy(t),this}clone(){return new kU(this.parent).copy(this)}},y1=class extends c4{constructor(t,e){super(e),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=t,this.controls.push(new kU(this),new kU(this))}static create(t,e){let i=new y1(t,new Oe(...e.position));return i.controls[0].position.set(...e.controlPrevious.position),i.controls[1].position.set(...e.controlNext.position),i.roundness=e.roundness,i.areControlsDirectionsMirrored=e.areControlsDirectionsMirrored,i}getOppositeControl(t){let e=this.controls.indexOf(t);return e===0?this.controls[1]:e===1?this.controls[0]:null}applyOffsetToControls(t,e=1){for(let i=0,r=this.controls.length;i<r;i++){let n=this.controls[i];this.position.distanceTo(n.position)<=e?n.position.copy(this.position):n.applyOffset(t)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(t){return super.copy(t),this.controls[0].copy(t.controls[0]),this.controls[1].copy(t.controls[1]),this.roundness=t.roundness,this.uuid=t.uuid,this}clone(){return new y1(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var i,r;let t=(i=this.curveBefore)==null?void 0:i.getTangentAt(1),e=(r=this.curveAfter)==null?void 0:r.getTangentAt(0);return[t,e]}computeNormals(t=new Oe,e=new Oe){let[i,r]=this.computeTangents();return i&&r&&(HH(i,t),HH(r,e)),[t,e]}computeTangent(t=new Oe){let[e,i]=this.computeTangents();return e&&i&&t.copy(e).add(i).normalize(),t}computeNormal(t=new Oe){let[e,i]=this.computeNormals();return t.copy(e).add(i).normalize(),t}};function HH(t,e=new Oe){let i=t.length();return e.set(-t.y/i,t.x/i)}var u4=t=>t,bb=new Oe,Y3=new Oe,T_e=new Oe,C_e=new Oe,D_e=new Oe,P_e=new Oe,_Y=new W,SY=new W;function R_e(t){let e=new Oe;e.addVectors(t.v0,bb.subVectors(t.v1,t.v0).multiplyScalar(2/3));let i=new Oe;return i.addVectors(t.v2,Y3.subVectors(t.v1,t.v2).multiplyScalar(2/3)),new uh(t.v0,e,i,t.v2)}function zS(t,e,i=Number.EPSILON){return Math.abs(t-e)<i}function O_e(t,e,i=Number.EPSILON){return t.distanceTo(e)<i}function L_e(t,e,i=Number.EPSILON){return t.distanceTo(e)<i}function wY(t,e,i){let r=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),n=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)),s=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2));return Math.acos((n*n+r*r-s*s)/(2*n*r))}function I_e(t,e,i){return jH(t,e)&&jH(e,i)&&VU(t.position,e.position,i.position)}function VU(t,e,i){return bb.copy(e).sub(t).cross(Y3.copy(i).sub(t))===0}function z_e(t,e,i,r,n){let s=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),a=(t.y+e.y)/2,o=(t.x+e.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(t.y-e.y)/s,c=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(e.x-t.x)/s;return r.set(o+l,a+c),n.set(o-l,a-c),[r,n]}function U_e(t,e,i){let r=t.distanceTo(i),n=e.distanceTo(i);return r<n?e:t}function B_e(t,e,i,r,n,s){let a=e.x-t.x,o=e.y-t.y,l=i.x-t.x,c=i.y-t.y,u=Math.sqrt((a+l)*(a+l)+(o+c)*(o+c)),h;return wY(e,t,i)>Math.PI&&(u*=-1),zS(c,o)?h=(o+c)*(r/u-.5)*8/3/(a-l):h=(a+l)*(r/u-.5)*8/3/(c-o),n.set(e.x-h*o,e.y+h*a),s.set(i.x+h*c,i.y-h*l),[n,s]}function GH(t,e){return t.position.equals(t.controls[1].position)&&e.position.equals(e.controls[0].position)}function jH(t,e){return VU(t.position,t.controls[1].position,e.position)&&VU(t.position,e.controls[0].position,e.position)}function N_e(t,e,i,r,n=.5){let s=bb.subVectors(e,t).multiplyScalar(n).add(t),a=Y3.subVectors(i,e).multiplyScalar(n).add(e),o=T_e.subVectors(r,i).multiplyScalar(n).add(i),l=s,c=C_e.subVectors(a,s).multiplyScalar(n).add(s),u=D_e.subVectors(o,a).multiplyScalar(n).add(a),h=o,d=P_e.subVectors(u,c).multiplyScalar(n).add(c);return[t.x,t.y,l.x,l.y,c.x,c.y,d.x,d.y,u.x,u.y,h.x,h.y,r.x,r.y]}function F_e(t,e,i=12,r=!0){let n=SY.set(0,0,0),s,a=0;for(let o=0;o<e.length;o++){let l=u4(e[o]),c=bb,u=M0(l,i);for(let h=0;h<=u;h++)if(l instanceof uh||l instanceof _g||l instanceof ph){if(l.getPoint(h/u,c),n.set(c.x,c.y,0),s!==void 0&&L_e(s,n))continue;s===void 0&&(s=_Y),s.copy(n),t.setXYZ(a,n.x,n.y,n.z),a++}}return r&&a>1&&!(t.getX(a-1)===t.getX(0)&&t.getY(a-1)===t.getY(0)&&t.getZ(a-1)===t.getZ(0))&&(t.setXYZ(a,t.getX(0),t.getY(0),t.getZ(0)),a++),t}function k_e(t,e,i,r=12,n=!0){let s=SY.set(0,0,0),a=0,o=[];for(let l=0;l<e.length;l++){if(i[l]===!1)continue;let c,u=u4(e[l]),h=bb,d=M0(u,r);o.push(d);for(let p=0;p<=d;p++)if(u instanceof uh||u instanceof _g||u instanceof ph){if(u.getPoint(p/d,h),s.set(h.x,h.y,0),c==null?void 0:c.equals(s))continue;c===void 0?c=_Y:(t.setXYZ(a,c.x,c.y,c.z),a++,t.setXYZ(a,s.x,s.y,s.z),a++),c.copy(s)}}return n&&a>1&&!(t.getX(a-1)===t.getX(0)&&t.getY(a-1)===t.getY(0)&&t.getZ(a-1)===t.getZ(0))&&(t.setXYZ(a,t.getX(0),t.getY(0),t.getZ(0)),a++),o}function WH(t,e=12,i=!1){let r=[];for(let n=0,s=t.length;n<s;n++){let a=t[n],o=0;if(i&&a.roundedCurveCorner!==void 0){let l=M0(a.roundedCurveCorner,e)*.5;n>0&&(r[n-1]+=l),o+=l}a.curveAfter!==void 0&&(o+=M0(a.curveAfter,e)),r.push(o)}return t.length>0&&i&&t[0].roundedCurveCorner!==void 0&&(r[t.length-1]+=M0(t[0].roundedCurveCorner,e)*.5),r}function M0(t,e=12){return t&&t instanceof L3?e*2:t&&(t instanceof ph||t instanceof Mq)?1:t&&t instanceof MN?e*t.points.length:e}function V_e(t,e,i=12,r=!0){let n,s=0;for(let a=0;a<e.length;a++){let o=u4(e[a]),l=M0(o,i),c=bb;for(let u=0;u<=l;u++)if(o instanceof uh||o instanceof _g||o instanceof ph){if(o.getPoint(u/l,c),n!==void 0&&O_e(n,c,nS))continue;n===void 0&&(n=Y3),n.copy(c),t.push(c.x,c.y),s++}}return zS(t[0],t[t.length-2],nS)&&zS(t[1],t[t.length-1],nS)&&(t.pop(),t.pop()),r&&s>1&&!(zS(t[s-1],t[1],nS)&&zS(t[s-2],t[0],nS))&&(t.push(t[0],t[1]),s++),t}var WO=new Oe,H_e=new Oe,G_e=new Oe,j_e=new Oe,W_e=new Oe,q_e=new Oe,xs=class extends PC{constructor(t=100,e=100){super(),this.points=[],this.shapeHoles=[],this.plane=new Bl(new W(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=Qt.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=t,this._height=e}static createFromState(t,e,i){let r=new xs;return r.isClosed=t.isClosed,r.points=t.points.map(n=>y1.create(n.id,n.data)),typeof t.roundness=="number"&&(r.roundness=t.roundness),r.shapeHoles=t.shapeHoles.map(n=>xs.createFromState(n)),e!==void 0&&i!==void 0&&r.applySize(e,i),r.update(),r}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(t){if(this._roundness!==t){this._roundness=t;for(let e=0,i=this.points.length;e<i;e++)this.points[e].roundness=t;this.needsUpdate=!0}}getPointsIndexesByIds(t){return t.map(e=>this.getPointIndexById(e)).filter(e=>e>=0)}getPointIndexById(t){let e=this.points.length,i=this.points.findIndex(r=>r.uuid===t);if(i<0){let r=e;for(let n=0,s=this.shapeHoles.length;n<s;n++){let a=this.shapeHoles[n],o=a.points.length,l=a.getPointIndexById(t);if(l<0)r+=o;else return l+r}}return i}getLineIndexById(t){return this.getPointIndexById(t)}getBezierPoint(t){if(t<=this.points.length-1)return this.points[t];if(this.shapeHoles.length>0){let e=this.points.length;for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=t-e;if(s<=n.points.length-1)return n.points[s];e+=n.points.length}}throw new Error("This shape does not have a point for this index: "+t)}getBezierPointIndex(t){let e=this.points.indexOf(t);if(e>=0)return e;if(e=this.points.length,this.shapeHoles.length>0)for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=n.points.indexOf(t);if(s>=0)return e+s;e+=n.points.length}return-1}getAllPoints(){let t=[].concat(...this.shapeHoles.map(e=>e.points));return[...this.points,...t]}applySize(t,e){t===0&&(t=.001),e===0&&(e=.001),this._width=t,this._height=e}applyScale(t,e){let i=WO.set(t,e);for(let r=0,n=this.points.length;r<n;r++){let s=this.points[r];s.position.multiply(i),s.controls[0].position.multiply(i),s.controls[1].position.multiply(i)}for(let r=0,n=this.shapeHoles.length;r<n;r++)this.shapeHoles[r].applyScale(t,e);this._update()}createPoint(t,e=0,i=Qt.generateUUID()){let r;t instanceof Oe?r=t:r=new Oe(t,e);let n=new y1(i,r);return n.roundness=this.roundness,n}addPoint(t){this.points.push(t),this.needsUpdate=!0}addPointAt(t,e){this.points.splice(e,0,t),this.needsUpdate=!0}getPointByUuid(t){for(let e=0,i=this.points.length;e<i;e++){let r=this.points[e];if(r.uuid===t)return r}for(let e=0,i=this.shapeHoles.length;e<i;e++){let r=this.shapeHoles[e].getPointByUuid(t);if(r)return r}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(t){let e=this.points.indexOf(t);e>=0&&this.points.splice(e,1),this.needsUpdate=!0}removePointById(t){let e=this.points.find(i=>i.uuid===t);e&&this.removePoint(e)}update(){for(let t=0,e=this.shapeHoles.length;t<e;t++)this.shapeHoles[t].update();this._update()}extractShapePointsToBuffer(t,e=12,i=!1){this.subdivision=e,this.curveDivisions===void 0&&this.computeCurveDivisions(e);let r=i?this.roundedCurveDivisions:this.curveDivisions;return F_e(t,i?this.roundedCurves:this.curves,e,this.autoClose),r.reduce((n,s)=>n+s,0)+1}computeCurveDivisions(t=12){return this.curveDivisions=WH(this.points,t,!1),this.roundedCurveDivisions=WH(this.points,t,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(t,e,i=12){return k_e(t,this.curves,e,i,this.autoClose).reduce((r,n)=>r+n,0)*2}extractShapePointsToFlatArray(t,e=12){return this.subdivision=e,this.curveDivisions===void 0&&this.computeCurveDivisions(e),V_e(t,this.roundedCurves,e,this.autoClose)}getCurveIndexFromVertexId(t,e=!1){let i=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let r=e?this.roundedCurveDivisions:this.curveDivisions,n=0;e&&this.points[0].roundedCurveCorner!==void 0&&(n=M0(this.points[0].roundedCurveCorner,this.subdivision)*.5);let s=t-n;s<0&&(s+=r.reduce((a,o)=>a+o,0));for(let a=0,o=r.length;a<o;a++){let l=r[a];if(s<i+l)return[a,(s-i+1)/l];i+=l}return[0,1]}getCurveT(t,e,i){let r=this.points[t],n=this.points[t>=this.points.length-1?0:t+1],s=this.curveDivisions,a=s[t];if(GH(r,n)){let l=r.position.distanceTo(n.position);return r.position.distanceTo(WO.set(i.x,i.y))/l}let o=0;for(let l=0;l<t;l++)o+=s[l];return(e-o)/a}dispose(){}_applyCurveForPoint(t,e){GH(e,t)?this.lineTo(t.position.x,t.position.y):this.bezierCurveTo(e.controls[1].position.x,e.controls[1].position.y,t.controls[0].position.x,t.controls[0].position.y,t.position.x,t.position.y);let i=this.curves[this.curves.length-1];t.curveBefore=i,e.curveAfter=i;let r=i.clone();t.roundedCurveBefore=r,e.roundedCurveAfter=r,t.roundedCurveCorner=void 0,this.roundedCurves.push(r)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let e=0,i=this.points.length;e<i;e++){let r=this.points[e];if(e===0)this.moveTo(r.position.x,r.position.y);else{let n=this.points[e-1];this._applyCurveForPoint(r,n)}}let t=this.getLastPoint();if(t!=null&&t.curveAfter&&(t.curveAfter=void 0),this.isClosed){let e=this.points[0],i=this.points[this.points.length-1];this._applyCurveForPoint(e,i)}if(this.points.length>2){let e=0;for(let i=0,r=this.points.length;i<r;i++){let n=this.points[i],s=this.points[i-1]??this.points[this.points.length-1],a=this.points[i+1]??this.points[0],o=n.roundness,l=s&&a&&I_e(s,n,a);if(!n.controlsMoved()&&o>0&&!l){let c=n.curveBefore,u=n.curveAfter;if(c===void 0||u===void 0)continue;let h=n.roundedCurveBefore,d=n.roundedCurveAfter,p=c.getLength(),g=u.getLength(),x=Math.min(o,p*.499),v=Math.min(o,g*.499),b=Math.min(x,v),w=1-b/p,M=b/g,E=c.getPointAt(w,WO),D=u.getPointAt(M,H_e);this._subSplitCurve(c,h,w,E,void 0),this._subSplitCurve(u,d,M,void 0,D);let T;if(this.useCubicForRoundedCorners){let L=wY(E,n.position,D)/2,P=Math.tan(L)*E.distanceTo(n.position),[R,O]=z_e(E,D,P,G_e,j_e),U=U_e(R,O,n.position),[F,V]=B_e(U,E,D,P,W_e,q_e);T=new uh(E.clone(),F.clone(),V.clone(),D.clone())}else T=new _g(E.clone(),n.position.clone(),D.clone());n.roundedCurveCorner=T,this.roundedCurves.splice(i+e,0,T),e++}}}}_subSplitCurve(t,e,i,r,n){if(t instanceof ph)r!==void 0&&e.v2.copy(r),n!==void 0&&e.v1.copy(n);else{let s=t,a=e,o=s.getUtoTmapping(i,0),l=N_e(s.v0,s.v1,s.v2,s.v3,o);return r!==void 0&&(a.v0.set(l[0],l[1]),a.v1.set(l[2],l[3]),a.v2.set(l[4],l[5]),a.v3.set(l[6],l[7])),n!==void 0&&(a.v0.set(l[6],l[7]),a.v1.set(l[8],l[9]),a.v2.set(l[10],l[11]),a.v3.set(l[12],l[13])),a}return e}clone(){let t=new xs(this._width,this._height);return t.points=this.points.map(e=>e.clone()),t.isClosed=this.isClosed,t.roundness=this.roundness,t.isMesh2D=this.isMesh2D,t.shapeHoles=this.shapeHoles.map(e=>e.clone()),t}toJSON(){return{points:this.points.reduce((t,e)=>t.concat(e.toJSON()),[]),shapeHoles:this.shapeHoles.map(t=>t.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(t){var i;this.points=[],this.pointIDs=0;let e=t.points.length/7;for(let r=0;r<e;r++){let n=r*7,s=t.points[n+0],a=t.points[n+1],o=t.points[n+2],l=t.points[n+3],c=t.points[n+4],u=t.points[n+5],h=t.points[n+6],d=new y1(Qt.generateUUID(),new Oe(s,a));d.controls[0].position.set(o,l),d.controls[1].position.set(c,u),d.roundness=h,this.points.push(d)}return this.shapeHoles=(i=t.shapeHoles)!=null&&i.length?t.shapeHoles.map(r=>{let n=new xs;return n.fromJSON(r),n}):[],this.isClosed=t.isClosed,this._roundness=t.roundness,this._update(),this}fromShape(t,e=!1){this.isText=e;let i=(n,s)=>{s instanceof uh&&s.v3.equals(n.position)&&n.controls[0].position.copy(s.v2)},r=n=>{let s=[],a,o;for(a=0,o=n.length;a<o;a++)n[a]instanceof _g&&(n[a]=R_e(n[a]));for(a=0,o=n.length;a<o;a++){let u=n[a],h=a>0?n[a-1]:null,d;u instanceof uh?(d=this.createPoint(u.v0),d.controls[1].position.copy(u.v1)):u instanceof ph&&(d=this.createPoint(u.v1)),d!==void 0&&(h!==null&&i(d,h),s.push(d))}let l=n[n.length-1],c=!1;return l instanceof uh?l.v3.equals(s[0].position)&&(s[0].controls[0].position.copy(l.v2),c=!0):l instanceof ph&&l.v2.equals(s[0].position)&&(c=!0),this.isClosed=c,s};return this.points=r(t.curves),t instanceof PC&&(this.shapeHoles=t.holes.map(n=>{let s=new xs;return s.fromShape(n),s})),this.update(),this}updatePoint(t,e){let i=this.getPointByUuid(t);i&&(e.position!==void 0&&i.position.fromArray(e.position),e.roundness!==void 0&&(i.roundness=e.roundness),e.areControlsDirectionsMirrored!==void 0&&(i.areControlsDirectionsMirrored=e.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(t,e){var r;let i=(r=this.getPointByUuid(t))==null?void 0:r.controls[0];i&&(e.position&&i.position.fromArray(e.position),this.needsUpdate=!0)}updateNextControl(t,e){var r;let i=(r=this.getPointByUuid(t))==null?void 0:r.controls[1];i&&(e.position&&i.position.fromArray(e.position),this.needsUpdate=!0)}},MY=Math.PI*2;function qO({x:t,y:e},i,r,n,s){return{x:t*i+n,y:e*r+s}}function X_e(t,e){let i=e===1.5707963267948966?.551915024494:e===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(e/4),r=Math.cos(t),n=Math.sin(t),s=Math.cos(t+e),a=Math.sin(t+e);return[{x:r-n*i,y:n+r*i},{x:s+a*i,y:a-s*i},{x:s,y:a}]}function qH(t,e,i,r){let n=t*r-e*i<0?-1:1,s=Math.min(1,Math.max(-1,t*i+e*r));return n*Math.acos(s)}function Y_e(t,e,i,r,n,s,a,o,l,c){let u=Math.pow(n,2),h=Math.pow(s,2),d=Math.pow(a,2),p=Math.pow(o,2),g=u*h-u*p-h*d;g<0&&(g=0),g/=u*p+h*d,g=Math.sqrt(g)*(l===c?-1:1);let x=g*n/s*o,v=g*-s/n*a,b=x+(t+i)/2,w=v+(e+r)/2,M=(a-x)/n,E=(o-v)/s,D=(-a-x)/n,T=(-o-v)/s,L=qH(1,0,M,E),P=qH(M,E,D,T);return P<0&&(P+=MY),{centerx:b,centery:w,ang1:L,ang2:P}}function Q_e({px:t,py:e,cx:i,cy:r,rx:n,ry:s,largeArcFlag:a,sweepFlag:o}){let l=[];if(n===0||s===0)return[];let c=(t-i)/2,u=(e-r)/2;if(c===0&&u===0)return[];n=Math.abs(n),s=Math.abs(s);let h=Math.pow(c,2)/Math.pow(n,2)+Math.pow(u,2)/Math.pow(s,2);h>1&&(n*=Math.sqrt(h),s*=Math.sqrt(h));let d=Y_e(t,e,i,r,n,s,c,u,a,o),{ang1:p,ang2:g}=d,{centerx:x,centery:v}=d,b=Math.abs(g)/(MY/4);Math.abs(1-b)<1e-7&&(b=1);let w=Math.max(Math.ceil(b),1);g/=w;for(let M=0;M<w;M++)l.push(X_e(p,g)),p+=g;return l.map(M=>{let{x:E,y:D}=qO(M[0],n,s,x,v),{x:T,y:L}=qO(M[1],n,s,x,v),{x:P,y:R}=qO(M[2],n,s,x,v);return{x1:E,y1:D,x2:T,y2:L,x:P,y:R}})}var nn;(function(t){t[t.ODD=0]="ODD",t[t.NONZERO=1]="NONZERO",t[t.POSITIVE=2]="POSITIVE",t[t.NEGATIVE=3]="NEGATIVE",t[t.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})(nn||(nn={}));var Vs;(function(t){t[t.POLYGONS=0]="POLYGONS",t[t.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",t[t.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(Vs||(Vs={}));function Ti(t,e){if(!t)throw e||"Assertion Failed!"}var yi=function(){function t(){}return t.vertEq=function(e,i){return e.s===i.s&&e.t===i.t},t.vertLeq=function(e,i){return e.s<i.s||e.s===i.s&&e.t<=i.t},t.transLeq=function(e,i){return e.t<i.t||e.t===i.t&&e.s<=i.s},t.edgeGoesLeft=function(e){return t.vertLeq(e.Dst,e.Org)},t.edgeGoesRight=function(e){return t.vertLeq(e.Org,e.Dst)},t.vertL1dist=function(e,i){return Math.abs(e.s-i.s)+Math.abs(e.t-i.t)},t.edgeEval=function(e,i,r){Ti(t.vertLeq(e,i)&&t.vertLeq(i,r));var n=i.s-e.s,s=r.s-i.s;return n+s>0?n<s?i.t-e.t+(e.t-r.t)*(n/(n+s)):i.t-r.t+(r.t-e.t)*(s/(n+s)):0},t.edgeSign=function(e,i,r){Ti(t.vertLeq(e,i)&&t.vertLeq(i,r));var n=i.s-e.s,s=r.s-i.s;return n+s>0?(i.t-r.t)*n+(i.t-e.t)*s:0},t.transEval=function(e,i,r){Ti(t.transLeq(e,i)&&t.transLeq(i,r));var n=i.t-e.t,s=r.t-i.t;return n+s>0?n<s?i.s-e.s+(e.s-r.s)*(n/(n+s)):i.s-r.s+(r.s-e.s)*(s/(n+s)):0},t.transSign=function(e,i,r){Ti(t.transLeq(e,i)&&t.transLeq(i,r));var n=i.t-e.t,s=r.t-i.t;return n+s>0?(i.s-r.s)*n+(i.s-e.s)*s:0},t.vertCCW=function(e,i,r){return e.s*(i.t-r.t)+i.s*(r.t-e.t)+r.s*(e.t-i.t)>=0},t.interpolate=function(e,i,r,n){return e=e<0?0:e,r=r<0?0:r,e<=r?r===0?(i+n)/2:i+(n-i)*(e/(e+r)):n+(i-n)*(r/(e+r))},t.intersect=function(e,i,r,n,s){var a,o,l;t.vertLeq(e,i)||(l=e,e=i,i=l),t.vertLeq(r,n)||(l=r,r=n,n=l),t.vertLeq(e,r)||(l=e,e=r,r=l,l=i,i=n,n=l),t.vertLeq(r,i)?t.vertLeq(i,n)?(a=t.edgeEval(e,r,i),o=t.edgeEval(r,i,n),a+o<0&&(a=-a,o=-o),s.s=t.interpolate(a,r.s,o,i.s)):(a=t.edgeSign(e,r,i),o=-t.edgeSign(e,n,i),a+o<0&&(a=-a,o=-o),s.s=t.interpolate(a,r.s,o,n.s)):s.s=(r.s+i.s)/2,t.transLeq(e,i)||(l=e,e=i,i=l),t.transLeq(r,n)||(l=r,r=n,n=l),t.transLeq(e,r)||(l=e,e=r,r=l,l=i,i=n,n=l),t.transLeq(r,i)?t.transLeq(i,n)?(a=t.transEval(e,r,i),o=t.transEval(r,i,n),a+o<0&&(a=-a,o=-o),s.t=t.interpolate(a,r.t,o,i.t)):(a=t.transSign(e,r,i),o=-t.transSign(e,n,i),a+o<0&&(a=-a,o=-o),s.t=t.interpolate(a,r.t,o,n.t)):s.t=(r.t+i.t)/2},t}(),sS=function(){function t(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return t}(),u2=function(){function t(e){this.side=e,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(t.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(e){this.Sym.Lface=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(e){this.Sym.Org=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(e){this.Sym.Lnext=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(e){this.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(e){this.Lnext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(e){this.Sym.Onext=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(e){this.Sym.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(e){this.Sym.Lnext.Sym=e},enumerable:!0,configurable:!0}),t}(),Qx=function(){function t(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return t}(),XH=function(){function t(){var e=new Qx,i=new sS,r=new u2(0),n=new u2(1);e.next=e.prev=e,e.anEdge=null,i.next=i.prev=i,r.next=r,r.Sym=n,n.next=n,n.Sym=r,this.vHead=e,this.fHead=i,this.eHead=r,this.eHeadSym=n}return t.prototype.makeEdge_=function(e){var i=new u2(0),r=new u2(1);e.Sym.side<e.side&&(e=e.Sym);var n=e.Sym.next;return r.next=n,n.Sym.next=i,i.next=e,e.Sym.next=r,i.Sym=r,i.Onext=i,i.Lnext=r,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r.Sym=i,r.Onext=r,r.Lnext=i,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,i},t.prototype.splice_=function(e,i){var r=e.Onext,n=i.Onext;r.Sym.Lnext=i,n.Sym.Lnext=e,e.Onext=n,i.Onext=r},t.prototype.makeVertex_=function(e,i,r){var n=e;Ti(n,"Vertex can't be null!");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i;var a=i;do a.Org=n,a=a.Onext;while(a!==i)},t.prototype.makeFace_=function(e,i,r){var n=e;Ti(n,"Face can't be null");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i,n.trail=null,n.marked=!1,n.inside=r.inside;var a=i;do a.Lface=n,a=a.Lnext;while(a!==i)},t.prototype.killEdge_=function(e){e.Sym.side<e.side&&(e=e.Sym);var i=e.next,r=e.Sym.next;i.Sym.next=r,r.Sym.next=i},t.prototype.killVertex_=function(e,i){var r=e.anEdge,n=r;do n.Org=i,n=n.Onext;while(n!==r);var s=e.prev,a=e.next;a.prev=s,s.next=a},t.prototype.killFace_=function(e,i){var r=e.anEdge,n=r;do n.Lface=i,n=n.Lnext;while(n!==r);var s=e.prev,a=e.next;a.prev=s,s.next=a},t.prototype.makeEdge=function(){var e=new Qx,i=new Qx,r=new sS,n=this.makeEdge_(this.eHead);return this.makeVertex_(e,n,this.vHead),this.makeVertex_(i,n.Sym,this.vHead),this.makeFace_(r,n,this.fHead),n},t.prototype.splice=function(e,i){var r=!1,n=!1;if(e!==i){if(i.Org!==e.Org&&(n=!0,this.killVertex_(i.Org,e.Org)),i.Lface!==e.Lface&&(r=!0,this.killFace_(i.Lface,e.Lface)),this.splice_(i,e),!n){var s=new Qx;this.makeVertex_(s,i,e.Org),e.Org.anEdge=e}if(!r){var a=new sS;this.makeFace_(a,i,e.Lface),e.Lface.anEdge=e}}},t.prototype.delete=function(e){var i=e.Sym,r=!1;if(e.Lface!==e.Rface&&(r=!0,this.killFace_(e.Lface,e.Rface)),e.Onext===e)this.killVertex_(e.Org,null);else if(e.Rface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev),!r){var n=new sS;this.makeFace_(n,e,e.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(e.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(e)},t.prototype.addEdgeVertex=function(e){var i=this.makeEdge_(e),r=i.Sym;this.splice_(i,e.Lnext),i.Org=e.Dst;var n=new Qx;return this.makeVertex_(n,r,i.Org),i.Lface=r.Lface=e.Lface,i},t.prototype.splitEdge=function(e){var i=this.addEdgeVertex(e),r=i.Sym;return this.splice_(e.Sym,e.Sym.Oprev),this.splice_(e.Sym,r),e.Dst=r.Org,r.Dst.anEdge=r.Sym,r.Rface=e.Rface,r.winding=e.winding,r.Sym.winding=e.Sym.winding,r.idx=e.idx,r.Sym.idx=e.Sym.idx,r},t.prototype.connect=function(e,i){var r=!1,n=this.makeEdge_(e),s=n.Sym;if(i.Lface!==e.Lface&&(r=!0,this.killFace_(i.Lface,e.Lface)),this.splice_(n,e.Lnext),this.splice_(s,i),n.Org=e.Dst,s.Org=i.Org,n.Lface=s.Lface=e.Lface,e.Lface.anEdge=s,!r){var a=new sS;this.makeFace_(a,n,e.Lface)}return n},t.prototype.zapFace=function(e){var i=e.anEdge,r,n,s,a,o;n=i.Lnext;do r=n,n=r.Lnext,r.Lface=null,r.Rface===null&&(r.Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),s=r.Sym,s.Onext===s?this.killVertex_(s.Org,null):(s.Org.anEdge=s.Onext,this.splice_(s,s.Oprev)),this.killEdge_(r));while(r!=i);a=e.prev,o=e.next,o.prev=a,a.next=o},t.prototype.countFaceVerts_=function(e){var i=e.anEdge,r=0;do r++,i=i.Lnext;while(i!==e.anEdge);return r},t.prototype.mergeConvexFaces=function(e){var i,r,n,s,a,o,l;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(r=i.anEdge,a=r.Org;n=r.Lnext,s=r.Sym,s&&s.Lface&&s.Lface.inside&&(o=this.countFaceVerts_(i),l=this.countFaceVerts_(s.Lface),o+l-2<=e&&yi.vertCCW(r.Lprev.Org,r.Org,s.Lnext.Lnext.Org)&&yi.vertCCW(s.Lprev.Org,s.Org,r.Lnext.Lnext.Org)&&(n=s.Lnext,this.delete(s),r=null,s=null)),!(r&&r.Lnext.Org===a);)r=n;return!0},t.prototype.check=function(){var e=this.fHead,i=this.vHead,r=this.eHead,n,s,a,o,l,c;for(s=e,s=e;(n=s.next)!==e;s=n){Ti(n.prev===s),l=n.anEdge;do Ti(l.Sym!==l),Ti(l.Sym.Sym===l),Ti(l.Lnext.Onext.Sym===l),Ti(l.Onext.Sym.Lnext===l),Ti(l.Lface===n),l=l.Lnext;while(l!==n.anEdge)}for(Ti(n.prev===s&&n.anEdge===null),o=i,o=i;(a=o.next)!==i;o=a){Ti(a.prev===o),l=a.anEdge;do Ti(l.Sym!==l),Ti(l.Sym.Sym===l),Ti(l.Lnext.Onext.Sym===l),Ti(l.Onext.Sym.Lnext===l),Ti(l.Org===a),l=l.Onext;while(l!==a.anEdge)}for(Ti(a.prev===o&&a.anEdge===null),c=r,c=r;(l=c.next)!==r;c=l)Ti(l.Sym.next===c.Sym),Ti(l.Sym!==l),Ti(l.Sym.Sym===l),Ti(l.Org!==null),Ti(l.Dst!==null),Ti(l.Lnext.Onext.Sym===l),Ti(l.Onext.Sym.Lnext===l);Ti(l.Sym.next===c.Sym&&l.Sym===this.eHeadSym&&l.Sym.Sym===l&&l.Org===null&&l.Dst===null&&l.Lface===null&&l.Rface===null)},t}(),YH=function(){function t(){this.handle=null}return t}(),QH=function(){function t(){this.key=null,this.node=0}return t}(),Z_e=function(){function t(e,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=e,this.nodes=[],this.handles=[];for(var r=0;r<e+1;r++)this.nodes[r]=new YH,this.handles[r]=new QH;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return t.prototype.floatDown_=function(e){var i=this.nodes,r=this.handles,n,s,a;for(n=i[e].handle;;){if(a=e<<1,a<this.size&&this.leq(r[i[a+1].handle].key,r[i[a].handle].key)&&++a,Ti(a<=this.max),s=i[a].handle,a>this.size||this.leq(r[n].key,r[s].key)){i[e].handle=n,r[n].node=e;break}i[e].handle=s,r[s].node=e,e=a}},t.prototype.floatUp_=function(e){var i=this.nodes,r=this.handles,n,s,a;for(n=i[e].handle;;){if(a=e>>1,s=i[a].handle,a===0||this.leq(r[s].key,r[n].key)){i[e].handle=n,r[n].node=e;break}i[e].handle=s,r[s].node=e,e=a}},t.prototype.init=function(){for(var e=this.size;e>=1;--e)this.floatDown_(e);this.initialized=!0},t.prototype.min=function(){return this.handles[this.nodes[1].handle].key},t.prototype.insert=function(e){var i,r;if(i=++this.size,i*2>this.max){this.max*=2;var n,s;for(s=this.nodes.length,this.nodes.length=this.max+1,n=s;n<this.nodes.length;n++)this.nodes[n]=new YH;for(s=this.handles.length,this.handles.length=this.max+1,n=s;n<this.handles.length;n++)this.handles[n]=new QH}return this.freeList===0?r=i:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[i].handle=r,this.handles[r].node=i,this.handles[r].key=e,this.initialized&&this.floatUp_(i),r},t.prototype.extractMin=function(){var e=this.nodes,i=this.handles,r=e[1].handle,n=i[r].key;return this.size>0&&(e[1].handle=e[this.size].handle,i[e[1].handle].node=1,i[r].key=null,i[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),n},t.prototype.delete=function(e){var i=this.nodes,r=this.handles,n;Ti(e>=1&&e<=this.max&&r[e].key!==null),n=r[e].node,i[n].handle=i[this.size].handle,r[i[n].handle].node=n,--this.size,n<=this.size&&(n<=1||this.leq(r[i[n>>1].handle].key,r[i[n].handle].key)?this.floatDown_(n):this.floatUp_(n)),r[e].key=null,r[e].node=this.freeList,this.freeList=e},t}(),XO=function(){function t(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return t}(),ZH=function(){function t(){this.key=null,this.next=null,this.prev=null}return t}(),K_e=function(){function t(e,i){this.frame=e,this.leq=i,this.head=new ZH,this.head.next=this.head,this.head.prev=this.head}return t.prototype.min=function(){return this.head.next},t.prototype.max=function(){return this.head.prev},t.prototype.insert=function(e){return this.insertBefore(this.head,e)},t.prototype.search=function(e){var i=this.head;do i=i.next;while(i.key!==null&&!this.leq(this.frame,e,i.key));return i},t.prototype.insertBefore=function(e,i){do e=e.prev;while(e.key!==null&&!this.leq(this.frame,e.key,i));var r=new ZH;return r.key=i,r.next=e.next,e.next.prev=r,r.prev=e,e.next=r,r},t.prototype.delete=function(e){e.next.prev=e.prev,e.prev.next=e.next},t}(),J_e=function(){function t(){}return t.regionBelow=function(e){return e.nodeUp.prev.key},t.regionAbove=function(e){return e.nodeUp.next.key},t.debugEvent=function(e){},t.addWinding=function(e,i){e.winding+=i.winding,e.Sym.winding+=i.Sym.winding},t.edgeLeq=function(e,i,r){var n=e.event,s=i.eUp,a=r.eUp;if(s.Dst===n)return a.Dst===n?yi.vertLeq(s.Org,a.Org)?yi.edgeSign(a.Dst,s.Org,a.Org)<=0:yi.edgeSign(s.Dst,a.Org,s.Org)>=0:yi.edgeSign(a.Dst,n,a.Org)<=0;if(a.Dst===n)return yi.edgeSign(s.Dst,n,s.Org)>=0;var o=yi.edgeEval(s.Dst,n,s.Org),l=yi.edgeEval(a.Dst,n,a.Org);return o>=l},t.deleteRegion=function(e,i){i.fixUpperEdge&&Ti(i.eUp.winding===0),i.eUp.activeRegion=null,e.dict.delete(i.nodeUp)},t.fixUpperEdge=function(e,i,r){Ti(i.fixUpperEdge),e.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=r,r.activeRegion=i},t.topLeftRegion=function(e,i){var r=i.eUp.Org,n;do i=t.regionAbove(i);while(i.eUp.Org===r);if(i.fixUpperEdge){if(n=e.mesh.connect(t.regionBelow(i).eUp.Sym,i.eUp.Lnext),n===null)return null;t.fixUpperEdge(e,i,n),i=t.regionAbove(i)}return i},t.topRightRegion=function(e){var i=e.eUp.Dst;do e=t.regionAbove(e);while(e.eUp.Dst===i);return e},t.addRegionBelow=function(e,i,r){var n=new XO;return n.eUp=r,n.nodeUp=e.dict.insertBefore(i.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,r.activeRegion=n,n},t.isWindingInside=function(e,i){switch(e.windingRule){case nn.ODD:return(i&1)!==0;case nn.NONZERO:return i!==0;case nn.POSITIVE:return i>0;case nn.NEGATIVE:return i<0;case nn.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},t.computeWinding=function(e,i){i.windingNumber=t.regionAbove(i).windingNumber+i.eUp.winding,i.inside=t.isWindingInside(e,i.windingNumber)},t.finishRegion=function(e,i){var r=i.eUp,n=r.Lface;n.inside=i.inside,n.anEdge=r,t.deleteRegion(e,i)},t.finishLeftRegions=function(e,i,r){for(var n,s=null,a=i,o=i.eUp;a!==r;){if(a.fixUpperEdge=!1,s=t.regionBelow(a),n=s.eUp,n.Org!=o.Org){if(!s.fixUpperEdge){t.finishRegion(e,a);break}n=e.mesh.connect(o.Lprev,n.Sym),t.fixUpperEdge(e,s,n)}o.Onext!==n&&(e.mesh.splice(n.Oprev,n),e.mesh.splice(o,n)),t.finishRegion(e,a),o=s.eUp,a=s}return o},t.addRightEdges=function(e,i,r,n,s,a){var o,l,c,u,h=!0;c=r;do Ti(yi.vertLeq(c.Org,c.Dst)),t.addRegionBelow(e,i,c.Sym),c=c.Onext;while(c!==n);for(s===null&&(s=t.regionBelow(i).eUp.Rprev),l=i,u=s;o=t.regionBelow(l),c=o.eUp.Sym,c.Org===u.Org;)c.Onext!==u&&(e.mesh.splice(c.Oprev,c),e.mesh.splice(u.Oprev,c)),o.windingNumber=l.windingNumber-c.winding,o.inside=t.isWindingInside(e,o.windingNumber),l.dirty=!0,!h&&t.checkForRightSplice(e,l)&&(t.addWinding(c,u),t.deleteRegion(e,l),e.mesh.delete(u)),h=!1,l=o,u=c;l.dirty=!0,Ti(l.windingNumber-c.winding===o.windingNumber),a&&t.walkDirtyRegions(e,l)},t.spliceMergeVertices=function(e,i,r){e.mesh.splice(i,r)},t.vertexWeights=function(e,i,r){var n=yi.vertL1dist(i,e),s=yi.vertL1dist(r,e),a=.5*s/(n+s),o=.5*n/(n+s);e.coords[0]+=a*i.coords[0]+o*r.coords[0],e.coords[1]+=a*i.coords[1]+o*r.coords[1],e.coords[2]+=a*i.coords[2]+o*r.coords[2]},t.getIntersectData=function(e,i,r,n,s,a){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,t.vertexWeights(i,r,n),t.vertexWeights(i,s,a)},t.checkForRightSplice=function(e,i){var r=t.regionBelow(i),n=i.eUp,s=r.eUp;if(yi.vertLeq(n.Org,s.Org)){if(yi.edgeSign(s.Dst,n.Org,s.Org)>0)return!1;yi.vertEq(n.Org,s.Org)?n.Org!==s.Org&&(e.pq.delete(n.Org.pqHandle),t.spliceMergeVertices(e,s.Oprev,n)):(e.mesh.splitEdge(s.Sym),e.mesh.splice(n,s.Oprev),i.dirty=r.dirty=!0)}else{if(yi.edgeSign(n.Dst,s.Org,n.Org)<0)return!1;t.regionAbove(i).dirty=i.dirty=!0,e.mesh.splitEdge(n.Sym),e.mesh.splice(s.Oprev,n)}return!0},t.checkForLeftSplice=function(e,i){var r=t.regionBelow(i),n=i.eUp,s=r.eUp,a;if(Ti(!yi.vertEq(n.Dst,s.Dst)),yi.vertLeq(n.Dst,s.Dst)){if(yi.edgeSign(n.Dst,s.Dst,n.Org)<0)return!1;t.regionAbove(i).dirty=i.dirty=!0,a=e.mesh.splitEdge(n),e.mesh.splice(s.Sym,a),a.Lface.inside=i.inside}else{if(yi.edgeSign(s.Dst,n.Dst,s.Org)>0)return!1;i.dirty=r.dirty=!0,a=e.mesh.splitEdge(s),e.mesh.splice(n.Lnext,s.Sym),a.Rface.inside=i.inside}return!0},t.checkForIntersect=function(e,i){var r=t.regionBelow(i),n=i.eUp,s=r.eUp,a=n.Org,o=s.Org,l=n.Dst,c=s.Dst,u,h,d=new Qx,p,g;if(Ti(!yi.vertEq(c,l)),Ti(yi.edgeSign(l,e.event,a)<=0),Ti(yi.edgeSign(c,e.event,o)>=0),Ti(a!==e.event&&o!==e.event),Ti(!i.fixUpperEdge&&!r.fixUpperEdge),a===o||(u=Math.min(a.t,l.t),h=Math.max(o.t,c.t),u>h))return!1;if(yi.vertLeq(a,o)){if(yi.edgeSign(c,a,o)>0)return!1}else if(yi.edgeSign(l,o,a)<0)return!1;return t.debugEvent(e),yi.intersect(l,a,c,o,d),Ti(Math.min(a.t,l.t)<=d.t),Ti(d.t<=Math.max(o.t,c.t)),Ti(Math.min(c.s,l.s)<=d.s),Ti(d.s<=Math.max(o.s,a.s)),yi.vertLeq(d,e.event)&&(d.s=e.event.s,d.t=e.event.t),p=yi.vertLeq(a,o)?a:o,yi.vertLeq(p,d)&&(d.s=p.s,d.t=p.t),yi.vertEq(d,a)||yi.vertEq(d,o)?(t.checkForRightSplice(e,i),!1):!yi.vertEq(l,e.event)&&yi.edgeSign(l,e.event,d)>=0||!yi.vertEq(c,e.event)&&yi.edgeSign(c,e.event,d)<=0?c===e.event?(e.mesh.splitEdge(n.Sym),e.mesh.splice(s.Sym,n),i=t.topLeftRegion(e,i),n=t.regionBelow(i).eUp,t.finishLeftRegions(e,t.regionBelow(i),r),t.addRightEdges(e,i,n.Oprev,n,n,!0),!0):l===e.event?(e.mesh.splitEdge(s.Sym),e.mesh.splice(n.Lnext,s.Oprev),r=i,i=t.topRightRegion(i),g=t.regionBelow(i).eUp.Rprev,r.eUp=s.Oprev,s=t.finishLeftRegions(e,r,null),t.addRightEdges(e,i,s.Onext,n.Rprev,g,!0),!0):(yi.edgeSign(l,e.event,d)>=0&&(t.regionAbove(i).dirty=i.dirty=!0,e.mesh.splitEdge(n.Sym),n.Org.s=e.event.s,n.Org.t=e.event.t),yi.edgeSign(c,e.event,d)<=0&&(i.dirty=r.dirty=!0,e.mesh.splitEdge(s.Sym),s.Org.s=e.event.s,s.Org.t=e.event.t),!1):(e.mesh.splitEdge(n.Sym),e.mesh.splitEdge(s.Sym),e.mesh.splice(s.Oprev,n),n.Org.s=d.s,n.Org.t=d.t,n.Org.pqHandle=e.pq.insert(n.Org),t.getIntersectData(e,n.Org,a,l,o,c),t.regionAbove(i).dirty=i.dirty=r.dirty=!0,!1)},t.walkDirtyRegions=function(e,i){for(var r=t.regionBelow(i),n,s;;){for(;r.dirty;)i=r,r=t.regionBelow(r);if(!i.dirty&&(r=i,i=t.regionAbove(i),i===null||!i.dirty))return;if(i.dirty=!1,n=i.eUp,s=r.eUp,n.Dst!==s.Dst&&t.checkForLeftSplice(e,i)&&(r.fixUpperEdge?(t.deleteRegion(e,r),e.mesh.delete(s),r=t.regionBelow(i),s=r.eUp):i.fixUpperEdge&&(t.deleteRegion(e,i),e.mesh.delete(n),i=t.regionAbove(r),n=i.eUp)),n.Org!==s.Org)if(n.Dst!==s.Dst&&!i.fixUpperEdge&&!r.fixUpperEdge&&(n.Dst===e.event||s.Dst===e.event)){if(t.checkForIntersect(e,i))return}else t.checkForRightSplice(e,i);n.Org===s.Org&&n.Dst===s.Dst&&(t.addWinding(s,n),t.deleteRegion(e,i),e.mesh.delete(n),i=t.regionAbove(r))}},t.connectRightVertex=function(e,i,r){var n,s=r.Onext,a=t.regionBelow(i),o=i.eUp,l=a.eUp,c=!1;if(o.Dst!==l.Dst&&t.checkForIntersect(e,i),yi.vertEq(o.Org,e.event)&&(e.mesh.splice(s.Oprev,o),i=t.topLeftRegion(e,i),s=t.regionBelow(i).eUp,t.finishLeftRegions(e,t.regionBelow(i),a),c=!0),yi.vertEq(l.Org,e.event)&&(e.mesh.splice(r,l.Oprev),r=t.finishLeftRegions(e,a,null),c=!0),c){t.addRightEdges(e,i,r.Onext,s,s,!0);return}yi.vertLeq(l.Org,o.Org)?n=l.Oprev:n=o,n=e.mesh.connect(r.Lprev,n),t.addRightEdges(e,i,n,n.Onext,n.Onext,!1),n.Sym.activeRegion.fixUpperEdge=!0,t.walkDirtyRegions(e,i)},t.connectLeftDegenerate=function(e,i,r){var n,s,a,o,l;if(n=i.eUp,yi.vertEq(n.Org,r)){Ti(!1),t.spliceMergeVertices(e,n,r.anEdge);return}if(!yi.vertEq(n.Dst,r)){e.mesh.splitEdge(n.Sym),i.fixUpperEdge&&(e.mesh.delete(n.Onext),i.fixUpperEdge=!1),e.mesh.splice(r.anEdge,n),t.sweepEvent(e,r);return}Ti(!1),i=t.topRightRegion(i),l=t.regionBelow(i),a=l.eUp.Sym,s=o=a.Onext,l.fixUpperEdge&&(Ti(s!==a),t.deleteRegion(e,l),e.mesh.delete(a),a=s.Oprev),e.mesh.splice(r.anEdge,a),yi.edgeGoesLeft(s)||(s=null),t.addRightEdges(e,i,a.Onext,o,s,!0)},t.connectLeftVertex=function(e,i){var r,n,s,a,o,l,c=new XO;if(c.eUp=i.anEdge.Sym,r=e.dict.search(c).key,n=t.regionBelow(r),!!n){if(a=r.eUp,o=n.eUp,yi.edgeSign(a.Dst,i,a.Org)===0){t.connectLeftDegenerate(e,r,i);return}if(s=yi.vertLeq(o.Dst,a.Dst)?r:n,r.inside||s.fixUpperEdge){if(s===r)l=e.mesh.connect(i.anEdge.Sym,a.Lnext);else{var u=e.mesh.connect(o.Dnext,i.anEdge);l=u.Sym}s.fixUpperEdge?t.fixUpperEdge(e,s,l):t.computeWinding(e,t.addRegionBelow(e,r,l)),t.sweepEvent(e,i)}else t.addRightEdges(e,r,i.anEdge,i.anEdge,null,!0)}},t.sweepEvent=function(e,i){e.event=i,t.debugEvent(e);for(var r=i.anEdge;r.activeRegion===null;)if(r=r.Onext,r===i.anEdge){t.connectLeftVertex(e,i);return}var n=t.topLeftRegion(e,r.activeRegion);Ti(n!==null);var s=t.regionBelow(n),a=s.eUp,o=t.finishLeftRegions(e,s,null);o.Onext===a?t.connectRightVertex(e,n,o):t.addRightEdges(e,n,o.Onext,a,a,!0)},t.addSentinel=function(e,i,r,n){var s=new XO,a=e.mesh.makeEdge();a.Org.s=r,a.Org.t=n,a.Dst.s=i,a.Dst.t=n,e.event=a.Dst,s.eUp=a,s.windingNumber=0,s.inside=!1,s.fixUpperEdge=!1,s.sentinel=!0,s.dirty=!1,s.nodeUp=e.dict.insert(s)},t.initEdgeDict=function(e){e.dict=new K_e(e,t.edgeLeq);var i=e.bmax[0]-e.bmin[0],r=e.bmax[1]-e.bmin[1],n=e.bmin[0]-i,s=e.bmax[0]+i,a=e.bmin[1]-r,o=e.bmax[1]+r;t.addSentinel(e,n,s,a),t.addSentinel(e,n,s,o)},t.doneEdgeDict=function(e){for(var i,r=0;(i=e.dict.min().key)!==null;)i.sentinel||(Ti(i.fixUpperEdge),Ti(++r===1)),Ti(i.windingNumber===0),t.deleteRegion(e,i)},t.removeDegenerateEdges=function(e){var i,r,n,s=e.mesh.eHead;for(i=s.next;i!==s;i=r)r=i.next,n=i.Lnext,yi.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(t.spliceMergeVertices(e,n,i),e.mesh.delete(i),i=n,n=i.Lnext),n.Lnext===i&&(n!==i&&((n===r||n===r.Sym)&&(r=r.next),e.mesh.delete(n)),(i===r||i===r.Sym)&&(r=r.next),e.mesh.delete(i))},t.initPriorityQ=function(e){var i,r,n,s=0;for(n=e.mesh.vHead,r=n.next;r!==n;r=r.next)s++;for(s+=8,i=e.pq=new Z_e(s,yi.vertLeq),n=e.mesh.vHead,r=n.next;r!==n;r=r.next)r.pqHandle=i.insert(r);return r!==n?!1:(i.init(),!0)},t.donePriorityQ=function(e){e.pq=null},t.removeDegenerateFaces=function(e,i){var r,n,s;for(r=i.fHead.next;r!==i.fHead;r=n)n=r.next,s=r.anEdge,Ti(s.Lnext!==s),s.Lnext.Lnext===s&&(t.addWinding(s.Onext,s),e.mesh.delete(s));return!0},t.computeInterior=function(e,i){i===void 0&&(i=!0);var r,n;if(t.removeDegenerateEdges(e),!t.initPriorityQ(e))return!1;for(t.initEdgeDict(e);(r=e.pq.extractMin())!==null;){for(;n=e.pq.min(),!(n===null||!yi.vertEq(n,r));)n=e.pq.extractMin(),t.spliceMergeVertices(e,r.anEdge,n.anEdge);t.sweepEvent(e,r)}return e.event=e.dict.min().key.eUp.Org,t.debugEvent(e),t.doneEdgeDict(e),t.donePriorityQ(e),t.removeDegenerateFaces(e,e.mesh)?(i&&e.mesh.check(),!0):!1},t}(),$_e=function(){function t(){this.mesh=new XH,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=nn.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return t.prototype.dot_=function(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]},t.prototype.normalize_=function(e){var i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),e[0]/=i,e[1]/=i,e[2]/=i},t.prototype.longAxis_=function(e){var i=0;return Math.abs(e[1])>Math.abs(e[0])&&(i=1),Math.abs(e[2])>Math.abs(e[i])&&(i=2),i},t.prototype.computeNormal_=function(e){var i,r,n,s,a,o,l=[0,0,0],c=[0,0,0],u=[0,0,0],h=[0,0,0],d=[0,0,0],p=[null,null,null],g=[null,null,null],x=this.mesh.vHead;i=x.next;for(var v=0;v<3;++v)s=i.coords[v],c[v]=s,g[v]=i,l[v]=s,p[v]=i;for(i=x.next;i!==x;i=i.next)for(var b=0;b<3;++b)s=i.coords[b],s<c[b]&&(c[b]=s,g[b]=i),s>l[b]&&(l[b]=s,p[b]=i);var w=0;if(l[1]-c[1]>l[0]-c[0]&&(w=1),l[2]-c[2]>l[w]-c[w]&&(w=2),c[w]>=l[w]){e[0]=0,e[1]=0,e[2]=1;return}for(o=0,r=g[w],n=p[w],u[0]=r.coords[0]-n.coords[0],u[1]=r.coords[1]-n.coords[1],u[2]=r.coords[2]-n.coords[2],i=x.next;i!==x;i=i.next)h[0]=i.coords[0]-n.coords[0],h[1]=i.coords[1]-n.coords[1],h[2]=i.coords[2]-n.coords[2],d[0]=u[1]*h[2]-u[2]*h[1],d[1]=u[2]*h[0]-u[0]*h[2],d[2]=u[0]*h[1]-u[1]*h[0],a=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],a>o&&(o=a,e[0]=d[0],e[1]=d[1],e[2]=d[2]);o<=0&&(e[0]=e[1]=e[2]=0,e[this.longAxis_(u)]=1)},t.prototype.checkOrientation_=function(){for(var e=this.mesh.fHead,i,r=this.mesh.vHead,n,s=0,a=e.next;a!==e;a=a.next)if(n=a.anEdge,!(n.winding<=0))do s+=(n.Org.s-n.Dst.s)*(n.Org.t+n.Dst.t),n=n.Lnext;while(n!==a.anEdge);if(s<0){for(i=r.next;i!==r;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},t.prototype.projectPolygon_=function(){var e=this.mesh.vHead,i=[0,0,0],r,n,s=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),s=!0),r=this.sUnit,n=this.tUnit;var a=this.longAxis_(i);r[a]=0,r[(a+1)%3]=1,r[(a+2)%3]=0,n[a]=0,n[(a+1)%3]=0,n[(a+2)%3]=i[a]>0?1:-1;for(var o=e.next;o!==e;o=o.next)o.s=this.dot_(o.coords,r),o.t=this.dot_(o.coords,n);s&&this.checkOrientation_();for(var l=!0,c=e.next;c!==e;c=c.next)l?(this.bmin[0]=this.bmax[0]=c.s,this.bmin[1]=this.bmax[1]=c.t,l=!1):(c.s<this.bmin[0]&&(this.bmin[0]=c.s),c.s>this.bmax[0]&&(this.bmax[0]=c.s),c.t<this.bmin[1]&&(this.bmin[1]=c.t),c.t>this.bmax[1]&&(this.bmax[1]=c.t))},t.prototype.addWinding_=function(e,i){e.winding+=i.winding,e.Sym.winding+=i.Sym.winding},t.prototype.tessellateMonoRegion_=function(e,i){var r,n;if(r=i.anEdge,!(r.Lnext!==r&&r.Lnext.Lnext!==r))throw"Mono region invalid";for(;yi.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;yi.vertLeq(r.Org,r.Dst);r=r.Lnext);n=r.Lprev;for(var s=void 0;r.Lnext!==n;)if(yi.vertLeq(r.Dst,n.Org)){for(;n.Lnext!==r&&(yi.edgeGoesLeft(n.Lnext)||yi.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)s=e.connect(n.Lnext,n),n=s.Sym;n=n.Lprev}else{for(;n.Lnext!==r&&(yi.edgeGoesRight(r.Lprev)||yi.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)s=e.connect(r,r.Lprev),r=s.Sym;r=r.Lnext}if(n.Lnext===r)throw"Mono region invalid";for(;n.Lnext.Lnext!==r;)s=e.connect(n.Lnext,n),n=s.Sym;return!0},t.prototype.tessellateInterior_=function(e){for(var i,r=e.fHead.next;r!==e.fHead;r=i)if(i=r.next,r.inside&&!this.tessellateMonoRegion_(e,r))return!1;return!0},t.prototype.discardExterior_=function(e){for(var i,r=e.fHead.next;r!==e.fHead;r=i)i=r.next,r.inside||e.zapFace(r)},t.prototype.setWindingNumber_=function(e,i,r){for(var n,s=e.eHead.next;s!==e.eHead;s=n)n=s.next,s.Rface.inside!==s.Lface.inside?s.winding=s.Lface.inside?i:-i:r?e.delete(s):s.winding=0},t.prototype.getNeighbourFace_=function(e){return!e.Rface||!e.Rface.inside?-1:e.Rface.n},t.prototype.outputPolymesh_=function(e,i,r,n){var s,a=0,o=0,l;r>3&&e.mergeConvexFaces(r);for(var c=e.vHead.next;c!==e.vHead;c=c.next)c.n=-1;for(var u=e.fHead.next;u!==e.fHead;u=u.next)if(u.n=-1,!!u.inside){s=u.anEdge,l=0;do{var c=s.Org;c.n===-1&&(c.n=o,o++),l++,s=s.Lnext}while(s!==u.anEdge);if(l>r)throw"Face vertex greater that support polygon";u.n=a,++a}this.elementCount=a,i===Vs.CONNECTED_POLYGONS&&(a*=2),this.elements=[],this.elements.length=a*r,this.vertexCount=o,this.vertices=[],this.vertices.length=o*n,this.vertexIndices=[],this.vertexIndices.length=o;for(var c=e.vHead.next;c!==e.vHead;c=c.next)if(c.n!==-1){var h=c.n*n;this.vertices[h+0]=c.coords[0],this.vertices[h+1]=c.coords[1],n>2&&(this.vertices[h+2]=c.coords[2]),this.vertexIndices[c.n]=c.idx}for(var d=0,u=e.fHead.next;u!==e.fHead;u=u.next)if(u.inside){s=u.anEdge,l=0;do{var c=s.Org;this.elements[d++]=c.n,l++,s=s.Lnext}while(s!==u.anEdge);for(var p=l;p<r;++p)this.elements[d++]=-1;if(i===Vs.CONNECTED_POLYGONS){s=u.anEdge;do this.elements[d++]=this.getNeighbourFace_(s),s=s.Lnext;while(s!==u.anEdge);for(var g=l;g<r;++g)this.elements[d++]=-1}}},t.prototype.outputContours_=function(e,i){var r,n,s=0,a=0;this.vertexCount=0,this.elementCount=0;for(var o=e.fHead.next;o!==e.fHead;o=o.next)if(o.inside){n=r=o.anEdge;do this.vertexCount++,r=r.Lnext;while(r!==n);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var l=0,c=0,u=0;s=0;for(var o=e.fHead.next;o!==e.fHead;o=o.next)if(o.inside){a=0,n=r=o.anEdge;do this.vertices[l++]=r.Org.coords[0],this.vertices[l++]=r.Org.coords[1],i>2&&(this.vertices[l++]=r.Org.coords[2]),this.vertexIndices[c++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,a++,r=r.Lnext;while(r!==n);this.elements[u++]=s,this.elements[u++]=a,s+=a}},t.prototype.addContour=function(e,i){this.mesh===null&&(this.mesh=new XH),e<2&&(e=2),e>3&&(e=3);for(var r=null,n=0;n<i.length;n+=e)r===null?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=i[n+0],r.Org.coords[1]=i[n+1],e>2?r.Org.coords[2]=i[n+2]:r.Org.coords[2]=0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},t.prototype.tesselate=function(e,i,r,n,s,a){if(e===void 0&&(e=nn.ODD),i===void 0&&(i=Vs.POLYGONS),a===void 0&&(a=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,s&&(this.normal[0]=s[0],this.normal[1]=s[1],this.normal[2]=s[2]),this.windingRule=e,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),J_e.computeInterior(this,a);var o=this.mesh;return i===Vs.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),a&&o.check(),i===Vs.BOUNDARY_CONTOURS?this.outputContours_(o,n):this.outputPolymesh_(o,i,r,n),!0},t}();function ug(t){var e=t.windingRule,i=e===void 0?nn.ODD:e,r=t.elementType,n=r===void 0?Vs.POLYGONS:r,s=t.polySize,a=s===void 0?3:s,o=t.vertexSize,l=o===void 0?2:o,c=t.normal,u=c===void 0?[0,0,1]:c,h=t.contours,d=h===void 0?[]:h,p=t.strict,g=p===void 0?!0:p,x=t.debug,v=x===void 0?!1:x;if(!d&&g)throw new Error("Contours can't be empty");if(d){var b=new $_e;t.edgeCreateCallback&&(b.edgeCreateCallback=t.edgeCreateCallback),t.vertexIdCallback&&(b.vertexIdCallback=t.vertexIdCallback);for(var w=0;w<d.length;w++)b.addContour(l||2,d[w]);return b.tesselate(i,n,a,l,u,g),{vertices:b.vertices,vertexIndices:b.vertexIndices,vertexCount:b.vertexCount,elements:b.elements,elementCount:b.elementCount,mesh:v?b.mesh:void 0}}}nn.ODD;nn.NONZERO;nn.POSITIVE;nn.NEGATIVE;nn.ABS_GEQ_TWO;Vs.POLYGONS;Vs.CONNECTED_POLYGONS;Vs.BOUNDARY_CONTOURS;var HU=class{constructor(t=256,e=!1){this.capacity=t,this.size=0,this.debug=e,this.debug&&console.log(`allocating with cap ${t}`);let i=t*HU.eSize;this.buffer=new ArrayBuffer(i);let r=Float32Array.BYTES_PER_ELEMENT,n=0;this.positions=new Float32Array(this.buffer,n*r,3*t),n+=3*t,this.normals=new Float32Array(this.buffer,n*r,3*t),n+=3*t,this.uvs=new Float32Array(this.buffer,n*r,2*t)}realloc(t,e=!1){if(t<this.size)throw Error("cannot shrink buffer");if(t<=this.capacity&&!e)return;this.debug&&console.log(`resizing from ${this.capacity}  ${t}`);let i=t*HU.eSize,r=new ArrayBuffer(i),n=Float32Array.BYTES_PER_ELEMENT,s=0,a=new Float32Array(r,s*n,3*t);s+=3*t;let o=new Float32Array(r,s*n,3*t);s+=3*t;let l=new Float32Array(r,s*n,2*t);e?(a.set(this.positions.subarray(0,this.size*3)),o.set(this.normals.subarray(0,this.size*3)),l.set(this.uvs.subarray(0,this.size*2))):(a.set(this.positions),o.set(this.normals),l.set(this.uvs)),this.buffer=r,this.positions=a,this.normals=o,this.uvs=l,this.capacity=t}get(t=1){let e=this.size+t;if(e>this.capacity){let r=this.capacity;for(;e>r;)r*=2;this.realloc(r)}let i=this.size;return this.size=e,i}reserve(t){let e=this.size+t;e>this.capacity&&this.realloc(e)}shrink(){this.debug&&console.log(`shrinking ${this.capacity}  ${this.size}`),this.realloc(this.size,!0)}},EY=HU;EY.eSize=8*Float32Array.BYTES_PER_ELEMENT;var eSe=class{constructor(t=[],e=(i,r)=>i<r?-1:i>r?1:0){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;let t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:e,compare:i}=this,r=e[t];for(;t>0;){let n=t-1>>1,s=e[n];if(i(r,s)>=0)break;e[t]=s,t=n}e[t]=r}_down(t){let{data:e,compare:i}=this,r=this.length>>1,n=e[t];for(;t<r;){let s=(t<<1)+1,a=s+1;if(a<this.length&&i(e[a],e[s])<0&&(s=a),i(e[s],n)>=0)break;e[t]=e[s],t=s}e[t]=n}};function tSe(t,e,i=1,r=!1){let n=1/0,s=1/0,a=-1/0,o=-1/0;for(let[w,M]of t[0])w<n&&(n=w),M<s&&(s=M),w>a&&(a=w),M>o&&(o=M);let l=a-n,c=o-s,u=Math.max(i,Math.min(l,c));if(u===i){let w=[n,s];return w.distance=0,w.distance}let h=new eSe([],(w,M)=>M.max-w.max),d=rSe(t),p=new fD(n+l/2,s+c/2,0,t);p.d>d.d&&(d=p);let g=2;function x(w,M,E){let D=new fD(w,M,E,t);if(g++,D.max>d.d+i&&h.push(D),D.d>d.d&&(d=D,r&&console.log(`found best ${Math.round(1e4*D.d)/1e4} after ${g} probes`),d.d>e))return e}let v=u/2;for(let w=n;w<a;w+=u)for(let M=s;M<o;M+=u)x(w+v,M+v,v);for(;h.length;){let{max:w,x:M,y:E,h:D}=h.pop();if(w-d.d<=i)break;v=D/2,x(M-v,E-v,v),x(M+v,E-v,v),x(M-v,E+v,v),x(M+v,E+v,v)}r&&console.log(`num probes: ${g}
best distance: ${d.d}`);let b=[d.x,d.y];return b.distance=d.d,b.distance}function fD(t,e,i,r){this.x=t,this.y=e,this.h=i,this.d=iSe(t,e,r),this.max=this.d+this.h*Math.SQRT2}function iSe(t,e,i){let r=!1,n=1/0;for(let s of i)for(let a=0,o=s.length,l=o-1;a<o;l=a++){let c=s[a],u=s[l];c[1]>e!=u[1]>e&&t<(u[0]-c[0])*(e-c[1])/(u[1]-c[1])+c[0]&&(r=!r),n=Math.min(n,nSe(t,e,c,u))}return n===0?0:(r?1:-1)*Math.sqrt(n)}function rSe(t){let e=0,i=0,r=0,n=t[0];for(let a=0,o=n.length,l=o-1;a<o;l=a++){let c=n[a],u=n[l],h=c[0]*u[1]-u[0]*c[1];i+=(c[0]+u[0])*h,r+=(c[1]+u[1])*h,e+=h*3}let s=new fD(i/e,r/e,0,t);return e===0||s.d<0?new fD(n[0][0],n[0][1],0,t):s}function nSe(t,e,i,r){let n=i[0],s=i[1],a=r[0]-n,o=r[1]-s;if(a!==0||o!==0){let l=((t-n)*a+(e-s)*o)/(a*a+o*o);l>1?(n=r[0],s=r[1]):l>0&&(n+=a*l,s+=o*l)}return a=t-n,o=e-s,a*a+o*o}var h4={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},AY={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},TY={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},YO=(t,e)=>([i,r])=>(r<i&&(r+=e),(t>=i?t:t+e)<=r),d4=class extends ni{constructor(t,e,i=0,r=12,n=3,s=nn.ODD,a=!1){super(),this.forPathBevel=a,this.type="ShapeGeometry",this.vertexCache={},this._shape=t,this._depth=e,this._curveSegments=r,this._bevelSegmentsInput=n;let o=this._shape.extractShapePointsToFlatArray([],r),l=this._shape.shapeHoles.map(R=>{let O=R.extractShapePointsToFlatArray([],r),U=[];for(let F=O.length-1;F>=1;F-=2){let V=O[F-1],k=O[F-0];U.push(V,k)}return U}),c=[],u=[];for(let R=0;R<o.length;R+=2)u.push([o[R],o[R+1]]);c.push(u);for(let R=0;R<l.length;R++){let O=l[R],U=[];for(let F=0;F<O.length;F+=2)U.push([O[F],O[F+1]]);c.push(U)}let h;t.isText?h=new RN().setFromPoints(t.points.map(R=>R.position)).getSize(new Oe).length()*.1:c[0].length===0?h=i:i>0?h=tSe(c,i):h=1e-5,i<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(i,h,e/2),this._bevelSegments=Math.floor(n));let d;try{d=ug({windingRule:s,elementType:Vs.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[o]})}catch{d=h4}let p;try{p=ug({windingRule:nn.ODD,elementType:Vs.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...l]})}catch{p=AY}if(!d)throw new Error("error generating geometry");let g=d.elementCount;if(p){d.elementCount+=p.elementCount;for(let R=0;R<p.elements.length;R++){let O=p.elements[R],U=R%2===0?d.vertexCount:0;d.elements.push(O+U)}for(let R=0;R<p.vertexIndices.length;R++){let O=p.vertexIndices[R],U=d.vertexCount;d.vertexIndices.push(O+U)}for(let R=0;R<p.vertices.length;R++){let O=p.vertices[R];d.vertices.push(O)}}let x=1/0,v=-1/0,b=1/0,w=-1/0;for(let R=0,O=d.vertexCount;R<O;R++){let U=R*2,F=d.vertices[U+0],V=d.vertices[U+1];F<x&&(x=F),F>v&&(v=F),V<b&&(b=V),V>w&&(w=V)}this._minX=x,this._minY=b,this._width=v-x,this._height=w-b,this._buffer=new EY(this._computeBufferEstimatedSize(d));let M=[],E=[];for(let R=d.elementCount-1;R>=0;R--){let O=R>=g,U=R*2,F=d.elements[U+0],V=d.elements[U+1],k=F+V,K={start:F,count:V,normals:[],continuous:[],concave:[]},X=F,$=k-1,Y=F+1,re=this._shape.roundedCurves.length;do{let Q=X-F,ae=d.vertices[$*2+0],ne=d.vertices[$*2+1],ue=d.vertices[X*2+0],fe=d.vertices[X*2+1],xe=d.vertices[Y*2+0],be=d.vertices[Y*2+1],Ce=ue-ae,ge=fe-ne,Te=Math.sqrt(Ce*Ce+ge*ge);Ce/=Te,ge/=Te;let ce=ue-xe,Ue=fe-be,ze=Math.sqrt(ce*ce+Ue*Ue);ce/=ze,Ue/=ze,K.normals[Q*2+0]=-Ue,K.normals[Q*2+1]=ce,K.concave[Q]=Ce*Ue-ge*ce>0;let Xe=d.vertexIndices[X];if(Array.isArray(Xe))K.continuous[Q]=!1;else{let[De,Ge]=this._shape.getCurveIndexFromVertexId(Xe-1,!0);if(Ge>0&&Ge<1)K.continuous[Q]=!0;else{let We=Ge===1?De+1:De-1;We=(We+re)%re;let se=Ge===1?0:1,H=this._shape.roundedCurves[De].getTangent(Ge),Z=this._shape.roundedCurves[We].getTangent(se);K.continuous[Q]=H.dot(Z)>.95}}O&&(K.normals[Q*2+0]*=-1,K.normals[Q*2+1]*=-1),[$,X,Y]=[X,Y,Y+1],Y>=k&&(Y-=V)}while(Y!==F+1);let G=[];G.push({bevelI:0,angle:0,size:0,boundary:{vertices:d.vertices.slice(F*2,k*2),vertexCount:V,vertexIndices:new Array(V).fill(!0).map((Q,ae)=>[ae,ae]),elements:[0,V],elementCount:1,mesh:null},reverseMap:[],insetPoints:d.vertices.slice(F*2,k*2)});let j=0;for(let Q=1;Q<=this._bevelSegments;Q++){let ae=Q/this._bevelSegments*Math.PI/2,ne=(1-Math.cos(ae))*this._bevel,ue=[],fe=[],xe=0;for(let Ce=0;Ce<V;Ce++){let ge=Ce*2,Te=(Ce-1+V)%V*2,ce=d.vertices[K.start*2+ge+0],Ue=d.vertices[K.start*2+ge+1],ze=-K.normals[Te+0]*ne,Xe=-K.normals[Te+1]*ne,De=-K.normals[ge+0]*ne,Ge=-K.normals[ge+1]*ne;if(K.concave[Ce]||!K.concave[Ce]&&O){let We=Math.atan2(Xe,ze),se=Math.atan2(Ge,De);se>We&&(se-=Math.PI*2);let H=se-We;if(K.continuous[Ce]||O){let Z=We+H/2,pe=Math.cos(Z)*ne,we=Math.sin(Z)*ne;ue[2*xe+0]=ce+pe*(O?-1:1),ue[2*xe+1]=Ue+we*(O?-1:1),fe[xe]=Ce,xe++}else{let Z=Math.max(1,Math.floor(r/4*Math.abs(H)/Math.PI));for(let pe=0;pe<=Z;pe++){let we=We+H*(pe/Z),J=Math.cos(we)*ne,He=Math.sin(we)*ne;ue[2*xe+0]=ce+J,ue[2*xe+1]=Ue+He,fe[xe]=Ce,xe++}}}else ue[2*xe+0]=ce+ze,ue[2*xe+1]=Ue+Xe,fe[xe]=Ce,xe++,ue[2*xe+0]=ce,ue[2*xe+1]=Ue,fe[xe]=Ce,xe++,ue[2*xe+0]=ce+De,ue[2*xe+1]=Ue+Ge,fe[xe]=Ce,xe++}let be=ug({windingRule:nn.POSITIVE,elementType:Vs.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[ue],edgeCreateCallback:Ce=>{let ge=Ce.Org.idx,Te=fe[ge],ce=fe[(ge+1)%fe.length];Ce.idx=[Te,ce],Ce.Sym.idx=[ce,Te]},vertexIdCallback:Ce=>{let ge=Ce.Lprev.idx;return[ge?ge[1]:0,Ce.idx?Ce.idx[0]:0]}});if(!be)throw console.log("Error"),new Error(`error generating bevel geometry for ${Q}'th loop`);if(!be.vertexCount){let Ce=(Q-1)/this._bevelSegments*Math.PI/2;j=(1-Math.sin(Ce))*this._bevel;break}for(let Ce=0;Ce<be.vertexIndices.length;Ce++){let[ge,Te]=be.vertexIndices[Ce];if(ge===Te)continue;let ce=Te;Te<ge&&(ce+=V);for(let Ue=ge;Ue<ce;Ue++){let ze=Ue%V,Xe=(Ue+1)%V;if(!K.continuous[ze]||!K.continuous[Xe]){be.vertexIndices[Ce]=[ge,ze],be.vertexIndices.splice(Ce+1,0,[Xe,Te]),be.vertices.splice((Ce+1)*2,0,be.vertices[Ce*2],be.vertices[Ce*2+1]);break}}}G.push({bevelI:Q,angle:ae,size:ne,boundary:be,reverseMap:fe,insetPoints:ue})}let ee=(Q,ae,ne)=>{let ue=0,fe=Q.boundary.vertexIndices.length;for(;ue<fe&&ne(Q.boundary.vertexIndices[ae]);)ae=(ae+1)%fe,ue++;return ue},oe=M.length;for(let Q=1;Q<G.length;Q++){let ae=G[Q-1],ne=G[Q],ue=ae.boundary.vertexIndices.length,fe=ne.boundary.vertexIndices.length;if(!ue||!fe)break;let xe=K.concave.length,be=0,Ce=YO(be,V);for(;!ae.boundary.vertexIndices.filter(Ce).length||!ne.boundary.vertexIndices.filter(Ce).length;)be++,Ce=YO(be,V);let ge=ae.boundary.vertexIndices.findIndex(Ce),Te=ne.boundary.vertexIndices.findIndex(Ce);do ge=(ge+1)%ue;while(Ce(ae.boundary.vertexIndices[ge]));do Te=(Te+1)%fe;while(Ce(ne.boundary.vertexIndices[Te]));be=(be+1)%V;let ce=be,Ue=0,ze=this._buildBevelVert(K,ae,(ge-1+ue)%ue,void 0,Ue),Xe=this._buildBevelVert(K,ne,(Te-1+fe)%fe,void 0,Ue),De=ze,Ge=Xe,We,se,H=!1;do{Ue=(be||xe)/xe,Ce=YO(be,V);let Z=ee(ae,ge,Ce),pe=ee(ne,Te,Ce),we=H;if(H=!1,Z&&!pe){for(let J=0;J<Z;J++)We=this._buildBevelVert(K,ae,(ge+J)%ue,J/(Z-1),Ue),M.push(De.topN,We.topP,Ge.topN),a===!1&&M.push(We.bottomP,De.bottomN,Ge.bottomN),De=We;H=!0}else if(!Z&&pe)for(let J=0;J<pe;J++)se=this._buildBevelVert(K,ne,(Te+J)%fe,J/(pe-1),Ue),M.push(Ge.topN,De.topP,se.topP),a===!1&&M.push(De.bottomP,Ge.bottomN,se.bottomP),Ge=se;else if(Z&&pe)if(We=this._buildBevelVert(K,ae,ge,0,Ue),se=this._buildBevelVert(K,ne,Te,0,Ue),we?(M.push(De.topN,se.topP,Ge.topN),M.push(De.topN,We.topP,se.topP),a===!1&&(M.push(se.bottomP,De.bottomN,Ge.bottomN),M.push(se.bottomP,We.bottomP,De.bottomN))):(M.push(Ge.topN,De.topN,We.topP),M.push(Ge.topN,We.topP,se.topP),a===!1&&(M.push(We.bottomP,De.bottomN,Ge.bottomN),M.push(We.bottomP,Ge.bottomN,se.bottomP))),De=We,Ge=se,Z===pe)for(let J=1;J<Z;J++)We=this._buildBevelVert(K,ae,(ge+J)%ue,J/(Z-1),Ue),se=this._buildBevelVert(K,ne,(Te+J)%fe,J/(pe-1),Ue),M.push(De.topN,We.topP,Ge.topN),M.push(Ge.topN,We.topP,se.topP),a===!1&&(M.push(We.bottomP,De.bottomN,Ge.bottomN),M.push(We.bottomP,Ge.bottomN,se.bottomP)),De=We,Ge=se;else if(Z>pe){let J=Z/pe,He=0;for(let je=1;je<Z;je++)We=this._buildBevelVert(K,ae,(ge+je)%ue,je/(Z-1),Ue),M.push(De.topN,We.topP,Ge.topN),a===!1&&M.push(We.bottomP,De.bottomN,Ge.bottomN),De=We,je>(He+1)*J&&(He++,se=this._buildBevelVert(K,ne,(Te+He)%fe,He/(pe-1),Ue),M.push(Ge.topN,We.topP,se.topP),a===!1&&M.push(We.bottomP,Ge.bottomN,se.bottomP),Ge=se)}else{let J=pe/Z,He=0;for(let je=1;je<pe;je++)se=this._buildBevelVert(K,ne,(Te+je)%fe,je/(pe-1),Ue),M.push(Ge.topN,We.topP,se.topP),a===!1&&M.push(We.bottomP,Ge.bottomN,se.bottomP),Ge=se,je>(He+1)*J&&(He++,We=this._buildBevelVert(K,ae,(ge+He)%ue,He/(Z-1),Ue),M.push(De.topN,We.topP,Ge.topN),a===!1&&M.push(We.bottomP,De.bottomN,Ge.bottomN),De=We)}ge=(ge+Z)%ue,Te=(Te+pe)%fe,be=(be+1)%xe}while(be!==ce)}if(a===!1&&this._depth>this._bevel*2&&this._buildWall(G,K,M),O){let Q=[];for(let ae=M.length-1;ae>=oe+2;ae-=3){let ne=M[ae-2],ue=M[ae-1],fe=M[ae-0];Q.push(fe,ue,ne)}M.splice(oe,M.length-oe,...Q)}if(O){let Q=[];for(let ae=G[G.length-1].boundary.vertices.length-1;ae>=1;ae-=2){let ne=G[G.length-1].boundary.vertices[ae-1],ue=G[G.length-1].boundary.vertices[ae-0];Q.push(ne,ue)}E.push(Q)}if(!O){let Q=G[G.length-1],ae;try{ae=ug({windingRule:G.length>1?nn.POSITIVE:nn.ODD,elementType:Vs.POLYGONS,vertexSize:2,strict:!0,contours:[Q.insetPoints,...E]})}catch{ae=TY}if(!ae)throw new Error("Error generating geometry for surface");l.length===0&&this._bevel<h&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let ne=0;ne<ae.elementCount*3;ne+=3){let ue=this._buildSurfaceVert(ae,ae.elements[ne+0],j),fe=this._buildSurfaceVert(ae,ae.elements[ne+1],j),xe=this._buildSurfaceVert(ae,ae.elements[ne+2],j);M.push(ue.top,fe.top,xe.top),a===!1&&M.push(xe.bottom,fe.bottom,ue.bottom)}}this.vertexCache={}}this._buffer.shrink();let D=new _i(Uint32Array.from(M),1),T=new _i(this._buffer.positions,3),L=new _i(this._buffer.normals,3),P=new _i(this._buffer.uvs,2);T.needsUpdate=!0,L.needsUpdate=!0,P.needsUpdate=!0,D.needsUpdate=!0,this.setAttribute("position",T),this.setAttribute("normal",L),this.setAttribute("uv",P),this.setIndex(D)}_computeBufferEstimatedSize(t){return t.vertexCount*2*(2+this._bevelSegments)}_buildWall(t,e,i){let r=t[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(e,r,n),o=this._buildBevelVert(e,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}_buildSurfaceVert(t,e,i){let r=e.toString();if(r in this.vertexCache)return this.vertexCache[r];let n=t.vertices[e*2+0],s=t.vertices[e*2+1],a=(n-this._minX)/this._width,o=(s-this._minY)/this._height;this.forPathBevel&&(o=1);let l=this._buffer.get(this.forPathBevel?1:2),c=l*3,u=l*2,h={top:l+0,bottom:l+1};return this._buffer.positions[c+0]=n,this._buffer.positions[c+1]=s,this._buffer.positions[c+2]=this.forPathBevel?this._bevel:this._depth-i,this._buffer.normals[c+0]=0,this._buffer.normals[c+1]=0,this._buffer.normals[c+2]=1,this._buffer.uvs[u+0]=a,this._buffer.uvs[u+1]=o,this.forPathBevel===!1&&(this._buffer.positions[c+3]=n,this._buffer.positions[c+4]=s,this._buffer.positions[c+5]=i,this._buffer.normals[c+3]=0,this._buffer.normals[c+4]=0,this._buffer.normals[c+5]=-1,this._buffer.uvs[u+2]=a,this._buffer.uvs[u+3]=o),this.vertexCache[r]=h,h}_buildBevelVert(t,e,i,r=1,n){let s=`${e.bevelI}:${i}`;if(s in this.vertexCache&&n!==0&&n!==1&&(!n||n===this.vertexCache[s].pathBevelUCoord))return this.vertexCache[s];let[a,o]=e.boundary.vertexIndices[i],l,c,u,h;a!==o?(c=a,l=o,h=!1,u=t.continuous[c]&&t.continuous[l]):(l=a,c=(l-1+t.count)%t.count,h=t.concave[l]&&e.bevelI>0,u=t.continuous[l]||h);let d=Math.cos(e.angle),p=Math.sin(e.angle),g=i*2,x=l*2,v=c*2,b=e.boundary.vertices[g+0],w=e.boundary.vertices[g+1],M=(1-p)*this._bevel,E=(b-this._minX)/this._width,D=(w-this._minY)/this._height;this.forPathBevel&&(n!==void 0&&(E=n),D=1);let T=t.normals[x+0],L=t.normals[x+1],P=t.normals[v+0],R=t.normals[v+1];if(h){let k=P-T,K=R-L;T=T+k*(1-r),L=L+K*(1-r);let X=Math.sqrt(T*T+L*L);T/=X,L/=X}let O=this.forPathBevel?this._buffer.get(u?1:2):this._buffer.get(u?2:4),U=O*3,F=O*2,V={i,fi:l,topP:O+0,topN:O+0,bottomP:O+1,bottomN:O+1,pathBevelUCoord:n};return this._buffer.positions[U+0]=b,this._buffer.positions[U+1]=w,this._buffer.positions[U+2]=(this.forPathBevel?this._bevel:this._depth)-M,this._buffer.normals[U+0]=T*d,this._buffer.normals[U+1]=L*d,this._buffer.normals[U+2]=p,this._buffer.uvs[F+0]=E,this._buffer.uvs[F+1]=D,this.forPathBevel===!1&&(this._buffer.positions[U+3]=b,this._buffer.positions[U+4]=w,this._buffer.positions[U+5]=M,this._buffer.normals[U+3]=T*d,this._buffer.normals[U+4]=L*d,this._buffer.normals[U+5]=-p,this._buffer.uvs[F+2]=D,this._buffer.uvs[F+3]=E),u||(this.forPathBevel?(O+=1,U+=3,F+=2):(O+=2,U+=6,F+=4),V.topP=O+0,V.bottomP=O+1,this._buffer.positions[U+0]=b,this._buffer.positions[U+1]=w,this._buffer.positions[U+2]=(this.forPathBevel?this._bevel:this._depth)-M,this._buffer.normals[U+0]=P*d,this._buffer.normals[U+1]=R*d,this._buffer.normals[U+2]=p,this._buffer.uvs[F+0]=E,this._buffer.uvs[F+1]=D,this.forPathBevel===!1&&(this._buffer.positions[U+3]=b,this._buffer.positions[U+4]=w,this._buffer.positions[U+5]=M,this._buffer.normals[U+3]=P*d,this._buffer.normals[U+4]=R*d,this._buffer.normals[U+5]=-p,this._buffer.uvs[F+2]=D,this._buffer.uvs[F+3]=E)),this.vertexCache[s]=V,V}clone(){let t=new d4(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return t.userData=V3(this.userData),t}},CY=class extends ni{constructor(t,e=12,i={}){super(),this.type="ShapeGeometry",this.windingRule=nn.ODD,this.elementType=Vs.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=t,this._curveSegments=e,this._triangulationOptions=Object.assign({windingRule:nn.ODD,elementType:Vs.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let r=this._shape.extractShapePointsToFlatArray([],this._curveSegments),n=this._shape.shapeHoles.map(d=>d.extractShapePointsToFlatArray([],this._curveSegments)),s,a=!0,o=!0,l,c;for(let d=0,p=r.length/2;d<p;d++){let g=d*2,x=r[g+0],v=r[g+1];if(l!==void 0&&x!==l&&(a=!1),c!==void 0&&v!==c&&(o=!1),l=x,c=v,!a&&!o)break}if(!a&&!o)try{s=ug({contours:[r,...n],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{s=h4}let u=(s==null?void 0:s.vertexCount)??1,h=(s==null?void 0:s.elementCount)??1;if(this._positionAttribute=new _i(new Float32Array(u*3),3),this._normalAttribute=new _i(new Float32Array(u*3),3),this._uvAttribute=new _i(new Float32Array(u*2),2),this._indexAttribute=new _i(new Uint32Array(h*3),1),s){let d=1/0,p=-1/0,g=1/0,x=-1/0;for(let w=0,M=u;w<M;w++){let E=w*2,D=s.vertices[E+0],T=s.vertices[E+1];D<d&&(d=D),D>p&&(p=D),T<g&&(g=T),T>x&&(x=T)}let v=p-d,b=x-g;for(let w=0,M=u;w<M;w++){let E=w*2,D=s.vertices[E+0],T=s.vertices[E+1],L=(D-d)/v,P=(T-g)/b;this._positionAttribute.setXYZ(w,D,T,0),this._normalAttribute.setXYZ(w,0,0,1),this._uvAttribute.setXY(w,L,P)}for(let w=0,M=h;w<M;w++){let E=w*3,D=s.elements[E+0],T=s.elements[E+1],L=s.elements[E+2];this._indexAttribute.setX(E+0,D),this._indexAttribute.setX(E+1,T),this._indexAttribute.setX(E+2,L)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,((s==null?void 0:s.elementCount)??1)*3)}clone(){let t=new CY(this._shape,this._curveSegments);return t.userData=V3(this.userData),t}},DY=class extends d4{constructor(t,e,i=0,r=12,n=3,s=nn.ODD){super(t,e,i,r,n,s),this.type="ShapeGeometry"}_computeBufferEstimatedSize(t){return t.vertexCount*2*(2+this._bevelSegments)}_buildWall(t,e,i){let r=t[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(e,r,n),o=this._buildBevelVert(e,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}clone(){let t=new DY(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return t.userData=V3(this.userData),t}},J0=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){var c,u;let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:nn.ODD},t.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=t.shape??(e==null?void 0:e.shape),o=(a==null?void 0:a.roundness)??i.roundness;a!==void 0&&(a instanceof xs?(a.width!==r||a.height!==n)&&a.applySize(r,n):a=new xs(r,n).fromJSON(a),((c=t.parameters)==null?void 0:c.roundness)!==void 0&&((u=t.parameters)==null?void 0:u.roundness)>0&&a.update());let l=a??new xs(r,n);return{parameters:Object.assign(i,{width:r,height:n,depth:s,roundness:o}),shape:l}}static build(t){let{depth:e,extrudeBevelSize:i,extrudeBevelSegments:r,subdivisions:n,roundness:s,windingRule:a}=t.parameters;t.shape.roundness=s;let o;return e<=0?o=new CY(t.shape,n,{windingRule:a}):o=new DY(t.shape,e,i,n,r,a),Object.assign(o,{userData:{...t,type:"VectorGeometry"}})}},PY=Math.PI*2,f4=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},t.parameters);return i.angle=Qt.clamp(i.angle,0,360),{shape:t.shape&&t.shape instanceof xs?t.shape:new xs,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e,height:i,spikes:r,angle:n,innerRadius:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=t.parameters,c=t.shape,u=e*.5,h=i*.5,d=sSe(c,u,h,n*Math.PI/180,r,s);c.isClosed=!0,c.update();let p;return n===0?(p=new ni,p.setAttribute("position",new Wt([],3))):p=J0.create({shape:c,parameters:{subdivisions:d,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}}),Object.assign(p,{userData:{...t,type:"EllipseGeometry"}})}};function sSe(t,e,i,r,n,s){if(r>=PY)return n>30||n%4===0?(oSe(t,e,i,s),Math.round(n/4)):KH(t,r,n,e,i,s);r=Math.max(r,.001);let a={x:0,y:i},o=r+Math.PI*.5,l={x:Math.cos(o)*e,y:Math.sin(o)*i},c=Q_e({px:a.x,py:a.y,cx:l.x,cy:l.y,rx:e,ry:i,largeArcFlag:r>Math.PI,sweepFlag:!0});return n>30||n%c.length===0?aSe(t,a.x,a.y,c,n,e,i,s):KH(t,r,n,e,i,s)}function aSe(t,e,i,r,n,s,a,o){let l=Math.round(n/r.length);t.addPoint(x1(e,i));for(let c=0,u=r.length;c<u;c++){let h=r[c],d=t.points[c],p=x1(h.x,h.y);d.controls[1].position.set(h.x1,h.y1),p.controls[0].position.set(h.x2,h.y2),t.addPoint(p)}return o>0?RY(t,s,a,o):t.addPoint(x1(0,0)),l}function KH(t,e,i,r,n,s){let a=-e/i;for(let o=0;o<=i;o++){let l=a*o,c=Math.sin(l)*r,u=Math.cos(l)*n;t.addPoint(x1(c,u))}return e<PY?s>0?RY(t,r,n,s):t.addPoint(x1(0,0)):(t.removePoint(t.points[t.points.length-1]),s>0&&OY(t,r,n,s)),1}function oSe(t,e,i,r=0,n=0,s=0){let a=.5522847498,o=e*a,l=i*a;t.addPoint(h2(n-e,s,n-e,s-l,n-e,s+l)),t.addPoint(h2(n,s+i,n-o,s+i,n+o,s+i)),t.addPoint(h2(n+e,s,n+e,s+l,n+e,s-l)),t.addPoint(h2(n,s-i,n+o,s-i,n-o,s-i)),r>0&&OY(t,e,i,r)}function x1(t,e){return new y1(Qt.generateUUID(),new Oe(t,e))}function h2(t,e,i,r,n,s){let a=x1(t,e);return a.controls[0].position.set(i,r),a.controls[1].position.set(n,s),a}function RY(t,e,i,r){LY(t,e,i,r).forEach(n=>t.addPoint(n))}function OY(t,e,i,r){let n=LY(t,e,i,r),s=new xs;n.forEach(a=>s.addPoint(a)),s.isClosed=!0,t.shapeHoles.push(s)}function LY(t,e,i,r){let n=r*e/100,s=n*(Math.abs(i)/Math.abs(e)),a=new Oe(n/e,s/i),o=t.points.map(l=>{let c=l.clone();return c.uuid=Qt.generateUUID(),c}).reverse();return o.forEach(l=>{l.position.multiply(a);let c=l.controls[0].position.clone().multiply(a),u=l.controls[1].position.clone().multiply(a);l.controls[0].position.copy(u),l.controls[1].position.copy(c)}),o}var lSe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},t.parameters),r=Math.abs(i.width),n=Math.abs(i.height??r),s=Math.abs(i.depth??r),a=Math.abs(Math.min(r,s))/2;return{parameters:Object.assign(i,{width:r,height:n,depth:s,radius:a,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(t){let{width:e,height:i,depth:r,radius:n,revolutions:s,segments:a,pathRadius:o,pathType:l,pathSegments:c,cornerRadius:u,cornerSegments:h}=t.parameters,d=new IY(!1,e,i,r,n,s,a,o,l,c,u,h);return Object.assign(d,{userData:{...t,type:"HelixGeometry"}})}},QO=new f1([0,0,0],1),IY=class extends ni{constructor(t=!0,e=1,i=1,r=1,n=1,s=1,a=1,o=1,l=1,c=1,u=1,h=1){if(super(),s===0)return;let d=t&&s===1;d&&(h=0),u>100&&(u=100),u===0&&(h=0);let p=()=>new W,g=new W,x=p(),v=p(),b=p(),w,M,E,D,T,L,P,R,O=p(),U=p(),F=p(),V=p(),k=p(),K=p(),X=p(),$=p(),Y=i-2*o+.001,re=Y/s,G=Math.ceil(a*s),j=G+1,ee=Y/G,oe=-Y/2,Q=c+1,ae=2*Math.PI/c,ne=Math.PI/2/h,ue=.01,fe=Math.min((1-u/100)*o,o-ue),xe=o-fe,be=0,Ce=2,ge=h*Ce+Ce,Te=Q*ge/Ce,ce=Te+Q*j,Ue=Math.max(0,Q*(j+ge)),[ze,Xe,De]=[3,3,2].map(Ve=>Array(Ue*Ve).fill(0)),Ge=[],We=n-o;function se(Ve,Ke){let at=Math.PI/2;L=Ke*ee,R=2*Math.PI*(L%re)/re+at,L+=oe,P=Math.sin(R)*We,T=Math.cos(R)*We,t?Ve.set(T,P,L):Ve.set(T,L,P)}se(g,-1e-10),se(x,0),O.copy(g),se(g,1);let H=g.distanceTo(x),Z=d?0:xe+fe,pe=H*G+2*Z,we=fe,J=pe-Z;for(let Ve=0;Ve<=G;Ve++){se(v,Ve),$.subVectors(v,O).normalize(),O.copy(v),K.copy(v).setComponent(+t+1,0).normalize(),X.crossVectors($,K).normalize();let Ke=Ve===0,at=Ve===G,ut=Ke?3*Math.PI/2:ne,ht=Ke?we:J,$e=Ke?Q:ce,St=Ke?0:Ue-Q,Pt=$.clone().multiplyScalar(Ke?-xe:xe).add(v),Kt=$.clone().multiplyScalar(Ke?-1:1).normalize();for(let le=0;le<Q;le++){let Re=le*ae;if(U.addVectors(g.copy(K).multiplyScalar(o*Math.cos(Re)),x.copy(X).multiplyScalar(o*Math.sin(Re))),F.copy(U).normalize(),Ke||at){d||(be=St+le,[0,1,2].forEach(Ee=>{ze[be*3+Ee]=Pt.getComponent(Ee),Xe[be*3+Ee]=Kt.getComponent(Ee)}),De[be*2]=+at,De[be*2+1]=le/c),x.copy(F).multiplyScalar(fe),b.addVectors(v,x);for(let Ee=0;Ee<h;Ee++){let Qe=Ee*ne+ut;V.addVectors(g.copy($).multiplyScalar(xe*Math.sin(Qe)),x.copy(F).multiplyScalar(xe*Math.cos(Qe))),k.copy(V).normalize(),x.addVectors(b,V),V.normalize(),be=$e+Ee*Q+le,[0,1,2].forEach(pt=>{ze[be*3+pt]=x.getComponent(pt),Xe[be*3+pt]=k.getComponent(pt)});let ot=+Ke+Math.sin(Qe);De[be*2]=(ht+xe*ot)/pe,De[be*2+1]=le/c}}x.addVectors(v,U),be=Te+Ve*Q+le,[0,1,2].forEach(Ee=>{ze[be*3+Ee]=x.getComponent(Ee),Xe[be*3+Ee]=F.getComponent(Ee)}),De[be*2]=(Z+Ve*H)/pe,De[be*2+1]=le/c}}let He=j+2*h+Ce,[je,Ye]=[+d,He-1];for(let Ve=je;Ve<=Ye-1;Ve++){let Ke=d&&Ve===Ye-1;for(let at=0;at<Q-1;at++)w=Ve*Q+at,M=w+1,E=(Ke?at:w)+Q,D=(Ke?at+1:M)+Q,Ve===0?Ge.push(M,D,E):Ve===He-2?Ge.push(w,M,E):Ge.push(w,M,E,M,D,E)}this.setIndex(Ge),this.setAttribute("position",new Wt(ze,3)),this.setAttribute("normal",new Wt(Xe,3)),this.setAttribute("uv",new Wt(De,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let t=this.userData.parameters,e=Math.ceil(t.tubularSegments),i=t.radialSegments+1,r=Array.from(this.getIndex().array),n,s,a,o,l=6*(e-1)*t.radialSegments,c=e,u=c===e;for(let h=0;h<t.radialSegments;h++)n=c*i+h,s=n+1,a=(u?h:n)+i,o=(u?h+1:s)+i,r[l++]=n,r[l++]=s,r[l++]=a,r[l++]=s,r[l++]=o,r[l++]=a;return r.length=l,QO.array=r,QO.count=r.length,QO}},cSe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,detail:0,corner:0,cornerSides:4},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,detail:n,corner:s,cornerSides:a}=t.parameters,o=n===0&&s!==0?new zY(e*.5,s,a):new Oq(e*.5,n);return o.scale(1,i/e,r/e),Object.assign(o,{userData:{...t,type:"IcosahedronGeometry"}})}},zY=class extends l4{constructor(t=1,e=.2,i=4){let r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a="IcosahedronGeometry";super(n,s,a,t,e,i),this.type=a}static fromJSON(t){return new zY(t.radius,t.corner,t.cornerSides)}},uSe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){var r;(((r=t.parameters)==null?void 0:r.points)??[]).forEach(n=>{Array.isArray(n)&&(n.x=n[0],n.y=n[1])});let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{points:e,segments:i,verticalSegments:r}=t.parameters,n=new PC;n.moveTo(e[0].x,e[0].y),n.bezierCurveTo(e[1].x,e[1].y,e[2].x,e[2].y,e[3].x,e[3].y);let s=new Aq(n.extractPoints(r).shape,i);return s.rotateZ(Math.PI),Object.assign(s,{userData:{...t,type:"LatheGeometry"}})}},gd=new Ot,ZO=new Kr,d2=new W,pD=class extends lo{constructor(){super(),this.uuid=Qt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(t){let e=new Hs().getNormalMatrix(t);for(let i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(t);for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];n.normal.applyMatrix3(e).normalize();for(let s=0,a=n.vertexNormals.length;s<a;s++)n.vertexNormals[s].applyMatrix3(e).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(t){return gd.makeRotationX(t),this.applyMatrix4(gd),this}rotateY(t){return gd.makeRotationY(t),this.applyMatrix4(gd),this}rotateZ(t){return gd.makeRotationZ(t),this.applyMatrix4(gd),this}translate(t,e,i){return gd.makeTranslation(t,e,i),this.applyMatrix4(gd),this}scale(t,e,i){return gd.makeScale(t,e,i),this.applyMatrix4(gd),this}lookAt(t){return ZO.lookAt(t),ZO.updateMatrix(),this.applyMatrix4(ZO.matrix),this}fromBufferGeometry(t){let e=this,i=t.index!==null?t.index:void 0,r=t.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let n=r.position,s=r.normal,a=r.color,o=r.uv,l=r.uv2;l!==void 0&&(this.faceVertexUvs[1]=[]);for(let h=0;h<n.count;h++)e.vertices.push(new W().fromBufferAttribute(n,h)),a!==void 0&&e.colors.push(new bi().fromBufferAttribute(a,h));function c(h,d,p,g){let x=a===void 0?[]:[e.colors[h].clone(),e.colors[d].clone(),e.colors[p].clone()],v=s===void 0?[]:[new W().fromBufferAttribute(s,h),new W().fromBufferAttribute(s,d),new W().fromBufferAttribute(s,p)],b=new GU(h,d,p,v,x,g);e.faces.push(b),o!==void 0&&e.faceVertexUvs[0].push([new Oe().fromBufferAttribute(o,h),new Oe().fromBufferAttribute(o,d),new Oe().fromBufferAttribute(o,p)]),l!==void 0&&e.faceVertexUvs[1].push([new Oe().fromBufferAttribute(l,h),new Oe().fromBufferAttribute(l,d),new Oe().fromBufferAttribute(l,p)])}let u=t.groups;if(u.length>0)for(let h=0;h<u.length;h++){let d=u[h],p=d.start,g=d.count;for(let x=p,v=p+g;x<v;x+=3)i!==void 0?c(i.getX(x),i.getX(x+1),i.getX(x+2),d.materialIndex):c(x,x+1,x+2,d.materialIndex)}else if(i!==void 0)for(let h=0;h<i.count;h+=3)c(i.getX(h),i.getX(h+1),i.getX(h+2));else for(let h=0;h<n.count;h+=3)c(h,h+1,h+2);return this.computeFaceNormals(),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(d2).negate(),this.translate(d2.x,d2.y,d2.z),this}normalize(){this.computeBoundingSphere();let t=this.boundingSphere.center,e=this.boundingSphere.radius,i=e===0?1:1/e,r=new Ot;return r.set(i,0,0,-i*t.x,0,i,0,-i*t.y,0,0,i,-i*t.z,0,0,0,1),this.applyMatrix4(r),this}computeFaceNormals(){let t=new W,e=new W;for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=this.vertices[n.a],a=this.vertices[n.b],o=this.vertices[n.c];t.subVectors(o,a),e.subVectors(s,a),t.cross(e),t.normalize(),n.normal.copy(t)}}computeVertexNormals(t=!0){let e=new Array(this.vertices.length);for(let i=0,r=this.vertices.length;i<r;i++)e[i]=new W;if(t){let i=new W,r=new W;for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c];i.subVectors(c,l),r.subVectors(o,l),i.cross(r),e[a.a].add(i),e[a.b].add(i),e[a.c].add(i)}}else{this.computeFaceNormals();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];e[n.a].add(n.normal),e[n.b].add(n.normal),e[n.c].add(n.normal)}}for(let i=0,r=this.vertices.length;i<r;i++)e[i].normalize();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=n.vertexNormals;s.length===3?(s[0].copy(e[n.a]),s[1].copy(e[n.b]),s[2].copy(e[n.c])):(s[0]=e[n.a].clone(),s[1]=e[n.b].clone(),s[2]=e[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let t=0,e=this.faces.length;t<e;t++){let i=this.faces[t],r=i.vertexNormals;r.length===3?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let e=0,i=this.faces.length;e<i;e++){let r=this.faces[e];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(let n=0,s=r.vertexNormals.length;n<s;n++)r.__originalVertexNormals[n]?r.__originalVertexNormals[n].copy(r.vertexNormals[n]):r.__originalVertexNormals[n]=r.vertexNormals[n].clone()}let t=new pD;t.faces=this.faces;for(let e=0,i=this.morphTargets.length;e<i;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];let n=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(let a=0,o=this.faces.length;a<o;a++){let l=new W,c={a:new W,b:new W,c:new W};n.push(l),s.push(c)}}let r=this.morphNormals[e];t.vertices=this.morphTargets[e].vertices,t.computeFaceNormals(),t.computeVertexNormals();for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=r.faceNormals[n],l=r.vertexNormals[n];o.copy(a.normal),l.a.copy(a.vertexNormals[0]),l.b.copy(a.vertexNormals[1]),l.c.copy(a.vertexNormals[2])}}for(let e=0,i=this.faces.length;e<i;e++){let r=this.faces[e];r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Os),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Xl),this.boundingSphere.setFromPoints(this.vertices)}merge(t,e,i=0){if(!(t&&t.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);return}let r,n=this.vertices.length,s=this.vertices,a=t.vertices,o=this.faces,l=t.faces,c=this.colors,u=t.colors;e!==void 0&&(r=new Hs().getNormalMatrix(e));for(let h=0,d=a.length;h<d;h++){let p=a[h].clone();e!==void 0&&p.applyMatrix4(e),s.push(p)}for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone());for(let h=0,d=l.length;h<d;h++){let p=l[h],g,x,v=p.vertexNormals,b=p.vertexColors,w=new GU(p.a+n,p.b+n,p.c+n);w.normal.copy(p.normal),r!==void 0&&w.normal.applyMatrix3(r).normalize();for(let M=0,E=v.length;M<E;M++)g=v[M].clone(),r!==void 0&&g.applyMatrix3(r).normalize(),w.vertexNormals.push(g);w.color.copy(p.color);for(let M=0,E=b.length;M<E;M++)x=b[M],w.vertexColors.push(x.clone());w.materialIndex=p.materialIndex+i,o.push(w)}for(let h=0,d=t.faceVertexUvs.length;h<d;h++){let p=t.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let g=0,x=p.length;g<x;g++){let v=p[g],b=[];for(let w=0,M=v.length;w<M;w++)b.push(v[w].clone());this.faceVertexUvs[h].push(b)}}}mergeMesh(t){if(!(t&&t.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t);return}t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)}mergeVertices(t=4){let e={},i=[],r=[],n=Math.pow(10,t);for(let o=0,l=this.vertices.length;o<l;o++){let c=this.vertices[o],u=Math.round(c.x*n)+"_"+Math.round(c.y*n)+"_"+Math.round(c.z*n);e[u]===void 0?(e[u]=o,i.push(this.vertices[o]),r[o]=i.length-1):r[o]=r[e[u]]}let s=[];for(let o=0,l=this.faces.length;o<l;o++){let c=this.faces[o];c.a=r[c.a],c.b=r[c.b],c.c=r[c.c];let u=[c.a,c.b,c.c];for(let h=0;h<3;h++)if(u[h]===u[(h+1)%3]){s.push(o);break}}for(let o=s.length-1;o>=0;o--){let l=s[o];this.faces.splice(l,1);for(let c=0,u=this.faceVertexUvs.length;c<u;c++)this.faceVertexUvs[c].splice(l,1)}let a=this.vertices.length-i.length;return this.vertices=i,a}setFromPoints(t){this.vertices=[];for(let e=0,i=t.length;e<i;e++){let r=t[e];this.vertices.push(new W(r.x,r.y,r.z||0))}return this}sortFacesByMaterialIndex(){let t=this.faces,e=t.length;for(let o=0;o<e;o++)t[o]._id=o;function i(o,l){return o.materialIndex-l.materialIndex}t.sort(i);let r=this.faceVertexUvs[0],n=this.faceVertexUvs[1],s,a;r&&r.length===e&&(s=[]),n&&n.length===e&&(a=[]);for(let o=0;o<e;o++){let l=t[o]._id;s&&s.push(r[l]),a&&a.push(n[l])}s&&(this.faceVertexUvs[0]=s),a&&(this.faceVertexUvs[1]=a)}toJSON(){let t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),this.parameters!==void 0){let p=this.parameters;for(let g in p)p[g]!==void 0&&(t[g]=p[g]);return t}let e=[];for(let p=0;p<this.vertices.length;p++){let g=this.vertices[p];e.push(g.x,g.y,g.z)}let i=[],r=[],n={},s=[],a={},o=[],l={};for(let p=0;p<this.faces.length;p++){let g=this.faces[p],x=!0,v=!1,b=this.faceVertexUvs[0][p]!==void 0,w=g.normal.length()>0,M=g.vertexNormals.length>0,E=g.color.r!==1||g.color.g!==1||g.color.b!==1,D=g.vertexColors.length>0,T=0;if(T=c(T,0,0),T=c(T,1,x),T=c(T,2,v),T=c(T,3,b),T=c(T,4,w),T=c(T,5,M),T=c(T,6,E),T=c(T,7,D),i.push(T),i.push(g.a,g.b,g.c),i.push(g.materialIndex),b){let L=this.faceVertexUvs[0][p];i.push(d(L[0]),d(L[1]),d(L[2]))}if(w&&i.push(u(g.normal)),M){let L=g.vertexNormals;i.push(u(L[0]),u(L[1]),u(L[2]))}if(E&&i.push(h(g.color)),D){let L=g.vertexColors;i.push(h(L[0]),h(L[1]),h(L[2]))}}function c(p,g,x){return x?p|1<<g:p&~(1<<g)}function u(p){let g=p.x.toString()+p.y.toString()+p.z.toString();return n[g]!==void 0||(n[g]=r.length/3,r.push(p.x,p.y,p.z)),n[g]}function h(p){let g=p.r.toString()+p.g.toString()+p.b.toString();return a[g]!==void 0||(a[g]=s.length,s.push(p.getHex())),a[g]}function d(p){let g=p.x.toString()+p.y.toString();return l[g]!==void 0||(l[g]=o.length/2,o.push(p.x,p.y)),l[g]}return t.data={},t.data.vertices=e,t.data.normals=r,s.length>0&&(t.data.colors=s),o.length>0&&(t.data.uvs=[o]),t.data.faces=i,t}clone(){return new pD().copy(this)}copy(t){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;let e=t.vertices;for(let h=0,d=e.length;h<d;h++)this.vertices.push(e[h].clone());let i=t.colors;for(let h=0,d=i.length;h<d;h++)this.colors.push(i[h].clone());let r=t.faces;for(let h=0,d=r.length;h<d;h++)this.faces.push(r[h].clone());for(let h=0,d=t.faceVertexUvs.length;h<d;h++){let p=t.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let g=0,x=p.length;g<x;g++){let v=p[g],b=[];for(let w=0,M=v.length;w<M;w++){let E=v[w];b.push(E.clone())}this.faceVertexUvs[h].push(b)}}let n=t.morphTargets;for(let h=0,d=n.length;h<d;h++){let p={};if(p.name=n[h].name,n[h].vertices!==void 0){p.vertices=[];for(let g=0,x=n[h].vertices.length;g<x;g++)p.vertices.push(n[h].vertices[g].clone())}if(n[h].normals!==void 0){p.normals=[];for(let g=0,x=n[h].normals.length;g<x;g++)p.normals.push(n[h].normals[g].clone())}this.morphTargets.push(p)}let s=t.morphNormals;for(let h=0,d=s.length;h<d;h++){let p={};if(s[h].vertexNormals!==void 0){p.vertexNormals=[];for(let g=0,x=s[h].vertexNormals.length;g<x;g++){let v=s[h].vertexNormals[g],b={};b.a=v.a.clone(),b.b=v.b.clone(),b.c=v.c.clone(),p.vertexNormals.push(b)}}if(s[h].faceNormals!==void 0){p.faceNormals=[];for(let g=0,x=s[h].faceNormals.length;g<x;g++)p.faceNormals.push(s[h].faceNormals[g].clone())}this.morphNormals.push(p)}let a=t.skinWeights;for(let h=0,d=a.length;h<d;h++)this.skinWeights.push(a[h].clone());let o=t.skinIndices;for(let h=0,d=o.length;h<d;h++)this.skinIndices.push(o[h].clone());let l=t.lineDistances;for(let h=0,d=l.length;h<d;h++)this.lineDistances.push(l[h]);let c=t.boundingBox;c!==null&&(this.boundingBox=c.clone());let u=t.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}toBufferGeometry(){let t=new hSe().fromGeometry(this),e=new ni,i=new Float32Array(t.vertices.length*3);if(e.setAttribute("position",f2.call(new _i(i,3),t.vertices)),t.normals.length>0){let r=new Float32Array(t.normals.length*3);e.setAttribute("normal",f2.call(new _i(r,3),t.normals))}if(t.colors.length>0){let r=new Float32Array(t.colors.length*3);e.setAttribute("color",JH.call(new _i(r,3),t.colors))}if(t.uvs.length>0){let r=new Float32Array(t.uvs.length*2);e.setAttribute("uv",$H.call(new _i(r,2),t.uvs))}if(t.uvs2.length>0){let r=new Float32Array(t.uvs2.length*2);e.setAttribute("uv2",$H.call(new _i(r,2),t.uvs2))}e.groups=t.groups;for(let r in t.morphTargets){let n=[],s=t.morphTargets[r];for(let a=0,o=s.length;a<o;a++){let l=s[a],c=new Wt(l.data.length*3,3);c.name=l.name,n.push(f2.call(c,l.data))}e.morphAttributes[r]=n}if(t.skinIndices.length>0){let r=new Wt(t.skinIndices.length*4,4);e.setAttribute("skinIndex",eG.call(r,t.skinIndices))}if(t.skinWeights.length>0){let r=new Wt(t.skinWeights.length*4,4);e.setAttribute("skinWeight",eG.call(r,t.skinWeights))}return t.boundingSphere!==null&&(e.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(e.boundingBox=t.boundingBox.clone()),e}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(t){let e=new ni,i=t.geometry;if(t.isPoints||t.isLine){let r=new Wt(i.vertices.length*3,3),n=new Wt(i.colors.length*3,3);if(e.setAttribute("position",f2.call(r,i.vertices)),e.setAttribute("color",JH.call(n,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let s=new Wt(i.lineDistances.length,1);e.setAttribute("lineDistance",dSe.call(s,i.lineDistances))}i.boundingSphere!==null&&(e.boundingSphere=i.boundingSphere.clone()),i.boundingBox!==null&&(e.boundingBox=i.boundingBox.clone())}else t.isMesh&&(e=i.toBufferGeometry());return e}};pD.prototype.isGeometry=!0;var hSe=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(t){let e=[],i,r,n,s=t.faces;for(r=0;r<s.length;r++){let a=s[r];a.materialIndex!==n&&(n=a.materialIndex,i!==void 0&&(i.count=r*3-i.start,e.push(i)),i={start:r*3,materialIndex:n})}i!==void 0&&(i.count=r*3-i.start,e.push(i)),this.groups=e}fromGeometry(t){let e=t.faces,i=t.vertices,r=t.faceVertexUvs,n=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,a=t.morphTargets,o=a.length,l;if(o>0){l=[];for(let v=0;v<o;v++)l[v]={name:a[v].name,data:[]};this.morphTargets.position=l}let c=t.morphNormals,u=c.length,h;if(u>0){h=[];for(let v=0;v<u;v++)h[v]={name:c[v].name,data:[]};this.morphTargets.normal=h}let d=t.skinIndices,p=t.skinWeights,g=d.length===i.length,x=p.length===i.length;i.length>0&&e.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let v=0;v<e.length;v++){let b=e[v];this.vertices.push(i[b.a],i[b.b],i[b.c]);let w=b.vertexNormals;if(w.length===3)this.normals.push(w[0],w[1],w[2]);else{let E=b.normal;this.normals.push(E,E,E)}let M=b.vertexColors;if(M.length===3)this.colors.push(M[0],M[1],M[2]);else{let E=b.color;this.colors.push(E,E,E)}if(n===!0){let E=r[0][v];E!==void 0?this.uvs.push(E[0],E[1],E[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",v),this.uvs.push(new Oe,new Oe,new Oe))}if(s===!0){let E=r[1][v];E!==void 0?this.uvs2.push(E[0],E[1],E[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",v),this.uvs2.push(new Oe,new Oe,new Oe))}for(let E=0;E<o;E++){let D=a[E].vertices;l[E].data.push(D[b.a],D[b.b],D[b.c])}for(let E=0;E<u;E++){let D=c[E].vertexNormals[v];h[E].data.push(D.a,D.b,D.c)}g&&this.skinIndices.push(d[b.a],d[b.b],d[b.c]),x&&this.skinWeights.push(p[b.a],p[b.b],p[b.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),this}},GU=class{constructor(t,e,i,r,n,s=0){this.a=t,this.b=e,this.c=i,this.normal=r&&r.isVector3?r:new W,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new bi,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let e=0,i=t.vertexNormals.length;e<i;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(let e=0,i=t.vertexColors.length;e<i;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}};function dSe(t){return this.array.set(t),this}function JH(t){let e=this.array,i=0;for(let r=0,n=t.length;r<n;r++){let s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new bi),e[i++]=s.r,e[i++]=s.g,e[i++]=s.b}return this}function $H(t){let e=this.array,i=0;for(let r=0,n=t.length;r<n;r++){let s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new Oe),e[i++]=s.x,e[i++]=s.y}return this}function f2(t){let e=this.array,i=0;for(let r=0,n=t.length;r<n;r++){let s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new W),e[i++]=s.x,e[i++]=s.y,e[i++]=s.z}return this}function eG(t){let e=this.array,i=0;for(let r=0,n=t.length;r<n;r++){let s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new Ri),e[i++]=s.x,e[i++]=s.y,e[i++]=s.z,e[i++]=s.w}return this}var fSe=["a","b","c"];function pSe(t,e){switch(e){case"c":return t.c;case"b":return t.b;case"a":default:return t.a}}function KO(t,e,i){let r=Math.min(t,e),n=Math.max(t,e),s=r+"_"+n;return i.get(s)}function JO(t,e,i,r,n,s){let a=Math.min(t,e),o=Math.max(t,e),l=a+"_"+o,c;if(r.has(l))c=r.get(l);else{let u=i[a],h=i[o];c={a:u,b:h,newEdge:null,faces:[]},r.set(l,c)}c.faces.push(n),s[t].edges.push(c),s[e].edges.push(c)}function mSe(t,e,i,r){let n,s,a;for(n=0,s=t.length;n<s;n++)i[n]={edges:[]};for(n=0,s=e.length;n<s;n++)a=e[n],JO(a.a,a.b,t,r,a,i),JO(a.b,a.c,t,r,a,i),JO(a.c,a.a,t,r,a,i)}function p2(t,e,i,r,n){t.push(new GU(e,i,r,void 0,void 0,n))}function dx(t,e){return Math.abs(e-t)/2+Math.min(t,e)}function m2(t,e,i,r){t.push([e.clone(),i.clone(),r.clone()])}var gSe=class{constructor(t=1){this.subdivisions=t}modify(t){t instanceof ni?t=new pD().fromBufferGeometry(t):t=t.clone(),t.mergeVertices();let e=this.subdivisions;for(;e-- >0;)this._smooth(t);return t.computeFaceNormals(),t.computeVertexNormals(),t}_smooth(t){let e=new W,i,r,n,s,a,o=t.vertices,l=t.faces,c=t.faceVertexUvs[0],u=c!==void 0&&c.length>0,h=[],d=new Map;mSe(o,l,h,d);let p=[],g,x,v,b,w,M,E;for(let ue of Array.from(d.keys())){for(x=d.get(ue),v=new W,w=3/8,M=1/8,E=x.faces.length,E!=2&&(w=.5,M=0,E!=1),v.addVectors(x.a,x.b).multiplyScalar(w),e.set(0,0,0),s=0;s<E;s++){for(b=x.faces[s],a=0;a<3&&(g=o[pSe(b,fSe[a])],!(g!==x.a&&g!==x.b));a++);g&&e.add(g)}e.multiplyScalar(M),v.add(e),x.newEdge=p.length,p.push(v)}let D,T,L,P,R,O,U,F=[];for(r=0,n=o.length;r<n;r++){for(O=o[r],R=h[r].edges,i=R.length,i==3?D=3/16:i>3&&(D=3/(8*i)),T=1-i*Number(D),L=D,i<=2&&(i==2?(T=3/4,L=1/8):i==1||i==0),U=O.clone().multiplyScalar(T),e.set(0,0,0),s=0;s<i;s++)P=R[s],g=P.a!==O?P.a:P.b,e.add(g);e.multiplyScalar(Number(L)),U.add(e),F.push(U)}let V=F.concat(p),k=F.length,K,X,$,Y=[],re=[],G,j,ee,oe,Q=new Oe,ae=new Oe,ne=new Oe;for(r=0,n=l.length;r<n;r++)b=l[r],K=Number(KO(b.a,b.b,d).newEdge)+k,X=Number(KO(b.b,b.c,d).newEdge)+k,$=Number(KO(b.c,b.a,d).newEdge)+k,p2(Y,K,X,$,b.materialIndex),p2(Y,b.a,K,$,b.materialIndex),p2(Y,b.b,X,K,b.materialIndex),p2(Y,b.c,$,X,b.materialIndex),u&&(G=c[r],j=G[0],ee=G[1],oe=G[2],Q.set(dx(j.x,ee.x),dx(j.y,ee.y)),ae.set(dx(ee.x,oe.x),dx(ee.y,oe.y)),ne.set(dx(j.x,oe.x),dx(j.y,oe.y)),m2(re,Q,ae,ne),m2(re,j,Q,ne),m2(re,ee,ae,Q),m2(re,oe,ne,ae));t.vertices=V,t.faces=Y,u&&(t.faceVertexUvs[0]=re)}},Js=new W,vSe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=t.geometry??(e==null?void 0:e.geometry)??new ni().copy(new yh(100,100,100)),r;e===void 0?(i.computeBoundingBox(),i.boundingBox.getSize(Js),r={width:Js.x,height:Js.y,depth:Js.z,subdivisions:0}):r=e.parameters;let n={...r,...t.parameters};return{parameters:{width:Math.abs(n.width),height:Math.abs(n.height),depth:Math.abs(n.depth),subdivisions:Math.abs(n.subdivisions)},geometry:i}}static build(t){let{width:e,height:i,depth:r,subdivisions:n}=t.parameters,s=t.geometry??new ni().copy(new yh(100,100,100)),a=s.userData.parameters;a===void 0?(s.computeBoundingBox(),s.boundingBox.getSize(Js)):Js.set(a.width,a.height,a.depth),(e!==Js.x||i!==Js.y||r!==Js.z)&&s.scale(Js.x===0?1:e/Js.x,Js.y===0?1:i/Js.y,Js.z===0?1:r/Js.z);let o=s.originalGeometry;try{n>0?(o===void 0||(a==null?void 0:a.subdivisions)!==n)&&(o===void 0&&(o=s),s=new gSe(n).modify(o).toBufferGeometry()):(o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals())}catch{o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals()}return o!==void 0&&Object.assign(s,{originalGeometry:o}),delete t.geometry,Object.assign(s,{userData:{...t,type:"NonParametricGeometry"}})}static loadFromUrl(t,e,i){new Vq(i).load(t,r=>{let n=this.normalizeInputs({geometry:r});r.boundingBox.getSize(Js);let s=100/Js.x;Object.assign(n.parameters,{width:100,height:Js.y*s,depth:Js.z*s}),e(this.build(n))})}},UY=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},t.parameters);return{shape:t.shape&&t.shape instanceof xs?t.shape:new xs,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e,height:i,spikes:r,cornerRadius:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}=t.parameters,l=t.shape,c=e*.5,u=i*.5,h=0,d=0,p=2*Math.PI/r;for(let x=0;x<r;x++){let v=p*x,b=h+Math.sin(v)*c,w=d+Math.cos(v)*u;l.addPoint(l.createPoint(b,w))}l.isClosed=!0;for(let x=0,v=l.points.length;x<v;x++)l.points[x].roundness=n;l.roundness=n,l.update();let g=J0.create({shape:l,parameters:{roundness:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}});return Object.assign(g,{userData:{...t,type:"PolygonGeometry"}})}},ySe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,radialSegments:n,heightSegments:s,openEnded:a,cornerRadius:o,cornerSegments:l}=t.parameters,c=new bSe(e*.5,i,n,s,a,o,l);return c.scale(1,1,r/e),Object.assign(c,{userData:{...t,type:"PyramidGeometry"}})}};function aS(t,e,i){i.x=t.x*e.x,i.y=t.y,i.z=t.x*e.y}function $O(t,e,i,r,n,s){let a=e.clone().sub(t),o=i.clone().sub(t),l=a.angleTo(o);if(a.normalize(),o.normalize(),r===n){let c=a.add(o).normalize();s.copy(t).addScaledVector(c,r/Math.sin(l/2))}else{let c=a.angleTo(o);s.copy(t),s.addScaledVector(a,n/Math.sin(c)),s.addScaledVector(o,r/Math.sin(c))}}function xSe(t,e,i){let r=t.clone().sub(e),n=i.clone().sub(e);return r.projectOnVector(n),r.add(e)}var bSe=class extends ni{constructor(t=.5,e=1,i=4,r=1,n=!1,s=0,a=4){super(),i=Math.floor(Math.max(3,i)),r=Math.floor(r),a=Math.floor(a);let o=[],l=[],c=[],u=[],h=0,d=e/2,p=Math.PI/i,g=t*Math.cos(Math.PI/i),x=2*Math.PI/i,v=(i-2)*Math.PI/i,b=Math.PI-v,w=new W(0,-d,0),M=new W(0,d,0),E=new Oe(t,-d),D=new Oe(g,-d),T=new Oe(0,M.y).sub(D),L=new Oe(0,M.y).sub(E),P=new Oe(T.y,-T.x).normalize(),R=new Oe(L.y,-L.x).normalize(),O=t*Math.cos(Math.PI/i)*Math.tan((Math.PI-T.angle())/2)-1e-8;s=Math.min(s,O);let U;{let $=new W(P.x,P.y,0),Y=new W(Math.cos(x)*$.x,$.y,Math.sin(x)*$.x);U=$.angleTo(Y)}let F=s/Math.tan((Math.PI-T.angle())/2),V=s/Math.tan((Math.PI-U)/2),k=new W;if(!n){l.push(w.x,w.y,w.z),c.push(0,-1,0),u.push(0,0);let $=h++,Y=[],re=E.clone(),G=F/Math.cos(Math.PI/i);re.x-=G;for(let j=0;j<i;j++){let ee=j/i*Math.PI*2+p,oe=new Oe(Math.sin(ee),Math.cos(ee));aS(re,oe,k),l.push(k.x,k.y,k.z),c.push(0,-1,0),u.push(0,0),Y.push(h++)}for(let j=0;j<Y.length;j++)o.push(Y[j],$,Y[(j+1)%Y.length])}{let $=new W,Y=new W,re=new W,G=new W,j=new W,ee=new W;for(let oe=0;oe<i;oe++){let Q=oe/i*Math.PI*2+p,ae=(oe+.5)/i*Math.PI*2+p,ne=(oe+1)/i*Math.PI*2+p,ue=new Oe(Math.sin(Q),Math.cos(Q)),fe=new Oe(Math.sin(ae),Math.cos(ae)),xe=new Oe(Math.sin(ne),Math.cos(ne));aS(E,ue,Y),aS(E,xe,re),aS(P,fe,$),$O(M,Y,re,V,V,G),l.push(G.x,G.y,G.z),$O(Y,M,re,V,F,j),l.push(j.x,j.y,j.z),$O(re,Y,M,F,V,ee),l.push(ee.x,ee.y,ee.z),c.push($.x,$.y,$.z),c.push($.x,$.y,$.z),c.push($.x,$.y,$.z),u.push(0,0),u.push(0,0),u.push(0,0);let be=h++,Ce=h++,ge=h++;if(o.push(be,Ce,ge),s>0){{let Ue=Y.clone().add(re).multiplyScalar(.5),ze=M.clone().sub(Ue).normalize(),Xe=w.clone().sub(Ue).normalize().add(ze).normalize().multiplyScalar(-1),De=ee.clone().sub(j);K(Ue,De,Xe,T.angle())}let Te,ce;{let Ue=new W;aS(R,xe,Ue);let ze=ee.clone().add(G).multiplyScalar(.5);ze=xSe(ze,re,M);let Xe=ee.clone().sub(G);[Te,ce]=K(ze,Xe,Ue,U,G.y)}{let Ue=Te,ze=Ue.clone().setY(0).normalize(),Xe=new W(0,-1,0),De=ze.clone().cross(Xe);X(Ue,ze,Xe,De)}{let Ue=T.angle(),ze=Math.PI-Ue,Xe=M.clone();Xe.y-=s/Math.sin(Ue-Math.PI/2);let De=new W,Ge=[];for(let se=0;se<a;se++){let H=[],Z=Math.PI/2-ze*se/a,pe=Math.cos(Z),we=Math.sin(Z),J=ae;for(let He=0;He<=se;He++){let je=Math.cos(J),Ye=Math.sin(J);$.x=pe*Ye,$.y=we,$.z=pe*je,De.copy(Xe).addScaledVector($,s),l.push(De.x,De.y,De.z),c.push($.x,$.y,$.z),u.push(0,0),H.push(h++),J+=Math.PI*2/se/i}Ge.push(H)}ce.reverse(),Ge.push(ce);let We=Ge.length-1;for(let se=0;se<We;se++){let H=Ge[se],Z=Ge[se+1],pe=H.length-1;o.push(Z[1],H[0],Z[0]);for(let we=1;we<=pe;we++)o.push(H[we],H[we-1],Z[we]),o.push(Z[we+1],H[we],Z[we])}}}}}this.setIndex(o),this.setAttribute("position",new Wt(l,3)),this.setAttribute("normal",new Wt(c,3)),this.setAttribute("uv",new Wt(u,2));function K($,Y,re,G,j){let ee=-G/2,oe=(Math.PI-G)/2,Q=Y.clone().normalize().cross(re);$.addScaledVector(re,-s/Math.sin(oe));let ae=new W,ne=new W,ue=1,fe=h,xe=[];for(let be=0;be<=a;be++){let Ce=ee+be/a*G;ne.set(0,0,0),ne.addScaledVector(Q,Math.sin(Ce)),ne.addScaledVector(re,Math.cos(Ce));for(let ge=0;ge<=ue;ge++){let Te=ge/ue-.5;if(ae.copy($),ae.addScaledVector(Y,Te),ae.addScaledVector(ne,s),j!=null){let ce=Math.max(0,ae.y-j);ae.addScaledVector(Y,-ce/Y.y)}l.push(ae.x,ae.y,ae.z),c.push(ne.x,ne.y,ne.z),u.push(0,0),ge===0&&xe.push(h),h++}}for(let be=0;be<a;be++)for(let Ce=0;Ce<ue;Ce++){let ge=fe+Ce+(ue+1)*be,Te=ge+(ue+1),ce=Te+1,Ue=ge+1;o.push(ge,Te,Ue),o.push(Te,ce,Ue)}return[$.clone().addScaledVector(Y,.5),xe]}function X($,Y,re,G){let j=Math.PI/2,ee=L.angle()-j,oe=[],Q=new W,ae=new W;for(let ue=0;ue<=a;ue++){let fe=[],xe=ue/a;for(let be=0;be<=ue;be++){let Ce=((ue?be/ue:0)-.5)*b,ge=Math.cos(Ce),Te=Math.sin(Ce),ce=Math.atan(Math.tan(ee)*ge),Ue=(j+ce)*xe,ze=Math.cos(Ue),Xe=Math.sin(Ue);Q.set(0,0,0),Q.addScaledVector(Y,Xe*ge),Q.addScaledVector(re,ze),Q.addScaledVector(G,Xe*Te),ae.copy($).addScaledVector(Q,s),l.push(ae.x,ae.y,ae.z),c.push(Q.x,Q.y,Q.z),u.push(0,0),fe.push(h++)}oe.push(fe)}let ne=oe.length-1;for(let ue=0;ue<ne;ue++){let fe=oe[ue],xe=oe[ue+1],be=fe.length-1;o.push(fe[0],xe[1],xe[0]);for(let Ce=1;Ce<=be;Ce++)o.push(fe[Ce-1],fe[Ce],xe[Ce]),o.push(fe[Ce],xe[Ce+1],xe[Ce])}}}},p4=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},t.parameters),r=Object.assign((e==null?void 0:e.ui)??{enabledIndieCorners:!1},t.ui);return{shape:t.shape&&t.shape instanceof xs?t.shape:new xs,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:r}}static build(t){let e=t.shape,{width:i,height:r,cornerRadius:n,cornerType:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=t.parameters,c={x:i*.5,y:r*.5},u={x:-c.x,y:-c.y},h={x:c.x,y:c.y};function d(E,D,T){return D>i&&T>r?Math.min(E*i/D,E*r/T):D>i?E*i/D:T>r?E*r/T:E}let p=[];p[0]=n[0]===0?0:d(n[0],n[0]+n[3],n[0]+n[1]),p[1]=n[1]===0?0:d(n[1],n[1]+n[2],n[1]+n[0]),p[2]=n[2]===0?0:d(n[2],n[2]+n[1],n[2]+n[3]),p[3]=n[3]===0?0:d(n[3],n[3]+n[0],n[3]+n[2]);let g=u.x,x=h.x,v=h.y,b=u.y;e.addPoint(e.createPoint(g,v)),e.addPoint(e.createPoint(x,v)),e.addPoint(e.createPoint(x,b)),e.addPoint(e.createPoint(g,b)),e.isClosed=!0;let w=!0;for(let E=0,D=e.points.length;E<D;E++)e.points[E].roundness=p[E],E>0&&p[E]!==p[E-1]&&(w=!1);w&&(e.roundness=p[0]),e.useCubicForRoundedCorners=s!==1,e.update();let M=J0.create({shape:e,parameters:{depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(M,{userData:{...t,type:"RectangleGeometry"}})}},_Se=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},t.parameters);return i.thetaLength=Qt.clamp(i.thetaLength,0,180),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e=100,height:i=e,depth:r=e,widthSegments:n=64,heightSegments:s=64,phiStart:a,phiLength:o,thetaStart:l,thetaLength:c}=t.parameters,u;return c===0?(u=new ni,u.setAttribute("position",new Wt([],3))):u=new p1(.5*e,n,s,a,o,l,c*Qt.DEG2RAD),u.scale(1,i/e,r/e),Object.assign(u,{userData:{...t,type:"SphereGeometry"}})}},SSe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0,widthSegments:8,heightSegments:8},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(t){let{width:e=100,height:i=e,widthSegments:r=8,heightSegments:n=8}=t.parameters,s=new jd(e,i,r,n);return s.scale(1,1,1),Object.assign(s,{userData:{...t,type:"PlaneGeometry"}})}},wSe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,angle:90,cornerRadius:24,cornerSegments:8},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,angle:n,cornerRadius:s,cornerSegments:a}=t.parameters,o=new MSe(e,i,r,n,s,a);return Object.assign(o,{userData:{...t,type:"BackdropGeometry"}})}},MSe=class extends ni{constructor(t=1,e=1,i=1,r=90,n=10,s=24){super(),this.type="BackdropGeometry";let a=[],o=[],l=[],c=.001;n==0&&(s=1),s=Math.max(1,Math.floor(s)),n=Math.min(n,100),r=Math.min(180-c,r),r*=Math.PI/180;let u=[],h=Math.PI/2,d=(ue=0,fe=0,xe=0)=>new W(ue,fe,xe),p=d(),g=d(),[x,v,b]=[e/2,t/2,i/2],w=-v,M=+v,[E,D,T]=[d(w,-x,+b),d(w,-x,-b),d(w,+x,-b)],L=(ue,fe=!1)=>Math.sin(ue-Math.PI/(1+ +fe)),P=(ue,fe=!1)=>Math.cos(ue-Math.PI/(1+ +fe));T.y=Math.sin(r)*e-x;let R=Math.cos(r)*e-b,O=E.z-c;r<=h?(T.z=Math.min(R,O),T.z==O&&(T.y-=(R-O)/Math.tan(h-r))):D.z=Math.min(D.z-R-b,E.z-c),p.subVectors(E,D),g.subVectors(T,D);let U=Math.min(p.length(),g.length())*n/100,F=U*Math.tan(r/2),V=U/Math.cos(r/2),k=p.clone().normalize().add(g.normalize()).setLength(V).add(D);p.set(0,L(r,!0),P(r,!0)),u.push([T,p.clone()]);let K=(Math.PI-r)/s;for(let ue=0;ue<=s;ue++){let fe=h+r+ue*K;p.set(0,Math.sin(fe)*F,Math.cos(fe)*F),p.add(k),g.set(0,L(fe),P(fe)),u.push([p.clone(),g.clone()])}u.push([E,d(0,1,0)]);let X=Math.sin(K/2)*F*2,$=u.length-1,Y=u[0][0].distanceTo(u[1][0]),re=u[$-1][0].distanceTo(u[$][0]),G=Y+X*s+re;u[0].push(1);for(let ue=0;ue<=s;ue++)u[ue+1].push(1-(Y+ue*X)/G);u[$].push(0);let[j,ee,oe]=u[0],Q,ae,ne;for(let ue=1;ue<u.length;ue++)[Q,ae,ne]=u[ue],a.push(w,j.y,j.z,w,Q.y,Q.z,M,j.y,j.z,M,j.y,j.z,w,Q.y,Q.z,M,Q.y,Q.z),o.push(0,ee.y,ee.z,0,ae.y,ae.z,0,ee.y,ee.z,0,ee.y,ee.z,0,ae.y,ae.z,0,ae.y,ae.z),l.push(0,oe,0,ne,1,oe,1,oe,0,ne,1,ne),[j,ee,oe]=[Q,ae,ne];this.setAttribute("position",new Wt(a,3)),this.setAttribute("normal",new Wt(o,3)),this.setAttribute("uv",new Wt(l,2))}},BY=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},t.parameters);return{shape:t.shape&&t.shape instanceof xs?t.shape:new xs,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e,height:i,innerRadiusPercent:r,spikes:n,cornerRadius:s,angle:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}=t.parameters,u=t.shape,h=e*.5,d=i*.5,p=0,g=0,x=a*Math.PI/360/n,v=Math.PI/2*3*-1,b=h*r/100,w=d*r/100;if(n===3&&r===50){x=2*Math.PI/n;for(let E=0;E<n;E++){let D=x*E,T=p+Math.sin(D)*h,L=g+Math.cos(D)*d;u.addPoint(u.createPoint(T,L))}}else for(let E=0;E<n;E++){let D=p+Math.cos(v)*h,T=g+Math.sin(v)*d;u.addPoint(u.createPoint(D,T)),v+=x,D=p+Math.cos(v)*b,T=g+Math.sin(v)*w,u.addPoint(u.createPoint(D,T)),v+=x}u.isClosed=!0;for(let E=0,D=u.points.length;E<D;E++)u.points[E].roundness=s;u.roundness=s,u.update();let M=J0.create({shape:u,parameters:{roundness:s,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}});return Object.assign(M,{userData:{...t,type:"StarGeometry"}})}},ESe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e,height:i}=t.parameters,r=new jd(e,i);return Object.assign(r,{userData:{...t,type:"TextFrameGeometry"}})}},ASe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},t.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width);i.shapeBlendNode&&(n=r);let s=Math.round(Math.abs(i.depth??i.width*.25));return{parameters:Object.assign(i,{width:r,height:n,depth:s})}}static build(t){let{width:e,height:i,depth:r,radialSegments:n,tubularSegments:s,arc:a,cornerRadius:o,cornerSegments:l}=t.parameters,c=TSe(e,i,r,e*.5,a,s,0,0,n,o,l);return c.scale(1,i/e,1),Object.assign(c,{userData:{...t,type:"TorusGeometry"}})}};function TSe(t,e,i,r,n,s,a,o,l,c,u){[e,i]=[i,e],a=e/2;let h=Qt.clamp(n/360,0,1);if(h===0){let d=new ni;return d.setAttribute("position",new Wt([],3)),d}return h===1&&(c=0),new IY(!0,t,e,i,r,h,s,a,o,l,c,u)}var CSe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??i.width*.125})}}static build(t){let{width:e,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a}=t.parameters,o=e*.5;o!==i&&(o-=i);let l=new Iq(o,i,r,n,s,a);return Object.assign(l,{userData:{...t,type:"TorusKnotGeometry"}})}},DSe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},t.parameters);return{shape:t.shape&&t.shape instanceof xs?t.shape:new xs,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e=100,height:i,cornerRadius:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,isRect:o}=t.parameters,l=t.shape,c=e*.5,u=i*.5;o?(l.addPoint(l.createPoint(-c,u)),l.addPoint(l.createPoint(c,-u)),l.addPoint(l.createPoint(-c,-u))):(l.addPoint(l.createPoint(0,u)),l.addPoint(l.createPoint(c,-u)),l.addPoint(l.createPoint(-c,-u))),l.isClosed=!0;for(let d=0,p=l.points.length;d<p;d++)l.points[d].roundness=r;l.roundness=r,l.update();let h=J0.create({shape:l,parameters:{roundness:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a}});return Object.assign(h,{userData:{...t,type:"TriangleGeometry"}})}};function PSe(t,e){let i=2*Math.PI;return(t%i+i)%i===(e%i+i)%i}function RSe(t){return/^(rgba)?\(\s*(\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(t.toLowerCase())}function OSe(t,e,i){let r,n,s,a=Math.floor(t*6),o=t*6-a,l=i*(1-e),c=i*(1-o*e),u=i*(1-(1-o)*e);switch(a%6){case 0:r=i,n=u,s=l;break;case 1:r=c,n=i,s=l;break;case 2:r=l,n=i,s=u;break;case 3:r=l,n=c,s=i;break;case 4:r=u,n=l,s=i;break;case 5:default:r=i,n=l,s=c;break}return{r:r*255,g:n*255,b:s*255}}function LSe(t,e,i){t/=255,e/=255,i/=255;let r=Math.max(t,e,i),n=Math.min(t,e,i),s=r,a=r-n,o=r==0?0:a/r,l;if(r==n)l=0;else{switch(r){case t:l=(e-i)/a+(e<i?6:0);break;case e:l=(i-t)/a+2;break;case i:default:l=(t-e)/a+4;break}l/=6}return{h:l,s:o,v:s}}function ISe(t){return t=Math.floor(t),{r:t>>16&255,g:t>>8&255,b:t&255}}function zSe(t,e,i){return(t<<16)+(e<<8)+i}function USe(t,e,i){return t=Math.round(t),e=Math.round(e),i=Math.round(i),"#"+[t,e,i].map(r=>r.toString(16).padStart(2,"0")).join("").toUpperCase()}function BSe(t){let e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,(r,n,s,a)=>String(n+n+s+s+a+a));let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}var NSe={parseRgba:RSe,hsvToRgb:OSe,rgbToHsv:LSe,hexToRgb:ISe,rgbToHex:zSe,rgbToHexString:USe,hexStringToRgb:BSe},FSe=class{add(t,e,i){if(typeof arguments[0]!="string")for(let r in arguments[0])this.add(r,arguments[0][r],arguments[1]);else(Array.isArray(t)?t:[t]).forEach(function(r){this[r]=this[r]||[],e&&this[r][i?"unshift":"push"](e)},this)}run(t,e){this[t]=this[t]||[],this[t].forEach(function(i){i.call(e&&e.context?e.context:e,e)})}},kSe=class{constructor(t){this.jsep=t,this.registered={}}register(...t){t.forEach(e=>{if(typeof e!="object"||!e.name||!e.init)throw new Error("Invalid JSEP plugin format");this.registered[e.name]||(e.init(this.jsep),this.registered[e.name]=e)})}},bt=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+bt.version}static addUnaryOp(t){return bt.max_unop_len=Math.max(t.length,bt.max_unop_len),bt.unary_ops[t]=1,bt}static addBinaryOp(t,e,i){return bt.max_binop_len=Math.max(t.length,bt.max_binop_len),bt.binary_ops[t]=e,i?bt.right_associative.add(t):bt.right_associative.delete(t),bt}static addIdentifierChar(t){return bt.additional_identifier_chars.add(t),bt}static addLiteral(t,e){return bt.literals[t]=e,bt}static removeUnaryOp(t){return delete bt.unary_ops[t],t.length===bt.max_unop_len&&(bt.max_unop_len=bt.getMaxKeyLen(bt.unary_ops)),bt}static removeAllUnaryOps(){return bt.unary_ops={},bt.max_unop_len=0,bt}static removeIdentifierChar(t){return bt.additional_identifier_chars.delete(t),bt}static removeBinaryOp(t){return delete bt.binary_ops[t],t.length===bt.max_binop_len&&(bt.max_binop_len=bt.getMaxKeyLen(bt.binary_ops)),bt.right_associative.delete(t),bt}static removeAllBinaryOps(){return bt.binary_ops={},bt.max_binop_len=0,bt}static removeLiteral(t){return delete bt.literals[t],bt}static removeAllLiterals(){return bt.literals={},bt}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(t){this.expr=t,this.index=0}static parse(t){return new bt(t).parse()}static getMaxKeyLen(t){return Math.max(0,...Object.keys(t).map(e=>e.length))}static isDecimalDigit(t){return t>=48&&t<=57}static binaryPrecedence(t){return bt.binary_ops[t]||0}static isIdentifierStart(t){return t>=65&&t<=90||t>=97&&t<=122||t>=128&&!bt.binary_ops[String.fromCharCode(t)]||bt.additional_identifier_chars.has(String.fromCharCode(t))}static isIdentifierPart(t){return bt.isIdentifierStart(t)||bt.isDecimalDigit(t)}throwError(t){let e=new Error(t+" at character "+this.index);throw e.index=this.index,e.description=t,e}runHook(t,e){if(bt.hooks[t]){let i={context:this,node:e};return bt.hooks.run(t,i),i.node}return e}searchHook(t){if(bt.hooks[t]){let e={context:this};return bt.hooks[t].find(function(i){return i.call(e.context,e),e.node}),e.node}}gobbleSpaces(){let t=this.code;for(;t===bt.SPACE_CODE||t===bt.TAB_CODE||t===bt.LF_CODE||t===bt.CR_CODE;)t=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let t=this.gobbleExpressions(),e=t.length===1?t[0]:{type:bt.COMPOUND,body:t};return this.runHook("after-all",e)}gobbleExpressions(t){let e=[],i,r;for(;this.index<this.expr.length;)if(i=this.code,i===bt.SEMCOL_CODE||i===bt.COMMA_CODE)this.index++;else if(r=this.gobbleExpression())e.push(r);else if(this.index<this.expr.length){if(i===t)break;this.throwError('Unexpected "'+this.char+'"')}return e}gobbleExpression(){let t=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",t)}gobbleBinaryOp(){this.gobbleSpaces();let t=this.expr.substr(this.index,bt.max_binop_len),e=t.length;for(;e>0;){if(bt.binary_ops.hasOwnProperty(t)&&(!bt.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!bt.isIdentifierPart(this.expr.charCodeAt(this.index+t.length))))return this.index+=e,t;t=t.substr(0,--e)}return!1}gobbleBinaryExpression(){let t,e,i,r,n,s,a,o,l;if(s=this.gobbleToken(),!s||(e=this.gobbleBinaryOp(),!e))return s;for(n={value:e,prec:bt.binaryPrecedence(e),right_a:bt.right_associative.has(e)},a=this.gobbleToken(),a||this.throwError("Expected expression after "+e),r=[s,n,a];e=this.gobbleBinaryOp();){if(i=bt.binaryPrecedence(e),i===0){this.index-=e.length;break}n={value:e,prec:i,right_a:bt.right_associative.has(e)},l=e;let c=u=>n.right_a&&u.right_a?i>u.prec:i<=u.prec;for(;r.length>2&&c(r[r.length-2]);)a=r.pop(),e=r.pop().value,s=r.pop(),t={type:bt.BINARY_EXP,operator:e,left:s,right:a},r.push(t);t=this.gobbleToken(),t||this.throwError("Expected expression after "+l),r.push(n,t)}for(o=r.length-1,t=r[o];o>1;)t={type:bt.BINARY_EXP,operator:r[o-1].value,left:r[o-2],right:t},o-=2;return t}gobbleToken(){let t,e,i,r;if(this.gobbleSpaces(),r=this.searchHook("gobble-token"),r)return this.runHook("after-token",r);if(t=this.code,bt.isDecimalDigit(t)||t===bt.PERIOD_CODE)return this.gobbleNumericLiteral();if(t===bt.SQUOTE_CODE||t===bt.DQUOTE_CODE)r=this.gobbleStringLiteral();else if(t===bt.OBRACK_CODE)r=this.gobbleArray();else{for(e=this.expr.substr(this.index,bt.max_unop_len),i=e.length;i>0;){if(bt.unary_ops.hasOwnProperty(e)&&(!bt.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!bt.isIdentifierPart(this.expr.charCodeAt(this.index+e.length)))){this.index+=i;let n=this.gobbleToken();return n||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:bt.UNARY_EXP,operator:e,argument:n,prefix:!0})}e=e.substr(0,--i)}bt.isIdentifierStart(t)?(r=this.gobbleIdentifier(),bt.literals.hasOwnProperty(r.name)?r={type:bt.LITERAL,value:bt.literals[r.name],raw:r.name}:r.name===bt.this_str&&(r={type:bt.THIS_EXP})):t===bt.OPAREN_CODE&&(r=this.gobbleGroup())}return r?(r=this.gobbleTokenProperty(r),this.runHook("after-token",r)):this.runHook("after-token",!1)}gobbleTokenProperty(t){this.gobbleSpaces();let e=this.code;for(;e===bt.PERIOD_CODE||e===bt.OBRACK_CODE||e===bt.OPAREN_CODE||e===bt.QUMARK_CODE;){let i;if(e===bt.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==bt.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),e=this.code}this.index++,e===bt.OBRACK_CODE?(t={type:bt.MEMBER_EXP,computed:!0,object:t,property:this.gobbleExpression()},this.gobbleSpaces(),e=this.code,e!==bt.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):e===bt.OPAREN_CODE?t={type:bt.CALL_EXP,arguments:this.gobbleArguments(bt.CPAREN_CODE),callee:t}:(e===bt.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),t={type:bt.MEMBER_EXP,computed:!1,object:t,property:this.gobbleIdentifier()}),i&&(t.optional=!0),this.gobbleSpaces(),e=this.code}return t}gobbleNumericLiteral(){let t="",e,i;for(;bt.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(this.code===bt.PERIOD_CODE)for(t+=this.expr.charAt(this.index++);bt.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(e=this.char,e==="e"||e==="E"){for(t+=this.expr.charAt(this.index++),e=this.char,(e==="+"||e==="-")&&(t+=this.expr.charAt(this.index++));bt.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);bt.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+t+this.char+")")}return i=this.code,bt.isIdentifierStart(i)?this.throwError("Variable names cannot start with a number ("+t+this.char+")"):(i===bt.PERIOD_CODE||t.length===1&&t.charCodeAt(0)===bt.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:bt.LITERAL,value:parseFloat(t),raw:t}}gobbleStringLiteral(){let t="",e=this.index,i=this.expr.charAt(this.index++),r=!1;for(;this.index<this.expr.length;){let n=this.expr.charAt(this.index++);if(n===i){r=!0;break}else if(n==="\\")switch(n=this.expr.charAt(this.index++),n){case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=n}else t+=n}return r||this.throwError('Unclosed quote after "'+t+'"'),{type:bt.LITERAL,value:t,raw:this.expr.substring(e,this.index)}}gobbleIdentifier(){let t=this.code,e=this.index;for(bt.isIdentifierStart(t)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(t=this.code,bt.isIdentifierPart(t));)this.index++;return{type:bt.IDENTIFIER,name:this.expr.slice(e,this.index)}}gobbleArguments(t){let e=[],i=!1,r=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let n=this.code;if(n===t){i=!0,this.index++,t===bt.CPAREN_CODE&&r&&r>=e.length&&this.throwError("Unexpected token "+String.fromCharCode(t));break}else if(n===bt.COMMA_CODE){if(this.index++,r++,r!==e.length){if(t===bt.CPAREN_CODE)this.throwError("Unexpected token ,");else if(t===bt.CBRACK_CODE)for(let s=e.length;s<r;s++)e.push(null)}}else if(e.length!==r&&r!==0)this.throwError("Expected comma");else{let s=this.gobbleExpression();(!s||s.type===bt.COMPOUND)&&this.throwError("Expected comma"),e.push(s)}}return i||this.throwError("Expected "+String.fromCharCode(t)),e}gobbleGroup(){this.index++;let t=this.gobbleExpressions(bt.CPAREN_CODE);if(this.code===bt.CPAREN_CODE)return this.index++,t.length===1?t[0]:t.length?{type:bt.SEQUENCE_EXP,expressions:t}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:bt.ARRAY_EXP,elements:this.gobbleArguments(bt.CBRACK_CODE)}}},VSe=new FSe;Object.assign(bt,{hooks:VSe,plugins:new kSe(bt),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});bt.max_unop_len=bt.getMaxKeyLen(bt.unary_ops);bt.max_binop_len=bt.getMaxKeyLen(bt.binary_ops);var G1=t=>new bt(t).parse(),HSe=Object.getOwnPropertyNames(bt);HSe.forEach(t=>{G1[t]===void 0&&t!=="prototype"&&(G1[t]=bt[t])});G1.Jsep=bt;var GSe="ConditionalExpression",jSe={name:"ternary",init(t){t.hooks.add("after-expression",function(e){if(e.node&&this.code===t.QUMARK_CODE){this.index++;let i=e.node,r=this.gobbleExpression();if(r||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===t.COLON_CODE){this.index++;let n=this.gobbleExpression();if(n||this.throwError("Expected expression"),e.node={type:GSe,test:i,consequent:r,alternate:n},i.operator&&t.binary_ops[i.operator]<=.9){let s=i;for(;s.right.operator&&t.binary_ops[s.right.operator]<=.9;)s=s.right;e.node.test=s.right,s.right=e.node,e.node=i}}else this.throwError("Expected :")}})}};G1.plugins.register(jSe);function Q3(t){return{all:t=t||new Map,on:function(e,i){var r=t.get(e);r?r.push(i):t.set(e,[i])},off:function(e,i){var r=t.get(e);r&&(i?r.splice(r.indexOf(i)>>>0,1):t.set(e,[]))},emit:function(e,i){var r=t.get(e);r&&r.slice().map(function(n){n(i)}),(r=t.get("*"))&&r.slice().map(function(n){n(e,i)})}}}var NY=class{constructor(t,e,i){var r;this.id=t,this.userAPI=e,this.result=void 0,this.error="null",this.isPrefetched=!1,this.isLoading=!1,this.isLoaded=!1,this.prefetchPromise=new Promise(n=>n()),this.emitter=Q3(),this._innerCallUserAPI=async n=>{var s,a,o;this.emitter.emit("start",{userAPIId:this.id}),this.isLoading=!0,this.isLoading=!1;try{this.result=await QSe(this.userAPI,n),this.error="null",this.emitter.emit("success",{userAPIId:this.id})}catch(l){let c=((o=(a=(s=l.message)==null?void 0:s.split("_:_"))==null?void 0:a[0])==null?void 0:o.replace("status:",""))??"null";this.error=c,this.result=null,this.emitter.emit("error",{userAPIId:this.id})}this.isLoading=!1,this.isPrefetched=!0,this.isLoaded=!0},((r=e==null?void 0:e.integration)==null?void 0:r.type)==="OpenAI"?this.result={content:""}:e.method==="GET"&&e.url!==""&&(this.prefetchPromise=this.prefetch(i)),this._debouncedCallUserAPI=this._innerCallUserAPI,this._updateDebouncedCallUserAPI(),this._debouncedPrefetch=Ow(this.prefetch,1e3,{trailing:!0})}_updateDebouncedCallUserAPI(){this._debouncedCallUserAPI=this.userAPI.debounce!==void 0&&this.userAPI.debounce>0?Ow(this._innerCallUserAPI,this.userAPI.debounce,{leading:!0,trailing:!0}):this._innerCallUserAPI}async prefetch(t){await this.callUserAPI(t)}async callUserAPI(t){await this._debouncedCallUserAPI(t)}update(t,e,i=!0){this.userAPI=t,this._updateDebouncedCallUserAPI(),this.userAPI.url!==""&&this.userAPI.method==="GET"&&i&&this._debouncedPrefetch(e)}retrieveValue(t){if(this.result)try{return ra.zoom(this.result,t)}catch(e){console.error(e)}}retrieveZoomedKeyValues(t){if(this.result){let e=t&&t.length?ra.zoom(this.result,t):this.result;if(YSe(e))return Object.entries(e);if(XSe(e))return e.map((i,r)=>[r.toString(),i]);throw qSe(e)?new Error("This path points to a value, use retrieveValue() instead. "+(t==null?void 0:t.join("."))):new Error("Path error"+(t==null?void 0:t.join(".")))}}dispose(){}on(t,e){this.emitter.on(t,e)}off(t,e){this.emitter.off(t,e)}get autostart(){return this.userAPI.autoStart}};function WSe(t){let e=new Headers;return t.headers.forEach(i=>{i.data.key!==""&&e.append(i.data.key,i.data.value)}),e}function qSe(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||t===null}function XSe(t){return Array.isArray(t)}function YSe(t){return typeof t=="object"&&t!==null}async function QSe(t,e,i=new AbortController){var l,c,u,h;let r,n=t.url,s=((l=t.proxy)==null?void 0:l.enabled)??!1,a;if(((c=t.integration)==null?void 0:c.type)==="OpenAI"){let d=US(t.integration.prompt===""?[]:JSON.parse(t.integration.prompt),e),p=t.integration.behavior===""?[]:US(JSON.parse(t.integration.behavior),e);a=`{
		"model": "${t.integration.model}",
		"messages": [${t.integration.useBehavior?`
		{
			"role": "system",
			"content": "${p}"
		},`:""}
		{
			"role": "user",
			"content": "${d}"
		}
		]
	}`}if(s){n=`https://apis.spline.design/file/${t.proxy.fileId}/external-api/request?uuidexternalapi=${t.proxy.proxyId}`;let d;a!==void 0?d=a:t.method==="POST"&&t.body&&(d=US(JSON.parse(t.body),e)),d!==void 0&&(n+=`&data=${encodeURIComponent(d.replace(/(\r\n|\n|\r|\t)/gm,""))}`)}else((u=t.integration)==null?void 0:u.type)==="OpenAI"?r=a:t.method==="POST"&&t.body&&(r=US(JSON.parse(t.body),e));let o=await fetch(n,{method:s?"GET":t.method,headers:s?void 0:WSe(t),signal:i.signal,body:r});if(!o.ok)throw new Error("status:"+o.status+"_:_"+o.statusText);if(((h=t.integration)==null?void 0:h.type)==="OpenAI"){let d=await o.json();return s&&(d=d.response),{content:d.choices[0].message.content}}else{let d=await o.json();return s&&(d=d.response),d}}var FY=(t,e)=>{if(typeof t=="string"){let i=e.getVariable(t);if(i)return FY(i,e)}return to.isBoolean(t)?to.getDisplayedValue(t).toLowerCase():to.getDisplayedValue(t)},US=(t,e)=>t.map((i,r)=>{if("text"in i)return i.text;if("type"in i){if(i.type==="paragraph")return(r>0?`
`:"")+US(i.children,e);if(i.type==="variable"){let n=e.getVariable(i.variableId);if(n!==void 0)return FY(n,e)}}return""}).join(""),ZSe=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],KSe=["0","1","2","3","4","5","6","7","8","9","."],JSe=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function $Se(t){return typeof t!="string"?!1:!isNaN(t)&&!isNaN(parseFloat(t))}G1.addBinaryOp("^",11,!0);function kY(t,e,i="number"){let r="";for(let a=0;a<t.length;a++){let o=t[a];if("objType"in o&&o.objType==="api"){let l=JSON.parse(o.id),c=l[0],u=e.getUserAPI(c);if(u!==void 0&&u instanceof NY){let h=u.retrieveValue(l.slice(1));h!==void 0&&(r+=h)}continue}if("objType"in o&&o.objType==="webhook"){let l=JSON.parse(o.id),[c,u]=l,h=e.getUserWebhook(c);if(h!==void 0){let d=h.getParameterValue(u);d!==void 0&&(r+=d)}continue}if("objType"in o&&o.objType==="aiAssistant"){let l=e.openAIRealtime;if("objId"in o&&o.objId!==void 0){let c;if(e.scene.data.objects.traverse((u,h)=>{var p;let d=(p=h.events)==null?void 0:p.find(g=>g.id===o.objId);d&&(c=d)}),c!==void 0&&c.data.type==="AIAssistantListener"){let u=l==null?void 0:l.computeAnalysisForListenerEvent(c.data);if(u!==void 0){r+=u;continue}}}r+=(l==null?void 0:l.voice)??0;continue}if("id"in o){let l=t[a-1];if(a>0&&"id"in l){console.error("Two variables in a row",t);return}let c=e.getVariable(o.id),u=to.getDisplayedValue(c);i==="number"&&to.isTextValue(c)&&Array.isArray(c.textValue)&&c.textValue.length===1?u=parseFloat(u).toString():i==="boolean"&&to.isBoolean(c)?u=c?"true":"false":i==="boolean"&&to.isTextValue(c)&&!Array.isArray(c.textValue)&&(u='"'+u+'"'),r+=u;continue}else if(i==="string"){o.name!=='"'&&(o.name!=="+"||o.escaped)&&(r+=o.name),o.name==="+"&&!o.escaped&&r[r.length-1]==="\\"&&(r=r.slice(0,-1)+o.name);continue}if(o.name==="and"){r+="&&";continue}if(o.name==="or"){r+="||";continue}if(o.name==="True"){r+="true";continue}if(o.name==="False"){r+="false";continue}if(i==="boolean"&&!$Se(o.name)&&!KSe.includes(o.name)&&!ZSe.includes(o.name)&&!JSe.includes(o.name.replace(/\($/g,""))){r+='"'+o.name+'"';continue}r+=o.name}if(i==="string")return r;if(t.length===0){if(i==="number")return 0;if(i==="boolean")return!1}let n;try{n=G1(r)}catch(a){console.error(r,a);return}let s;try{s=Pr(n)}catch(a){console.error(r,n,a)}return s}function Pr(t){switch(t.type){case"BinaryExpression":switch(t.operator){case"==":return+(Pr(t.left)===Pr(t.right));case"!=":return+(Pr(t.left)!==Pr(t.right));case">":return+(Pr(t.left)>Pr(t.right));case">=":return+(Pr(t.left)>=Pr(t.right));case"<":return+(Pr(t.left)<Pr(t.right));case"<=":return+(Pr(t.left)<=Pr(t.right));case"+":return Pr(t.left)+Pr(t.right);case"-":return Pr(t.left)-Pr(t.right);case"*":return Pr(t.left)*Pr(t.right);case"/":return Pr(t.left)/Pr(t.right);case"%":return Pr(t.left)%Pr(t.right);case"&&":return Pr(t.left)&&Pr(t.right);case"||":return Pr(t.left)||Pr(t.right);case"^":return Math.pow(Pr(t.left),Pr(t.right));default:throw new Error("Unknown operator: "+t.operator)}case"UnaryExpression":switch(t.operator){case"-":return-Pr(t.argument);case"!":return+!Pr(t.argument);default:throw new Error("Unknown operator: "+t.operator)}case"Identifier":throw new Error("Unknown identifier: "+t.name);case"Literal":return t.value;case"CallExpression":if(t.callee.type==="Identifier"){if(t.callee.name==="random"){let e=0,i=1;if(t.arguments.length>=1)try{e=Pr(t.arguments[0])}catch(r){console.warn(r)}if(t.arguments.length>=2)try{i=Pr(t.arguments[1])}catch(r){console.warn(r)}return e=Math.min(i,e),i=Math.max(i,e),e+Math.random()*(i-e)}return Math[t.callee.name].apply(null,t.arguments.map(Pr))}else throw new Error("Unknown node");default:throw new Error("Unknown node type: "+t.type)}}var ewe=new Ot,twe=new Ot;function iwe(t,e,i){let r=[new W,new W,new W],n=[new W,new W,new W];return t.extractBasis(r[0],r[1],r[2]),e.extractBasis(n[0],n[1],n[2]),r.forEach((s,a)=>{let o=n[a],l=Qt.lerp(s.length(),o.length(),i);s.lerp(o,i).setLength(l)}),new Ot().makeBasis(r[0],r[1],r[2])}var rwe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},t.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=(e==null?void 0:e.shapeData)??f4.create({parameters:oY}).userData.shape;return{path:t.path??$C.defaultData(),parameters:Object.assign(i,{width:r,height:n,depth:s,extrusion:{...lY,...i.extrusion}}),shapeData:a}}static build(t){if(t.path.points.length>=2){let e=new nwe(t);return Object.assign(e,{userData:{...t,type:"PathGeometry"}})}else return Object.assign(new ni,{userData:{...t,type:"PathGeometry"}})}},nwe=class extends ni{constructor(t){super(),this.type="PathExtrusionGeometry",this.inputs=t,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let t=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&t.depth===1)||!PSe(t.twist,0)||t.startScale!==t.endScale}build(){let t=this._extractPathPoints();if(t.length<2)return;let e=this._computeBasisMatrices(t),{depth:i,offset:r}=this.inputs.parameters.extrusion;i=Math.max(0,Math.min(i,1)),r=Math.max(0,Math.min(r,1));let n=this.inputs.path.isClosed?t.length:t.length-1,s=Math.floor(r*n),a=this.inputs.path.isClosed?Math.ceil((i+r)*n):Math.ceil(Math.min(1,i+r)*n),o=Math.min(Math.max(2,a-s+1),n+2),l=[],c=[];for(let $=0;$<o;$++){let Y=this.inputs.path.isClosed?($+s)%t.length:Math.min($+s,t.length-1);l.push(t[Y].clone()),c.push(e[Y].clone())}let u=($,Y,re)=>{l[$]=l[$].clone().lerp(l[Y],re),c[$]=iwe(c[$],c[Y],re)},h=0,d=r*n%1;(!this.inputs.path.isClosed||i<=1)&&(d||r===0)&&(h=d,u(0,1,h));let p=0,g=(r+i)*n%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&r+i<1)&&g&&(p=g,u(l.length-1,l.length-2,1-p)),i===0){let $=l.length-1;l[$].copy(l[0]),c[$].copy(c[0])}this._applyPathModifiers(c,h,p);let{bevel:x,bevelSides:v}=this.inputs.parameters.extrusion,b=x>0?this.inputs.parameters.extrusion.capType:"flat",w=5;this.inputs.parameters.extrusion.shape.type==="Custom"&&(w=this.inputs.parameters.extrusion.shape.shapeQuality==="low"?5:12);let{regions:M,infos:E,vertices:D}=this._computeShapePoints(w),T=0,L;b==="round"&&(L=new d4(this.inputs.shapeData,2*x,x,w,v,void 0,!0),T=L.getAttribute("position").count);let P=0,R=0;E.sort(($,Y)=>$.start-Y.start),E.forEach($=>{$.verticesStart=P,$.verticesCount=$.continuous.reduce((Y,re,G)=>Y+(G===0||!re?2:1),0),R+=$.verticesCount,P=R});let O=R*o,U,F=0;if(this._isOpenEnded()&&b==="flat"){try{U=ug({windingRule:nn.ODD,elementType:Vs.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:M})}catch{U=TY}F=U.vertexCount}let V=O+2*F+T*2,k=O+2*F,K={positions:new Float32Array(V*3),normals:new Float32Array(V*3),uvs:new Float32Array(V*2)},X=[];if(E.forEach($=>{this._extrudeRegion($,D,c,l,K,X,this._isGeometryClosed()&&!this._isOpenEnded())}),U&&(this._closeEnd(U,O,X,K,c[0],l[0],!1),this._closeEnd(U,O+F,X,K,c[c.length-1],l[l.length-1],!0)),L){K.positions.set(L.getAttribute("position").array,k*3),K.normals.set(L.getAttribute("normal").array,k*3),K.uvs.set(L.getAttribute("uv").array,k*2);for(let G=k;G<k+T;G++)K.uvs[G*2+1]=1e-4;let $=X.length;X.push(...L.getIndex().array.map(G=>G+k)),k+=T,K.positions.set(L.getAttribute("position").array,k*3),K.normals.set(L.getAttribute("normal").array,k*3),K.uvs.set(L.getAttribute("uv").array,k*2);let Y=X.length;X.push(...L.getIndex().array.map(G=>G+k)),this.setAttribute("position",new _i(K.positions,3)),this.setAttribute("normal",new _i(K.normals,3)),this.setAttribute("uv",new _i(K.uvs,2)),this.setIndex(X);let re=ewe;re.copy(c[c.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(re,k,V),re.copy(c[0]).setPosition(l[0]).multiply(twe.makeScale(1,1,-1)),this.applyMatrix4OnRange(re,k-T,k),this.reverseIndicesOnRange($,Y)}else this.setAttribute("position",new _i(K.positions,3)),this.setAttribute("normal",new _i(K.normals,3)),this.setAttribute("uv",new _i(K.uvs,2)),this.setIndex(X)}_extractPathPoints(){let t=vY(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(t.length<2)return[];let e=[t[0]];return t.forEach(i=>{e[e.length-1].distanceToSquared(i)>.001&&e.push(i)}),this.inputs.path.isClosed&&e[e.length-1].distanceTo(e[0])<.001&&e.pop(),e}_computeBasisMatrices(t){let e=[],i=t.length,r=this.inputs.path.isClosed,n=new W,s=new W,a=new W,o=new W,l=new W(0,1,0);for(let g=0;g<i;g++){let x=t[g],v;g===0?v=r?t[t.length-2]:x.clone().multiplyScalar(2).sub(t[1]):v=t[g-1];let b;g===i-1?b=r?t[1]:x.clone().multiplyScalar(2).sub(t[g-1]):b=t[g+1];let w=x.clone().sub(v).normalize(),M=b.clone().sub(x).normalize(),E=w.clone().add(M).normalize();a.copy(E),g===0&&(E.equals(l)||E.clone().negate().equals(l))&&l.set(0,0,1);let D=l.clone().cross(E).normalize(),T=E.clone().cross(D).normalize();l.copy(T),o.copy(D),g===0&&(n.copy(T),s.copy(E));let L=new Ot().makeBasis(D,T,E);e.push(L)}let c=r?s:a,u=r?n:new W(0,1,0),h=c.clone().cross(o).normalize(),d=Math.acos(u.dot(h));if(isNaN(d))return e;let p=u.clone().cross(h);c.dot(p)>0&&(d*=-1);for(let g=1;g<e.length;g++){let x=new Ot().makeRotationZ(d*g/e.length);e[g].multiply(x)}return e}_applyPathModifiers(t,e,i){let r=t.length,{angle:n,twist:s,startScale:a,endScale:o}=this.inputs.parameters.extrusion,l=new Ot,c=new Ot;return t.forEach((u,h)=>{let d=h===0?0:h===r-1?1:(h-e)/(r-(i===0?0:1)-(e+(1-i)));l.makeRotationZ(Qt.lerp(n,n+s,d)*Qt.DEG2RAD);let p=Qt.lerp(a,o,d);c.makeScale(p,p,p),u.multiply(l).multiply(c)}),t}_computeShapePoints(t=12,e=nn.ODD){let i=this.inputs.shapeData,r=i.extractShapePointsToFlatArray([],t),n=i.shapeHoles.map(c=>{let u=c.extractShapePointsToFlatArray([],t),h=[];for(let d=u.length-1;d>=1;d-=2){let p=u[d-1],g=u[d-0];h.push(p,g)}return h}),s;try{s=ug({windingRule:e,elementType:Vs.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[r]})}catch{s=h4}let a;try{a=ug({windingRule:nn.ODD,elementType:Vs.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...n]})}catch{a=AY}if(!s)throw new Error("error generating geometry");let o=s.elementCount;if(a){s.elementCount+=a.elementCount;for(let c=0;c<a.elements.length;c++){let u=a.elements[c],h=c%2===0?s.vertexCount:0;s.elements.push(u+h)}for(let c=0;c<a.vertexIndices.length;c++){let u=a.vertexIndices[c],h=s.vertexCount;s.vertexIndices.push(u+h)}for(let c=0;c<a.vertices.length;c++){let u=a.vertices[c];s.vertices.push(u)}}for(let c=0,u=s.vertexCount;c<u;c++){let h=c*2;s.vertices[h+0],s.vertices[h+1]}let l=[];for(let c=s.elementCount-1;c>=0;c--){let u=c>=o,h=c*2,d=s.elements[h+0],p=s.elements[h+1],g=d+p,x={start:d,count:p,normals:[],isHole:u,continuous:[],verticesStart:0,verticesCount:0};l.push(x);let v=d,b=g-1,w=d+1,M=i.roundedCurves.length;do{let E=v-d;s.vertices[b*2+0],s.vertices[b*2+1];let D=s.vertices[v*2+0],T=s.vertices[v*2+1],L=s.vertices[w*2+0],P=s.vertices[w*2+1],R=D-L,O=T-P,U=Math.sqrt(R*R+O*O);R/=U,O/=U,x.normals[E*2+0]=-O,x.normals[E*2+1]=R;let F=s.vertexIndices[v];if(Array.isArray(F))x.continuous[E]=!1;else{let[V,k]=i.getCurveIndexFromVertexId(F-1,!0);if(k>0&&k<1)x.continuous[E]=!0;else{let K=k===1?V+1:V-1;K=(K+M)%M;let X=k===1?0:1,$=i.roundedCurves[V].getTangent(k),Y=i.roundedCurves[K].getTangent(X);x.continuous[E]=$.dot(Y)>.95}}u&&(x.normals[E*2+0]*=-1,x.normals[E*2+1]*=-1),[b,v,w]=[v,w,w+1],w>=g&&(w-=p)}while(w!==d+1)}return{regions:[r,...n],infos:l,vertices:s.vertices}}_insertVertex(t,e,i,r,n){let s=e*2,a=e*3;t.positions[a+0]=i.x,t.positions[a+1]=i.y,t.positions[a+2]=i.z,t.normals[a+0]=r.x,t.normals[a+1]=r.y,t.normals[a+2]=r.z,t.uvs[s+0]=n.x,t.uvs[s+1]=n.y}_extrudeRegion(t,e,i,r,n,s,a){let o=new W,l=new W,c=new W,u=new W,h=new Oe;i.forEach((p,g)=>{let x=r[g],v=t.verticesStart*i.length+t.verticesCount*g;for(let b=0;b<t.count;b++){let w=(t.start+b)*2;if(o.set(e[w+0],e[w+1],0),c.copy(o).applyMatrix4(p).add(x),t.continuous[b])u.set(t.normals[b*2+0],t.normals[b*2+1],0);else{let M=b===0?(t.start+t.count-1)*2:w-2;l.set(e[M+0],e[M+1],0),u.copy(o).sub(l),u.set(-u.y,u.x,0),t.isHole||u.negate()}if(u.applyMatrix4(p).normalize(),h.set(b===0?1:b/t.count,g/(i.length-1)),this._insertVertex(n,v,c,u,h),v++,!t.continuous[b]||b===0){if(b===0)u.set(t.normals[b*2+0],t.normals[b*2+1],0),h.set(0,g/(i.length-1));else{let M=b===t.count-1?t.start*2:w+2;l.set(e[M+0],e[M+1],0),u.copy(l).sub(o),u.set(-u.y,u.x,0),t.isHole||u.negate()}u.applyMatrix4(p).normalize(),this._insertVertex(n,v,c,u,h),v++}}});let d=i.length-1;for(let p=0;p<d;p++){let g=t.verticesStart*i.length+t.verticesCount*p,x=t.verticesStart*i.length+t.verticesCount*(p+1),v=0;for(let b=0;b<t.count;b++){(!t.continuous[b]||b===0)&&v++;let w=b===t.count-1?0:v+1,M=g+v,E=g+w,D=x+w,T=x+v;t.isHole?s.push(M,D,E,M,T,D):s.push(M,E,D,M,D,T),v++}}}_closeEnd(t,e,i,r,n,s,a){let o=t.vertexCount,l=new W(0,0,a?-1:1).applyMatrix4(n),c=new W,u=new Oe;for(let d=0;d<o;d++){let p=2*d;c.set(t.vertices[p+0],t.vertices[p+1],0).applyMatrix4(n).add(s),this._insertVertex(r,e+d,c,l,u)}let h=t.elements;for(let d=0;d<t.elementCount;d++){let p=3*d,g=h[p+0]+e,x=h[p+(a?1:2)]+e,v=h[p+(a?2:1)]+e;i.push(g,x,v)}}applyMatrix4OnRange(t,e,i){let r=t.elements,n=new Hs().getNormalMatrix(t).elements,s,a,o,l,c=this.attributes.position,u=this.attributes.normal;if(!c||!u)return;let h=c.array,d=u.array,p=c.itemSize;for(let g=e*p,x=i*p;g<x;g+=p){if(g===e)debugger;s=h[g+0],a=h[g+1],o=h[g+2],l=1/(r[3]*s+r[7]*a+r[11]*o+r[15]),h[g+0]=(r[0]*s+r[4]*a+r[8]*o+r[12])*l,h[g+1]=(r[1]*s+r[5]*a+r[9]*o+r[13])*l,h[g+2]=(r[2]*s+r[6]*a+r[10]*o+r[14])*l,s=d[g+0],a=d[g+1],o=d[g+2],d[g+0]=n[0]*s+n[3]*a+n[6]*o,d[g+1]=n[1]*s+n[4]*a+n[7]*o,d[g+2]=n[2]*s+n[5]*a+n[8]*o}c.needsUpdate=!0,u.needsUpdate=!0}reverseIndicesOnRange(t,e){let i=this.index;if(i){for(let r=t;r<e;r+=3){let n=i.getX(r),s=i.getX(r+1),a=i.getX(r+2);i.setXYZ(r,a,s,n)}i.needsUpdate=!0}}};function VY(){let t=new ni;return t.setAttribute("position",new _i(new Float32Array([]),3)),t.setIndex(new _i(new Uint16Array([]),1)),t}var swe=VY().attributes,awe=12,owe=1,jU=class extends ni{constructor(t,e){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,swe),this.userData={parameters:t,type:"TextGeometry"};let i=e.getFont(t.font);i!=null&&i.isLoaded?(this.font=i,this.update(t)):this.updateFont(t.font,e).then(()=>{this.update(t),e==null||e.requestRender()})}async updateFont(t,e){let i=e.getFont(t);i&&(this.font=i,await i.loadingPromise)}update(t){let e=this.font;if(this.userData={parameters:t,type:"TextGeometry"},!(e!=null&&e.isLoaded)){console.warn("Cannot update text because its font is not loaded");return}let{width:i,height:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,text:o,textTransform:l}=t,c=to.getDisplayedValue(o),u=l===2?c.toUpperCase():l===3?c.toLowerCase():c,h=lwe(t,e,u),{shapes:d,charWidths:p,charCoords:g}=e.generateShapes(h,t),x=(typeof i=="number"?i:1)*.5,v=(typeof r=="number"?r:1)*.5,b=d.map(E=>new xs().fromShape(E,!0));this.vectorShapes=b;let w=b.map(E=>J0.create({shape:E,parameters:{depth:n,extrudeBevelSegments:a,extrudeBevelSize:s,windingRule:n<=0?nn.NONZERO:nn.ODD,subdivisions:this.isLowResolution&&n>0?owe:awe}})),M=w.length?h0(w):VY();M.translate(-x,v,0),this.dispose(),this.wrappedText=h,this.charCoords=g,this.charWidths=p,this.deleteAttribute("extrudeNormal"),Object.entries(M.attributes).forEach(([E,D])=>{this.setAttribute(E,D)}),this.setIndex(M.index),this.computeBoundingSphere()}clone(){let t=lu(new ni,jU.prototype);return t.copy(this),console.log("CloneGeometry",this,t),t}copy(t){return Object.entries(t.attributes).forEach(([e,i])=>{this.setAttribute(e,i)}),this.setIndex(t.index),this.userData={parameters:{...t.userData.parameters},type:"TextGeometry"},this}async setText(t){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:{textValue:t}})}get text(){return this.userData.parameters.text??""}};function lwe(t,e,i){let r=[""],n="";for(let s of i)n+=s,s===" "||s===`
`?(r[r.length-1]+=n,n="",s===`
`&&r.push("")):e.getTextWidth(r[r.length-1]+n,t)>t.width&&(r[r.length-1].length&&r.push(""),e.getTextWidth(r[r.length-1]+n,t)>t.width&&(n.length===1?(r[r.length-1]+=n,n=""):(r[r.length-1]+=n.slice(0,-1),n=n[n.length-1],r.push(""))));return r[r.length-1]+=n,r}var HY,GY=new Promise(t=>{HY=t}),tG=!1,g2;function cwe(){if(tG)return;if(g2)return g2;async function t(){let e="https://unpkg.com/@splinetool/modelling-wasm@1.9.82/build",i=Cg(()=>import("./process-DLQUZ-E7.js"),[]),[r,n]=await Promise.all([i,fetch(`${e}/process.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});HY(a),tG=!0}return g2=t(),g2}var uwe=["font"];function Gw(t,e,i,r){var c,u;let n,s,a;t.type==="PathGeometry"?(s=JSON.parse(JSON.stringify(t)),a=[[],["extrusion"]]):(s={...t},a=[[]]);for(let h of a){let d=s;for(let p of h)d=d[p];for(n in d){let p=d[n];nH(p)&&!uwe.includes(n)&&(d[n]=e.getVariable(p,[r.uuid,"geometry",...h,n]),nH(d[n])&&(d[n]=1))}}let o={parameters:s,type:s.type};if(s.type==="PathGeometry")o.path=s.path;else if(s.type==="VectorGeometry"){let h=xs.createFromState(s.shape,s.width,s.height);o.shape=h}else if(s.type==="NonParametricGeometry"){if(s.data.groups&&((c=s.data.groups)==null||c.forEach(h=>h.materialIndex=Math.max(h.materialIndex??0,0))),o.geometry=new Vq().parse(s),o.geometry.groups.length===0){let h=o.geometry;h.addGroup(0,Math.max(((u=h.getIndex())==null?void 0:u.count)??0,h.getAttribute("position").count),0)}}else if(s.type==="SubdivGeometry"){let h=new il(s,i);return h.data=t,h}else{if(s.type==="TextGeometry")return new jU(s,e);if(s.type==="InputGeometry")return new jU(s,e);if(s.type==="UIGeometry")return p4.create({parameters:{width:s.width,height:s.height,cornerRadius:s.cornerRadius,cornerType:s.cornerType}})}let l;try{l=aG(o)}catch(h){console.error(h)}if(!l){let h=xs.createFromState(JC.defaultData(),100,100);o.shape=h,l=aG(o)}return l}var hwe=new Ot;function WU(t,e,i,r){let n=t.position.array,s=t.normal.array,a=hwe.makeScale(e,i,r).invert().elements,o,l,c;for(var u=0,h=n.length;u<h;u+=3)n[u]*=e,n[u+1]*=i,n[u+2]*=r,o=s[u],l=s[u+1],c=s[u+2],s[u]=a[0]*o+a[4]*l+a[8]*c,s[u+1]=a[1]*o+a[5]*l+a[9]*c,s[u+2]=a[2]*o+a[6]*l+a[10]*c;t.position.needsUpdate=!0,t.normal.needsUpdate=!0}var v2=new Os,fx=new W,Si;GY.then(t=>{Si=t});var iG=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),rG=new Uint32Array([0,1,2,3]),nG=new Uint8Array([4]),il=class extends ni{constructor(t,e){super(),this.data=t,this.flatShading=e,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(t,e){this.freeSubdivPointer();let i=this.data.scaleBaked,r=S0.div(e,i);this.subdividedGeometry&&WU(this.subdividedGeometry.attributes,...r),this.originalGeometry&&WU(this.originalGeometry.attributes,...r),this.data=t;let n=this.userData.parameters;this.userData.parameters={width:n.width*r[0],height:n.height*r[1],depth:n.depth*r[2]},this.originalGeometry.boundingSphere.center.multiply(fx.fromArray(r));let s=fx.set(n.width,n.height,n.depth).length();this.originalGeometry.boundingSphere.radius=s/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let t,e,i;try{({originalGeometry:t,subdividedGeometry:e,subdivPointer:i}=il.build(this.data,void 0,!this.flatShading,void 0))}catch{t=new yh(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=t,this.subdividedGeometry=e??void 0;let r=this.subdividedGeometry??this.originalGeometry;Object.assign(this,r),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(il.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let t=this.originalGeometry;t.boundingSphere===null&&(t.boundingSphere=new Xl,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=t.boundingSphere));let e=t.attributes.position,i=t.boundingSphere.center;v2.setFromBufferAttribute(e),v2.getCenter(i),t.boundingSphere.radius=i.distanceTo(v2.max),isNaN(t.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),v2.getSize(fx);let r={width:fx.x,height:fx.y,depth:fx.z};return this.userData.parameters=r,r}static build(t,e,i,r){let n,s,a,o=(t==null?void 0:t.phongAngle)??35;i===!1&&(o=-1),e&&(Si.free_bvh(e),Si.free_subdivision_surface(e));try{n=il.allocate(t,r)}catch(l){console.error(l,t),n=il.allocate({positionWASM:iG,indexWASM:rG,verticesPerFaceWASM:nG},r)}if(Si.set_destination_refinement_level(n,0),s=il.buildLevel(n,!0,o),t.subdivisions>0)try{Si.set_destination_refinement_level(n,t.subdivisions),a=il.buildLevel(n,!1,o)}catch{try{Si.set_destination_refinement_level(n,t.subdivisions-1),a=il.buildLevel(n,!1,o)}catch{a=null}}else a=null;return{subdivPointer:n,originalGeometry:s,subdividedGeometry:a}}static primitiveToQuads(t,e,i){t.widthSegments>16&&(t.widthSegments=16),t.heightSegments>16&&(t.heightSegments=16),t.depthSegments>16&&(t.depthSegments=16),t.radialSegments>16&&(t.radialSegments=16),t.type==="DodecahedronGeometry"&&(t.detail=0);let r=t.shape!==void 0||t.path!==void 0?e.geometry:Gw(t,i,!1),n;t.type==="TorusGeometry"&&t.arc===Math.PI*2?n=r.getClosedTorusIndicesForBooleanOrSubdiv():n=r.getIndex();let s,a,o,l;({positions:s,triIndices:l}=Z3(r.getAttribute("position"),n));let c;if(t.type==="CylinderGeometry"&&t.cornerRadius===0&&t.hollow===0&&t.openEnded===!1){let u=t.radialSegments*t.heightSegments*3*2,h=u+t.radialSegments*3;c=[u,h]}return{indices:a,verticesPerFace:o}=jY(s,l,r,c),{positions:s,indices:a,verticesPerFace:o}}static allocate(t,e){var M;let i,r,n,s=[],a=[];t.positionWASM&&t.positionWASM.length>0?(i=t.positionWASM,r=t.indexWASM,n=t.verticesPerFaceWASM):(i=iG,r=rG,n=nG);let o=i.length,l=r.length,c=n.length,u=i.length+s.length+a.length,h=r.length+n.length,d=u*Float32Array.BYTES_PER_ELEMENT+h*Uint32Array.BYTES_PER_ELEMENT,p=u*Float32Array.BYTES_PER_ELEMENT,g=Si._malloc(d),x=new Float32Array(Si.HEAPF32.buffer,g,u),v=new Uint32Array(Si.HEAPU32.buffer,g+p,h);x.set(i,0),x.set(s,i.length),x.set(a,i.length+s.length),v.set(r,0),v.set(n,r.length);let b;(M=t==null?void 0:t.scaleBaked)!=null&&M.some(E=>E!==1)&&(b=new Ot().makeScale(...t.scaleBaked)),e&&(b?b.premultiply(e):b=e);let w=b?Si.alloc_subdivision_surface2(g,o,g+p,l,g+p+r.length*Uint32Array.BYTES_PER_ELEMENT,c,b.elements):Si.alloc_subdivision_surface(g,o,g+p,l,g+p+r.length*Uint32Array.BYTES_PER_ELEMENT,c);return Si._free(g),w}static buildLevel(t,e,i,r,n){let s=n?Si.get_mesh_data2(t,e?Si.Level.CONTROL:Si.Level.REFINED,i,n.elements):Si.get_mesh_data(t,e?Si.Level.CONTROL:Si.Level.REFINED,i),a=8,o=Si.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(4,8),c=0,u=Si.HEAPU32[o[c]>>2],h=Si.HEAPF32.subarray(u>>2,(u>>2)+l[c]);c++;let d=Si.HEAPU32[o[c]>>2],p=Si.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let g=Si.HEAPU32[o[c]>>2],x=Si.HEAPU32.subarray(g>>2,(g>>2)+l[c]);c++;let v=Si.HEAPU32[o[c]>>2],b=Si.HEAPU32.subarray(v>>2,(v>>2)+l[c]);if(c++,r===void 0){let w=new ni;if(w.setIndex(new f1(b,1)),w.setAttribute("position",new Wt(h,3)),w.setAttribute("normal",new Wt(p,3)),e){w.setAttribute("faceMap",new f1(x,1));let M=new Float32Array(p.length/3*4).fill(0);w.setAttribute("color",new _i(M,4))}return Si.free_mesh_data(s),w.userData.type="SubdivGeometry",w}r.getAttribute("position").copyArray(h),r.getAttribute("normal").copyArray(p),r.attributes.position.needsUpdate=!0,r.attributes.normal.needsUpdate=!0,Si.free_mesh_data(s)}static freeSubdivPointer(t){Si.free_bvh(t),Si.free_subdivision_surface(t)}static buildControlCageWireframe(t,e,i){let r=Si.get_wireframe_data_for_base_level(t),n=4,s=Si.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(2,4),o=0,l=Si.HEAPU32[s[o]>>2],c=Si.HEAPF32.subarray(l>>2,(l>>2)+a[o]);o++;let u=Si.HEAPU32[s[o]>>2],h=Si.HEAPU32.subarray(u>>2,(u>>2)+a[o]);if(e===void 0){let d=new ni;d.setAttribute("position",new Wt(c,3));let p=new Float32Array(c.length);for(let g=0,x=c.length;g<x;)p[g++]=i.r,p[g++]=i.g,p[g++]=i.b;return d.setAttribute("color",new _i(p,3)),d.setIndex(new f1(h,1)),Si.free_wireframe_data_for_base_level(r),d}e.getAttribute("position").copyArray(c),e.attributes.position.needsUpdate=!0,Si.free_wireframe_data_for_base_level(r)}static updateCollabMesh(t,e,i){let r=e===0;r||Si.set_destination_refinement_level(t,e);let n=i?Si.get_topological_data2(t,r?Si.Level.CONTROL:Si.Level.REFINED,i.elements):Si.get_topological_data(t,r?Si.Level.CONTROL:Si.Level.REFINED),s=6,a=Si.HEAPU32.subarray(n>>2,(n>>2)+s),o=a.subarray(3,6),l=0,c=Si.HEAPU32[a[l]>>2],u=new Float32Array(Si.HEAPF32.subarray(c>>2,(c>>2)+o[l]));l++;let h=Si.HEAPU32[a[l]>>2],d=new Uint32Array(Si.HEAPU32.subarray(h>>2,(h>>2)+o[l]));l++;let p=Si.HEAPU32[a[l]>>2],g=new Uint8Array(Si.HEAPU32.subarray(p>>2,(p>>2)+o[l]));return Si.free_topological_data(n),{positions:u,indices:d,verticesPerFace:g}}},sG=["getX","getY","getZ"];function Z3(t,e){let i={},r=e?e.count:t.count,n=0,s=[],a=[],o=1e4;for(let c=0;c<r;c++){let u=e?e.getX(c):c,h="";for(let d=0;d<3;d++)h+=`${~~(t[sG[d]](u)*o)},`;if(h in i)s.push(i[h]);else{for(let d=0;d<3;d++)a.push(t[sG[d]](u));i[h]=n,s.push(n),n++}}let l=[];for(let c=0;c<s.length;c+=3)s[c]===s[c+1]||s[c]===s[c+2]||s[c+1]===s[c+2]||l.push(s[c],s[c+1],s[c+2]);return{positions:a,triIndices:l}}var y2=new W,eL=new W,tL=new W,iL=new W;function jY(t,e,i,r){let n=[],s=[];if(i.userData.shape!==void 0&&i.userData.parameters.depth===0&&i.userData.shape.shapeHoles.length===0){let l=i.userData.shape.extractShapePointsToFlatArray([]),c=i.userData.parameters.spikes;if(i.userData.type==="EllipseGeometry"&&c<=24&&c%4===0&&i.userData.parameters.angle>=360){let d=l.length/2/c;l=l.filter((p,g)=>Math.floor(g/2)%d===0)}let u=0;for(let d=0;d<l.length;d+=2)u+=(l[d]-l[(d===0?l.length:d)-2])*(l[d+1]+l[(d===0?l.length:d)-1]);t.length=0;let h=0;if(u<0)for(let d=0;d<l.length;d+=2)t.push(l[d],l[d+1],0),n.push(h++);else for(let d=l.length-2;d>=0;d-=2)t.push(l[d],l[d+1],0),n.push(h++);return s.push(h),{indices:n,verticesPerFace:s}}let a=new Float32Array([i.userData.parameters.depth])[0],o=0;for(;o<e.length;){if(i.useNgonForTopBottomFaceDuringBake){let l=0;if((t[e[o]*3+2]===a||t[e[o]*3+2]===0)&&l++,(t[e[o+1]*3+2]===a||t[e[o+1]*3+2]===0)&&l++,(t[e[o+2]*3+2]===a||t[e[o+2]*3+2]===0)&&l++,l===3)break}if(e[o+1]===e[o+3]&&e[o+2]===e[o+5]||e[o+0]===e[o+3]&&e[o+2]===e[o+4]){y2.set(t[e[o]*3],t[e[o]*3+1],t[e[o]*3+2]),eL.set(t[e[o+1]*3],t[e[o+1]*3+1],t[e[o+1]*3+2]),tL.set(t[e[o+4]*3],t[e[o+4]*3+1],t[e[o+4]*3+2]),iL.set(t[e[o+5]*3],t[e[o+5]*3+1],t[e[o+5]*3+2]),eL.sub(y2).normalize(),tL.sub(y2).normalize(),iL.sub(y2).normalize();let l=eL.cross(tL).dot(iL);Math.abs(l)>.005||r&&r.some((c,u)=>u%2===1?!1:o>=r[u]&&o<r[u+1])?(n.push(e[o],e[o+1],e[o+2]),s.push(3),o+=3):(n.push(e[o],e[o+1],e[o+4],e[o+5]),s.push(4),o+=6)}else n.push(e[o],e[o+1],e[o+2]),s.push(3),o+=3}if(i.useNgonForTopBottomFaceDuringBake){let l=[],c=[],u=0;for(let h=0,d=0;h<t.length;h+=3,d++)t[h+2]===0&&(l.push(d),u++),t[h+2]===a&&c.push(d);if(i.userData.parameters.extrudeBevelSize===0){let h=c[0];c[0]=c[1],c[1]=h}l.reverse(),n.push(...l,...c),s.push(u,u)}return{indices:n,verticesPerFace:s}}var rp={};nse(rp,{calcBoolean:()=>gwe,calcBooleanTopological:()=>mwe,freeMeshSet:()=>bwe,getMeshSet:()=>vwe,hasOpenEdges:()=>ywe,transformMeshSet:()=>xwe});var WY,dwe=new Promise(t=>{WY=t}),x2;function fwe(){if(x2)return x2;async function t(){let e="https://unpkg.com/@splinetool/boolean-wasm@1.9.82/build",i=Cg(()=>import("./boolean-CynEgfvK.js"),[]),[r,n]=await Promise.all([i,fetch(`${e}/boolean.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});WY(a)}return x2=t(),x2}var mr,b1;dwe.then(t=>mr=t);function pwe(t,e,i){let r,n;t.userData.parameters.type==="TorusGeometry"&&t.userData.parameters.arc===Math.PI*2?n=t.getClosedTorusIndicesForBooleanOrSubdiv():n=t.getIndex();let{positions:s,triIndices:a}=Z3(t.getAttribute("position"),n),o;if(e&&i){let{indices:l,verticesPerFace:c}=jY(s,a,t);o=c.length,r=[];for(let u=0,h=0;u<o;u++){r.push(c[u]);for(let d=0;d<c[u];d++)r.push(l[h++])}}else{let l=a.length;r=Array(l+l/3),o=0;for(let c=0,u=0;u<r.length;)r[u++]=3,o++,r[u++]=a[c++],r[u++]=a[c++],r[u++]=a[c++]}return{positions:s,faceIndices:r,nFaces:o}}function qY(t){let e=t.length,i=e*Uint32Array.BYTES_PER_ELEMENT,r=e*Float32Array.BYTES_PER_ELEMENT,n=Number.isInteger(t[0])?i:r,s=mr._malloc(n);return(Number.isInteger(t[0])?new Uint32Array(mr.HEAPU32.buffer,s,e):new Float32Array(mr.HEAPF32.buffer,s,e)).set(t,0),s}function XY(t){switch(t){case 0:return mr.OP.UNION;case 1:return mr.OP.INTERSECTION;case 2:return mr.OP.A_MINUS_B;default:throw new Error("Unknown boolean operation "+t)}}function mwe(t,e){b1===void 0&&(b1=mr.init_csg());let i=qY(t),r=mr.csg_calc_topological(b1,i,t.length,XY(e));mr._free(i);let n=6,s=mr.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(3,6),o=0,l=mr.HEAPU32[s[o]>>2],c=new Float32Array(mr.HEAPF32.subarray(l>>2,(l>>2)+a[o]));o++;let u=mr.HEAPU32[s[o]>>2],h=new Uint32Array(mr.HEAPU32.subarray(u>>2,(u>>2)+a[o]));o++;let d=mr.HEAPU32[s[o]>>2],p=new Uint8Array(mr.HEAPU32.subarray(d>>2,(d>>2)+a[o]));return mr.free_mesh_data(r),{positions:c,indices:h,verticesPerFace:p}}function gwe(t,e,i,r){b1===void 0&&(b1=mr.init_csg());let n=qY(t),s=mr.csg_calc(b1,n,t.length,r,XY(e));mr._free(n);let a=5,o=mr.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(2,5),c=0,u=mr.HEAPU32[o[c]>>2],h=mr.HEAPF32.subarray(u>>2,(u>>2)+l[c]);c++;let d=mr.HEAPU32[o[c]>>2],p=mr.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let g=l[c];i.setAttribute("position",new Wt(h,3)),i.setAttribute("normal",new Wt(p,3));let x=mr.HEAPF32.subarray((s>>2)+5,(s>>2)+5+6);return i.boundingSphere===null&&(i.boundingSphere=new Xl),i.boundingSphere.center.set(x[0],x[1],x[2]),i.boundingSphere.radius=(x[3]**2+x[4]**2+x[5]**2)**.5,i.userData.parameters={width:x[3]*2,height:x[4]*2,depth:x[5]*2},mr.free_mesh_data(s),g}function vwe(t,e,i){if(mr===void 0)return-1;let r,n,s;if(e&&t.userData.positions!==void 0){let v=t.userData;s=v.verticesPerFace.length,r=v.positions,n=Array(v.verticesPerFace.reduce((b,w)=>b+w,0)+s);for(let b=0,w=0,M=0;b<v.verticesPerFace.length;b++){n[M++]=v.verticesPerFace[b];for(let E=0;E<v.verticesPerFace[b];E++)n[M++]=v.indices[w++]}}else({positions:r,faceIndices:n,nFaces:s}=pwe(t,e,i));let a=r.length,o=n.length,l=r.length,c=n.length,u=l*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,h=l*Float32Array.BYTES_PER_ELEMENT,d=mr._malloc(u),p=new Float32Array(mr.HEAPF32.buffer,d,l),g=new Uint32Array(mr.HEAPU32.buffer,d+h,c);p.set(r,0),g.set(n,0);let x=mr.get_csg_mesh(d,a,d+h,o,s);return mr._free(d),x}function ywe(t){return mr.has_open_edges(t)}function xwe(t,e){mr.transform_csg_mesh(t,e.elements)}function bwe(t){mr.free_csg_mesh(t)}var _we={ConeGeometry:w_e,CubeGeometry:M_e,CylinderGeometry:yY,DodecahedronGeometry:A_e,EllipseGeometry:f4,HelixGeometry:lSe,IcosahedronGeometry:cSe,LatheGeometry:uSe,NonParametricGeometry:vSe,PolygonGeometry:UY,PyramidGeometry:ySe,RectangleGeometry:p4,SphereGeometry:_Se,PlaneGeometry:SSe,BackdropGeometry:wSe,StarGeometry:BY,TextFrameGeometry:ESe,TorusGeometry:ASe,TorusKnotGeometry:CSe,TriangleGeometry:DSe,PathGeometry:rwe,VectorGeometry:J0},aG=t=>_we[t.type].create(t);function px(t){return t!==null&&"booleanOp"in t}var YY=class extends o4(bn){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new Ot}updateVisible(t){super.updateVisible(t),this.visible=!px(this.parent)&&this.visible,px(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(rp.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(t=!1){return t?this.booleanWasTransformed=!0:this.freeBooleanPointer(),px(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let t of this.children)t instanceof YY&&(t.freeBooleanPointer(),px(t)&&t.invalidateUpstreamBooleanData())}updateTransformState(t,e){let i=super.updateTransformState(t,e);return i&&px(this.parent)&&this.invalidateDownstreamBooleanData(!0),i}onVariableUpdate(t=!1){super.onVariableUpdate(t),px(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},b2=new Os;function m4(t,e=0,i=t.count,r,n){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,u=-1/0;for(let h=e;h<i;h++){let d=t.getX(h),p=t.getY(h),g=t.getZ(h);d<s&&(s=d),p<a&&(a=p),g<o&&(o=g),d>l&&(l=d),p>c&&(c=p),g>u&&(u=g)}b2.min.set(s,a,o),b2.max.set(l,c,u),b2.getCenter(r),b2.getSize(n).multiplyScalar(.5)}var Swe=new ni,wwe=new Tp,hl=class extends YY{constructor(t,e){super(Swe,wwe),this.super_Entity(t,e)}updateState(t,e){this.updateState_Entity(t,e)}updateEntityBoxSize(t,e){let i=this.geometry.getAttribute("position");i!==void 0?m4(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,t,e):super.updateEntityBoxSize(t,e)}},Xm=class{constructor(t){if(this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},Xm.uuidContext===null)throw new Error("plz startContext");Xm.uuidContext===Xm.globalContext?this.uuid="_gid"+Xm.uuidContext.nodeContextUuid++:this.uuid="_uid"+Xm.uuidContext.nodeContextUuid++,this.type=t,this.name=""}static startContext(t){this.uuidContext===null||this.uuidContext===Xm.globalContext?this.uuidContext=t:console.error("Can't start context twice")}static endContext(t){this.uuidContext!==t&&console.error("Can't end context twice"),this.uuidContext=null}analyze(t,e){e=e??{},t.analyzing=!0,this.build(t.addFlow(e.slot,e.cache,e.context),"v4"),t.clearVertexNodeCode(),t.clearFragmentNodeCode(),t.removeFlow(),t.analyzing=!1}analyzeAndFlow(t,e,i){return i=i??{},this.analyze(t,i),this.flow(t,e,i)}flow(t,e,i){i=i??{},t.addFlow(i.slot,i.cache,i.context);let r={result:this.build(t,e),code:t.clearNodeCode(),extra:t.context.extra};return t.removeFlow(),r}build(t,e,i){e=e??this.getType(t,e);let r=t.getNodeData(i??this);return t.analyzing&&this.appendDepsNode(t,r,e),t.nodes.indexOf(this)===-1&&t.nodes.push(this),this.updateFrame!==void 0&&t.updaters.indexOf(this)===-1&&t.updaters.push(this),this.generate(t,e,i)}updateFrame(t){}generateReadonly(t,e,i,r,n,s){return""}generate(t,e,i,r,n){return""}parse(t,e,i,r){}appendDepsNode(t,e,i){e.deps=(e.deps||0)+1;let r=t.getTypeLength(i);(r>(e.outputMax||0)||this.getType(t,i))&&(e.outputMax=r,e.output=i)}setName(t){this.name=t}getName(){return this.name}getType(t,e){return e==="sampler2D"||e==="samplerCube"?e:this.type}},ta=Xm;ta.globalContext={nodeContextUuid:0},ta.uuidContext=Xm.globalContext;var oG=class{constructor(t){t=t??{},this.name=t.name,this.type=t.type,this.node=t.node,this.size=t.size,this.needsUpdate=t.needsUpdate}get value(){return this.node.value}set value(t){this.node.value=t}},Mwe=class{constructor(){this.nodes={},this.keywords={}}add(t){this.nodes[t.name]=t}addKeyword(t,e,i){i=i!==void 0?i:!0,this.keywords[t]={callback:e,cache:i}}remove(t){delete this.nodes[t.name]}removeKeyword(t){delete this.keywords[t]}get(t){return this.nodes[t]}getKeyword(t,e){return this.keywords[t].callback(e)}getKeywordData(t){return this.keywords[t]}contains(t){return this.nodes[t]!==void 0}containsKeyword(t){return this.keywords[t]!==void 0}},kl=new Mwe,an=class extends ta{constructor(t,e){super(t),this.scope="",e=e??{},this.shared=e.shared!==void 0?e.shared:!0,this.unique=e.unique!==void 0?e.unique:!1}build(t,e,i,r){if(e=e??this.getType(t),this.getShared(t,e)){let n=this.getUnique(t,e);n&&this.uuid===void 0&&(this.uuid=Qt.generateUUID()),i=t.getUUID(i??this.getUUID(),!n);let s=t.getNodeData(i),a=s.output||this.getType(t);if(t.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(t,s,e),this.generate(t,e,i)):super.build(t,e,i);if(n)return s.name=s.name||super.build(t,e,i),s.name;if(!this.getLabel()&&(!this.getShared(t,a)||t.context.ignoreCache||s.deps===1))return super.build(t,e,i);i=this.getUUID(!1);let o=this.getTemp(t,i);if(o)return t.format(o,a,e);{o=super.generate(t,e,i,s.output,r);let l=this.generate(t,a,i);return t.addNodeCode(o+" = "+l+";"),t.format(o,a,e)}}return super.build(t,e,i)}getShared(t,e){return e!=="sampler2D"&&e!=="samplerCube"&&this.shared}getUnique(t,e){return this.unique}setLabel(t){return this.label=t,this}getLabel(){return this.label}getUUID(t){let e=this.uuid;return typeof this.scope=="string"&&(e=this.scope+"-"+e),e}getTemp(t,e){e=e||this.uuid;let i=t.getVars()[e];return i?i.name:void 0}generate(t,e,i,r,n){return this.getShared(t,e)||console.error("TempNode is not shared"),i=i??this.uuid,t.getTempVar(i,r??this.getType(t),n,this.getLabel()).name}},Yl=class extends an{constructor(t,e){e=e??{},e.shared=e.shared!==void 0?e.shared:!1,super(t,e),this.readonly=!1}setReadonly(t){return this.readonly=t,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(t,e,i,r,n,s){i=t.getUUID(i??this.getUUID()),r=r??this.getType(t);let a=t.getNodeData(i);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(t,e,i,r,n,s):t.isShader("vertex")?(a.vertex||(a.vertex=t.createVertexUniform(r,this,n,s,this.getLabel())),t.format(a.vertex.name,r,e)):(a.fragment||(a.fragment=t.createFragmentUniform(r,this,n,s,this.getLabel())),t.format(a.fragment.name,r,e))}},Za=class extends Yl{constructor(t=0,e){super("v2"),this.nodeType="Vector2",this.value=t instanceof Oe?t:new Oe(t,e)}get x(){return this.value.x}set x(t){this.value.x=t}get y(){return this.value.y}set y(t){this.value.y=t}generateReadonly(t,e,i,r,n,s){return t.format("vec2("+this.value.x+", "+this.value.y+")",r,e)}},Yc=class extends Yl{constructor(t=0,e,i){super("v3"),this.nodeType="Vector3",this.value=t instanceof W?t:new W(t,e,i)}get x(){return this.value.x}set x(t){this.value.x=t}get y(){return this.value.y}set y(t){this.value.y=t}get z(){return this.value.z}set z(t){this.value.z=t}generateReadonly(t,e,i,r,n,s){return t.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",r,e)}},ro=class extends bi{constructor(t,e,i,r){super(t,e,i),this.isColorA=!0,this.a=r}setRGBA(t,e,i,r){super.setRGB(t,e,i),this.a=r}copy(t){return super.copy(t),this.a="a"in t?t.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(t){return super.equals(t)&&this.a===t.a}setStyle(t,e="srgb"){let i;if(t==="transparent")return this.setRGBA(0,0,0,0),this;if(i=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(t)){let r,n=i[1],s=i[2];switch(n){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="rgba"?parseFloat(r[4]):1,super.setStyle(t,e);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="hsla"?parseFloat(r[4]):1,super.setStyle(t,e);break}}return super.setStyle(t,e)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(t){this.r=t}set y(t){this.g=t}set z(t){this.b=t}set w(t){this.a=t}},np=class extends Yl{constructor(t){super("v4"),this.nodeType="Vector4",this.value=t instanceof ro?t:new ro(t.r,t.g,t.b,t.a)}generateReadonly(t,e,i,r,n,s){return t.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",r,e)}},Ewe=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,lG=/[a-z_0-9]+/gi,Ht=class extends an{constructor(t,e,i,r,n){super(n),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=n===void 0,this.isInterface=!1,this.parse(t,e,i,r)}getShared(t,e){return!this.isMethod}getType(t){return t.getTypeByFormat(this.type)}getInputByName(t){if(this.inputs){let e=this.inputs.length;for(;e--;)if(this.inputs[e].name===t)return this.inputs[e]}}getIncludeByName(t){if(this.includes){let e=this.includes.length;for(;e--;)if(this.includes[e].name===t)return this.includes[e]}}generate(t,e,i,r,n){let s,a=0,o=this.src;if(this.includes)for(let c=0;c<this.includes.length;c++)t.include(this.includes[c],this);for(let c in this.extensions)t.extensions[c]=!0;let l=[];for(;s=lG.exec(this.src);)l.push(s);for(let c=0;c<l.length;c++){let u=l[c],h=u[0],d=this.isMethod?!this.getInputByName(h):!0,p=h;if(this.keywords[h]||this.useKeywords&&d&&kl.containsKeyword(h)){let g=this.keywords[h];if(!g){let x=kl.getKeywordData(h);x.cache&&(g=t.keywords[h]),g=g||kl.getKeyword(h,t),x.cache&&(t.keywords[h]=g)}p=g.build(t)}h!==p&&o[u.index+a-1]!=="."&&(o=o.substring(0,u.index+a)+p+o.substring(u.index+h.length+a),a+=p.length-h.length),this.getIncludeByName(p)===void 0&&kl.contains(p)&&t.include(kl.get(p))}return e==="source"?o:this.isMethod?(this.isInterface||t.include(this,void 0,o),this.name):t.format("( "+o+" )",this.getType(t),e)}parse(t,e,i,r){if(this.src=t||"",this.includes=e??[],this.extensions=i??{},this.keywords=r??{},this.isMethod){let n=Ewe.exec(this.src);if(this.inputs=[],n&&n.length==4){this.type=n[1],this.name=n[2];let s=n[3].match(lG);if(s){let a=0;for(;a<s.length;){let o=s[a++],l;o==="in"||o==="out"||o==="inout"?l=s[a++]:(l=o,o="");let c=s[a++];this.inputs.push({name:c,type:l,qualifier:o})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},Awe=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,QY=class extends an{constructor(t="",e){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(t||QY.PI,void 0,void 0,void 0,e)}getType(t){return t.getTypeByFormat(this.type)}parse(t,e,i,r,n){this.src=t||"";let s,a,o="",l=Awe.exec(t);this.useDefine=n??this.src.charAt(0)==="#",l&&l.length>1?(a=l[1],s=l[2],o=l[3]):(s=this.src,a="f"),this.name=s,this.type=a,this.value=o}build(t,e){if(e==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return t.include(this),t.format(this.name,this.getType(t),e)}generate(t,e,i,r,n){return t.format(this.name,this.getType(t),e)}},Gr=QY;Gr.PI="PI",Gr.PI2="PI2",Gr.RECIPROCAL_PI="RECIPROCAL_PI",Gr.RECIPROCAL_PI2="RECIPROCAL_PI2",Gr.LOG2="LOG2",Gr.EPSILON="EPSILON";var Twe=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),Cwe=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),ZY=class extends an{constructor(t=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(t)}getType(t){return t.getTypeByFormat(this.name)}getInputByName(t){let e=this.inputs.length;for(;e--;)if(this.inputs[e].name===t)return this.inputs[e]}generate(t,e,i,r,n){return e==="source"?this.src+";":t.format("( "+this.src+" )",this.getType(t),e)}parse(t=""){this.src=t,this.inputs=[];let e=Twe.exec(t);if(e){let i=e[2],r;for(;r=Cwe.exec(i);)this.inputs.push({type:r[1],name:r[2]});this.name=e[1]}else this.name="";this.type=this.name}},g4=class extends an{constructor(t){super("v2",{shared:!1}),this.nodeType="UV",this.index=t??0}generate(t,e){t.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",r=t.isShader("vertex")?"uv"+i:"vUv"+i;return t.format(r,this.getType(t),e)}};kl.addKeyword("uv",function(){return new g4});kl.addKeyword("uv2",function(){return new g4(1)});var Zx=class extends an{constructor(t,e){super("v4"),this.nodeType="ColorSpace",this.input=t,this.method=e??Zx.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(t){switch(t){case vh:return["Linear"];case ji:return["sRGB"];default:return[]}}generate(t,e){var a;let i=this.input.build(t,"v4"),r=this.getType(t),n=Zx.Nodes[this.method],s=t.include(n);if(s===Zx.LINEAR_TO_LINEAR)return t.format(i,r,e);if(((a=n.inputs)==null?void 0:a.length)===2){let o=this.factor.build(t,"f");return t.format(s+"( "+i+", "+o+" )",r,e)}else return t.format(s+"( "+i+" )",r,e)}fromEncoding(t){let e=Zx.getEncodingComponents(t);this.method="LinearTo"+e[0],this.factor=e[1]}fromDecoding(t){let e=Zx.getEncodingComponents(t);this.method=e[0]+"ToLinear",this.factor=e[1]}},Od=Zx;Od.Nodes={LinearToLinear:new Ht(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new Ht(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new Ht(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},Od.LINEAR_TO_LINEAR="LinearToLinear",Od.SRGB_TO_LINEAR="sRGBToLinear",Od.LINEAR_TO_SRGB="LinearTosRGB";var Tn=class extends Ht{constructor(t="",e,i,r,n){super(t,n,r,i,e),this.nodeType="Expression"}},up=class extends Yl{constructor(t=new ns,e,i,r){super("v4",{shared:!0}),this.nodeType="Texture",this.value=t,this.uv=e??new g4,this.bias=i,this.project=r!==void 0?r:!1}getTexture(t,e){return super.generate(t,e,this.value.uuid,"t")}generate(t,e){if(e==="sampler2D")return this.getTexture(t,e);let i=this.getTexture(t,e),r=this.uv.build(t,this.project?"v4":"v2"),n=this.bias?this.bias.build(t,"f"):void 0;n===void 0&&t.context.bias&&(n=t.context.bias.setTexture(this).build(t,"f"));let s,a;this.project?s="texture2DProj":s=n?"tex2DBias":"tex2D",n?a=s+"( "+i+", "+r+", "+n+" )":a=s+"( "+i+", "+r+" )";let o={include:t.isShader("vertex"),ignoreCache:!0},l=this.getType(t);return t.addContext(o),this.colorSpace=this.colorSpace??new Od(new Tn("",l)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(a),a=this.colorSpace.build(t,l),t.removeContext(),t.format(a,l,e)}},$t=class extends Yl{constructor(t){super("f"),this.nodeType="Float",this.value=t??0}generateReadonly(t,e,i,r,n,s){return t.format(this.value+(this.value%1?"":".0"),r,e)}},cG=class extends an{constructor(t,e){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=t,this.inputs=e??[]}getFunction(){return this.value}getType(t){return this.value.getType(t)}generate(t,e,i,r,n){r=this.getType(t);let s=this.value,a=s.build(t,e)+"( ",o=[];if(s.inputs){for(let l=0;l<s.inputs.length;l++){let c=s.inputs[l],u=this.inputs[l]||this.inputs[c.name];o.push(u.build(t,t.getTypeByFormat(c.type)))}a+=o.join(", ")+" )"}return t.format(a,r,e)}},KY=class extends an{constructor(t,e,i=KY.ADD){super(),this.nodeType="Operator",this.type=t.type,this.a=t,this.b=e,this.op=i}getType(t){let e=this.a.getType(t),i=this.b.getType(t);return t.isTypeMatrix(e)?"v4":t.getTypeLength(i)>t.getTypeLength(e)?i:e}generate(t,e){let i=this.getType(t);this.type=i;let r=this.a.build(t,i),n=this.b.build(t,i);return t.format("( "+r+" "+this.op+" "+n+" )",i,e)}},zl=KY;zl.ADD="+",zl.SUB="-",zl.MUL="*",zl.DIV="/";var en=class extends an{constructor(t,e=en.ABS,i,r){super(),this.nodeType="Math",this.a=t,typeof e!="string"?this.b=e:r=e,typeof i!="string"?this.c=i:r=i,this.method=r,this.hashProperties=["method"]}getNumInputs(t){switch(this.method){case en.MIX:case en.CLAMP:case en.REFRACT:case en.SMOOTHSTEP:case en.FACEFORWARD:return 3;case en.MIN:case en.MAX:case en.MOD:case en.STEP:case en.REFLECT:case en.DISTANCE:case en.DOT:case en.CROSS:case en.POW:return 2;default:return 1}}getInputType(t){let e=t.getTypeLength(this.a.getType(t)),i=this.b?t.getTypeLength(this.b.getType(t)):0,r=this.c?t.getTypeLength(this.c.getType(t)):0;return e>i&&e>r?this.a.getType(t):i>r?this.b.getType(t):this.c.getType(t)}getType(t){switch(this.method){case en.LENGTH:case en.DISTANCE:case en.DOT:return"f";case en.CROSS:return"v3"}return this.getInputType(t)}generate(t,e){let i,r,n,s=this.a?t.getTypeLength(this.a.getType(t)):0,a=this.b?t.getTypeLength(this.b.getType(t)):0,o=this.c?t.getTypeLength(this.c.getType(t)):0,l=this.getInputType(t),c=this.getType(t);switch(this.type=c,this.method){case en.NEGATE:return t.format("( -"+this.a.build(t,l)+" )",l,e);case en.INVERT:return t.format("( 1.0 - "+this.a.build(t,l)+" )",l,e);case en.CROSS:i=this.a.build(t,"v3"),r=this.b.build(t,"v3");break;case en.STEP:i=this.a.build(t,s===1?"f":l),r=this.b.build(t,l);break;case en.MIN:case en.MAX:case en.MOD:i=this.a.build(t,l),r=this.b.build(t,a===1?"f":l);break;case en.REFRACT:i=this.a.build(t,l),r=this.b.build(t,l),n=this.c.build(t,"f");break;case en.MIX:i=this.a.build(t,l),r=this.b.build(t,l),n=this.c.build(t,o===1?"f":l);break;default:i=this.a.build(t,l),this.b&&(r=this.b.build(t,l)),this.c&&(n=this.c.build(t,l));break}let u=[];u.push(i),r&&u.push(r),n&&u.push(n);let h=this.getNumInputs(t);if(u.length!==h)throw Error(`Arguments not match used in "${this.method}". Require ${h}, currently ${u.length}.`);return t.format(this.method+"( "+u.join(", ")+" )",c,e)}},Hi=en;Hi.RAD="radians",Hi.DEG="degrees",Hi.EXP="exp",Hi.EXP2="exp2",Hi.LOG="log",Hi.LOG2="log2",Hi.SQRT="sqrt",Hi.INV_SQRT="inversesqrt",Hi.FLOOR="floor",Hi.CEIL="ceil",Hi.NORMALIZE="normalize",Hi.FRACT="fract",Hi.SATURATE="saturate",Hi.SIN="sin",Hi.COS="cos",Hi.TAN="tan",Hi.ASIN="asin",Hi.ACOS="acos",Hi.ARCTAN="atan",Hi.ABS="abs",Hi.SIGN="sign",Hi.LENGTH="length",Hi.NEGATE="negate",Hi.INVERT="invert",Hi.MIN="min",Hi.MAX="max",Hi.MOD="mod",Hi.STEP="step",Hi.REFLECT="reflect",Hi.DISTANCE="distance",Hi.DOT="dot",Hi.CROSS="cross",Hi.POW="pow",Hi.MIX="mix",Hi.CLAMP="clamp",Hi.REFRACT="refract",Hi.SMOOTHSTEP="smoothstep",Hi.FACEFORWARD="faceforward";var BS=class extends an{constructor(t,e,i){super("v4"),this.nodeType="TextureCubeUV",this.value=t,this.uv=e,this.bias=i}bilinearCubeUV(t,e,i,r){let n=new cG(BS.Nodes.bilinearCubeUV,[e,i,r]);this.colorSpaceTL=this.colorSpaceTL??new Od(new Tn("","v4")),this.colorSpaceTL.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(n.build(t)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new Od(new Tn("","v4")),this.colorSpaceTR.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(n.build(t)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new Od(new Tn("","v4")),this.colorSpaceBL.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(n.build(t)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new Od(new Tn("","v4")),this.colorSpaceBR.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(n.build(t)+".br");let s={include:t.isShader("vertex"),ignoreCache:!0};t.addContext(s),this.colorSpaceTLExp=new Tn(this.colorSpaceTL.build(t,"v4"),"v4"),this.colorSpaceTRExp=new Tn(this.colorSpaceTR.build(t,"v4"),"v4"),this.colorSpaceBLExp=new Tn(this.colorSpaceBL.build(t,"v4"),"v4"),this.colorSpaceBRExp=new Tn(this.colorSpaceBR.build(t,"v4"),"v4"),t.removeContext();let a=new Tn("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=n,a}generate(t,e){if(t.isShader("fragment")){let i=this.uv,r=this.bias||t.context.roughness,n=new cG(BS.Nodes.roughnessToMip,[r]),s=new Hi(n,BS.Nodes.m0,BS.Nodes.cubeUV_maxMipLevel,Hi.CLAMP),a=new Hi(s,Hi.FLOOR),o=new Hi(s,Hi.FRACT),l=this.bilinearCubeUV(t,this.value,i,a),c=this.bilinearCubeUV(t,this.value,i,new zl(a,new $t(1).setReadonly(!0),zl.ADD)),u=new Hi(l,c,o,Hi.MIX);return t.format(u.build(t),"v4",e)}else return console.warn("TextureCubeUVNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e)}},qU=BS;qU.Nodes=function(){let t=new ZY(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),e=new Gr("float cubeUV_maxMipLevel 8.0",!0),i=new Gr("float cubeUV_minMipLevel 4.0",!0),r=new Gr("float cubeUV_maxTileSize 256.0",!0),n=new Gr("float cubeUV_minTileSize 16.0",!0),s=new Ht(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);s.useKeywords=!1;let a=new Ht(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);a.useKeywords=!1;let o=new Ht(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[t,s,a,e,i,r,n]);o.useKeywords=!1;let l=new Gr("float r0 1.0",!0),c=new Gr("float v0 0.339",!0),u=new Gr("float m0 -2.0",!0),h=new Gr("float r1 0.8",!0),d=new Gr("float v1 0.276",!0),p=new Gr("float m1 -1.0",!0),g=new Gr("float r4 0.4",!0),x=new Gr("float v4 0.046",!0),v=new Gr("float m4 2.0",!0),b=new Gr("float r5 0.305",!0),w=new Gr("float v5 0.016",!0),M=new Gr("float m5 3.0",!0),E=new Gr("float r6 0.21",!0),D=new Gr("float v6 0.0038",!0),T=new Gr("float m6 4.0",!0),L=[l,c,u,h,d,p,g,x,v,b,w,M,E,D,T],P=new Ht(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,L);return{bilinearCubeUV:o,roughnessToMip:P,m0:u,cubeUV_maxMipLevel:e}}();var Kx=class extends an{constructor(t){super("v3"),this.nodeType="Normal",this.scope=t??Kx.VIEW}getShared(){return this.scope===Kx.WORLD}build(t,e,i,r){let n=t.context[this.scope+"Normal"];return n?n.build(t,e,i,r):super.build(t,e,i)}generate(t,e,i,r,n){let s;switch(this.scope){case Kx.VIEW:t.isShader("vertex")?s="transformedNormal":s="geometryNormal";break;case Kx.LOCAL:t.isShader("vertex")?s="objectNormal":(t.requires.normal=!0,s="vObjectNormal");break;case Kx.WORLD:t.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(t.requires.worldNormal=!0,s="vWNormal");break}return t.format(s,this.getType(t),e)}},Hl=Kx;Hl.LOCAL="local",Hl.WORLD="world",Hl.VIEW="view",Hl.NORMAL="normal";kl.addKeyword("viewNormal",function(){return new Hl(Hl.VIEW)});kl.addKeyword("localNormal",function(){return new Hl(Hl.NORMAL)});kl.addKeyword("worldNormal",function(){return new Hl(Hl.WORLD)});var tp=class extends an{constructor(t){super("v3"),this.nodeType="Position",this.scope=t??tp.LOCAL}getType(){switch(this.scope){case tp.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case tp.LOCAL:case tp.WORLD:return!1}return!0}generate(t,e,i,r,n){let s;switch(this.scope){case tp.LOCAL:t.isShader("vertex")?s="transformed":(t.requires.position=!0,s="vPosition");break;case tp.WORLD:if(t.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";t.requires.worldPosition=!0,s="vWPosition";break;case tp.VIEW:s=t.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case tp.PROJECTION:s=t.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return t.format(s,this.getType(),e)}},hh=tp;hh.LOCAL="local",hh.WORLD="world",hh.VIEW="view",hh.PROJECTION="projection";kl.addKeyword("position",function(){return new hh});kl.addKeyword("worldPosition",function(){return new hh(hh.WORLD)});kl.addKeyword("viewPosition",function(){return new hh(hh.VIEW)});var Md=class extends an{constructor(t){super("v3"),this.nodeType="Reflect",this.scope=t??Md.CUBE}getUnique(t){return!t.context.viewNormal}getType(){switch(this.scope){case Md.SPHERE:return"v2"}return this.type}generate(t,e){let i=this.getUnique(t);if(t.isShader("fragment")){let r;switch(this.scope){case Md.VECTOR:{let n=new Hl(Hl.VIEW),s=t.context.roughness,a=n.build(t,"v3"),o=new hh(hh.VIEW).build(t,"v3"),l=s?s.build(t,"f"):void 0,c=`reflect( -normalize( ${o} ), ${a} )`;l&&(c=`normalize( mix( ${c}, ${a}, ${l} * ${l} ) )`);let u=`inverseTransformDirection( ${c}, viewMatrix )`;i?(t.addNodeCode(`vec3 reflectVec = ${u};`),r="reflectVec"):r=u;break}case Md.CUBE:{let n=new Md(Md.VECTOR).build(t,"v3"),s="vec3( -"+n+".x, "+n+".yz )";i?(t.addNodeCode(`vec3 reflectCubeVec = ${s};`),r="reflectCubeVec"):r=s;break}case Md.SPHERE:{let n="normalize( ( viewMatrix * vec4( "+new Md(Md.VECTOR).build(t,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(t.addNodeCode(`vec2 reflectSphereVec = ${n};`),r="reflectSphereVec"):r=n;break}}return t.format(r,this.getType(),e)}else return console.warn("ReflectNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.type,e)}},_1=Md;_1.CUBE="cube",_1.SPHERE="sphere",_1.VECTOR="vector";var Dwe=class extends an{constructor(t=new up,e,i){super("v4"),this.nodeType="TextureCube",this.value=t,this.radianceNode=new qU(this.value,e??new _1(_1.VECTOR),i),this.irradianceNode=new qU(this.value,new Hl(Hl.WORLD),new $t(1).setReadonly(!0))}generate(t,e){return t.isShader("fragment")?(t.require("irradiance"),t.context.bias&&t.context.bias.setTexture(this.value),(t.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(t,e)):(console.warn("TextureCubeNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e))}},Pwe=class extends Yl{constructor(t=new xN,e,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=t,this.uv=e??new _1,this.bias=i}getTexture(t,e){return super.generate(t,e,this.value.uuid,"tc")}generate(t,e){var l;if(e==="samplerCube")return this.getTexture(t,e);let i=this.getTexture(t,e),r=(l=this.uv)==null?void 0:l.build(t,"v3"),n=this.bias?this.bias.build(t,"f"):void 0;n===void 0&&t.context.bias&&(n=t.context.bias.setTexture(this).build(t,"f"));let s;n?s="texCubeBias( "+i+", "+r+", "+n+" )":s="texCube( "+i+", "+r+" )";let a={include:t.isShader("vertex"),ignoreCache:!0},o=this.getType(t);return t.addContext(a),this.colorSpace=this.colorSpace??new Od(new Tn("",o)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(s),s=this.colorSpace.build(t,o),t.removeContext(),t.format(s,o,e)}},Rwe=`
uniform int frameIndex;
uniform vec2 resolution;
uniform mat4 previousModelViewMatrix;
uniform mat4 previousProjectionMatrix;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
`,Owe=`
layout(location = 1) out vec4 gVelocity;

uniform int frameIndex;
uniform vec2 resolution;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;

const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos) {
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

`,Lwe=`
// TODO: This could be generated CPU side and passed to the shader every frame
const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

// TODO: Pass correct view size
vec2 offset = haltonSequence[frameIndex];
offset.x /= resolution.x;
offset.y /= resolution.y;

vec4 currentPosition = gl_Position;
vec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);

// We want to calculate the velocity with unjittered positions
// so that things that are not moving get a velocity = 0
vCurrentPosition = currentPosition;
vPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);
#ifdef OUTLINE_COMPENSATION
vPreviousPosition.xy += OUTLINE_COMPENSATION;
#endif
gl_Position = currentPositionJittered;

`,Iwe=`
vec2 oldPos = vPreviousPosition.xy;
    oldPos /= vPreviousPosition.w;
    oldPos.xy = (oldPos.xy+1.)/2.0;

vec2 newPos = vCurrentPosition.xy;
    newPos /= vCurrentPosition.w;
    newPos.xy = (newPos.xy+1.)/2.0;

vec2 velocity = (newPos - oldPos);

// Discard fully transparent pixels 
if (gl_FragColor.a <= 0.0) discard;

gVelocity = vec4(velocity, 0.0, 1.0);
`,zwe=`
layout(location = 1) out vec4 gVelocity;
`,Uwe=`
    // Discard fully transparent pixels 
    if (gl_FragColor.a <= 0.0) discard;

    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);
`,uG=["x","y","z","w"],Bwe=["float","vec2","vec3","vec4"],Nwe={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},Fwe={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},JY=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function t(e,i){return e.deps.length-i.deps.length}return function(e,i){let r=this.getIncludes(e,i);if(!r)return"";let n="";r=r.sort(t);for(let s=0;s<r.length;s++)r[s].src&&(n+=r[s].src+`
`);return n}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(t,e){this.addVertexParsCode(Rwe),this.addFragmentParsCode(Owe),this.buildShader("vertex",t),this.buildShader("fragment",e);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let r=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode(`
				#ifndef SHAPEBLEND 
					vObjectNormal = normal;
				#else
					vObjectNormal = objectNormal;
				#endif
			`)),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(Lwe),this.addFragmentFinalCode(Iwe)),this}buildShader(t,e){this.resultCode[t]=e.build(this.setShader(t),"v4")}setMaterial(t,e){return this.defines={},this}addFlow(t,e,i){return this.addSlot(t).addCache(e).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(t){return this.cache=t??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(t){return this.context=Object.assign({},this.context,t),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(t){return this.slot=t||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(t,e){this.fragmentVariables[t]===void 0&&(this.addFragmentCode(`${e} ${t};`),this.fragmentVariables[t]="")}addFragmentParsVariable(t,e){this.fragmentParsVariables[t]===void 0&&(this.addFragmentParsCode(`${e} ${t};`),this.fragmentParsVariables[t]="")}addVertexParsVariable(t,e){this.vertexParsVariables[t]===void 0&&(this.addVertexParsCode(`${e} ${t};`),this.vertexParsVariables[t]="")}addVertexCode(t){this.addCode(t,"vertex")}addFragmentCode(t){this.addCode(t,"fragment")}addCode(t,e){this.code[e??this.shader]+=t+`
`}addVertexNodeCode(t){this.addNodeCode(t,"vertex")}addFragmentNodeCode(t){this.addNodeCode(t,"fragment")}addNodeCode(t,e){this.nodeCode[e??this.shader]+=t+`
`}clearNodeCode(t){t=t??this.shader;let e=this.nodeCode[t];return this.nodeCode[t]="",e}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(t){this.addFinalCode(t,"vertex")}addFragmentFinalCode(t){this.addFinalCode(t,"fragment")}addFinalCode(t,e){this.finalCode[e??this.shader]+=t+`
`}addVertexParsCode(t){this.addParsCode(t,"vertex")}addFragmentParsCode(t){this.addParsCode(t,"fragment")}addParsCode(t,e){this.parsCode[e??this.shader]+=t+`
`}addVaryCode(t){this.addVertexParsCode(t),this.addFragmentParsCode(t)}isCache(t){return this.caches.indexOf(t)!==-1}isSlot(t){return this.slots.indexOf(t)!==-1}define(t,e){this.defines[t]=e===void 0?1:e}require(t){this.requires[t]=!0}isDefined(t){return this.defines[t]!==void 0}getVar(t,e,i,r="varying",n="V",s=""){let a=this.getVars(r),o=a[t];if(!o){let l=a.length;o={name:i||"node"+n+l+(s?"_"+s:""),type:e},a.push(o),a[t]=o}return o}getTempVar(t,e,i,r){return this.getVar(t,e,i,this.shader,"T",r)}getAttribute(t,e){if(!this.attributes[t]){let i=this.getVar(t,e);this.addVertexParsCode("attribute "+e+" "+t+";"),this.addVertexFinalCode(i.name+" = "+t+";"),this.attributes[t]={varying:i,name:t,type:e}}return this.attributes[t]}getCode(t){return[this.prefixCode,this.parsCode[t],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[t],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[t],"uniform"),this.getIncludesCode("consts",t),this.getIncludesCode("structs",t),this.getIncludesCode("functions",t),"void main() {",this.getVarListCode(this.getVars(t)),this.code[t],this.resultCode[t],this.finalCode[t],"}"].join(`
`)}getVarListCode(t,e){e=e??"";let i="";for(let r=0,n=t.length;r<n;++r){let s=t[r],a=s.type,o=s.name,l=s.size,c=this.getFormatByType(a);if(c===void 0)throw new Error("Node pars "+c+" not found.");c.includes("[]")?i+=e+" "+c.substring(0,c.length-2)+" "+o+`[${l}];
`:i+=e+" "+c+" "+o+`;
`}return i}getVars(t){return this.inputs.vars[t??this.shader]}getNodeData(t){let e=t instanceof ta?t.uuid:t;return this.nodeData[e]=this.nodeData[e]||{}}createUniform(t,e,i,r,n,s){if(e.includes("[]")){let a=this.inputs.arrayUniforms,o=a.list.length,l=new oG({type:e,size:i.size,name:r||"nodeUA"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[t].push(l),a[t][l.name]=l,this.uniforms[l.name]=l,l}else{let a=this.inputs.uniforms,o=a.list.length,l=new oG({type:e,name:r||"nodeU"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[t].push(l),a[t][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(t,e,i,r,n){return this.createUniform("vertex",t,e,i,r,n)}createFragmentUniform(t,e,i,r,n){return this.createUniform("fragment",t,e,i,r,n)}include(t,e,i){var s;let r;if(t=typeof t=="string"?kl.get(t):t,this.context.include===!1)return t.name;t instanceof Ht?r=this.includes.functions:t instanceof Gr?r=this.includes.consts:t instanceof ZY&&(r=this.includes.structs);let n=r[this.shader]=r[this.shader]||[];if(t){let a=n[t.name];if(a||(a=n[t.name]={node:t,deps:[]},n.push(a),a.src=t.build(this,"source")),t instanceof Ht&&e&&n[e.name]&&n[e.name].deps.indexOf(t)===-1&&(n[e.name].deps.push(t),(s=t.includes)==null?void 0:s.length)){let o=0;do this.include(t.includes[o++],e);while(o<t.includes.length)}return i&&(a.src=i),t.name}else throw new Error("Include not found.")}colorToVectorProperties(t){return t.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(t){return t.replace(/c/g,"v3")}getIncludes(t,e){return this.includes[t][e||this.shader]}getConstructorFromLength(t){return Bwe[t-1]}isTypeMatrix(t){return/^m/.test(t)}getTypeLength(t){return t==="f"?1:parseInt(this.colorToVector(t).substr(1))}getTypeFromLength(t){return t===1?"f":"v"+t}findNode(...t){for(let e=0;e<arguments.length;e++){let i=t[e];if(i!=null&&i.isNode)return i}}resolve(...t){for(let e=0;e<arguments.length;e++){let i=t[e];if(i!==void 0){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case R0:case O0:return new Pwe(i);case yM:return new Dwe(new up(i));default:return new up(i)}else{if(i.isVector2)return new Za(i);if(i.isVector3)return new Yc(i);if(i.isVector4)return new np(i)}}}}format(t,e,i){switch(this.colorToVector(i+" <- "+e)){case"f <- v2":return t+".x";case"f <- v3":return t+".x";case"f <- v4":return t+".x";case"f <- i":case"f <- b":return"float( "+t+" )";case"v2 <- f":return"vec2( "+t+" )";case"v2 <- v3":return t+".xy";case"v2 <- v4":return t+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+t+" ) )";case"v3 <- f":return"vec3( "+t+" )";case"v3 <- v2":return"vec3( "+t+", 0.0 )";case"v3 <- v4":return t+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+t+" ) )";case"v4 <- f":return"vec4( "+t+" )";case"v4 <- v2":return"vec4( "+t+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+t+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+t+" ) )";case"i <- f":case"i <- b":return"int( "+t+" )";case"i <- v2":return"int( "+t+".x )";case"i <- v3":return"int( "+t+".x )";case"i <- v4":return"int( "+t+".x )";case"b <- f":return"( "+t+" != 0.0 )";case"b <- v2":return"( "+t+" != vec2( 0.0 ) )";case"b <- v3":return"( "+t+" != vec3( 0.0 ) )";case"b <- v4":return"( "+t+" != vec4( 0.0 ) )";case"b <- i":return"( "+t+" != 0 )"}return t}getTypeByFormat(t){return Nwe[t]||t}getFormatByType(t){return Fwe[t]||t}getUUID(t,e){return e=e!==void 0?e:!0,e&&this.cache&&(t=this.cache+"-"+t),t}getElementByIndex(t){return uG[t]}getIndexByElement(t){return uG.indexOf(t)}isShader(t){return this.shader===t}setShader(t){return this.shader=t,this}mergeDefines(t){for(let e in t)this.defines[e]=t[e];return this.defines}mergeUniform(t){for(let e in t)this.uniforms[e]=t[e];return this.uniforms}getTextureEncodingFromMap(t){let e;return t?t.isTexture&&(e=t.encoding):e=vh,e===vh&&this.context.gamma&&(e=ji),e}},bs=class extends Yl{constructor(t=0,e,i,r){super("c"),this.nodeType="Color",this.value=t instanceof ro?t:new ro(t||0,e,i,r)}setRGBA(t){this.value.setRGBA(t.r,t.g,t.b,t.a)}generate(t,e,i,r,n,s){i=t.getUUID(i??this.getUUID()),r=r??this.getType(t);let a=t.getNodeData(i),o=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let l=this.alpha.build(t,"f");t.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return o?this.generateReadonly(t,e,i,r,n,s):t.isShader("vertex")?(a.vertex||(a.vertex=t.createVertexUniform(r,this,n,s,this.getLabel())),t.format(a.vertex.name,r,e)):(a.fragment||(a.fragment=t.createFragmentUniform(r,this,n,s,this.getLabel())),t.format(a.fragment.name,r,e))}generateReadonly(t,e,i,r,n,s){return t.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",r,e)}},hn=class extends Yl{constructor(t){super("i"),this.nodeType="Int",this.value=Math.floor(t??0)}generateReadonly(t,e,i,r,n,s){return t.format(this.value.toString(),r,e)}},rl=class extends Yl{constructor(t){super("b"),this.nodeType="Bool",this.value=t??!1}generateReadonly(t,e,i,r){return t.format(this.value?"true":"false",r,e)}},Xv=class extends Yl{constructor(t=1,e){super("f[]"),this.nodeType="FloatArray",this.size=t,this.value=Array.isArray(e)?e:typeof e=="number"?new Array(t).fill(e):new Array(t).fill(0)}},v4=class extends Yl{},kwe=class extends v4{constructor(t){super("v3"),this.image=t,this._value=new W}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},XU=class extends v4{constructor(t,e,i=1008,r=1006){super("t"),this.image=t,this.wrap=e,this.minFilter=i,this.magFilter=r}get value(){return this.image.getTexture(this.wrap,this.minFilter,this.magFilter)}},$Y=class extends Yl{constructor(t){super("m3"),this.nodeType="Matrix3",this.value=t??new Hs}generateReadonly(t,e,i,r,n,s){return t.format("mat3("+this.value.elements.join(", ")+")",r,e)}get elements(){return this.value.elements}set elements(t){this.value.fromArray(t)}},Xd=class extends Yl{constructor(t){super("m4"),this.nodeType="Matrix4",this.value=t??new Ot}generateReadonly(t,e,i,r,n,s){return t.format("mat4("+this.value.elements.join(", ")+")",r,e)}get elements(){return this.value.elements}set elements(t){this.value.fromArray(t)}};function hG(t,e,i,r=0){t.setUvTransform(i[0],i[1],e[0],e[1],0,0,0).premultiply(new Hs().makeRotation(r*Qt.DEG2RAD))}var Vwe=class extends $Y{constructor(t,e,i=0){super(new Hs),this.repeat=t,this.offset=e,this.rotation=i,hG(this.value,t,e,i)}updateMatrix(){hG(this.value,this.repeat,this.offset,this.rotation)}},Yv=class extends Yl{constructor(t=1,e){super("v4[]"),this.nodeType="Vector4Array",this.size=t,this.value=Array.isArray(e)?e:e instanceof Ri?new Array(t).fill(e):new Array(t).fill(new Ri(0))}},dG=class extends an{constructor(t,e,i,r){super("v3"),this.nodeType="Blend",this.a=t,this.b=e,this.alpha=i,this.mode=r}generate(t,e){if(t.isShader("fragment")){let i=[];return i.push(this.a.build(t,"c")),i.push(this.b.build(t,"c")),i.push(this.alpha.build(t,"f")),i.push(this.mode.build(t,"i")),t.format("spe_blend("+i.join(",")+")",this.getType(t),e)}else return console.warn("BlendNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},eQ=class extends an{constructor(t,e){super("v3"),this.nodeType="CustomColor",this.color=t,this.alpha=e,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){let i=t.include(eQ.Nodes.customColor);t.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.color.build(t,"v3")),r.push(this.mask?`luminance(${this.mask.build(t,"v3")})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("CustomColorNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},YU=eQ;YU.Nodes=function(){return{customColor:new Ht(`vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color;
			}`)}}();var tQ=class extends an{constructor(t,e){super("v3"),this.nodeType="CustomNormal",this.cnormal=t,this.alpha=e,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){let i=t.include(tQ.Nodes.customNormal);t.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.cnormal.build(t,"v3")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("CustomNormalNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},iQ=tQ;iQ.Nodes=function(){return{customNormal:new Ht(`vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return normal;
			}`)}}();var NS=class extends an{constructor(t,e,i,r,n,s,a,o,l,c,u,h){super("v3"),this.nodeType="CustomTexture",this.texture=t,this.textureSize=e,this.crop=i,this.projection=r,this.axis=n,this.side=s,this.size=a,this.blending=o,this.mat=l,this.isMask=h,this.alpha=c,this.mode=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){t.require("position"),t.require("normal"),t.require("uv"),t.requires.uv=[!0],t.extensions.shaderTextureLOD=!0,t.extensions.derivatives=!0;let i=`g${this.uuid.toString().replace(/-/g,"")}`,r;switch(this.projection.value){case 3:r=t.include(NS.Nodes.cylindrical);break;case 2:r=t.include(NS.Nodes.spherical);break;case 1:let s=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],a=["zy","xz","xy"][this.axis.value],o=new Ht(`
		vec3 ${i}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 projected = (1. + (position.${a})) / 2.;
				vec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, ${s}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`);r=t.include(o);break;case 4:r=t.include(NS.Nodes.triplanar);break;default:r=t.include(NS.Nodes.uv);break}t.addFragmentVariable(this.calpha,"float");let n=[];if(n.push("normal"),n.push(this.texture.generate(t,"t")),n.push(this.textureSize.build(t,"v2")),n.push(this.crop.build(t,"f")),n.push(this.mat.build(t,"mat3")),n.push(this.size.build(t,"v2")),n.push(this.blending.build(t,"f")),n.push(this.isMask.build(t,"b")),n.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),n.push(this.alpha.build(t,"f")),n.push(this.mode.build(t,"i")),n.push(this.calpha),this.projection.value===4){let s=`${i}_writeUvs`,a=s+"0",o=s+"1",l=s+"2",c=`${i}_triplanarWeights`;t.addFragmentVariable(a,"vec2"),t.addFragmentVariable(o,"vec2"),t.addFragmentVariable(l,"vec2"),t.addFragmentVariable(c,"vec3"),n.push(a),n.push(o),n.push(l),n.push(c)}else{let s=`${i}_writeUvs`;t.addFragmentVariable(s,"vec2"),n.push(s)}return t.format(r+"("+n.join(",")+")",this.getType(t),e)}},y4=NS;y4.Nodes=function(){let t=new Ht(`
vec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),e=new Ht(`
vec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),i=new Ht(`vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`),r=new Ht(`vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {
				vec3 p = position;
				vec2 uv0 = (1.0 + p.xy) / 2.0;     
				vec2 uv1 = (1.0 + p.zy) / 2.0;		
				vec2 uv2 = (1.0 + p.xz) / 2.0;		
	
				uv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;

				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));

				// Write out all sets of UVs that we generated
				writeUvs0 = uv0;
				writeUvs1 = uv1;
				writeUvs2 = uv2;
				writeWeights = weights;

				// Derivatives for LOD
				vec2 df0 = fwidth(uv0);
				vec2 df1 = fwidth(uv1);
				vec2 df2 = fwidth(uv2);
				if (df0.x > 0.5) df0.x = 0.0;
				if (df1.x > 0.5) df1.x = 0.0;
				if (df2.x > 0.5) df2.x = 0.0;

				#ifdef GL_EXT_shader_texture_lod
                	vec4 tmp = 
						texture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						texture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						texture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#else
                	vec4 tmp = 
						textureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						textureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						textureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;

				// Apply cropping across all 3 planes
				if ( crop > 0.5 ) {
					if ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;//n * 0.5 + 0.5;
			}			
			`);return{cylindrical:t,spherical:e,uv:i,triplanar:r}}();var FS=class extends an{constructor(t,e,i,r,n,s,a,o,l,c,u,h){super("v3"),this.nodeType="Depth",this.gradientType=t,this.smooth=e,this.near=i,this.far=r,this.isVector=n,this.isWorldSpace=s,this.origin=a,this.direction=o,this.colors=l,this.steps=c,this.isMask=h,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){let i=`g${this.uuid.toString().replace(/-/g,"")}`,r=new Ht(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${i}_IS_VECTOR
                   #ifdef ${i}_LINEAR
                       #ifdef ${i}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${i}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${i}_SMOOTH
				for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a * mask;
               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
			   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
			   
               return color.rgb;
			}`,[FS.Nodes.vectorLinearWorldSpaceDepth,FS.Nodes.vectorLinearObjectSpaceDepth,FS.Nodes.vectorSphericalObjectSpaceDepth,FS.Nodes.vectorSphericalWorldSpaceDepth]);if(t.isShader("fragment")){t.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&t.define(`${i}_SMOOTH`),this.isVector.value>.5&&t.define(`${i}_IS_VECTOR`),this.gradientType.value===0&&t.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&t.define(`${i}_WORLDSPACE`),t.require("worldPosition"),t.addFragmentVariable(this.calpha,"float");let n=t.include(r),s=[];return s.push(this.near.build(t,"f")),s.push(this.far.build(t,"f")),s.push(this.origin.build(t,"v3")),s.push(this.direction.build(t,"v3")),s.push(this.colors.build(t,"v4[]")),s.push(this.steps.build(t,"f[]")),s.push(this.isMask.build(t,"b")),s.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),s.push(this.alpha.build(t,"f")),s.push(this.calpha),t.format(n+"("+s.join(",")+")",this.getType(t),e)}else return console.warn("DepthNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},rQ=FS;rQ.Nodes=function(){let t=new Ht(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),e=new Ht(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),i=new Ht(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),r=new Ht(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:t,vectorLinearObjectSpaceDepth:e,vectorSphericalWorldSpaceDepth:i,vectorSphericalObjectSpaceDepth:r}}();var Hwe=class extends an{constructor(t,e,i,r,n,s,a,o){super("v3"),this.nodeType="Fresnel",this.color=t,this.bias=e,this.scale=i,this.intensity=r,this.factor=n,this.isMask=o,this.alpha=s,this.mode=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.require("vWorldViewDir"),t.require("worldNormal"),t.isShader("fragment")){t.addFragmentVariable(this.calpha,"float");let i=new Ht(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {
					float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

					float lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return color;
				}`),r=t.include(i),n=[];return n.push(this.color.build(t,"c")),n.push(this.bias.build(t,"f")),n.push(this.scale.build(t,"f")),n.push(this.intensity.build(t,"f")),n.push(this.factor.build(t,"f")),n.push(this.isMask.build(t,"b")),n.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),n.push(this.alpha.build(t,"f")),n.push(this.mode.build(t,"i")),n.push(this.calpha),t.format(r+"("+n.join(",")+")",this.getType(t),e)}else return console.warn("FresnelNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},nQ=class extends an{constructor(t,e,i,r,n,s,a,o,l){super("v3"),this.nodeType="Gradient",this.gradientType=t,this.smooth=e,this.colors=i,this.steps=r,this.offset=n,this.morph=s,this.angle=a,this.isMask=l,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){t.define("GRAD_MAX",10),t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let i=t.include(nQ.Nodes.gradient),r=[];return r.push(this.gradientType.build(t,"i")),r.push(this.smooth.build(t,"b")),r.push(this.colors.build(t,"v4[]")),r.push(this.steps.build(t,"f[]")),r.push(this.offset.build(t,"v2")),r.push(this.morph.build(t,"v2")),r.push(this.angle.build(t,"f")),r.push(this.isMask.build(t,"b")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("GradientNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},sQ=nQ;sQ.Nodes=function(){return{gradient:new Ht(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
				
				return color.xyz;
			}`)}}();var aQ=class extends an{constructor(t,e,i,r,n){super("v3"),this.nodeType="Matcap",this.texture=t,this.isMask=r,this.alpha=e,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`,this.rotation=n}generate(t,e){if(t.isShader("fragment")){t.addFragmentVariable(this.calpha,"float");let i=t.include(aQ.Nodes.matcap);t.require("normal"),t.requires.normal=!0;let r=[];return r.push(this.texture.generate(t,"t")),r.push("normal"),r.push(this.isMask.build(t,"b")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.mode.build(t,"i")),r.push(this.calpha),r.push(this.rotation.build(t,"f")),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("MatcapNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},oQ=aQ;oQ.Nodes=function(){return{matcap:new Ht(`vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {
					vec3 viewDir = normalize( vViewPosition );
					vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
					vec3 y = cross( viewDir, x );
					vec2 uv = vec2( dot( x, normal ), dot( y, normal ) );
					uv = mat2( cos(rotation), sin(rotation), -sin(rotation), cos(rotation) ) * uv;
					uv = uv * 0.495 + 0.5;
					vec4 matcapColor = texture2D( matcapTex, uv );

					float lalpha = alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
					
					return matcapColor.rgb;
            	}`)}}();var Nl=function(){let t=new Ht(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),e=new Ht(`float simplexFast(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 mediump vec3 x = p - s + dot(s, vec3(G3));
			 mediump vec3 hs = s;
			 
			 mediump vec3 e = step(vec3(0.0), x - x.yzx);
			 mediump vec3 i1 = e*(1.0 - e.zxy);
			 mediump vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 mediump vec3 x1 = x - i1 + G3;
			 mediump vec3 x2 = x - i2 + 2.0*G3;
			 mediump vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 mediump vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(hs), x);
			 d.y = dot(random3(hs + i1), x1);
			 d.z = dot(random3(hs + i2), x2);
			 d.w = dot(random3(hs + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[t]);e.keywords.F3=new Gr("float F3 0.3333333"),e.keywords.G3=new Gr("float G3 0.1666667");let i=new Ht(`float simplexPrecise(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[t]);i.keywords.F3=new Gr("float F3 0.3333333"),i.keywords.G3=new Gr("float G3 0.1666667");let r=new Ht(`float simplexFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplexFast(m * rot1)
				 + 0.2666667 * simplexFast(2.0 * m * rot2)
				 + 0.1333333 * simplexFast(4.0 * m * rot3)
				 + 0.0666667 * simplexFast(8.0 * m);
		}`,[e]),n=new Ht("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),s=new Ht("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),a=new Ht(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[n,s]),o=new Ht("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),l=new Ht("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[o]),c=new Ht(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[l]),u=new Ht(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[c]);u.keywords.NUM_OCTAVES=new Gr("int NUM_OCTAVES 5");let h=new Ht("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),d=new Ht(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[n,s,h]),p=new Ht(`float hashwithoutsine13(vec3 p3)
		{
			p3  = fract(p3 * .1031);
			p3 += dot(p3, p3.yzx + 33.33);
			return fract((p3.x + p3.y) * p3.z);
		}`),g=new Ht(`vec3 hashwithoutsine33(vec3 p3)
		{
			p3 = fract(p3 * vec3(.1031, .1030, .0973));
			p3 += dot(p3, p3.yxz+33.33);
			return fract((p3.xxy + p3.yxx)*p3.zyx);
		}`),x=new Ht(`float metric(in vec3 p)
		{
			// L2 
			return length(p);

			// Chebyshev 
			// vec3 a = abs(p);
			// return max(a.x, max(a.y, a.z));
		}`),v=new Ht(`float smin( float a, float b, float k )
		{
			float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);
			float correction = k * h * (1.0 - h);
			return mix(b, a, h) - correction;
		}`),b=new Ht(`float smax( float a, float b, float k )
		{
			float h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);
			float correction = k * h * (1.0 - h);
			return mix(a, b, h) + correction;
		}`),w=new Ht(`float remap(float value, float input_min, float input_max, float output_min, float output_max) {
			// Compute width of each interval
			float input_width = input_max - input_min;
			float output_width = output_max - output_min;
		
			// Convert input range into a 0-1 range 
			float scaled = (value - input_min) / input_width;
		
			// Convert the 0-1 range into a value in output range
			return output_min + (scaled * output_width);
		}`),M=new Ht(`float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) 
		{
			// Integer and fractional parts of this point's coordinates
			ivec3 p = ivec3(floor(x));
			vec3 f = fract(x);

			// Different variables that we will use to construct noise:
			//
			// f1: distance to the closest feature point
			// f2: distance to the second closest feature point
			// e: distance to the closest edge (cell boundary)
			//
			// We also compute "smooth" versions of all of the above quantites, essentially
			// replacing "hard" minimums with "smooth" minimums (described by IQ)
			float f1_smooth = 8.0;
			float f1 = 8.0;
			float f2_smooth = 8.0;
			float f2 = 8.0;
			float e_smooth = 8.0;
			float e = 8.0;

			// Variables stored from closest cell
			ivec3 mb;
			vec3 mr; 

			int steps = quality;
			
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				ivec3 b = ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d = length(r);
				
				f1_smooth = smin(d, f1_smooth, smoothness);

				// Store un-smoothed distances too 
				if (d < f1) 
				{
					f2 = f1;
					f1 = d;

					mb = ivec3(x, y, z);
					mr = r;
				} 
				else if (d < f2) 
				{
					f2 = d;
				}
			}	
			
			// Second pass for edge distance  
			// skip for styles don't need
			if (style != 0 &&  style != 5 && style != 7)
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				// Start search at the cell that contains the closest point to "x" (found in 1st pass)
				ivec3 b = mb + ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d1 = dot(0.5 * (mr + r), (r - mr)); 				// IQ normalizes "r - mr" but that breaks things for the smooth version?
				float d2 = dot(0.5 * (mr + r), normalize(r - mr));

				e_smooth = smin(d1, e_smooth, smoothness);

				e = min(e, d2);

				// Also compute a smooth version of F2 in this pass
				{
					ivec3 b = ivec3(x, y, z);
					if (b != mb) 
					{
						vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
						float d = length(r);

						f2_smooth = smin(d, f2_smooth, smoothness);
					}
				}
			}

			// Different visualization modes 
			if (style == 0) 
			{
				return f1_smooth;
			}
			if (style == 1) 
			{
				return f2_smooth;
			}
			if (style == 2) 
			{
				return f2_smooth - f1_smooth;
				
				// "Pebbles" also cool
				//return step(0.2, f2_smooth - f1_smooth);
			}
			if (style == 3) 
			{
				// This one is really good for rock / stone effects
				float a = f1; 
				float b = f2;
				float k = 3.0;
				float h = max(k - abs(a - b), 0.0) / k;
				float final = min(a, b) - h * h * k * (1.0 / 4.0);
				return final;
			}
			if (style == 4) 
			{
				// Some random adjustments to make this style stand out more 
				return exp(5.0 * e_smooth);
			}
			if (style == 5) 
			{
				return pow(f1_smooth, 3.0);
			}
			if (style == 6) 
			{				
				const float eps = 0.0125;

				// Thicker lines as the user increases the smoothness slider
				float thickness = smoothness * 0.25 + eps;

				// Blurrier lines as the user increases the smoothness slider
				float blur = pow(smoothness, 3.0) * 0.25 + eps;

				return smoothstep(
					thickness - thickness * blur, 
					thickness + thickness * blur, 
					e
				);
			}
			if (style == 7) 
			{
				return hashwithoutsine13(vec3(p + mb) + seed);
			}
		}
	`,[p,g,x,v,b,w]);return{simplexFast:e,simplexPrecise:i,simplexFractal:r,simplexAshima:a,fbm:u,perlin:d,voronoi:M}}(),lQ=class extends an{constructor(t,e,i,r,n,s,a,o,l,c,u,h,d,p,g,x,v,b,w){super("v3"),this.nodeType="Noise",this.scale=t,this.size=e,this.move=i,this.fA=r,this.fB=n,this.distortion=s,this.colorA=a,this.colorB=o,this.colorC=l,this.colorD=c,this.noiseType=h,this.voronoiStyle=p,this.highCut=g,this.lowCut=x,this.smoothness=v,this.seed=b,this.quality=w,this.isMask=d,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e,i,r,n){t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let s=["simplexFast","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseType.value],a=s=="voronoi"?`
		float v = ${s}(st + move, voronoiStyle, smoothness, seed, quality);

		// Apply clipping to colors
		v = remap(v, lowCut, highCut, 0.0, 1.0);
		v = smax(v, 0.0, smoothness * 0.25);
		v = smin(v, 1.0, smoothness * 0.25);

		// Note that the voronoi mode only uses colors "A" and "C" from the UI 
		vec4 color = mix(colorA, colorC, v); 
		`:`
		vec3 q = vec3(${s}(st),
					   ${s}(st + vec3(1.0)),
					   ${s}(st + vec3(1.0)));
		vec3 r = vec3(${s}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
					  ${s}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
					  ${s}(st * q));
		float f = ${s}(st + r);
		vec4 color;
		color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
		color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
		color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));
		`,o=new Ht(`vec3 ${s}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) 
			{
                // Prevent scale of zero 
				scale = max(abs(scale), 0.001);

				vec3 st = position / size;
				st /= scale;

				${a}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return clamp(color, 0.0, 1.0).rgb;
			}`,[Nl.simplexFast,Nl.simplexFractal,Nl.simplexAshima,Nl.fbm,Nl.perlin,Nl.voronoi]),l=t.include(o),c=[];return c.push(this.scale.build(t,"f")),c.push(this.size.build(t,"v3")),c.push(this.move.build(t,"f")),c.push(this.fA.build(t,"v2")),c.push(this.fB.build(t,"v2")),c.push(this.distortion.build(t,"v2")),c.push(this.colorA.build(t,"v4")),c.push(this.colorB.build(t,"v4")),c.push(this.colorC.build(t,"v4")),c.push(this.colorD.build(t,"v4")),c.push(this.voronoiStyle.build(t,"i")),c.push(this.highCut.build(t,"f")),c.push(this.lowCut.build(t,"f")),c.push(this.smoothness.build(t,"f")),c.push(this.seed.build(t,"f")),c.push(this.quality.build(t,"i")),c.push(this.isMask.build(t,"b")),c.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),c.push(this.alpha.build(t,"f")),c.push(this.calpha),t.format(l+"("+c.join(",")+")",this.getType(t),e)}};lQ.numOctaves=5;var cQ=class extends an{constructor(t,e,i,r,n,s,a,o,l,c,u,h,d,p,g,x){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=t,this.contourColor=e,this.outlineWidth=i,this.contourWidth=r,this.contourThreshold=n,this.outlineThreshold=s,this.contourFrequency=a,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=c,this.compensation=u,this.resolution=h,this.normalMap=d,this.depthMap=p,this.pixelRatio=g,this.alpha=x,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){let i=`g${this.uuid.toString().replace(/-/g,"")}`;if(t.require("vWorldViewDir"),t.require("worldNormal"),t.extensions.derivatives=!0,this.compensation.value&&t.define("OUTLINE_COMPENSATION",`${i}_offset`),this.firstTime){let r=this.outlineWidth.build(t,"f"),n=this.resolution.build(t,"v2"),s=this.compensation.build(t,"b"),a=this.pixelRatio.build(t,"f");t.addVertexParsVariable("randomColor","attribute vec3"),t.addVertexParsVariable("extrudeNormal","attribute vec3"),t.addVertexParsVariable(r,"uniform float"),t.addVertexParsVariable(n,"uniform vec2"),t.addVertexParsVariable(s,"uniform bool"),t.addVertexParsVariable(a,"uniform float"),t.addVertexParsVariable("vID","flat out float"),t.addFragmentParsVariable("vID","flat in float"),t.addVertexFinalCode(`
                vID = randomColor.r;
                vec2 ${i}_offset = vec2(0.0);
                if (${s}) {
                    vec4 ${i}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${i}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    ${i}_offset = normalize(${i}_clipNormal.xy) / ${n} * (${r} / 2.0) * ${i}_clipPosition.w * 2.0 * ${a};
                    ${i}_clipPosition.xy += ${i}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${i}_clipPosition;
                }
            `)}if(t.isShader("fragment")){t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let r=t.include(cQ.Nodes.outline),n=[];return n.push(this.outlineColor.build(t,"c")),n.push(this.contourColor.build(t,"c")),n.push(this.outlineWidth.build(t,"f")),n.push(this.contourWidth.build(t,"f")),n.push(this.contourThreshold.build(t,"f")),n.push(this.outlineThreshold.build(t,"f")),n.push(this.contourFrequency.build(t,"f")),n.push(this.outlineSmoothing.build(t,"f")),n.push(this.contourDirection.build(t,"v3")),n.push(this.positionalLines.build(t,"b")),n.push(this.resolution.build(t,"v2")),n.push(this.normalMap.getTexture(t,"t")),n.push(this.depthMap.getTexture(t,"t")),n.push(this.pixelRatio.build(t,"f")),n.push(this.compensation.build(t,"b")),n.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),n.push(this.alpha.build(t,"f")),n.push(this.calpha),this.firstTime=!this.firstTime,t.format(r+"("+n.join(",")+")",this.getType(t),e)}else return console.warn("OutlineNode is not compatible with "+t.shader+" shader."),""}},uQ=cQ;uQ.Nodes=function(){let t=new Ht(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    vec2 texelSize = (vec2(1.0) / resolution);
    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);
	uvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);
	uvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);
	uvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);
	uvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);
	uvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);
	uvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);
  	vec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new Ht(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                //resultAlpha = 1.0;
                //result = vec3(sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha * mask;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				 
                 return result;
             }`,[t])}}();var ip=class extends an{constructor(t,e,i,r,n,s,a,o,l,c,u,h,d,p,g,x,v,b){super("v3"),this.nodeType="Pattern",this.style=t,this.projection=e,this.axis=i,this.blending=r,this.offset=n,this.colorA=s,this.colorB=a,this.frequency=o,this.size=l,this.variation=c,this.smoothness=u,this.zigzag=h,this.rotation=d,this.vertical=p,this.horizontal=g,this.sides=x,this.isMask=b,this.alpha=v,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){t.require("position"),t.require("uv"),t.requires.uv=[!0],t.require("normal"),t.requires.normal=!0,t.addFragmentVariable(this.calpha,"float");let i;switch(this.style.value){case 0:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave";break;default:i="circle";break}let r=`g${this.uuid.toString().replace(/-/g,"")}`,n=new Ht(`float hashwithoutsine12(vec2 p)
				{
					vec3 p3 = fract(vec3(p.xyx) * .1031);
					p3 += dot(p3, p3.yzx + 33.33);
					return fract((p3.x + p3.y) * p3.z);
				}`),s=new Ht(`vec2 rotate_uv(in vec2 uv, float a, bool repeat) 
				{
					const float mid = 0.5;
					float radians = a * (PI / 180.0);
					vec2 rotated = vec2(
						cos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,
						cos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid
					);
					return repeat ? fract(rotated): rotated;
				}`),a="";if(this.projection.value===4){let u=this.style.value===2?`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h=this.style.value===2?`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,d=this.style.value===2?`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`;a=`
				vec3 p = position;
				float factor = 0.0125;
				vec2 uv0 = fract(p.xy * factor);
				vec2 uv1 = fract(p.zy * factor);
				vec2 uv2 = fract(p.xz * factor);
				
				uv0 = rotate_uv(uv0 + offset, rotation, true);
				uv1 = rotate_uv(uv1 + offset, rotation, true);
				uv2 = rotate_uv(uv2 + offset, rotation, true);
	
				float d0 = ${u};
				float d1 = ${h};
				float d2 = ${d};
				
				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));
				d0 *= weights.z;
				d1 *= weights.x;
				d2 *= weights.y;
				float draw = d0 + d1 + d2;
	
				vec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;
				`}else{let u=this.style.value===2?`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h="";this.axis.value===0?h=`float radius = length(p);
					float theta = atan(p.y, p.z);
					float phi = acos(p.x / radius);`:this.axis.value===1?h=`float radius = length(p);
					float theta = atan(p.x, p.z);
					float phi = acos(p.y / radius);`:(this.axis.value,h=`float radius = length(p);
					float theta = atan(p.y, p.x);
					float phi = acos(p.z / radius);`);let d="";switch(this.projection.value){case 0:d="custom_uv = vUv.st;";break;case 1:break;case 2:d=`
							vec3 p = position;
							${h}
							custom_uv = vec2(theta, phi);
							custom_uv /= PI;
							`;break}a=`
				vec2 custom_uv;
				${d}
	
				custom_uv += offset;
				custom_uv = fract(custom_uv);
				custom_uv = rotate_uv(custom_uv, rotation, true);
	
				float draw = ${u};
				`}let o=new Ht(`vec3 ${r}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {
					const float TWO_PI = PI * 2.0;
					float smoothness_remapped = pow(smoothness, 5.0);	

					${a}

					// Construct final output color
					vec4 color = mix(colorA, colorB, draw);
					color.a = clamp(color.a, 0.0, 1.0);

					// Apply cuts
					color.a *= 
						step(vertical.x, custom_uv.y) * 
						step(custom_uv.y, vertical.y);
					color.a *= 
						step(horizontal.x, abs(custom_uv.x)) * 
						step(abs(custom_uv.x), horizontal.y);

					// Accumulate alpha 
					float lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return clamp(color, 0.0, 1.0).rgb;
				}`,[s,n,ip.DrawFunctions.circle,ip.DrawFunctions.ring,ip.DrawFunctions.polygon,ip.DrawFunctions.cross,ip.DrawFunctions.diamond,ip.DrawFunctions.checkerboard,ip.DrawFunctions.line,ip.DrawFunctions.wave]),l=t.include(o),c=[];return c.push("normal"),c.push(this.blending.build(t,"f")),c.push(this.style.build(t,"i")),c.push(this.offset.build(t,"v2")),c.push(this.colorA.build(t,"v4")),c.push(this.colorB.build(t,"v4")),c.push(this.frequency.build(t,"v2")),c.push(this.size.build(t,"f")),c.push(this.variation.build(t,"f")),c.push(this.smoothness.build(t,"f")),c.push(this.zigzag.build(t,"f")),c.push(this.rotation.build(t,"f")),c.push(this.vertical.build(t,"v2")),c.push(this.horizontal.build(t,"v2")),c.push(this.sides.build(t,"i")),c.push(this.isMask.build(t,"b")),c.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),c.push(this.alpha.build(t,"f")),c.push(this.calpha),t.format(l+"("+c.join(",")+")",this.getType(t),e)}else return console.warn("PatterNode is not compatible with "+t.shader+" shader."),t.format("vec3(0.0)",this.getType(t),e)}},hQ=ip;hQ.DrawFunctions=function(){let t=new Ht(`float hashwithoutsine12(vec2 p) {
				vec3 p3 = fract(vec3(p.xyx) * 0.1031);
				p3 += dot(p3, p3.yzx + 33.33);
				return fract((p3.x + p3.y) * p3.z);
			}`),e=new Ht(`vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {
                // Create tiles in UV-space
                uv *= frequency;

                // Integer coords
                vec2 i = floor(uv);

                // Offset every other row based on zigzag param, then compute fractional coords
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = fract(uv);

				// Rotate the tile itself:
				// const float mid = 0.5;
				// f = vec2(
				// 	cos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,
				// 	cos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid
				// );
				// f = fract(f);

                f = f * 2.0 - 1.0;

				// Recompute integer coords after shifting - then, random value per tile 
				i = floor(uv);
				float rand = (hashwithoutsine12(i) * 5.0 + 1.0);
				float jitter = mix(1.0, rand, variation);
				f *= jitter;

                return f;
            }`,[t]),i=new Ht(`float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(
                    -smoothness, 
                     smoothness, 
                     length(f) - size
                );
            }`,[e]),r=new Ht(`float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);

				float d = length(f);
                const float inner_width = 0.5;

                float outer = smoothstep(-smoothness, smoothness, d - size);
                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);
				return outer + (1.0 - inner);   
            }`,[e]),n=new Ht(`float sdf_ngon(in vec2 p, in float r, in int n) {
                float an = (PI * 2.0) / float(n);
                float he = r * tan(0.5 * an);
                
                // Rotate to first sector
                p = -p.yx; 
                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);
                vec2  cs = vec2(cos(bn), sin(bn));
                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;
            
                // Side of polygon
                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);
            }
            
            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));
            }`,[e]),s=new Ht(`float sdf_cross(in vec2 p, in vec2 b, float r ) {
                p = abs(p); 
				p = (p.y > p.x) ? p.yx : p.xy;
                vec2  q = p - b;
                float k = max(q.y, q.x);
                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);
                return sign(k) * length(max(w, 0.0)) + r;
            }
            
            // Avoid namespace conflicts 
            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));
            }`,[e]),a=new Ht(`float ndot(vec2 a, vec2 b) { 
                return a.x*b.x - a.y*b.y; 
            }
            
            float sdf_diamond(in vec2 p, in vec2 b) {
                p = abs(p);
                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);
                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));
                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);
            }

            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
	            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));
            }`,[e]),o=new Ht(`float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                uv *= frequency;
                vec2 i = floor(uv);

                float offset = mod(i.y, 2.0);

                uv.x += offset + zigzag * offset;
                float x = floor(uv.x);
                
                return mod(x, 2.0);
            }`),l=new Ht(`float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);
				
				// Different approach for variation param here
				float row = floor(uv * frequency).y;
				float rand = hashwithoutsine12(vec2(row));
				float s = mix(size, size * rand, variation);

				return smoothstep(
					s - smoothness, 
					s + smoothness, 
					abs(f.y)
				);
            }`,[e]),c=new Ht(`// Uses bisection 
            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {
                // Convert all data to a primitive cosine wave
                p = c * (p - vec2(d, a));
                
                const float TWO_PI = PI * 2.0;

                // Reduce to principal half cycle
                p.x = mod(p.x, TWO_PI); 
                if (p.x > PI) {
                    p.x = TWO_PI - p.x;
                }
            
                // Find zero of derivative (minimize distance)
                float xa = 0.0;
                float xb = TWO_PI;

                // 24 bit precision
                for (int i = 0; i < 24; i++) {
                    float x = 0.5 * (xa + xb);
                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));
                    if (y < 0.0) xa = x; 
                    else xb = x;
                }
                float x = 0.5 * (xa + xb);
                
                // Compute distance    
                vec2 q = vec2(x, b * c * cos(x));
                return length(p - q) / c;
            }

            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                float repeat = frequency.x;
                uv *= repeat;
                vec2 i = floor(uv);
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = vec2(uv.x, fract(uv.y));

                // Generalized cosine: y(x) = a + b * cos(cx + d)
                const float amplitude = 0.125;
                float wave_frequency = frequency.y * 0.1;
                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);

				// Different approach for variation param here
				float rand = hashwithoutsine12(vec2(i.y));
				float s = mix(size, size * rand, variation);

                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);
            }`);return{tileAndCenter:e,circle:i,ring:r,polygon:n,cross:s,diamond:a,checkerboard:o,line:l,wave:c}}();var dQ=class extends an{constructor(t,e,i,r,n,s,a,o){super("v3"),this.nodeType="Rainbow",this.filmThickness=t,this.movement=e,this.wavelengths=i,this.noiseStrength=r,this.noiseScale=n,this.offset=s,this.isMask=o,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.require("vWorldViewDir"),t.require("worldNormal"),t.isShader("fragment")){t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let i=t.include(dQ.Nodes.rainbow),r=[];return r.push(this.filmThickness.build(t,"f")),r.push(this.movement.build(t,"f")),r.push(this.wavelengths.build(t,"v3")),r.push(this.noiseStrength.build(t,"f")),r.push(this.noiseScale.build(t,"f")),r.push(this.offset.build(t,"v3")),r.push(this.isMask.build(t,"b")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("RainbowNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},fQ=dQ;fQ.Nodes=function(){let t=new Ht(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
				float f = 0.0;
				
				if (noiseStrength != 0.0) {
					vec3 st = position / noiseScale;
					float noise = simplexFast(1.6 * st + vec3(1.8, 1.5, 1.9) * simplexFast(st) + vec3(1.7, 9.2, 1.0));
					f = noise * noiseStrength;
				}

				vec3 waves = wavelengths * vec3(1.0, 0.8, 0.6) + 1.0;
				float angle = dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal));

				mediump vec3 color = cos((((filmThickness + f) / waves) * angle) + movement);
				return .5 + .5 * color;
			 }`,[Nl.simplexFast]);return{rainbow:new Ht(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {
				mediump vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

				float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);

				float lalpha = alpha * rainbowContribution * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return res;
			 }`,[t])}}();var pQ=class extends an{constructor(t,e,i,r,n,s,a,o,l,c){super("v3"),this.nodeType="Toon",this.positioning=t,this.colors=e,this.steps=i,this.source=r,this.isWorldSpace=n,this.noiseStrength=s,this.noiseScale=a,this.shadowColor=o,this.offset=l,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.require("worldNormal"),t.require("worldPosition"),t.isShader("fragment")){t.define("COLORS_MAX",10),t.addFragmentVariable(this.calpha,"float");let i=t.include(pQ.Nodes.toon),r=[];return r.push(this.positioning.build(t,"i")),r.push(this.colors.build(t,"v4[]")),r.push(this.steps.build(t,"f[]")),r.push(this.source.build(t,"v3")),r.push(this.isWorldSpace.build(t,"b")),r.push(this.noiseStrength.build(t,"f")),r.push(this.noiseScale.build(t,"f")),r.push(this.shadowColor.build(t,"v4")),r.push(this.offset.build(t,"v3")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("ToonNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},mQ=pQ;mQ.Nodes=function(){let t=new Ht(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),e=new Ht(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),i=new Ht(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[e]),r=new Ht(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),n=new Ht(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[r]);return{toon:new Ht(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplexFast(st),
					// 	simplexFast(st + vec3(111.1, 143.89, 217.19)),
					// 	simplexFast(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[Nl.simplexFast,t,i,n])}}();var Gwe=function(){return{textureBicubic:new Ht(`float w0( float a ) {
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
        }
    
        float w1( float a ) {
            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
        }
    
        float w2( float a ){
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
        }
    
        float w3( float a ) {
            return ( 1.0 / 6.0 ) * ( a * a * a );
        }
    
        // g0 and g1 are the two amplitude functions
        float g0( float a ) {
            return w0( a ) + w1( a );
        }
    
        float g1( float a ) {
            return w2( a ) + w3( a );
        }
    
        // h0 and h1 are the two offset functions
        float h0( float a ) {
            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
        }
    
        float h1( float a ) {
            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
        }
    
        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
            uv = uv * texelSize.zw + 0.5;
    
            vec2 iuv = floor( uv );
            vec2 fuv = fract( uv );
    
            float g0x = g0( fuv.x );
            float g1x = g1( fuv.x );
            float h0x = h0( fuv.x );
            float h1x = h1( fuv.x );
            float h0y = h0( fuv.y );
            float h1y = h1( fuv.y );
    
            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
    
            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + 
                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
        }

        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
            vec2 fLodSizeInv = 1.0 / fLodSize;
            vec2 cLodSizeInv = 1.0 / cLodSize;
            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
            return mix( fSample, cSample, fract( lod ) );
        }`)}}();function jwe(t,e){return t>=e?new Oe(e/t,1):new Oe(1,t/e)}var gQ=class extends an{constructor(t,e,i,r,n,s,a,o){super("v3"),this.nodeType="Transmission",this.thickness=t,this.ior=e,this.roughness=i,this.transmissionSamplerSize=r,this.transmissionSamplerMap=n,this.transmissionDepthMap=s,this.aspectRatio=a,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.extensions.shaderTextureLOD=!0,t.extensions.derivatives=!0,t.isShader("fragment")){t.define("NUM_SAMPLES",6),t.define("BLUR_SLOD",Math.pow(2,wi.transmissionLod.value)),t.require("worldPosition"),t.requires.worldNormal=!0,t.requires.modelMatrix=!0,t.requires.projectionMatrix=!0,t.addFragmentVariable(this.calpha,"float");let i=t.include(gQ.Nodes.transmission),r=[];return r.push(this.thickness.build(t,"f")),r.push(this.ior.build(t,"f")),r.push(this.roughness.build(t,"f")),r.push(this.transmissionSamplerSize.build(t,"v2")),r.push(this.transmissionSamplerMap.getTexture(t,"t")),r.push(this.transmissionDepthMap.getTexture(t,"t")),r.push(this.aspectRatio.build(t,"v2")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("TransmissionNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},vQ=gQ;vQ.Nodes=function(){let t=new Ht(`vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

				// Special case for blur == 0.0
				if (lod == 0.0) {
					#ifdef TEXTURE_LOD_EXT
					return texture2DLodEXT( sp, U, 0.0).rgb;
					#else
					return textureLod( sp, U, 0.0).rgb;
					#endif
				}
				
				vec2 texelSize = vec2(1.0) / resolution;
                vec2 halton = haltonSequence[frameIndex];
                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
                float temporalAngle  = temporalOffset * PI2;
				vec3 res = vec3(0.0);
                vec2 uv = vec2(0.0);
                vec2 offset = vec2(0.0);
                vec2 vogelSample = vec2(0.0);
                for (int i = 0; i < NUM_SAMPLES; i++) {
                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;
                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20
                    uv = U + offset;
                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    res += textureLod(sp, uv, lod).rgb;
                }
                return res / float(NUM_SAMPLES);
            }`),e=new Ht(`vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        
				// Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		        // The thickness is specified in local space
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),i=new Ht(`float applyIorToRoughness( float roughness, float ior ) {
				// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
				// an IOR of 1.5 results in the default amount of microfacet refraction.
				return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
			}`),r=new Ht(`vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
				// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see
				// also the code in convertTransmission.ts, which runs during export
				#ifdef IS_THREEJS_EXPORT
					float lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);
					return textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;
				#else
					float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
					float lod = applyIorToRoughness(roughness, ior);
					return blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
				#endif
			}`,[Gwe.textureBicubic,i,t]),n=new Ht(`vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;

				// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
				vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;

				vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
				vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
				unrefractedCoords += 1.0;
				unrefractedCoords /= 2.0;

				// Sample framebuffer to get pixel the refracted ray hits.
				return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    		}`,[r,e]);return{transmission:new Ht(`vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return transmission;
            }`,[n])}}();var QU=(t=>(t.NOISE="noise",t.MAP="map",t))(QU||{}),yQ=class extends an{constructor(t,e,i,r,n,s,a,o,l,c,u){super("v3"),this.displacementTypeIndex=new hn(0),this.nodeType="VertexDisplacement",this.intensity=t,this.movementOrTexture=e,Object.values(QU)[this.displacementTypeIndex.value]==="map"&&(this.mat=new $Y(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=c,this.noiseFunctionIndex=u,this.voronoiStyle=r,this.smoothness=n,this.seed=s,this.highCut=a,this.lowCut=o,this.quality=l}generate(t,e){if(t.isShader("vertex")){t.define("USE_LAYER_DISPLACE");let i,r=[];switch(r.push("displaced_position"),r.push("displaced_normal"),Object.values(QU)[this.displacementTypeIndex.value]){case"map":{i=t.include(yQ.Nodes.map),r.push(this.movementOrTexture.getTexture(t,"t")),r.push("uv"),r.push(this.cropOrOffset.build(t,"f")),this.mat&&r.push(this.mat.build(t,"mat3"));break}case"noise":{let n=["simplexPrecise","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseFunctionIndex.value],s=new Ht(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),a=n=="voronoi"?`
					float v = ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);
					v = remap(v, lowCut, highCut, 0.0, 1.0);
					v = smax(v, 0.0, smoothness * 0.25);
					v = smin(v, 1.0, smoothness * 0.25);

					return p + n * v * intensity;
					`:`
					return p + n * ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
					`,o=new Ht(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {
							${a}
						}`,[Nl.simplexPrecise,Nl.simplexFractal,Nl.simplexAshima,Nl.fbm,Nl.perlin,Nl.voronoi]),l=new Ht(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[o,s]);i=t.include(l),r.push(this.scale.build(t,"f")),r.push(this.cropOrOffset.build(t,"v3")),r.push(this.movementOrTexture.build(t,"f")),r.push(this.voronoiStyle.build(t,"i")),r.push(this.smoothness.build(t,"f")),r.push(this.seed.build(t,"f")),r.push(this.highCut.build(t,"f")),r.push(this.lowCut.build(t,"f")),r.push(this.quality.build(t,"i"));break}}return r.push(this.intensity.build(t,"f")),r.push("displaced_normal"),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("VertexDisplacementNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},xQ=yQ;xQ.Nodes=function(){let t=new Ht(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),e=new Ht(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new Ht(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[t,e])}}();var wi={normalRenderTarget:new up,normalRenderTargetDepth:new up,transmissionRenderTarget:new up,aspectRatio:new Za,transmissionSize:new Za(2048,2048),transmissionRenderTargetDepth:new up,aoRenderTarget:new up,aoEnabled:new rl,pixelRatioNode:new $t(1),resolution:new Za,penumbraSize:new Xv(5,.5),frameIndex:new hn(0),transmissionLod:new hn(2)};for(let t of Object.values(wi))t.isRenderGlobal=!0;var bQ={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.9.82/build/ui.wasm"},x4=class extends ta{constructor(){super("basic"),this.nodeType="Basic",this.color=new bs(_c),this.shadingAlpha=new $t(1),this.shadingBlend=new hn(0),this.previousModelViewMatrix=new Xd,this.previouseProjectionMatrix=new Xd}get category(){return"phong"}generate(t){let e;if(t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:wi.frameIndex}),t.mergeUniform({resolution:wi.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(lb.merge([Vt.fog])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{this.color===void 0&&(this.color=new bs(_c)),this.color.analyze(t,{slot:"color"}),this.alpha&&this.alpha.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"});let i=this.color.flow(t,"c",{slot:"color"}),r=this.alpha?this.alpha.flow(t,"f"):void 0,n=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0,s=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0;t.requires.transparent=r!==void 0,t.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let a=["#include <normal_fragment_begin>",i.code];r&&a.push(r.code,"#ifdef ALPHATEST"," if ( "+r.result+" <= ALPHATEST ) discard;","#endif"),s?a.push(s.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${s.result}, 1.0, SPE_BLENDING_NORMAL);`):a.push(`vec3 finalColor = ${i.result};`);let o="1.0";this.mask&&(this.mask.analyze(t),o=`luminance(${this.mask.flow(t,"v3").result})`),r?a.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${r.result} * ${o} );`):a.push("gl_FragColor = vec4("+i.result+", 1.0 );"),n&&a.push(`gl_FragColor.a *= ${n.result};`),a.push("#include <fog_fragment>","#include <dithering_fragment>"),e=a.join(`
`)}return e}},Wwe=class extends ta{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new bs(_c),this.emissive=new bs(0),this.emissiveIntensity=new $t(1),this.previousModelViewMatrix=new Xd,this.previouseProjectionMatrix=new Xd,this.shadingAlpha=new $t(1),this.shadingBlend=new hn(0),this.occlusion=new rl(!0)}get category(){return"lambert"}build(t){let e;if(t.define("LAMBERT"),t.requires.lights=!0,t.extensions.derivatives=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:wi.frameIndex}),t.mergeUniform({resolution:wi.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(lb.merge([Vt.fog,Vt.lights])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
				`),r.push(`
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{t.mergeUniform({penumbraSize:wi.penumbraSize}),t.mergeUniform({frameIndex:wi.frameIndex}),t.mergeUniform({aoMap:wi.aoRenderTarget}),t.mergeUniform({aoEnabled:wi.aoEnabled}),this.color===void 0&&(this.color=new bs(_c)),this.color.analyze(t,{slot:"color"}),this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t);let i=this.color.flow(t,"c",{slot:"color"}),r=this.emissive.flow(t,"c",{slot:"emissive"}),n=this.emissiveIntensity.flow(t,"f",{slot:"emissive"}),s=this.occlusion.flow(t,"b",{slot:"occlusion"}),a=this.shadingAlpha.flow(t,"f"),o=this.shadingBlend.flow(t,"i"),l=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(t,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0;t.requires.transparent=c!==void 0,t.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];h.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),r&&h.push(r.code,"reflectedLight.directDiffuse += "+r.result+" * "+n.result+";"),h.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let d="1.0";this.mask&&(this.mask.analyze(t),d=`luminance(${this.mask.flow(t,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );

					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=h.join(`
`)}return e}},j1=function(){let t=new Ht(`vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {

            // Gradient of UVs w.r.t. X coordinate (in screen-space)
            vec2 dSTdx = dFdx(bumpMapUv);

            // Gradient of UVs w.r.t. Y coordinate (in screen-space)
            vec2 dSTdy = dFdy(bumpMapUv);
            
            // Forward differencing
            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);
            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;
            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;
            
            return vec2( dBx, dBy );
        }`),e=new Ht(`vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
            vec3 vSigmaX = dFdx( surf_pos.xyz );
            vec3 vSigmaY = dFdy( surf_pos.xyz );
            vec3 vN = surf_norm; // normalized
            
            vN = normalize(vN);

            vec3 R1 = cross( vSigmaY, vN );
            vec3 R2 = cross( vN, vSigmaX );

            R1 = normalize(R1);
            R2 = normalize(R2);
    
            float fDet = dot( vSigmaX, R1 ) * faceDirection;
    
            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
            return normalize( abs( fDet ) * vN - vGrad );
        }`);return{dHdxy:t,perturbNormalArb:e}}(),qwe=class extends ta{constructor(){super("phong"),this.nodeType="Phong",this.color=new bs(_c),this.specular=new bs(1118481),this.shininess=new $t(30),this.previousModelViewMatrix=new Xd,this.previouseProjectionMatrix=new Xd,this.shadingAlpha=new $t(1),this.shadingBlend=new hn(0),this.occlusion=new rl(!0)}get category(){return"phong"}build(t){let e;if(t.define("PHONG"),t.requires.lights=!0,t.extensions.derivatives=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:wi.frameIndex}),t.mergeUniform({resolution:wi.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(lb.merge([Vt.fog,Vt.lights])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{t.mergeUniform({penumbraSize:wi.penumbraSize}),t.mergeUniform({frameIndex:wi.frameIndex}),t.mergeUniform({aoMap:wi.aoRenderTarget}),t.mergeUniform({aoEnabled:wi.aoEnabled}),this.color===void 0&&(this.color=new bs(_c)),this.color.analyze(t,{slot:"color"}),this.specular.analyze(t),this.shininess.analyze(t);let i=this.occlusion.flow(t,"b",{slot:"occlusion"});this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t);let r=this.color.flow(t,"c",{slot:"color"}),n=this.specular.flow(t,"c"),s=this.shininess.flow(t,"f"),a=this.shadingAlpha.flow(t,"f"),o=this.shadingBlend.flow(t,"i"),l=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(t,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0;t.requires.transparent=c!==void 0,t.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];if(this.bumpMap){t.include(j1.dHdxy),t.include(j1.perturbNormalArb);let p=this.bumpMap.texture.flow(t,"t"),g=this.bumpMap.flow(t,"v3"),x=this.bumpMapIntensity?this.bumpMapIntensity.flow(t,"f").result:"1.0",v="";this.bumpMap.projection.value===4?v=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${p.result}, uv0, ${x});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${p.result}, uv1, ${x});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${p.result}, uv2, ${x});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:v=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${p.result}, bumpMapCachedUv, ${x});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,h.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${g.result};
					${v}
					`)}h.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",n.code,"	vec3 specular = "+n.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let d="1.0";this.mask&&(this.mask.analyze(t),d=`luminance(${this.mask.flow(t,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );
					
					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result});`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=h.join(`
`)}return e}},Xwe=class extends ta{constructor(){super("standard"),this.nodeType="Standard",this.color=new bs(_c),this.roughness=new $t(.3),this.metalness=new $t(0),this.reflectivity=new $t(.5),this.previousModelViewMatrix=new Xd,this.previouseProjectionMatrix=new Xd,this.shadingAlpha=new $t(1),this.shadingBlend=new hn(0),this.occlusion=new rl(!0)}get category(){return"physical"}build(t){let e;if(t.define("STANDARD"),t.requires.lights=!0,t.extensions.derivatives=!0,t.extensions.shaderTextureLOD=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:wi.frameIndex}),t.mergeUniform({resolution:wi.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(lb.merge([Vt.fog,Vt.lights])),Vt.LTC_1&&(t.uniforms.ltc_1={value:void 0},t.uniforms.ltc_2={value:void 0}),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{t.mergeUniform({penumbraSize:wi.penumbraSize}),t.mergeUniform({frameIndex:wi.frameIndex}),t.mergeUniform({aoMap:wi.aoRenderTarget}),t.mergeUniform({aoEnabled:wi.aoEnabled});let i={gamma:!0};this.color===void 0&&(this.color=new bs(_c)),this.color.analyze(t,{slot:"color",context:i}),this.roughness.analyze(t),this.metalness.analyze(t);let r=this.occlusion.flow(t,"b",{slot:"occlusion"});this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t),this.reflectivity&&this.reflectivity.analyze(t);let n=this.color.flow(t,"c",{slot:"color",context:i}),s=this.roughness.flow(t,"f"),a=this.metalness.flow(t,"f"),o=this.shadingAlpha.flow(t,"f"),l=this.shadingBlend.flow(t,"i"),c=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,u=this.alpha?this.alpha.flow(t,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(t,"f"):void 0;t.requires.transparent=u!==void 0,t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let p=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){t.include(j1.dHdxy),t.include(j1.perturbNormalArb);let x=this.bumpMap.texture.flow(t,"t"),v=this.bumpMap.flow(t,"v3"),b=this.bumpMapIntensity?this.bumpMapIntensity.flow(t,"f").result:"1.0",w="";this.bumpMap.projection.value===4?w=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${x.result}, uv0, ${b});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${x.result}, uv1, ${b});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${x.result}, uv2, ${b});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:w=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${x.result}, bumpMapCachedUv, ${b});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${v.result};
					${w}
					`)}if(p.push(n.code,"	vec3 diffuseColor = "+n.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",a.code,"	float metalnessFactor = "+a.result+";"),this.roughnessMap){let x=this.roughnessMap.texture.flow(t,"t"),v=this.roughnessMap.flow(t,"v3"),b="";this.roughnessMap.projection.value===4?b=`
					float roughnessChange = 1.0;
					{
						vec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						float r0 = luminance(texture(${x.result}, uv0).rgb) * roughnessScale;
						float r1 = luminance(texture(${x.result}, uv1).rgb) * roughnessScale;
						float r2 = luminance(texture(${x.result}, uv2).rgb) * roughnessScale;

						roughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);
					}
					float roughnessFactor = roughnessChange * ${s.result};
					`:b=`
					vec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;

					vec4 vals = texture(${x.result},  roughnessMapCachedUv);
					float roughnessFactor = luminance(vals.rgb) * ${s.result};
					`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${v.result};

					const float roughnessScale = 1.0;

					${b}
				`)}else p.push(s.code,"	float roughnessFactor = "+s.result+";");u&&p.push(u.code,"#ifdef ALPHATEST","	if ( "+u.result+" <= ALPHATEST ) discard;","#endif"),p.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),p.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?p.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):p.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),p.push("#include <lights_fragment_begin>"),p.push("#include <lights_fragment_end>"),p.push("vec3 ao = aoEnabled && "+r.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let g="1.0";this.mask&&(this.mask.analyze(t),g=`luminance(${this.mask.flow(t,"v3").result})`),p.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${g} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${g}, ${l.result} );
					
					outgoingLight *= ao;
				}
				`),c&&p.push(c.code,`outgoingLight = spe_blend(outgoingLight, ${c.result}, 1.0, SPE_BLENDING_NORMAL);`),u?p.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${u.result} );`):p.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&p.push(`gl_FragColor.a *= ${h.result};`),p.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=p.join(`
`)}return e}},Ywe=class extends ta{constructor(){super("toon"),this.nodeType="Toon",this.color=new bs(_c),this.specular=new bs(1118481),this.shininess=new $t(30),this.previousModelViewMatrix=new Xd,this.previouseProjectionMatrix=new Xd,this.shadingAlpha=new $t(1),this.shadingBlend=new hn(0)}get category(){return"toon"}build(t){let e;if(t.define("TOON"),t.requires.lights=!0,t.extensions.derivatives=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:wi.frameIndex}),t.mergeUniform({resolution:wi.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(lb.merge([Vt.fog,Vt.lights])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{t.mergeUniform({penumbraSize:wi.penumbraSize}),t.mergeUniform({frameIndex:wi.frameIndex}),t.mergeUniform({aoMap:wi.aoRenderTarget}),t.mergeUniform({aoEnabled:wi.aoEnabled}),this.color===void 0&&(this.color=new bs(_c)),this.color.analyze(t,{slot:"color"}),this.specular.analyze(t),this.shininess.analyze(t),this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t);let i=this.color.flow(t,"c",{slot:"color"}),r=this.specular.flow(t,"c"),n=this.shininess.flow(t,"f"),s=this.shadingAlpha.flow(t,"f"),a=this.shadingBlend.flow(t,"i"),o=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(t,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0;t.requires.transparent=l!==void 0,t.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let u=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];if(this.bumpMap){t.include(j1.dHdxy),t.include(j1.perturbNormalArb);let d=this.bumpMap.texture.flow(t,"t"),p=this.bumpMap.flow(t,"v3"),g=this.bumpMapIntensity?this.bumpMapIntensity.flow(t,"f").result:"1.0",x="";this.bumpMap.projection.value===4?x=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${d.result}, uv0, ${g});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${d.result}, uv1, ${g});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${d.result}, uv2, ${g});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:x=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${d.result}, bumpMapCachedUv, ${g});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,u.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${p.result};
					${x}
					`)}u.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",r.code,"	vec3 specular = "+r.result+";",n.code,"	float shininess = max( 0.0001, "+n.result+" );","	float specularStrength = 1.0;"),l&&u.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),u.push("material.diffuseColor = diffuseColor;"),u.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),u.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let h="1.0";this.mask&&(this.mask.analyze(t),h=`luminance(${this.mask.flow(t,"v3").result})`),u.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${h} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${h}, ${a.result} );
				}
				`),o&&u.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?u.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&u.push(`gl_FragColor.a *= ${c.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=u.join(`
`)}return e}},Qwe=class{constructor(t=1e3*10){this.timeout=t,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...t){}remove(t){let e=this.cache.get(t);e&&(this.dispose(t,e.data),this.cache.delete(t),e.prev.next=e.next,e.next.prev=e.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let t=Date.now(),e=this.head.next;for(;e.time<t-this.timeout;)this.dispose(e.src,e.data),this.cache.delete(e.src),e=e.next,e.prev=this.head,this.head.next=e;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(t){var e;return(e=this.cache.get(t))==null?void 0:e.data}load(t){let e=Date.now(),i=this.cache.get(t);return i===void 0?(i={data:this.create(t),src:t,time:e,next:null,prev:null},this.cache.set(t,i)):(i.time=e,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},Zwe=class extends Qwe{create(t){return URL.createObjectURL(new Blob([t]))}dispose(t,e){URL.revokeObjectURL(e)}},rL;function Kwe(t){return typeof t=="string"?t:(rL||(rL=new Zwe),rL.load(t))}var Jwe=class{constructor(t,e){this.data=t,this.cache=e,this.refCount=0}deref(){this.refCount,this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},$we=class{constructor(){this.cache=new Map}remove(t){this.cache.delete(t.data)}load(t){let e=this.cache.get(t);return e===void 0&&(e=this.create(t),this.cache.set(t,e)),e.refCount+=1,e}},_Q=class extends Jwe{constructor(t,e){super(t,e.imageHolderCache),this.data=t,this.shared=e,this.loaded=!1,this.isVideo=!1,this.isBuffer=!1,this._cache={1e3:{},1001:{},1002:{}},this.isVideo=t.type==="video",this.isBuffer=t.isWebGLRenderTarget===!0,this.loadPromise=this.updateSrc(this.isBuffer?t:t.data)}async updateSrc(t){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let e=()=>{this.loaded=!0;for(let r of Object.values(this._cache))for(let n of Object.values(r))for(let s of Object.values(n))s&&(s.image=this.img,s.needsUpdate=!0);this.shared.requestRender()};if(this.isBuffer)this.img=t,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof t!="string"){var i=new FileReader;i.readAsDataURL(new Blob([t],{type:"video/mp4"}));let r;await new Promise(n=>{i.onloadend=s=>{var a;r=(a=s.target)==null?void 0:a.result,n(null)}}),this.img.src=r}else this.img.src=t;this.img.onloadeddata=()=>{e()}}else this.img=new Image,this.img.src=Kwe(t),this.img.onload=e,await new Promise(r=>{this.img.onload=()=>{e(),r(null)}})}getTexture(t,e=1008,i=1006){var n,s;let r=(s=(n=this._cache[t])==null?void 0:n[e])==null?void 0:s[i];if(r)return r;{let a;return this.isBuffer?a=this.img.texture:this.isVideo?a=new xhe(this.img,void 0,t,t):a=new ns(this.img,void 0,t,t,i,e),this.loaded&&(a.needsUpdate=!0),this._cache[t]===void 0&&(this._cache[t]={}),this._cache[t][e]===void 0&&(this._cache[t][e]={}),this._cache[t][e][i]=a,a}}setNeedsUpdate(t){for(let e of Object.values(this._cache))for(let i of Object.values(e))for(let r of Object.values(i))r&&(r.needsUpdate=t)}disposeTextures(){for(let[t,e]of Object.entries(this._cache))for(let[i,r]of Object.entries(e))for(let[n,s]of Object.entries(r))s==null||s.dispose(),this._cache[t]!==void 0&&this._cache[t][i]!==void 0&&(this._cache[t][i][n]=void 0)}dispose(){super.dispose(),this.disposeTextures()}},eg=class extends _Q{};function eMe(t,e){var i=nMe(e);return i.formatToParts?iMe(i,t):rMe(i,t)}var tMe={year:0,month:1,day:2,hour:3,minute:4,second:5};function iMe(t,e){try{for(var i=t.formatToParts(e),r=[],n=0;n<i.length;n++){var s=tMe[i[n].type];s>=0&&(r[s]=parseInt(i[n].value,10))}return r}catch(a){if(a instanceof RangeError)return[NaN];throw a}}function rMe(t,e){var i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[r[3],r[1],r[2],r[4],r[5],r[6]]}var nL={};function nMe(t){if(!nL[t]){var e=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),i=e==="06/25/2014, 00:00:00"||e==="06/25/2014 00:00:00";nL[t]=i?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:t,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return nL[t]}function SQ(t,e,i,r,n,s,a){var o=new Date(0);return o.setUTCFullYear(t,e,i),o.setUTCHours(r,n,s,a),o}var fG=36e5,sMe=6e4,sL={timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function wQ(t,e,i){var r,n;if(!t||(r=sL.timezoneZ.exec(t),r))return 0;var s;if(r=sL.timezoneHH.exec(t),r)return s=parseInt(r[1],10),pG(s)?-(s*fG):NaN;if(r=sL.timezoneHHMM.exec(t),r){s=parseInt(r[1],10);var a=parseInt(r[2],10);return pG(s,a)?(n=Math.abs(s)*fG+a*sMe,s>0?-n:n):NaN}if(lMe(t)){e=new Date(e||Date.now());var o=i?e:aMe(e),l=ZU(o,t),c=i?l:oMe(e,l,t);return-c}return NaN}function aMe(t){return SQ(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())}function ZU(t,e){var i=eMe(t,e),r=SQ(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),n=t.getTime(),s=n%1e3;return n-=s>=0?s:1e3+s,r-n}function oMe(t,e,i){var r=t.getTime(),n=r-e,s=ZU(new Date(n),i);if(e===s)return e;n-=s-e;var a=ZU(new Date(n),i);return s===a?s:Math.max(s,a)}function pG(t,e){return-23<=t&&t<=23&&(e==null||0<=e&&e<=59)}var mG={};function lMe(t){if(mG[t])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:t}),mG[t]=!0,!0}catch{return!1}}var cMe=Dg(ose(),1),gG=Dg(lse(),1),uMe=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,hMe=uMe,aL=36e5,vG=6e4,dMe=2,nl={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:hMe};function fMe(t,e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(t===null)return new Date(NaN);var i={},r=i.additionalDigits==null?dMe:(0,cMe.default)(i.additionalDigits);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]")return new Date(t.getTime());if(typeof t=="number"||Object.prototype.toString.call(t)==="[object Number]")return new Date(t);if(!(typeof t=="string"||Object.prototype.toString.call(t)==="[object String]"))return new Date(NaN);var n=pMe(t),s=mMe(n.date,r),a=s.year,o=s.restDateString,l=gMe(o,a);if(isNaN(l))return new Date(NaN);if(l){var c=l.getTime(),u=0,h;if(n.time&&(u=vMe(n.time),isNaN(u)))return new Date(NaN);if(n.timeZone||i.timeZone){if(h=wQ(n.timeZone||i.timeZone,new Date(c+u)),isNaN(h))return new Date(NaN)}else h=(0,gG.default)(new Date(c+u)),h=(0,gG.default)(new Date(c+u+h));return new Date(c+u+h)}else return new Date(NaN)}function pMe(t){var e={},i=nl.dateTimePattern.exec(t),r;if(i?(e.date=i[1],r=i[3]):(i=nl.datePattern.exec(t),i?(e.date=i[1],r=i[2]):(e.date=null,r=t)),r){var n=nl.timeZone.exec(r);n?(e.time=r.replace(n[1],""),e.timeZone=n[1].trim()):e.time=r}return e}function mMe(t,e){var i=nl.YYY[e],r=nl.YYYYY[e],n;if(n=nl.YYYY.exec(t)||r.exec(t),n){var s=n[1];return{year:parseInt(s,10),restDateString:t.slice(s.length)}}if(n=nl.YY.exec(t)||i.exec(t),n){var a=n[1];return{year:parseInt(a,10)*100,restDateString:t.slice(a.length)}}return{year:null}}function gMe(t,e){if(e===null)return null;var i,r,n,s;if(t.length===0)return r=new Date(0),r.setUTCFullYear(e),r;if(i=nl.MM.exec(t),i)return r=new Date(0),n=parseInt(i[1],10)-1,xG(e,n)?(r.setUTCFullYear(e,n),r):new Date(NaN);if(i=nl.DDD.exec(t),i){r=new Date(0);var a=parseInt(i[1],10);return bMe(e,a)?(r.setUTCFullYear(e,0,a),r):new Date(NaN)}if(i=nl.MMDD.exec(t),i){r=new Date(0),n=parseInt(i[1],10)-1;var o=parseInt(i[2],10);return xG(e,n,o)?(r.setUTCFullYear(e,n,o),r):new Date(NaN)}if(i=nl.Www.exec(t),i)return s=parseInt(i[1],10)-1,bG(e,s)?yG(e,s):new Date(NaN);if(i=nl.WwwD.exec(t),i){s=parseInt(i[1],10)-1;var l=parseInt(i[2],10)-1;return bG(e,s,l)?yG(e,s,l):new Date(NaN)}return null}function vMe(t){var e,i,r;if(e=nl.HH.exec(t),e)return i=parseFloat(e[1].replace(",",".")),oL(i)?i%24*aL:NaN;if(e=nl.HHMM.exec(t),e)return i=parseInt(e[1],10),r=parseFloat(e[2].replace(",",".")),oL(i,r)?i%24*aL+r*vG:NaN;if(e=nl.HHMMSS.exec(t),e){i=parseInt(e[1],10),r=parseInt(e[2],10);var n=parseFloat(e[3].replace(",","."));return oL(i,r,n)?i%24*aL+r*vG+n*1e3:NaN}return null}function yG(t,e,i){e=e||0,i=i||0;var r=new Date(0);r.setUTCFullYear(t,0,4);var n=r.getUTCDay()||7,s=e*7+i+1-n;return r.setUTCDate(r.getUTCDate()+s),r}var yMe=[31,28,31,30,31,30,31,31,30,31,30,31],xMe=[31,29,31,30,31,30,31,31,30,31,30,31];function MQ(t){return t%400===0||t%4===0&&t%100!==0}function xG(t,e,i){if(e<0||e>11)return!1;if(i!=null){if(i<1)return!1;var r=MQ(t);if(r&&i>xMe[e]||!r&&i>yMe[e])return!1}return!0}function bMe(t,e){if(e<1)return!1;var i=MQ(t);return!(i&&e>366||!i&&e>365)}function bG(t,e,i){return!(e<0||e>52||i!=null&&(i<0||i>6))}function oL(t,e,i){return!(t!=null&&(t<0||t>=25)||e!=null&&(e<0||e>=60)||i!=null&&(i<0||i>=60))}function _Me(t,e,i){var r=fMe(t,i),n=wQ(e,r,!0),s=new Date(r.getTime()-n),a=new Date(0);return a.setFullYear(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),a.setHours(s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()),a}function ol(t,e){return e.color(t)}function _G(t=new Date,e){let i=e.format,r=t.getSeconds(),n=t;e&&e.timeZone!==null&&(n=_Me(new Date,e.timeZone));let s=n.getHours(),a=n.getMinutes(),o;e.format12h24h==="12ampm"&&(o=s>=12?"PM":"AM");let l=s;e.format12h24h!=="24"&&(l=s%12,l===0&&(l=12));let c,u;switch(i){case"HH:mm:ss":c=[l,a,r];break;case"HH:mm":c=[l,a];break;case"HH":c=[l],o=void 0;break;case"mm":c=[a],o=void 0;break;case"ss":c=[r],o=void 0;break;case"year":u=n.getFullYear();break;case"month":u=n.getMonth()+1;break;case"dayOfYear":u=Math.floor((n.getTime()-new Date(n.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":u=n.getDate();break;case"secondOfDay":u=s*60*60+a*60+r;break;default:console.error("Unknown time format",i),u=0;break}return c!==void 0?{textValue:c,suffix:o}:u}function SMe(t,e){switch(t.type){case"fresnel":return EMe(t,e);case"gradient":return AMe(t,e);case"depth":return TMe(t,e);case"normal":return CMe(t,e);case"noise":return DMe(t,e);case"rainbow":return PMe(t,e);case"toon":return RMe(t,e);case"outline":return OMe(t,e);case"transmission":return LMe(t,e);case"color":return MMe(t,e);case"pattern":return IMe(t,e)}}function wMe(t){return{type:t.type}}function Mh(t,e){let{alpha:i,mode:r,isMask:n}=t,s=typeof i=="string"?(Number(e.getVariable(i))??100)/100:i;return{...wMe(t),alpha:s,mode:r,isMask:n}}function MMe(t,e){return{...Mh(t,e),color:ol(t.color,e)}}function EMe(t,e){let{bias:i,scale:r,intensity:n,factor:s,color:a}=t;return{...Mh(t,e),color:ol(a,e),bias:i,scale:r,intensity:n,factor:s}}function AMe(t,e){let{gradientType:i,smooth:r,colors:n,steps:s,angle:a,offset:o,morph:l}=t;return{...Mh(t,e),gradientType:i,smooth:r,colors:n.map(c=>new Ri(c[0],c[1],c[2],c[3])),num:n.length,steps:s,offset:new Oe(...o),morph:new Oe(...l),angle:a}}function TMe(t,e){let{gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:o,direction:l,colors:c,steps:u,smooth:h}=t;return{...Mh(t,e),gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:new W(...o),direction:l?new W(...l):new W(1,0,0),colors:c.map(d=>d!==void 0?new Ri(d[0],d[1],d[2],d[3]):new Ri(0,0,0,0)),steps:u.slice(0,c.length),smooth:h}}function CMe(t,e){let{cnormal:i}=t;return{...Mh(t,e),cnormal:new W(i[0],i[1],i[2])}}function DMe(t,e){return{...Mh(t,e),scale:t.scale,move:t.move,fA:new Oe(...t.fA),fB:new Oe(...t.fB),size:new W(...t.size),distortion:new Oe(...t.distortion),colorA:ol(t.colorA,e),colorB:ol(t.colorB,e),colorC:ol(t.colorC,e),colorD:ol(t.colorD,e),noiseType:t.noiseType,voronoiStyle:t.voronoiStyle,highCut:t.highCut,lowCut:t.lowCut,smoothness:t.smoothness,seed:t.seed,quality:t.quality}}function PMe(t,e){return{...Mh(t,e),filmThickness:t.filmThickness,movement:t.movement,wavelengths:new W(...t.wavelengths),noiseStrength:t.noiseStrength,noiseScale:t.noiseScale,offset:new W(...t.offset)}}function RMe(t,e){return{...Mh(t,e),positioning:t.positioning,colors:t.colors.map(i=>new Ri(i[0],i[1],i[2],i[3])),num:t.colors.length,steps:t.steps,source:new W(...t.source),isWorldSpace:t.isWorldSpace,noiseStrength:t.noiseStrength,noiseScale:t.noiseScale,shadowColor:ol(t.shadowColor,e),offset:new W(...t.offset)}}function OMe(t,e){return{...Mh(t,e),outlineColor:ol(t.outlineColor,e),contourColor:ol(t.contourColor,e),outlineWidth:t.outlineWidth,contourWidth:t.contourWidth,outlineThreshold:t.outlineThreshold,contourThreshold:t.contourThreshold,outlineSmoothing:t.outlineSmoothing,contourFrequency:t.contourFrequency,contourDirection:new W(...t.contourDirection),positionalLines:t.positionalLines,compensation:t.compensation}}function LMe(t,e){return{...Mh(t,e),thickness:t.thickness,ior:t.ior,roughness:t.roughness}}function IMe(t,e){return{...Mh(t,e),style:t.style,projection:t.projection,axis:t.axis,blending:t.blending,offset:new Oe(...t.offset),colorA:ol(t.colorA,e),colorB:ol(t.colorB,e),frequency:new Oe(...t.frequency),size:t.size,variation:t.variation,smoothness:t.smoothness,zigzag:t.zigzag,rotation:t.rotation,vertical:new Oe(...t.vertical),horizontal:new Oe(...t.horizontal),sides:t.sides}}var mD=class extends ro{},zMe={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},UMe={depth:["colors"]};function BMe(t,e,i){var s,a;if(e==="isMask")return!0;let r=zMe[t.type],n=UMe[t.type];if(n!==void 0){let o=t.color;if(n.includes(e)){let l=(a=(s=o[e])==null?void 0:s.value)==null?void 0:a.length;if(l!==void 0&&l!==i.length)return!0}}return r!==void 0?r.includes(e):!1}function EQ(t,e,i){let r=i.uniforms[`f${i.id}_texture`];if(!r)return!1;let n=!1,s=t;if("image"in s){let a=s.image,o=e.image(a),l=r;l.image instanceof eg||l.image.deref(),l.image=o}if("video"in s){let a=s.video,o=e.video(a),l=r;l.image instanceof eg||l.image.deref(),l.image=o}if("wrapping"in s){let a=r;a.wrap=s.wrapping}if("minFilter"in s){let a=r;a.minFilter=s.minFilter}if("magFilter"in s){let a=r;a.magFilter=s.magFilter}if("rotation"in s&&i.uniforms[`f${i.id}_rotation`])return i.uniforms[`f${i.id}_rotation`].value=(s.rotation??0)*Qt.DEG2RAD,n;if("repeat"in s||"offset"in s||"rotation"in s){let a="mat",o=i.uniforms[`f${i.id}_${a}`];"repeat"in s&&(o.repeat=s.repeat),"offset"in s&&(o.offset=s.offset),"rotation"in s&&(o.rotation=s.rotation??0),o.updateMatrix()}return n}function NMe(t,e,i,r){let n=!1;for(let[s,a]of Object.entries(t)){if(s==="bumpMap"||s==="roughnessMap"){n=!0;continue}if(!s||a===void 0)continue;if(TQ(s,i,r,e)){s==="visible"&&i.type==="light"&&(n=!0);continue}i.visible=r.visible;let o=i.uniforms[`f${i.id}_${s}`];if(o&&!(o instanceof v4))switch(n=n||BMe(i,s,a),o.constructor){case bs:if(typeof a=="string"){let l=e.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof mD?o.value=new ro(l.r,l.g,l.b,l.a):o.setRGBA(l);break}case np:if(typeof a=="string"){let l=e.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof mD?o.value=new ro(l.r,l.g,l.b,l.a):o.value.setRGBA(l.r,l.g,l.b,l.a);break}case Za:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]);break}case Yc:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]),o.value.setZ(l[2]);break}case up:{EQ(a,e,i);break}case Yv:{o.value=a.map(l=>new Ri(...l));break}default:{o.value=a;break}}}return n}var B0=(t,e,i)=>Math.max(0,Math.min(1,Number(e.getVariable(typeof t=="number"?t*100:t,i)??100)/100))??1,CM=class{constructor(t,e,i,r,n){this.id=t,this.uuid=e,this.data=i,this.uniforms={};for(let s in r)this.uniforms[`f${this.id}_${s}`]=r[s];for(let s in i)TQ(s,this,i,n)}get type(){return this.data.type}static create(t,e,i,r){if(i.type==="light")return Ad.createLightLayer(t,e,i,r);if(i.type==="texture"||i.type==="video"){let n=i.type==="texture"?r.uiBuffer(i.texture.image)??r.image(i.texture.image):r.video(i.texture.video),s=new XU(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new kwe(n),o=new Vwe(i.texture.repeat,i.texture.offset,i.texture.rotation??0),l=new $t(i.crop?1:0),c=new hn(i.projection??0),u=new hn(["x","y","z"].indexOf(i.axis)??0),h=new hn(i.side??0),d=new Za(i.size?new Oe(i.size[0],i.size[1]):new Oe(100,100)),p=new $t(i.blending??0),g=new $t(B0(i.alpha,r)),x=new hn(i.mode??0),v=new rl(i.isMask??!1),b=new y4(s,a,l,c,u,h,d,p,o,g,x,v),w=new Tn(b.calpha,"f");return new vs(t,e,i,{texture:s,textureSize:a,crop:l,projection:c,axis:u,side:h,size:d,blending:p,mat:o,alpha:g,mode:x,isMask:v},b,x,w,v,r)}else if(i.type==="matcap"){let n=r.image(i.texture.image),s=new XU(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new $t(B0(i.alpha,r)),o=new hn(i.mode??0),l=new rl(i.isMask??!1),c=new $t((i.texture.rotation??0)*Qt.DEG2RAD),u=new oQ(s,a,o,l,c),h=new Tn(u.calpha,"f");return new vs(t,e,i,{texture:s,alpha:a,mode:o,isMask:l,rotation:c},u,o,h,l,r)}else if(i.type==="displace")if(i.displacementType==="noise"){let n=new Yc(new W(...i.offset)),s=new $t(i.scale??10),a=new $t(i.intensity??8),o=new $t(i.movement??1),l=new hn(i.noiseType??0),c=new hn(i.voronoiStyle??0),u=new $t(i.smoothness??.5),h=new $t(i.seed??0),d=new $t(i.highCut??1),p=new $t(i.lowCut??0),g=new hn(i.quality??1),x=new xQ(a,o,n,c,u,h,d,p,g,s,l);return new AQ(t,e,i,{offset:n,scale:s,intensity:a,movement:o,noiseType:l,voronoiStyle:c,smoothness:u,seed:h,highCut:d,lowCut:p,quality:g},x,r)}else throw new Error;else return VMe(t,e,i,r)}updateByOp(t,e,i){let r=t;if(r.path[0]===void 0){if(r.type===0)return"type"in r.props||"category"in r.props||"visible"in r.props||"noiseType"in r.props?(i.scene.markNeedsUpdateRendererDirty(),!0):NMe(r.props,i.shared,this,e)}else if(r.path[0]==="texture")return"texture"in e||"video"in e?EQ(r.props,i.shared,this):!0;return!1}dispose(){if(FMe(this)){let t=this.uniforms[`f${this.id}_texture`];if(!t)return!1;let e=t;e.image instanceof eg||e.image.deref()}}hasValueByKey(t){return this.uniforms[t]!==void 0}hasValue(t){return this.hasValueByKey(`f${this.id}_${t}`)}setValue(t,e){let i=`f${this.id}_${t}`;this.hasValueByKey(i)&&e!==void 0&&(this.uniforms[i].value=e)}getNode(t){let e=`f${this.id}_${t}`;if(this.hasValueByKey(e))return this.uniforms[e]}getValue(t){let e=`f${this.id}_${t}`;if(this.hasValueByKey(e))return this.uniforms[e].value}getName(t){let e=/f\d+_(.*)/.exec(t);if(e&&e.length>1)return e[1];console.log(`Layer.getName: error ${t}`)}getNames(){let t=[];for(let e in this.uniforms){let i=this.getName(e);i&&t.push(i)}return t}},vs=class extends CM{constructor(t,e,i,r,n,s,a,o,l){super(t,e,i,r,l),this.params=r,this.color=n,this.mode=s,this.alpha=a,this.isMask=o}},AQ=class extends CM{constructor(t,e,i,r,n,s){super(t,e,i,r,s),this.position=n}},Ad=class extends CM{constructor(t,e,i,r,n,s){super(t,e,i,n,s),this.node=r}static createLightLayer(t,e,i,r){let n,s=new $t(B0(i.alpha,r)),a=new hn(i.mode),o=new $t(i.bumpMapIntensity),l=new $t(B0(i.alphaOverride,r)),c;if(!i.visible)n=new x4,c={};else if(i.category==="lambert"){n=new Wwe;let u=new bs(r.color(i.emissive)??0),h=new rl(i.occlusion??!0);c={emissive:u,occlusion:h},n.emissive=u,n.occlusion=h}else if(i.category==="toon"){n=new Ywe;let u=new $t(i.shininess??30),h=new bs(r.color(i.specular)??1118481);c={shininess:u,specular:h},n.shininess=u,n.specular=h}else if(i.category==="physical"){n=new Xwe;let u=new $t(i.roughness??.3),h=new $t(i.metalness??0),d=new $t(i.reflectivity??.5),p=new rl(i.occlusion??!0);c={roughness:u,metalness:h,reflectivity:d,occlusion:p},n.roughness=u,n.metalness=h,n.reflectivity=d,n.occlusion=p}else{n=new qwe;let u=new $t(i.shininess??30),h=new bs(i.specular!==void 0?r.color(i.specular)??1118481:1118481),d=new rl(i.occlusion??!0);c={shininess:u,specular:h,occlusion:d},n.shininess=u,n.specular=h,n.occlusion=d}return n.alpha=new $t(1),n.shadingAlpha=s,n.shadingBlend=a,n.bumpMapIntensity=o,n.alphaOverride=l,c.alpha=n.shadingAlpha,c.mode=n.shadingBlend,c.bumpMapIntensity=n.bumpMapIntensity,c.alphaOverride=n.alphaOverride,new Ad(t,e,i,n,c,r)}get category(){return this.node.category}};function FMe(t){let e=t instanceof CM?t.type:t;return e==="texture"||e==="video"||e==="displace_map"||e==="matcap"}function Hc(t){return{alpha:new $t(t.alpha??1),mode:new hn(t.mode??0),isMask:new rl(t.isMask??!1)}}function kMe(t,e,i,r,n){switch(t.type){case"color":{let s=new bs(r.color??_c),a=Hc(r),o=new YU(s,a.alpha),l=new Tn(o.calpha,"f");return new vs(e,i,t,{color:s,...a},o,a.mode,l,a.isMask,n)}case"fresnel":{let s=new bs(r.color??16777215),a=new $t(r.bias??.1),o=new $t(r.scale??1),l=new $t(r.intensity??2),c=new $t(r.factor??1),u=Hc(r),h=new Hwe(s,a,o,l,c,u.alpha,u.mode,u.isMask),d=new Tn(h.calpha,"f");return new vs(e,i,t,{color:s,bias:a,scale:o,intensity:l,factor:c,...u},h,u.mode,d,u.isMask,n)}case"rainbow":{let s=new $t(r.filmThickness??30),a=new $t(r.movement??0),o=new Yc(r.wavelengths??new W(0,0,0)),l=new $t(r.noiseStrength??0),c=new $t(r.noiseScale??1),u=new Yc(r.offset??new W(0,0,0)),h=Hc(r),d=new fQ(s,a,o,l,c,u,h.alpha,h.isMask),p=new Tn(d.calpha,"f");return new vs(e,i,t,{filmThickness:s,movement:a,wavelengths:o,noiseStrength:l,noiseScale:c,offset:u,...h},d,h.mode,p,h.isMask,n)}case"transmission":{let s=new $t(r.thickness??10),a=new $t(r.ior??1.5),o=new $t(r.roughness??.5),l=wi.transmissionSize,c=wi.transmissionRenderTarget,u=wi.transmissionRenderTargetDepth,h=window.innerWidth,d=window.innerHeight,p=h>=d?new Za(d/h,1):new Za(1,h/d),g=Hc(r),x=new vQ(s,a,o,l,c,u,p,g.alpha),v=new Tn(x.calpha,"f");return new vs(e,i,t,{thickness:s,ior:a,roughness:o,aspectRatio:p,...g},x,g.mode,v,g.isMask,n)}case"toon":{let s=new hn(r.positioning??0),a;r.colors?a=new Yv(r.colors.length,r.colors):(a=new Yv(10,new Ri(0,0,0,1)),a.value[1]=new Ri(1,1,1,1));let o;r.steps?o=new Xv(r.steps.length,r.steps):(o=new Xv(10,1),o.value[0]=0);let l=new Yc(r.source??new W(0,0,0)),c=new rl(r.isWorldSpace??!0),u=new $t(r.noiseStrength??0),h=new $t(r.noiseScale??1),d=new np(r.shadowColor),p=new Yc(r.offset??new W(0,0,0)),g=Hc(r),x=new mQ(s,a,o,l,c,u,h,d,p,g.alpha),v=new Tn(x.calpha,"f");return new vs(e,i,t,{positioning:s,colors:a,steps:o,source:l,isWorldSpace:c,noiseStrength:u,noiseScale:h,shadowColor:d,offset:p,...g},x,g.mode,v,g.isMask,n)}case"outline":{let s=new bs(r.outlineColor??16777215),a=new bs(r.contourColor??16777215),o=new $t(r.outlineWidth??.1),l=new $t(r.contourWidth??.1),c=new $t(r.outlineThreshold??.1),u=new $t(r.contourThreshold??.1),h=new $t(r.outlineSmoothing??.1),d=new $t(r.contourFrequency??.1),p=new Yc(r.contourDirection??new W(0,1,0)),g=new rl(r.positionalLines??!1),x=new rl(r.compensation??!0),v=wi.normalRenderTarget,b=wi.normalRenderTargetDepth,w=wi.pixelRatioNode,M=wi.resolution,E=Hc(r),D=new uQ(s,a,o,l,c,u,h,d,p,g,x,M,v,b,w,E.alpha),T=new Tn(D.calpha,"f");return new vs(e,i,t,{outlineColor:s,contourColor:a,outlineWidth:o,contourWidth:l,outlineThreshold:c,contourThreshold:u,outlineSmoothing:h,contourFrequency:d,contourDirection:p,positionalLines:g,compensation:x,...E},D,E.mode,T,E.isMask,n)}case"depth":{let s=new hn(r.gradientType??0),a=new rl(r.smooth??!1),o=new $t(r.near??50),l=new $t(r.far??200),c=new $t(r.isVector??1),u=new $t(r.isWorldSpace??0),h=new Yc(r.origin??new W),d=new Yc(r.direction??new W),p;r.colors?p=new Yv(r.colors.length,r.colors):(p=new Yv(2,new Ri(0,0,0,1)),p.value[1]=new Ri(1,1,1,1));let g;r.steps?g=new Xv(r.steps.length,r.steps):(g=new Xv(2,1),g.value[0]=0);let x=Hc(r),v=new rQ(s,a,o,l,c,u,h,d,p,g,x.alpha,x.isMask),b=new Tn(v.calpha,"f");return new vs(e,i,t,{gradientType:s,smooth:a,near:o,far:l,isVector:c,isWorldSpace:u,origin:h,direction:d,colors:p,steps:g,...x},v,x.mode,b,x.isMask,n)}case"noise":{let s=new $t(r.scale??1),a=new Yc(r.size??new W(100,100,100)),o=new $t(r.move??1),l=new Za(r.fA??new Oe(1.7,9.2)),c=new Za(r.fB??new Oe(8.3,2.8)),u=new Za(r.distortion??new Oe(1,1)),h=new np(r.colorA),d=new np(r.colorB),p=new np(r.colorC),g=new np(r.colorD),x=new hn(r.noiseType??0),v=new hn(r.voronoiStyle??0),b=new $t(r.highCut??1),w=new $t(r.lowCut??0),M=new $t(r.smoothness??.5),E=new $t(r.seed??.5),D=new hn(r.quality??1),T=Hc(r),L=new lQ(s,a,o,l,c,u,h,d,p,g,T.alpha,x,T.isMask,v,b,w,M,E,D),P=new Tn(L.calpha,"f");return new vs(e,i,t,{scale:s,size:a,move:o,fA:l,fB:c,distortion:u,colorA:h,colorB:d,colorC:p,colorD:g,noiseType:x,...T,voronoiStyle:v,highCut:b,lowCut:w,smoothness:M,seed:E,quality:D},L,T.mode,P,T.isMask,n)}case"normal":{let s=new Yc(r.cnormal??new W(1,1,1)),a=Hc(r),o=new iQ(s,a.alpha),l=new Tn(o.calpha,"f");return new vs(e,i,t,{cnormal:s,...a},o,a.mode,l,a.isMask,n)}case"gradient":{let s=new hn(r.gradientType??0),a=new rl(r.smooth??!1),o;r.colors?o=new Yv(r.colors.length,r.colors):(o=new Yv(10,new Ri(0,0,0,1)),o.value[1]=new Ri(1,1,1,1));let l;r.steps?l=new Xv(r.steps.length,r.steps):(l=new Xv(10,1),l.value[0]=0);let c=new Za(r.offset??new Oe(0,0)),u=new Za(r.morph??new Oe(0,0)),h=new $t(r.angle??0),d=Hc(r),p=new sQ(s,a,o,l,c,u,h,d.alpha,d.isMask),g=new Tn(p.calpha,"f");return new vs(e,i,t,{gradientType:s,smooth:a,colors:o,steps:l,offset:c,morph:u,angle:h,...d},p,d.mode,g,d.isMask,n)}case"pattern":{let s=new hn(r.style??0),a=new hn(r.projection??0),o=new hn(["x","y","z"].indexOf(r.axis)??0),l=new $t(r.blending??0),c=new Za(r.offset??new Oe(0,0)),u=new np(r.colorA),h=new np(r.colorB),d=new Za(r.frequency??new Oe(10,10)),p=new $t(r.size??.5),g=new $t(r.variation??0),x=new $t(r.smoothness??.5),v=new $t(r.zigzag??0),b=new $t(r.rotation??0),w=new Za(r.vertical??new Oe(0,1)),M=new Za(r.horizontal??new Oe(0,1)),E=new hn(r.sides??6),D=Hc(r),T=new hQ(s,a,o,l,c,u,h,d,p,g,x,v,b,w,M,E,D.alpha,D.isMask),L=new Tn(T.calpha,"f");return new vs(e,i,t,{style:s,projection:a,axis:o,blending:l,offset:c,colorA:u,colorB:h,frequency:d,size:p,variation:g,smoothness:x,zigzag:v,rotation:b,vertical:w,horizontal:M,sides:E,...D},T,D.mode,L,D.isMask,n)}default:{let s=new bs(1,0,0,1),a=Hc(r),o=new YU(s,a.alpha),l=new Tn(o.calpha,"f");return new vs(e,i,t,{color:s,...a},o,a.mode,l,a.isMask,n)}}}function VMe(t,e,i,r){let n=SMe(i,r);return kMe(i,t,e,n,r)}function TQ(t,e,i,r){if(i.type==="displace"&&(t==="intensity"||t==="visible")){let n=e.uniforms[`f${e.id}_intensity`];return n?(n.value=i.intensity*(i.visible?1:0),n):void 0}if(i.type!=="displace"&&(t==="alpha"||t==="visible")){let n=e.uniforms[`f${e.id}_alpha`];if(!n)return;if(n.value=B0(i.alpha,r)*(i.visible?1:0),i.type==="outline"&&t==="visible"){let s=e.uniforms[`f${e.id}_compensation`];s&&(s.value=i.compensation&&i.visible)}return n}}function n1(t,e){let i=0,r=t.layers.find(n=>n.data.type==="light");if(r){let n=r.data,s=Number(e.getVariable(n.alphaOverride));if((typeof n.alphaOverride=="string"?s/100:n.alphaOverride)<1)return!0}for(let n of t.layers){if(n.data.type!=="displace"&&n.data.isMask)return!0;if(n.data.type!=="displace"&&"alpha"in n.data&&n.data.type!=="light"&&n.data.type!=="fresnel"&&n.data.type!=="texture"&&n.data.type!=="matcap"&&n.data.type!=="rainbow"&&n.data.type!=="outline"&&n.data.type!=="pattern"){let s=n.data.visible?n.data.alpha:0;if(typeof s=="string"&&(s=Math.max(0,Math.min(1,Number(e.getVariable(s)??100)/100))),s===1&&n.data.type==="depth"||n.data.type==="gradient"){for(let a of n.data.colors)if(a[3]<1){s=a[3];break}}else if(s===1&&n.data.type==="noise"){let a=e.color(n.data.colorA).a,o=e.color(n.data.colorB).a,l=e.color(n.data.colorC).a,c=e.color(n.data.colorD).a,u=Math.min(a,Math.min(o,Math.min(l,c)));u<1&&(s=u)}i+=(1-i)*s}}return i<1}var wg=class extends xr{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.shadersPatchedForShapeBlend=!1,this.nodeContextUuid=0,this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return""}},HMe=class extends wg{constructor(t,e,i,r){super(),this.flatShading=t,this.side=e,this.wireframe=i,this.root=r}updateAfterBuild(){let t=this.root;this.lights=t.lights,this.vertexShader=t.vertexShader,this.fragmentShader=t.fragmentShader,Object.assign(this.defines,t.defines),Object.assign(this.uniforms,t.uniforms),this.extensions=t.extensions,this.transparent=t.transparent,this.cacheKey=t.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(t,e){this.root.onBeforeCompile(t)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(t,e,i,r){return this.root.getFlavor(t,e,i,r)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(t){return this.root.getLayersOfType(t)}getLayerByUuid(t){return this.root.getLayerByUuid(t)}updateByOp(t,e,i){this.root.updateByOp(t,e,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},b4=class extends wg{constructor(t,e,i=!0){super(),this.data=t,this.allowVariableSaves=i,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.needsJitter=e.shared.needsJitter,ta.startContext(this),this.reset0(t,e),ta.endContext(this)}get nodeMaterial(){return this}getFlavor(t,e,i,r){let n=i?6:(t?3:0)+e;if(n+=(((r==null?void 0:r.resolutionLevel)??0)-(r!=null&&r.useChildrenColors?4:0))*7,n===0)return this;this.flavors===void 0&&(this.flavors=[]),n-=1;let s=this.flavors[n];return s===void 0&&(s=new HMe(t,e,i,this),s.needsJitter=this.needsJitter,this.flavors[n]=s,s.flatShading=t,s.side=e,s.updateAfterBuild(),r&&(s.defines.SHAPEBLEND=r.resolutionLevel,s.defines.SHAPEBLEND_C=r.useChildrenColors?1:0)),s}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){var t;return((t=this.lightLayer.getNode("occlusion"))==null?void 0:t.value)??!1}reset(t,e,i=!1){ta.startContext(this),(this.data!==t||i)&&this.reset0(t,e),ta.endContext(this)}reset0(t,e){this.data=t;let i=t.layers??Oa.defaultTwoLayerData("phong").layers;try{this.layers=i.map(r=>CM.create(this.layerIdGen++,r.id,r.data,e.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=t.name??"Untitled Material",this.onUpdate(e.shared),this.transparent=n1(t,e.shared),this.saveVariableLocations(e)}onVariableUpdate(t,e,i){if(t[0]==="alphaOverride")this.transparent=n1(this.data,i.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(e)/100,1)));else if(t[0]==="layer"){let r=t[1],n=t[2];if(r&&n){let s=this.layers.find(a=>a.uuid===r);s!=null&&s.hasValue(n)&&(n==="alpha"?(this.transparent=n1(this.data,i.shared),s.setValue(n,Math.max(0,Math.min(Number(e)/100,1)))):s.setValue(n,e))}}}saveVariableLocations(t){if(!this.allowVariableSaves)return;let e=this.data.layers.find(i=>i.data.type==="light");e&&t.shared.getVariable(e.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach(i=>{"alpha"in i.data&&typeof i.data.alpha=="string"&&t.shared.getVariable(i.data.alpha,["material",this.uuid,"layer",i.id,"alpha"])})}getLayersOfType(t){return this.layers.filter(e=>e.type===t)}getLayerByUuid(t){return this.layers.find(e=>e.uuid===t)}onUpdate(t){this.lightLayer=this.layers.find(e=>e instanceof Ad),this.lightLayer===void 0&&(this.lightLayer=new Ad(0,"",{...Ta.defaultData("light","phong"),visible:!1},new x4,{},t)),this.dispose();for(let e of this.flavors)e&&e.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.build(),this.nodeContextUuid=0}applyTextureMaps(){let t=this.layers.find(n=>n instanceof Ad);if(!t)return;let e=t.data,i=e.bumpMap,r=e.roughnessMap;t.node.bumpMap=void 0,t.node.roughnessMap=void 0;for(let n=0;n<this.layers.length;++n){let s=this.layers[n];s instanceof vs&&s.color instanceof y4&&(s.uuid===i&&(t.node.bumpMap=s.color),s.uuid===r&&(t.node.roughnessMap=s.color))}}updateByOp(t,e,i){if(ta.startContext(this),e!==void 0?this.data=e:e=this.data,this.transparent=n1(e,i.shared),t.path[0]==="layers"){let r=i.shared,n=t.path[1];if(n===void 0)i.scene.markNeedsUpdateRendererDirty(),this.reset0(e,i);else{t.type===0&&t.props.occlusion!==void 0&&i.scene.markNeedsUpdateRendererDirty();let s=this.layers.find(a=>a.uuid===n);if(s){let a=e.layers.data(n),o;t.type===0&&("alpha"in t.props||"alphaOverride"in t.props)&&("alpha"in t.props?o={...t.props,alpha:B0(t.props.alpha,r,["material",this.uuid,"layer",n,"alpha"])}:o={...t.props,alphaOverride:B0(t.props.alphaOverride,r,["material",this.uuid,"alphaOverride"])}),s.updateByOp({...t,...o?{props:o}:{},path:t.path.slice(2)},a,i)&&this.reset0(e,i)}}}else this.reset0(e,i);ta.endContext(this)}applyMasks(){for(let t=0;t<this.layers.length;++t){let e=this.layers[t];e instanceof vs?e.color.mask=void 0:e instanceof Ad&&(e.node.mask=void 0)}for(let t=0;t<this.layers.length;++t){let e=this.layers[t];if(e instanceof vs&&e.isMask.value&&e.data.visible&&t>0){let i=t-1,r=this.layers[i];r instanceof Ad?r.node.mask=new zl(e.color,e.alpha,zl.MUL):r instanceof vs&&(r.isMask.value||(r.color.mask=new zl(e.color,e.alpha,zl.MUL)))}}}blendColors(){let t=this.layers.findIndex(i=>i instanceof vs),e=this.layers.findIndex(i=>i instanceof Ad);if(t!==-1&&t<e){let i=this.layers[t].color;for(let r=t+1;r<e;++r){let n=this.layers[r];if(n instanceof vs){if(n.isMask.value)continue;i=new dG(i,n.color,n.alpha,n.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let t=new Tn("outgoingLight","f"),e=this.layers.findIndex(i=>i instanceof Ad);if(this.layers.length>e+1){for(let i=e+1;i<this.layers.length;++i){let r=this.layers[i];if(r instanceof vs){if(r.isMask.value)continue;t=new dG(t,r.color,r.alpha,r.mode)}}this.fragment.afterColor=t}else this.fragment.afterColor=void 0}blendPositions(){let t=this.layers.filter(e=>e instanceof AQ);if(t.length>0){let e=t[0].position;for(let i=1;i<t.length;++i)t[i]&&(e=new zl(e,t[i].position,zl.ADD),e=new zl(e,new $t(.5).setReadonly(!0),zl.MUL));this.fragment.position=e}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(t){this.shapeBlendhack&&this.shapeBlendhack(this),t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.extensionDerivatives=this.extensions.derivatives===!0,t.extensionFragDepth=this.extensions.fragDepth===!0,t.extensionDrawBuffers=this.extensions.drawBuffers===!0,t.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(t,e){let i=(r,n,s)=>Math.min(Math.max(r,n),s);for(let r of this.layers)if(r.type==="displace"){let n=i(r.uniforms[`f${r.id}_intensity`].value,t,e);r.uniforms[`f${r.id}_intensity`].value=n}}updateFrame(t){for(let e=0;e<this.updaters.length;++e)t.updateNode(this.updaters[e])}build(){let t=new JY;t.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,t.build(this.fragment,this.fragment),this.vertexShader=t.getCode("vertex"),this.fragmentShader=t.getCode("fragment"),this.defines=t.defines,this.uniforms=t.uniforms,this.extensions=t.extensions,this.updaters=t.updaters;for(let e of this.flavors)e&&e.updateAfterBuild();return this.shadersPatchedForShapeBlend=!1,this}nodeMaterialDispose(){this.layers.forEach(t=>t.dispose()),super.dispose();for(let t of this.flavors)t&&t.dispose()}assetsLoaded(){for(let t of this.layers)if(t instanceof vs){let e=t.params.texture;if(e instanceof XU&&!e.image.loaded)return!1}return!0}};Object.defineProperties(wg.prototype,{properties:{get:function(){return this.fragment.properties}}});var KU=class extends b4{constructor(t,e,i){super(t,e,!1),this.uuid=i,this.allowVariableSaves=!0,this.saveVariableLocations(e)}},SG=new Map;function GMe(t){if(typeof t=="string")return t;let e=SG.get(t);return e||(e={url:URL.createObjectURL(new Blob([t]))},SG.set(t,e)),e.url}var CQ,jMe=new Promise(t=>{CQ=t}),wG=!1,_2;function WMe(){if(wG)return;if(_2)return _2;async function t(){await Cg(()=>import("./howler-C4jvyAWk.js").then(e=>e.h),[]),CQ(window!==void 0?window:global),wG=!0}return _2=t(),_2}var DQ;jMe.then(t=>DQ=t);function qMe(t){let e=!1;return t.scene.objects.traverse((i,r)=>{if(r.events===void 0||Array.isArray(r.events)===!1)return!0;let n=[];r.events.forEach(s=>{"dragDropActions"in s.data?(n.push(...s.data.dragDropActions.drag),n.push(...s.data.dragDropActions.drop)):"inActions"in s.data?(n.push(...s.data.inActions),n.push(...s.data.outActions)):"gameActions"in s.data?(n.push(...s.data.gameActions.idle),n.push(...s.data.gameActions.move),n.push(...s.data.gameActions.jump),n.push(...s.data.gameActions.run)):"breakpoints"in s.data?s.data.breakpoints.forEach(a=>{n.push(...a.data.actions)}):"actions"in s.data&&n.push(...s.data.actions),e=e||n.some(a=>a.data.type==="Audio")})}),e}var kS=class{constructor({src:t,volume:e,delay:i,loop:r}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let n;typeof t=="string"?n={src:t}:n={src:GMe(t),format:"wav"},this.sound=new DQ.Howl(n),this.sound.on("end",this.onEnd),this.src=t,e!==void 0&&(this.volume=e),i!==void 0&&(this.delay=i),r!==void 0&&(this.loop=r)}get status(){return this._status}get volume(){return this._volume}set volume(t){this._volume=t,this.sound.volume(t)}get loop(){return this._loop}set loop(t){this._loop=t,this.loopsRemaining=t}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(t,e=1e3){t?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,e),this.clearFade()},t)):this.sound.fade(this._volume,0,e)}on(t,e,i){this.sound.on(t,e,i)}off(t,e,i){this.sound.off(t,e,i)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(t=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},XMe=class{constructor(){this.type="ShapePath",this.color=new bi,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new DC,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){var i;return(i=this.currentPath)==null||i.lineTo(t,e),this}quadraticCurveTo(t,e,i,r){var n;return(n=this.currentPath)==null||n.quadraticCurveTo(t,e,i,r),this}bezierCurveTo(t,e,i,r,n,s){var a;return(a=this.currentPath)==null||a.bezierCurveTo(t,e,i,r,n,s),this}splineThru(t){var e;return(e=this.currentPath)==null||e.splineThru(t),this}toShapes(){let t={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},e={loc:t.ORIGIN,t:0};function i(p,g,x,v){let b=p.x,w=g.x,M=x.x,E=v.x,D=p.y,T=g.y,L=x.y,P=v.y,R=(E-M)*(D-L)-(P-L)*(b-M),O=(w-b)*(D-L)-(T-D)*(b-M),U=(P-L)*(w-b)-(E-M)*(T-D),F=R/U,V=O/U;if(U===0&&R!==0||F<=0||F>=1||V<0||V>1)return null;if(R===0&&U===0){for(let k=0;k<2;k++)if(r(k===0?x:v,p,g),e.loc===t.ORIGIN){let K=k===0?x:v;return{x:K.x,y:K.y,t:e.t}}else if(e.loc===t.BETWEEN){let K=+(b+e.t*(w-b)).toPrecision(10),X=+(D+e.t*(T-D)).toPrecision(10);return{x:K,y:X,t:e.t}}return null}else{for(let X=0;X<2;X++)if(r(X===0?x:v,p,g),e.loc===t.ORIGIN){let $=X===0?x:v;return{x:$.x,y:$.y,t:e.t}}let k=+(b+F*(w-b)).toPrecision(10),K=+(D+F*(T-D)).toPrecision(10);return{x:k,y:K,t:F}}}function r(p,g,x){let v=x.x-g.x,b=x.y-g.y,w=p.x-g.x,M=p.y-g.y,E=v*M-w*b;if(p.x===g.x&&p.y===g.y){e.loc=t.ORIGIN,e.t=0;return}if(p.x===x.x&&p.y===x.y){e.loc=t.DESTINATION,e.t=1;return}if(E<-Number.EPSILON){e.loc=t.LEFT;return}if(E>Number.EPSILON){e.loc=t.RIGHT;return}if(v*w<0||b*M<0){e.loc=t.BEHIND;return}if(Math.sqrt(v*v+b*b)<Math.sqrt(w*w+M*M)){e.loc=t.BEYOND;return}let D;v!==0?D=w/v:D=M/b,e.loc=t.BETWEEN,e.t=D}function n(p,g){let x=[],v=[];for(let b=1;b<p.length;b++){let w=p[b-1],M=p[b];for(let E=1;E<g.length;E++){let D=g[E-1],T=g[E],L=i(w,M,D,T);L!==null&&x.find(P=>P.t<=L.t+Number.EPSILON&&P.t>=L.t-Number.EPSILON)===void 0&&(x.push(L),v.push(new Oe(L.x,L.y)))}}return v}function s(p,g,x){let v=new Oe;g.getCenter(v);let b=[];return x.forEach(w=>{w.boundingBox.containsPoint(v)&&n(p,w.points).forEach(M=>{b.push({identifier:w.identifier,isCW:w.isCW,point:M})})}),b.sort((w,M)=>w.point.x-M.point.x),b}function a(p,g,x,v,b){(b==null||b==="")&&(b="nonzero");let w=new Oe;p.boundingBox.getCenter(w);let M=[new Oe(x,w.y),new Oe(v,w.y)],E=s(M,p.boundingBox,g);E.sort((O,U)=>O.point.x-U.point.x);let D=[],T=[];E.forEach(O=>{O.identifier===p.identifier?D.push(O):T.push(O)});let L=D[0].point.x,P=[],R=0;for(;R<T.length&&T[R].point.x<L;)P.length>0&&P[P.length-1]===T[R].identifier?P.pop():P.push(T[R].identifier),R++;if(P.push(p.identifier),b==="evenodd"){let O=P.length%2===0,U=P[P.length-2];return{identifier:p.identifier,isHole:O,for:U}}else if(b==="nonzero"){let O=!0,U=null,F=null;for(let V=0;V<P.length;V++){let k=P[V];g[k]&&(O?(F=g[k].isCW,O=!1,U=k):F!==g[k].isCW&&(F=g[k].isCW,O=!0))}return{identifier:p.identifier,isHole:O,for:U}}else console.warn('fill-rule: "'+b+'" is currently not implemented.')}let o=0,l=999999999,c=-999999999,u=[];this.subPaths.forEach(p=>{let g=p.getPoints(),x=-999999999,v=999999999,b=-999999999,w=999999999;for(let M=0;M<g.length;M++){let E=g[M];E.y>x&&(x=E.y),E.y<v&&(v=E.y),E.x>b&&(b=E.x),E.x<w&&(w=E.x)}c<=b&&(c=b+1),l>=w&&(l=w-1),g.length&&u.push({curves:p.curves,points:g,isCW:Rq.isClockWise(g),identifier:o++,boundingBox:new RN(new Oe(w,v),new Oe(b,x))})});let h=u.map(p=>{var g;return a(p,u,l,c,(g=this.userData)==null?void 0:g.style.fillRule)}),d=[];return u.forEach(p=>{let g=h[p.identifier];if(g&&!g.isHole){let x=new PC;x.curves=p.curves,h.filter(v=>(v==null?void 0:v.isHole)&&v.for===p.identifier).forEach(v=>{if(v){let b=u[v.identifier],w=new DC;w.curves=b.curves,x.holes.push(w)}}),d.push(x)}}),d}},PQ=!1,RQ,MG=new Promise(t=>{RQ=t}),EG=!1,S2;function YMe(){if(PQ=!0,EG)return;if(S2)return S2;async function t(){let e=await Cg(()=>import("./opentype-LDE648lb.js"),[]);RQ(e),EG=!0}return S2=t(),S2}var QMe=class{async load(t,e,i=()=>{}){let{load:r}=await MG;r(t,(n,s)=>{n||!s?i(n??"Something went wrong"):e(s)})}async parse(t){let{parse:e,Bidi:i}=await MG;try{let r=e(t),n=new i,s=a=>r.charToGlyphIndex(a.char);return n.registerModifier("glyphIndex",null,s),n.applyFeatures(r,r.defaultRenderOptions.features),{font:r,bidi:n}}catch(r){console.error(r)}}};async function ZMe(t){return await(await fetch(t)).arrayBuffer()}var KMe=new QMe;async function AG(t){let e,i,r=!1;if(t.url?(e=await ZMe(t.url),i=t.url,r=t.url.startsWith("/")):t.data&&(e=t.data.buffer.slice(t.data.byteOffset,t.data.byteOffset+t.data.byteLength)),e)if(PQ){let n=await KMe.parse(e);if(n)return{font:n.font,url:i,intercepted:r,arr:e,bidi:n.bidi}}else return{font:void 0,url:i,intercepted:r,arr:e,bidi:null}}function JMe(t,e){return e.state.glyphIndex===t||e.state.fina===t||e.state.medi===t||e.state.init===t}var $Me=class{constructor(t){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=t.isUserFont??!1,this._loadingPromise=AG(t).then(e=>{e&&(this._arrayBuffer=e.arr,this._url=e.url,this.font=e.font,this._intercepted=e.intercepted,this._isLoaded=!0,this._bidi=e.bidi)})}update(t){this._isLoaded=!1,this._isUserFont=t.isUserFont??!1,this._loadingPromise=AG(t).then(e=>{e&&(this._arrayBuffer=e.arr,this._url=e.url,this.font=e.font,this._intercepted=e.intercepted,this._isLoaded=!0,this._bidi=e.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(t,e,i){if(!this._bidi)return[];let r=this._bidi;r.getTextGlyphs(e);let n=r.tokenizer.tokens,s=[],a=0,o=i.length===n.length;for(let l=0;l<i.length;l++){let c=i[l].index,u=String.fromCharCode(i[l].unicode),h=n[a];if(JMe(c,h)||o)s.push({char:u,index:c,replacements:[h.state.glyphIndex],replacementChars:[h.char]}),a++;else{let d=h.char,p="",g=[h.state.glyphIndex],x=[],v=!1;for(;!v;)a++,p=e.charAt(a),d+=p,g.push(t.charToGlyphIndex(p)),x=t.stringToGlyphs(d),x.length===1&&x[0].index===c&&(v=!0),a>e.length&&(v=!0);s.push({char:u,index:c,replacements:g,replacementChars:Array.from(d)}),a++}}return s}generateShapes(t,e){if(!this._isLoaded)return;let i=this.font,r=e.fontSize/this.unitsPerEm,n=e.fontSize*e.lineHeight,s=t.map(b=>this.getTextWidth(b,e)),a=e.width,o=this.getCharWidth(`
`,e),l=e.horizontalAlign===1?o:0,c=this.computeSpaceWidthForLine(t,0,e),u=this.getLineInitialOffsetX(s[0],a,e.horizontalAlign,t[0],o),h=this.getLineInitialOffsetY(n,t.length,e.height,r,e.verticalAlign),d=[],p=t.map(b=>[]),g=t.map(b=>[]),x;for(let b=0;b<t.length;b++){let w=t[b],M={features:{liga:!0}},E=[];try{E=i.stringToGlyphs(w,M)}catch(T){console.warn(T)}u=this.getLineInitialOffsetX(s[b],a,e.horizontalAlign,w,o);let D=[];try{D=this.reverseLigaturesTable(i,w,E)}catch(T){console.warn(T)}c=this.computeSpaceWidthForLine(t,b,e);for(let T=0;T<E.length;T++){let L=E[T],P=L.index===0?`
`:L.unicode?String.fromCharCode(L.unicode):void 0,R=D[T],O=0,U=0;T===0&&e.horizontalAlign===2&&L.leftSideBearing!==void 0&&(U=-L.leftSideBearing*r),x&&(O=i.getKerningValue(L,x)*r),u+=U+O;let F=0;if(P===`
`)F=l;else if(P===" ")F=c;else{let V=this.createPath(L,r,u,h,e);V&&(F=V.offsetX-(O+U),d.push(V.path))}if(R.replacements.length===1)g[b].push([u,h]),p[b].push(F);else{let V=R.replacements.map($=>(i.glyphs.get($).advanceWidth??0)*r),k=V.reduce(($,Y)=>$+=Y,0),K=V.map($=>$/k),X=u;for(let $=0;$<K.length;$++){let Y=F*K[$];g[b].push([X,h]),p[b].push(Y),X+=Y}}u+=F,x=L}h-=n}let v=[];for(let b=0,w=d.length;b<w;b++)v.push(...d[b].toShapes());return{shapes:v,charWidths:p,lineWidths:s,charCoords:g}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var t;return((t=this.font)==null?void 0:t.ascender)??0}get descender(){var t;return((t=this.font)==null?void 0:t.descender)??0}get familyName(){var t;return((t=this.font)==null?void 0:t.names.fontFamily)??""}get subfamilyName(){var t;return((t=this.font)==null?void 0:t.names.fontSubfamily)??""}get unitsPerEm(){var t;return((t=this.font)==null?void 0:t.unitsPerEm)??1}getLineInitialOffsetX(t,e,i,r,n){return(i===3||i===2)&&r.indexOf(`
`)>=0&&(t-=n),i===3?e*.5-t*.5:i===2?e-t:0}getLineInitialOffsetY(t,e,i,r,n){let s=e*t,a=Math.abs(this.ascender-this.descender)*r,o=t-a,l=-this.ascender*r-o/2;return n===3?-(i-s-l):n===2?-(i*.5-s*.5-l):l}createPath(t,e,i,r,n){var l;let s=t.getPath(i,-r,n.fontSize,{kerning:!1,letterSpacing:n.letterSpacing});if(!s){console.error('THREE.Font: character "'+t+'" does not exists in font family '+this.familyName+".");return}let a=new XMe,o=(t.advanceWidth??1)*e;if(t)for(let c of s.commands){let u=(l=a.currentPath)==null?void 0:l.currentPoint;if(!(u&&c.type!=="Z"&&u.x===c.x&&-u.y===c.y))switch(c.type){case"M":a.moveTo(c.x,-c.y);break;case"L":a.lineTo(c.x,-c.y);break;case"Q":a.quadraticCurveTo(c.x1,-c.y1,c.x,-c.y);break;case"C":a.bezierCurveTo(c.x1,-c.y1,c.x2,-c.y2,c.x,-c.y);break}}return a.subPaths.forEach(c=>{let u=eEe(c.curves);u!==void 0&&c.currentPoint.distanceTo(u)>0&&c.lineTo(u.x,u.y)}),{offsetX:o+n.fontSize*n.letterSpacing,path:a}}getCharWidth(t,e){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(t,e.fontSize,{kerning:!0,letterSpacing:e.letterSpacing}))??0}getTextWidth(t,e){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(t,e.fontSize,{kerning:!0,letterSpacing:e.letterSpacing}))??0}computeSpaceWidthForLine(t,e,i){let r=this.getCharWidth(" ",i),n=t[e];if(n){let s=this.countSpaces(n.trimEnd());if(i.horizontalAlign===4&&e<t.length-1&&s){let a=i.width,o=this.getTextWidth(n,i);return(a-(o-s*r))/s}}return r}countSpaces(t){return(t.match(/ /g)||[]).length}};function eEe(t){if(t.length){let e=t[0];if(e instanceof ph)return e.v1;if(e instanceof uh||e instanceof _g)return e.v0}}var tEe=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(t){return this.objects.get(t)}get size(){return this.objects.size}get(t,e,i){let r=this.objects.get(t);return r===void 0?(r=this.createObject(t,e,i),this.objects.set(t,r)):r.isShared=!0,r}forceDelete(t){let e=this.objects.get(t);e&&(this.disposeObject(e),this.objects.delete(t))}mutateIfUnique(t,e){let i=this.objects.get(t);if(i&&i.isShared!==!0)return this.objects.delete(t),this.objects.set(e,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(t,e){let i=this.objects.get(t);e===i&&this.unreachable.delete(t)}endGc(){this.unreachable.forEach(t=>{this.disposeObject(this.objects.get(t)),this.objects.delete(t)}),this.unreachable.clear()}dispose(){this.objects.forEach(t=>{this.disposeObject(t)}),this.objects.clear()}},TG=class extends tEe{constructor(t){super(),this.flatShading=t}disposeObject(t){t.dispose()}createObject(t,e,i){let r=Gw(t,e,this.flatShading,i);return r.computeBoundingSphere(),r}},iEe={markNeedsUpdateRendererDirty:()=>{}},eC=1e3,CG=512*eC;function rEe(t,e){let i=typeof t;return!!((e==="string"||e==="number")&&i===e||e==="boolean"&&(t==="true"||t==="false"||t===!0||t===!1)||e==="image"&&i==="string"&&t.startsWith("http"))}var nEe="https://hooks.spline.design",sEe=`${nEe}/events?hashFile=`,aEe=class{constructor(e,i){this.id=e,this.userWebhook=i,this.result=void 0,this._connected=!1,this.emitter=Q3(),this.reconnectWaitFor=eC,this._onError=r=>{var n,s,a;(n=this.eventSource)==null||n.removeEventListener("message",this._onMessage),(s=this.eventSource)==null||s.removeEventListener("error",this._onError),(a=this.eventSource)==null||a.removeEventListener("open",this._onConnected),this._scheduleReconnect()},this._onConnected=r=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=eC,this._connected=!0},this._onDisconnected=()=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=eC,this._connected=!1},this._onMessage=r=>{let n=r.data,s;try{s=JSON.parse(n)}catch(a){console.error("Error parsing webhook message",a)}if(s){let a=!1;this.userWebhook.parametersSchemas.forEach(({data:o})=>{s[o.name]!==void 0&&rEe(s[o.name],o.type)&&(this.result===void 0&&(this.result={}),this.result[o.name]=s[o.name],a=!0)}),a&&this.emitter.emit("message",{userWebhookId:this.id})}}}connect(){clearTimeout(this.scheduledReconnectHandle),this.userWebhook.url&&(this.eventSource=new EventSource(sEe+this.userWebhook.url),this.eventSource.addEventListener("message",this._onMessage),this.eventSource.addEventListener("error",this._onError),this.eventSource.addEventListener("open",this._onConnected))}disconnect(){var e,i,r,n;(e=this.eventSource)==null||e.removeEventListener("message",this._onMessage),(i=this.eventSource)==null||i.removeEventListener("error",this._onError),(r=this.eventSource)==null||r.removeEventListener("open",this._onConnected),(n=this.eventSource)==null||n.close(),this._onDisconnected(),clearTimeout(this.scheduledReconnectHandle)}_scheduleReconnect(){this.reconnectWaitFor*=2,this.reconnectWaitFor>CG&&(this.reconnectWaitFor=CG),clearTimeout(this.scheduledReconnectHandle),this.scheduledReconnectHandle=setTimeout(()=>{this.scheduledReconnectHandle=void 0,this.connect()},this.reconnectWaitFor)}update(e){this.userWebhook=e}dispose(){this._connected&&this.disconnect()}get connected(){return this._connected}on(e,i){this.emitter.on(e,i)}off(e,i){this.emitter.off(e,i)}getParametersKeys(){return this.userWebhook.parametersSchemas.map(e=>e.data.name)}getParameterValue(e){var i;if(this.getParametersKeys().includes(e)){if(this.result)return(i=this.result)==null?void 0:i[e];for(let r of this.userWebhook.parametersSchemas)if(r.data.name===e)return EU.defaultParameterValueByType(r.data.type)}}},DG=[4186.01,4434.92,4698.63,4978.03,5274.04,5587.65,5919.91,6271.93,6644.88,7040,7458.62,7902.13],oEe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],yg=[],_4=[];for(let t=1;t<=8;t++)for(let e=0;e<DG.length;e++){let i=DG[e];yg.push(i/Math.pow(2,8-t)),_4.push(oEe[e]+t)}var gD=[32,2e3],PG=yg.filter((t,e)=>yg[e]>gD[0]&&yg[e]<gD[1]),lEe=_4.filter((t,e)=>yg[e]>gD[0]&&yg[e]<gD[1]),cEe=class{static getFrequencies(t,e,i,r="frequency",n=-100,s=-30){i||(i=new Float32Array(t.frequencyBinCount),t.getFloatFrequencyData(i));let a=e/2,o=1/i.length*a,l,c,u;if(r==="music"||r==="voice"){let d=r==="voice"?PG:yg,p=Array(d.length).fill(n);for(let g=0;g<i.length;g++){let x=g*o,v=i[g];for(let b=d.length-1;b>=0;b--)if(x>d[b]){p[b]=Math.max(p[b],v);break}}l=p,c=r==="voice"?PG:yg,u=r==="voice"?lEe:_4}else l=Array.from(i),c=l.map((d,p)=>o*p),u=c.map(d=>`${d.toFixed(2)} Hz`);let h=l.map(d=>Math.max(0,Math.min((d-n)/(s-n),1)));return{values:new Float32Array(h),frequencies:c,labels:u}}},uEe="gpt-4o-realtime-preview-2024-12-17",hEe=()=>"https://relayserver.spline.design/";async function dEe(t){try{return(await(await fetch(hEe()+"session?uuidfile="+t)).json()).token}catch(e){console.error("Token generation error:",e)}}var fEe=class{constructor(t){this.value=0,this.frequencies=new Float32Array(0);let e=new AudioContext;this.source=e.createMediaStreamSource(t),this.analyser=e.createAnalyser(),this.source.connect(this.analyser),this.analyser.fftSize=8192,this.analyser.smoothingTimeConstant=.1}getFrequencies(t=-100,e=-30){if(!this.analyser)throw new Error("Not connected, please call .connect() first");return cEe.getFrequencies(this.analyser,44100,void 0,"voice",t,e)}update(){let t=this.getFrequencies(),e=t.values.reduce((i,r)=>i+r,0)/t.values.length;this.value=e,this.frequencies=t.values}disconnect(){this.source.disconnect(),this.analyser.disconnect()}},RG=class{constructor(t,e,i){this.data=t,this.id=e,this.shared=i,this.emitter=Q3(),this.rafId=0,this.voice=0,this.frequencies=new Float32Array([0]),this.events=[],this.isConnected=!1,this.isToolsAdded=!1,this.tools=[],this.onMessage=r=>{var s;let n=JSON.parse(r.data);if(this.appendEvent(n),n.type==="session.created"&&this.onSessionCreated(),n.type==="response.done"&&((s=n.response)==null?void 0:s.output)){for(let a of n.response.output)if(a.type==="function_call")for(let[o,l]of this.tools)a.name===o.name&&(l(JSON.parse(a.arguments)),setTimeout(()=>{this.sendClientEvent({type:"response.create",response:{instructions:"notice the user about what you just did"}})}))}},this.onSessionCreated=()=>{this.isToolsAdded||this.registerTools()},this.onOpen=()=>{this.events=[],this.isConnected=!0,this.sendClientEvent({type:"response.create",response:{instructions:"Say hi"}})},this.animate=()=>{if(this.rafId=requestAnimationFrame(this.animate),this.isConnected&&this.analyser){this.analyser.update();let r=this.analyser.value,n=this.analyser.frequencies;this.voice=r,this.frequencies=n,this.emitter.emit("voice",{value:r,frequencies:n})}}}update(t){this.data=t}setColorByName(t,e){let i=this.shared.getColorByName(t);if(i){let{id:r}=i,{r:n,g:s,b:a}=NSe.hexStringToRgb(e)??{r:0,g:0,b:0};this.shared.updateColor(r,{r:n/255,g:s/255,b:a/255})}}async connect(){if(this.isConnected)return;let t=await dEe(this.data.integration.hash);this.pc=new RTCPeerConnection,this.audioElement=document.createElement("audio"),this.audioElement.autoplay=!0,this.pc.ontrack=n=>{let s=n.streams[0];this.audioElement.srcObject=s,this.analyser=new fEe(s)};let e=await navigator.mediaDevices.getUserMedia({audio:!0});this.pc.addTrack(e.getTracks()[0]),this.dc=this.pc.createDataChannel("oai-events"),this.dc.addEventListener("message",this.onMessage),this.dc.addEventListener("open",this.onOpen);let i=await this.pc.createOffer();await this.pc.setLocalDescription(i);let r={type:"answer",sdp:await(await fetch(`https://api.openai.com/v1/realtime?model=${uEe}`,{method:"POST",body:i.sdp,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/sdp"}})).text()};await this.pc.setRemoteDescription(r),this.animate()}appendEvent(t){this.events=[t,...this.events]}sendClientEvent(t){this.dc?(t.event_id=t.event_id||crypto.randomUUID(),this.dc.send(JSON.stringify(t)),this.appendEvent(t)):console.error("Failed to send message - no data channel available",t)}registerTools(){this.isToolsAdded=!0,this.registerTool({type:"function",name:"set_personality_color",description:"returns a color based on the voice personality of the ai assistant. This should be called by the voice assistant each time it is asks to speak differently. If a color cannot be associated to the personality, the color should be a neutral color.",parameters:{type:"object",properties:{color:{type:"string",description:"css hex color string, reflecting the personality"},personality:{type:"string",description:"the personality of the voice assistant"}},required:["color","personality"]}},({color:n})=>{this.setColorByName("Voice Assistant Color",n)});let t=this.shared.getVariablesNames().join(", ");this.registerTool({type:"function",name:"set_variable",description:"Sets a Spline variable value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the variable that needs to be set. Here's a list of available variables: ${t}. It the variable does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"The new value for this variable, should always be a string even for number and boolean variables, assume that the value will be cast to the proper type afterwards."}},required:["name","value","type"]}},({name:n,value:s})=>{let a=this.shared.getVariableByName(n);if(a){let o=this.shared.getVariable(a.id),l;typeof o=="number"?l=parseFloat(s):typeof o=="boolean"?l=s.toLowerCase()==="true":l={textValue:s},this.shared.updateVariable(a.id,l)}});let e=this.shared.getColorNames().join(", ");this.registerTool({type:"function",name:"set_color",description:"Sets a Spline color asset value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the color asset that needs to be set. Here's a list of available color assets: ${e}. It the color asset does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"css hex color string"}},required:["name","value"]}},({name:n,value:s})=>{this.setColorByName(n,s)});let i=this.shared.scene,r=[];i.traverseEntity(n=>{n.data.events.forEach(s=>{if(s.data.type==="AIAssistantTrigger"){let{description:a}=s.data;r.push(a)}})}),this.registerTool({type:"function",name:"trigger_event",description:"Trigger an event by name, here are the available events, please match what the user is asking for to one of these if it applies, otherwise don't call the function and warn the user.",parameters:{type:"object",properties:{description:{type:"string",description:`The name of the event that needs to be triggered. Here's a list of available events: ${JSON.stringify(r)}.`},direction:{type:"string",description:"default is forward, but can be forward or backward. Always set to forward unless the user ask to reverse or cancel the event, then set to backward."}},required:["description","direction"]}},({description:n,direction:s})=>{this.emitter.emit("trigger_event",{description:n,direction:s})}),this.sendClientEvent({type:"session.update",session:{tools:this.tools.map(([n])=>n)}})}registerTool(t,e){this.tools.push([t,e])}disconnect(){var t,e,i,r,n,s;cancelAnimationFrame(this.rafId),(t=this.analyser)==null||t.disconnect(),this.voice=0,this.isConnected=!1,this.isToolsAdded=!1,(e=this.dc)==null||e.removeEventListener("message",this.onMessage),(i=this.dc)==null||i.removeEventListener("open",this.onOpen),(r=this.dc)==null||r.close(),(n=this.pc)==null||n.getSenders().forEach(a=>{a.track&&a.track.stop()}),(s=this.pc)==null||s.close(),this.pc=void 0}computeAnalysisForListenerEvent(t){if(t.analysis==="range"){let e=this.frequencies.slice(...t.analysisRange);return e.reduce((i,r)=>i+r,0)/e.length}return t.analysis==="single"?this.frequencies[t.analysisSingle]:this.voice}on(t,e){this.emitter.on(t,e)}off(t,e){this.emitter.off(t,e)}};function JU(t){return"variable_"+t}var pEe=class extends $we{constructor(t){super(),this.shared=t}create(t){return new _Q(t,this.shared)}},S4=class{constructor(t,e={},i=!0,r=!1){if(this.data=t,this.needsJitter=i,this.enableLocalStorageForPersistentVariables=r,this.geometryCache=new TG(!0),this.geometryCache2=new TG(!1),this.imageHolderCache=new pEe(this),this.thisContext={scene:iEe,shared:this},this.deletedMaterial=new KU(Oa.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new eg(TU.emptyImage,this),this.deletedVideo=new eg(KC.defaultVideo,this),this.materials={},this.images={},this.uiBuffers={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.variables={},this.userAPIs={},this.userWebhooks={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},e.images)for(let[n,s]of Object.entries(e.images))this.addImage(n,s);if(e.videos)for(let[n,s]of Object.entries(e.videos))this.addVideo(n,s);if(e.audios)for(let[n,s]of Object.entries(e.audios))this.addAudio(n,s);if(e.particles)for(let[n,s]of Object.entries(e.particles))this.addParticle(n,s);this.reset(t)}setRequestRender(t){this._requestRender=t}getImageLoadPromises(){return Object.values(this.images).map(t=>t.loadPromise)}setEntityOpContext(t){this.entityOpContext=t}reset(t,e=!1){this.data=t,this.resetLib(t.lib);for(let{id:i,data:r}of t.variables)this.addVariableHolder(i,r),e&&this.updateVariableHolder(i,r);for(let[i,r]of Object.entries(t.userAPIs))this.addUserAPI(i,r);for(let[i,r]of Object.entries(t.userWebhooks))this.addUserWebhook(i,r);for(let[i,r]of Object.entries(t.images))this.addImage(i,r);for(let[i,r]of Object.entries(t.videos))this.addVideo(i,r);for(let[i,r]of Object.entries(t.colors))this.addColor(i,r);for(let[i,r]of Object.entries(t.materials))this.addMaterial(i,r);for(let[i,r]of Object.entries(t.audios))this.addAudio(i,r);for(let[i,r]of Object.entries(t.particles))this.addParticle(i,r);for(let[i,r]of Object.entries(t.fonts))this.addFont(i,r)}addMaterial(t,e){if(this.materials[t]){let i=this.materials[t];i.reset(e,this.thisContext),i.dispose()}else{let i=new KU(e,this.thisContext,t);this.materials[t]=i}}deleteMaterial(t){this.materials[t]&&(this.materials[t].nodeMaterialDispose(),delete this.materials[t])}getMaterial(t){return this.materials[t]}getMaterialOrDeletedPlaceholder(t){return this.materials[t]??this.deletedMaterial}material(t){return typeof t=="string"?this.getMaterialOrDeletedPlaceholder(t):t==null?(console.error("material is undefined or null"),this.deletedMaterial):new b4(t,this.thisContext)}getMaterials(){return this.materials}addImage(t,e){return this.images[t]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[t].updateSrc(e.data),!0):(this.images[t]=new eg(e,this),!1)}deleteImage(t){let e=this.images[t];e&&(e.dispose(),delete this.images[t])}getDefaultImage(){return this.images.image_0}getImage(t){return this.images[t]??this.deletedImage}image(t){return typeof t=="string"?this.getImage(t):this.imageHolderCache.load(t)}addUIBuffer(t,e){return this.uiBuffers[t]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.uiBuffers[t].updateSrc(e),!0):(this.uiBuffers[t]=new eg(e,this),!1)}uiBuffer(t){return this.uiBuffers[t]}addVideo(t,e){return this.videos[t]?(this.videos[t].updateSrc(e.data),!0):(this.videos[t]=new eg(e,this),!1)}deleteVideo(t){let e=this.videos[t];e&&(e.dispose(),delete this.videos[t])}getVideo(t){return this.videos[t]??this.deletedVideo}video(t){return typeof t=="string"?this.getVideo(t):this.imageHolderCache.load(t)}addColor(t,e){return this.colors[t]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in e?this.colors[t].setRGBA(e.r,e.g,e.b,e.a):this.colors[t].setRGBA(e.r,e.g,e.b,1),!0):("a"in e?this.colors[t]=new mD(e.r,e.g,e.b,e.a):this.colors[t]=new mD(e.r,e.g,e.b,1),!1)}updateColor(t,e){if(this.colors[t]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[t];return this.colors[t].r=e.r??i.r,this.colors[t].g=e.g??i.g,this.colors[t].b=e.b??i.b,this.colors[t].a=e.a??i.a,!0}return!1}deleteColor(t){this.colors[t]&&delete this.colors[t]}getColor(t){return this.colors[t]}getColorNames(){return Object.values(this.data.colors).map(t=>t.name)}getColorByName(t){for(let e in this.data.colors)if(this.data.colors[e].name===t)return{color:this.colors[e],id:e}}color(t){let e;if(typeof t=="string"){let i=this.getColor(t);i?e=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),e=new ro(0,0,0,0))}else return"a"in t?new ro(t.r,t.g,t.b,t.a):new ro(t.r,t.g,t.b,1);return e}addAudio(t,e){this.audios[t]=e}getAudio(t){let e=this.audios[t];if(e instanceof kS)return e;{let i=new kS({src:e.data});return this.audios[t]=i,i}}addParticle(t,e){this.particles[t]=e}getParticle(t){return this.particles[t]}deleteParticle(t){this.particles[t]&&delete this.particles[t]}deleteAudio(t){let e=this.audios[t];e&&(e instanceof kS&&e.dispose(),delete this.audios[t])}addFont(t,e){this.fonts[t]=new $Me(e),this.fonts[t].loadingPromise.then(()=>this.requestRender())}getFont(t){return this.fonts[t]}deleteFont(t){this.fonts[t]&&delete this.fonts[t]}dispose(){Object.keys(this.materials).forEach(t=>this.deleteMaterial(t)),this._requestRender=void 0,Object.values(this.audios).forEach(t=>{t instanceof kS&&t.dispose()}),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(t,e){if(this.variables[t]===void 0){let i=e.value;if(this.enableLocalStorageForPersistentVariables&&e.persistent){let r=localStorage.getItem(JU(t));i=r!==null?JSON.parse(r):e.value}return this.variables[t]={value:i,locations:[],persistent:e.persistent},"dynamicVariableType"in e&&(this.variables[t].dynamicVariablePlayState="Playing",this.variables[t].dynamicVariableToggleIsForward=void 0),!0}return this.variables[t].value=e.value,!1}resetDynamicVariablePlayState(){for(let t in this.variables)this.variables[t].dynamicVariablePlayState!==void 0&&(this.variables[t].dynamicVariablePlayState="Playing",this.variables[t].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(t,e){this.updateVariable(t,e.value)}updateVariable(t,e){if(this.variables[t]===void 0)return!1;this.variables[t].value=e,this.enableLocalStorageForPersistentVariables&&this.variables[t].persistent&&localStorage.setItem(JU(t),JSON.stringify(e));let i=e;for(;typeof i=="string";)i=this.variables[i].value;let r=this.entityOpContext.scene;for(let n=this.variables[t].locations.length-1;n>=0;n--){let s=this.variables[t].locations[n];if(s[0]==="material"){let a=s[1],o=i,l={scene:r,shared:this},c=s.slice(2);r.traverseMaterial(h=>{let d=h.root??h;d.uuid===a&&d.onVariableUpdate(c,o,l)});let u=this.materials[a];u&&u.onVariableUpdate(c,o,l)}else{let a=r.find(s[0]);if(a===void 0){this.variables[t].locations.splice(n,1);continue}if(s[1]!=="geometry"&&s[1]!=="particles"){for(let o=1;o<s.length-1;o++)a=a[s[o]];s[1]==="rotation"?a[s[s.length-1]]=i*Qt.DEG2RAD:a[s[s.length-1]]=i}if(a=r.find(s[0]),a.type==="ParticleEmitter"&&a.updateVariableState(i,s),gr.is(a))if(s[1]==="position"||s[1]==="rotation"||s[1]==="scale")a.onVariableUpdate();else if(s[1]==="geometry"){let o=a;a.component&&(o=a.component);let l=o.dataPatched;o.chooseGeoemtryCache(this).forceDelete(l.geometry),o.createGeometryDelayed(this.entityOpContext),o.onVariableUpdate(!0),o.invalidateDownstreamBooleanData(),o.instances.forEach(c=>{let u=c.dataPatched;c.chooseGeoemtryCache(this).forceDelete(u.geometry),c.createGeometryDelayed(this.entityOpContext),c.onVariableUpdate(!0),c.invalidateDownstreamBooleanData()})}else s[1]==="morphTargetInfluences"&&a.updateMorphInfluences(s[2],i)}}return this.requestRender(),!0}deleteVariable(t){this.variables[t]&&delete this.variables[t]}getVariable(t,e){var i,r,n;if(Array.isArray(t)){if(t[0]==="mouse")return((i=this.mouseProperty)==null?void 0:i[t[1]])??0;if(t[0]==="raycast")return((r=this.raycastProperty)==null?void 0:r[t[1]])??0;let s=this.entityOpContext.scene.find(t[0]);if(t[1]==="width"||t[1]==="height"||t[1]==="depth")return s.geometry.userData.parameters[t[1]];for(let a=1;a<t.length;a++)s=s[t[a]];return t[1]==="rotation"&&(s*=Qt.RAD2DEG),s}for(let s in this.variables){if(e===void 0)break;let a=this.variables[s],o=(n=a.locations)==null?void 0:n.findIndex(l=>ra.equal(l,e));o!==void 0&&o!==-1&&a.locations.splice(o,1)}if(typeof t=="string"){let s=t,a=t;do{if(a=s,this.variables[s]===void 0)break;let o=this.variables[s].value;e&&this.variables[a]!==void 0&&this.variables[a].locations.push(e),s=o}while(typeof s=="string");return s}else return t}getVariables(){return this.variables}getVariablesNames(){return this.data.variables.map(t=>t.data.name)}getVariableByName(t){for(let e of this.data.variables)if(e.data.name===t)return{variable:e.data,id:e.id}}getDynamicVariablePlayState(t){var e;return(e=this.variables[t])==null?void 0:e.dynamicVariablePlayState}setDynamicVariablePlayState(t,e){this.variables[t]!==void 0&&(this.variables[t].dynamicVariablePlayState=e)}getDynamicVariableToggleIsForward(t){var e;return(e=this.variables[t])==null?void 0:e.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(t,e){this.variables[t]!==void 0&&(this.variables[t].dynamicVariableToggleIsForward=e)}resetLib(t){for(let[e,i]of Object.entries(t.images))this.addImage(e,i.asset);for(let[e,i]of Object.entries(t.audios))this.addAudio(e,i.asset);for(let[e,i]of Object.entries(t.particles))this.addParticle(e,i.asset);for(let[e,i]of Object.entries(t.colors))this.addColor(e,i.asset);for(let[e,i]of Object.entries(t.fonts))this.addFont(e,i.asset);for(let[e,i]of Object.entries(t.materials))this.addMaterial(e,i.asset);for(let[e,i]of Object.entries(t.videos))this.addVideo(e,i.asset);for(let[e,i]of Object.entries(t.variables))this.addVariableHolder(e,i.asset)}updateLibByOp(t,e){t.path[0]==="images"?t.path.length===1&&t.type===1?this.addImage(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteImage(t.id):t.path[0]==="videos"?t.path.length===1&&t.type===1?this.addVideo(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteVideo(t.id):t.path[0]==="audios"?t.path.length===1&&t.type===1?this.addAudio(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteAudio(t.id):t.path[0]==="particles"?t.path.length===1&&t.type===1?this.addParticle(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteParticle(t.id):t.path[0]==="colors"?t.path.length===1&&t.type===1?this.addColor(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteColor(t.id):t.path[0]==="materials"?t.path.length===1&&t.type===1?this.addMaterial(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteMaterial(t.id):t.path[0]==="fonts"?t.path.length===1&&t.type===1?this.addFont(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteFont(t.id):t.path[0]==="variables"?t.path.length===1&&t.type===1?this.addVariableHolder(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteVariable(t.id):t.path[0]==="components"&&e.updateByLibOp(t,this)}updateByOp(t,e,i){var r;if(this.data=e,t.path[0]==="images")t.path.length===2&&t.type===0?t.props.data&&this.getImage(t.path[1]).updateSrc(t.props.data):t.path.length===1&&t.type===1?this.addImage(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteImage(t.id);else if(t.path[0]==="videos")t.path.length===2&&t.type===0?t.props.data&&this.getVideo(t.path[1]).updateSrc(t.props.data):t.path.length===1&&t.type===1?this.addVideo(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteVideo(t.id);else if(t.path[0]==="audios")t.path.length===2&&t.type===0?t.props.data&&this.addAudio(t.path[1],e.audios[t.path[1]]):t.path.length===1&&t.type===1?this.addAudio(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteAudio(t.id);else if(t.path[0]==="particles")t.path.length===2&&t.type===0?t.props.data&&this.addParticle(t.path[1],e.particles[t.path[1]]):t.path.length===1&&t.type===1?this.addParticle(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteParticle(t.id);else if(t.path[0]==="colors")t.path.length===2&&t.type===0?this.updateColor(t.path[1],t.props):t.path.length===1&&t.type===1?this.addColor(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteColor(t.id);else if(t.path[0]==="materials")t.path.length===1&&t.type===1?this.addMaterial(t.id,t.data):t.path.length===1&&t.type===2?this.deleteMaterial(t.id):t.path.length>1&&this.getMaterial(t.path[1]).updateByOp(Ra.drop(t,2),e.materials[t.path[1]],{shared:this,scene:i});else if(t.path[0]==="fonts")t.path.length===2&&t.type===0?this.updateFont(t.path[1],t,i):t.path.length===1&&t.type===1?this.addFont(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteFont(t.id);else if(t.path[0]==="variables")t.path.length===2&&t.type===0?"value"in t.props?this.updateVariable(t.path[1],t.props.value):"persistent"in t.props&&(this.variables[t.path[1]].persistent=t.props.persistent):t.path.length===1&&t.type===4?this.addVariableHolder(t.id,t.data):t.path.length===1&&t.type===5&&this.deleteVariable(t.id);else if(t.path[0]==="userAPIs"){if(t.path.length===1&&t.type===1)this.addUserAPI(t.id,t.data);else if(t.path.length===1&&t.type===2)this.deleteUserAPI(t.id);else if(typeof t.path[1]=="string"){let n=e.userAPIs[t.path[1]];if(n){let s=t.type===0&&t.props.debounce===void 0,a=this.getUserAPI(t.path[1]);a instanceof RG?a.update(n):a==null||a.update(n,this,s)}}}else if(t.path[0]==="userWebhooks"){if(t.path.length===1&&t.type===1)this.addUserWebhook(t.id,t.data);else if(t.path.length===1&&t.type===2)this.deleteUserWebhook(t.id);else if(typeof t.path[1]=="string"){let n=e.userWebhooks[t.path[1]];n&&((r=this.getUserWebhook(t.path[1]))==null||r.update(n))}}else t.path[0]==="lib"&&this.updateLibByOp(Ra.drop(t,1),i)}updateFont(t,e,i){if(e.props.url){let r=this.getFont(t),n={...this.data.fonts[t],url:e.props.url};r.update(n),r.loadingPromise.then(()=>this.requestRender()),i.updateFont(t,this)}}addUserAPI(t,e){var i,r;return this.userAPIs[t]?(this.userAPIs[t].update(e,this),!0):((i=this.openAIRealtime)==null?void 0:i.id)===t?(this.openAIRealtime.update(e),!0):((r=e.integration)==null?void 0:r.type)==="VoiceAssistant"?(this.openAIRealtime=new RG(e,t,this),!1):(this.userAPIs[t]=new NY(t,e,this),!1)}getUserAPI(t){var e;return((e=this.openAIRealtime)==null?void 0:e.id)===t?this.openAIRealtime:this.userAPIs[t]}getUserAPIs(){return this.userAPIs}deleteUserAPI(t){let e=this.userAPIs[t];e&&(e.dispose(),delete this.userAPIs[t])}addUserWebhook(t,e){return this.userWebhooks[t]?(this.userWebhooks[t].update(e),!0):(this.userWebhooks[t]=new aEe(t,e),!1)}getUserWebhook(t){return this.userWebhooks[t]}getUserWebhooks(){return this.userWebhooks}deleteUserWebhook(t){let e=this.userWebhooks[t];e&&(e.dispose(),delete this.userWebhooks[t])}get scene(){return this.entityOpContext.scene}};new S4(Kc.emptyData());var _b=class extends hl{updateByPatchedOp(t,e,i){if(super.updateByPatchedOp(t,e,i),A1e(t.path,["materials"])!==null&&t.type===0&&Array.isArray(this.material))for(let[r,n]of Object.entries(t.props)){let s=i.shared.material(n);this.material[Number(r)]=s}else if(dn(t.path,["material"])&&this.material instanceof wg)"material"in e&&typeof e.material!="string"&&this.material.updateByOp(Ra.drop(t,1),e.material,i);else if(dn(t.path,["materials","*"])&&Array.isArray(this.material)){let r=t.path[1];if("materials"in e&&r<this.material.length){let n=e.materials[r];typeof n!="string"&&this.material[r].updateByOp(Ra.drop(t,2),n,i)}}}get needsAO(){return this.material!==void 0?(Array.isArray(this.material)?this.material[0]:this.material).hasAO:!1}updateState(t,e){var n,s;super.updateState(t,e),t.castShadow!==void 0&&(this.castShadow=t.castShadow),t.receiveShadow!==void 0&&(this.receiveShadow=t.receiveShadow);let i=this.dataPatched;this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.shapeBlendNode&&this.layers.set(9);let r;if(this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.type==="ShapeBlendGeometry"&&(r={resolutionLevel:this.dataPatched.geometry.resolutionLevel,useChildrenColors:this.dataPatched.geometry.useChildrenColors}),((n=t.geometry)==null?void 0:n.type)!=="NonParametricGeometry"&&"material"in t&&t.material!==void 0&&(this.disposeMaterial(),this.material=e.shared.material(t.material).getFlavor(i.flatShading,i.side,i.wireframe,r),e.scene.markNeedsUpdateRendererDirty()),(((s=t.geometry)==null?void 0:s.type)==="NonParametricGeometry"||"materials"in t)&&("materials"in t&&t.materials!==void 0?(this.disposeMaterial(),this.material=t.materials.map(a=>e.shared.material(a).getFlavor(i.flatShading,i.side,i.wireframe)),e.scene.markNeedsUpdateRendererDirty()):"material"in t&&t.material!==void 0&&(this.disposeMaterial(),this.material=[e.shared.material(t.material).getFlavor(i.flatShading,i.side,i.wireframe)],e.scene.markNeedsUpdateRendererDirty())),t.flatShading!==void 0||t.wireframe!==void 0||t.side!==void 0)if(Array.isArray(this.material))for(let a=0;a<this.material.length;a++)this.material[a]=this.material[a].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe,r)}disposeMaterial(){this.material&&TX(this.material).forEach(t=>{t instanceof wg&&(t instanceof KU||t.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},OG=new W,LG=new Ri,IG=new Ri,mEe=new W,zG=new Ot,Gs=class extends _b{constructor(t,e,i){super(t,e),this.data=e,this.isSkinnedMesh=!1,this.localGeometry=void 0,e.bindMode&&e.bindMatrix&&(this.bindMode=e.bindMode,this.bindMatrix=new Ot().fromArray(e.bindMatrix),this.bindMatrixInverse=new Ot)}chooseGeoemtryCache(t){return t.geometryCache}markGeometryAsReachable(t){this.geometryCreateDeleyed instanceof ni&&this.chooseGeoemtryCache(t).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof S4){let t=this.geometryCreateDeleyed,e=this.chooseGeoemtryCache(t);this.geometryCreateDeleyed=e.get(this.dataPatched.geometry,t,this)}return this.geometryCreateDeleyed}set geometry(t){this.localGeometry=t}get is2DAndNoDepth(){let t=this.dataPatched.geometry;return eD.is2DParametricMesh(t.type)&&t.depth===0}get is2DType(){return eD.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),dn(t.path,["geometry"])&&this.updateByPatchedOpGeometry(Ra.drop(t,1),e.geometry,i)}removeInteractionGeometry(t){var e;(e=this.localGeometry)==null||e.dispose(),this.localGeometry=void 0}updateGeometryInteractions(t,e){var r;this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if(i==="NonParametricGeometry"||i==="SubdivGeometry"){let n=t;if(this.localGeometry===void 0){let c={...this.data.geometry,...n};this.localGeometry=Gw(c,e,this.data.flatShading,this)}let s,a,o;n.scaleBaked?[s,a,o]=n.scaleBaked:{width:s,height:a,depth:o}=n;let l=this.localGeometry.userData;l.sxPrev!==void 0&&WU(this.localGeometry.attributes,s/l.sxPrev,a/l.syPrev,o/l.szPrev),l.sxPrev=s,l.syPrev=a,l.szPrev=o}else{let n={...this.data.geometry,...t};(r=this.localGeometry)==null||r.dispose(),this.localGeometry=Gw(n,e,this.data.flatShading,this)}}refreshAttachedClonersInteractions(){for(let t of this.attachedSurfaceCloners)t.update()}refreshAttachedCloners(t){for(let e of this.attachedSurfaceCloners)t.scene.addPendingUpdateCloner(e.object)}refreshAttachedPaths(t){for(let e of this.attachedPaths)t.scene.addPendingCommand(()=>e.updateShape())}createGeometryDelayed(t){this.geometryCreateDeleyed=t.shared,this.refreshAttachedCloners(t),this.refreshAttachedPaths(t)}updateByPatchedOpGeometry(t,e,i){var n;let r=!1;t.type===0&&t.path.length===0&&Object.keys(t.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof il&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,e)===this.geometryCreateDeleyed&&(r=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(e,t.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),r||((n=i.scene)==null||n.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(t,e){this.createGeometryDelayed(e)}updateState(t,e){t.geometry!==void 0&&this.updateGeometryOnStateUpdate(t.geometry,e);let i=t.morphTargetInfluences;if(i){this.updateMorphTargets(),this.geometry.morphTargetsRelative=!0;for(let{data:{name:r,value:n}}of i)this.updateMorphInfluences(r,e.shared.getVariable(n,[this.uuid,"morphTargetInfluences",r]))}super.updateState(t,e)}updateMorphInfluences(t,e){if(this.morphTargetDictionary===void 0)return;let i=this.morphTargetDictionary[t];i!==void 0&&(this.morphTargetInfluences[i]=e)}updateGeometryGroupsIfNeeded(){var t;Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(((t=this.geometry.getIndex())==null?void 0:t.count)??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(t,e){let i=this.geometry.userData.parameters;this.is2DType?t.set(0,0,i.depth*.5):this.isNonParametric?(t.setScalar(0),this.geometry.boundingSphere&&t.copy(this.geometry.boundingSphere.center),e.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):i.centerOffset?t.fromArray(i.centerOffset):t.setScalar(0),e.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(t,e){this.skeleton=t,this.isSkinnedMesh=!0,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(t){let e=new Ri,i=this.geometry.attributes.skinWeight;for(let r=0,n=i.count;r<n;r++){e.fromBufferAttribute(i,r);let s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),i.setXYZW(r,e.x,e.y,e.z,e.w)}}boneTransform(t,e){let i=this.skeleton;if(i===void 0)return;let r=this.geometry;LG.fromBufferAttribute(r.attributes.skinIndex,t),IG.fromBufferAttribute(r.attributes.skinWeight,t),OG.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let n=0;n<4;n++){let s=IG.getComponent(n);if(s!==0){let a=LG.getComponent(n);zG.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),e.addScaledVector(mEe.copy(OG).applyMatrix4(zG),s)}}return e.applyMatrix4(this.bindMatrixInverse)}};function gEe(t){var a,o;if(t.geometry.attributes.extrudeNormal||!t.geometry.attributes.position||!t.geometry.attributes.normal)return;let e=new Map,i=t.geometry.attributes,r=i.position.array,n=i.normal.array,s=new Float32Array(r.length);for(let l=0;l<r.length;l+=3){let c=`${r[l]}_${r[l+1]}_${r[l+2]}`,u=new W(n[l],n[l+1],n[l+2]);e.has(c)?(a=e.get(c))==null||a.normals.push(u):e.set(c,{normals:[u],result:new W})}e.forEach((l,c)=>{for(let u of l.normals)l.result.add(u);l.result.divideScalar(l.normals.length)});for(let l=0;l<r.length;l+=3){let c=`${r[l]}_${r[l+1]}_${r[l+2]}`,u=(o=e.get(c))==null?void 0:o.result;u&&(s[l]=u.x,s[l+1]=u.y,s[l+2]=u.z)}t.geometry.setAttribute("extrudeNormal",new Wt(s,3))}function vEe(t){if(t.geometry.attributes.extrudeNormals||!t.geometry.attributes.position)return;let e=t.geometry.attributes.position.array,i=new Float32Array(e.length),r=new W;for(let n=0;n<e.length;n+=3)r.set(e[n],e[n+1],e[n+2]).normalize(),i[n]=r.x,i[n+1]=r.y,i[n+2]=r.z;t.geometry.setAttribute("extrudeNormal",new Wt(i,3))}function w4(t){if(Array.isArray(t.material)){for(let e of t.material)if(e.getLayersOfType("outline").length===0)return}else if(!(t.material instanceof wg)||t.material.getLayersOfType("outline").length===0)return;t instanceof Gs&&t.is2DAndNoDepth?vEe(t):gEe(t)}function M4(t){if(!t.geometry.attributes.position)return;let e=t.geometry.attributes.position.array,i=new Float32Array(e.length),r=parseInt(t.uuid.replace(/\D/g,"")),n=[Qt.seededRandom(r),Qt.seededRandom(r+1e4),Qt.seededRandom(r+2e4)];for(let s=0;s<e.length;s++)i[s]=n[s%3];t.geometry.setAttribute("randomColor",new _i(i,3))}var vd=new Os,oS=new W;function yEe(t){let e=!1;return t.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="SubdivGeometry"&&(e=!0)}),e}var jw=class extends Gs{constructor(t,e,i){super(t,e,i),this.data=e,this.hiddenMatrixOld=new Ot,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(t){return this.dataPatched.flatShading?t.geometryCache:t.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(t,e){let i=this.geometry.userData.parameters;t.copy(this.originalGeometryNew.boundingSphere.center),e.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(t){var s,a,o;if(this.skipReactionUpdate===!0)return;let e=(s=this.localGeometry)==null?void 0:s.uuid,{originalGeometry:i,subdividedGeometry:r,subdivPointer:n}=il.build(t,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=n,i!==void 0&&((a=this.originalGeometry)==null||a.dispose(),this.originalGeometry=i),r!==void 0&&((o=this.subdividedGeometry)==null||o.dispose(),this.subdividedGeometry=r??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,w4(this),M4(this),this.calcBoundingBox(),e&&(this.localGeometry.uuid=e)}updateState(t,e){if(super.updateState(t,e),t.flatShading!==void 0){let i=this.material;this.material=Array.isArray(i)?i.map(r=>r.getFlavor(!1,r.side,r.wireframe)):i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!t.flatShading,this.createGeometryDelayed(e)}}updateMesh(t=!1){il.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,t&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&il.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,t&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=il.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=il.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(t,e){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,hl.prototype.raycast.call(this,t,e),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let t=this.originalGeometry;t.boundingSphere===null&&(t.boundingSphere=new Xl,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=t.boundingSphere));let e=t.attributes.position,i=t.boundingSphere.center;vd.setFromBufferAttribute(e),vd.getCenter(i),t.boundingSphere.radius=i.distanceTo(vd.max),isNaN(t.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),vd.getSize(oS),this.hasNonUniformScale&&oS.divide(this.scale);let r={width:oS.x,height:oS.y,depth:oS.z};return this.geometry.userData.parameters=r,r}updateBoundingSphere(t){let e=this.originalGeometry;vd.min.set(t[0],t[2],t[4]),vd.max.set(t[1],t[3],t[5]),this.hasNonUniformScale&&(vd.min.applyMatrix4(this.shearScaleInv),vd.max.applyMatrix4(this.shearScaleInv)),e.boundingSphere===null&&(e.boundingSphere=new Xl);let i=e.boundingSphere.center;vd.getCenter(i),e.boundingSphere.radius=i.distanceTo(vd.max)}freeSubdivPointer(){var t,e;this.subdivPointer&&(il.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,(t=this.originalGeometry)==null||t.dispose(),(e=this.subdividedGeometry)==null||e.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(t,e,i){super.updateByPatchedOpGeometry(t,e,i),this.localGeometry&&this.createGeometryByControls(e)}},UG=-1,xEe=1,bEe={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},_Ee={polygon_center:0,edge:1,vertex:2},w2=(t,e)=>(i,r)=>!e||i===0||t===0?0:t*r/100,Gi=(t,e)=>{let i=Math.abs(e),r=i*-1;return(t-UG)*(i-r)/(xEe-UG)+r},SEe=new W,M2=new W,wEe=new W,MEe=new W;function S1(t,e){let i=wEe.fromArray(t),r=MEe.fromArray(e);M2.copy(r).sub(i);let n=M2.length();return M2.normalize().multiplyScalar(n*.5),SEe.copy(i).add(M2).toArray()}var Jc=new $a,E2=new W,vD=new W,t0=new W;function EEe(t){let e=[];for(let i=0;i<=t.index.count;i++)if(E2.fromArray(t.index.array,i*3),Jc.setFromAttributeAndIndices(t.attributes.position,E2.x,E2.y,E2.z),Jc.getNormal(vD),Jc.getMidpoint(t0),!(isNaN(t0.x)||isNaN(t0.y)||isNaN(t0.z))){let{a:r,b:n,c:s}=Jc,a=r.toArray(),o=n.toArray(),l=s.toArray(),c=r.distanceTo(n),u=n.distanceTo(s),h=s.distanceTo(r),d=S1(a,o),p=S1(o,l),g=S1(l,a),x=[c,u,h],v=Math.max(...x),b=x.filter(E=>Math.round(E)===Math.round(v)).length>1,w=[],M=Jc.getMidpoint(t0).toArray();v===c&&!b&&(w=[p,g,g],M=d),v===u&&!b&&(w=[d,g,g],M=p),v===h&&!b&&(w=[d,p,p],M=g),b&&(w=[d,p,g]),e.push({vertices:[a,o,l],faceCenters:w,midpoint:M,norm:Jc.getNormal(vD).toArray()})}return e}function AEe(t){let e=[],{position:i}=t.attributes;for(let r=0;r<i.count;r++){Jc.setFromAttributeAndIndices(i,r*3,r*3+1,r*3+2),Jc.getNormal(vD),Jc.getMidpoint(t0);let n=Jc.a.toArray(),s=Jc.b.toArray(),a=Jc.c.toArray();e.push({vertices:[n,s,a],faceCenters:[S1(n,s),S1(s,a),S1(a,n)],midpoint:t0.toArray(),norm:vD.toArray()})}return e}var TEe=4,CEe=.5,lL=t=>.5*(1-Math.cos(t*Math.PI)),DEe=class{constructor(){this.perlin=new Array(4096)}noise(t,e=0,i=0){if(this.perlin==null){this.perlin=new Array(4096);for(let v=0;v<4096;v++)this.perlin[v]=Math.random()}t<0&&(t=-t),e<0&&(e=-e),i<0&&(i=-i);let r=Math.floor(t),n=Math.floor(e),s=Math.floor(i),a=t-r,o=e-n,l=i-s,c,u,h=0,d=.5,p,g,x;for(let v=0;v<TEe;v++){let b=r+(n<<4)+(s<<8);c=lL(a),u=lL(o),p=this.perlin[b&4095],p+=c*(this.perlin[b+1&4095]-p),g=this.perlin[b+16&4095],g+=c*(this.perlin[b+16+1&4095]-g),p+=u*(g-p),b+=256,g=this.perlin[b&4095],g+=c*(this.perlin[b+1&4095]-g),x=this.perlin[b+16&4095],x+=c*(this.perlin[b+16+1&4095]-x),g+=u*(x-g),p+=lL(l)*(g-p),h+=p*d,d*=CEe,r<<=1,a*=2,n<<=1,o*=2,s<<=1,l*=2,a>=1&&(r++,a--),o>=1&&(n++,o--),l>=1&&(s++,l--)}return h}noiseSeed(t){let e=(()=>{let i,r;return{setSeed(n){r=i=(n??Math.random()*4294967296)>>>0},getSeed(){return i},rand(){return r=(1664525*r+1013904223)%4294967296,r/4294967296}}})();e.setSeed(t),this.perlin=new Array(4096);for(let i=0;i<4096;i++)this.perlin[i]=e.rand()}},PEe=DEe,BG=new W,NG=new Ot,FG=new ob;function kG(t){let e=!1;return t.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&(r.geometry.type==="TextGeometry"||r.geometry.type==="InputGeometry")&&(e=!0)}),e}var E4=class extends Gs{constructor(t,e,i){super(t,e,i),this.data=e}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){var e;let t=this.dataPatched;return((e=this.font)==null?void 0:e.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,t.geometry.height,this.fontScale,t.geometry.verticalAlign))??0}get fontScale(){let t=this.dataPatched;return this.font?t.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var t;return(((t=this.font)==null?void 0:t.ascender)??1)*this.fontScale}get descender(){var t;return(((t=this.font)==null?void 0:t.descender)??1)*this.fontScale}get lineHeight(){let t=this.dataPatched;return t.geometry.fontSize*t.geometry.lineHeight}raycast(t,e){let{matrixWorld:i}=this;if(!(isNaN(t.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(NG.copy(i).invert(),FG.copy(t.ray).applyMatrix4(NG),FG.intersectBox(this.singleBBox,BG))){let r=BG.applyMatrix4(i),n=t.ray.origin.distanceTo(r);e.push({distance:n,point:r.clone(),object:this})}}},Ko=1e-4,yd,OQ,LQ,IQ,VG=new W,HG=new W;GY.then(t=>{yd=t,OQ=[yd.get_face_center,yd.get_edge_midpoint,yd.get_vertex_position],LQ=[yd.get_face_normal,yd.get_edge_normal,yd.get_vertex_normal],IQ=[yd.face_count,yd.edge_count,yd.vertex_count]});var REe=new Ot,OEe=new Ot,Pm=new W,A2=new W,lS=new W,cL=new W,LEe=new W,IEe=new W,zEe=class{constructor(t,e){this.data=t,this.is3D=e,this.perlin=new PEe,t.noiseType==="perlin"?(this.perlin.noiseSeed(t.seed),e?this.noise=(i,r,n)=>this.perlin.noise(i,r,n):this.noise=i=>this.perlin.noise(i)):e?this.noise=c_e((0,BU.default)(t.seed)):this.noise=l_e((0,BU.default)(t.seed))}},eu=class extends a4(Kr){constructor(t,e){super(),this.parameters=e,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.random=null,this.object=t}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(t){if(this.parent===null)this.updateState(this.parameters,t);else for(let e of this.children)e instanceof io&&e.expand()}invalidateTransform(t){this.matrixWorldNeedsUpdate=!0,this.traverse(e=>{e instanceof io&&e.object===t&&(e.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let t of this.children)t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD())}_updateCount(t){let e;if(t!==void 0?e=t:e=this.parameters.type==="grid"?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,this.parameters.type==="toObject"){if(!this.parameters.toObject.object)e=0;else if(t===void 0&&this.parameters.toObject.spreadType!=="random")return}if(this.parameters.type==="toObject"&&this.objectForSample){let i=this.children;if(i.length===e)return;if(i.length<e)for(let r=0,n=e-i.length;r<n;++r){let s=new io(this.object);s.expand(),this.add(s)}else for(let r=0,n=i.length-e;r<n;++r)this.remove(i[r])}else{if(this.children.length===e)return;if(this.children.length<e)for(let i=0,r=e-this.children.length;i<r;++i){let n=new io(this.object);n.expand(),this.add(n)}else for(let i=0,r=this.children.length-e;i<r;++i)this.remove(this.children[i])}}getRandom(t,e=!1){return(this.random===null||this.random.data.seed!==t.seed||this.random.is3D!==e)&&(this.random=new zEe(t,e)),this.random}_updateRadial(t){let e=t.radial,i=e.start*Qt.DEG2RAD,r=e.end*Qt.DEG2RAD,n=i-r,s=new ia(e.rotation[0],e.rotation[1],e.rotation[2]),a;switch(e.axis){case"z":a=new W(0,0,1);break;case"y":a=new W(0,1,0);break;default:case"x":a=new W(1,0,0);break}let o=t.randomnessObject??ag.defaultData([1,1,1]).randomnessObject,l=this.getRandom(o),c=w2(o.strength,this.parameters.randomness);for(let[u,h]of this.children.entries()){let d=u*(o.freqScale/10)+o.movement,p=l.noise(d,d,d),g=u+1;h.scale.x=e.scale[0]+c(g,Gi(p,o.scale[0]))||Ko,h.scale.y=e.scale[1]+c(g,Gi(p,o.scale[1]))||Ko,h.scale.z=e.scale[2]+c(g,Gi(p,o.scale[2]))||Ko,h.position.setScalar(0);let x=n/t.count*u-i;switch(e.axis){case"x":h.rotation.set(0,x,0);break;case"y":h.rotation.set(0,0,x);break;case"z":h.rotation.set(x,0,0);break}h.translateOnAxis(a,e.radius),h.position.x+=e.position[0]+c(g,Gi(p,o.position[0])),h.position.y+=e.position[1]+c(g,Gi(p,o.position[1])),h.position.z+=e.position[2]+c(g,Gi(p,o.position[2]));let v=c(g,Gi(p,o.rotation[0])),b=c(g,Gi(p,o.rotation[1])),w=c(g,Gi(p,o.rotation[2]));e.alignment===!0?(h.rotation.x+=s.x+v,h.rotation.y+=s.y+b,h.rotation.z+=s.z+w):h.rotation.set(s.x+v,s.y+b,s.z+w)}}_updateLinear(t){if(t.type!=="linear")throw new Error;let e=t.linear,i=new ia(e.rotation[0],e.rotation[1],e.rotation[2]),r=t.randomnessObject??ag.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r),s=w2(r.strength,this.parameters.randomness);for(let[a,o]of this.children.entries()){let l=a*(r.freqScale/10)+r.movement,c=n.noise(l,l,l),u=a+1,h=s(u,Gi(c,r.rotation[0])),d=s(u,Gi(c,r.rotation[1])),p=s(u,Gi(c,r.rotation[2]));o.scale.x=1+(e.scale[0]-1)*a+s(u,Gi(c,r.scale[0]))||Ko,o.scale.y=1+(e.scale[1]-1)*a+s(u,Gi(c,r.scale[1]))||Ko,o.scale.z=1+(e.scale[2]-1)*a+s(u,Gi(c,r.scale[2]))||Ko,o.rotation.x=i.x*a+h,o.rotation.y=i.y*a+d,o.rotation.z=i.z*a+p,o.position.x=e.position[0]*a+s(u,Gi(c,r.position[0])),o.position.y=e.position[1]*a+s(u,Gi(c,r.position[1])),o.position.z=e.position[2]*a+s(u,Gi(c,r.position[2]))}}_updateGrid(t){let e=0,i=t.grid,r=t.randomnessObject??ag.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r,!0),s=w2(r.strength,this.parameters.randomness);if(i.useCenter===!0){let a={x:i.count[0]%2===0?2:1,y:i.count[1]%2===0?2:1,z:i.count[2]%2===0?2:1},o=new W(i.size[0]*(i.count[0]-a.x)*.5,i.size[1]*(i.count[1]-a.y)*.5,i.size[2]*(i.count[2]-a.z)*.5);for(let l=0;l<i.count[0];l++)for(let c=0;c<i.count[1];c++)for(let u=0;u<i.count[2];u++){let h=n.noise((l+1)*(r.freqScale/10)+r.movement,(c+1)*(r.freqScale/10)+r.movement,(u+1)*(r.freqScale/10)+r.movement),d=this.children[e++];d.scale.x=1+s(e,Gi(h,r.scale[0]))||Ko,d.scale.y=1+s(e,Gi(h,r.scale[1]))||Ko,d.scale.z=1+s(e,Gi(h,r.scale[2]))||Ko;let p=s(e,Gi(h,r.rotation[0])),g=s(e,Gi(h,r.rotation[1])),x=s(e,Gi(h,r.rotation[2]));d.rotation.set(p,g,x),d.position.x=i.size[0]*l-o.x+s(e,Gi(h,r.position[0])),d.position.y=i.size[1]*c-o.y+s(e,Gi(h,r.position[1])),d.position.z=i.size[2]*u-o.z+s(e,Gi(h,r.position[2]))}}else for(let a=0;a<i.count[0];a++)for(let o=0;o<i.count[1];o++)for(let l=0;l<i.count[2];l++){let c=n.noise((a+1)*(r.freqScale/10)+r.movement,(o+1)*(r.freqScale/10)+r.movement,(l+1)*(r.freqScale/10)+r.movement),u=this.children[e++];u.scale.x=1+s(e,Gi(c,r.scale[0]))||Ko,u.scale.y=1+s(e,Gi(c,r.scale[1]))||Ko,u.scale.z=1+s(e,Gi(c,r.scale[2]))||Ko;let h=s(e,Gi(c,r.rotation[0])),d=s(e,Gi(c,r.rotation[1])),p=s(e,Gi(c,r.rotation[2]));u.rotation.set(h,d,p),u.position.x=i.size[0]*a+s(e,Gi(c,r.position[0])),u.position.y=-i.size[1]*o+s(e,Gi(c,r.position[1])),u.position.z=-i.size[2]*l+s(e,Gi(c,r.position[2]))}}_updateToObject(t){var u;if(t.type!=="toObject")throw new Error;let{toObject:e}=t,i=new ia(e.rotation[0],e.rotation[1],e.rotation[2]),r=t.randomnessObject??ag.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r),s=w2(r.strength,this.parameters.randomness);if(!e.object){for(let[,h]of this.children.entries())h.position.set(0,0,0),h.scale.setScalar(1),h.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof E4)if(!((u=this.objectForSample.font)!=null&&u.isLoaded)||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}else this._pendingMediaLoad=!1;if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let a=this.getSubdivData();if(a.length>0){let h=Math.round(a.length*e.count/100);this._updateCount(h)}else{let h=this.objectForSample.geometry.getAttribute("position");if(!h||isNaN(h.count)||h.count===0){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`);return}}this.objectForSample.updateMatrixWorld();let o=new u_e(this.objectForSample).build(),l=bEe[e.axis],c=this.children;o.setRandomGenerator((0,BU.default)(this.object.uuid+e.seed));for(let[h,d]of c.entries()){let p=h*(r.freqScale/10)+r.movement,g=n.noise(p,p,p),x=h+1,v=s(x,Gi(g,r.rotation[0])),b=s(x,Gi(g,r.rotation[1])),w=s(x,Gi(g,r.rotation[2]));e.spreadType==="random"?o.sample(lS,cL):(a.length&&(lS.fromArray(a[h].pos),cL.fromArray(a[h].norm)),this.objectForSample instanceof jw&&lS.applyMatrix4(REe.copy(this.objectForSample.matrixWorld).invert())),lS.applyMatrix4(this.object.hiddenMatrix.clone().invert()),d.position.copy(lS),Pm.fromArray(l);let M=e.align==="normal"?cL:this.object.getWorldDirection(IEe),E=A2.fromArray(e.position);A2.x+=s(x,Gi(g,r.position[0])),A2.y+=s(x,Gi(g,r.position[1])),A2.z+=s(x,Gi(g,r.position[2]));let D=Math.acos(M.dot(Pm)),T=LEe.crossVectors(Pm,M).normalize(),L=OEe.makeRotationAxis(T,D),P=M.clone().cross(this.object.up).normalize(),R=P.clone().cross(M).normalize(),O=new Ot().makeBasis(P,M,R),U=new W(Pm.y,Pm.z,Pm.x).normalize(),F=U.clone().cross(Pm).normalize(),V=new Ot().makeBasis(U,Pm,F).invert(),k=new Ot().multiplyMatrices(O,V);d.rotation.setFromRotationMatrix(k),E.applyMatrix4(L),d.position.add(E),d.rotation.x=d.rotation.x+i.x+v,d.rotation.y=d.rotation.y+i.y+b,d.rotation.z=d.rotation.z+i.z+w,d.scale.setScalar(1),d.scale.x=d.scale.x+e.scale[0]+s(x,Gi(g,r.scale[0]))||Ko,d.scale.y=d.scale.y+e.scale[1]+s(x,Gi(g,r.scale[1]))||Ko,d.scale.z=d.scale.z+e.scale[2]+s(x,Gi(g,r.scale[2]))||Ko,d.scale.multiply(this.object.scale),d.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let t=this.parameters.toObject.spreadType,e=new Map,i=(n,s)=>{let a=Math.round(n[0]*1e4)+"_"+Math.round(n[1]*1e4)+"_"+Math.round(n[2]*1e4),o=e.get(a);o?(o.pos[0]+=n[0],o.pos[1]+=n[1],o.pos[2]+=n[2],o.norm[0]+=s[0],o.norm[1]+=s[1],o.norm[2]+=s[2],o.count+=1):e.set(a,{pos:[...n],norm:[...s],count:1})};if(t==="random")return[];if(this.objectForSample instanceof jw){let n=this.objectForSample,s=_Ee[t],a=IQ[s],o=OQ[s],l=LQ[s],c=a(n.subdivPointerNew);for(let u=0;u<=c-1;u++){let h=o(n.subdivPointerNew,u),d=l(n.subdivPointerNew,u);VG.fromArray(h).applyMatrix4(n.matrixWorld),HG.fromArray(d),i(VG.toArray(),HG.toArray())}}else(this.objectForSample.geometry.index?EEe(this.objectForSample.geometry):AEe(this.objectForSample.geometry)).forEach((n,s)=>{t==="polygon_center"&&i(n.midpoint,n.norm),t==="vertex"&&(i(n.vertices[0],n.norm),i(n.vertices[1],n.norm),i(n.vertices[2],n.norm)),t==="edge"&&(i(n.faceCenters[0],n.norm),i(n.faceCenters[1],n.norm),i(n.faceCenters[2],n.norm))});let r=Array.from(e.values());for(let n of r)n.pos[0]/=n.count,n.pos[1]/=n.count,n.pos[2]/=n.count,n.norm[0]/=n.count,n.norm[1]/=n.count,n.norm[2]/=n.count;return r}updateState(t,e){var i;if(this.parameters=V3(t),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),(i=this.object.parent)==null||i.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let r=e.find(this.parameters.toObject.object);r instanceof hl?this.objectForSample=r:this.objectForSample=void 0,this.matrix=new Ot,this.hiddenMatrix=new Ot,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,r&&r.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},DM=t=>{var e;return e=class extends t{},e.geometryHelper=new yh(30,30,30),e},T2=new ob,uL=new Xl,GG=new Ot,PM=(t,e,i,r,n=!1,s=t)=>{let a=e,o=s.matrixWorld;if(a.boundingSphere===null&&a.computeBoundingSphere(),uL.copy(a.boundingSphere),uL.applyMatrix4(o),i.ray.intersectsSphere(uL)===!1||(GG.copy(o).invert(),T2.copy(i.ray).applyMatrix4(GG),a.boundingBox!==null&&T2.intersectsBox(a.boundingBox)===!1))return;let l,c,u,h,d=a.index,p=a.attributes.position,g=a.drawRange,x,v;if(n===!1){let w=Math.max(0,g.start),M=Math.min(d.count,g.start+g.count);for(x=w,v=M;x<v;x+=3)if(c=d.getX(x),u=d.getX(x+1),h=d.getX(x+2),l=b(t,i,T2,p,c,u,h),l){l.faceIndex=Math.floor(x/3),r.push(l);return}}else{let w=a.attributes.position,M=new W,E=new W,D=new W,T=new W,L=2,P=1/((s.scale.x+s.scale.y+s.scale.z)/3),R=P*P,O=Math.max(0,g.start),U=Math.min(w.count,g.start+g.count);for(let F=O,V=U-1;F<V;F+=L){if(M.fromBufferAttribute(w,F),E.fromBufferAttribute(w,F+1),T2.distanceSqToSegment(M,E,T,D)>R)continue;T.applyMatrix4(s.matrixWorld);let k=i.ray.origin.distanceTo(T);k<i.near||k>i.far||r.push({distance:k,point:D.clone().applyMatrix4(s.matrixWorld),object:t})}}function b(w,M,E,D,T,L,P){let R=new W,O=new W,U=new W,F=new W,V=new W;if(R.fromBufferAttribute(D,T),O.fromBufferAttribute(D,L),U.fromBufferAttribute(D,P),E.intersectTriangle(R,O,U,!1,F)===null)return null;V.copy(F),V.applyMatrix4(w.matrixWorld);let k=M.ray.origin.distanceTo(V);return k<M.near||k>M.far?null:{faceIndex:1,distance:k,point:V.clone(),object:w}}},C2=new W,Gc=new Pg,UEe=class extends bM{constructor(t){let e=new ni,i=new Rg({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={},a=new bi(15711266),o=new bi(15711266),l=new bi(2857471);c("n1","n2",a),c("n2","n4",a),c("n4","n3",a),c("n3","n1",a),c("f1","f2",a),c("f2","f4",a),c("f4","f3",a),c("f3","f1",a),c("n1","f1",a),c("n2","f2",a),c("n3","f3",a),c("n4","f4",a),c("p","n1",o),c("p","n2",o),c("p","n3",o),c("p","n4",o),c("u1","u2",l),c("u2","u3",l),c("u3","u1",l);function c(h,d,p){u(h,p),u(d,p)}function u(h,d){r.push(0,0,0),n.push(d.r,d.g,d.b),s[h]===void 0&&(s[h]=[]),s[h].push(r.length/3-1)}e.setAttribute("position",new Wt(r,3)),e.setAttribute("color",new Wt(n,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let t=this.geometry,e=this.pointMap;Gc.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=1,r=1,n=.8;Qu("n1",e,t,Gc,-1,-1,n),Qu("n2",e,t,Gc,i,-1,n),Qu("n3",e,t,Gc,-1,r,n),Qu("n4",e,t,Gc,i,r,n);let s=n;Qu("f1",e,t,Gc,-1,-1,s),Qu("f2",e,t,Gc,i,-1,s),Qu("f3",e,t,Gc,-1,r,s),Qu("f4",e,t,Gc,i,r,s);let a=s,o=.5;Qu("u1",e,t,Gc,i*.7*o,r*1.1,a),Qu("u2",e,t,Gc,-1*.7*o,r*1.1,a),Qu("u3",e,t,Gc,0,r*(1.1+.9*o),a),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Qu(t,e,i,r,n,s,a){C2.set(n,s,a).unproject(r);let o=e[t];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],C2.x,C2.y,C2.z)}}var BEe=class extends DM(UEe){constructor(t){super(t),this.object=t,this.object=t,this.name=`CombinedCameraHelper: ${t.uuid}`}updateMatrixWorld(t){super.updateMatrixWorld(t),this.updateTarget()}updateTarget(){let t=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(t)}raycast(t,e){PM(this.object,this.geometry,t,e,!0)}},$U;(t=>t.is=e=>"objectHelper"in e)($U||($U={}));var Sb=(t,e)=>class extends o4(t){constructor(){super(...arguments),this.objectHelper=new e(this),this.gizmos={}}get geometryHelper(){return e.geometryHelper}raycast(i,r){this.objectHelper.raycast(i,r)}showGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof zC&&(r.visible=!0)}}updateEntityBoxSize(i,r){this.objectHelper.visible&&this.geometryHelper instanceof yh?(i.setScalar(0),r.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,r)}hideGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof zC&&(r.visible=!1)}}},jG=790,mx=new W,hL=new W,dL=new Ci,fL=new W,cS=new W,pL=new W,Io=class extends Sb(Pg,BEe){constructor(t="",e={...Uw.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=B1.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(t,e),this.previousProjectionMatrix=new Ot,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,r=this.height;this.orthoCamera=new R3(i*-.5,i*.5,r*.5,r*-.5,-5e4,1e4),this.perspCamera=new Do(45,i/r,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(t){this.perspCamera.fov=t}get fov(){return this.perspCamera.fov}setNear(t,e){t==="PerspectiveCamera"?this.perspCamera.near=e:this.orthoCamera.near=e}setZoom(t,e){e>=0&&(t==="PerspectiveCamera"?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}set cameraType(t){t==="PerspectiveCamera"?this.toPerspective():t==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(t){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=t:this.orthoCamera.near=t}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(t){t>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}lookAt(t,e,i){typeof t=="number"&&(t=new W(t,e,i)),super.lookAt(t),this.getWorldPosition(mx),this.targetOffset=mx.distanceTo(t)}getTarget(t=new W){return this.getWorldDirection(hL),this.getWorldPosition(mx),hL.multiplyScalar(this.targetOffset),t.copy(mx).add(hL),t}getDistanceToTarget(){let t=this.getTarget();return this.getWorldPosition(mx),mx.distanceTo(t)}updateUp(){this.getWorldQuaternion(dL),fL.set(0,0,1).applyQuaternion(dL),cS.copy(Kr.DEFAULT_UP),this.isUpVectorFlipped&&cS.negate(),cS.applyQuaternion(dL),pL.copy(Kr.DEFAULT_UP).projectOnPlane(fL),this.angleOffsetFromUp=pL.angleTo(cS),this.angleOffsetFromUp*=pL.cross(cS).dot(fL)>=0?1:-1}updateTransformState(t,e){let i=super.updateTransformState(t,e);return t.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=t.isUpVectorFlipped),this.updateUp(),i}getViewFrontToObject(t){let e=t.getWorldPosition(new W),i=t.getWorldDirection(new W).multiplyScalar(this.targetOffset);return{position:e.clone().add(i),target:e}}getViewToTarget(t){let e=this.getWorldDirection(new W).multiplyScalar(this.targetOffset);return{position:t.clone().sub(e),target:t}}getViewToObject(t){let e=new W;return t.getWorldPosition(e),this.getViewToTarget(e)}setViewplaneSize(t,e,i=!1){if(this.aspect=t/e,i){let r=t>e?this.aspect:1,n=t>e?1:this.aspect;this.left=-790*.5*r,this.right=jG*.5*r,this.top=jG*.5*(1/n),this.bottom=-790*.5*(1/n)}else this.left=-t*.5,this.right=t*.5,this.top=e*.5,this.bottom=-e*.5;this.updateProjectionMatrix()}copyViewPlaneSize(t){this.aspect=t.aspect,this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(t){this.perspCamera.setFocalLength(t),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(t,e,i,r,n,s){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(t,e,i,r,n,s):this.orthoCamera.setViewOffset(t,e,i,r,n,s)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(t,e){return super.copy(t,e),this.parent=t.parent,this.orthoCamera.copy(t.orthoCamera),this.perspCamera.copy(t.perspCamera),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.far=t.far,this.view=t.view===null?null:Object.assign({},t.view),this._cameraType=t._cameraType,this.aspect=t.aspect,this.fov=t.fov,this.focus=t.focus,this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this.targetOffset=t.targetOffset,this.updateProjectionMatrix(),this}toCameraState(t=[]){let e={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return qz(e,t)}updateCameraSubtype(t,e){let i=t==="perspective"?"PerspectiveCamera":"OrthographicCamera";e.zoom!==void 0&&this.setZoom(i,e.zoom),e.near!==void 0&&this.setNear(i,e.near),e.fov!==void 0&&i==="PerspectiveCamera"&&(this.fov=e.fov)}updateState(t,e){this.updateCameraState(t,e)}updateCameraState(t,e){this.updateState_Entity(t,e),t.far!==void 0&&(this.far=t.far),t.orthographic!==void 0&&this.updateCameraSubtype("orthographic",t.orthographic),t.perspective!==void 0&&this.updateCameraSubtype("perspective",t.perspective),t.type!==void 0&&(this.cameraType=t.type),t.up!==void 0&&this.up.fromArray(t.up),t.targetOffset!==void 0&&(this.targetOffset=t.targetOffset),t.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=t.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),t.path.length===1&&t.type===0&&this.updateCameraSubtype(t.path[0],t.props)}toState(t){return{...super.toState(t),...this.toCameraState(t),type:this.cameraType}}},gx=new Ot,NEe=new Ot;function WG(t){let e=!1;return t.scene.objects.traverse((i,r)=>{var n;((n=r.geometry)==null?void 0:n.type)==="BooleanGeometry"&&(e=!0)}),e}var N0=class extends _b{constructor(t,e,i){super(t,e),this.data=e,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new ni,this.onAfterRender=(r,n,s,a,o,l)=>{super.onAfterRender(r,n,s,a,o,l),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),t.path.length===1&&t.path[0]==="geometry"&&t.type===0&&t.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(t,e=!0){var r;if(this.booleanMeshSetAddress!==-1&&!t)return;for(let n=0;n<this.children.length;n++){let s=this.children[n];s instanceof N0&&s.dataPatched.visible===!0&&s.recomputeBoolean(t===!0,e)}this.meshSetAddresses=[];for(let n=0;n<this.children.length;n++){let s=this.children[n];if(s instanceof hl&&s.dataPatched.visible===!0&&((r=s.geometry.attributes.position)==null?void 0:r.count)>0&&s.geometry.drawRange.count>0&&s.booleanMeshSetAddress!==0){gx.multiplyMatrices(s.hiddenMatrix,s.matrix);try{if(s.booleanMeshSetAddress===-1){if((s.geometry.index??s.geometry.getAttribute("position")).count/3<15e5&&(s.booleanMeshSetAddress=rp.getMeshSet(s.geometry,t===!0,e)),s.booleanMeshSetAddress===-1)return;rp.transformMeshSet(s.booleanMeshSetAddress,gx),s.booleanMatrixInvOld.copy(gx).invert(),s.booleanWasTransformed=!1}else s instanceof N0&&s.needsTransformForDownstream===!0?(rp.transformMeshSet(s.booleanMeshSetAddress,gx),s.needsTransformForDownstream=!1):s.booleanWasTransformed===!0&&(rp.transformMeshSet(s.booleanMeshSetAddress,NEe.multiplyMatrices(gx,s.booleanMatrixInvOld)),s.booleanMatrixInvOld.copy(gx).invert(),s.booleanWasTransformed=!1)}catch(a){console.error(a),s.booleanMeshSetAddress=0,s.geometry.userData.booleanOperationDidFail=!0;continue}rp.hasOpenEdges(s.booleanMeshSetAddress)===!1||n===this.children.length-1&&this.booleanOp===2?(this.meshSetAddresses.push(s.booleanMeshSetAddress),s.geometry.userData.booleanOperationDidFail=!1):s.geometry.userData.booleanOperationDidFail="openEdges"}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new Wt([],0)),this.geometry.setDrawRange(0,0);return}if(t===!0)return rp.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new ni,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=rp.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(n){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(n)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,w4(this),M4(this)}dispose(){super.dispose(),this.geometry.dispose()}},eB;(t=>{function e(i){return gr.is(i)&&i instanceof wM}t.is=e})(eB||(eB={}));var A4=(t,e)=>class extends Sb(t,e){updateState_Light(i,r){this.updateState_Entity(i,r),i.color!==void 0&&(this.color=r.shared.color(i.color)),i.intensity!==void 0&&(this.intensity=i.intensity),i.depth!==void 0&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),i.shadows!==void 0&&(this.castShadow=i.shadows)}},oh=t=>t instanceof hl,yp=t=>t!==null&&t instanceof N0,FEe=t=>t instanceof Io,kEe=t=>eB.is(t),tB=t=>$U.is(t),VEe=new W(1,1,1),qG=new W,HEe=new W,XG=new Ci,RM=class extends DM(Pde){constructor(t,e=15){super(e),this.object=t,this.dummy=new gp,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${t.uuid}`,this.matrix=this.dummy.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(t,e){PM(this.object,RM.geometryHelper,t,e,!1,this.dummy)}update(){}updateMatrix(){}updateMatrixWorld(t){this.object.matrixWorld.decompose(qG,XG,HEe),this.matrix.compose(qG,XG,VEe),super.updateMatrixWorld(t)}updateWorldMatrix(t,e){}},w1=class extends Sb(gp,RM){constructor(t,e){super(),this.super_Entity(t,e),this.objectHelper.update()}updateState(t,e){this.updateState_Entity(t,e),"buffer"in t&&Object.keys(t).length===1&&e.scene.reloadSplats()}},ew=class extends Sb(gp,RM){constructor(t,e,i){super(),this.super_Entity(t,e),this.context=i,this.objectHelper.update()}updateState(t,e){this.updateState_Entity(t,e)}},zQ={RED:0,GREEN:1},OM="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",GEe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;uniform vec4 kernel64[32];varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;}}`,D2=class extends xr{constructor(t=!1,e=!1){super({name:"BokehMaterial",defines:{PASS:t?"2":"1"},uniforms:{kernel64:new At(null),kernel16:new At(null),inputBuffer:new At(null),cocBuffer:new At(null),texelSize:new At(new Oe),scale:new At(1)},blending:js,depthWrite:!1,depthTest:!1,fragmentShader:GEe,vertexShader:OM}),this.toneMapped=!1,e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}set cocBuffer(t){this.uniforms.cocBuffer.value=t}setCoCBuffer(t){this.uniforms.cocBuffer.value=t}get scale(){return this.uniforms.scale.value}set scale(t){this.uniforms.scale.value=t}getScale(t){return this.uniforms.scale.value=t}setScale(t){this.uniforms.scale.value=t}generateKernel(){let t=2.39996323,e=new Float32Array(128),i=new Float32Array(32),r=0,n=0;for(let o=0;o<80;++o){let l=o*t,c=Math.sqrt(o)/Math.sqrt(80),u=c*Math.cos(l),h=c*Math.sin(l);o%5===0?(i[n++]=u,i[n++]=h):(e[r++]=u,e[r++]=h)}let s=[],a=[];for(let o=0;o<128;)s.push(new Ri(e[o++],e[o++],e[o++],e[o++]));for(let o=0;o<32;)a.push(new Ri(i[o++],i[o++],i[o++],i[o++]));this.uniforms.kernel64.value=s,this.uniforms.kernel16.value=a}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e)}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}};function YG(t,e,i){return t*(e-i)-e}function iB(t,e,i){return Math.min(Math.max((t+e)/(e-i),0),1)}var jEe=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,WEe=class extends xr{constructor(t){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new At(null),focusDistance:new At(0),focusRange:new At(0),cameraNear:new At(.3),cameraFar:new At(1e3)},blending:js,depthWrite:!1,depthTest:!1,fragmentShader:jEe,vertexShader:OM}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(t)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(t){this.uniforms.depthBuffer.value=t}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=Bp){this.depthBuffer=t,this.depthPacking=e}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(t){this.uniforms.focusDistance.value=t}get worldFocusDistance(){return-YG(this.focusDistance,this.near,this.far)}set worldFocusDistance(t){this.focusDistance=iB(-t,this.near,this.far)}getFocusDistance(t){this.uniforms.focusDistance.value=t}setFocusDistance(t){this.uniforms.focusDistance.value=t}get focalLength(){return this.focusRange}set focalLength(t){this.focusRange=t}get focusRange(){return this.uniforms.focusRange.value}set focusRange(t){this.uniforms.focusRange.value=t}get worldFocusRange(){return-YG(this.focusRange,this.near,this.far)}set worldFocusRange(t){this.focusRange=iB(-t,this.near,this.far)}getFocalLength(t){return this.focusRange}setFocalLength(t){this.focusRange=t}adoptCameraSettings(t){t&&(this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far,t instanceof Do?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},qEe=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
#include <dithering_fragment>
}`,XEe="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",QG=class extends xr{constructor(t=new Oe){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new At(null),texelSize:new At(new Oe),halfTexelSize:new At(new Oe),kernel:new At(0),scale:new At(1)},blending:js,depthWrite:!1,depthTest:!1,fragmentShader:qEe,vertexShader:XEe}),this.toneMapped=!1,this.setTexelSize(t.x,t.y)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.inputBuffer=t}get scale(){return this.uniforms.scale.value}set scale(t){this.uniforms.scale.value=t}getScale(){return this.uniforms.scale.value}setScale(t){this.uniforms.scale.value=t}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(t){this.uniforms.kernel.value=t}setKernel(t){this.kernel=t}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e),this.uniforms.halfTexelSize.value.set(t,e).multiplyScalar(.5)}setSize(t,e){let i=this.uniforms;i.texelSize.value.set(1/t,1/e),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},YEe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
}`,QEe=class extends xr{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new At(null),opacity:new At(1)},blending:js,depthWrite:!1,depthTest:!1,fragmentShader:YEe,vertexShader:OM}),this.toneMapped=!1}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}getOpacity(t){return this.uniforms.opacity.value}setOpacity(t){this.uniforms.opacity.value=t}},ZEe=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,KEe=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,K3={COLOR:2},JEe={DISABLED:0},$Ee=class extends xr{constructor(t=new Oe,e=K3.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:ab.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new At(null),depthBuffer:new At(null),predicationBuffer:new At(null),texelSize:new At(t)},blending:js,depthWrite:!1,depthTest:!1,fragmentShader:ZEe,vertexShader:KEe}),this.toneMapped=!1,this.edgeDetectionMode=e}set depthBuffer(t){this.uniforms.depthBuffer.value=t}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=Bp){this.depthBuffer=t,this.depthPacking=e}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(t){this.defines.EDGE_DETECTION_MODE=t.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(t){this.edgeDetectionMode=t}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(t){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=t.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(t){this.localContrastAdaptationFactor=t}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(t){this.defines.EDGE_THRESHOLD=t.toFixed("6"),this.defines.DEPTH_THRESHOLD=(t*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(t){this.edgeDetectionThreshold=t}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(t){this.defines.PREDICATION_MODE=t.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(t){this.predicationMode=t}set predicationBuffer(t){this.uniforms.predicationBuffer.value=t}setPredicationBuffer(t){this.uniforms.predicationBuffer.value=t}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(t){this.defines.PREDICATION_THRESHOLD=t.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(t){this.predicationThreshold=t}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(t){this.defines.PREDICATION_SCALE=t.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(t){this.predicationScale=t}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(t){this.defines.PREDICATION_STRENGTH=t.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(t){this.predicationStrength=t}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}},eAe=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,tAe="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",Zu={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},rB=class extends xr{constructor(t,e,i,r,n=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:ab.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new At(null),depthBuffer:new At(null),resolution:new At(new Oe),texelSize:new At(new Oe),cameraNear:new At(.3),cameraFar:new At(1e3),aspect:new At(1),time:new At(0)},blending:js,depthWrite:!1,depthTest:!1,dithering:n}),this.toneMapped=!1,t&&this.setShaderParts(t),e&&this.setDefines(e),i&&this.setUniforms(i),this.adoptCameraSettings(r)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(t){this.uniforms.depthBuffer.value=t}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=Bp){this.depthBuffer=t,this.depthPacking=e}setShaderParts(t){return this.fragmentShader=eAe.replace(Zu.FRAGMENT_HEAD,t.get(Zu.FRAGMENT_HEAD)).replace(Zu.FRAGMENT_MAIN_UV,t.get(Zu.FRAGMENT_MAIN_UV)).replace(Zu.FRAGMENT_MAIN_IMAGE,t.get(Zu.FRAGMENT_MAIN_IMAGE)),this.vertexShader=tAe.replace(Zu.VERTEX_HEAD,t.get(Zu.VERTEX_HEAD)).replace(Zu.VERTEX_MAIN_SUPPORT,t.get(Zu.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(t){for(let e of t.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(t){for(let e of t.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(t){this.extensions={};for(let e of t)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(t){this.encodeOutput!==t&&(t?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(t){return this.encodeOutput}setOutputEncodingEnabled(t){this.encodeOutput=t}get time(){return this.uniforms.time.value}set time(t){this.uniforms.time.value=t}setDeltaTime(t){this.uniforms.time.value+=t}adoptCameraSettings(t){t&&(this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far,t instanceof Do?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(t,e){let i=this.uniforms;i.resolution.value.set(t,e),i.texelSize.value.set(1/t,1/e),i.aspect.value=t/e}static get Section(){return Zu}},iAe=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,rAe=class extends xr{constructor(t=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:ab.replace(/\D+/g,"")},uniforms:{inputBuffer:new At(null),threshold:new At(0),smoothing:new At(1),range:new At(null)},blending:js,depthWrite:!1,depthTest:!1,fragmentShader:iAe,vertexShader:OM}),this.toneMapped=!1,this.colorOutput=t,this.luminanceRange=e}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get threshold(){return this.uniforms.threshold.value}set threshold(t){this.smoothing>0||t>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=t}getThreshold(){return this.threshold}setThreshold(t){this.threshold=t}get smoothing(){return this.uniforms.smoothing.value}set smoothing(t){this.threshold>0||t>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=t}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(t){this.smoothing=t}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(t){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(t){t?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(t){return this.colorOutput}setColorOutputEnabled(t){this.colorOutput=t}get useRange(){return this.luminanceRange!==null}set useRange(t){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(t){t!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=t,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(t){this.luminanceRange=t}},nAe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,UQ={DISCARD:0,MULTIPLY:1},sAe=class extends xr{constructor(t=null){super({name:"MaskMaterial",uniforms:{maskTexture:new At(t),inputBuffer:new At(null),strength:new At(1)},blending:js,depthWrite:!1,depthTest:!1,fragmentShader:nAe,vertexShader:OM}),this.toneMapped=!1,this.setColorChannel(zQ.RED),this.setMaskFunction(UQ.DISCARD)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}set maskTexture(t){this.uniforms.maskTexture.value=t,delete this.defines.MASK_PRECISION_HIGH,t.type!==zo&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(t){this.maskTexture=t}set colorChannel(t){this.defines.COLOR_CHANNEL=t.toFixed(0),this.needsUpdate=!0}setColorChannel(t){this.colorChannel=t}set maskFunction(t){this.defines.MASK_FUNCTION=t.toFixed(0),this.needsUpdate=!0}setMaskFunction(t){this.maskFunction=t}get inverted(){return this.defines.INVERTED!==void 0}set inverted(t){this.inverted&&!t?delete this.defines.INVERTED:t&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(t){this.inverted=t}get strength(){return this.uniforms.strength.value}set strength(t){this.uniforms.strength.value=t}getStrength(){return this.strength}setStrength(t){this.strength=t}},aAe=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,oAe="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",lAe=class extends xr{constructor(t=new Oe,e=new Oe){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new At(null),searchTexture:new At(null),areaTexture:new At(null),resolution:new At(e),texelSize:new At(t)},blending:js,depthWrite:!1,depthTest:!1,fragmentShader:aAe,vertexShader:oAe}),this.toneMapped=!1}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(t){this.uniforms.searchTexture.value=t}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(t){this.uniforms.areaTexture.value=t}setLookupTextures(t,e){this.searchTexture=t,this.areaTexture=e}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(t){let e=Math.min(Math.max(t,0),112);this.defines.MAX_SEARCH_STEPS_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(t){this.orthogonalSearchSteps=t}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(t){let e=Math.min(Math.max(t,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(t){this.diagonalSearchSteps=t}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(t){t?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(t){this.diagonalDetection=t}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(t){let e=Math.min(Math.max(t,0),100);this.defines.CORNER_ROUNDING=e.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(e/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(t){this.cornerRounding=t}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(t){t?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(t){this.cornerDetection=t}setSize(t,e){let i=this.uniforms;i.texelSize.value.set(1/t,1/e),i.resolution.value.set(t,e)}},cAe=new Pg,Rm=null;function uAe(){if(Rm===null){let t=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]);Rm=new ni,Rm.setAttribute!==void 0?(Rm.setAttribute("position",new _i(t,3)),Rm.setAttribute("uv",new _i(e,2))):(Rm.addAttribute("position",new _i(t,3)),Rm.addAttribute("uv",new _i(e,2)))}return Rm}var dl=class{constructor(t="Pass",e=new ql,i=cAe){this.name=t,this.renderer=null,this.scene=e,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(t){if(this.rtt===t){let e=this.getFullscreenMaterial();e!==null&&(e.needsUpdate=!0),this.rtt=!t}}setRenderer(t){this.renderer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(t){let e=this.screen;e!==null?e.material=t:(e=new bn(uAe(),t),e.frustumCulled=!1,this.scene===null&&(this.scene=new ql),this.scene.add(e),this.screen=e)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(t){this.fullscreenMaterial=t}getDepthTexture(){return null}setDepthTexture(t,e=Bp){}render(t,e,i,r,n){throw new Error("Render method not implemented!")}setSize(t,e){}initialize(t,e,i){}dispose(){for(let t of Object.keys(this)){let e=this[t];if(e!==null&&typeof e=="object"&&typeof e.dispose=="function"){if(e instanceof ql||e===this.renderer)continue;this[t].dispose()}}}},nB=class extends dl{constructor(t,e=!0){super("CopyPass"),this.fullscreenMaterial=new QEe,this.needsSwap=!1,this.renderTarget=t,t===void 0&&(this.renderTarget=new yr(1,1,{minFilter:Ki,magFilter:Ki,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(t){this.autoResize=t}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(t){this.autoResize=t}render(t,e,i,r,n){this.fullscreenMaterial.inputBuffer=e.texture,t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){this.autoResize&&this.renderTarget.setSize(t,e)}initialize(t,e,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==zo?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":t.outputEncoding===ji&&(this.renderTarget.texture.encoding=ji))}},hAe=class extends dl{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(t,e,i,r,n){let s=t.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},mL=new bi,T4=class extends dl{constructor(t=!0,e=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=t,this.depth=e,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(t,e,i){this.color=t,this.depth=e,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(t){this.overrideClearColor=t}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(t){this.overrideClearAlpha=t}render(t,e,i,r,n){let s=this.overrideClearColor,a=this.overrideClearAlpha,o=t.getClearAlpha(),l=s!==null,c=a>=0;l?(mL.copy(t.getClearColor(mL)),t.setClearColor(s,c?a:o)):c&&t.setClearAlpha(a),t.setRenderTarget(this.renderToScreen?null:e),t.clear(this.color,this.depth,this.stencil),l?t.setClearColor(mL,o):c&&t.setClearAlpha(o)}},Om=-1,Gl=class extends lo{constructor(t,e=Om,i=Om,r=1){super(),this.resizable=t,this.base=new Oe(1,1),this.preferred=new Oe(e,i),this.target=this.preferred,this.s=r}get width(){let{base:t,preferred:e,scale:i}=this,r;return e.width!==Om?r=e.width:e.height!==Om?r=Math.round(e.height*(t.width/Math.max(t.height,1))):r=Math.round(t.width*i),r}set width(t){this.preferredWidth=t}get height(){let{base:t,preferred:e,scale:i}=this,r;return e.height!==Om?r=e.height:e.width!==Om?r=Math.round(e.width/Math.max(t.width/Math.max(t.height,1),1)):r=Math.round(t.height*i),r}set height(t){this.preferredHeight=t}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(t){this.s!==t&&(this.s=t,this.preferred.setScalar(Om),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(t){this.scale=t}get baseWidth(){return this.base.width}set baseWidth(t){this.base.width!==t&&(this.base.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(t){this.base.width!==t&&(this.base.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(t){this.base.height!==t&&(this.base.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(t){this.baseHeight=t}setBaseSize(t,e){(this.base.width!==t||this.base.height!==e)&&(this.base.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(t){this.preferred.width!==t&&(this.preferred.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(t){this.preferredWidth=t}get preferredHeight(){return this.preferred.height}set preferredHeight(t){this.preferred.height!==t&&(this.preferred.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(t){this.preferredHeight=t}setPreferredSize(t,e){(this.preferred.width!==t||this.preferred.height!==e)&&(this.preferred.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(t){this.base.set(t.getBaseWidth(),t.getBaseHeight()),this.preferred.set(t.getPreferredWidth(),t.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return Om}},gL=!1,ZG=class{constructor(t=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(t),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let i;if(e.material.flatShading)switch(e.material.side){case Oo:i=this.materialsFlatShadedDoubleSide;break;case La:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(e.material.side){case Oo:i=this.materialsDoubleSide;break;case La:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=i[2]:e.isInstancedMesh?e.material=i[1]:e.material=i[0],++this.meshCount}}}setMaterial(t){if(this.disposeMaterials(),this.material=t,t!==null){let e=this.materials=[t.clone(),t.clone(),t.clone()];for(let i of e)i.uniforms=Object.assign({},t.uniforms),i.side=gh;e[2].skinning=!0,this.materialsBackSide=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.side=La,r}),this.materialsDoubleSide=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.side=Oo,r}),this.materialsFlatShaded=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r.side=La,r}),this.materialsFlatShadedDoubleSide=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r.side=Oo,r})}}render(t,e,i){let r=t.shadowMap.enabled;if(t.shadowMap.enabled=!1,gL){let n=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),t.render(e,i);for(let s of n)s[0].material=s[1];this.meshCount!==n.size&&n.clear()}else{let n=e.overrideMaterial;e.overrideMaterial=this.material,t.render(e,i),e.overrideMaterial=n}t.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){let t=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let e of t)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return gL}static set workaroundEnabled(t){gL=t}},dAe=class extends dl{constructor(t,e,i=null){super("RenderPass",t,e),this.needsSwap=!1,this.clearPass=new T4,this.overrideMaterialManager=i===null?null:new ZG(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(t){super.renderToScreen=t,this.clearPass.renderToScreen=t}get overrideMaterial(){let t=this.overrideMaterialManager;return t!==null?t.material:null}set overrideMaterial(t){let e=this.overrideMaterialManager;t!==null?e!==null?e.setMaterial(t):this.overrideMaterialManager=new ZG(t):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(t){this.overrideMaterial=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getSelection(){return this.selection}setSelection(t){this.selection=t}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(t){this.ignoreBackground=t}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(t){this.skipShadowMapUpdate=t}getClearPass(){return this.clearPass}render(t,e,i,r,n){let s=this.scene,a=this.camera,o=this.selection,l=a.layers.mask,c=s.background,u=t.shadowMap.autoUpdate,h=this.renderToScreen?null:e;o!==null&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(t.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(t,e),t.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(t,s,a):t.render(s,a),a.layers.mask=l,s.background=c,t.shadowMap.autoUpdate=u}},KG=class extends dl{constructor(t,e,{resolutionScale:i=1,width:r=Gl.AUTO_SIZE,height:n=Gl.AUTO_SIZE,renderTarget:s}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new dAe(t,e,new bq({depthPacking:sq}));let a=this.renderPass;a.skipShadowMapUpdate=!0,a.ignoreBackground=!0;let o=a.getClearPass();o.overrideClearColor=new bi(16777215),o.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new yr(1,1,{minFilter:nr,magFilter:nr,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new Gl(this,r,n,i);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}render(t,e,i,r,n){let s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(t,s)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e),this.renderTarget.setSize(i.width,i.height)}},Mr={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},fAe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",pAe="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",mAe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",gAe="float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",vAe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",yAe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",xAe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",bAe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",_Ae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",SAe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",wAe="float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",MAe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",EAe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",AAe="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",TAe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",CAe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",DAe="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",PAe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",RAe=new Map([[Mr.SKIP,null],[Mr.ADD,fAe],[Mr.ALPHA,pAe],[Mr.AVERAGE,mAe],[Mr.COLOR_BURN,gAe],[Mr.COLOR_DODGE,vAe],[Mr.DARKEN,yAe],[Mr.DIFFERENCE,xAe],[Mr.EXCLUSION,bAe],[Mr.LIGHTEN,_Ae],[Mr.MULTIPLY,SAe],[Mr.DIVIDE,wAe],[Mr.NEGATION,MAe],[Mr.NORMAL,EAe],[Mr.OVERLAY,AAe],[Mr.REFLECT,TAe],[Mr.SCREEN,CAe],[Mr.SOFT_LIGHT,DAe],[Mr.SUBTRACT,PAe]]),OAe=class extends lo{constructor(t,e=1){super(),this.f=t,this.opacity=new At(e)}getOpacity(){return this.opacity.value}setOpacity(t){this.opacity.value=t}get blendFunction(){return this.f}set blendFunction(t){this.f=t,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(t){this.blendFunction=t}getShaderCode(){return RAe.get(this.blendFunction)}},Bd={NONE:0,DEPTH:1,CONVOLUTION:2},tf=class extends lo{constructor(t,e,{attributes:i=Bd.NONE,blendFunction:r=Mr.SCREEN,defines:n=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:o=null}={}){super(),this.name=t,this.renderer=null,this.attributes=i,this.fragmentShader=e,this.vertexShader=o,this.defines=n,this.uniforms=s,this.extensions=a,this.blendMode=new OAe(r),this.blendMode.addEventListener("change",l=>this.setChanged())}getName(){return this.name}setRenderer(t){this.renderer=t}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(t){this.attributes=t,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(t){this.fragmentShader=t,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(t){this.vertexShader=t,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(t,e=Bp){}update(t,e,i){}setSize(t,e){}initialize(t,e,i){}dispose(){for(let t of Object.keys(this)){let e=this[t];if(e!==null&&typeof e=="object"&&typeof e.dispose=="function"){if(e instanceof ql||e===this.renderer)continue;this[t].dispose()}}}};function JG(t,e,i){for(let r of e){let n="$1"+t+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(let a of i.entries())a[1]!==null&&i.set(a[0],a[1].replace(s,n))}}function LAe(t,e,i,r,n,s,a){let o=new Map([["fragment",e.getFragmentShader()],["vertex",e.getVertexShader()]]),l=o.get("fragment")!==void 0&&/mainImage/.test(o.get("fragment")),c=o.get("fragment")!==void 0&&/mainUv/.test(o.get("fragment")),u=[],h=[],d=!1,p=!1;if(o.get("fragment")===void 0)console.error("Missing fragment shader",e);else if(c&&(a&Bd.CONVOLUTION)!==0)console.error("Effects that transform UV coordinates are incompatible with convolution effects",e);else if(!l&&!c)console.error("The fragment shader contains neither a mainImage nor a mainUv function",e);else{let g=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,x=rB.Section;if(c){let b=`	${t}MainUv(UV);
`;i.set(x.FRAGMENT_MAIN_UV,i.get(x.FRAGMENT_MAIN_UV)+b),d=!0}if(o.get("vertex")!==null&&/mainSupport/.test(o.get("vertex"))){let b=`	${t}MainSupport(`;b+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?`vUv);
`:`);
`,i.set(x.VERTEX_MAIN_SUPPORT,i.get(x.VERTEX_MAIN_SUPPORT)+b),u=u.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(w=>w[1])),h=h.concat(u).concat([...o.get("vertex").matchAll(g)].map(w=>w[1]))}h=h.concat([...o.get("fragment").matchAll(g)].map(b=>b[1])),h=h.concat([...e.defines.keys()].map(b=>b.replace(/\([\w\s,]*\)/g,""))),h=h.concat([...e.uniforms.keys()]),e.uniforms.forEach((b,w)=>s.set(t+w.charAt(0).toUpperCase()+w.slice(1),b)),e.defines.forEach((b,w)=>n.set(t+w.charAt(0).toUpperCase()+w.slice(1),b)),JG(t,h,n),JG(t,h,o);let v=e.blendMode;if(r.set(v.blendFunction,v),l){let b=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,w=`${t}MainImage(color0, UV, `;(a&Bd.DEPTH)!==0&&b.test(o.get("fragment"))&&(w+="depth, ",p=!0),w+=`color1);
	`;let M=t+"BlendOpacity";s.set(M,v.opacity),w+=`color0 = blend${v.blendFunction}(color0, color1, ${M});

	`,i.set(x.FRAGMENT_MAIN_IMAGE,i.get(x.FRAGMENT_MAIN_IMAGE)+w),w=`uniform float ${M};

`,i.set(x.FRAGMENT_HEAD,i.get(x.FRAGMENT_HEAD)+w)}i.set(x.FRAGMENT_HEAD,i.get(x.FRAGMENT_HEAD)+o.get("fragment")+`
`),o.get("vertex")!==null&&i.set(x.VERTEX_HEAD,i.get(x.VERTEX_HEAD)+o.get("vertex")+`
`)}return{varyings:u,transformedUv:d,readDepth:p}}var yD=class extends dl{constructor(t,...e){super("EffectPass"),this.fullscreenMaterial=new rB(null,null,null,t),this.effects=e.sort((i,r)=>r.attributes-i.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(t){this.fullscreenMaterial.encodeOutput=t}get dithering(){return this.fullscreenMaterial.dithering}set dithering(t){let e=this.fullscreenMaterial;e.dithering=t,e.needsUpdate=!0}verifyResources(){let t=this.renderer.capabilities,e=Math.min(t.maxFragmentUniforms,t.maxVertexUniforms);this.uniformCount>e&&console.warn("The current rendering context doesn't support more than "+e+" uniforms, but "+this.uniformCount+" were defined"),e=t.maxVaryings,this.varyingCount>e&&console.warn("The current rendering context doesn't support more than "+e+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let t=rB.Section,e=new Map([[t.FRAGMENT_HEAD,""],[t.FRAGMENT_MAIN_UV,""],[t.FRAGMENT_MAIN_IMAGE,""],[t.VERTEX_HEAD,""],[t.VERTEX_MAIN_SUPPORT,""]]),i=new Map,r=new Map,n=new Map,s=new Set,a=0,o=0,l=0,c=!1,u=!1;for(let d of this.effects)if(d.blendMode.blendFunction===Mr.SKIP)l|=d.getAttributes()&Bd.DEPTH;else if((l&d.getAttributes()&Bd.CONVOLUTION)!==0)console.error("Convolution effects cannot be merged",d);else{l|=d.getAttributes();let p="e"+a++,g=LAe(p,d,e,i,r,n,l);if(o+=g.varyings.length,c=c||g.transformedUv,u=u||g.readDepth,d.extensions!==null)for(let x of d.extensions)s.add(x)}let h=/\bblend\b/g;for(let d of i.values()){let p=d.getShaderCode().replace(h,`blend${d.blendFunction}`);e.set(t.FRAGMENT_HEAD,e.get(t.FRAGMENT_HEAD)+p+`
`)}(l&Bd.DEPTH)!==0?(u&&e.set(t.FRAGMENT_MAIN_IMAGE,`float depth = readDepth(UV);

	`+e.get(t.FRAGMENT_MAIN_IMAGE)),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,c?(e.set(t.FRAGMENT_MAIN_UV,`vec2 transformedUv = vUv;
`+e.get(t.FRAGMENT_MAIN_UV)),r.set("UV","transformedUv")):r.set("UV","vUv"),e.forEach((d,p,g)=>g.set(p,d.trim().replace(/^#/,`
#`))),this.uniformCount=n.size,this.varyingCount=o,this.skipRendering=a===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(e).setExtensions(s).setUniforms(n).setDefines(r)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(t,e=Bp){this.fullscreenMaterial.depthBuffer=t,this.fullscreenMaterial.depthPacking=e;for(let i of this.effects)i.setDepthTexture(t,e)}render(t,e,i,r,n){for(let s of this.effects)s.update(t,e,r);if(!this.skipRendering||this.renderToScreen){let s=this.fullscreenMaterial;s.inputBuffer=e.texture,s.time+=r,t.setRenderTarget(this.renderToScreen?null:i),t.render(this.scene,this.camera)}}setSize(t,e){this.fullscreenMaterial.setSize(t,e);for(let i of this.effects)i.setSize(t,e)}initialize(t,e,i){this.renderer=t;for(let r of this.effects)r.initialize(t,e,i),r.addEventListener("change",n=>this.handleEvent(n));this.updateMaterial(),this.verifyResources(),i!==void 0&&i!==zo&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let t of this.effects)t.dispose()}handleEvent(t){switch(t.type){case"change":this.recompile();break}}},IAe=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],C4=class extends dl{constructor({resolutionScale:t=.5,width:e=Gl.AUTO_SIZE,height:i=Gl.AUTO_SIZE,kernelSize:r=J3.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new yr(1,1,{minFilter:Ki,magFilter:Ki,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let n=this.resolution=new Gl(this,e,i,t);n.addEventListener("change",s=>this.setSize(n.baseWidth,n.baseHeight)),this.blurMaterial=new QG,this.ditheredBlurMaterial=new QG,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=r}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(t){this.resolution.preferredWidth=t}get height(){return this.resolution.height}set height(t){this.resolution.preferredHeight=t}get scale(){return this.blurMaterial.scale}set scale(t){this.blurMaterial.scale=t}getScale(){return this.blurMaterial.scale}setScale(t){this.blurMaterial.scale=t}getKernelSize(){return this.kernelSize}setKernelSize(t){this.kernelSize=t}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}render(t,e,i,r,n){let s=this.scene,a=this.camera,o=this.renderTargetA,l=this.renderTargetB,c=IAe[this.kernelSize],u=this.blurMaterial,h=e,d,p;for(this.fullscreenMaterial=u,d=0,p=c.length-1;d<p;++d){let g=(d&1)===0?o:l;u.kernel=c[d],u.inputBuffer=h.texture,t.setRenderTarget(g),t.render(s,a),h=g}this.dithering&&(u=this.ditheredBlurMaterial,this.fullscreenMaterial=u),u.kernel=c[d],u.inputBuffer=h.texture,t.setRenderTarget(this.renderToScreen?null:i),t.render(s,a)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e);let r=i.width,n=i.height;this.renderTargetA.setSize(r,n),this.renderTargetB.setSize(r,n),this.blurMaterial.setSize(r,n),this.ditheredBlurMaterial.setSize(r,n)}initialize(t,e,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==zo?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):t.outputEncoding===ji&&(this.renderTargetA.texture.encoding=ji,this.renderTargetB.texture.encoding=ji))}static get AUTO_SIZE(){return Gl.AUTO_SIZE}},zAe=class extends dl{constructor({width:t=Gl.AUTO_SIZE,height:e=Gl.AUTO_SIZE,renderTarget:i,luminanceRange:r,colorOutput:n}={}){super("LuminancePass"),this.fullscreenMaterial=new rAe(n,r),this.needsSwap=!1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new yr(1,1,{minFilter:Ki,magFilter:Ki,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let s=this.resolution=new Gl(this,t,e);s.addEventListener("change",a=>this.setSize(s.baseWidth,s.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(t,e,i,r,n){let s=this.fullscreenMaterial;s.inputBuffer=e.texture,t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e),this.renderTarget.setSize(i.width,i.height)}initialize(t,e,i){i!==void 0&&i!==zo&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},UAe=class extends dl{constructor(t,e){super("MaskPass",t,e),this.needsSwap=!1,this.clearPass=new T4(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(t){this.inverse=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(t){this.inverted=t}render(t,e,i,r,n){let s=t.getContext(),a=t.state.buffers,o=this.scene,l=this.camera,c=this.clearPass,u=this.inverted?0:1,h=1-u;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.stencil.setFunc(s.ALWAYS,u,4294967295),a.stencil.setClear(h),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(t,null):(c.render(t,e),c.render(t,i))),this.renderToScreen?(t.setRenderTarget(null),t.render(o,l)):(t.setRenderTarget(e),t.render(o,l),t.setRenderTarget(i),t.render(o,l)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(s.EQUAL,1,4294967295),a.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.stencil.setLocked(!0)}},$c=class extends dl{constructor(t,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=t,this.inputBufferUniform=null,this.setInput(e)}setInput(t){if(this.inputBufferUniform=null,this.fullscreenMaterial!==null){let e=this.fullscreenMaterial.uniforms;e!==void 0&&e[t]!==void 0&&(this.inputBufferUniform=e[t])}}render(t,e,i,r,n){this.inputBufferUniform!==null&&e!==null&&(this.inputBufferUniform.value=e.texture),t.setRenderTarget(this.renderToScreen?null:i),t.render(this.scene,this.camera)}initialize(t,e,i){i!==void 0&&i!==zo&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},vL=1/1e3,BAe=1e3,NAe=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(t){return this.fixedDeltaEnabled=t,this}isAutoResetEnabled(t){return this.autoReset}setAutoResetEnabled(t){return typeof document<"u"&&document.hidden!==void 0&&(t?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=t),this}getDelta(){return this.delta*vL}getFixedDelta(){return this.fixedDelta*vL}setFixedDelta(t){return this.fixedDelta=t*BAe,this}getElapsed(){return this.elapsed*vL}getTimescale(){return this.timescale}setTimescale(t){return this.timescale=t,this}update(t){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=t!==void 0?t:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(t){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},J3={MEDIUM:2,LARGE:3,HUGE:5},FAe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}`,kAe=class extends tf{constructor({blendFunction:t=Mr.SCREEN,luminanceThreshold:e=.9,luminanceSmoothing:i=.025,resolutionScale:r=.5,intensity:n=1,width:s=Gl.AUTO_SIZE,height:a=Gl.AUTO_SIZE,kernelSize:o=J3.LARGE}={}){super("BloomEffect",FAe,{blendFunction:t,uniforms:new Map([["map",new At(null)],["intensity",new At(n)]])}),this.renderTarget=new yr(1,1,{minFilter:Ki,magFilter:Ki,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new zAe({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new C4({resolutionScale:r,width:s,height:a,kernelSize:o});let l=this.blurPass.getResolution();l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(t){this.resolution.preferredWidth=t}get height(){return this.resolution.height}set height(t){this.resolution.preferredHeight=t}get dithering(){return this.blurPass.dithering}set dithering(t){this.blurPass.dithering=t}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(t){this.blurPass.kernelSize=t}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(t){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(t){this.uniforms.get("intensity").value=t}getIntensity(){return this.intensity}setIntensity(t){this.intensity=t}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}update(t,e,i){let r=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(t,e,r),this.blurPass.render(t,r,r)):this.blurPass.render(t,e,r)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(t,e,i){this.blurPass.initialize(t,e,i),i!==void 0&&(this.renderTarget.texture.type=i,t.outputEncoding===ji&&(this.renderTarget.texture.encoding=ji))}},VAe="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",HAe=class extends tf{constructor({blendFunction:t=Mr.NORMAL,brightness:e=0,contrast:i=0}={}){super("BrightnessContrastEffect",VAe,{blendFunction:t,uniforms:new Map([["brightness",new At(e)],["contrast",new At(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(t){this.uniforms.get("brightness").value=t}getBrightness(t){return this.brightness}setBrightness(t){this.brightness=t}get contrast(){return this.uniforms.get("contrast").value}set contrast(t){this.uniforms.get("contrast").value=t}getContrast(t){return this.contrast}setContrast(t){this.contrast=t}},GAe="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",jAe=class extends tf{constructor(t=Mr.NORMAL){super("ColorAverageEffect",GAe,{blendFunction:t})}},WAe="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",qAe="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",XAe=class extends tf{constructor({blendFunction:t=Mr.NORMAL,offset:e=new Oe(.001,5e-4)}={}){super("ChromaticAberrationEffect",WAe,{vertexShader:qAe,blendFunction:t,attributes:Bd.CONVOLUTION,uniforms:new Map([["offset",new At(e)]])})}get offset(){return this.uniforms.get("offset").value}set offset(t){this.uniforms.get("offset").value=t}getOffset(){return this.offset}setOffset(t){this.offset=t}},YAe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}`,QAe=class extends tf{constructor(t,{blendFunction:e=Mr.NORMAL,worldFocusDistance:i,worldFocusRange:r,focusDistance:n=0,focalLength:s=.1,focusRange:a=s,bokehScale:o=1,width:l=Gl.AUTO_SIZE,height:c=Gl.AUTO_SIZE}={}){super("DepthOfFieldEffect",YAe,{blendFunction:e,attributes:Bd.DEPTH,uniforms:new Map([["nearColorBuffer",new At(null)],["farColorBuffer",new At(null)],["nearCoCBuffer",new At(null)],["scale",new At(1)]])}),this.camera=t,this.renderTarget=new yr(1,1,{minFilter:Ki,magFilter:Ki,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new $c(new WEe(t));let u=this.cocMaterial;u.focusDistance=n,u.focusRange=a,i!==void 0&&(u.worldFocusDistance=i),r!==void 0&&(u.worldFocusRange=r),this.blurPass=new C4({kernelSize:J3.MEDIUM,width:l,height:c});let h=this.blurPass.getResolution();h.addEventListener("change",p=>this.setSize(h.getBaseWidth(),h.getBaseHeight())),this.maskPass=new $c(new sAe(this.renderTargetCoC.texture));let d=this.maskPass.fullscreenMaterial;d.maskFunction=UQ.MULTIPLY,d.colorChannel=zQ.GREEN,this.bokehNearBasePass=new $c(new D2(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new $c(new D2(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new $c(new D2(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new $c(new D2(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=o}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(t){let e=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of e)i.fullscreenMaterial.setScale(t);this.maskPass.fullscreenMaterial.setStrength(t),this.uniforms.get("scale").value=t}getBokehScale(){return this.bokehScale}setBokehScale(t){this.bokehScale=t}getTarget(){return this.target}setTarget(t){this.target=t}calculateFocusDistance(t){let e=this.camera,i=e.position.distanceTo(t);return iB(-i,e.near,e.far)}setDepthTexture(t,e=Bp){this.circleOfConfusionMaterial.depthBuffer=t,this.circleOfConfusionMaterial.depthPacking=e}update(t,e,i){let r=this.renderTarget,n=this.renderTargetCoC,s=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(this.target!==null){let o=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=o}this.cocPass.render(t,null,n),this.blurPass.render(t,n,s),this.maskPass.render(t,e,a),this.bokehFarBasePass.render(t,a,r),this.bokehFarFillPass.render(t,r,this.renderTargetFar),this.bokehNearBasePass.render(t,e,r),this.bokehNearFillPass.render(t,r,this.renderTargetNear)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e);let r=i.width,n=i.height,s=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];s.push(this.renderTargetCoC,this.renderTargetMasked),s.forEach(a=>a.setSize(t,e)),s=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],s.forEach(a=>a.setSize(r,n)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(a=>a.fullscreenMaterial.setSize(r,n))}initialize(t,e,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(r=>r.initialize(t,e,i)),this.blurPass.initialize(t,e,zo),i!==void 0&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,t.outputEncoding===ji&&(this.renderTarget.texture.encoding=ji,this.renderTargetNear.texture.encoding=ji,this.renderTargetFar.texture.encoding=ji,this.renderTargetMasked.texture.encoding=ji))}};new W;new Ot;var ZAe="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",KAe=class extends tf{constructor({blendFunction:t=Mr.NORMAL,hue:e=0,saturation:i=0}={}){super("HueSaturationEffect",ZAe,{blendFunction:t,uniforms:new Map([["hue",new At(new W)],["saturation",new At(i)]])}),this.hue=e}get saturation(){return this.uniforms.get("saturation").value}set saturation(t){this.uniforms.get("saturation").value=t}getSaturation(){return this.saturation}setSaturation(t){this.saturation=t}get hue(){let t=this.uniforms.get("hue").value;return Math.acos((t.x*3-1)/2)}set hue(t){let e=Math.sin(t),i=Math.cos(t);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3)}getHue(){return this.hue}setHue(t){this.hue=t}};new bi;var JAe=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,$Ae=class extends tf{constructor({blendFunction:t=Mr.SCREEN,premultiply:e=!1}={}){super("NoiseEffect",JAe,{blendFunction:t}),this.premultiply=e}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(t){this.premultiply!==t&&(t?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(t){this.premultiply=t}},e2e="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",t2e=class extends tf{constructor(t=30){super("PixelationEffect",e2e,{uniforms:new Map([["active",new At(!1)],["d",new At(new Oe)]])}),this.resolution=new Oe,this.d=0,this.granularity=t}get granularity(){return this.d}set granularity(t){let e=Math.floor(t);e%2>0&&(e+=1),this.d=e,this.uniforms.get("active").value=e>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(t){this.granularity=t}setSize(t,e){this.resolution.set(t,e),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}};new W;new W;var $G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",ej="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",i2e="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",r2e="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",i0={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},BQ=class extends tf{constructor({preset:t=i0.MEDIUM,edgeDetectionMode:e=K3.COLOR,predicationMode:i=JEe.DISABLED}={}){super("SMAAEffect",i2e,{vertexShader:r2e,blendFunction:Mr.NORMAL,attributes:Bd.CONVOLUTION|Bd.DEPTH,uniforms:new Map([["weightMap",new At(null)]])});let r,n;arguments.length>1&&(r=arguments[0],n=arguments[1],arguments.length>2&&(t=arguments[2]),arguments.length>3&&(e=arguments[3])),this.renderTargetEdges=new yr(1,1,{minFilter:Ki,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new T4(!0,!1,!1),this.clearPass.overrideClearColor=new bi(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new $c(new $Ee),this.edgeDetectionMaterial.edgeDetectionMode=e,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new $c(new lAe);let s=new Fq;s.onLoad=()=>{let a=new ns(r);a.name="SMAA.Search",a.magFilter=nr,a.minFilter=nr,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;let o=new ns(n);o.name="SMAA.Area",o.magFilter=Ki,o.minFilter=Ki,o.generateMipmaps=!1,o.needsUpdate=!0,o.flipY=!1,this.weightsMaterial.areaTexture=o,this.dispatchEvent({type:"load"})},s.itemStart("search"),s.itemStart("area"),r!==void 0&&n!==void 0?(s.itemEnd("search"),s.itemEnd("area")):typeof Image<"u"&&(r=new Image,n=new Image,r.addEventListener("load",()=>s.itemEnd("search")),n.addEventListener("load",()=>s.itemEnd("area")),r.src=$G,n.src=ej),this.applyPreset(t)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(t){this.edgeDetectionMaterial.edgeDetectionThreshold=t}setOrthogonalSearchSteps(t){this.weightsMaterial.orthogonalSearchSteps=t}applyPreset(t){let e=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(t){case i0.LOW:e.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case i0.MEDIUM:e.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case i0.HIGH:e.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case i0.ULTRA:e.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break}}setDepthTexture(t,e=Bp){this.edgeDetectionMaterial.depthBuffer=t,this.edgeDetectionMaterial.depthPacking=e}update(t,e,i){this.clearPass.render(t,this.renderTargetEdges),this.edgeDetectionPass.render(t,e,this.renderTargetEdges),this.weightsPass.render(t,this.renderTargetEdges,this.renderTargetWeights)}setSize(t,e){this.edgeDetectionMaterial.setSize(t,e),this.weightsMaterial.setSize(t,e),this.renderTargetEdges.setSize(t,e),this.renderTargetWeights.setSize(t,e)}dispose(){let{searchTexture:t,areaTexture:e}=this.weightsMaterial;t!==null&&e!==null&&(t.dispose(),e.dispose()),super.dispose()}static get searchImageDataURL(){return $G}static get areaImageDataURL(){return ej}},n2e=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,P2={DEFAULT:0,ESKIL:1},s2e=class extends tf{constructor({blendFunction:t=Mr.NORMAL,technique:e=P2.DEFAULT,eskil:i=!1,offset:r=.5,darkness:n=.5}={}){super("VignetteEffect",n2e,{blendFunction:t,defines:new Map([["VIGNETTE_TECHNIQUE",e.toFixed(0)]]),uniforms:new Map([["offset",new At(r)],["darkness",new At(n)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(t){this.technique!==t&&(this.defines.set("VIGNETTE_TECHNIQUE",t.toFixed(0)),this.setChanged())}get eskil(){return this.technique===P2.ESKIL}set eskil(t){this.technique=t?P2.ESKIL:P2.DEFAULT}getTechnique(){return this.technique}setTechnique(t){this.technique=t}get offset(){return this.uniforms.get("offset").value}set offset(t){this.uniforms.get("offset").value=t}getOffset(){return this.offset}setOffset(t){this.offset=t}get darkness(){return this.uniforms.get("darkness").value}set darkness(t){this.uniforms.get("darkness").value=t}getDarkness(){return this.darkness}setDarkness(t){this.darkness=t}},Np=class{constructor(t,e){this.enabled=!1,this.effect=new t(e),Object.defineProperty(this,"opacity",{enumerable:!0,set(i){this.effect.blendMode.opacity.value=i},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(i){this.effect.blendMode.setBlendFunction(Number(i))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=Mr.NORMAL}},a2e=class extends Np{constructor(){super(kAe),this.blendFunction=Mr.SCREEN}set intensity(t){this.effect.intensity=t}get intensity(){return this.effect.intensity}set luminanceThreshold(t){this.effect.luminanceMaterial.threshold=t}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(t){this.effect.luminanceMaterial.smoothing=t}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(t){this.effect.blurPass.scale=t}get blurScale(){return this.effect.blurPass.scale}set kernelSize(t){this.effect.blurPass.kernelSize=t}get kernelSize(){return this.effect.blurPass.kernelSize}},o2e=class extends Np{constructor(){super(HAe)}set contrast(t){this.effect.uniforms.get("contrast").value=t}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(t){this.effect.uniforms.get("brightness").value=t}get brightness(){return this.effect.uniforms.get("brightness").value}},l2e=class extends Np{constructor(){super(XAe),this.effect.offset=new Oe(.01,.01)}set offset(t){this.effect.offset.set(t[0]/1e3,t[1]/1e3)}get offset(){return[this.effect.offset.x*1e3,this.effect.offset.y*1e3]}},c2e=class extends Np{constructor(){super(jAe)}},u2e=class extends Np{constructor(){super(KAe),this._hue=0}set hue(t){this._hue=t,this.effect.setHue(t)}get hue(){return this._hue}set saturation(t){this.effect.uniforms.get("saturation").value=t}get saturation(){return this.effect.uniforms.get("saturation").value}},h2e=class extends Np{constructor(){super($Ae),this.blendFunction=Mr.OVERLAY}},d2e=class extends Np{constructor(){super(s2e)}get eskil(){return this.effect.eskil}set eskil(t){this.effect.eskil=t}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(t){this.effect.uniforms.get("darkness").value=t}get offset(){return this.effect.uniforms.get("offset").value}set offset(t){this.effect.uniforms.get("offset").value=t}},f2e=class extends Np{constructor(t){super(QAe)}set focalLength(t){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=t/2e3}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(t){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=this.isPerspectiveCamera?t/2e3:(t+992)/2e3}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(t){this.effect.bokehScale=t}setCamera(t){let e=!1;(t.isPerspectiveCamera&&this.isPerspectiveCamera===!1||!t.isPerspectiveCamera&&this.isPerspectiveCamera===!0)&&(e=!0),t.isPerspectiveCamera?(this.effect.circleOfConfusionMaterial.adoptCameraSettings(t.perspCamera),this.isPerspectiveCamera=!0):(this.effect.circleOfConfusionMaterial.adoptCameraSettings(t),this.isPerspectiveCamera=!1),e&&this.effect.setChanged()}},p2e=class extends Np{constructor(){super(t2e)}get granularity(){return this.effect.getGranularity()}set granularity(t){this.effect.setGranularity(t)}},m2e=`#define GLSLIFY 1
varying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}`,g2e=`#define GLSLIFY 1
#include <common>
varying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;
#define USE_YCOCG
#define USE_CATMULL_ROM
const float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){
#ifdef USE_YCOCG
vec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);
#else
return texture(tex,uv);
#endif
}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){
#ifdef CHOOSE_LONGEST_MOTION_VECTOR
float longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;
#else
float closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;
#endif
}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);
#ifdef USE_CATMULL_ROM
vec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);
#else
vec4 previousColor=sample_color(historyBuffer,previousPixelPos);
#endif
#ifdef USE_YCOCG
previousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);
#endif
vec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);
#ifdef USE_YCOCG
vec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;
#endif
vec4 previousColorClipped=clamp(previousColor,cmin,cmax);
#ifdef LUMINANCE_DIFFERENCES
#ifdef USE_YCOCG
float lum0=currentColor.r;float lum1=previousColorClipped.r;
#else
float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);
#endif
float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));
#else
const float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);
#endif
#ifdef USE_YCOCG
gl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);
#else
gl_FragColor=result;
#endif
}`,v2e=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}`,y2e=`#define GLSLIFY 1
layout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}`,sB=class extends xr{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new At(null)},blending:js,depthWrite:!1,depthTest:!1,vertexShader:v2e,fragmentShader:y2e})}set inputBuffer(t){this.uniforms.inputBuffer.value=t}},x2e=class extends dl{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new sB,this.resolutionVector=new Oe,this.resolveMaterial=new xr({name:"TAAResolveMaterial",uniforms:{inputBuffer:new At(null),historyBuffer:new At(null),velocityBuffer:new At(null),depthBuffer:new At(null),resolution:new At(new Oe)},blending:js,depthWrite:!1,depthTest:!1,vertexShader:m2e,fragmentShader:g2e}),this.historyRenderTarget=new yr(1024,1024,{minFilter:Ki,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new yr(1024,1024,{minFilter:Ki,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(t,e){this.historyRenderTarget.setSize(t,e),this.resultRenderTarget.setSize(t,e)}render(t,e){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=e.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=e.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=e.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(e.width,e.height),t.setRenderTarget(this.resultRenderTarget),t.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,t.setRenderTarget(this.historyRenderTarget),t.render(this.scene,this.camera);let i=this.renderToScreen?null:e;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,t.setRenderTarget(i),t.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},b2e=class extends dl{constructor(t,e,i){super("TransmissionPass",void 0,e),this.MRTCompatible=!0,this.depthPass=new KG(t,e,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new sB,this.splineScene=t,this.needsSwap=!1}updatePasses(t){this.passThroughMaterial=new sB,this.depthPass=new KG(this.splineScene,this.camera,{renderTarget:t.transmissionDepthTarget})}setCamera(t){this.camera=t}setScene(t){this.splineScene=t}render(t,e,i){let r=this.camera.layers.mask,n=t;n.setRenderTarget(n.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=e.texture[0],n.clear(),n.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(t,e,i),n.shadowMap.needsUpdate=!1,n.shadowMap.autoUpdate=!1;let s=this.renderToScreen?null:e;this.camera.layers.set(3),t.setRenderTarget(s),t.render(this.splineScene,this.camera),this.camera.layers.mask=r}},tj=new ql,_2e=new xr({transparent:!0,vertexShader:`
        void main() {
            gl_Position = vec4(0.0);
        }
    `,fragmentShader:`
        layout(location = 1) out vec4 gVelocity;

        void main() {
            gl_FragColor = vec4(0.0);
			gVelocity = vec4(0.0);
        }
    `}),aB=class extends dl{constructor(t,e,i){super("OpaquePass",e??tj,i),this.MRTCompatible=!0,this.originalMaterials=[],this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.MRTCompatible=t}setCamera(t){this.camera=t}setScene(t){this.scene=t??tj}getScene(){return this.scene}render(t,e){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.length=0,this.scene.traverse(r=>{r.layers.isEnabled(3)&&r instanceof hl&&(this.originalMaterials.push([r,r.material]),r.material=_2e)}),t.shadowMap.needsUpdate=!0,t.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let i=this.renderToScreen?null:e;t.setRenderTarget(i),this.clearColorOnly&&t.clear(!0,!1,!0),this.clear&&t.clear(),t.render(this.scene,this.camera),this.clearDepth&&t.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach(r=>{r[0].material=r[1]})}},S2e=class{constructor(t,{depthBuffer:e=!0,stencilBuffer:i=!1,multisampling:r=0,frameBufferType:n=0}={}){this.renderer=t,this.helperStartIndex=0,this.copyPass=new nB,this.depthTexture=null,this.timer=new NAe,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(e,i,n,r,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(e,i,n,r,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(e,i,n,r,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(t)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(t){let e=this.inputBuffer,i=this.multisampling;i>0&&t>0?(this.inputBuffer.samples=t,this.outputBuffer.samples=t,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==t&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,t,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(t){var e;if(this.renderer=t,t!==null){let i=t.getSize(new Oe),r=((e=t.getContext().getContextAttributes())==null?void 0:e.alpha)??!1,n=this.inputBuffer.texture[0].type;n===zo&&t.outputEncoding===ji&&(this.inputBuffer.texture[0].encoding=ji,this.outputBuffer.texture[0].encoding=ji,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),t.autoClear=!1,this.setSize(i.width,i.height,!1);for(let s of this.passes)s.initialize(t,r,n)}}replaceRenderer(t,e=!0){let i=this.renderer,r=i.domElement.parentNode;return this.setRenderer(t),e&&r!==null&&(r.removeChild(i.domElement),r.appendChild(t.domElement)),i}createDepthTexture(){let t=this.depthTexture=new O1(this._width,this._height);return this.inputBuffer.depthTexture=t,this.inputBuffer.stencilBuffer?(t.format=L0,t.type=x0):t.type=pp,t}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let t of this.passes)t.setDepthTexture(null)}}createBuffer(t,e,i,r,n,s){let a=this.renderer,o=a===null?new Oe:a.getDrawingBufferSize(new Oe),l={minFilter:Ki,magFilter:Ki,wrapS:zn,wrapT:zn,stencilBuffer:e,depthBuffer:t},c;return r>0?(c=new yr(o.width,o.height,l),c.samples=r):(n?(c=new dq(o.width,o.height,2,l),c.texture[1].type=Ap):c=new yr(o.width,o.height,l),c.depthTexture=new O1(2048,2048),c.depthTexture.type=rn),i===zo&&a!==null&&a.outputEncoding===ji&&(Array.isArray(c.texture)?c.texture.forEach(u=>u.encoding=ji):c.texture.encoding=ji),Array.isArray(c.texture)?c.texture.forEach((u,h)=>{u.name=`EffectComposer.Buffer ${n} ${h}`,u.generateMipmaps=!1}):(c.texture.name=`EffectComposer.Buffer ${n}`,c.texture.generateMipmaps=!1),c.name=s,c}addPass(t,e){var o;let i=this.passes,r=this.renderer,n=r.getDrawingBufferSize(new Oe),s=((o=r.getContext().getContextAttributes())==null?void 0:o.alpha)??!1,a;if(t.MRTCompatible&&(a=this.inputBuffer.texture[0].type),t.MRTCompatible||(a=this.inputBuffer.texture.type),t.setRenderer(r),t.setSize(n.width,n.height),t.initialize(r,s,a),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),t.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?i.splice(e,0,t):i.push(t),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),t.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){let l=this.createDepthTexture();for(t of i)t.setDepthTexture(l)}else t.setDepthTexture(this.depthTexture)}setHelperStartIndex(t){this.helperStartIndex=t}removePass(t){let e=this.passes,i=e.indexOf(t);if(i!==-1&&e.splice(i,1).length>0){if(this.depthTexture!==null){let r=(n,s)=>n||s.needsDepthTexture;e.reduce(r,!1)||t.getDepthTexture()===this.depthTexture&&t.setDepthTexture(null)}this.autoRenderToScreen&&i===e.length&&(t.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){let t=this.passes;t.length>0&&(this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!1),this.passes=[])}render(t){let e=this.renderer,i=this.copyPass,r=this.inputBuffer,n=this.outputBuffer,s=this.inputBufferSingle,a=this.outputBufferSingle,o=!1,l,c,u,h;t===void 0&&(t=this.timer.update().getDelta());for(let d of this.passes)d.enabled&&(d.MRTCompatible?d.render(e,r,n,t,o):d.render(e,s,a,t,o),d.needsSwap&&(o&&(i.renderToScreen=d.renderToScreen,l=e.getContext(),c=e.state.buffers.stencil,c.setFunc(l.NOTEQUAL,1,4294967295),i.render(e,r,n,t,o),c.setFunc(l.EQUAL,1,4294967295)),u=r,h=s,r=n,s=a,n=u,a=h),d instanceof UAe?o=!0:d instanceof hAe&&(o=!1))}setSize(t,e,i){let r=this.renderer;if(this._width=t,this._height=e,t===void 0||e===void 0){let s=r.getSize(new Oe);t=s.width,e=s.height}r.setSize(t,e,i);let n=r.getDrawingBufferSize(new Oe);this.inputBuffer.setSize(n.width,n.height),this.outputBuffer.setSize(n.width,n.height),this.inputBufferSingle.setSize(n.width,n.height),this.outputBufferSingle.setSize(n.width,n.height);for(let s of this.passes)s.setSize(n.width,n.height)}reset(){let t=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(t)}dispose(){for(let t of this.passes)t.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.inputBufferSingle!==null&&this.inputBufferSingle.dispose(),this.outputBufferSingle!==null&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},w2e=new xr({name:"CombineMaterial",uniforms:{inputBufferA:new At(null),inputBufferB:new At(null)},blending:js,depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
    gl_Position = vec4(position.xy, 1.0, 1.0);
    vUv = position.xy * 0.5 + 0.5;
}
`,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D inputBufferA;
    uniform sampler2D inputBufferB;

    // TODO: Why do we need these when postpro of framemode is enabled???
    layout(location = 1) out vec4 gVelocity;

    void main() {
	vec4 resA = texture2D(inputBufferA, vUv);
	vec4 resB = texture2D(inputBufferB, vUv);
    float a = resA.a + resB.a * ( 1.0 - resA.a );

	vec4 res;
	res.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));
	res.a = resA.a + resB.a * (1.0 - resA.a);
	gl_FragColor = res;
    gVelocity = vec4(0.0);
    }
`}),M2e=class extends dl{constructor(t){super("HelperPass",void 0,t),this.MRTCompatible=!1,this.fullscreenMaterial=w2e,this.helperPass=new aB(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new aB(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let e=new BQ({preset:i0.LOW,edgeDetectionMode:K3.COLOR});this.effectPass=new yD(this.camera,e),this.rt=new yr(10,10,{minFilter:Ki,magFilter:Ki,wrapS:zn,wrapT:zn,depthBuffer:!0})}setSize(t,e){this.rt.setSize(t,e),this.effectPass.setSize(t,e)}set sceneHelpers(t){this.helperPass.setScene(t)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(t){this.helperPassOnTop.setScene(t)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(t){this.helperPass.setCamera(t),this.helperPassOnTop.setCamera(t)}initialize(t,e,i){super.initialize(t,e,i),this.effectPass.initialize(t,e,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(t,e,i){this.rt.depthTexture=e.depthTexture;let r=t.getClearAlpha();t.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(t,this.rt),this.helperPassOnTop.render(t,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(t,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=e.texture,t.setClearAlpha(r),t.setRenderTarget(null),t.clear(),t.render(this.scene,this.camera)}},E2e=`#define GLSLIFY 1
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
out vec3 n;void main(){
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
vec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}`,A2e=`#define GLSLIFY 1
in vec3 n;void main(){gl_FragColor=vec4(n,1.0);}`,T2e=`#define GLSLIFY 1
out vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}`,C2e=`#define GLSLIFY 1
in vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}
#define USE_GBUFFER_NORMALS
void main(){vec3 view_space_p=get_view_position(v_uv);
#ifdef USE_GBUFFER_NORMALS
vec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;
#else
vec3 view_space_n=-rebuild_normal(v_uv,view_space_p);
#endif
float radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}`,D2e=`#define GLSLIFY 1
out vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}`,P2e=`#define GLSLIFY 1
in vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){
#ifdef DEBUG
float d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);
#else
vec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;
#endif
}`,uS=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],R2e=new xr({vertexShader:E2e,fragmentShader:A2e}),vx=new xr({vertexShader:D2e,fragmentShader:P2e,uniforms:{texture_ao_lrez:new At(null),texture_depth_lrez:new At(null),texture_depth_hrez:new At(null),near:new At(null),far:new At(null)}}),O2e=class extends dl{constructor(t,e){super("AmbientOcclusionPass",void 0,e),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,r=1024;this.gBuffer=new yr(i,r,{type:AM?Ap:rn,depthTexture:new O1(i,r),minFilter:Ki,magFilter:Ki}),this.depthBufferHighRes=new yr(i,r,{depthTexture:new O1(i,r)}),this.aoBuffer=new yr(i,r,{minFilter:Ki,magFilter:Ki}),this.splineScene=t,this.splineCamera=e;let n=new Float32Array(uS.length*2);for(let a=0;a<uS.length;a++){let o=a*2;n[o+0]=uS[a][0],n[o+1]=uS[a][1]}this.blueNoiseInDiskTexture=new al(n,uS.length,1,SC,rn),this.blueNoiseInDiskTexture.wrapS=fp,this.blueNoiseInDiskTexture.wrapT=fp,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new xr({vertexShader:T2e,fragmentShader:C2e,uniforms:{near:new At(null),far:new At(null),fov:new At(null),proj_info:new At(new Ri),is_ortho:new At(!1),resolution:new At(new Oe),radius_of_influence:new At(8),radius_in_screen_space:new At(1),exponent:new At(1),ao_color:new At(new W),bias:new At(.5),texture_depth:new At(null),texture_normals:new At(null),texture_blue_noise:new At(null),texture_blue_noise_in_disk:new At(this.blueNoiseInDiskTexture),frame_index:new At(0),fog_enabled:new At(!1),fog_near:new At(1),fog_far:new At(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new yr(i,r,{minFilter:Ki,magFilter:Ki,wrapS:zn,wrapT:zn,depthBuffer:!1,type:rn});let s=new BQ({preset:i0.ULTRA,edgeDetectionMode:K3.COLOR});this.effectPass=new yD(this.camera,s)}initialize(t,e,i){super.initialize(t,e,i),this.effectPass.initialize(t,e,i)}setBlueNoiseTexture(t){this.hbaoMaterial.uniforms.texture_blue_noise.value=t}setSize(t,e){this._width=t,this._height=e,this.depthBufferHighRes.setSize(t,e);let i=this._runHalfRes?.5:1,r=t*i,n=e*i;this.gBuffer.setSize(r,n),this.aoBuffer.setSize(r,n),this.hbaoMaterial.uniforms.resolution.value.set(r,n),this.aaBuffer.setSize(r,n),this.effectPass.setSize(r,n)}get runHalfRes(){return this._runHalfRes}set runHalfRes(t){this._runHalfRes=t,this.setSize(this._width,this._height)}setCamera(t){this.splineCamera=t}setScene(t){this.splineScene=t}setDepthTexture(t){this.depthBufferHighRes.depthTexture=t,vx.uniforms.texture_depth_hrez.value=t,vx.needsUpdate=!0}render(t,e,i){this.splineScene.overrideMaterial=R2e;let r=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),t.setRenderTarget(this.gBuffer),t.clear(),t.render(this.splineScene,this.splineCamera),t.setRenderTarget(this.depthBufferHighRes),t.clear(),t.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=r,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let n=this.splineCamera.perspCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1-n[8])/n[0],l=-(1+n[9])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let c=this.splineCamera.perspCamera.fov*(Math.PI/180),u=this.hbaoMaterial.uniforms.resolution.value.y/(Math.tan(c*.5)*2),h=this.hbaoMaterial.uniforms.radius_of_influence.value*.5*u;this.hbaoMaterial.uniforms.radius_in_screen_space.value=h,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let n=this.splineCamera.orthoCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1+n[12])/n[0],l=-(1-n[13])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let c=.5*(this.hbaoMaterial.uniforms.resolution.value.y/a),u=this.hbaoMaterial.uniforms.radius_of_influence.value*c;this.hbaoMaterial.uniforms.radius_in_screen_space.value=u,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,t.setRenderTarget(this.aoBuffer),t.clear(),t.render(this.scene,this.camera),this.fullscreenMaterial=vx,vx.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,vx.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,vx.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,t.setRenderTarget(t.aoRenderTarget),t.clear(),t.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,t.setRenderTarget(this.aaBuffer),t.clear(),t.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(t,this.aaBuffer,t.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},L2e=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,I2e=`
uniform sampler2D tInput;
uniform sampler2D tMap;
uniform vec2 resolution;
varying vec2 vUv;

uniform vec2 uResolution;
uniform vec2 uCoords;

// Draws a rectangle at center <st> with size <size>
float rectangle(vec2 st, vec2 size) {
    size = vec2(0.5) - size * 0.5;
    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));
    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));

    return uv.x * uv.y;
}

uniform vec2 uSize;
uniform float uScale;
uniform float uDPR;
uniform float uCurrent;
uniform vec3 uSceneColor;

void main() {
    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
    screenUv *= 1.0 / uDPR;

    vec2 center = vec2(0.5, -0.5);
    vec2 outsideUv = screenUv;
    outsideUv += center;
    outsideUv -= uCoords.xy / uResolution.xy;
    outsideUv = (outsideUv - 0.5) + 0.5;
    outsideUv -= center;
    vec2 s = (uSize / uResolution) * uScale;
    float isOutside = 1.0 - rectangle(outsideUv, s);
    
    vec2 mid = vec2(0.5);
    vec2 insideUv = (screenUv - mid + s * mid) / s;
    vec4 background = texture2D(tInput, screenUv);
    vec4 image = texture2D(tMap, insideUv);
    gl_FragColor = mix(image, background, isOutside);
}
`,z2e=class extends $c{constructor(){super(new xr({vertexShader:L2e,fragmentShader:I2e,uniforms:{tInput:new At(null),tMap:new At(null),uResolution:new At(new Oe),uSize:new At(new Oe),uCoords:new At(new Oe),uScale:new At(1),uSceneColor:new At(new bi(16711680)),uDPR:new At(1),uCurrent:new At(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(t){this.uniforms.tMap.value=t}},U2e=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,B2e=`
uniform sampler2D toScene;
uniform sampler2D fromScene;
uniform vec2 resolution;

uniform vec2 uResolution;
uniform float uDPR;

uniform float mixRatio;
uniform sampler2D tMixTexture;
uniform int useTexture;
uniform float threshold;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( fromScene, screenUv );
	vec4 texel2 = texture2D( toScene, screenUv );

	if (useTexture==1) {
		
		vec4 transitionTexel = texture2D( tMixTexture, screenUv );
		float r = mixRatio * (1.0 + threshold * 2.0) - threshold;
		float mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);
		
		gl_FragColor = mix( texel1, texel2, mixf );
	} else {
		
		gl_FragColor = mix( texel1, texel2, mixRatio );
		
	}
}
`,N2e=[],F2e=class extends $c{constructor(){super(new xr({vertexShader:U2e,fragmentShader:B2e,uniforms:{toScene:new At(null),fromScene:new At(null),uResolution:new At(new Oe),uDPR:new At(1),mixRatio:new At(0),threshold:new At(.1),useTexture:new At(0),tMixTexture:{value:N2e[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(t){this.uniforms.fromScene.value=t}},k2e=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,V2e=`
uniform sampler2D inputBuffer;
uniform sampler2D blurredInputBuffer;
uniform sampler2D overlay;
uniform float blurIntensity;

uniform vec2 uResolution;
uniform float uDPR;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( overlay, screenUv );
	vec4 texel2 = texture2D( inputBuffer, screenUv );
	vec4 texel3 = texture2D( blurredInputBuffer, screenUv );

	float blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;
    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );
}
`,H2e=class extends $c{constructor(){super(new xr({vertexShader:k2e,fragmentShader:V2e,uniforms:{inputBuffer:new At(null),blurredInputBuffer:new At(null),overlay:new At(null),uResolution:new At(new Oe),uDPR:new At(1),blurIntensity:new At(0)}})),this._blurEnabled=!1,this.blurTarget=new yr(1,1,{minFilter:Ki,magFilter:Ki,wrapS:zn,wrapT:zn}),this.blurPass=new C4({width:window.innerWidth,height:window.innerHeight,kernelSize:J3.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(t){this.uniforms.overlay.value=t}setResolution(t,e,i=1){this.uniforms.uResolution.value.set(t,e),this.uniforms.uDPR.value=i,this.blurPass.setSize(t,e),this.blurTarget.setSize(t,e),this.blurPass.setSize(t,e)}get uiCanvas(){return this._uiCanvas}set uiCanvas(t){this._uiCanvas=t,t.texture&&(this.uniforms.overlay.value=t.texture);let e=t.frame;if(e){let i=e.data.backgroundBlur,r=i.radius;this._blurEnabled=i.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=r/3}}render(t,e,i,r,n){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(t,e,this.blurTarget,r,n)),super.render(t,e,i,r,n)}},G2e=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,j2e=`
uniform sampler2D tInput;
uniform sampler2D tOverlayImage;
varying vec2 vUv;
uniform vec2 uResolution;
uniform vec2 uRightBottom;
uniform vec2 uImageSize;
uniform float uScale;
uniform float uDPR;

vec3 blendNormal(vec3 base, vec3 blend) {
	return blend;
}

vec3 blendNormal(vec3 base, vec3 blend, float opacity) {
	return (blendNormal(base, blend) * opacity + base * (1.0 - opacity));
}

vec4 drawFixedSizeImage(sampler2D image, vec2 screenUV, vec2 imageSize, vec2 imageCoords, vec2 screenSize, float dpr) {
	vec2 uv = (screenUV * screenSize * dpr - imageCoords) / (imageSize * dpr);
	if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
		return vec4(0.0);
	}
	return texture2D(image, uv);
}

void main() {
    vec2 screenUV = gl_FragCoord.xy / (uResolution.xy * uDPR);
	vec2 imageCoords = vec2(uResolution.x * uDPR - uImageSize.x * uScale * uDPR - uRightBottom.x * uDPR, uRightBottom.y * uDPR);
    vec4 background = texture2D(tInput, screenUV);
    vec4 image = drawFixedSizeImage(tOverlayImage, screenUV, uImageSize * uScale, imageCoords, uResolution, uDPR);
    gl_FragColor = vec4(blendNormal(background.rgb, image.rgb, image.a), max(background.a, image.a));
}
`,W2e=class extends $c{constructor(){super(new xr({vertexShader:G2e,fragmentShader:j2e,uniforms:{tInput:new At(null),tOverlayImage:new At(null),uResolution:new At(new Oe),uImageSize:new At(new Oe),uRightBottom:new At(new Oe(20,20)),uScale:new At(.25),uDPR:new At(1)}}),"tInput")}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tOverlayImage.value}set texture(t){this.uniforms.tOverlayImage.value=t,this.uniforms.uImageSize.value.set(t.image.width,t.image.height)}};function ij(t,e){return e&&e.enabled&&t.push(e.effect),t}var q2e=t=>Object.values(Mr).includes(t)?t:Mr.NORMAL,X2e=class extends lo{constructor(t,e){super(),this._needsDOFResize=e,this.postprocessingState=tD.defaultData,this._scene=new ql,this._camera=new Io,this.effects=new Map,this.blueNoiseTexture=new al,this._renderToScreen=!0,this._isUIOverlayEnabled=!1,this.clock=new fde,this.renderer=t,this.debug=!1,this.effects.set("bloom",new a2e),this.effects.set("chromaticAberration",new l2e),this.effects.set("vignette",new d2e),this.effects.set("noise",new h2e),this.effects.set("colorAverage",new c2e),this.effects.set("hueSaturation",new u2e),this.effects.set("brightnessContrast",new o2e),this.effects.set("depthOfField",new f2e),this.effects.set("pixelation",new p2e),this.effectComposer=new S2e(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new aB(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new b2e(this.scene,this.camera,this.renderer),this.aoPass=new O2e(this.scene,this.camera),this.taaPass=new x2e,this.taaPass.renderToScreen=!1,this.helperPass=new M2e(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new z2e,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new H2e,this.uiOverlayPass.enabled=!1,this.logoOverlayPass=new W2e,this.logoOverlayPass.enabled=!1,this.sceneTransitionPass=new F2e,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(t){t!==void 0?(this.stylesOverlayPass.texture=t,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(t){this.helperPass.sceneHelpers=t}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(t){this.helperPass.sceneHelpersOnTop=t}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(t){this._scene=t,this.opaquePass.setScene(t),this.transmissionPass.setScene(t),this.aoPass.setScene(t)}get camera(){return this._camera}set camera(t){let e=this._camera!==t;this._camera=t,this.opaquePass.setCamera(t),this.transmissionPass.setCamera(t),e&&this.transmissionPass.updatePasses(this.renderer),this.aoPass.setCamera(t),this.helperPass.setCamera(t),this.effects.get("depthOfField").setCamera(t)}updateRenderToScreen(){let t=!1;for(let e=this.effectComposer.passes.length-1;e>=0;e--){let i=this.effectComposer.passes[e];if(i.enabled===!0&&!t&&this._renderToScreen){i.renderToScreen=!0,t=!0;continue}i.renderToScreen=!1}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(t){this.blueNoiseTexture=new al(t,128,128),this.blueNoiseTexture.wrapS=fp,this.blueNoiseTexture.wrapT=fp,this.blueNoiseTexture.minFilter=nr,this.blueNoiseTexture.magFilter=nr,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(t,e,i,r,n,s,a,o){this.aoPass.enabled=t,this.aoPass.radius=e,this.aoPass.bias=i,this.aoPass.aoColor=r,this.aoPass.fogEnabled=n,this.aoPass.fogNear=s,this.aoPass.fogFar=a,this.aoPass.runHalfRes!==!o&&(this.aoPass.runHalfRes=!o)}setTransmissionPassEnabled(t){this.transmissionPass.enabled=t,this.opaquePass.hasTransmissionPass=t}_initPasses(){var t,e,i;if((t=this.uvEffectPass)==null||t.dispose(),(e=this.effectPass)==null||e.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let r=[this.effects.get("pixelation")].reduce(ij,[]);r.length>0&&(this.uvEffectPass=new yD(this.camera,...r),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let n=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("depthOfField"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(ij,[]);if(n.length>0&&(this.effectPass=new yD(this.camera,...n),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass),this._needsDOFResize&&((i=this.effects.get("depthOfField"))==null?void 0:i.enabled)&&window!==void 0)){let s=this.renderer.viewportWidth,a=this.renderer.viewportHeight;this.renderer.setSize(s-1,a-1),this.renderer.setSize(s,a)}}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass),this.effectComposer.addPass(this.logoOverlayPass)}_initCopyPass(){if(this._savePass)return;let t=new Oe;this.renderer.getDrawingBufferSize(t),this._rt=new yr(t.x,t.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:fp,wrapT:fp}),this._rt.samples=0,this._savePass=new nB(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(t){this._rt=t,this._savePass=new nB(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(t){if(this._renderToScreen===t)return;let e=this.effectComposer;!e||(t===!0?e.removePass(this._savePass):e.addPass(this._savePass),this._renderToScreen=t,this.updateRenderToScreen())}set sceneTransitionFromTexture(t){t!==this.sceneTransitionPass.texture&&(t!==null?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=t)}setWatermark(t){this.logoOverlayPass.enabled=t!==null,t&&(this.logoOverlayPass.texture=t)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(t){let{enabled:e,...i}=t,r=!1;e!==this.postprocessingState.enabled&&(r=!0);for(let n of Object.entries(i)){let s=n[1],a=this.effects.get(n[0]);if(a){a.enabled!==s.enabled&&(r=!0),a.enabled=s.enabled;for(let[o,l]of Object.entries(s))o==="blendFunction"?a.blendFunction=q2e(l):a[o]=l}}this.postprocessingState=t,r&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(t,e,i,r){t instanceof Ri?(this.effectComposer.inputBuffer.scissor.set(t.x,t.y,t.z,t.w),this.effectComposer.outputBuffer.scissor.set(t.x,t.y,t.z,t.w)):(this.effectComposer.inputBuffer.scissor.set(t,e,i,r),this.effectComposer.outputBuffer.scissor.set(t,e,i,r));let n=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(n),this.effectComposer.outputBuffer.scissor.multiplyScalar(n),this.renderer.setScissor(t,e,i,r)}setScissorTest(t){this.effectComposer.inputBuffer.scissorTest=t,this.effectComposer.outputBuffer.scissorTest=t,this.renderer.setScissorTest(t)}setViewport(t,e,i,r){t instanceof Ri?(this.effectComposer.inputBuffer.viewport.copy(t),this.effectComposer.outputBuffer.viewport.copy(t)):(this.effectComposer.inputBuffer.viewport.set(t,e,i,r),this.effectComposer.outputBuffer.viewport.set(t,e,i,r))}resize(t,e,i){if(this.effectComposer.setSize(t,e,i),this._rt){let r=this.renderer.getPixelRatio();this._rt.setSize(t*r,e*r)}}dispose(){var t,e;(t=this.uvEffectPass)==null||t.dispose(),(e=this.effectPass)==null||e.dispose(),this.effectComposer.dispose()}},Y2e=t=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${t};
const int gShadowSamples = ${t};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        vec2 halton = haltonSequence[frameIndex];
        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
        float temporalAngle  = temporalOffset * PI2;

        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,Q2e=Xi.lights_fragment_begin,Z2e=Xi.shadowmask_pars_fragment,rj=null,K2e=t=>{switch(t){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},J2e=(t="medium")=>{if(rj===t)return!1;rj=t;let e=K2e(t);Xi.shadowmap_pars_fragment=Y2e(e);let i=Q2e.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),Xi.lights_fragment_begin=i;let r=Z2e.slice();return r=r.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),Xi.shadowmask_pars_fragment=r,!0},$2e=`
attribute vec3 randomColor;
varying vec3 vNormal;
flat out vec3 vColor;
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
	
void main()
{
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
vec3 transformed = vec3(position);
#include <morphtarget_vertex>
#include <skinning_vertex>

vNormal = normal;
vColor = randomColor;
gl_Position = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
}
`,eTe=`
uniform float depthContrast;
varying vec3 vNormal;
flat in vec3 vColor;
void main()
{
vec3 normal = (normalize(vNormal)).rgb;

float contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;

vec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);
gl_FragColor = vec4(resultColor, vColor.r);
gl_FragColor = vec4(resultColor, vColor.r);
}
`,yL=new xr({vertexShader:$2e,fragmentShader:eTe,uniforms:{depthContrast:{value:1}}}),nj=new ns,sj=new Oe,tTe=class extends _q{constructor(t){super(t),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new Oe,this.dummyCamera=new Io,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=(n=!0,s=!0,a=!0)=>{let o=this.getContext(),l=0;n&&(l|=o.COLOR_BUFFER_BIT),s&&(l|=o.DEPTH_BUFFER_BIT),a&&(l|=o.STENCIL_BUFFER_BIT),o.clear(l),o.clearBufferfv(o.COLOR,1,[0,0,0,1])},this.pipeline=new X2e(this,(t==null?void 0:t.needsDOFResize)??!1),this.autoClear=!1;let e=this.setPixelRatio.bind(this),i=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=pN,this.dummyCamera.matrixAutoUpdate=!1,this.domElement.removeAttribute("data-engine");let r=this.getContext();if(r&&"drawingBufferColorSpace"in r)try{r.drawingBufferColorSpace="display-p3"}catch(n){console.warn(n)}this.setPixelRatio=n=>{this._pixelRatio!==n&&(this._pixelRatio=n,e(n))},this.setSize=(n,s,a=!0)=>{var o,l;(this.viewportWidth!==n||this.viewportHeight!==s)&&(this.viewportWidth=n,this.viewportHeight=s,i(n,s,a),(o=this.normalRenderTarget)==null||o.setSize(n*this._pixelRatio,s*this._pixelRatio),this._resizeTransmission(n,s),(l=this.transmissionDepthTarget)==null||l.setSize(n*this._pixelRatio/2,s*this._pixelRatio/2),this.pipeline.resize(n,s,a))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){this.aoRenderTarget===void 0&&(this.aoRenderTarget=new yr(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Ki,magFilter:Ki,wrapS:zn,wrapT:zn,depthBuffer:!1}))}_resizeTransmission(t,e){var i,r;(i=this.transmissionRenderTarget)==null||i.setSize(t*this._pixelRatio/(this.hdTransmission?1:2),e*this._pixelRatio/(this.hdTransmission?1:2)),(r=this.aoRenderTarget)==null||r.setSize(t*this._pixelRatio/1,e*this._pixelRatio/1)}get hdTransmission(){return wi.transmissionLod.value===1}set hdTransmission(t){wi.transmissionLod.value=t===!0?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){this.transmissionRenderTarget===void 0&&(this.transmissionRenderTarget=new yr(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:P1,magFilter:Ki,wrapS:zn,wrapT:zn,depthBuffer:!1}),this.transmissionDepthTarget=new yr(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:nr,magFilter:nr,depthBuffer:!1}))}createNormalRenderTarget(){this.normalRenderTarget===void 0&&(this.normalRenderTarget=new yr(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:nr,magFilter:nr,type:rn,depthTexture:new O1(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(t,e,i){this.normalRenderTarget&&(this.setClearColor(0),i.layers.enable(8),i.layers.disable(0),i.layers.disable(3),e.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),i instanceof Io?yL.uniforms.depthContrast.value=(i.far-i.near)/1e4:yL.uniforms.depthContrast.value=1,e.overrideMaterial=yL,this.render(e,i),this.setClearColor(e.bgColor,e.bgColor.a),this.setRenderTarget(null),e.overrideMaterial=t.wireframeState?fB:null,i.layers.enable(0),i.layers.enable(3),e.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!0)}))}renderSplineSceneWithDummyCamera(t,e,i=1){this.dummyCamera.updateCameraState(e.dataPatched),this.dummyCamera.matrix.copy(e.matrixWorld);let r=e.height,n=e.width,s=this.viewportWidth/this.viewportHeight;n<r?n=r*s:r=n/s,this.dummyCamera.setViewplaneSize(n,r);for(let a=0;a<i;a++)this.renderSplineScene(t,this.dummyCamera)}renderSplineScene(t,e,{sceneHelpers:i=this.sceneHelpers,sceneHelpersOnTop:r=this.sceneHelpersOnTop,overrideTransmission:n=void 0,overrideNormal:s=void 0}={}){var d;let a=t instanceof U4?t.activePage:t,o=a.visible;a.visible=!0;let l=a.scene;this.xr.enabled&&(this.isXRCopyPassSet===!1&&this.getRenderTarget()!==null&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(e)),this.setClearColor(a.bgColor,a.bgColor.a),a.penumbraSizeArray.forEach((p,g)=>{wi.penumbraSize.value[g]=p}),wi.pixelRatioNode.value=this.getPixelRatio(),this.resolution.x!==0&&this.resolution.y!==0?wi.resolution.value.set(this.resolution.x,this.resolution.y):wi.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),s!==void 0?(wi.normalRenderTarget.value=s,wi.normalRenderTargetDepth.value=nj):l.needsNormal()&&(this.createNormalRenderTarget(),wi.normalRenderTarget.value=this.normalRenderTarget.texture,wi.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(l,a,e));let c=a.data.ao,u=c.occlusion;if(u&&(this.createAORenderTarget(),wi.aoRenderTarget.value=this.aoRenderTarget.texture),wi.aoEnabled.value=u,this.pipeline.setAmbientOcclusionParams(c.occlusion,c.radius,c.bias,a.aoColor,a.fog!==null,a.backupFog.near,a.backupFog.far,c.aoFullRes&&!AM),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&((d=a.uiCanvas)==null?void 0:d.enabled)&&a.uiCanvas.texture&&a.uiCanvas.texture.image.width>0){let p=this.getSize(sj),g=this.getPixelRatio();(a.uiCanvas.width!==this.viewportWidth||a.uiCanvas.height!==this.viewportHeight||a.uiCanvas.dpr!==g)&&a.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight},g),a.uiCanvas.render(this),this.pipeline.uiOverlayPass.uiCanvas=a.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(p.x,p.y,g),this.pipeline.updateRenderToScreen()}else this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen();if(this.pipeline.logoOverlayPass.enabled){let p=this.getSize(sj),g=this.getPixelRatio();this.pipeline.logoOverlayPass.uniforms.uResolution.value.set(p.x,p.y),this.pipeline.logoOverlayPass.uniforms.uDPR.value=g}let h=!1;if(n!==void 0)wi.transmissionRenderTarget.value=n,wi.transmissionRenderTargetDepth.value=nj,this.pipeline.setTransmissionPassEnabled(!1);else{let p=l.needsTransmission();p&&(this.transmissionRenderTarget===void 0&&(h=!0),this.createTransmissionRenderTarget(),wi.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,wi.aspectRatio.value=jwe(this.viewportWidth,this.viewportHeight),wi.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(p)}e.layers.enable(3),e.layers.enable(8),this.pipeline.sceneHelpers=i,this.pipeline.sceneHelpersOnTop=r,this.pipeline.scene=a,this.pipeline.camera=e,h&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==a.postprocessing&&(this.pipeline.updatePostprocessing(a.postprocessing),!i&&!r&&this.pipeline.disableHelpers()),this.clearAlphaOverride!==void 0&&this.setClearAlpha(this.clearAlphaOverride),l.shapeBlendIntances.forEach(p=>{p.onBeforeShadowPass(this)}),a.overrideMaterial=l.wireframeState?fB:null,this.pipeline.render(),wi.frameIndex.value=(wi.frameIndex.value+1)%16,e instanceof Io&&e.copyHistory(),a.visible=o}renderFromSceneForSceneTransitionPass(t,e,i){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(t,e),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=i,this.sceneTransitionTimeRemaining=i,this.pipeline.renderToScreen=!0;let r=this.pipeline.sceneTransitionPass.uniforms;r.uDPR.value=window.devicePixelRatio,r.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){var t,e,i,r,n,s;this._superDispose(),this.pipeline.dispose(),(t=this.aoRenderTarget)==null||t.dispose(),(e=this.transmissionRenderTarget)==null||e.dispose(),(i=this.transmissionDepthTarget)==null||i.dispose(),(r=this.normalRenderTarget)==null||r.dispose(),(s=(n=this.normalRenderTarget)==null?void 0:n.depthTexture)==null||s.dispose()}},NQ=class extends DM(Dde){constructor(t,e=15,i=10066329){super(t,e,i),this.object=t,this.added=!1,this.name=`DirectionalLightHelper: ${t.uuid}`}raycast(t,e){PM(this.object,NQ.geometryHelper,t,e)}},FQ=class extends DM(Cde){constructor(t,e=15,i=6710886){super(t,e,i),this.object=t,this.name=`PointLightHelper: ${t.uuid}`}raycast(t,e){PM(this.object,FQ.geometryHelper,t,e)}},oB=class extends DM(Tde){constructor(t,e=6710886){super(t,e),this.object=t,this.name=`SpotLightHelper: ${t.uuid}`}raycast(t,e){PM(this.object,oB.geometryHelper,t,e)}update(){if(this.object!==void 0){let t=oB._vector,e=this.object.distance?this.object.distance:1e3,i=e*Math.tan(this.object.angle);this.cone.scale.set(i,i,e),t.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(t);let r=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let n=0,s=this.cone.material.length;n<s;n++)this.cone.material[n].color.set(r);else this.cone.material.color.set(r)}}},kQ=oB;kQ._vector=new W;var VQ=class extends gp{constructor(){super(),this.caretIndex=0,this._caretVisibleAlpha=1,this._selectionVisibleAlpha=.3,this.current={start:0,end:void 0},this.matrixAutoUpdate=!1,this.caretMesh=new bn(new jd(1,1),new Tp({transparent:!0,opacity:0,side:Oo})),this.add(this.caretMesh),this.selectionMesh=new bn(new jd(1,1),new Tp({color:2857471,transparent:!0,depthTest:!1,depthWrite:!1,opacity:0,side:Oo})),this.add(this.selectionMesh),this.hide()}get caretHeight(){var t;return((t=this.object)==null?void 0:t.AD)??0}show(t){this.visible=!0,this.object=t,this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.y=-this.caretHeight*.5,this.setCaretPosition(this.caretIndex),this.update()}hide(){this.visible=!1}update(){if(this.object===void 0)return;this.updateHelperMatrix();let{depth:t}=this.object.geometry.userData.parameters;this.caretMesh.position.z=t,this.selectionMesh.position.z=t}updateHelperMatrix(){if(this.object===void 0)return;let t=this.object,e=t.parent;e!==null&&e.updateWorldMatrix(!0,!1),t.matrixAutoUpdate&&t.updateMatrix(),e!==null?(this.matrixWorld.multiplyMatrices(e.matrixWorld,t.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,t.matrix)):this.matrixWorld.multiplyMatrices(t.hiddenMatrix,t.matrix),this.matrix.copy(this.matrixWorld);for(let i of this.children)i.matrixWorld.copy(this.matrixWorld);t.updateWorldMatrix(!0,!0)}setCaretColor(t){let e=this.caretMesh.material;e.color.setRGB(t.r,t.g,t.b);let i=this._caretVisibleAlpha===e.opacity;this._caretVisibleAlpha=t.a,i&&(e.opacity=this._caretVisibleAlpha)}setSelectionColor(t){this.selectionMesh.material.color.setRGB(t.r,t.g,t.b)}setCaretPosition(t,e={}){if(this.object===void 0)return;this.caretIndex=t;let i=this.object.wrappedText,[r,n]=xD(i,t),[s,a]=t>0?xD(i,t-1):[null,null];(t>0&&i.length?i[s].charAt(a):null)===`
`&&(r++,n=0),this.current.start=t,this.current.end=void 0;let[o,l]=xL(this.object,r,n),{AD:c,descender:u}=this.object,h=u+c*.5,{width:d,height:p,depth:g}=this.object.geometry.userData.parameters,x=typeof d=="string"?0:d,v=typeof p=="string"?0:p;this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.set(o-x*.5,l+h+v*.5,g),this.hideSelectionMesh(),this.showCaretMesh()}setSelection(t,e){if(this.object===void 0)return;let i=this.object.wrappedText;this.current.start=t,this.current.end=e;let r=[],n=[],s=iTe(i,t,e),{lineHeight:a,AD:o,descender:l}=this.object,c=l+o*.5-a*.5;for(let[v,b,w]of s)if(b!==w){let[M,E]=xL(this.object,v,b),[D,T]=xL(this.object,v,w);E+=c,T+=c,T+=a;let L=r.length/3;r.push(M,E,0),r.push(D,E,0),r.push(D,T,0),r.push(M,T,0),n.push(L+0,L+1,L+2),n.push(L+2,L+3,L+0)}let u=new ni;u.setIndex(n),u.setAttribute("position",new Wt(r,3));let{width:h,height:d,depth:p}=this.object.geometry.userData.parameters,g=typeof h=="string"?0:h,x=typeof d=="string"?0:d;this.selectionMesh.geometry.dispose(),this.selectionMesh.geometry=u,this.selectionMesh.position.x=-g*.5,this.selectionMesh.position.y=x*.5,this.selectionMesh.position.z=p,this.showSelectionMesh(),this.hideCaretMesh()}getSelectionFromPosition(t,e,i="previous"){if(this.object===void 0||this.object.font===void 0)return;let r=this.object.wrappedText,n=r.length,s=this.object.lineHeight,a=n*s,{height:o,verticalAlign:l}=this.object.geometry.userData.parameters,c=typeof o=="string"?0:o,u=0;l===3?u=c-a:l===2&&(u=c*.5-a*.5);let h=Math.min(Math.floor(Math.max(Math.min(-e-u,a),0)/s),n-1),d=this.object.charCoords[h],p=this.object.charWidths[h],g=0,x=!1;if(i==="previous"){for(let v=0;v<d.length;v++)if(d[v][0]+p[v]*.5-t>0){g=v,x=!0;break}}else if(i==="closest"){let v=1/0;for(let b=0;b<d.length;b++){let w=d[b][0]+p[b]*.5,M=Math.abs(w-t);M<v&&(v=M,g=b,x=!0)}}else for(let v=0;v<d.length;v++){let b=d[v][0],w=d[v][0]+p[v];if(t>=b&&t<w){g=v,x=!0;break}}return x||(g=d.length),{index:this.getGlobalIndexFromLineAndCharIndexes(r,h,g),lineIndex:h,characterIndex:g}}getGlobalIndexFromLineAndCharIndexes(t,e,i){return t.slice(0,e).reduce((r,n)=>r+=n.length,0)+i}showSelectionMesh(){this.selectionMesh.material.opacity=this._selectionVisibleAlpha}hideSelectionMesh(){this.selectionMesh.material.opacity=0}showCaretMesh(){this.caretMesh.material.opacity=this._caretVisibleAlpha}hideCaretMesh(){this.caretMesh.material.opacity=0}};function xL(t,e,i){let{charCoords:r,charWidths:n,initialOffsetY:s,lineHeight:a}=t;if(r[e]&&r[e].length===0||r.length===0){let u=0,{horizontalAlign:h}=t.data.geometry,d=t.wrappedText,{width:p}=t.geometry.userData.parameters;return d.length===1&&d[0].length===0&&(h===3?u=p*.5:h===2&&(u=p)),[u,s-a*e]}let o=r[e];if(o===void 0||o.length===0)return[0,0];let[l,c]=o[Math.min(i,o.length-1)];return i>=o.length&&(l+=n[e][i-1]),[l,c]}function xD(t,e){var r;let i=0;for(let n=0;n<t.length;n++){let s=t[n],a=e-i;if(a<=s.length)return[n,a];i+=s.length}return[Math.max(0,t.length-1),((r=t[t.length-1])==null?void 0:r.length)??0]}function iTe(t,e,i){let[r,n]=xD(t,e),[s,a]=xD(t,i),o=[];n>=t[r].length&&(r++,n=0);for(let l=r;l<=s;l++){let c=t[l],u=l===r?n:0,h=l===s?a:c.length;o.push([l,u,h])}return o}function rTe(t,e){let i=Ja.fromHex(3223857),r=.8;for(let n of t.layers){if(n.data.type==="light"||n.data.type==="displace"||n.data.type==="fresnel"||n.data.type==="matcap"||n.data.type==="texture"||n.data.type==="toon"||n.data.type==="outline"||n.data.type==="transmission"||n.data.type==="noise")continue;let s=typeof n.data.alpha=="string"?Number(e.getVariable(n.data.alpha)):n.data.alpha;if(n.data.type==="color"&&s>.3){i=nTe(n.data.color,e),r=s;break}else if((n.data.type==="depth"||n.data.type==="gradient")&&s>.3){let a=sTe(n.data);i={r:a[0],g:a[1],b:a[2]},r=typeof n.data.alpha=="string"?1:n.data.alpha;break}}return{...i,a:r}}function nTe(t,e){return typeof t=="string"?e.data.colors[t]:t}function sTe(t){return t.colors[0]}function aTe(t,e){t.shadow.camera.right=e/2,t.shadow.camera.left=-e/2,t.shadow.camera.top=e/2,t.shadow.camera.bottom=-e/2,t.shadow.needsUpdate=!0}var HQ=class extends A4(dde,NQ){constructor(t,e,i){super(),this.super_Entity(t,e),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.top=1250,r.bottom=-1250,r.right=1250,r.left=-1250,r.near=-1e4,r.far=2500;let n=new IC(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n}update(){this.shadow.camera.updateProjectionMatrix();for(let t in this.gizmos){let e=this.gizmos[t];e instanceof IC&&e.update()}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.objectHelper&&this.objectHelper.update()}updateState(t,e){this.updateState_Light(t,e);let i=t.depth!==void 0&&t.depth!==this.shadow.camera.far||t.size!==void 0&&t.size/2!==this.shadow.camera.right;t.size!==void 0&&aTe(this,t.size),t.shadowRadius!==void 0&&(this.shadow.radius=t.shadowRadius),t.shadowResolution!==void 0&&(this.shadow.mapSize.set(t.shadowResolution,t.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),t.penumbraSize!==void 0&&e.scene.markPenumbraSizeDirty(),i&&this.update()}},aj=new W,oj=new W,lj=new Ci,GQ=class extends A4(lde,kQ){constructor(t,e,i){super(),this.super_Entity(t,e),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=Qt.RAD2DEG*2*this.angle,r.aspect=1,r.near=100,r.far=2500;let n=new IC(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let t in this.gizmos){let e=this.gizmos[t];e instanceof IC&&e.update()}}updateMatrixWorld(t){super.updateMatrixWorld(t),oj.setFromMatrixPosition(this.matrixWorld),lj.setFromRotationMatrix(this.matrixWorld),aj.copy(this.up).applyQuaternion(lj).negate().multiplyScalar(this.distance),this.target.position.copy(oj).add(aj),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(t,e){this.updateState_Light(t,e),t.distance!==void 0&&(this.distance=t.distance),t.decay!==void 0&&(this.decay=t.decay),t.angle!==void 0&&(this.angle=t.angle),t.penumbra!==void 0&&(this.penumbra=t.penumbra),t.shadowRadius!==void 0&&(this.shadow.radius=t.shadowRadius),t.penumbraSize!==void 0&&e.scene.markPenumbraSizeDirty(),t.shadowResolution!==void 0&&(this.shadow.mapSize.set(t.shadowResolution,t.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function oTe(t){let e=(t[0][0]+t[1][1])/2,i=(t[0][0]-t[1][1])/2,r=(t[1][0]+t[0][1])/2,n=(t[1][0]-t[0][1])/2,s=Math.sqrt(e*e+n*n),a=Math.sqrt(i*i+r*r),o=s+a,l=s-a,c=Math.atan2(r,i),u=Math.atan2(n,e),h=(u-c)/2,d=(u+c)/2,p=[[Math.cos(d),Math.sin(d)],[-Math.sin(d),Math.cos(d)]],g=[[o,0],[0,l]],x=[[Math.cos(h),Math.sin(h)],[-Math.sin(h),Math.cos(h)]];return p[0][0]*=-1,p[0][1]*=-1,x[0][0]*=-1,x[1][0]*=-1,[p,g,x]}function tC(t,e){return[[t[0][0]*e[0][0]+t[0][1]*e[1][0],t[0][0]*e[0][1]+t[0][1]*e[1][1]],[t[1][0]*e[0][0]+t[1][1]*e[1][0],t[1][0]*e[0][1]+t[1][1]*e[1][1]]]}function cj(t){return[[t[0][0],t[1][0]],[t[0][1],t[1][1]]]}function lTe(t){let[e,i,r]=oTe(t),n=tC(e,cj(r)),s=tC(tC(r,i),cj(r)),a=Math.atan2(n[1][0],n[0][0]),o=[s[0][0],s[1][1]],l=[s[0][1]/s[1][1],s[1][0]/s[0][0]];return{rotation:a,scale:o,shear:l}}function cTe({rotation:t,scale:e,shear:i}){let r=Math.cos(t),n=Math.sin(t),s=[[r,-n],[n,r]],a=[[e[0],i[0]*e[1]],[i[1]*e[0],e[1]]],o=tC(s,a);return[o[0][0],o[1][0],o[0][1],o[1][1]]}var Rr;(t=>{function e(){return[1,0,0,0,1,0,0,0,1]}t.identity=e;function i(T,L=t.identity()){for(let P=0,R=T.length;P<R;P++)L[P]=T[P];return L}t.copy=i;function r(T,L,P,R,O,U){return t.setAbcdef(t.identity(),T,L,P,R,O,U)}t.create=r;function n(T,L,P,R,O,U,F){return T[0]=L,T[1]=R,T[2]=U,T[3]=P,T[4]=O,T[5]=F,T}t.setAbcdef=n;function s(T,L){let[P,R,O,U,F,V]=o(T),[k,K,X,$,Y,re]=o(L),G=k*P+K*O,j=k*R+K*U,ee=X*P+$*O,oe=X*R+$*U,Q=Y*P+re*O+F,ae=Y*R+re*U+V;return t.create(G,j,ee,oe,Q,ae)}t.append=s;function a(T,L){let[P,R,O,U,F,V]=o(T),[k,K,X,$,Y,re]=o(L),G=P,j=R,ee=O,oe=U;(k!==1||K!==0||X!==0||$!==1)&&(G=P*k+R*X,j=P*K+R*$,ee=O*k+U*X,oe=O*K+U*$);let Q=F*k+V*X+Y,ae=F*K+V*$+re;return t.create(G,j,ee,oe,Q,ae)}t.prepend=a;function o(T){return[T[0],T[3],T[1],T[4],T[2],T[5]]}t.getAbcdef=o;function l(T){let[L,P,R,O,U,F]=t.getAbcdef(T),V=L*O-P*R,k=O/V,K=-P/V,X=-R/V,$=L/V,Y=(R*F-O*U)/V,re=-(L*F-P*U)/V;return t.create(k,K,X,$,Y,re)}t.invert=l;function c([T,L],P){let[R,O,U,F,V,k]=t.getAbcdef(P);return[R*T+U*L+V,O*T+F*L+k]}t.apply=c;function u(T,L){let[P,R,O,U,F,V]=t.getAbcdef(L),k=1/(P*U+O*-R),[K,X]=T;return[U*k*K+-O*k*X+(V*O-F*U)*k,P*k*X+-R*k*K+(-V*P+F*R)*k]}t.applyInverse=u;function h(T,L,P=L){let[R,O,U,F,V,k]=t.getAbcdef(T);return t.setAbcdef(T,R*L,O*P,U*L,F*P,V*L,k*P),T}t.scale=h;function d(T,L){let P=Math.cos(L),R=Math.sin(L),[O,U,F,V,k,K]=t.getAbcdef(T);return t.setAbcdef(T,O*P-U*R,O*R+U*P,F*P-V*R,F*R+V*P,k*P-K*R,k*R+K*P),T}t.rotate=d;function p(T,L,P){let[R,O]=P,U=t.translate(T,-R,-O);return U=t.rotate(U,L),U=t.translate(U,R,O),U}t.rotateAround=p;function g(T,L,P){let[R,O,U,F,V,k]=t.getAbcdef(T);return t.setAbcdef(T,R,O,U,F,V+L,k+P),T}t.translate=g;function x(T,L,P){let[R,O,U,F]=t.getAbcdef(T);return t.setAbcdef(T,R,O,U,F,L,P),T}t.setTranslate=x;function v(T,L,P){let[R,O,U,F]=t.getAbcdef(T);return t.setAbcdef(T,R,O,U,F,L,P),T}t.setPosition=v;function b(T){let[L,P,R,O]=t.getAbcdef(T),U=Math.sqrt(L*L+P*P),F=Math.sqrt(R*R+O*O);return[U,F]}t.getScale=b;function w(T){let[,,,,L,P]=t.getAbcdef(T);return[L,P]}t.getPosition=w;function M(T,L){return t.decompose(T,L).rotation}t.getRotation=M;function E(T,L){let[P,R,O,U,F,V]=t.getAbcdef(T),{rotation:k,scale:K,shear:X}=lTe([[P,O],[R,U]]);return{position:[F+(L[0]*P+L[1]*O)-L[0],V+(L[0]*R+L[1]*U)-L[1]],scale:K,rotation:k,shear:X,pivot:L}}t.decompose=E;function D(T,L,P,R,O=[0,0]){let[U,F]=T,[V,k]=R,[K,X,$,Y]=cTe({rotation:P,scale:L,shear:O}),re=U-(V*K+k*$)+V,G=F-(V*X+k*Y)+k;return t.create(K,X,$,Y,re,G)}t.compose=D})(Rr||(Rr={}));var uTe=Math.PI/180;function hTe(t,e,i,r,n,s){let a=t-i,o=e-r;return a*a/(n*n)+o*o/(s*s)<=1}function dTe(t){return t*uTe}var za=class{constructor(t,e,i){this.uuid=t,this.data=e,this.localMatrix=Rr.identity(),this.worldMatrix=Rr.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new lB,this._recursiveBBox=new lB,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.shear=[0,0],this.emitter=Q3(),this.dpr=i.dpr??1,this.dataPatched=e}project(t,e){let i=this.worldMatrix;return e&&(i=Rr.append(e.worldMatrix,i)),Rr.applyInverse(t,i)}intersects(t,e,i,r=!1){return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([t,e],i),r)}intersectsInLocalSpace(t,e,i=!1){let{min:r,max:n}=i?this.recursiveBBox:this.singleBBox;return t>=r[0]&&t<=n[0]&&e>=r[1]&&e<=n[1]}applyTransforms(t){t.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=Rr.compose(this.position,this.scale,dTe(this.rotation),w0.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(t,e,i){let r=this.parent;e&&r!==null&&r!==void 0&&r.updateWorldMatrix(t,!0,!1),t&&this.updateLocalMatrix(),this.parent?this.worldMatrix=Rr.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=Rr.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return w0.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{t.resetBBoxNeedsUpdateSelf()})}updateTransformState(t){let e=!1;t.position!==void 0&&(e=!0,this.position=t.position),t.rotation!==void 0&&(e=!0,this.rotation=t.rotation),t.scale!==void 0&&(e=!0,this.scale=t.scale),t.shear!==void 0&&(e=!0,this.shear=t.shear),e&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(t,e,i){t.type===0&&t.props.visible!==void 0&&(this.visible=t.props.visible),this.data=e,this.data=e;let r=t,n=dn(t.path,["states","*"]);if(n!==null){if(t.type===0){let[s]=n;if((this==null?void 0:this.stateSelection)===s){let a={...t.props};if(delete a.name,Object.values(t.props).some(o=>o===void 0)){let o=this.data;if(o!==void 0){let l=ra.zoom(o,t.path.slice(2));if(l)for(let c in t.props)t.props[c]===void 0&&c in l&&(a[c]=l[c])}}r={...t,props:a,path:t.path.slice(2)}}}}else if(t.type===0){let s=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(s!==void 0){if(t.props.name!==void 0&&s.name){let{name:o,...l}=s;s=l}let a=ra.removeOverridden(t.path,t.props,s);r={...t,props:a}}}this.updateByPatchedOpBase(r,u0.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i)}changeSelectedState(t,e,i=!1){if(!(this.data.states.length===0&&!i)){for(let r of this.data.states)u0.toOps(this.data,r.data).forEach(n=>{let s=WC.replaceProps(n,this.data);this.dataPatched=this.data,this.updateByPatchedOp(s,this.data,e)});if(t!==null){let r=this.data.states.data(t);r&&(this.dataPatched=u0.patch(this.data,r),u0.toOps(this.data,r).forEach(n=>{this.updateByPatchedOp(n,this.dataPatched,e)}))}i&&this.updateTransformState(this.dataPatched),this.stateSelection=t}}updateState(t,e){t.name!==void 0&&(this.name=t.name),t.visible!==void 0&&(this.visible=t.visible),this.updateTransformState(t)}updateByPatchedOpBase(t,e,i){this.dataPatched=e,this.updateByPatchedOp(t,e,i)}updateByPatchedOp(t,e,i){t.path.length===0&&t.type===0&&this.updateState(t.props,i),this.requestRender()}traverseFrameAncestors(t){this.traverseAncestors(e=>{e.data.type==="frame2d"&&t(e)})}traverseAncestors(t){let e=this.parent;for(;e;)t(e),e=e.parent}requestRender(){this.traverseFrameAncestors(t=>{t.requestRender()})}clone(t){let e=new za(this.uuid,this.data,t);return e.parent=void 0,e}addEventListener(t,e){this.emitter.on(t,e)}removeEventListener(t,e){this.emitter.off(t,e)}dispatchEvent(t){this.emitter.emit(t.type,{...t,target:t.target??this})}traverseSortNextHelper(){let t=this.parent;if(t){let e=t.children;if(e){let i=e.indexOf(this)+1;return e[i]?e[i]:t.traverseSortNextHelper()}}}sortNext(){let t=this.children;return t&&t.length>0&&t[0]?t[0]:this.traverseSortNextHelper()}isDescendantOf(t){t instanceof za&&(t=t.uuid);let e=this;for(;e.parent;){if(e.parent.uuid===t)return!0;e=e.parent}return!1}},lh=class extends za{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.context=i,this.children=[]}add(t){t.parent&&t.parent instanceof lh&&t.parent.remove(t),this.children.push(t),t.parent=this}remove(t){let e=this.children.indexOf(t);e>=0&&(this.children.splice(e,1),t.parent=void 0)}traverse(t){let e=t(this);if(e!==!0)for(let i of this.children)i instanceof lh?i.traverse(t):e=t(i)}intersectsChildrenHelper(t,e,i,r,n){for(let s of this.children)if(s.intersects(t,e,i,!1)&&(n.push(s),r)||s instanceof lh&&s.intersectsChildrenHelper(t,e,i,r,n))return!0;return!1}intersectsChildren(t,e,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelper(t,e,i,r,n),n}intersectsChildrenHelperReverse(t,e,i,r,n){for(let s of this.children)if(s instanceof lh&&s.intersectsChildrenHelperReverse(t,e,i,r,n)||s.intersects(t,e,i,!1)&&(n.push(s),r))return!0;return!1}intersectsChildrenReverse(t,e,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelperReverse(t,e,i,r,n),n}updateWorldMatrix(t,e,i){if(super.updateWorldMatrix(t,e,i),i&&this.children)for(let r of this.children)r.updateWorldMatrix(t,!1,!0)}find(t){let e;return this.traverse(i=>{i.uuid===t&&(e=i)}),e}innerDrawChildren(t){for(let e=this.children.length-1;e>=0;e--)this.children[e].draw(t)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse(t=>{t.resetBBoxNeedsUpdateSelf()})}clone(t){let e=new lh(this.uuid,this.data,t);e.parent=void 0;for(let i of this.children)e.add(i.clone(t));return e}},Mg=class extends lh{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.updateState(e,i)}draw(t){!this.visible||(t.save(),this.applyTransforms(t),this.innerDrawChildren(t),t.restore())}clone(t){let e=new Mg(this.uuid,this.data,t);e.parent=void 0;for(let i of this.children)e.add(i.clone(t));return e}};function fTe(t,e){let[[i,r],[n,s]]=t,[[a,o],[l,c]]=e,u=(i-n)*(o-c)-(r-s)*(a-l);if(u===0)return!1;let h=((i-a)*(o-c)-(r-o)*(a-l))/u,d=-((i-n)*(r-o)-(r-s)*(i-a))/u;return h>=0&&h<=1&&d>=0&&d<=1}var jQ=[[-1,1],[-1,-1],[1,-1],[1,1]],uj=(t,e,i)=>{let r=t.getCenter(),n=t.getHalfSize(),s=Rr.append(e,t.worldMatrix);n[0]===0&&n[1]===0?i.push(Rr.apply(r,s)):jQ.forEach(a=>{let o=[a[0]*n[0]+r[0],a[1]*n[1]+r[1]];i.push(Rr.apply(o,s))})},lB=class{constructor(){this.matrix=Rr.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(t,e=!1){t.updateWorldMatrix(),this.makeEmpty(),Rr.copy(t.worldMatrix,this.matrix);let i=Rr.invert(t.worldMatrix);this.expandByObjectSize(t,i,e)}expandByObjectSize(t,e,i=!1){let r=[];i===!0&&t instanceof lh?t.traverse(n=>{n.visible&&uj(n,e,r)}):uj(t,e,r),this.setFromPoints(r)}setFromSize(t,e,i){this.makeEmpty(),Rr.copy(i,this.matrix),this.expandBySize(t,e,i)}expandBySize(t,e,i){[Rr.apply([0,0],i),Rr.apply([0,e],i),Rr.apply([t,e],i),Rr.apply([t,0],i)].forEach(r=>this.expandByPoint(r))}getCenter(){let[t,e]=this.min,[i,r]=this.getHalfSize();return Rr.apply([t+i,e+r],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[(this.max[0]-this.min[0])*.5,(this.max[1]-this.min[1])*.5]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(t){this.makeEmpty();for(let e of t)this.expandByPoint(e)}expandByPoint(t){this.min=[Math.min(this.min[0],t[0]),Math.min(this.min[1],t[1])],this.max=[Math.max(this.max[0],t[0]),Math.max(this.max[1],t[1])]}computeVertices(){let[t,e]=this.getHalfSize(),i=this.getCenter(),[r,n,s,a]=Rr.getAbcdef(this.matrix),o=Rr.create(r,n,s,a,i[0],i[1]);this.vertices=jQ.map(([l,c])=>Rr.apply([l*t,c*e],o))}computeEdges(){this.edges=[];for(let t=0,e=this.vertices.length;t<e;++t)this.edges.push([this.vertices[t],this.vertices[(t+1)%e]])}project(t,e){let i=this.matrix;return e&&(i=Rr.append(e.worldMatrix,i)),Rr.applyInverse(t,i)}intersects(t,e,i){return this.intersectsInLocalSpace(...this.project([t,e],i))}intersectsInLocalSpace(t,e){let{min:i,max:r}=this;return t>=i[0]&&t<=r[0]&&e>=i[1]&&e<=r[1]}containsPoint(t){let[e,i]=t,[r,n]=this.min,[s,a]=this.max;return e>=r&&e<=s&&i>=n&&i<=a}intersectsBBox2D(t){for(let e=0,i=this.edges.length;e<i;e++){let r=this.edges[e];for(let n=0,s=t.edges.length;n<s;n++){let a=t.edges[n];if(fTe(r,a))return!0}}for(let e=0,i=t.vertices.length;e<i;e++){let r=t.vertices[e];if(this.containsPoint(r))return!0}return!1}ensureMinMax(){let t=this.min,e=this.max;this.min=[Math.min(t[0],e[0]),Math.min(t[1],e[1])],this.max=[Math.max(t[0],e[0]),Math.max(t[1],e[1])]}copy(t){this.min=[...t.min],this.max=[...t.max],Rr.copy(t.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let t=new lB;return t.copy(this),t}},WQ,pTe=new Promise(t=>{WQ=t}),hj=!1,R2;function mTe(){if(hj)return;if(R2)return R2;async function t(){let e=await Cg(()=>import("./ui-Ds7EeOeb.js"),[]);WQ(e.default??e),hj=!0}return R2=t(),R2}function dj(t){let e=!1;return t.scene.objects.traverse((i,r)=>{(r.type==="Mesh"&&r.geometry.type==="UIGeometry"||r.type==="Page"&&r.uiFrame!==void 0)&&(e=!0)}),e}var Bi,bL;async function gTe(t){let e=await pTe;Bi||(bL||(bL=e({locateFile:()=>t})),Bi=await bL)}var fj=Rr.identity(),qQ=class{constructor(t,e=1){this.canvas=t,this._dpr=e,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=sn.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=sn.transparent,this._fonts=new Map,this._isSizeDirty=!1;try{let i=t.getBoundingClientRect();t.width=i.width*e,t.height=i.height*e}catch{console.log(t.width,e)}this._currentM3Transform=fj,this._currentTransform=new Float32Array(fj)}get dpr(){return this._dpr}set dpr(t){this._dpr=t,this._isSizeDirty=!0}async init(){var t,e;if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");await gTe(this.wasmURL),this._surface=Bi.MakeWebGLCanvasSurface(this.canvas),this.ctx=(t=this._surface)==null?void 0:t.getCanvas(),this._paint=new Bi.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(Bi.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(Bi.PaintStyle.Stroke),(e=this.ctx)==null||e.scale(this.dpr,this.dpr)}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(t){this._currentM3Transform=t,this._currentTransform.set(t)}async loadFont(t,e){let i=await(await fetch(t)).arrayBuffer();this.registerFont(i,e)}registerFont(t,e){if(this._fonts.has(e))return;let i=Bi.FontMgr.FromData(t);if(i)this._fonts.set(e,i);else throw new Error("Invalid font data for "+e)}get width(){return this._width}get height(){return this._height}set strokeColor(t){this._paintStroke&&this._paintStroke.setColor(O2(t),Bi.ColorSpace.DISPLAY_P3)}set fillColor(t){this._paintFill&&this._paintFill.setColor(O2(t),Bi.ColorSpace.DISPLAY_P3)}set lineWidth(t){this._paintStroke&&this._paintStroke.setStrokeWidth(this._strokeMode==="center"?t:t*2)}set strokeMode(t){this._strokeMode=t}set dropShadowBlur(t){this._dropShadowBlur=t}set dropShadowColor(t){this._dropShadowColor=t}set dropShadowOffsetX(t){this._dropShadowOffsetX=t}set dropShadowOffsetY(t){this._dropShadowOffsetY=t}set innerShadowBlur(t){this._innerShadowBlur=t}set innerShadowColor(t){this._innerShadowColor=t}set innerShadowOffsetX(t){this._innerShadowOffsetX=t}set innerShadowOffsetY(t){this._innerShadowOffsetY=t}set innerShadowSpread(t){this._innerShadowSpread=t}set layerBlur(t){this._layerBlur=t}set backgroundBlur(t){this._backgroundBlur=t}clear(){var t;(t=this.ctx)==null||t.clear(Bi.TRANSPARENT)}save(){var t;(t=this.ctx)==null||t.save()}restore(){var t;(t=this.ctx)==null||t.restore()}beginPath(){var t;(t=this._currentPath)==null||t.delete(),this._currentPath=new Bi.Path}closePath(){let t=this._currentPath;if(t){if(t.isEmpty())return;let e=t.getBounds();(e[3]-e[1]||e[2]-e[0])&&t.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(t,e,i,r,n=0,s=0,a=0,o=0){var c,u;let l=Bi.XYWHRect(t,e,i,r);if(n===0&&s===0&&o===0&&a===0)(c=this.ctx)==null||c.clipRect(l,Bi.ClipOp.Intersect,!0);else{let h=Bi.RRectXY(l,n,n);h[4]=h[5]=n,h[6]=h[7]=s,h[8]=h[9]=a,h[10]=h[11]=o,(u=this.ctx)==null||u.clipRRect(h,Bi.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let t=Rr.invert(this.currentTransform);this.ctx.concat(t);let e=Rr.translate(Rr.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(e),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(t,e,i=!0){var r,n,s,a;if(this.ctx&&this._currentPath){let o,l=!1;if(i&&this._hasDropShadow()){let c=t.copy();c.setColor(O2(this._dropShadowColor));let u;this._dropShadowBlur>0&&(u=Bi.MaskFilter.MakeBlur(Bi.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(((r=this.camera)==null?void 0:r.scale)??1),!1),c.setMaskFilter(u)),this.ctx.save(),this.ctx.clipPath(this._currentPath,Bi.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),e(c),this.ctx.restore(),c.delete(),u==null||u.delete()}if(this._backgroundBlur>0&&i){this.ctx.save(),this.ctx.clipPath(this._currentPath,Bi.ClipOp.Intersect,!0);let c=Bi.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,Bi.TileMode.Clamp,null),u=t.copy();u.setImageFilter(c),u.setAlphaf(1);let h=this._currentPath.computeTightBounds();this.ctx.saveLayer(u,h,null,Bi.SaveLayerInitWithPrevious),this.ctx.drawColor(t.getColor()),this.ctx.restore(),this.ctx.restore(),u.delete(),c.delete(),l=!0}if(this._layerBlur>0){let c=t.copy();o=Bi.MaskFilter.MakeBlur(Bi.BlurStyle.Normal,this._layerBlur*this.dpr*(((n=this.camera)==null?void 0:n.scale)??1),!1),c.setMaskFilter(o),e(c),c.delete(),o.delete(),l=!0}if(l||e(t),i&&this._hasInnerShadow()){let c=new Bi.Paint;c.setAntiAlias(!0),c.setStyle(Bi.PaintStyle.Fill),c.setColor(O2(this._innerShadowColor));let u;this._innerShadowBlur>0&&(u=Bi.MaskFilter.MakeBlur(Bi.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(((s=this.camera)==null?void 0:s.scale)??1),!1),c.setMaskFilter(u));let h=this._currentPath.computeTightBounds(),[d,p,g,x]=h,v=g-d,b=x-p;this.ctx.save(),this.ctx.clipPath(this._currentPath,Bi.ClipOp.Intersect,!0),this.ctx.saveLayer(c,h,null,Bi.SaveLayerInitWithPrevious),(a=this.ctx)==null||a.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(Bi.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+v+Math.abs(this._innerShadowOffsetX*2),2e3+b+Math.abs(this._innerShadowOffsetY*2)),c),c.setBlendMode(Bi.BlendMode.Clear),this.ctx.drawPath(this._currentPath,c),this.ctx.restore(),this.ctx.restore(),c.delete(),u==null||u.delete()}}}_paintInner(t,e=!0){if(this.ctx&&this._currentPath&&t){let i=this.ctx,r=this._currentPath;this._applyEffectsToPaint(t,n=>{let s=!1;!e&&this._strokeMode!=="center"&&(i.save(),i.clipPath(r,this._strokeMode==="outside"?Bi.ClipOp.Difference:Bi.ClipOp.Intersect,!0),s=!0),i.drawPath(r,n),s&&i.restore()},e)}}_hasDropShadow(){var t;return((t=this._dropShadowColor)==null?void 0:t.a)>0}_hasInnerShadow(){var t;return((t=this._innerShadowColor)==null?void 0:t.a)>0}path(t){var e;(e=this._currentPath)==null||e.addPath(Bi.Path.MakeFromSVGString(t))}ellipse(t,e,i,r,n,s,a,o){var c;if(!pj([t,e,i,r])||!this._currentPath)return;if(i<0||r<0)throw Error("radii cannot be negative");let l=Bi.XYWHRect(t-i,e-r,i*2,r*2);(c=this._currentPath)==null||c.addOval(l)}rect(t,e,i,r,n=0,s=0,a=0,o=0){var c,u;let l=Bi.XYWHRect(t,e,i,r);if(pj(l))if(n===0&&s===0&&o===0&&a===0)(c=this._currentPath)==null||c.addRect(l);else{let h=Bi.RRectXY(l,n,n);h[4]=h[5]=n,h[6]=h[7]=s,h[8]=h[9]=a,h[10]=h[11]=o,(u=this._currentPath)==null||u.addRRect(h)}}getHorizontalAlign(t){switch(t){case 2:return Bi.TextAlign.Right;case 3:return Bi.TextAlign.Center;case 4:return Bi.TextAlign.Justify;case 1:default:return Bi.TextAlign.Left}}drawTextInner(t,e,i,[r,n,s,a],o,l,c=!0){let u=0,{ctx:h}=this;if(!h)return u;let d=l.copy(),p=l.copy();return p.setAlphaf(0),this._applyEffectsToPaint(d,g=>{e.pushPaintStyle(i,g,p),e.addText(t);let x=e.build();x.layout(s);let v=n;o===2?v+=(a-x.getHeight())/2:o===3&&(v+=a-x.getHeight()),h.drawParagraph(x,r,v),u=x.getHeight(),e.reset(),x.delete()},c),d.delete(),p.delete(),u}drawText(t,e){let i=0,r=this._fonts.get(e.font),{ctx:n,_paintFill:s,_paintStroke:a}=this;if(r&&n){let o=new Bi.TextStyle({fontFamilies:[e.font],fontSize:e.fontSize,heightMultiplier:e.lineHeight,letterSpacing:e.letterSpacing}),l=new Bi.ParagraphStyle({textStyle:o,textAlign:this.getHorizontalAlign(e.horizontalAlign)}),c=Bi.XYWHRect(e.x,e.y,e.width,e.height),u=Bi.ParagraphBuilder.Make(l,r);s&&(i=this.drawTextInner(t,u,o,c,e.verticalAlign,s,!0)),a&&(i=this.drawTextInner(t,u,o,c,e.verticalAlign,a,!1)),u.delete()}return{height:i}}render(){var t;(t=this._surface)==null||t.flush()}moveTo(t,e){var i;(i=this._currentPath)==null||i.moveTo(t,e)}lineTo(t,e){var i;(i=this._currentPath)==null||i.lineTo(t,e)}bezierCurveTo(t,e,i,r,n,s){var a;(a=this._currentPath)==null||a.cubicTo(t,e,i,r,n,s)}quadraticCurveTo(t,e,i,r){var n;(n=this._currentPath)==null||n.quadTo(t,e,i,r)}setTransform(t,e=!1){var n,s,a,o,l;if(!this.ctx)return;let i=this.ctx.getTotalMatrix(),r=Rr.invert(i);if(r&&this.ctx.concat(r),(n=this.ctx)==null||n.scale(this.dpr,this.dpr),((s=this.camera)==null?void 0:s.enabled)&&((a=this.ctx)==null||a.concat(this.camera.worldMatrix),e)){let c=Rr.getScale(this.camera.worldMatrix);(o=this.ctx)==null||o.scale(1/c[0],1/c[1])}(l=this.ctx)==null||l.concat(t),this.currentTransform=t}transform(t){var e;(e=this.ctx)==null||e.concat(t)}setSize(t,e){var i;!this._isSizeDirty&&t===this._width&&e===this._height||(this._isSizeDirty=!1,this._width=t,this._height=e,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.canvas.width=t*this.dpr,this.canvas.height=e*this.dpr,this._surface&&(this._surface=Bi.MakeWebGLCanvasSurface(this.canvas),this.ctx=(i=this._surface)==null?void 0:i.getCanvas()))}};function pj(t){for(let e=0;e<t.length;e++)if(t[e]!==void 0&&!Number.isFinite(t[e]))return!1;return!0}function O2({r:t,g:e,b:i,a:r}){return Bi.Color4f(t,e,i,r)}var mj=class{constructor(t,e,i){this.uuid=t,this.data=e,this.enabled=!1,this.color=sn.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(e)}update(t){t.color!==void 0&&(this.color=t.color),t.enabled!==void 0&&(this.enabled=t.enabled),t.blurRadius!==void 0&&(this.blurRadius=t.blurRadius),t.offset!==void 0&&(this.offset=t.offset),t.spread!==void 0&&(this.spread=t.spread)}},gj=class{constructor(t,e,i){this.uuid=t,this.data=e,this.enabled=!1,this.radius=0,this.update(e)}update(t){t.enabled!==void 0&&(this.enabled=t.enabled),t.radius!==void 0&&(this.radius=t.radius)}},vTe=class{constructor(t,e,i){this.uuid=t,this.data=e,this.enabled=!1,this.color=sn.transparent,this.update(e)}update(t){t.enabled!==void 0&&(this.enabled=t.enabled),t.color!==void 0&&(this.color=t.color)}},yTe=class{constructor(t,e,i){this.uuid=t,this.data=e,this.enabled=!1,this.color=sn.transparent,this.thickness=0,this.mode="inside",this.update(e)}update(t){t.enabled!==void 0&&(this.enabled=t.enabled),t.color!==void 0&&(this.color=t.color),t.thickness!==void 0&&(this.thickness=t.thickness),t.mode!==void 0&&(this.mode=t.mode)}},Da=class extends za{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.autoClose=!0,this.fill=new vTe(t+"-fill",e.fill,i),this.stroke=new yTe(t+"-stroke",e.stroke,i),this.dropShadow=new mj(t+"-dropShadow",e.dropShadow,i),this.innerShadow=new mj(t+"-innerShadow",e.innerShadow,i),this.backgroundBlur=new gj(t+"-backgroundBlur",e.backgroundBlur,i),this.layerBlur=new gj(t+"-layerBlur",e.layerBlur,i)}applyFillStroke(t){t.fillColor=this.fill.enabled?this.fill.color:sn.transparent,t.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:sn.transparent,t.strokeMode=this.stroke.mode,t.lineWidth=this.stroke.thickness}applyFilters(t){this.layerBlur.enabled?t.layerBlur=this.layerBlur.radius*5:t.layerBlur=0,this.backgroundBlur.enabled?t.backgroundBlur=this.backgroundBlur.radius*5:t.backgroundBlur=0,this.dropShadow.enabled?(t.dropShadowBlur=this.dropShadow.blurRadius*5,t.dropShadowColor=this.dropShadow.color,t.dropShadowOffsetX=this.dropShadow.offset[0],t.dropShadowOffsetY=this.dropShadow.offset[1]):t.dropShadowColor=sn.transparent,this.innerShadow.enabled?(t.innerShadowSpread=this.innerShadow.spread,t.innerShadowBlur=this.innerShadow.blurRadius*5,t.innerShadowColor=this.innerShadow.color,t.innerShadowOffsetX=this.innerShadow.offset[0],t.innerShadowOffsetY=this.innerShadow.offset[1]):t.innerShadowColor=sn.transparent}innerDraw(t){}draw(t){!this.visible||(t.save(),this.applyTransforms(t),this.applyFilters(t),this.applyFillStroke(t),t.beginPath(),this.innerDraw(t),this.autoClose&&t.closePath(),this.fill.enabled&&t.fill(),this.stroke.enabled&&t.stroke(),t.restore())}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),t.type===0&&(dn(t.path,["fill"])?this.fill.update(t.props):dn(t.path,["stroke"])?this.stroke.update(t.props):dn(t.path,["dropShadow"])?this.dropShadow.update(t.props):dn(t.path,["innerShadow"])?this.innerShadow.update(t.props):dn(t.path,["layerBlur"])?this.layerBlur.update(t.props):dn(t.path,["backgroundBlur"])?this.backgroundBlur.update(t.props):this.resetBBoxNeedsUpdate())}updateState(t,e){super.updateState(t,e),t.fill!==void 0&&this.fill.update(t.fill),t.stroke!==void 0&&this.stroke.update(t.stroke),t.dropShadow!==void 0&&this.dropShadow.update(t.dropShadow),t.innerShadow!==void 0&&this.innerShadow.update(t.innerShadow),t.layerBlur!==void 0&&this.layerBlur.update(t.layerBlur),t.backgroundBlur!==void 0&&this.backgroundBlur.update(t.backgroundBlur)}clone(t){let e=new Da(this.uuid,this.data,t);return e.parent=void 0,e}},D4=class extends Da{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.width=0,this.height=0,this.updateState(e,i)}innerDraw(t){t.ellipse(this.width*.5,this.height*.5,this.width*.5,this.height*.5,0,0,Math.PI*2)}intersectsInLocalSpace(t,e){return hTe(t,e,this.width*.5,this.height*.5,this.width*.5,this.height*.5)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(t){let e=!1;t.width!==void 0&&(this.width=typeof t.width=="number"?t.width:this.width,e=!0),t.height!==void 0&&(this.height=typeof t.height=="number"?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateState(t,e){super.updateState(t,e),this.updateSizeState(t)}clone(t){let e=new D4(this.uuid,this.data,t);return e.parent=void 0,e}},LM=class extends Da{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(e,i)}innerDraw(t){t.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(t){t.cornerRadius!==void 0&&(this.cornerRadius=t.cornerRadius)}updateSizeState(t){let e=!1;t.width!==void 0&&(this.width=typeof t.width=="number"?t.width:this.width,e=!0),t.height!==void 0&&(this.height=typeof t.height=="number"?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateState(t,e){super.updateState(t,e),this.updateSizeState(t),this.updateCornerState(t)}clone(t){let e=new LM(this.uuid,this.data,t);return e.parent=void 0,e}},P4=class extends Da{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(e,i)}get textHeight(){return this._textHeight}applyFillStroke(t){t.fillColor=this.fill.enabled?this.fill.color:sn.transparent,t.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:sn.transparent,t.strokeMode="center",t.lineWidth=this.stroke.thickness}innerDraw(t){var s;(s=this._fontHolder)!=null&&s.arrayBuffer&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&t.registerFont(this._fontHolder.arrayBuffer,this.data.font);let e=this.data.textTransform,i=this.data.text.textValue.toString(),r=e===2?i.toUpperCase():e===3?i.toLowerCase():i,{height:n}=t.drawText(r,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:this.data.lineHeight??1,letterSpacing:this.data.letterSpacing??0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=n}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(t){let e=!1;t.width!==void 0&&(this.width=typeof t.width=="number"?t.width:this.width,e=!0),t.height!==void 0&&(this.height=typeof t.height=="number"?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(t,{shared:e}){t.font!==void 0&&(this._fontHolder=e.getFont(t.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then(()=>{this.requestRender()}))}updateState(t,e){super.updateState(t,e),this.updateSizeState(t),this.updateFontState(t,e)}clone(t){let e=new P4(this.uuid,this.data,t);return e.parent=void 0,e}},XQ=class extends Da{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState(e,i)}computeExtremas(){this.curves.length===0&&this.computeCurves();let t=this.curves.map(r=>bD.extremas(r)),e=[1/0,1/0],i=[-1/0,-1/0];for(let r=0,n=t.length;r<n;r++){let s=t[r];s[0][0]<e[0]&&(e[0]=s[0][0]),s[0][1]<e[1]&&(e[1]=s[0][1]),s[1][0]>i[0]&&(i[0]=s[1][0]),s[1][1]>i[1]&&(i[1]=s[1][1])}return this.extremasBBox.min=[e[0],e[1]],this.extremasBBox.max=[i[0],i[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let i=1,r=this.data.points.length;i<r;i++){let n=this.data.points[i].data,s=this.data.points[i-1].data,a={start:s.position,cp1:s.controlNext.position,cp2:n.controlPrevious.position,end:n.position};this.curves.push(a)}let t=this.data.points[0].data,e=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let i={start:e.position,cp1:e.controlNext.position,cp2:t.controlPrevious.position,end:t.position};this.curves.push(i)}}getCenter(){let[t,e]=this.extremasBBox.min,[i,r]=this.getHalfSize();return[t+i,e+r]}getHalfSize(){let{min:t,max:e}=this.extremasBBox;return[(e[0]-t[0])*.5,(e[1]-t[1])*.5]}innerDraw(t){for(let r=0,n=this.data.points.length;r<n;r++){let s=this.data.points[r].data;if(r===0){let[a,o]=s.position;t.moveTo(a,o)}else{let a=this.data.points[r-1].data,[o,l]=a.controlNext.position,[c,u]=s.controlPrevious.position,[h,d]=s.position,p={start:a.position,cp1:a.controlNext.position,cp2:s.controlPrevious.position,end:s.position};bD.derive(p),t.bezierCurveTo(o,l,c,u,h,d)}}let e=this.data.points[0].data,i=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[r,n]=i.controlNext.position,[s,a]=e.controlPrevious.position,[o,l]=e.position;t.bezierCurveTo(r,n,s,a,o,l)}}updateState(t,e){super.updateState(t,e),this.computeExtremas()}clone(t){let e=new XQ(this.uuid,this.data,t);return e.parent=void 0,e}},bD;(t=>{function e(a){let o=a.start,l=a.cp1,c=a.cp2,u=a.end,h=[3*(l[0]-o[0]),3*(l[1]-o[1])],d=[3*(c[0]-l[0]),3*(c[1]-l[1])],p=[3*(u[0]-c[0]),3*(u[1]-c[1])],g={start:h,cp:d,end:p};return a.derivative=g,g.derivative=cB.derive(g),g}t.derive=e;function i(a,o,l,c=!1){let u=a-2*o+l;if(u!==0){let h=-Math.sqrt(Math.abs(o*o-a*l)),d=-a+o,p=-(h+d)/u,g=-(-h+d)/u;return[p,g]}else if(o!==l&&u===0)return[(2*o-l)/(2*(o-l))];return[]}function r(a){let o=a.derivative??t.derive(a),l=o.start,c=o.cp,u=o.end;return[i(l[0],c[0],u[0]),i(l[1],c[1],u[1])]}t.droot=r;function n(a){let[o,l]=t.droot(a),c=[a.start[0],a.end[0]],u=[a.start[1],a.end[1]];for(let h of o)c.push(t.compute(a,Math.min(1,Math.max(0,h)))[0]);for(let h of l)u.push(t.compute(a,Math.min(1,Math.max(0,h)))[1]);return c.sort((h,d)=>h-d),u.sort((h,d)=>h-d),[[c[0],u[0]],[c[c.length-1],u[u.length-1]]]}t.extremas=n;function s(a,o){if(o===0)return[...a.start];if(o===1)return[...a.end];let l=1-o,c=l*l,u=o*o,h=c*l,d=c*o*3,p=l*u*3,g=o*u;return[h*a.start[0]+d*a.cp1[0]+p*a.cp2[0]+g*a.end[0],h*a.start[1]+d*a.cp1[1]+p*a.cp2[1]+g*a.end[1]]}t.compute=s})(bD||(bD={}));var cB;(t=>{function e(n){let s=n.start,a=n.cp,o=n.end,l=[2*(a[0]-s[0]),2*(a[1]-s[1])],c=[2*(o[0]-a[0]),2*(o[1]-a[1])],u={start:l,end:c};return u.derivative=uB.derive(u),n.derivative=u,u}t.derive=e;function i(n){let s=n.derivative??t.derive(n),a=s.start,o=s.end;return[a[0]!==o[0]?a[0]/(a[0]-o[0]):0,a[1]!==o[1]?a[1]/(a[1]-o[1]):0]}t.droot=i;function r(n,s){if(s===0)return[...n.start];if(s===1)return[...n.end];let a=1-s,o=a*a,l=s*s,c=o,u=a*s*2,h=l;return[c*n.start[0]+u*n.cp[0]+h*n.end[0],c*n.start[1]+u*n.cp[1]+h*n.end[1]]}t.compute=r})(cB||(cB={}));var uB;(t=>{function e(r){let n=r.start,s=r.end,a=[s[0]-n[0],s[1]-n[1]];return r.derivative=a,r.derivative}t.derive=e;function i(r,n){if(n===0)return[...r.start];if(n===1)return[...r.end];let s=r.start,a=r.end;return[s[0]+(a[0]-s[0])*n,s[1]+(a[1]-s[1])*n]}t.compute=i})(uB||(uB={}));var Nd=class extends lh{constructor(t,e,i){super(t,e,i),this.uuid=t,this.width=0,this.height=0,this.clipped=!0,this.background=new LM(t+"-background",Fw.defaultData,i),this.background.parent=this,this.updateState(e,i)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(t){this.background.cornerRadius=t}updateLocalMatrix(){var t;super.updateLocalMatrix(),(t=this.background)==null||t.updateLocalMatrix()}updateWorldMatrix(t,e,i){var r;super.updateWorldMatrix(t,e,i),(r=this.background)==null||r.updateWorldMatrix(t,e,i)}draw(t){if(!this.visible)return;t.save();let e=this.width,i=this.height;this.applyTransforms(t),this.background.width=e,this.background.height=i,this.background.draw(t),this.clipped&&t.clipRect(0,0,e,i,...this.cornerRadius),this.innerDrawChildren(t),t.restore()}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(t){t.cornerRadius!==void 0&&(this.cornerRadius=t.cornerRadius)}updateSizeState(t){let e=!1;t.width!==void 0&&(this.width=typeof t.width=="number"?t.width:this.width,e=!0),t.height!==void 0&&(this.height=typeof t.height=="number"?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateState(t,e){super.updateState(t,e),this.updateSizeState(t),this.updateCornerState(t),t.fill!==void 0&&this.fill.update(t.fill),t.stroke!==void 0&&this.stroke.update(t.stroke),t.dropShadow!==void 0&&this.dropShadow.update(t.dropShadow),t.innerShadow!==void 0&&this.innerShadow.update(t.innerShadow),t.layerBlur!==void 0&&this.layerBlur.update(t.layerBlur),t.backgroundBlur!==void 0&&this.backgroundBlur.update(t.backgroundBlur),t.clipped!==void 0&&(this.clipped=t.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),t.type===0&&(dn(t.path,["fill"])?this.fill.update(t.props):dn(t.path,["stroke"])?this.stroke.update(t.props):dn(t.path,["dropShadow"])?this.dropShadow.update(t.props):dn(t.path,["innerShadow"])?this.innerShadow.update(t.props):dn(t.path,["layerBlur"])?this.layerBlur.update(t.props):dn(t.path,["backgroundBlur"])?this.backgroundBlur.update(t.props):this.resetBBoxNeedsUpdate())}clone(t){let e=new Nd(this.uuid,this.data,t);e.parent=void 0;for(let i of this.children)e.add(i.clone(t));return e}},xTe=Dg(Z7(),1),$3=class extends Da{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this._pathBBox=new DOMRect,this.path="",this.updateState(e,i),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(t),e.setAttribute("d",this.path),t.appendChild(e),this._pathBBox=e.getBBox(),t.remove()}innerDraw(t){t.path(this.path)}intersectsInLocalSpace(t,e){return t>=this._pathBBox.x&&t<=this._pathBBox.x+this._pathBBox.width&&e>=this._pathBBox.y&&e<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(t,e){super.updateState(t,e),t.path!==void 0&&(this.path=t.path,this.computeSVGBBox())}clone(t){let e=new $3(this.uuid,this.data,t);return e.parent=void 0,e}};function bTe(t,e=1,i=1){if(e<=0||i<=0)return t;let r=(0,xTe.parseSVG)(t).map(n=>{let s={...n};return"x"in s&&(s.x=s.x*e),"y"in s&&(s.y=s.y*i),"x1"in s&&(s.x1=s.x1*e),"x2"in s&&(s.x2=s.x2*e),"y1"in s&&(s.y1=s.y1*i),"y2"in s&&(s.y2=s.y2*i),"rx"in s&&(s.rx=s.rx*e),"ry"in s&&(s.ry=s.ry*i),s});return _Te(r)}function _Te(t){let e=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"],i;return t.map(r=>{let n=[];e.forEach(a=>{if(a in r){let o=r[a]*1;n.length&&o>=0&&n.push(","),n.push(o)}});let s=(i===r.code?n[0]<0?"":",":r.code)+n.join("");return i=r.code,s}).join("")}function STe(t,e,i){switch(e.type){case"ellipse2d":return new D4(t,e,i);case"rectangle2d":return new LM(t,e,i);case"text2d":return new P4(t,e,i);case"vector2d":return new XQ(t,e,i);case"path2d":return new $3(t,e,i);case"frame2d":return new Nd(t,e,i);case"group2d":default:return new Mg(t,e,i)}}var YQ=class{constructor(t,e,i){this.uuid=t,this.data=e,this.group=new Mg(YQ.GROUP_ID,{...uD.defaultData},i),this.createChildrenObjects(e.objects,this.group,i)}createObject(t,e,i,r,n,s){let a=STe(t,e,s);a&&(r.add(a),r.children.splice(n,0,r.children.pop()),a.updateWorldMatrix(),i.length>0&&(a instanceof Mg||a instanceof Nd)&&this.createChildrenObjects(i,a,s))}createChildrenObjects(t,e,i){let r=0;for(let n of t)this.createObject(n.id,n.data,n.children,e,r,i),r+=1}draw(t){this.group.draw(t)}updateEntityByOp(t,e,i,r){let n=this.find(t);if(n)try{n.updateByOp(e,i,{shared:r})}catch(s){console.error(s)}}updateTreeByOp(t,e){if(t.path.length===0&&t.type===7){let i=t.parent===null?this.group:this.find(t.parent);i!==void 0&&i instanceof lh&&(this.createObject(t.id,t.data,t.children,i,t.localIndex,e),i.requestRender())}else if(t.path.length===0&&t.type===8){let i=this.find(t.id);if(i!==void 0&&i.parent!==void 0&&i.parent instanceof lh){let r=i.parent;i.resetBBoxNeedsUpdate(),r==null||r.remove(i),r==null||r.requestRender()}}else if(t.path.length===0&&t.type===9){let i=this.find(t.id);if(i!==void 0){let r=i.parent,n=t.parent===null?this:this.find(t.parent);if(n instanceof lh||n===this){n.add(i);let s=t.localIndex;n.children.splice(s,0,n.children.pop()),i.updateWorldMatrix(!0,!1,!0),r==null||r.requestRender(),i.requestRender()}i.resetBBoxNeedsUpdate()}}}add(t){this.group.add(t)}remove(t){this.group.remove(t)}traverse(t){this.group.traverse(e=>{e!==this.group&&t(e)})}intersectsChildren(t,e,i,r=!1,n=[]){return this.group.intersectsChildren(t,e,i,r,n,!0)}intersectsChildrenReverse(t,e,i,r=!1,n=[]){return this.group.intersectsChildrenReverse(t,e,i,r,n,!0)}find(t){return this.group.find(t)}get children(){return this.group.children}project(t,e){return this.group.project(t,e)}getWithSortKey(t){let e=this.find(t);if(e===void 0)return;let i=[],r=e;for(;r!==this.group;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:e,sortKey:i}}getAllSorted(t){let e=[];for(let i of t){let r=this.getWithSortKey(i.id);r!==void 0&&e.push(r)}return e.sort((i,r)=>CX(i.sortKey,r.sortKey)),e.map(i=>i.entity)}},R4=YQ;R4.GROUP_ID="scene2d";function QQ({constraints:t,newParentWidth:e,newParentHeight:i,initialParentWidth:r,initialParentHeight:n,objectInitialWidth:s,objectInitialHeight:a,objectInitialPosition:o}){let{horizontalConstraint:l,verticalConstraint:c}=t,u=e-r,h=i-n,d=s,p=a,g=o[0],x=o[1];if(l!==0){if(l===1)g+=u;else if(l===3)g+=u/2;else if(l===2)d=Math.max(1,d+u);else if(l===4){let v=e/r;d*=v,g*=v}}if(c!==0){if(c===1)x+=h;else if(c===3)x+=h/2;else if(c===2)p=Math.max(1,p+h);else if(c===4){let v=i/n;p*=v,x*=v}}return{width:d,height:p,position:[g,x]}}Dg(Z7(),1);var wTe=`
	varying vec2 vUv;
	void main() {
		vUv = uv;
		gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
	}`,MTe=`
	uniform sampler2D tDiffuse;
	varying vec2 vUv;
	void main() {
		vec4 texel = texture2D( tDiffuse, vUv );
		gl_FragColor = texel;
	}`,ETe=new R3(-1,1,1,-1,0,1),ATe=class extends ni{constructor(){super(),this.setAttribute("position",new Wt([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Wt([0,2,0,0,2,0],2))}},TTe=new ATe,CTe=class{constructor(t){this._mesh=new bn(TTe,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,ETe)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}},ZQ=new xr({defines:{},uniforms:{tDiffuse:new At(null)},vertexShader:wTe,fragmentShader:MTe}),DTe=new CTe(ZQ),_L=null,SL=null,PTe=()=>(_L===null&&(_L=document.createElement("canvas")),_L),RTe=t=>(SL===null&&(SL=new qQ(t)),SL),OTe=Rr.identity(),KQ=class{constructor(t,e,i,r){this.uuid=t,this.width=e,this.height=i,this.context=r,this.enabled=!0,this.isScreenSpace=!1,this.dpr=window.devicePixelRatio,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this._innerApplySize=()=>{let n=this.width,s=this.height,a=this.dpr;this.renderer.dpr=this.isScreenSpace?a:Math.floor(2048/Math.max(n,s)),this.renderer.setSize(n,s)},this.onFrameOverrideObjectEvent=n=>{var s,a;if(((s=n.target)==null?void 0:s.uuid)!==void 0){let o=(a=this.frameRoot)==null?void 0:a.find(n.target.uuid);o&&o.dispatchEvent({...n,target:o})}},this.scene2d=new R4(Qt.generateUUID(),LU.defaultData,{dpr:window.devicePixelRatio,shared:r.shared}),this.canvas=PTe(),this.renderer=RTe(this.canvas),this.promise=this.init(),this.renderTarget=new yr(1,1,{type:Ap,stencilBuffer:!1,depthBuffer:!1}),r.shared.addUIBuffer(this.uuid,this.renderTarget),this.textureHolder=r.shared.uiBuffer(this.uuid)}get canvasTexture(){return this._canvasTexture||(this._canvasTexture=new bhe(this.canvas)),this._canvasTexture}async init(){this.renderer instanceof qQ&&(this.renderer.wasmURL=bQ.skiaWasmUrl),await this.renderer.init()}render(t){var e,i;if(this.isFrameDirty){this.isFrameDirty=!1,this._innerApplySize(),this.renderer.clear(),(e=this.frameOverride)==null||e.draw(this.renderer),this.renderer.render(),ZQ.uniforms.tDiffuse.value=this.canvasTexture,this.canvasTexture.needsUpdate=!0;let r=t.getRenderTarget();t.setRenderTarget(this.renderTarget),t.clear(),DTe.render(t),t.setRenderTarget(r),(i=this.textureHolder)==null||i.setNeedsUpdate(!0)}}updateEntity2DByOp(t,e,i,r){this.scene2d.updateEntityByOp(t,e,i,r),this.applySize()}updateTreeByOp(t,e){this.scene2d.updateTreeByOp(t,e),this.applySize()}applyOverrides(t){if(this.frameOverride&&this.frameRoot){this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let e=(t==null?void 0:t.width)??this.width,i=(t==null?void 0:t.height)??this.height;this.frameOverride.width=e,this.frameOverride.height=i,this.frameOverride.localMatrix=OTe,this.isScreenSpace&&(this.frameOverride.fill.color=sn.from0to1([0,0,0,0])),this.frameOverride.data={...this.frameOverride.data,width:e,height:i},JQ({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(t,e=window.devicePixelRatio){var o,l;let i=Math.max(1,(t==null?void 0:t.width)??this.width),r=Math.max(1,(t==null?void 0:t.height)??this.height);this.dpr=e,this.width=i,this.height=r,this._innerApplySize();let n=1,s=512,a=512;(i*e<s||r*e<a)&&(n=Math.max(s/(i*e),a/(r*e))),this.renderTarget.setSize(i*e*n,r*e*n),(o=this._canvasTexture)==null||o.dispose(),this._canvasTexture=void 0,this.applyOverrides(t),(l=this.frameOverride)==null||l.requestRender()}applyFrame(t){var i,r;let e=this.context.scene.find2D(t);if(!(!e||!(e instanceof Nd)))return this.disposeFrameOverride(),this.frameRoot=e,this.frameOverride=e.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),(i=this.frame)==null||i.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse(n=>{n.addEventListener("beginState",this.onFrameOverrideObjectEvent)}),this.frameOverride.traverse(n=>{n.addEventListener("completeState",this.onFrameOverrideObjectEvent)}),(r=this.frame)==null||r.requestRender(),e}get frame(){return this.frameOverride}get frameId(){var t;return(t=this.frame)==null?void 0:t.uuid}find(t){return this.scene2d.find(t)}get texture(){var t;return(t=this.textureHolder)==null?void 0:t.getTexture(1001)}disposeFrameOverride(){var t,e,i;(t=this.frameOverride)==null||t.removeEventListener("render",this.onRenderRequestedDownstream),(e=this.frameOverride)==null||e.traverse(r=>{r.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)}),(i=this.frameOverride)==null||i.traverse(r=>{r.removeEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function JQ({objectOverride:t,objectRoot:e,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){if(t instanceof Nd&&e instanceof Nd||t instanceof Mg&&e instanceof Mg)for(let a=0,o=t.children.length;a<o;a++){let l=t.children[a],c=e.children[a];l&&c&&l.uuid===c.uuid&&ITe({objectOverride:l,objectRoot:c,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s})}}function LTe(t){if(hB(t))return[t.width,t.height];if(t instanceof $3){let[e,i]=t.getHalfSize();return[e*2,i*2]}else if(t instanceof Mg){let[e,i]=t.recursiveBBox.getHalfSize();return[e*2,i*2]}return[0,0]}function ITe({objectOverride:t,objectRoot:e,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){let[a,o]=LTe(e),{width:l,height:c,position:u}=QQ({constraints:t.data,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s,objectInitialWidth:a,objectInitialHeight:o,objectInitialPosition:e.position});if(t.position=u,t.data={...t.data,position:u},t.states)for(let h in t.states)zTe({stateId:h,objectOverride:t,objectRoot:e,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s});if(hB(t)||t instanceof Mg)hB(t)&&(t.width=l,t.height=c,t.data={...t.data,width:l,height:c}),JQ({objectOverride:t,objectRoot:e,newParentWidth:l,newParentHeight:c,initialParentWidth:a,initialParentHeight:o});else if(t instanceof $3){let h=e,d=a!==0?l/a:1,p=o!==0?c/o:1;t.path=bTe(h.path,d,p),t.data={...t.data,path:t.path}}}function zTe({stateId:t,objectOverride:e,objectRoot:i,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a}){var c,u;let o=(c=e.states)==null?void 0:c[t],l=(u=i.states)==null?void 0:u[t];if(o&&l){let{width:h,height:d,position:p}=QQ({constraints:e.data,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a,objectInitialWidth:w0.isResizeable(l)?l.width:0,objectInitialHeight:w0.isResizeable(l)?l.height:0,objectInitialPosition:l.position});Object.assign(e.states[t],{position:p}),w0.isResizeable(o)&&Object.assign(e.states[t],{width:h,height:d})}}function hB(t){return t instanceof LM||t instanceof Nd||t instanceof D4||t instanceof P4}var Ca=class extends o4(ql){constructor(t,e,i){super(),this.data=e,this.bgColor=new ro(1,1,1,1),this.fog=null,this.backupFog=new Sq(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new bi,this.penumbraSizeArrayCache=null,this.super_Entity(t,e),this.personalCamera=new Io(yb,{...Uw.defaultData,...e.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new ade(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),e.uiScene?this.uiScene=new R4((Array.isArray(t)?t[0]:t)+"-ui",e.uiScene,{dpr:window.devicePixelRatio,shared:i.shared}):e.uiFrame&&this.createUICanvas(e.uiFrame,i)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){var t;return(t=this.uiCanvas)==null?void 0:t.frame}createUICanvas(t,e){this.uiCanvas=new KQ(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,e),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then(()=>{var i,r;(i=this.uiCanvas)==null||i.applyFrame(t),(r=this.uiCanvas)==null||r.applySize()})}updateVisible(){}setBackgroundColor(t){this.bgColor=t,this.fogUseBGColor===!0&&(this.backupFog.color=t)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(t,e){t.color!==void 0&&(this.ambientLight.color=ol(t.color,e)),t.intensity!==void 0&&(this.ambientLight.intensity=t.intensity),t.enabled!==void 0&&(t.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(t){this.isActive=!0,t.fog=this.fog,this.traverseEntity(e=>{e instanceof N0&&e.recomputeBoolean()}),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(t=>{if(t instanceof _b)if(Array.isArray(t.material))for(let e of t.material)e.needsUpdate=!0;else t.material.needsUpdate=!0,t.material.dispose()})}updateShadow(t){t.softShadowQuality!==void 0&&this.isActive&&J2e(t.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(t,e){if(t.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){let i=this.scene;i.fog=this.fog}this.fogUseBGColor=t.useBackgroundColor,t.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=ol(t.color,e),this.backupFog.near=t.near,this.backupFog.far=t.far}updateAo(t,e){t.aoColor!==void 0&&(this.aoColor=ol(t.aoColor,e))}updateByOp(t,e,i,r){let n=this.data.uiFrame;super.updateByOp(t,e,i,r);let s=e;dn(t.path,["fog"])?this.updateFog(s.fog,i.shared):dn(t.path,["ao"])?this.updateAo(s.ao,i.shared):dn(t.path,["ambient"])?this.updateAmbientLight(s.ambient,i.shared):dn(t.path,["shadow"])?this.updateShadow(s.shadow):t.type===0&&t.path.length===0&&(t.props.uiFrame!==void 0||n!==s.uiFrame)&&this.updateUIFrame(t.props.uiFrame,i)}updateUIFrame(t,e){t?(this.uiCanvas||this.createUICanvas(t,e),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(t)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(t,e){this.updateState_Entity(t,e),t.backgroundColor!==void 0&&this.setBackgroundColor(ol(t.backgroundColor,e.shared)),t.fog!==void 0&&this.updateFog(t.fog,e.shared),t.ambient!==void 0&&this.updateAmbientLight(t.ambient,e.shared),t.ao!==void 0&&this.updateAo(t.ao,e.shared),t.shadow!==void 0&&this.updateShadow(t.shadow)}createFrame(t,e){}raycast(t,e){super.raycast(t,e)}switchActiveCamera(t){t&&t.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=t,t.objectHelper.visible=!1)}get playCamera(){var t;return((t=this.scene)==null?void 0:t.find(this.data.publish.playCamera))??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return this.penumbraSizeArrayCache===null&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let t=0,e=0;this.traverseEntity(i=>{if(!i.visible)return!0;i instanceof HQ&&i.visible&&t<3&&(this.penumbraSizeArrayCache[t]=i.data.penumbraSize??.5,t+=1),i instanceof GQ&&i.visible&&t<2&&(this.penumbraSizeArrayCache[3+e]=i.data.penumbraSize??.5,e+=1)})}raycastWithClones(t){let e=[],i=r=>{for(let n of r.children){let s=n.cloner;gr.is(n)&&(n.visible||s!=null&&s.object.data.visible)&&((oh(n)||tB(n)&&this.scene.enableHelpers&&n.objectHelper.visible)&&(t.intersectObject(n,!1,e),dB(n,t,e,!0)),i(n))}};return i(this),e}updateEntity2DByOp(t,e,i,r){var n;(n=this.uiCanvas)==null||n.updateEntity2DByOp(t,e,i,r)}},UTe=class extends A4(ude,FQ){constructor(t,e,i){super(),this.super_Entity(t,e),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=90,r.aspect=1,r.near=100,r.far=2500;let n=new W(-r.far+this.position.x,-r.far+this.position.y,-r.far+this.position.z),s=new W(r.far+this.position.x,r.far+this.position.y,r.far+this.position.z),a=new Os(n,s),o=new zC(a,new bi(16755200));o.visible=!1,this.gizmos.shadowmap=o,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let t in this.gizmos){let e=this.gizmos[t];if(e instanceof zC){let i=this.shadow.camera,r=new W(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),n=new W(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);e.box.set(r,n),e.updateMatrixWorld(!0)}}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.objectHelper&&this.objectHelper.update()}updateState(t,e){this.updateState_Light(t,e),t.distance!==void 0&&(this.distance=t.distance),t.decay!==void 0&&(this.decay=t.decay),t.shadowRadius!==void 0&&(this.shadow.radius=t.shadowRadius),t.shadowResolution!==void 0&&(this.shadow.mapSize.set(t.shadowResolution,t.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},BTe=class extends Gs{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(t,e){let i=this.geometry.getAttribute("position");i!==void 0?m4(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,t,e):super.updateEntityBoxSize(t,e)}},O4=class extends Gs{constructor(t,e,i){super(t,e,i),this._shapeId=null,this._context=i}updateState(t,e){super.updateState(t,e),this.updateShape(),this.refreshAttachedCloners(e)}updateShape(){var r;let t={...this.data.geometry.extrusion.shape};for(let n in t)typeof t[n]=="string"&&(t[n]=this._context.shared.getVariable(t[n],[this.uuid,"geometry","extrusion","shape",n]));let e;if(t.type==="Custom"){let n=t.shapeId;if(n!==this._shapeId&&this.detachShape(),n){this._shapeId=n;let s=this._context.scene.find(n);s!=null&&s.data&&(s.attachedPaths.add(this),e=(r=s.geometry.userData)==null?void 0:r.shape),e||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let n;switch(t.type){case"Rectangle":n=p4;break;case"Ellipse":n=f4;break;case"Polygon":n=UY;break;case"Star":n=BY;break;default:throw new Error(`Unknown shape type: ${t.type}`)}e=n.create({parameters:t}).userData.shape}let i=this.geometry;e&&i.inputs&&(i.inputs.shapeData=e,i.build())}detachShape(){var t;this._shapeId!==null&&((t=this._context.scene.find(this._shapeId))==null||t.attachedPaths.delete(this))}createGeometryDelayed(t){this.geometryCreateDeleyed=t.shared,this.updateShape(),this.refreshAttachedPaths(t)}updateTransformState(t,e){return super.updateTransformState(t,e)}updateGeometryInteractions(t,e){super.updateGeometryInteractions(t,e),this.updateShape()}updateEntityBoxSize(t,e){let i=this.geometry.getAttribute("position");i!==void 0?m4(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,t,e):super.updateEntityBoxSize(t,e)}},L4=class extends E4{constructor(t,e,i){super(t,e,i),this.data=e}},M1=class extends Sb(gp,RM){constructor(t,e,i){super(),e.type==="Instance"&&typeof t=="string"&&(e=this.transformAssignData(e,i)),this.super_Entity(t,e),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(t,e){let i=aD.getComponentData({scene:e.scene.data,shared:e.shared.data},t.component);if(i){let r,n;for(let s of og.rootOverrideProps)t[s]===void 0?(r===void 0&&(r={...t}),r[s]=i.data[s]):(n===void 0&&(n={}),n[s]=t[s],r===void 0&&(r={...t}),r[s]=pg.apply(i.data[s],t[s]));return this.overrideData=n,r}else return{...na.defaultData,...t,...Ud(na.defaultData,og.rootOverrideProps)}}updateByOp(t,e,i,r){let n;if(this.isInstanceRoot&&!r){if(e=this.transformAssignData(e,i),t.type===0&&t.path.length===0&&this.component)for(let s of og.rootOverrideProps)s in t.props&&t.props[s]===void 0&&(n===void 0&&(n={...t,props:{...t.props}}),n.props[s]=this.component.data[s]);else if(t.type===0&&t.path.length>0&&og.rootOverrideProps.includes(t.path[0])){let s=t.path[0];n===void 0&&(n={...t,path:[],props:{[s]:e[s]}})}}super.updateByOp(n??t,e,i,r)}updateState(t,e){this.updateState_Entity(t,e)}expandInstanceChildren(t){let e=this.data;if(this.component===void 0){let i=t.scene.find(e.component)??null,r=!1;if(i!==this.oldComponent){if(this.oldComponent){let n=0;for(let s of this.children)if(gr.is(s))t.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),I4(s),n+=1;else break;this.children.splice(0,n)}r=!0}if(i){let n={};$Q(t,[this.uuid],e.overrides,this,i,i,0,r,n);for(let s of this.children)if(gr.is(s)){let a=s.data;a.type==="Empty"&&a.animations&&s.traverseEntity(o=>{let l=o.dataPatched;if(o instanceof Gs&&l.bones&&l.boneInverses){let c=o.dataPatched;if(c.bones&&c.boneInverses){let u=c.bones.map(p=>t.scene.find(n[p])),h=c.boneInverses.map(p=>new Ot().fromArray(p)),d=new SN(u,h);o.bind(d,o.bindMatrix)}}else o.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function I4(t){if(t.component){let e=t.component.instances.indexOf(t);e>=0&&t.component.instances.splice(e,1);for(let i of t.children)gr.is(i)&&I4(i)}}function vj(t,e,i,r){return t.component===e&&YN(t.identity,r)?t.overrideData===i?2:1:0}function $Q(t,e,i,r,n,s,a,o,l){if(a>50)return!1;if(r.component!==n){if(r.component){let u=r.component.instances.indexOf(r);u>=0&&r.component.instances.splice(u,1)}n.instances.find(u=>u===r)||n.instances.push(r),r.component=n}n instanceof M1&&n.isInstanceRoot&&n.expandInstanceChildren(t);let c=0;for(let u of n.children)if(gr.is(u)){let h=[...e,...typeof u.identity=="string"?[u.identity]:u.identity],d=iD.resolve(i,h,1);d!=null&&!(d instanceof Ws)&&(Object.setPrototypeOf(d,Ws.prototype),console.error("wrong prototype"));let p=null,g;if(!o){let x=r.children[c];if(p=gr.is(x)?x:null,p!==null){let v=vj(p,u,d,h);g=v>=1?p.stateSelection:void 0,v!==2&&(p=null)}if(p===null&&(p=t.scene.findInstance(h)??null,p!==null)){let v=vj(p,u,d,h);if(g=v>=1?p.stateSelection:void 0,v!==2)p=null;else{let b=p.parent.children.indexOf(p);p.parent.children.splice(b,1),r.children.splice(c,0,p),p.parent===r?b<=c&&console.error("not possible"):(p.parent=r,p.matrixWorldNeedsUpdate=!0,p.resetBBoxNeedsUpdate(),p.updateVisible(),t.pendingDeletes.delete(p))}}}if(p===null){let x=d?pg.apply(u.data,d):u.data;z0.is(x.type)&&(x={...x,type:"Empty"}),p=cg.createEntity(h,x,t),p.overrideData=d,r.add(p),r.children.splice(r.children.length-1,1),r.children.splice(c,0,p),p.updateState(p.data,t),g&&p.changeSelectedState(g,t),t.scene.registerInstanceAndSetUuid(p)}if(p.isBone){let x=p.identity[p.identity.length-1];l[x]=p.uuid}c+=1,$Q(t,e,i,p,u,s,a+1,o,l)}if(!o){let u=c;for(;;){let h=r.children[c];if(gr.is(h))t.pendingDeletes.add(h);else break;c+=1}r.children.splice(u,c-u)}return!0}var NTe=class extends Sb(wq,RM){constructor(t,e){super(),this.super_Entity(t,e),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(t,e){this.updateState_Entity(t,e)}},Ro=class extends Gs{constructor(t,e,i){super(t,e,i),this.onBeforeRender=r=>{this.uiCanvas.render(r)},this.uiCanvas=new KQ(t+"-canvas",e.geometry.width,e.geometry.height,i),this.uiCanvas.promise.then(()=>{this.applyFrame(this.dataPatched.geometry.frame,i.shared)})}updateByPatchedOpGeometry(t,e,i){super.updateByPatchedOpGeometry(t,e,i),t.type===0&&(t.props.frame!==void 0&&this.applyFrame(t.props.frame,i.shared),(t.props.width!==void 0||t.props.height!==void 0)&&this.applySize(t.props,i.shared))}applySize(t,e){let i=(t==null?void 0:t.width)??this.dataPatched.geometry.width,r=(t==null?void 0:t.height)??this.dataPatched.geometry.height;this.uiCanvas.applySize({width:i,height:r}),this.applyGeometryParametersFromFrame(e)}applyFrame(t,e){this.uiCanvas.applyFrame(t),this.applyGeometryParametersFromFrame(e),this.applyMaterialParametersFromFrame({shared:e})}applyGeometryParametersFromFrame(t){var i;let e=this.frame;e&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:e.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:e.cornerRadius,cornerType:0})}),(i=this.localGeometry)==null||i.dispose(),this.localGeometry=Gw(this.dataPatched.geometry,t,this.data.flatShading,this))}applyMaterialParametersFromFrame(t){let e=this.frame;if(e){let i=e.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),this.material.reset(this.dataPatched.material,t,!0)}}updateEntity2DByOp(t,e,i,r){this.uiCanvas.updateEntity2DByOp(t,e,i,r),t===this.frameId&&e.type===0&&(e.props.cornerRadius!==void 0?this.applyGeometryParametersFromFrame(r):dn(e.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:r}))}get frame(){return this.uiCanvas.frame}get frameId(){var t;return(t=this.frame)==null?void 0:t.uuid}removeInteractionGeometry(t){super.removeInteractionGeometry(t),this.applySize({},t)}updateGeometryInteractions(t,e){super.updateGeometryInteractions(t,e),this.applySize({width:t.width,height:t.height},e)}},FTe=class{constructor(t,e,i){this.variables=[],this.currentTextureIndex=0;let r=rn,n=new ql,s=new Pg;s.position.z=1;let a={passThruTexture:{value:null}},o=u(d(),a),l=new bn(new jd(2,2),o);n.add(l),this.setDataType=function(p){return r=p,this},this.addVariable=function(p,g,x){let v=this.createShaderMaterial(g),b={name:p,initialValueTexture:x,material:v,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:nr,magFilter:nr};return this.variables.push(b),b},this.setVariableDependencies=function(p,g){p.dependencies=g},this.init=function(){if(i.capabilities.isWebGL2===!1&&i.extensions.has("OES_texture_float")===!1)return"No OES_texture_float support for float textures.";if(i.capabilities.maxVertexTextures===0)return"No support for vertex shader textures.";for(let p=0;p<this.variables.length;p++){let g=this.variables[p];g.renderTargets[0]=this.createRenderTarget(t,e,g.wrapS,g.wrapT,g.minFilter,g.magFilter),g.renderTargets[1]=this.createRenderTarget(t,e,g.wrapS,g.wrapT,g.minFilter,g.magFilter),this.renderTexture(g.initialValueTexture,g.renderTargets[0]),this.renderTexture(g.initialValueTexture,g.renderTargets[1]);let x=g.material,v=x.uniforms;if(g.dependencies!==null)for(let b=0;b<g.dependencies.length;b++){let w=g.dependencies[b];if(w.name!==g.name){let M=!1;for(let E=0;E<this.variables.length;E++)if(w.name===this.variables[E].name){M=!0;break}if(!M)return"Variable dependency not found. Variable="+g.name+", dependency="+w.name}v[w.name]={value:null},x.fragmentShader=`
uniform sampler2D `+w.name+`;
`+x.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let p=this.currentTextureIndex,g=this.currentTextureIndex===0?1:0;for(let x=0,v=this.variables.length;x<v;x++){let b=this.variables[x];if(b.dependencies!==null){let w=b.material.uniforms;for(let M=0,E=b.dependencies.length;M<E;M++){let D=b.dependencies[M];w[D.name].value=D.renderTargets[p].texture}}this.doRenderTarget(b.material,b.renderTargets[g])}this.currentTextureIndex=g},this.getCurrentRenderTarget=function(p){return p.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(p){return p.renderTargets[this.currentTextureIndex===0?1:0]},this.dispose=function(){l.geometry.dispose(),l.material.dispose();let p=this.variables;for(let g=0;g<p.length;g++){let x=p[g];x.initialValueTexture&&x.initialValueTexture.dispose();let v=x.renderTargets;for(let b=0;b<v.length;b++)v[b].dispose()}};function c(p){p.defines.resolution="vec2( "+t.toFixed(1)+", "+e.toFixed(1)+" )"}this.addResolutionDefine=c;function u(p,g){g=g||{};let x=new xr({uniforms:g,vertexShader:h(),fragmentShader:p});return c(x),x}this.createShaderMaterial=u,this.createRenderTarget=function(p,g,x,v,b,w){return p=p||t,g=g||e,x=x||zn,v=v||zn,b=b||nr,w=w||nr,new yr(p,g,{wrapS:x,wrapT:v,minFilter:b,magFilter:w,format:kn,type:r,depthBuffer:!1})},this.createTexture=function(){let p=new Float32Array(t*e*4),g=new al(p,t,e,kn,rn);return g.needsUpdate=!0,g},this.renderTexture=function(p,g){a.passThruTexture.value=p,this.doRenderTarget(o,g),a.passThruTexture.value=null},this.doRenderTarget=function(p,g){let x=i.getRenderTarget(),v=i.xr.enabled,b=i.shadowMap.autoUpdate,w=i.outputEncoding,M=i.toneMapping;i.xr.enabled=!1,i.shadowMap.autoUpdate=!1,i.outputEncoding=vh,i.toneMapping=zd,l.material=p,i.setRenderTarget(g),i.render(n,s),l.material=o,i.xr.enabled=v,i.shadowMap.autoUpdate=b,i.outputEncoding=w,i.toneMapping=M,i.setRenderTarget(x)};function h(){return`void main()	{

	gl_Position = vec4( position, 1.0 );

}
`}function d(){return`uniform sampler2D passThruTexture;

void main() {

	vec2 uv = gl_FragCoord.xy / resolution.xy;

	gl_FragColor = texture2D( passThruTexture, uv );

}
`}}},qa=new $a,L2=new W,kTe=class{constructor(t){let e=t.geometry;if(!e.isBufferGeometry||e.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");e.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),e=e.toNonIndexed()),this.geometry=e,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(t){return this.weightAttribute=t?this.geometry.getAttribute(t):null,this}build(){let t=this.positionAttribute,e=this.weightAttribute,i=new Float32Array(t.count/3);for(let n=0;n<t.count;n+=3){let s=1;e&&(s=e.getX(n)+e.getX(n+1)+e.getX(n+2)),qa.a.fromBufferAttribute(t,n),qa.b.fromBufferAttribute(t,n+1),qa.c.fromBufferAttribute(t,n+2),s*=qa.getArea(),i[n/3]=s}this.distribution=new Float32Array(t.count/3);let r=0;for(let n=0;n<i.length;n++)r+=i[n],this.distribution[n]=r;return this}setRandomGenerator(t){return this.randomFunction=t,this}sample(t,e,i){let r=this.distribution[this.distribution.length-1],n=this.binarySearch(this.randomFunction()*r);return this.sampleFace(n,t,e,i)}binarySearch(t){let e=this.distribution,i=0,r=e.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||e[s-1]<=t&&e[s]>t){n=s;break}else t<e[s]?r=s-1:i=s+1}return n}sampleFace(t,e,i,r){let n=this.randomFunction(),s=this.randomFunction();return n+s>1&&(n=1-n,s=1-s),qa.a.fromBufferAttribute(this.positionAttribute,t*3),qa.b.fromBufferAttribute(this.positionAttribute,t*3+1),qa.c.fromBufferAttribute(this.positionAttribute,t*3+2),e.set(0,0,0).addScaledVector(qa.a,n).addScaledVector(qa.b,s).addScaledVector(qa.c,1-(n+s)),i!==void 0&&qa.getNormal(i),r!==void 0&&this.colorAttribute!==void 0&&(qa.a.fromBufferAttribute(this.colorAttribute,t*3),qa.b.fromBufferAttribute(this.colorAttribute,t*3+1),qa.c.fromBufferAttribute(this.colorAttribute,t*3+2),L2.set(0,0,0).addScaledVector(qa.a,n).addScaledVector(qa.b,s).addScaledVector(qa.c,1-(n+s)),r.r=L2.x,r.g=L2.y,r.b=L2.z),this}};function VTe(t){let e=new Float32Array(t*t*2);for(let i=0;i<t;i++)for(let r=0;r<t;r++){let n=i*t+r;e[n*2+0]=i/(t-1),e[n*2+1]=r/(t-1)}return e}function HTe(t){let e=Math.ceil(Math.sqrt(t));return Math.max(e,1)}function GTe(t,e){let i=new bn(t.geometry,t.material),r=[],n=[],s=new W,a=new W;i.geometry.index!==null&&(i.geometry=i.geometry.toNonIndexed());let o=new kTe(i).build();for(let u=0;u<e;u++)o.sample(s,a),r.push(s.x,s.y,s.z),n.push(a.x,a.y,a.z);let l=new Float32Array(r),c=new Float32Array(n);return{positions:l,normals:c}}function yj(t,e){let i=t,r=new Float32Array(4*e*e);for(let s=0;s<e*e;s++)r[4*s]=i[3*s],r[4*s+1]=i[3*s+1],r[4*s+2]=i[3*s+2],r[4*s+3]=0;let n=new al(r,e,e,kn,rn);return n.needsUpdate=!0,n}function jTe({size:t}){let e=new Float32Array(4*t*t);for(let r=0;r<t*t;r++)e[4*r]=r,e[4*r+1]=0,e[4*r+2]=0,e[4*r+3]=0;let i=new al(e,t,t,kn,rn);return i.needsUpdate=!0,i}function WTe(t){let e=new Float32Array(4*t*t);for(let r=0;r<t*t;r++)e[4*r]=0,e[4*r+1]=0,e[4*r+2]=0,e[4*r+3]=0;let i=new al(e,t,t,kn,rn);return i.needsUpdate=!0,i}var qTe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform float uTime;
uniform float uSpeed;     // update speed of the particles
uniform vec3 uWorldOffset;    
uniform vec4 uWorldQuaternion;
uniform float uMaxLifeTime;
uniform vec3 uEmitterSize;
uniform float uFPSRatio;     // 1  for 60 FPS

float random (vec2 st) {
    return fract(sin(dot(st.xy,
        vec2(12.9898,78.233)))*
        43758.5453123);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
    vec3 acceleration = force / mass;
    
    return acceleration;
  }
  

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted
    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided
    float lifeTime = uMaxLifeTime;

    // Calculate the position adjustment based on collision
    //     if (collisionFlag > .5) {  
    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0
    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise
    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);

    // Update position based on collision or normal movement
    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);
    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);

    // EMISSION RATE - BIRTH
    // if (isSpawning == 1.0) {
    // Better Approach to avoid If statement
    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;
    originalPosition = mix(originalPosition, newPosition, isSpawning);
    position = mix(position, originalPosition, isSpawning);;
    timeStart = mix(timeStart, uTime, isSpawning);

    // Calculate timeLeft for life normalization
    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);
    float life_Normalize = timeLeft / lifeTime;

    // Use isActive to blend between the calculated color and black
    vec4 activeColor = vec4(position, life_Normalize);
    // if (isActive == 1.0) {
    gl_FragColor = mix(vec4(0.0), activeColor, isActive);

}
`,XTe=`

    vec3 mod289(vec3 x) {
      return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 mod289(vec4 x) {
    return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 permute(vec4 x) {
        return mod289(((x*34.0)+1.0)*x);
    }
    
    vec4 taylorInvSqrt(vec4 r)
    {
    return 1.79284291400159 - 0.85373472095314 * r;
    }
    
    vec3 fade(vec3 t) {
  return t*t*t*(t*(t*6.0-15.0)+10.0);
}

    float snoise(vec3 v)
    {
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );
    vec3 x1 = x0 - i1 + C.xxx;
    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y
    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y
    
    // Permutations
    i = mod289(i);
    vec4 p = permute( permute( permute(
                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
    
    // Gradients: 7x7 points over a square, mapped onto an octahedron.
    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)
    float n_ = 0.142857142857; // 1.0/7.0
    vec3  ns = n_ * D.wyz - D.xzx;
    
    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)
    
    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
    
    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);
    
    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );
    
    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));
    
    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
    
    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);
    
    //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;
    
    // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
    }
    
    vec3 snoiseVec3( vec3 x ){
    
      float s  = snoise(vec3( x ));
      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));
      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));
      vec3 c = vec3( s , s1 , s2 );
      return c;
    
    }
    
      
    vec3 curlNoise( vec3 p, float seed){
      p += seed;
      const float e = .1;
      vec3 dx = vec3( e   , 0.0 , 0.0 );
      vec3 dy = vec3( 0.0 , e   , 0.0 );
      vec3 dz = vec3( 0.0 , 0.0 , e   );
    
      vec3 p_x0 = snoiseVec3( p - dx );
      vec3 p_x1 = snoiseVec3( p + dx );
      vec3 p_y0 = snoiseVec3( p - dy );
      vec3 p_y1 = snoiseVec3( p + dy );
      vec3 p_z0 = snoiseVec3( p - dz );
      vec3 p_z1 = snoiseVec3( p + dz );
    
      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;
      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;
      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;
    
      const float divisor = 1.0 / ( 2.0 * e );
      return normalize( vec3( x , y , z ) * divisor );
    
    }


// Classic Perlin noise
float cnoise(vec3 P)
{
  vec3 Pi0 = floor(P); // Integer part for indexing
  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1
  Pi0 = mod289(Pi0);
  Pi1 = mod289(Pi1);
  vec3 Pf0 = fract(P); // Fractional part for interpolation
  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;

  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);

  vec4 gx0 = ixy0 * (1.0 / 7.0);
  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);

  vec4 gx1 = ixy1 * (1.0 / 7.0);
  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);

  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);

  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
  g000 *= norm0.x;
  g010 *= norm0.y;
  g100 *= norm0.z;
  g110 *= norm0.w;
  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
  g001 *= norm1.x;
  g011 *= norm1.y;
  g101 *= norm1.z;
  g111 *= norm1.w;

  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
  float n111 = dot(g111, Pf1);

  vec3 fade_xyz = fade(Pf0);
  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
  return 2.2 * n_xyz;
}


vec3 fbm_vec3(vec3 p, float frequency, float offset)
{
  return vec3(
    cnoise((p+vec3(offset))*frequency),
    cnoise((p+vec3(offset+20.0))*frequency),
    cnoise((p+vec3(offset-30.0))*frequency)
  );
}

`,YTe=`
  #ifdef USE_COLLIDER
    float restitution = max(uBounce * 2., .01); // Energy Loss
    // SPHERE COLLIDER
    // **************************************************************
    #ifdef USE_SPHERE_COLLIDER       
      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
      vec3 radii = uColliderSize;
      // Adjust position relative to collider
      vec3 relPos = position - uColliderPos;
      // Apply rotation of the collider to the relative position
      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
      // Scale relative position by radii (for ellipsoid collision detection)
      vec3 scaledPos = relPos / radii;
      // Calculate ellipsoidal distance
      float dist = length(scaledPos); // Distance in terms of ellipsoid
      
      // Check for collision
      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {
          // Compute the normal at the collision point, accounting for particle size
        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          
        // Compute the normal at the collision point
        vec3 normal = ellipsoidNormal(adjustedPos, radii);
        // Rotate the normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);
        // Reflect the velocity vector off the normal
        velocity = reflect(velocity, normal) * restitution;

        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif

    // BOX COLLIDER or PLANE COLLIDER 
    // **************************************************************
    #ifdef USE_BOX_COLLIDER
      // Box dimensions and repulsion variables
      vec3 boxHalfSize = uColliderSize / 2.0;
      // Convert world position to box's local space
      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
      // Collision detection
      vec3 localDistance = abs(localPos) - boxHalfSize;
      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    

      // Collision Detected
      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      
        // Find the nearest face normal for bounce direction
        vec3 normal;
        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {
            normal = vec3(sign(localPos.x), 0.0, 0.0);
        } else if (localDistance.y > localDistance.z) {
            normal = vec3(0.0, sign(localPos.y), 0.0);
        } else {
            normal = vec3(0.0, 0.0, sign(localPos.z));
        }            
        // Rotate normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);      
        // Reflect velocity and apply repulsion force
        velocity = reflect(velocity, normal) * restitution;
        
        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif      
  #endif      
  // END COLLIDER    
`,QTe=`
  #ifdef USE_ATTRACTOR

      #ifdef USE_SPHERE_COLLIDER      
        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
        vec3 radii = uColliderSize;
        // Adjust position relative to collider
        vec3 relPos = position - uColliderPos;
        // Apply rotation of the collider to the relative position
        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
        // Scale relative position by radii (for ellipsoid collision detection)
        vec3 scaledPos = relPos / radii;
        // Calculate ellipsoidal distance
        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid
        float insideCheck = 1.0;

      #endif


      #ifdef USE_BOX_COLLIDER
        // Box dimensions
        vec3 boxHalfSize = uColliderSize / 2.0;
        // Convert world position to box's local space
        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
        vec3 localDistance = abs(localPos) - boxHalfSize;
        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));
        float insideCheck = particleSize;
      #endif      
  
      // Apply vortex force inside the Helper
      #ifdef USE_FORCE_LOCAL_SPACE
        if (distToSurface <= insideCheck ) {    
            // Define parameters for the attractor field
            #ifdef USE_SPHERE_COLLIDER      
              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed
            #endif

            #ifdef USE_BOX_COLLIDER
              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed
              #endif

            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)
          
            // Use the same radii calculation code as for the collider
            vec3 attractorRadii = uColliderSize;
            // Adjust position relative to attractor center
            vec3 relPos = position - uColliderPos;
            // Apply rotation of the collider to the relative position
            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
            // Scale relative position by radii (for ellipsoid attraction)
            vec3 scaledPos = relPos / attractorRadii;

            // Calculate ellipsoidal distance as attractor radius
            float attractorRadius = length(scaledPos);
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * attractorStrength;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= attractorDamping;
        }
      #else 
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= uForceDamping;
      #endif    
  #endif      
`,ZTe=`
  #ifdef USE_VORTEX
    // Box dimensions
    vec3 boxHalfSize = uColliderSize / 2.0;
    // Convert world position to box's local space
    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
    vec3 localDistance = abs(localPos) - boxHalfSize;
    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));

    // Apply vortex force inside the box
    if (distToSurface <= particleSize) {
      float vortexStrength = uForceIntensity;
      vec3 localTopCenter = vec3(0.0, 0., 0.0);

      // Transform the local top center to the world space
      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);
      // Calculate the vector from particle to vortex center
      vec3 vortexVector = vortexCenter - position;

      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector
      // Note: important to add a tiny z component to the up vector to avoid instability
      vec3 upVector = vec3(0.0, 1.0, 0.01);
      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));
      rotationAxis = normalize(rotationAxis);

      // Add rotational component to velocity
      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; 

      vec3 rotationVelocity = rotationAxis * rotationSpeed;
      // velocity += rotationVelocity * 0.005 ;
      velocity = rotationVelocity * 0.005 ;

      // Calculate vortex force
      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;
      // Apply the vortex force to the particle
      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);
      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);
    }
  #endif      
`,KTe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform sampler2D uDirections;     
uniform vec3 uDirectionsAxis;
uniform vec4 uWorldQuaternion;
uniform vec3 uGravity;        
uniform float uNoiseStrength;     // Variation of the noise
uniform float uNoiseScale;        // Scale of the noise
uniform float uNoiseSeed;         // Seed of the noise
uniform float particleSize;
uniform float uSpeed;     // update speed of the particles
uniform float uRandomMassFactor;

// COLLIDER
uniform vec3 uColliderPos;                // Collider Position
uniform vec3 uColliderSize;               // Collider Dimension
uniform vec4 uColliderQuaternion;         // Collider Rotation
uniform vec4 uColliderQuaternionInvert;   // Collider Rotation
uniform float uBounce;                    // Bounce factor
uniform float uForceDamping;
uniform float uForceIntensity;


`+XTe+`
float rand(vec2 co){
    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
 } 
vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
  
  return acceleration;
}

vec4 conjugate(vec4 q) {
  return vec4(q.w, -q.x, -q.y, -q.z);
}

// Function to compute the normal of the ellipsoid at a given point
vec3 ellipsoidNormal(vec3 p, vec3 radii) {
  return normalize(p / (radii * radii));
}

float friction = .3;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    vec3 directions = texture2D( uDirections, vUv ).xyz;    
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float mass = rand(originalPosition.xy) * 0.5 + 0.5;
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active
    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision

    // Randomness Mass
    mass = (1.0 - (uRandomMassFactor * mass));
    
    if (isActive == 1.0) {
      // **************************************************************
      // FORCES NOISES
      // **************************************************************
      #ifdef USE_CURL_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {
          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;
        }
      #endif
      // **************************************************************
      #ifdef USE_SIMPLEX_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {
          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);
        }
      #endif
      // ************************************************************** 
      #ifdef USE_FBM_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), uNoiseSeed);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      
          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;
        }
      #endif

      // COLLIDER
      ${YTe}
      // ATTRACTION
      ${QTe}  
      // VORTEX
      ${ZTe}
    } 
    // End isActive

    // SPAWN BIRTH 
    // **************************************************************
    // if (isSpawning == 1.)
    #ifdef USE_NORMALS
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);
    #else
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    
    #endif
    
    // if (collisionFlag == 0.0)
    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);

    gl_FragColor = vec4(velocity, collisionFlag);
}
`,eZ=`

  // Linear Fade In
  float linearFadeIn(float t) {
    return t;
  }


  // linear fade out
  float linearFadeOut(float t) {
    return 1.0 - t;
  }
  
  float linearInOut(float t) {
    return t < 0.5 ? t :  (1.0 - t);  
  }

    // lerp
    float lerp(float a, float b, float t) {
      return a + (b - a) * t;
    }

  // Ease In Out Quart
  float exponentialInOut(float t) {
    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :
    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :
    1.0;
   }

  // constant
  float constant(float t) {
    return 1.0;
  } 
`,JTe=`

float rand(vec3 co){
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

vec3 applyQuaternionToVector( vec4 q, vec3 v ){
  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
    
  return acceleration;
}
`,$Te=`
vec3 rgb2xyz (in vec3 rgb) {
    float r = rgb.r;
	float g = rgb.g;
	float b = rgb.b;

	r = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);
	g = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);
	b = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);

	float x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);
	float y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);
	float z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);
    
    vec3 xyz = vec3(
        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,
        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,
        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0
    );
    return(xyz);
}

vec3 xyz2lab (in vec3 xyz) {
	float x = xyz.x / 95.047;
	float y = xyz.y / 100.0;
	float z = xyz.z / 108.883;

	x = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);
	y = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);
	z = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);

    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));
    return(lab);
}

vec3 rgb2lab(in vec3 rgb) {
    vec3 xyz = rgb2xyz(rgb);
    vec3 lab = xyz2lab(xyz);
    return(lab);
}

vec3 xyz2rgb (in vec3 xyz) {
	float x = xyz.x / 100.0;
	float y = xyz.y / 100.0;
	float z = xyz.z / 100.0;
	
    
	float r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);
	float g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);
	float b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);

	r = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;
	g = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;
	b = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;

	r = min(max(0.0, r), 1.0);
	g = min(max(0.0, g), 1.0);
	b = min(max(0.0, b), 1.0);

	return(vec3(r, g, b));
}

vec3 lab2xyz (in vec3 lab) {
    float l = lab.x;
	float a = lab.y;
	float b = lab.z;

  	float y = (l + 16.0) / 116.0;
	float x = a / 500.0 + y;
	float z = y - b / 200.0;

	float y2 = pow(y, 3.0);
	float x2 = pow(x, 3.0);
	float z2 = pow(z, 3.0);

  	y = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;
	x = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;
	z = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;

	x *= 95.047;
	y *= 100.0;
	z *= 108.883;

	return(vec3(x, y, z));
}
vec3 lab2rgb (in vec3 lab) {
    vec3 xyz = lab2xyz(lab);
    vec3 rgb = xyz2rgb(xyz);
    return(rgb);
}

`,eCe=`
  uniform sampler2D uPosition;
  uniform float uSize;
  uniform float uSizeEnd;
  uniform vec3 uWorldOffset;
  uniform vec4 uWorldQuaternion;
  // Billboard Behavior - Currently at Zero, but we can change that
  uniform float uRotation;
  uniform float uRotationEnd;
  uniform vec2 center;

  // Randomness
  uniform float uRandScaleFactor;
  uniform float uRandRotationFactor;

  attribute vec2 ref;

  varying float v_LifeLeft;    // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  ${JTe}
  ${eZ}
`,tCe=({easeSize:t="linearFadeOut"})=>`
  vUv = uv;  
  vRef = ref;
  // Normalized LifeTime 1 to 0
  float lifeLeft = texture2D(uPosition, ref).w;
  v_LifeLeft = lifeLeft;
  // Position From DataTexture Simulation
  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;
  // Apply World Quaternion
  pos = applyQuaternionToVector(uWorldQuaternion, pos);  
            
  #ifdef  USE_SIZE_END
    // Scaled Over Time
    float t = 1. - lifeLeft;
    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd
    vec3 scaledPosition = position * vec3(currentSize);
  #else
    // Change Size Behavior over LifeTime
    float easeSize = ${t}(1. - lifeLeft);
    // Scaled Over Time
    vec3 scaledPosition = position * vec3(uSize * easeSize);
  #endif

  // Billboard Behavior
  vec2 scale;
  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    
  // Randomness 
  float randRef = rand(ref);
  scale *= (1.0 - (uRandScaleFactor * randRef));
  // Rotation
  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);
  float originalRotation = (1.0 - uRotation) * 2.0 * PI;
  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;
  // OverTime
  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);

  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;
  vec2 rotatedPosition;
  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;
  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;
  
  mat4 instanceMatrix = mat4(
    vec4(1.0, 0.0, 0.0, 0.0),
    vec4(0.0, 1.0, 0.0, 0.0),
    vec4(0.0, 0.0, 1.0, 0.0),
    vec4(pos.x, pos.y, pos.z, 1.0)
  );  

  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
  mvPosition.xy += rotatedPosition;
  gl_Position = projectionMatrix  * mvPosition;   
`,iCe=`
  uniform vec4 uColor;                // start color
  uniform vec4 uColor2;               // end color
  uniform sampler2D uTexture;         // texture
  varying float v_LifeLeft;   // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  float random(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
  }
  `+eZ+`  
  ${$Te}

`,rCe=({easeOpacity:t="linearFadeOut"})=>`  
  // if Particle is dead, hide it
  if (v_LifeLeft <= 0.005 ) {
    discard;
  }

  #ifdef USE_RANDOM_COLORING
    float randVal = random(vRef); // Generate a random value based on the reference
    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors
  #else
    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);
  #endif

  // Opacity over Life Time
  float finalAlpha = ${t}(1. - v_LifeLeft);  
  vec4 textureColor = texture2D(uTexture, vUv).rgba; 
  finalColor = textureColor.rgb * color.rgb;
  finalAlpha = color.a * textureColor.a * finalAlpha;
  
  gl_FragColor = vec4(finalColor, finalAlpha);     

`,nCe=class extends xr{constructor(t,e){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(t,e),this.context=e}reset(){}init(t,e){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=t.ease,this.easeSize=t.easeSize,this.layers=[],ta.startContext(ta.globalContext),this.lightLayer=new Ad(0,"",{...Ta.defaultData("light","phong"),visible:!1},new x4,{},e.shared),ta.endContext(ta.globalContext),this.build()}updateState(t){t.coloring!==void 0&&(this.isColoringRandom=t.coloring==="random"),t.color!==void 0&&(t.color instanceof Array?this.uniforms.uColor.value=t.color:this.uniforms.uColor.value=this.context.shared.color(t.color)),t.color2!==void 0&&(t.color2 instanceof Array?this.uniforms.uColor2.value=t.color2:this.uniforms.uColor2.value=this.context.shared.color(t.color2)),t.size!==void 0&&(this.uniforms.uSize.value=t.size[0],this.uniforms.uSizeEnd.value=t.size[1],t.size[0]!==t.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),t.ease!==void 0&&(this.easeOpacity=t.ease,this.build()),t.easeSize!==void 0&&(this.easeSize=t.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(t){this.build(),t.defines=this.defines,t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader}build(){let t=new JY;return t.needsJitter=this.needsJitter,t.addFragmentParsCode(zwe),t.buildShader("vertex",this.fragment),t.buildShader("fragment",this.fragment),t.addFragmentFinalCode(Uwe),this.isColoringRandom&&t.define("USE_RANDOM_COLORING"),this.useSizeEnd&&t.define("USE_SIZE_END"),t.addVertexParsCode(eCe),t.addFragmentParsCode(iCe),t.addVertexFinalCode(tCe({easeSize:this.easeSize})),t.addFragmentFinalCode(rCe({easeOpacity:this.easeOpacity})),this.vertexShader=t.getCode("vertex"),this.fragmentShader=t.getCode("fragment"),this.defines=t.defines,this.uniforms={...t.uniforms,...this.uniforms},this.extensions=t.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach(t=>t.dispose()),super.dispose()}},wL=class{constructor(t,e,i,r){this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=t,this.type=i,this.textureSize=HTe(e);let n=1;this.targetMesh=(r==null?void 0:r.type)==="Mesh"&&r?r:this.getMesh(i,n);let{positions:s,dataTexture:a,dataTextureNormals:o}=this.createPositions(this.textureSize,this.targetMesh??this.getMesh(i,n));this.positionsTexture=a,this.positionsAttribute=s,this.directionsTexture=o}createPositions(t,e){let{positions:i,normals:r}=GTe(e,t*t),n=yj(i,t),s=yj(r,t);return{dataTexture:n,positions:i,dataTextureNormals:s}}getMesh(t,e){let i=null;switch(t){case"SphereEmitterShape":{i=new p1(e*.5,32,32);break}case"TorusEmitterShape":{i=new Lq(e*.5,.3,15,40);break}case"ConeEmitterShape":{i=new AN(e,e,15);break}case"BoxEmitterShape":{i=new yh(e,e,e);break}case"PlaneEmitterShape":{i=new jd(e,e),i.rotateX(-Math.PI/2);break}case"MeshEmitterShape":{i=new p1(e,32,32);break}default:{i=new p1(e,32,32);break}}return new bn(i,new Tp({color:16711680}))}applyToShader(t,e){this.size=new W().fromArray(e.size),t.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function Jx(t){let e={...t},i=ZC.defaultData;e.forceFieldObjectId&&(e.colliderEntityId=e.forceFieldObjectId);let r={...i.shape,...e.shape},n={...i.renderMaterial,...e.renderMaterial};return{...i,...e,shape:r,renderMaterial:n}}var sCe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU

uniform sampler2D uIndex; // Texture with corresponding index
uniform float uLastIndexEmitted; // Last emitted index
uniform float uParticlesToEmit; // Number of particles to emit on that frame
uniform float uTime;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    float particleIndex = texture(uIndex, vUv).x;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;


    // ********** Detect Colision to Create a flag and use it in position **********
    // We are doing this here, so

    // ********** Emit Particles **********
    // X = isSpawning 0.0 or 1.0
    // Y = isActive 0.0 or 1.0
    // Check if the vertex index is between the first value and the last value
    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {
    //     // Emit a particle by writing 1 to the red channel of the color output
    //     // r: 1. == emit the particle
    //     // g: 1. == particle is now active
    //     timeStart = uTime;
    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);
    // } else {
    //     // The Particle is either already emitted or not in the range of the particles to emit
    //     // Do not emit a particle by writing 0 to the red channel of the color output        
    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);
    // }
    // Determine if the particle is within the emission range
    float emitLowerBound = step(uLastIndexEmitted, particleIndex);
    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);
    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise

    // Set timeStart and color
    timeStart = mix(timeStart, uTime, emitParticle);
    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);


}
`,ML=10,aCe=class extends Kr{constructor(t,e){super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new sde,this.currentWorldPosition=new W,this.systemQuaternion=new Ci,this.worldGravity=new W(0,0,0),this.directionAxis=new W(0,0,0),this.colliderV3=new W(0,0,0),this.colliderQuaternion=new Ci(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=t,this.system=e,this.shared=e.context.shared;let i=e.data;this.material=new nCe(i.renderMaterial,e.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:i.renderMaterial.color},uColor2:{value:i.renderMaterial.color2},uPosition:{value:new W(0,0,0)},uEmissionData:{value:new W(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new W(0,0,0)},uWorldQuaternion:{value:new Ri(0,0,0,1)},uRandScaleFactor:{value:i.randomScale??0},uRandRotationFactor:{value:i.randomRotation??0},uRotation:{value:i.renderMaterial.spriteRotation[0]??0},uRotationEnd:{value:i.renderMaterial.spriteRotation[1]??0}},this.setTexture(this.material.uniforms,i.renderMaterial.texture),this.init(i)}setTexture(t,e){let i=e.data;if(typeof e=="string"){let r=this.shared.image(e),n=new ns(r.img);n.needsUpdate=!0,t.uTexture.value=n;return}if(typeof i!="string"){let r=new Image;r.onload=()=>{let a=new ns(r);a.needsUpdate=!0,t.uTexture.value=a};let n=new Blob([i],{type:"image/*"}),s=URL.createObjectURL(n);r.src=s}}updateGeometryAttributes(t,e){var r;let i=VTe(e);!((r=this.emitterShape)!=null&&r.positionsAttribute)||t.geometry.setAttribute("ref",new Ew(i,2))}applyWorldSpace(){if(!this.system.started||!this.worldSpace||!this.positionSimRT||!this.velocitySimRT)return;let t=this.system;t.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),t.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(t,e){var a;if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset){this.reset();return}this.applyWorldSpace(),this.globalTime=t,this.positionSimRT.material.uniforms.uTime.value=t,this.emissionRateSimRT.material.uniforms.uTime.value=t;let i=1e3/e,r=this.targetFPS/i,n=this.previousRatio+(r-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=n,this.previousRatio=n;let s=this.isEmitting?this.GoEmitSomeParticles(t,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=s,this.material.uniforms.uPosition.value=(a=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT))==null?void 0:a.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let t=this.system.colliderEntities[0],e=this.simFeaturesDefinition.USE_COLLIDER||this.simFeaturesDefinition.USE_ATTRACTOR||this.simFeaturesDefinition.USE_VORTEX;if(t.destroyedInAction&&e&&this.init(Jx({...this.system.data,colliderEntityId:null})),!t||t.destroyedInAction)return;t.getWorldPosition(this.colliderV3),this.colliderV3.y===0&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let i=t.data.size;this.colliderV3.fromArray(i),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),t.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(t){!this.velocitySimRT||!this.positionSimRT||(t.renderMaterial&&this.updateMaterialState(t.renderMaterial),this.updateParticleState(t))}updateVariableState(t,e){if(!this.velocitySimRT||!this.positionSimRT)return;e[2]==="size"&&this.material.updateState({size:[t,this.material.uniforms.uSizeEnd.value]}),e[2]==="sizeEnd"&&this.material.updateState({size:[this.material.uniforms.uSize.value,t]});let i=(r,n)=>{let s=[...this.system.data.shape.size];s[r]=n,this.updateParticleState({shape:{...this.system.data.shape,size:s}})};e[2]==="shape_size_0"&&i(0,t),e[2]==="shape_size_1"&&i(1,t),e[2]==="shape_size_2"&&i(2,t),e[2]==="speed"&&(this.velocitySimRT.material.uniforms.uSpeed.value=t/ML),e[2]==="gravity"&&this.worldGravity.set(0,t/100,0),e[2]==="noiseStrength"&&(this.noiseStrength=t,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),e[2]==="noiseScale"&&(this.noiseScale=t,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),e[2]==="direction_x"&&(this.directionAxis=this.getDirectionAxis([Number(t),this.system.data.direction[1],this.system.data.direction[2]])),e[2]==="direction_y"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(t),this.system.data.direction[2]])),e[2]==="direction_z"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(t)]))}updateMaterialState(t){this.material.updateState({...t,size:t.size?[Number(this.shared.getVariable(t.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(t.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]}),t.texture&&(this.setTexture(this.material.uniforms,t.texture),this.material.needsUpdate=!0)}updateParticleState(t){var e,i,r;if(!(!this.positionSimRT||!this.velocitySimRT)){if(this.shouldReInitGPUCompute(t)&&this.init(Jx(this.system.data)),t.life!==void 0&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=t.life),t.speed!==void 0&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(t.speed,[this.uuid,"particles","speed"]))/ML),t.collisionBounce!==void 0&&(this.velocitySimRT.material.uniforms.uBounce.value=t.collisionBounce),t.noiseStrength!==void 0&&(this.noiseStrength=Number(this.shared.getVariable(t.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),t.noiseScale!==void 0&&(this.noiseScale=Number(this.shared.getVariable(t.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),t.noiseSeed!==void 0&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=t.noiseSeed),t.randomMass!==void 0&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=t.randomMass),((e=t.renderMaterial)==null?void 0:e.size)!==void 0){let n=this.shared.getVariable(t.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(n)}if(((i=t.renderMaterial)==null?void 0:i.spriteRotation)!==void 0&&(this.material.uniforms.uRotation.value=t.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=t.renderMaterial.spriteRotation[1]),t.shape!==void 0){let n=t.shape.size??this.system.data.shape.size,s=[Number(this.shared.getVariable(n[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(n[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(n[2],[this.uuid,"particles","shape_size_2"]))],a={...Jx(this.system.data).shape,size:s};(r=this.emitterShape)==null||r.applyToShader(this.positionSimRT.material.uniforms,a)}if(t.gravity!==void 0&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),t.direction!==void 0){let n=this.getDirectionFromVariable(t.direction);this.directionAxis=this.getDirectionAxis(n),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}t.randomRotation!==void 0&&(this.material.uniforms.uRandRotationFactor.value=t.randomRotation),t.randomScale!==void 0&&(this.material.uniforms.uRandScaleFactor.value=t.randomScale)}}updateForceFieldParameters(t){!this.velocitySimRT||(t.forceIntensity!==void 0&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=t.forceIntensity),t.forceDambing!==void 0&&(this.velocitySimRT.material.uniforms.uForceDamping.value=t.forceDambing))}getDirectionAxis(t){let e=[Number(t[0])*Qt.DEG2RAD,Number(t[1])*Qt.DEG2RAD,Number(t[2])*Qt.DEG2RAD],i=new ia(e[0],e[1],e[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(i).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(t){let{birthRatePerSec:e,rootObjectType:i,colliderEntityId:r,shape:n,emitTimeDuration:s,emitTimeCycle:a,life:o,directionMode:l,noiseType:c}=t;return e!==void 0||i!==void 0||r||r===null||a!==void 0||n!==void 0||o!==void 0||s!==void 0||l!==void 0||c!==void 0}init(t){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:t.birthRatePerSec,particleMaxLifeTime:t.life,loopDuration:t.emitTimeCycle==="infinity"?0:t.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to 100000."),this.particlesAmount=1e5),this.emitterShape=this.createShape(t.shape,this.particlesAmount);let e=setInterval(()=>{if(this.emitterShape)if(isNaN(this.emitterShape.positionsTexture.source.data.data[0])){this.init(t);return}else clearInterval(e)},100);if(!this.emitterShape)return;let i=new FTe(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),r=this.updateSimulationDefinition(t),n=i.addVariable("uCurrentPosition",r+qTe,this.emitterShape.positionsTexture),s=i.addVariable("uCurrentVelocity",r+KTe,this.emitterShape.directionsTexture),a=i.addVariable("uCurrentEmissionRate",sCe,WTe(this.emitterShape.textureSize));i.setVariableDependencies(n,[n,s,a]),i.setVariableDependencies(s,[n,s,a]),i.setVariableDependencies(a,[n,s,a]);let o=jTe({size:this.emitterShape.textureSize}),l={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new W(0,0,0)},uWorldQuaternion:{value:new Ri(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:t.life},uEmitterSize:{value:new W(Number(this.shared.getVariable(t.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};n.material.uniforms=l;let c=this.getDirectionFromVariable(t.direction);this.directionAxis=this.getDirectionAxis(c),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(t.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(t.noiseScale,[this.uuid,"particles","noiseScale"]));let u=t.colliderEntityId&&this.system.getColliderData(t.colliderEntityId),h={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new Ri(0,0,0,1)},uColliderPos:{value:new W(0,0,0)},uColliderSize:{value:new W(0,0,0)},uForceIntensity:{value:u?u.forceIntensity:0},uForceDamping:{value:u?u.forceDambing:0},uColliderQuaternion:{value:new Ri(0,0,0,1)},uColliderQuaternionInvert:{value:new Ri(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:t.noiseSeed},uRandomMassFactor:{value:t.randomMass},uBounce:{value:t.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(t.speed,[this.uuid,"particles","speed"]))/ML}};s.material.uniforms=h;let d={uIndex:{value:o},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};a.material.uniforms=d;let p=[Number(this.shared.getVariable(t.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t.shape.size[2],[this.uuid,"particles","shape_size_2"]))],g={...Jx(this.system.data).shape,size:p};this.emitterShape.applyToShader(n.material.uniforms,g),i.init(),this.gpuCompute=i,this.positionSimRT=n,this.velocitySimRT=s,this.emissionRateSimRT=a,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(t){let e=Number(this.shared.getVariable(t[0],[this.uuid,"particles","direction_x"])),i=Number(this.shared.getVariable(t[1],[this.uuid,"particles","direction_y"])),r=Number(this.shared.getVariable(t[2],[this.uuid,"particles","direction_z"]));return[e,i,r]}updateSimulationDefinition(t){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,t.colliderEntityId&&this.system.colliderEntities.length>0){let i=this.system.getColliderData(t.colliderEntityId);switch(i==null?void 0:i.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0;break}let r=i==null?void 0:i.colliderType;r==="sphere"&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),r==="box"&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),(i==null?void 0:i.forceRange)==="helper"&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}t.directionMode==="normals"&&(this.simFeaturesDefinition.USE_NORMALS=!0),t.noiseType==="curl"&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),t.noiseType==="simplex"&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),t.noiseType==="fbm"&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let e="";for(let[i,r]of Object.entries(this.simFeaturesDefinition))r&&(e+=`#define ${i}
`);return e}createShape(t,e){this.emitterShape&&this.emitterShape.dispose();let i=new W(Number(this.shared.getVariable(t.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t.size[2],[this.uuid,"particles","shape_size_2"])));if(t.type==="MeshEmitterShape"){let r=null;return this.system.context.scene.traverseEntity(n=>{n.uuid===t.fromMeshId&&(r=n)}),r?new wL(i,e,t.type,r):new wL(i,e,"SphereEmitterShape")}else return new wL(i,e,t.type)}createPrimaryEmitter(t){let e,i=t*t;return e=new yhe(new jd(1,1,1),this.material,i),this.updateGeometryAttributes(e,t),this.material.needsUpdate=!0,e.onBeforeRender=()=>{this.applyWorldSpace()},e}getMaxParticlesAmount({birthRatePerSecond:t,particleMaxLifeTime:e,loopDuration:i=0}){return Math.ceil(t*(e+i))}dispose(){var t,e,i;!this.gpuCompute||((e=(t=this.rootObject)==null?void 0:t.parent)==null||e.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),(i=this.emitterShape)==null||i.dispose())}GoEmitSomeParticles(t,e){let i=t-this.lastEmitTime,r=1/e;if(i>=r){let n=Math.max(1,Math.floor(i/r));return this.lastEmitTime=t,this.emittedParticlesAmount+n>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=n,n}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(Jx(this.system.data))}startEmitting(t){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=t}stopEmitting(){this.isEmitting=!1}},tw=class extends hl{constructor(t,e,i){super(t,e),this.type="ParticleSystem",this.geometry=new ni,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.timeoutId=void 0,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=r=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(r))},this.context=i,this.data={...e,...Jx(e)},this.geometry.setAttribute("position",new Wt([],3)),this.material=new Tp({colorWrite:!1}),this.frustumCulled=!1}init(t){this.renderer=t,this.emitter=new aCe(t,this),this.add(this.emitter),this.updateParticleState(this.data)}update(t){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=t,this.stopped||(this.currentLoopTime+=t);let e=this.data.emitTimeCycle==="one_time";if((this.data.emitTimeCycle==="loop"||e)&&this.currentLoopTime>this.data.emitTimeDuration*1e3&&(this.stopped||(this.stop(),e||this.start(this.data.emitTimeDelay*1e3))),this.emitter&&this.started){let i=this.actualTime/1e3;this.emitter.update(i,t)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(t){return this.colliderEntities.some(e=>e.identity===t)}getColliderData(t){let e=this.colliderEntities.find(i=>i.identity===t);return e?e.data:null}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),dn(t.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:{...this.data.renderMaterial,...Ra.drop(t,1).props}}),dn(t.path,["shape"])&&this.updateParticleState({shape:{...this.data.shape,...Ra.drop(t,1).props}})}updateState(t,e){super.updateState(t,e),this.updateParticleState(t)}updateParticleState(t){if(this.emitter){if(t.colliderEntityId!==void 0&&t.colliderEntityId!==null){let e=this.context.scene.find(t.colliderEntityId);this.colliderEntities=e?[e]:[]}t.colliderEntityId===null&&(this.colliderEntities=[]),this.emitter.updateState(t),t.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(t){!this.emitter||(this.emitter.updateForceFieldParameters(t),this.stop(),this.start())}start(t=0){var e;if(this.currentLoopTime=0,t){this.timeoutId=window.setTimeout(()=>{this.start(0)},t);return}this.started=!0,this.stopped=!1,this.isFrozen=!1,(e=this.emitter)==null||e.startEmitting(this.actualTime/1e3)}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){var t;this.stopped=!0,this.currentLoopTime=0,(t=this.emitter)==null||t.stopEmitting(),clearTimeout(this.timeoutId)}reset(){var t;this.started=!1,this.stopped=!1,(t=this.emitter)==null||t.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};function oCe(){try{let t=window.location.href;if(t.includes("reducesubdiv=")){let e=t.indexOf("reducesubdiv=")+13;return parseInt(t.slice(e,e+1))}}catch{}}var EL=oCe();function lCe(t,e,i){var n;EL!==void 0&&(((n=e==null?void 0:e.geometry)==null?void 0:n.subdivisions)??0)>EL&&(console.log("reducing subdivisions",e.name,e.geometry.subdivisions),e.geometry.subdivisions=EL);let r;return e.geometry.type==="TextGeometry"?new E4(t,e,i):e.geometry.type==="InputGeometry"?new L4(t,e,i):(e.geometry.type==="SubdivGeometry"?r=new jw(t,e,i):e.geometry.type==="PathGeometry"?r=new O4(t,e,i):e.geometry.type==="VectorGeometry"?r=new BTe(t,e,i):e.geometry.type==="BooleanGeometry"?r=new N0(t,e,i):e.geometry.type==="ShapeBlendGeometry"?r=new F0(t,e,i):e.geometry.type==="UIGeometry"?r=new Ro(t,e,i):r=new Gs(t,e,i),r)}function z4(t,e,i){return console.assert(e.type!==void 0),e.type==="Mesh"?lCe(t,e,i):e.type==="Empty"?new w1(t,e):e.type==="Particle"?new tw(t,e,i):e.type==="ParticleCollider"?new ew(t,e,i):e.type==="Splat"?new w1(t,e):e.type==="Bone"?new NTe(t,e):e.type==="Page"?new Ca(t,e,i):e.type==="PointLight"?new UTe(t,e,i):e.type==="SpotLight"?new GQ(t,e,i):e.type==="DirectionalLight"?new HQ(t,e,i):e.type==="Component"||e.type==="Instance"?new M1(t,e,i):z0.is(e.type)?new Io(t,e):(console.error(e),new w1(t,e))}cg.createEntity=z4;function cCe(t,e,i){let r=z4(t.identity,e,i),n=t.children,s=t.attachedPaths,a=t.parent,o=t.component,l=t.instances,c=t.overrideData,u=t.uuid,h=t.stateSelection;t.dispose();for(let d of Object.keys(t))delete t[d];Object.setPrototypeOf(t,Object.getPrototypeOf(r));for(let d of Object.keys(r))t[d]=r[d];t.children=[...t.children,...n],t.attachedPaths=s,t.parent=a,t.component=o,t.instances=l,t.uuid=u,t.overrideData=c,t.updateState(t.data,i),h&&t.changeSelectedState(h,i),t.resetBBoxNeedsUpdate()}cg.changeEntityProptotype=cCe;cg.Cloner=eu;function uCe(t,e,i,r){t.updateByOp(e,i,r,!1)}var r0=5,iw=new ni;iw.setAttribute("position",new _i(new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),3));var iC=class extends Qhe{constructor(t){super({...t,depthTest:!1,depthWrite:!1,glslVersion:Dz,vertexShader:`
				precision highp float;
				in vec3 position;
				void main() {
					gl_Position = vec4(position, 1);
				}
			`})}customProgramCacheKey(){return""}};function hCe(){return{shapeInput:()=>`
			const float posRowCoord = ${.5/r0};  // vec4: px py pz opType
			const float quatRowCoord = ${1.5/r0};  // vec4: qx qy qz qw
			const float param1RowCoord = ${2.5/r0};// vec4: type param1 param2 param3
			const float param2RowCoord = ${3.5/r0};// vec4: blendRange roundness scale param4
			const float colorRowCoord = ${4.5/r0}; // vec4: r g b a
			uniform sampler2D shapesDataTexture;
			vec4 shapePos(float iin) { 
				vec4 r = texture(shapesDataTexture, vec2(iin, posRowCoord));
				return r;
			}
			vec4 shapeQuat(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, quatRowCoord));
				return r;
			}
			vec4 shapeParams1(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param1RowCoord));
				return r;
			}
			vec4 shapeParams2(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param2RowCoord));
				return r;
			}
			vec4 shapeColor(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, colorRowCoord));
				return r;
			}
		`,getxyzi:`
			// this code must complement lookup
			float xi = mod(gl_FragCoord.x - 0.5, VOXEL_RESOLUTION);
			float yi = mod(gl_FragCoord.y - 0.5, VOXEL_RESOLUTION);
			float zi = floor((gl_FragCoord.x - 0.5) * INV_VOXEL_RESOLUTION) + floor((gl_FragCoord.y - 0.5) * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
		`,lookup:`
			uniform sampler2D potentialPassTexture;
			uniform sampler2D voxelPassTexture; // includes normal (in xyz) and key (in w)
			
			// box or marching cube lookup value in value texture, integer box coord inputs
			// this code must complement codebits.getxyzi
			vec4 look(float xi, float yi, float zi, sampler2D rt) {// range 0 .. numv etc
				vec2 uv = vec2(
					mod(zi, Z_LAYERS_PER_ROW) + (xi + 0.5) / VOXEL_RESOLUTION,
					floor(zi / Z_LAYERS_PER_ROW) + (yi + 0.5) / VOXEL_RESOLUTION
				); 
				uv /= Z_LAYERS_PER_ROW;
				return texture(rt, uv);
			}
		`,getpart:`
			float getpart(inout float a, float b) {
				float t = floor(a/b);
				float r = a - t*b;
				a = t;
				return r;
			}
		`,triTable:new Float32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,1,8,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,9,9,2,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,2,8,10,2,8,9,10,-1,-1,-1,-1,-1,-1,-1,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,0,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,1,11,9,1,11,8,9,-1,-1,-1,-1,-1,-1,-1,1,10,3,3,10,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,10,0,10,8,0,10,11,8,-1,-1,-1,-1,-1,-1,-1,0,9,3,9,11,3,9,10,11,-1,-1,-1,-1,-1,-1,-1,10,8,9,11,8,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,4,3,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,4,1,7,4,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,2,1,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,3,4,0,3,10,2,1,-1,-1,-1,-1,-1,-1,-1,10,2,9,2,0,9,7,4,8,-1,-1,-1,-1,-1,-1,-1,9,10,2,7,9,2,3,7,2,4,9,7,-1,-1,-1,-1,7,4,8,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,11,4,2,11,4,0,2,-1,-1,-1,-1,-1,-1,-1,1,0,9,7,4,8,11,3,2,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,9,2,11,9,1,2,9,-1,-1,-1,-1,1,10,3,10,11,3,4,8,7,-1,-1,-1,-1,-1,-1,-1,10,11,1,11,4,1,4,0,1,4,11,7,-1,-1,-1,-1,8,7,4,11,0,9,10,11,9,3,0,11,-1,-1,-1,-1,11,7,4,9,11,4,10,11,9,-1,-1,-1,-1,-1,-1,-1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,9,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,0,0,5,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,8,5,3,8,5,1,3,-1,-1,-1,-1,-1,-1,-1,10,2,1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,10,2,1,5,9,4,-1,-1,-1,-1,-1,-1,-1,10,2,5,2,4,5,2,0,4,-1,-1,-1,-1,-1,-1,-1,5,10,2,5,2,3,4,5,3,8,4,3,-1,-1,-1,-1,4,5,9,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,11,8,0,5,9,4,-1,-1,-1,-1,-1,-1,-1,4,5,0,5,1,0,11,3,2,-1,-1,-1,-1,-1,-1,-1,5,1,2,8,5,2,11,8,2,5,8,4,-1,-1,-1,-1,11,3,10,3,1,10,4,5,9,-1,-1,-1,-1,-1,-1,-1,5,9,4,1,8,0,1,10,8,10,11,8,-1,-1,-1,-1,0,4,5,11,0,5,10,11,5,3,0,11,-1,-1,-1,-1,8,4,5,10,8,5,11,8,10,-1,-1,-1,-1,-1,-1,-1,8,7,9,9,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,9,3,5,9,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,7,0,7,1,0,7,5,1,-1,-1,-1,-1,-1,-1,-1,3,5,1,7,5,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,9,7,5,9,2,1,10,-1,-1,-1,-1,-1,-1,-1,2,1,10,0,5,9,0,3,5,3,7,5,-1,-1,-1,-1,2,0,8,5,2,8,7,5,8,2,5,10,-1,-1,-1,-1,5,10,2,3,5,2,7,5,3,-1,-1,-1,-1,-1,-1,-1,5,9,7,9,8,7,2,11,3,-1,-1,-1,-1,-1,-1,-1,7,5,9,2,7,9,0,2,9,11,7,2,-1,-1,-1,-1,11,3,2,8,1,0,8,7,1,7,5,1,-1,-1,-1,-1,1,2,11,7,1,11,5,1,7,-1,-1,-1,-1,-1,-1,-1,8,5,9,7,5,8,3,1,10,11,3,10,-1,-1,-1,-1,0,7,5,9,0,5,0,11,7,10,0,1,0,10,11,-1,0,10,11,3,0,11,0,5,10,7,0,8,0,7,5,-1,5,10,11,5,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,0,9,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,8,9,1,6,10,5,-1,-1,-1,-1,-1,-1,-1,5,6,1,1,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,1,6,2,1,8,0,3,-1,-1,-1,-1,-1,-1,-1,5,6,9,6,0,9,6,2,0,-1,-1,-1,-1,-1,-1,-1,8,9,5,2,8,5,6,2,5,8,2,3,-1,-1,-1,-1,11,3,2,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,11,0,2,11,5,6,10,-1,-1,-1,-1,-1,-1,-1,9,1,0,11,3,2,6,10,5,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,9,1,2,11,9,11,8,9,-1,-1,-1,-1,11,3,6,3,5,6,3,1,5,-1,-1,-1,-1,-1,-1,-1,11,8,0,5,11,0,1,5,0,6,11,5,-1,-1,-1,-1,6,11,3,6,3,0,5,6,0,9,5,0,-1,-1,-1,-1,9,5,6,11,9,6,8,9,11,-1,-1,-1,-1,-1,-1,-1,6,10,5,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,3,7,4,10,5,6,-1,-1,-1,-1,-1,-1,-1,0,9,1,6,10,5,7,4,8,-1,-1,-1,-1,-1,-1,-1,5,6,10,7,9,1,3,7,1,4,9,7,-1,-1,-1,-1,2,1,6,1,5,6,8,7,4,-1,-1,-1,-1,-1,-1,-1,5,2,1,6,2,5,4,0,3,7,4,3,-1,-1,-1,-1,7,4,8,5,0,9,5,6,0,6,2,0,-1,-1,-1,-1,9,3,7,4,9,7,9,2,3,6,9,5,9,6,2,-1,2,11,3,4,8,7,5,6,10,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,7,4,0,2,4,11,7,2,-1,-1,-1,-1,9,1,0,8,7,4,11,3,2,6,10,5,-1,-1,-1,-1,1,2,9,2,11,9,11,4,9,4,11,7,6,10,5,-1,7,4,8,5,11,3,1,5,3,6,11,5,-1,-1,-1,-1,11,1,5,6,11,5,11,0,1,4,11,7,11,4,0,-1,9,5,0,5,6,0,6,3,0,3,6,11,7,4,8,-1,9,5,6,11,9,6,9,7,4,9,11,7,-1,-1,-1,-1,9,4,10,10,4,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,4,10,9,4,3,8,0,-1,-1,-1,-1,-1,-1,-1,1,0,10,0,6,10,0,4,6,-1,-1,-1,-1,-1,-1,-1,1,3,8,6,1,8,4,6,8,10,1,6,-1,-1,-1,-1,9,4,1,4,2,1,4,6,2,-1,-1,-1,-1,-1,-1,-1,8,0,3,9,2,1,9,4,2,4,6,2,-1,-1,-1,-1,4,2,0,6,2,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,4,2,8,6,2,4,-1,-1,-1,-1,-1,-1,-1,9,4,10,4,6,10,3,2,11,-1,-1,-1,-1,-1,-1,-1,2,8,0,11,8,2,10,9,4,6,10,4,-1,-1,-1,-1,2,11,3,6,1,0,4,6,0,10,1,6,-1,-1,-1,-1,1,4,6,10,1,6,1,8,4,11,1,2,1,11,8,-1,4,6,9,6,3,9,3,1,9,3,6,11,-1,-1,-1,-1,1,11,8,0,1,8,1,6,11,4,1,9,1,4,6,-1,6,11,3,0,6,3,4,6,0,-1,-1,-1,-1,-1,-1,-1,8,4,6,8,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,7,10,8,7,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,7,0,7,10,0,10,9,0,10,7,6,-1,-1,-1,-1,7,6,10,7,10,1,8,7,1,0,8,1,-1,-1,-1,-1,7,6,10,1,7,10,3,7,1,-1,-1,-1,-1,-1,-1,-1,6,2,1,8,6,1,9,8,1,7,6,8,-1,-1,-1,-1,9,6,2,1,9,2,9,7,6,3,9,0,9,3,7,-1,0,8,7,6,0,7,2,0,6,-1,-1,-1,-1,-1,-1,-1,2,3,7,2,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,3,2,8,6,10,9,8,10,7,6,8,-1,-1,-1,-1,7,0,2,11,7,2,7,9,0,10,7,6,7,10,9,-1,0,8,1,8,7,1,7,10,1,10,7,6,11,3,2,-1,1,2,11,7,1,11,1,6,10,1,7,6,-1,-1,-1,-1,6,9,8,7,6,8,6,1,9,3,6,11,6,3,1,-1,1,9,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,6,0,7,0,11,3,0,6,11,-1,-1,-1,-1,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,8,1,3,8,6,7,11,-1,-1,-1,-1,-1,-1,-1,2,1,10,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,8,0,3,7,11,6,-1,-1,-1,-1,-1,-1,-1,0,9,2,9,10,2,7,11,6,-1,-1,-1,-1,-1,-1,-1,7,11,6,3,10,2,3,8,10,8,9,10,-1,-1,-1,-1,3,2,7,7,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,7,0,6,7,0,2,6,-1,-1,-1,-1,-1,-1,-1,6,7,2,7,3,2,9,1,0,-1,-1,-1,-1,-1,-1,-1,2,6,1,6,8,1,8,9,1,6,7,8,-1,-1,-1,-1,6,7,10,7,1,10,7,3,1,-1,-1,-1,-1,-1,-1,-1,6,7,10,10,7,1,7,8,1,8,0,1,-1,-1,-1,-1,7,3,0,10,7,0,9,10,0,7,10,6,-1,-1,-1,-1,10,6,7,8,10,7,9,10,8,-1,-1,-1,-1,-1,-1,-1,4,8,6,6,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,3,6,0,3,6,4,0,-1,-1,-1,-1,-1,-1,-1,11,6,8,6,4,8,1,0,9,-1,-1,-1,-1,-1,-1,-1,6,4,9,3,6,9,1,3,9,6,3,11,-1,-1,-1,-1,4,8,6,8,11,6,1,10,2,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,0,3,11,6,0,6,4,0,-1,-1,-1,-1,8,11,4,11,6,4,9,2,0,9,10,2,-1,-1,-1,-1,3,9,10,2,3,10,3,4,9,6,3,11,3,6,4,-1,3,2,8,2,4,8,2,6,4,-1,-1,-1,-1,-1,-1,-1,2,4,0,2,6,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,4,3,2,6,4,2,8,3,4,-1,-1,-1,-1,4,9,1,2,4,1,6,4,2,-1,-1,-1,-1,-1,-1,-1,3,1,8,1,6,8,6,4,8,1,10,6,-1,-1,-1,-1,0,1,10,6,0,10,4,0,6,-1,-1,-1,-1,-1,-1,-1,3,6,4,8,3,4,3,10,6,9,3,0,3,9,10,-1,4,9,10,4,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,9,4,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,5,9,4,6,7,11,-1,-1,-1,-1,-1,-1,-1,1,0,5,0,4,5,11,6,7,-1,-1,-1,-1,-1,-1,-1,6,7,11,4,3,8,4,5,3,5,1,3,-1,-1,-1,-1,4,5,9,2,1,10,11,6,7,-1,-1,-1,-1,-1,-1,-1,7,11,6,10,2,1,3,8,0,5,9,4,-1,-1,-1,-1,11,6,7,10,4,5,10,2,4,2,0,4,-1,-1,-1,-1,8,4,3,4,5,3,5,2,3,2,5,10,6,7,11,-1,3,2,7,2,6,7,9,4,5,-1,-1,-1,-1,-1,-1,-1,4,5,9,6,8,0,2,6,0,7,8,6,-1,-1,-1,-1,2,6,3,6,7,3,0,5,1,0,4,5,-1,-1,-1,-1,8,2,6,7,8,6,8,1,2,5,8,4,8,5,1,-1,4,5,9,6,1,10,6,7,1,7,3,1,-1,-1,-1,-1,10,6,1,6,7,1,7,0,1,0,7,8,4,5,9,-1,10,0,4,5,10,4,10,3,0,7,10,6,10,7,3,-1,10,6,7,8,10,7,10,4,5,10,8,4,-1,-1,-1,-1,5,9,6,9,11,6,9,8,11,-1,-1,-1,-1,-1,-1,-1,11,6,3,3,6,0,6,5,0,5,9,0,-1,-1,-1,-1,8,11,0,11,5,0,5,1,0,11,6,5,-1,-1,-1,-1,3,11,6,5,3,6,1,3,5,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,5,9,8,11,9,6,5,11,-1,-1,-1,-1,3,11,0,11,6,0,6,9,0,9,6,5,10,2,1,-1,5,8,11,6,5,11,5,0,8,2,5,10,5,2,0,-1,3,11,6,5,3,6,3,10,2,3,5,10,-1,-1,-1,-1,9,8,5,8,2,5,2,6,5,2,8,3,-1,-1,-1,-1,6,5,9,0,6,9,2,6,0,-1,-1,-1,-1,-1,-1,-1,8,5,1,0,8,1,8,6,5,2,8,3,8,2,6,-1,6,5,1,6,1,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,3,1,10,6,1,6,8,3,9,6,5,6,9,8,-1,0,1,10,6,0,10,0,5,9,0,6,5,-1,-1,-1,-1,8,3,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,5,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,11,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,5,7,11,0,3,8,-1,-1,-1,-1,-1,-1,-1,7,11,5,11,10,5,0,9,1,-1,-1,-1,-1,-1,-1,-1,5,7,10,7,11,10,1,8,9,1,3,8,-1,-1,-1,-1,2,1,11,1,7,11,1,5,7,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,2,1,5,7,1,11,2,7,-1,-1,-1,-1,5,7,9,7,2,9,2,0,9,7,11,2,-1,-1,-1,-1,2,5,7,11,2,7,2,9,5,8,2,3,2,8,9,-1,10,5,2,5,3,2,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,2,8,2,5,8,5,7,8,5,2,10,-1,-1,-1,-1,1,0,9,3,10,5,7,3,5,2,10,3,-1,-1,-1,-1,2,8,9,1,2,9,2,7,8,5,2,10,2,5,7,-1,5,3,1,5,7,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,1,7,0,5,7,1,-1,-1,-1,-1,-1,-1,-1,3,0,9,5,3,9,7,3,5,-1,-1,-1,-1,-1,-1,-1,7,8,9,7,9,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,5,8,10,5,8,11,10,-1,-1,-1,-1,-1,-1,-1,4,0,5,0,11,5,11,10,5,0,3,11,-1,-1,-1,-1,9,1,0,10,4,8,11,10,8,5,4,10,-1,-1,-1,-1,4,11,10,5,4,10,4,3,11,1,4,9,4,1,3,-1,1,5,2,5,8,2,8,11,2,8,5,4,-1,-1,-1,-1,11,4,0,3,11,0,11,5,4,1,11,2,11,1,5,-1,5,2,0,9,5,0,5,11,2,8,5,4,5,8,11,-1,5,4,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,2,2,5,3,5,4,3,4,8,3,-1,-1,-1,-1,2,10,5,4,2,5,0,2,4,-1,-1,-1,-1,-1,-1,-1,2,10,3,10,5,3,5,8,3,8,5,4,9,1,0,-1,2,10,5,4,2,5,2,9,1,2,4,9,-1,-1,-1,-1,5,4,8,3,5,8,1,5,3,-1,-1,-1,-1,-1,-1,-1,5,4,0,5,0,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,4,8,3,5,8,5,0,9,5,3,0,-1,-1,-1,-1,5,4,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,11,4,11,9,4,11,10,9,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,9,4,7,11,9,11,10,9,-1,-1,-1,-1,11,10,1,4,11,1,0,4,1,11,4,7,-1,-1,-1,-1,4,1,3,8,4,3,4,10,1,11,4,7,4,11,10,-1,7,11,4,4,11,9,11,2,9,2,1,9,-1,-1,-1,-1,4,7,9,7,11,9,11,1,9,1,11,2,3,8,0,-1,4,7,11,2,4,11,0,4,2,-1,-1,-1,-1,-1,-1,-1,4,7,11,2,4,11,4,3,8,4,2,3,-1,-1,-1,-1,10,9,2,9,7,2,7,3,2,9,4,7,-1,-1,-1,-1,7,10,9,4,7,9,7,2,10,0,7,8,7,0,2,-1,10,7,3,2,10,3,10,4,7,0,10,1,10,0,4,-1,2,10,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,3,1,7,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,1,8,0,1,7,8,-1,-1,-1,-1,3,0,4,3,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,10,9,8,11,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,10,9,11,-1,-1,-1,-1,-1,-1,-1,10,1,0,8,10,0,11,10,8,-1,-1,-1,-1,-1,-1,-1,10,1,3,10,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,1,9,11,1,8,11,9,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,9,2,1,9,11,2,-1,-1,-1,-1,11,2,0,11,0,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,9,8,10,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,8,1,0,8,10,1,-1,-1,-1,-1,2,10,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),numTrisTable:new Float32Array([0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,2,3,4,4,3,3,4,4,3,4,5,5,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,2,3,3,4,3,4,2,3,3,4,4,5,4,5,3,2,3,4,4,3,4,5,3,2,4,5,5,4,5,2,4,1,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,2,4,3,4,3,5,2,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,3,4,4,3,4,5,5,4,4,3,5,2,5,4,2,1,2,3,3,4,3,4,4,5,3,4,4,5,2,3,3,2,3,4,4,5,4,5,5,2,4,3,5,4,3,2,4,1,3,4,4,5,4,5,3,4,4,5,5,2,3,4,2,1,2,3,3,2,3,4,2,1,3,2,4,1,2,1,1,0])}}var rC=new Pg,dCe=class{constructor(){this.pyramidPassScene=new ql,this.pyramidPassMaterial=new iC({name:"PyramidPass"}),this.pyramidPassUniforms={inputTexture:{value:void 0},inputWidth:{value:0},inputHeight:{value:0},inputShiftX:{value:0},outputShiftX:{value:0}},this.pyramidTopLevelReadPixelBuffer=new Float32Array(4);let t=`
			precision highp float;
			precision highp sampler2D;
			layout(location = 0) out vec4 pc_FragColor;
			uniform sampler2D inputTexture;
			uniform float inputWidth;
			uniform float inputHeight;
			uniform float inputShiftX;
			uniform float outputShiftX;
			const vec2 half_unit_coord = vec2(0.5);
			const vec4 one = vec4(1.0);
			void main() {
				vec2 inputSize = vec2(inputWidth, inputHeight);
				vec2 input_pixel_uv = 1. / inputSize;
				vec2 coord = gl_FragCoord.xy - half_unit_coord;
				coord.x -= outputShiftX;
				coord = coord * 2. + half_unit_coord;
				coord.x += inputShiftX;

				// sample bottom left corner
				vec2 input_uv = coord / inputSize;
				float bl = texture(inputTexture, input_uv).r;

				// sample bottom right corner
				input_uv.x += input_pixel_uv.x;
				float br = texture(inputTexture, input_uv).r;

				// sample top right corner
				input_uv.y += input_pixel_uv.y;
				float tr = texture(inputTexture, input_uv).r;

				// sample top left corner
				input_uv.x -= input_pixel_uv.x;
				float tl = texture(inputTexture, input_uv).r;

				pc_FragColor.a = bl;
				pc_FragColor.b = pc_FragColor.a + br;
				pc_FragColor.g = pc_FragColor.b + tr;
				pc_FragColor.r = pc_FragColor.g + tl; 
			}
		`;this.pyramidPassMaterial.fragmentShader=t,this.pyramidPassMaterial.uniforms=this.pyramidPassUniforms,this.pyramidPassMaterial.depthTest=!1,this.pyramidPassMaterial.depthWrite=!1;let e=new bn(iw,this.pyramidPassMaterial);e.frustumCulled=!1,this.pyramidPassScene.add(e)}renderPyramid(t,e,i,r,n){new RN().min.setScalar(0);let s=e.length-1,a=new Ri;i.getViewport(a),this.pyramidPassUniforms.inputShiftX.value=0,this.pyramidPassUniforms.outputShiftX.value=0;let o=s-1;for(let c=o;c>=0;c--){let u=c%2===o%2?n[0]:n[1],h=c===o?r:c%2===o%2?n[1]:n[0];this.pyramidPassUniforms.inputTexture.value=Array.isArray(h.texture)?h.texture[1]:h.texture,this.pyramidPassUniforms.inputWidth.value=h.width,this.pyramidPassUniforms.inputHeight.value=h.height,i.setRenderTarget(u);let d=e[c],p=i.getPixelRatio();i.setViewport(this.pyramidPassUniforms.outputShiftX.value/p,0,d/p,d/p),c===2&&t%2!==0&&i.setViewport(this.pyramidPassUniforms.outputShiftX.value/p,0,3/p,3/p),i.render(this.pyramidPassScene,rC);let g=this.pyramidPassUniforms.inputShiftX.value;this.pyramidPassUniforms.inputShiftX.value=this.pyramidPassUniforms.outputShiftX.value,this.pyramidPassUniforms.outputShiftX.value=g,c<o&&(this.pyramidPassUniforms.outputShiftX.value+=e[c+1])}i.setViewport(a);let l=e.length%2===0?0:1;return i.readRenderTargetPixelsAsync(n[l],n[l].width-1,0,1,1,this.pyramidTopLevelReadPixelBuffer).then(()=>this.pyramidTopLevelReadPixelBuffer[0])}},Ku=24,Qa=96,xd=hCe(),Hf=2,tZ=class extends Gs{constructor(t,e,i){super(t,e,i),this.data=e,this.needsRebuild=!0,this.customDepthMaterialNeedsUpdate=!1,this._npart=-1,this.spatialn=1,this.drawRangeNeedsForceUpdate=!0,this._resolutionLevel=-1,this.resolution=64,this.spatialDivisions=25,this.zLayersPerRow=8,this.basePyramidSize=512,this.pyramidTexture1Width=341,this.pyramidTexture1Height=256,this.pyramidTexture2Width=170,this.pyramidTexture2Height=128,this.numLevels=9,this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=0,this.bboxOffset=0,this.shapesDataTexture={value:void 0},this.spatialscene=new ql,this.potentialPassScene=new ql,this.voxelPassScene=new ql,this._spatialPassRenderTargets=[],this._potentialPassRenderTargets=[],this._voxelPassRenderTargets=[],this._pyramidRenderTargets=[],this.geometry=new ni,this.geometry.drawRange.count=0,this.spatialPassUniforms={span:{value:-1},shapesDataTexture:this.shapesDataTexture,npart:{value:this.npart},spatialn:{value:this.spatialn}},this.spatialMesh=new bn(iw,this.spatialPassMaterial()),this.spatialMesh.frustumCulled=!1,this.spatialscene.add(this.spatialMesh);let r=new al(xd.triTable,16,256,WT,rn);r.needsUpdate=!0;let n=new al(xd.numTrisTable,256,1,WT,rn);n.needsUpdate=!0,this.voxelPassUniforms={potentialPassTexture:{value:void 0},numTrisTable:{value:n}},this.voxelMesh=new bn(iw,this.voxelPassMaterial()),this.voxelMesh.frustumCulled=!1,this.voxelPassScene.add(this.voxelMesh),this.potentialPassUniforms={shapesDataTexture:this.shapesDataTexture,spatialPassTexture:{value:void 0},npart:{value:this.npart},spatialn:{value:this.spatialn}},this.potentialMesh=new bn(iw,this.potentialPassMaterial()),this.potentialMesh.frustumCulled=!1,this.potentialPassScene.add(this.potentialMesh),this.marchPassUniforms={triTable:{value:r},potentialPassTexture:{value:void 0},voxelPassTexture:{value:void 0},pyramidTexture1:{value:void 0},pyramidTexture1Size:{value:void 0},pyramidTexture2:{value:void 0},pyramidTexture2Size:{value:void 0}},this.frustumCulled=!1,this.onBeforeShadowPass=s=>{if(vCe.call(this),this.npart===0){this.geometry.drawRange.count=0;return}let a=this.material.root;if(!a.shadersPatchedForShapeBlend)this.patchVertexShaderForShapeBlend(a),a.shadersPatchedForShapeBlend=!0,this.customDepthMaterialNeedsUpdate=!0;else if(this.customDepthMaterialNeedsUpdate){this.customDepthMaterialNeedsUpdate=!1,this.customDepthMaterial=new xr({vertexShader:a.vertexShader,fragmentShader:`
						#include <packing>
						void main()
						{
							gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
						}
					`,uniforms:a.uniforms,defines:this.material.defines}),this.isMeshDepthMaterial=!0,this.customDistanceMaterial=new xr({vertexShader:a.vertexShader,fragmentShader:`
					#include <common>
					#include <packing>
					uniform vec3 referencePosition;
					uniform float nearDistance;
					uniform float farDistance;
					// World-space position
					varying vec3 vWPosition;
					void main()
					{
						float dist = length(vWPosition - referencePosition);
						dist = (dist - nearDistance) / (farDistance - nearDistance);
						dist = saturate(dist);
						// Required by Three.js for this to work
						gl_FragColor = packDepthToRGBA( dist );
					}`,uniforms:{nearDistance:{value:0},farDistance:{value:0},referencePosition:{value:new W},opacity:{value:0},...a.uniforms},defines:this.material.defines});let c=this.customDistanceMaterial;c.referencePosition=new W,c.nearDistance=0,c.farDistance=0,c.opacity=1,c.isMeshDistanceMaterial=!0}if(this.spatialPassUniforms.npart.value=this.npart,this.spatialPassUniforms.spatialn.value=this.spatialn,this.potentialPassUniforms.npart.value=this.npart,this.potentialPassUniforms.spatialn.value=this.spatialn,this.needsRebuild){this.needsRebuild=!1,this.spatialMesh.material.defines.RES=this.resolutionLevel,this.spatialMesh.material.needsUpdate=!0,this.potentialMesh.material.defines.RES=this.resolutionLevel,this.potentialPassUniforms.spatialPassTexture.value=this.spatialPassRenderTarget.texture,this.potentialMesh.material.needsUpdate=!0,this.voxelMesh.material.defines.RES=this.resolutionLevel,this.voxelMesh.material.needsUpdate=!0,this.voxelPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.voxelPassTexture.value=this.voxelPassRenderTarget.texture[0],this.material.defines.RES=this.resolutionLevel,this.material.defines.LEVELS=this.pyramidLevelSizes.length,this.material.defines.LOOP=this.pyramidLevelSizes.length%2===0?this.pyramidLevelSizes.length-3:this.pyramidLevelSizes.length-2,this.material.defines.HALF=this.pyramidLevelSizes.length%2===0?1:0,this.material.needsUpdate=!0;let c=this.pyramidLevelSizes.length%2===0?0:1,u=this.pyramidLevelSizes.length%2===0?1:0;this.marchPassUniforms.pyramidTexture2.value=this.pyramidRenderTarget[c].texture,this.marchPassUniforms.pyramidTexture2Size.value=new Oe(this.pyramidRenderTarget[c].width,this.pyramidRenderTarget[c].height),this.marchPassUniforms.pyramidTexture1.value=this.pyramidRenderTarget[u].texture,this.marchPassUniforms.pyramidTexture1Size.value=new Oe(this.pyramidRenderTarget[u].width,this.pyramidRenderTarget[u].height),Object.assign(this.material.uniforms,this.marchPassUniforms)}let o=s.shadowMap.enabled;s.shadowMap.enabled=!1;let l=s.getRenderTarget();s.setRenderTarget(this.spatialPassRenderTarget),s.render(this.spatialscene,rC),s.setRenderTarget(this.potentialPassRenderTarget),s.render(this.potentialPassScene,rC),s.setRenderTarget(this.voxelPassRenderTarget),s.render(this.voxelPassScene,rC),tZ.streamCompaction.renderPyramid(this.resolutionLevel,this.pyramidLevelSizes,s,this.voxelPassRenderTarget,this.pyramidRenderTarget).then(c=>{this.material.wireframe&&(c*3>this.geometry.attributes.position.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.dispose(),this.geometry=new ni,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.geometry.attributes.position=new _i(new Float32Array(c*3*2),3)),(c*3>this.geometry.drawRange.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.drawRange.count=Math.floor(c*1.2)*3),this.drawRangeNeedsForceUpdate=!1}),s.shadowMap.enabled=o,s.setRenderTarget(l)}}set npart(t){t!==this._npart&&(this.drawRangeNeedsForceUpdate=!0,this._npart=t,this.spatialn=Math.ceil(t/(4*Ku)))}get npart(){return this._npart}set resolutionLevel(t){let e=Math.min(8,Math.max(5,t));if(e!==this._resolutionLevel){switch(this._resolutionLevel=e,this.resolution=Math.pow(2,e),this.resolutionLevel){case 5:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192],this.bboxSize=31*8*Hf,this.bboxOffset=8*Hf*-1/2;break;case 6:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=63*4*Hf,this.bboxOffset=4*Hf*-1/2;break;case 7:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192,384,768,1536],this.bboxSize=127*2*Hf,this.bboxOffset=2*Hf*-1/2;break;case 8:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096],this.bboxSize=255*Hf,this.bboxOffset=Hf*-1/2;break}this.pyramidTexture1Width=0,this.pyramidTexture2Width=0,this.pyramidTexture1Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-2],this.pyramidTexture2Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-3];for(let i=this.pyramidLevelSizes.length-2;i>=0;i--)(this.pyramidLevelSizes.length-2)%2===i%2?this.pyramidTexture1Width+=this.pyramidLevelSizes[i]:this.pyramidTexture2Width+=this.pyramidLevelSizes[i];this.basePyramidSize=this.pyramidLevelSizes[this.pyramidLevelSizes.length-1],this.zLayersPerRow=this.basePyramidSize/this.resolution,this.numLevels=this.pyramidLevelSizes.length-1,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.needsRebuild=!0}}get resolutionLevel(){return this._resolutionLevel}get spatialPassRenderTarget(){let t=this._spatialPassRenderTargets[this.resolutionLevel];return t||(t=new yr(this.spatialDivisions*this.spatialn,this.spatialDivisions**2,{format:kn,type:rn,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:nr,magFilter:nr}),this._spatialPassRenderTargets[this.resolutionLevel]=t),t}get potentialPassRenderTarget(){let t=this._potentialPassRenderTargets[this.resolutionLevel];return t||(t=new yr(this.basePyramidSize,this.basePyramidSize,{format:kn,type:rn,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:nr,magFilter:nr}),this._potentialPassRenderTargets[this.resolutionLevel]=t),t}get voxelPassRenderTarget(){let t=this._voxelPassRenderTargets[this.resolutionLevel];return t||(t=new dq(this.basePyramidSize,this.basePyramidSize,2,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:nr,magFilter:nr}),t.texture[0].format=kn,t.texture[0].type=rn,t.texture[1].format=WT,t.texture[1].type=rn,this._voxelPassRenderTargets[this.resolutionLevel]=t),t}get pyramidRenderTarget(){let t=this._pyramidRenderTargets[this.resolutionLevel];if(!t){let e=new yr(this.pyramidTexture1Width,this.pyramidTexture1Height,{format:kn,type:rn,stencilBuffer:!1,depthBuffer:!1,magFilter:nr,minFilter:nr}),i=new yr(this.pyramidTexture2Width,this.pyramidTexture2Height,{format:kn,type:rn,stencilBuffer:!1,depthBuffer:!1,magFilter:nr,minFilter:nr});t=[e,i],this._pyramidRenderTargets[this.resolutionLevel]=t}return t}updateState(t,e){let i=this.material;super.updateState(t,e),i!==this.material&&(this.needsRebuild=!0),t.geometry&&(this.resolutionLevel=t.geometry.resolutionLevel,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]}),t.wireframe&&!this.geometry.getAttribute("position")?this.geometry.setAttribute("position",new _i(new Float32Array(this.geometry.drawRange.count*3),3)):!t.wireframe&&this.geometry.getAttribute("position")&&this.geometry.deleteAttribute("position")}spatialPassMaterial(){let t=`
			precision highp float;
			out vec4 pc_FragColor;
			const float spatialDivisions = ${this.spatialDivisions}.;
			uniform float span;
			uniform float npart;
			uniform float spatialn;
			${xd.shapeInput()}

			vec3 low, high;     // range of current div; subset of -1 .. 1 with span border

			// lookup one element/channel's worth of spheres for current division
			// stating with low sphere number lowi
			// gives a key to which spheres from lowi..lowi+23 are active within given div (low..high)
			float spatialKey(float lowi) {
				float t = 0.;
				for (float ii = ${Ku-1}.; ii >= 0.; ii--) {
					float i = ii + lowi;
					float iin = (i + 0.5) / ${Qa}.;
					vec4 shape = shapePos(iin);
					vec3 d = shape.xyz;
					float op = shape.w;
	
					t *= 2.;
					t += (
						low.x < d.x && d.x < high.x &&
						low.y < d.y && d.y < high.y &&
						low.z < d.z && d.z < high.z &&
						i < npart || op == -2. // always include if op is -2, which is the intersection operation
					) ? 1. : 0.;
				}
				return t;
			}

			${xd.getpart}

			void main() {               // spatialial fragment shader
				// find active div
				vec3 div;                               // which div is current
				// out holds x=> x, lowi faster moving and y=> z, y faster moving
				float yz = float(gl_FragCoord.y - 0.5);     // contains  z, y faster moving
				div.y = getpart(yz, spatialDivisions);
				div.z = yz; // getpart(yz, spatialDivisions.z); // what's left, should be the same as getpart

				float lx = float(gl_FragCoord.x - 0.5);     // contains x, lowi faster moving
				float lowi = getpart(lx, spatialn) * ${4*Ku}.;
				div.x = lx;

				low = div / spatialDivisions * 2. - 1. - span;
				high = (div+1.) / spatialDivisions * 2. - 1. + span;

				// find active range of spheres
				pc_FragColor.x = spatialKey(lowi);
				pc_FragColor.y = spatialKey(lowi+${Ku}.);
				pc_FragColor.z = spatialKey(lowi+${2*Ku}.);
				pc_FragColor.w = spatialKey(lowi+${3*Ku}.);
			}
		`;return new iC({name:"Spatial Pass",fragmentShader:t,uniforms:this.spatialPassUniforms})}potentialPassMaterial(){let t=`
			precision highp float;
			out vec4 pc_FragColor;

			${xd.shapeInput()}
			uniform sampler2D spatialPassTexture;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.;
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			uniform float npart;
			uniform float spatialn;
			const float spatialDivisions = ${this.spatialDivisions}.;
			const float spatialDivisions2 = spatialDivisions * spatialDivisions;
			const float spatialDivisionsSub1 = spatialDivisions - 1.;

			${xd.getpart}

			vec3 packRGBAToVec3(vec4 color) {
				uint r = uint(color.r * 255.);
				uint g = uint(color.g * 255.);
				uint combined = (r << 8) | g; 
				return vec3(float(combined) * 0.00001525902, color.b, color.a); // 1/65535
			}

			void applyQuaternionToVector(in vec4 q, inout vec3 v) {
				v += 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);
			}

			/**
			 * SDF functions (reference: https://iquilezles.org/articles/distfunctions/)
			 */

			// branchless version of "Smooth Union, Subtraction and Intersection - bound, bound, bound" in above reference
			float smoothOperation(float op, float sdf, float d, float k) {
			  //        union: op =  1 => signSubtract =  1, signIntersection =  1
			  //     subtract: op = -1 => signSubtract = -1, signIntersection =  1
				// intersection: op = -2 => signSubtract = -1, signIntersection = -1

				float signSubtract = clamp(op, -1., 1.);
				float signIntersection = 2. * (op - signSubtract) + 1.;
				float h = clamp(
					0.5 + signSubtract * 0.5 * (sdf - signSubtract * signIntersection * d) / k,
					0.0,
					1.0
				);
				return mix(sdf, signSubtract * signIntersection * d, h) - 
							 signSubtract * k * h * (1.0 - h);
			}

			float sdSphere( vec3 p, float s )
			{
				return length(p)-s;
			}

			float sdEllipsoid( vec3 p, vec3 r )
			{
				float k0 = length(p/r);
				float k1 = length(p/(r*r));
				return k0*(k0-1.0)/k1;
			}

			float sdBox( vec3 p, vec3 b )
			{
				vec3 q = abs(p) - b;
				return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);
			}

			float sdTorus( vec3 p, vec2 t )
			{
				vec2 q = vec2(length(p.xy)-t.x,p.z);
				return length(q)-t.y;
			}

			float sdCappedTorus( vec3 p, vec2 sc, float ra, float rb)
			{
				p.x = abs(p.x);
				float k = (sc.y*p.x>sc.x*p.y) ? dot(p.xy,sc) : length(p.xy);
				return sqrt( dot(p,p) + ra*ra - 2.0*ra*k ) - rb;
			}

			float dot2( in vec2 v ) { return dot(v,v); }
			float sdCappedCone( vec3 p, float h, float r1, float r2 )
			{
				vec2 q = vec2( length(p.xz), p.y );
				vec2 k1 = vec2(r2,h);
				vec2 k2 = vec2(r2-r1,2.0*h);
				vec2 ca = vec2(q.x-min(q.x,(q.y<0.0)?r1:r2), abs(q.y)-h);
				vec2 cb = q - k1 + k2*clamp( dot(k1-q,k2)/dot2(k2), 0.0, 1.0 );
				float s = (cb.x<0.0 && ca.y<0.0) ? -1.0 : 1.0;
				return s*sqrt( min(dot2(ca),dot2(cb)) );
			}

			float sdCappedCylinder( vec3 p, float h, float r )
			{
				vec2 d = abs(vec2(length(p.xz),p.y)) - vec2(r,h);
				return min(max(d.x,d.y),0.0) + length(max(d,0.0));
			}

			float maxBlend = 0.0;
			// compute potential from A (=24) spheres, using the bit flags in 'activeKey'
			// to avoid lookup/compute for inactive spheres
			// return field potential, side effect updates track,
			// compute and return +ve and -ve values separately
			void fillSpatialInner(
				float ii,
				float activeKey,
				vec3 corner,
				inout float sdf,
				inout float colorDivisor,
				inout vec4 trackColor
			) {
				for (float i = 0.; i < ${Ku}.; i++) {
					if (activeKey < 1.) break; // activeKey exhausted, no more active spheres
					activeKey *= 0.5;
					if (fract(activeKey) < 0.5) continue;

					float iin = (i + ii + 0.5) * ${1/Qa};
					vec4 shape = shapePos(iin);
					vec4 quat = shapeQuat(iin);
					vec4 params1 = shapeParams1(iin);
					vec4 params2 = shapeParams2(iin);

					vec3 p = corner - shape.xyz;
					applyQuaternionToVector(quat, p);
					p /= params2.z; // scale
					float d; // d in -1..1 coordinates
					switch (int(params1.x)) {
						case 0: d = sdSphere(p, params1.y); break;
						case 1: d = sdEllipsoid(p, params1.yzw); break;
						case 2: d = sdBox(p, params1.yzw); break;
						case 3: d = sdCappedCylinder(p, params1.y, params1.z); break;
						case 4: d = sdCappedCone(p, params1.y, params1.z, params1.w); break;
						case 5: d = sdTorus(p, params1.yz); break;
						case 6: d = sdCappedTorus(p, params1.yz, params1.w, params2.w); break;
					}
					d -= params2.y; // rounded edge
					d *= params2.z; // scale

					float k = params2.x;
					float op = shape.w;

					sdf = smoothOperation(shape.w, sdf, d, k);

					float isNegativeOne = step(-1.5, op) * step(op, -0.5); // 1 when op == -1, 0 otherwise
					float colorCull = smoothstep(maxBlend, 0., -d);
					float cullFactor = mix(1.0, colorCull, isNegativeOne);
					trackColor *= cullFactor;
					colorDivisor *= cullFactor;

					maxBlend = max(maxBlend, k);

					k += 2. * INV_VOXEL_RESOLUTION; // avoid division by zero, and other color artifacts with very small k
					float nearness = smoothstep(k, 0., d);

					vec4 color = shapeColor(iin);
					nearness *= float(color.a >= 0.);

					colorDivisor += nearness;
					trackColor += color * nearness;
				}
			}

			vec3 div;
			// compute potential from all spheres; collect +ve and =ve values separately
			// work in blocks of A*4 (=96) spheres, using the bit flags in 4 float channel 'activeKey' values
			// TODO check if extra vec3 output useful, not really used at present
			float fillSpatial(vec3 corner, inout vec4 trackColor) {
				float sdf = 1e3; // hack: initialize to large value
				float colorDivisor = 0.;
				// spatialPassTexture holds x=> lowi, x faster moving and y=> z, y faster moving
				float divyz = (div.y + div.z * spatialDivisions + 0.5) / (spatialDivisions2);
				for (float ii = 0.; ii < spatialn; ii++) {
					float i = ii * ${4*Ku}.;

					vec4 activeKey = texture(spatialPassTexture, vec2((div.x * spatialn + ii + 0.5)/(spatialn * spatialDivisions), divyz));
					fillSpatialInner(i, activeKey.x, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${Ku}., activeKey.y, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${2*Ku}., activeKey.z, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${3*Ku}., activeKey.w, corner, sdf, colorDivisor, trackColor);
				}

				trackColor /= colorDivisor;
				return mix(sdf, 0.0, step(1e20 - 0.1, sdf));
			}

			void main() {
				${xd.getxyzi}    // get xi yi zi from 2d position

				vec3 xyzi = vec3(xi,yi,zi);
				vec3 corner = xyzi / VOXEL_RESOLUTION_SUB1 * 2. - 1.;  // -1..1 coords

				div = floor(xyzi / VOXEL_RESOLUTION_SUB1 * spatialDivisionsSub1);

				vec4 c = vec4(0.);
				float t = fillSpatial(corner, c);

				pc_FragColor = vec4(t, packRGBAToVec3(c)); // RGB texture
			}
		`;return new iC({name:"PotentialPass",fragmentShader:t,uniforms:this.potentialPassUniforms})}voxelPassMaterial(){let t=`
			precision highp float;
			layout(location = 0) out vec4 pc_FragColor;
			layout(location = 1) out vec4 numTris;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.; 
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;
			uniform sampler2D numTrisTable; // 256 x 1

			float keyi(float f000, float f100, float f010, float f110, float f001, float f101, float f011, float f111) {
				return (float(f000 < 0.) * 1.) +
							 (float(f100 < 0.) * 2.) +
							 (float(f010 < 0.) * 8.) +
							 (float(f110 < 0.) * 4.) +
							 (float(f001 < 0.) * 16.) +
							 (float(f101 < 0.) * 32.) +
							 (float(f011 < 0.) * 128.) +
							 (float(f111 < 0.) * 64.);
			}

			${xd.lookup}

			vec3 compNormi(float xi, float yi, float zi) {
				float dx = look(xi + 1., yi, zi, potentialPassTexture).r - look(xi - 1., yi, zi, potentialPassTexture).r;
				float dy = look(xi, yi + 1., zi, potentialPassTexture).r - look(xi, yi - 1., zi, potentialPassTexture).r;
				float dz = look(xi, yi, zi + 1., potentialPassTexture).r - look(xi, yi, zi - 1., potentialPassTexture).r;
				// if we allow (common) 0,0,0 case through then NaN can spread
				// eg r = vec4(compNorm i(???), 1.) will pollute r.w
				if (dx == 0.0 && dy == 0.0 && dz == 0.0) {
					return vec3(0.199, 0.299, 0.399);
				}
				return normalize(vec3(dx, dy, dz));
			}

			void main() {
				${xd.getxyzi}    // get xi yi zi from 2d

				vec3 normal = compNormi(xi, yi, zi);  // even if our key is -1 this may be needed by a neighbouring voxel

				if (xi >= VOXEL_RESOLUTION_SUB1 || yi >= VOXEL_RESOLUTION_SUB1 || zi >= VOXEL_RESOLUTION_SUB1) {
					pc_FragColor = vec4(normal, 0.);
					numTris = vec4(0.);
					return;
				}

				float
					f000 = look(xi, yi, zi, potentialPassTexture).r,
					f100 = look(xi+1., yi, zi, potentialPassTexture).r,
					f010 = look(xi, yi+1., zi, potentialPassTexture).r,
					f110 = look(xi+1., yi+1., zi, potentialPassTexture).r,
					f001 = look(xi, yi, zi+1., potentialPassTexture).r,
					f101 = look(xi+1., yi, zi+1., potentialPassTexture).r,
					f011 = look(xi, yi+1., zi+1., potentialPassTexture).r,
					f111 = look(xi+1., yi+1., zi+1., potentialPassTexture).r;
				float key = keyi(f000, f100, f010, f110, f001, f101, f011, f111);

				pc_FragColor = vec4(normal, key);

				numTris = texture(numTrisTable, vec2((key + 0.5) / 256., 0.5));
			}
		`;return new iC({name:"VoxelPass",fragmentShader:t,uniforms:this.voxelPassUniforms})}patchVertexShaderForShapeBlend(t){let e=`
		#ifdef SHAPEBLEND 
			precision highp sampler2D;

			uniform float isol;

			uniform sampler2D triTable;     // 256 x 16
			uniform sampler2D pyramidTexture1;
			uniform vec2 pyramidTexture1Size;
			uniform sampler2D pyramidTexture2;
			uniform vec2 pyramidTexture2Size;

			const vec2 halfPixelOffset = vec2(0.5, 0.5);

			const vec2 rShift = vec2(0., 1.);
			const vec2 gShift = vec2(1., 1.);
			const vec2 bShift = vec2(1., 0.);

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			const float scale_factor = ${Hf}.;

			#if SHAPEBLEND == 5
				const float levelShiftX[7] = float[7](4., 6., 12., 24., 48., 96., 192.);
				const float scale = 8. * scale_factor;
				const vec3 originOffset = vec3(16.);
			#elif SHAPEBLEND == 7
				const float levelShiftX[10] = float[10](4., 6., 12., 24., 48., 96., 192., 384., 768., 1536.); 
				const float scale = 2. * scale_factor;
				const vec3 originOffset = vec3(64.);
			#elif SHAPEBLEND == 8
				const float levelShiftX[11] = float[11](4., 8., 16., 32., 64., 128., 256., 512., 1024., 2048., 4096.);
				const float scale = scale_factor;
				const vec3 originOffset = vec3(128.);
			#else
				const float levelShiftX[8] = float[8](4., 8., 16., 32., 64., 128., 256., 512.);
				const float scale = 4. * scale_factor;
				const vec3 originOffset = vec3(32.);
			#endif

			${xd.lookup}

			const vec3 offsets[24] = vec3[](
				vec3(0., 0., 0.), vec3(1., 0., 0.),
				vec3(1., 0., 0.), vec3(1., 1., 0.),
				vec3(0., 1., 0.), vec3(1., 1., 0.),
				vec3(0., 0., 0.), vec3(0., 1., 0.),
				vec3(0., 0., 1.), vec3(1., 0., 1.),
				vec3(1., 0., 1.), vec3(1., 1., 1.),
				vec3(0., 1., 1.), vec3(1., 1., 1.),
				vec3(0., 0., 1.), vec3(0., 1., 1.),
				vec3(0., 0., 0.), vec3(0., 0., 1.),
				vec3(1., 0., 0.), vec3(1., 0., 1.),
				vec3(1., 1., 0.), vec3(1., 1., 1.),
				vec3(0., 1., 0.), vec3(0., 1., 1.)
			);

			vec2 computeShiftedPosition1(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture1Size;
			}

			vec2 computeShiftedPosition2(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture2Size;
			}

			vec4 unpackVec3ToRGBA(vec3 vec) {
				uint combined = uint(vec.x * 65535.0 + 0.5); // Add 0.5 for rounding
				float g = float(combined & uint(0xFF)) * 0.00392156862; // 1/255
				float r = float((combined >> 8) & uint(0xFF)) * 0.00392156862; 
		
				return vec4(r, g, vec.y, vec.z);
			}

			out vec4 marchColor;
			// end of marchvertPre
		#endif
		`,i=`
		#ifdef SHAPEBLEND
			float triIndex = floor(float(gl_VertexID/3));
			float vertexIndex = float(gl_VertexID);
			
			// Initial pyramid lookup
			float levelOriginX1 = pyramidTexture1Size.x - 2.;
			float levelOriginX2 = pyramidTexture2Size.x - 1.;
			vec2 xy = vec2(0.);
			vec4 lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));
			
			// Early exit check
			if (triIndex >= lookUp.r) return;
			
			// Optimize loop variables
			float start = 0.;
			vec4 triIndexVec = vec4(triIndex);
			
			// Main position computation loop
			for (int i = 0; i < LOOP;) {
				// Compute boundaries
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX2 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture1, computeShiftedPosition1(xy, levelOriginX1));
				i++;

				ends = lookUp + vec4(start);
				starts = vec4(ends.gba, start);
				check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX1 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));

				i++;
			}

			#if HALF == 1
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * vec4(lessThan(triIndexVec, ends));
			
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
			
				// Update loop variables
				start = dot(check, starts);
			#endif
			
			// Compute final coordinates
			vec3 gridPos;
			gridPos.x = mod(xy.x, VOXEL_RESOLUTION);
			gridPos.y = mod(xy.y, VOXEL_RESOLUTION);
			gridPos.z = floor(xy.x * INV_VOXEL_RESOLUTION) + 
									floor(xy.y * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
			
			// Vertex key computation
			vertexIndex -= start * 3.;
			float vk = vertexIndex * 0.0625 + 0.03125; // Optimized division by 16 and addition of 1/32
			
			// Voxel lookup and edge computation
			vec4 voxel = look(gridPos.x, gridPos.y, gridPos.z, voxelPassTexture);
			float key = (voxel.w + 0.5) * 0.00390625; // Optimized division by 256
			
			// Edge lookup and offset computation
			float edgeNum = texture(triTable, vec2(vk, key)).x;
			int edgeIndex = int(edgeNum) * 2;
			
			// Compute edge positions
			vec3 p1 = gridPos + offsets[edgeIndex];
			vec3 p2 = gridPos + offsets[edgeIndex + 1];
			
			// Compute potentials and normals
			vec4 potential1 = look(p1.x, p1.y, p1.z, potentialPassTexture);
			vec4 potential2 = look(p2.x, p2.y, p2.z, potentialPassTexture);
			
			// Final position and normal computation
			float mu = potential1.r / (potential1.r - potential2.r);

			marchColor = mix(
				unpackVec3ToRGBA(potential1.gba),
				unpackVec3ToRGBA(potential2.gba),
				mu
			);

			transformed = p1 + (p2 - p1) * mu;
			transformed -= originOffset;
			transformed *= scale;
			vec4 data1 = look(p1.x, p1.y, p1.z, voxelPassTexture);
			vec4 data2 = look(p2.x, p2.y, p2.z, voxelPassTexture);
			objectNormal = normalize(mix(data1.xyz, data2.xyz, mu));
			transformedNormal = normalMatrix * objectNormal;
			#ifndef FLAT_SHADED
				vNormal = transformedNormal;
			#endif
		#endif
		`;t.vertexShader=e+t.vertexShader.replace("#include <project_vertex>",i+`
#include <project_vertex>`);let r=t.fragmentShader.match(/vec3 diffuseColor[^\n]*\n/);if(!r)return;let n=`
		#ifdef SHAPEBLEND_C
			#if SHAPEBLEND_C == 1
				${r[0].replace(/nodeU0,/g,"marchColor.rgb,").replace(/nodeU\d+(?=,g_uid\d+_calpha\))/g,"marchColor.a")}
			#else
				${r[0]}
			#endif
		#else
			${r[0]}
		#endif
		`;t.fragmentShader=`in vec4 marchColor;
`+t.fragmentShader.replace(r[0],n),Object.assign(t.uniforms,this.marchPassUniforms)}initDebugPass(t){console.log("fboToDebug.width",t.width,t.height),this.geometry=new jd(t.width,t.height),this.geometry.userData={parameters:{width:4,height:4}};let e={inputTexture:{value:Array.isArray(t.texture)?t.texture[1]:t.texture},pyramidTextureSize:{value:void 0}},i=r=>{r.vertexShader=`
				precision highp float;

				varying vec2 vUv;

				void main() {
						gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
						vUv = uv;
				}
			`,r.fragmentShader=`
				layout(location = 1) out vec4 gVelocity;

				precision highp float;
				
				uniform sampler2D inputTexture;
				varying vec2 vUv;

				uniform vec2 pyramidTextureSize;

				void main() {
						// Sample the input texture using UV coordinates
						gl_FragColor = texture(inputTexture, vUv);
						gVelocity = vec4(0.0);
				}
			`,e.pyramidTextureSize.value=new Oe(this.pyramidRenderTarget.width,this.pyramidRenderTarget.height),Object.assign(r.uniforms,e)};this.material.shapeBlendhack=i,this.material.root.shapeBlendhack=i}},F0=tZ;F0.streamCompaction=new dCe;var fCe=new Ot,pCe=new Ot,yx=new Ci,Lm=new W,I2=new W,mCe=new Ci;function gCe(t,e=0){let i=this.children.length;for(;i--;){let r=this.children[i];U0.is(r)&&iZ.call(r,t,e+1)}}function iZ(t,e=0){if(t(this,e)!==!0){let i=this.children.length;for(;i--;){let r=this.children[i];U0.is(r)&&iZ.call(r,t,e+1)}}}function vCe(){if(this.shapesDataTexture.value===void 0){let a=new al(new Float32Array(4*Qa*r0),Qa,r0,kn,rn);this.shapesDataTexture.value=a}let t=this.shapesDataTexture.value,e=t.image.data;t.needsUpdate=!0;let i=0,r=this.data.geometry.blendRange,n=fCe.copy(this.matrixWorld).invert(),s=0;gCe.call(this,a=>{var b;if(a.visible===!1)return!0;let o;if(a instanceof eu||a instanceof ew||a instanceof tw)return;a instanceof io?o=a.object:o=a;let l=(b=a.data)==null?void 0:b.cloner;if(gr.is(a)&&l&&!l.hideBase&&l.type!=="radial"&&l.disabled!==!0||!(o instanceof Gs))return;let c=o.geometry.userData.parameters,u=c.shapeBlendNode;if(u===void 0)return;if(pCe.multiplyMatrices(n,a.matrixWorld).decompose(I2,yx,Lm),c.type==="TorusGeometry"&&c.arc!==360){let w=c.arc*Math.PI/180;w=w/4,yx.multiply(mCe.set(0,0,Math.sin(w),Math.cos(w)))}let h=u.overrideGlobalBlend?u.blendRange:r;h=h/this.bboxSize*2,e[s*4]=(I2.x-this.bboxOffset)/this.bboxSize*2,e[s*4+1]=(I2.y-this.bboxOffset)/this.bboxSize*2,e[s*4+2]=(I2.z-this.bboxOffset)/this.bboxSize*2,e[s*4+3]=u.operation===0?1:u.operation===2?-1:-2,e[Qa*4+s*4]=-yx.x,e[Qa*4+s*4+1]=-yx.y,e[Qa*4+s*4+2]=-yx.z,e[Qa*4+s*4+3]=yx.w;let d=new Float32Array(4),p=0;if(c.type==="SphereGeometry")c.width===c.height&&c.width===c.depth?d[0]=0:d[0]=1,d[1]=c.width/this.bboxSize,d[2]=c.height/this.bboxSize,d[3]=c.depth/this.bboxSize,i=Math.max(i,d[1]*Lm.x+h,d[2]*Lm.x+h,d[3]*Lm.x+h);else if(c.type==="CubeGeometry"){p=c.cornerRadius;let w=c.width,M=c.height,E=c.depth;d[0]=2,d[1]=(w-2*p)/this.bboxSize,d[2]=(M-2*p)/this.bboxSize,d[3]=(E-2*p)/this.bboxSize,i=Math.max(i,Math.sqrt(w**2+M**2+E**2)/this.bboxSize*Lm.x+h)}else if(c.type==="CylinderGeometry"){p=c.cornerRadius;let w=c.height,M=c.radiusBottom,E=c.radiusTop;if(E>=M){let D=Math.atan2(E-M,w),T=(Math.PI/2-D)/2;E-=p/Math.tan(T),M-=p*Math.tan(T)}else if(M>E){let D=Math.atan2(M-E,w),T=(Math.PI/2-D)/2;E-=p*Math.tan(T),M-=p/Math.tan(T)}d[1]=(c.height-2*p)/this.bboxSize,M===E?(d[0]=3,d[2]=M/this.bboxSize*2):(d[0]=4,d[2]=M/this.bboxSize*2,d[3]=E/this.bboxSize*2),i=Math.max(i,d[1]*4*Lm.x+h)}else if(c.type==="TorusGeometry"){if(d[0]=5,d[1]=(c.width-c.depth)/this.bboxSize,d[2]=c.depth/this.bboxSize,c.arc!==360){d[0]=6,d[3]=d[1],e[Qa*12+s*4+3]=d[2];let w=2*Math.atan2(d[2]/2,d[1]),M=c.arc*Math.PI/180/2-w;d[1]=Math.sin(M),d[2]=Math.cos(M)}i=Math.max(i,c.width*Lm.x/this.bboxSize+h)}e.set(d,Qa*8+s*4),e[Qa*12+s*4]=h,e[Qa*12+s*4+1]=p/this.bboxSize*2,e[Qa*12+s*4+2]=Lm.x;let g=o.material,x=g.uniforms.nodeU0.node.value,v=g.uniforms.nodeU1.value;u.operation!==0&&!u.useColor&&(v=-1),e[Qa*16+s*4]=x.r,e[Qa*16+s*4+1]=x.g,e[Qa*16+s*4+2]=x.b,e[Qa*16+s*4+3]=v,v<1&&this.material.defines.SHAPEBLEND_C===1&&(this.material.transparent=!0),s++}),this.npart=s,this.spatialPassUniforms.span.value=i*1.4}var rZ=512;function xj(t,e){let i=!1,r=t.layers.mask&rZ,n=e.getLayersOfType("transmission"),s=e.getLayersOfType("outline");return s.length>0&&(t.layers.set(8),n.length>0&&t.layers.enable(3),i=!0,M4(t),w4(t)),n.length===0&&s.length===0&&t.layers.set(0),r&&t.layers.set(9),t instanceof _b&&t.needsAO&&t.layers.enable(5),i}function bj(t,e){if(!e.layers)return!1;let i=t.layers.mask&rZ,r=!1,n=e.getLayersOfType("transmission").filter(a=>a.data.visible),s=e.getLayersOfType("outline").filter(a=>a.data.visible);return n.length>0&&(t.layers.set(3),s.length>0&&t.layers.enable(8),r=!0),n.length===0&&s.length===0&&t.layers.set(0),i&&t.layers.set(9),t.needsAO&&t.layers.enable(5),r}function yCe(t){let e=!1;return t.traverseEntity(i=>{if(i instanceof _b)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)xj(i,i.material[r])&&(e=!0);else xj(i,i.material)&&(e=!0)}),e}function xCe(t){let e=!1;return t.traverseEntity(i=>{if(i instanceof _b)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)bj(i,i.material[r])&&(e=!0);else bj(i,i.material)&&(e=!0)}),e}var bCe=new Hq,_Ce=new Ot,SCe=new ob;function dB(t,e,i,r=!1){let n=t.cloner;if(n)for(let s of n.children){let a=_Ce.copy(s.matrixWorld).invert(),o=SCe.copy(e.ray).applyMatrix4(a),l=t.matrixWorld;o.applyMatrix4(l);let c=bCe;c.set(o.origin,o.direction),c.near=e.near,c.far=e.far;let u=c.intersectObject(t,!1);u.length>0&&i.push({...u[0],object:r?s:t})}}var wCe=class{constructor(){this._constraints=new Map}setConstraint(t,e){e===null?this._constraints.delete(t):this._constraints.set(t,e)}removeDependencies(t){this._constraints.delete(t)}applyConstraints(t){let e=new Set;this._constraints.forEach((i,r)=>{let n=[r,i],s=i;for(;this._constraints.has(s);){if(s=this._constraints.get(s),n.includes(s)){console.warn(`circular dependency detected: ${n.join(" -> ")}`);break}e.has(s)||n.push(s)}for(let a=n.length-2;a>=0;a--)if(!e.has(n[a])){let o=t.find(n[a]);o?o.applyPathSnapping(t):console.warn(`missing entity ${n[a]}`),e.add(n[a])}})}findDependency(t,e){let i=t;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===e)return!0;return!1}},MCe="AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL",hg=class{};PS(hg,"DepthMapRange",65536),PS(hg,"MemoryPageSize",65536),PS(hg,"BytesPerFloat",4),PS(hg,"BytesPerInt",4);function ECe(t){let e,i,r,n,s,a,o,l,c,u,h,d,p,g,x,v;function b(U){let F=new Float64Array(u,a,16);for(let k=0;k<16;k++)F[k]=U[k];let V;if(r>1){e.exports.sortIndexes(n,s,c,a,o,l,d.DepthMapRange,r);let k=new Uint32Array(r);V=k.buffer,k.set(new Uint32Array(u,l,r))}else if(r===1){let k=new Uint32Array(r);k[0]=new Uint32Array(u,n,i)[0],V=k.buffer}else V=new ArrayBuffer(0);t.postMessage({sortDone:!0,indexesBuffer:V},[V])}function w(U,F,V){let k=new Float32Array(u,s,i*3);r=0;let K=new Uint32Array(u,n,i);for(let X=0;X<V.length-1;X++){let $=F[X],Y=U[X].elements,re=$.filter(j=>j.enabled&&j.mode==="Include").map(j=>j.type==="Box"?T(j):R(j)),G=$.filter(j=>j.enabled&&j.mode==="Exclude").map(j=>j.type==="Box"?T(j):R(j));for(let j=V[X];j<V[X+1];j++){let ee=p[j*3],oe=p[j*3+1],Q=p[j*3+2];if((re.length===0||E(ee,oe,Q,re))&&(G.length===0||!E(ee,oe,Q,G))){let ae=1/(Y[3]*ee+Y[7]*oe+Y[11]*Q+Y[15]);k[r*3]=(Y[0]*ee+Y[4]*oe+Y[8]*Q+Y[12])*ae,k[r*3+1]=(Y[1]*ee+Y[5]*oe+Y[9]*Q+Y[13])*ae,k[r*3+2]=(Y[2]*ee+Y[6]*oe+Y[10]*Q+Y[14])*ae,K[r]=j,r++}}}}function M(U,F){let V=[],k=F.filter($=>$.enabled&&$.mode==="Include").map($=>$.type==="Box"?T($):R($)),K=F.filter($=>$.enabled&&$.mode==="Exclude").map($=>$.type==="Box"?T($):R($)),X=U.length;for(let $=0;$<X;$+=3){let Y=U[$],re=U[$+1],G=U[$+2];(k.length===0||E(Y,re,G,k))&&(K.length===0||!E(Y,re,G,K))||V.push($/3)}return V}function E(U,F,V,k,K){return k[K==="Intersect"?"every":"some"](X=>{let $=D(U,F,V,X.invRotationMatrix,X.cropCenter);return Array.isArray(X)?P($.x,$.y,$.z,X):O($.x,$.y,$.z,X)})}function D(U,F,V,k,K){let X=U-K[0],$=F-K[1],Y=V-K[2],re=1/(k[3]*X+k[7]*$+k[11]*Y+k[15]);return{x:(k[0]*X+k[4]*$+k[8]*Y+k[12])*re+K[0],y:(k[1]*X+k[5]*$+k[9]*Y+k[13])*re+K[1],z:(k[2]*X+k[6]*$+k[10]*Y+k[14])*re+K[2]}}function T(U){let F=U.cropSize[0]/2,V=U.cropSize[1]/2,k=U.cropSize[2]/2,K=[U.cropCenter[0]-F,U.cropCenter[1]-V,U.cropCenter[2]-k,U.cropCenter[0]+F,U.cropCenter[1]+V,U.cropCenter[2]+k],X=L(U.cropRotation);return Object.assign(K,{invRotationMatrix:X,cropCenter:U.cropCenter})}function L(U){let F=[],V=U[0]*Math.PI/180,k=U[1]*Math.PI/180,K=U[2]*Math.PI/180,X=Math.cos(V),$=Math.sin(V),Y=Math.cos(k),re=Math.sin(k),G=Math.cos(K),j=Math.sin(K),ee=X*G,oe=X*j,Q=$*G,ae=$*j;return F[0]=Y*G,F[1]=-Y*j,F[2]=re,F[4]=oe+Q*re,F[5]=ee-ae*re,F[6]=-$*Y,F[8]=ae-ee*re,F[9]=Q+oe*re,F[10]=X*Y,F[12]=0,F[13]=0,F[14]=0,F[3]=0,F[7]=0,F[11]=0,F[15]=1,F}function P(U,F,V,k){return U>=k[0]&&U<=k[3]&&F>=k[1]&&F<=k[4]&&V>=k[2]&&V<=k[5]}function R(U){let F=2/U.cropSize[0],V=2/U.cropSize[1],k=2/U.cropSize[2],K=L(U.cropRotation);return{invRadiusX:F,invRadiusY:V,invRadiusZ:k,cropCenter:U.cropCenter,invRotationMatrix:K}}function O(U,F,V,k){let K=(U-k.cropCenter[0])*k.invRadiusX,X=(F-k.cropCenter[1])*k.invRadiusY,$=(V-k.cropCenter[2])*k.invRadiusZ;return K*K+X*X+$*$<=1}t.onmessage=U=>{if(U.data.getCroppedIndexes){let F=new Uint32Array(M(new Float32Array(U.data.positions),U.data.crops)).buffer;t.postMessage({outOfBoundsIndexes:F},[F])}else if(U.data.positions)h=U.data.positions,p=new Float32Array(h),x=U.data.meshMatrixWorlds,v=U.data.cropsArray,g=U.data.meshIndexIntervals,w(x,v,g),t.postMessage({sortSetupComplete:!0});else if(U.data.sort||U.data.newMatrixWorlds||U.data.newCropsArray)(U.data.newMatrixWorlds||U.data.newCropsArray)&&(v=U.data.newCropsArray||v,x=U.data.newMatrixWorlds||x,w(x,v,g)),b(U.data.sort.view,U.data.sort.cameraPosition);else if(U.data.init){d=U.data.init.Constants,i=U.data.init.splatCount;let F=d.BytesPerInt,V=d.BytesPerFloat*3,k=new Uint8Array(U.data.init.sorterWasmBytes),K=F+V,X=i*K,$=i*d.BytesPerInt*2+d.DepthMapRange*d.BytesPerInt*2,Y=d.MemoryPageSize*32,re=X+$+Y,G=Math.floor(re/d.MemoryPageSize)+1,j={module:{},env:{memory:new WebAssembly.Memory({initial:G*2,maximum:G*3,shared:!0})}};WebAssembly.compile(k).then(ee=>WebAssembly.instantiate(ee,j)).then(ee=>{e=ee,n=0,s=i*F,a=s+i*V,c=a+16*d.BytesPerFloat*2,o=c+i*d.BytesPerInt,l=o+d.DepthMapRange*d.BytesPerInt,u=j.env.memory.buffer,t.postMessage({sortSetupPhase1Complete:!0})})}}}function ACe(t){let e=new Worker(URL.createObjectURL(new Blob(["(",ECe.toString(),")(self)"],{type:"application/javascript"}))),i=atob(MCe),r=new Uint8Array(i.length);for(let n=0;n<i.length;n++)r[n]=i.charCodeAt(n);return e.postMessage({init:{sorterWasmBytes:r.buffer,splatCount:t,Constants:{BytesPerFloat:hg.BytesPerFloat,BytesPerInt:hg.BytesPerInt,DepthMapRange:hg.DepthMapRange,MemoryPageSize:hg.MemoryPageSize}}}),e}var AL=function(){let t=new Float32Array(1),e=new Int32Array(t.buffer);return function(i){return t[0]=i,e[0]}}(),TCe=function(t,e,i,r){return t+(e<<8)+(i<<16)+(r<<24)},z2=new Oe;function _j(t){let e=!1;return t.scene.objects.traverse((i,r)=>{if(r.visible===!1)return!0;r.type==="Splat"&&(e=!0)}),e}var nC=class extends bn{constructor(t,e,i,r,n=!1,s=1,a,o){super(i,r),this.splatCount=e,this.meshIndexIntervals=a,this.meshMatrixWorlds=o,this.splatBuffers=t,this.geometry=i,this.material=r,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=n,this.devicePixelRatio=s,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(t,e,i=!1,r=1,n,s){let a=nC.buildGeomtery(e),o=nC.buildMaterial(n);return new nC(t,e,a,o,i,r,n,s)}static buildMaterial(t){let e=`
            precision highp float;
            #include <common>

            attribute uint splatIndex;

            uniform highp sampler2D covariancesTexture;
            uniform highp usampler2D centersColorsTexture;
            uniform vec2 focal;
            uniform vec2 viewport;
            uniform vec2 basisViewport;
            uniform vec2 covariancesTextureSize;
            uniform vec2 centersColorsTextureSize;
						uniform highp sampler2D meshMatrixWorldsTexture;
						uniform uint meshIndexIntervals[257];
						uniform float orthoZoom;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;

            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);
            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));
            const uvec4 shift4 = uvec4(0, 8, 16, 24);
            vec4 uintToRGBAVec (uint u) {
               uvec4 urgba = mask4 & u;
               urgba = urgba >> shift4;
               vec4 rgba = vec4(urgba) * encodeNorm4;
               return rgba;
            }

            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {
                vec2 samplerUV = vec2(0.0, 0.0);
                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;
                samplerUV.y = float(floor(d)) / dimensions.y;
                samplerUV.x = fract(d);
                return samplerUV;
            }

            void main () {
                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));
                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));
                vColor = uintToRGBAVec(sampledCenterColor.r);

                vPosition = position.xy * 2.0;

								uint meshIndex;
								for (int i = 1; i < 257; i++) {
									if (splatIndex < meshIndexIntervals[i]) {
										meshIndex = uint(i - 1);
										break;
									}
								}

								float strideMulmeshIndex = float(4u*meshIndex);
								float meshMatrixWorldsTextureLength = float(256*4);

								mat4 modelMat = mat4(
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))
								);
								mat4 modelViewMat = viewMatrix * modelMat;
								vec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); 
                vec4 clipCenter = projectionMatrix * viewCenter;

                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;
                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;
                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;

                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);
                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);

                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix
                mat3 Vrk = mat3(
                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,
                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,
                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z
                );
                float s = 1.0 / (viewCenter.z * viewCenter.z);

                mat3 W = transpose(mat3(modelViewMat));
                mat3 T = orthoZoom > 0.0 ? W : W * mat3(
									focal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,
									0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,
									0., 0., 0.
								);
                mat3 cov2Dm = transpose(T) * Vrk * T;
                cov2Dm[0][0] += 0.3;
                cov2Dm[1][1] += 0.3;

                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because
                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],
                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't
                // need cov2Dm[1][0] because it is a symetric matrix.
                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);

                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;

                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix
                // so that we can determine the 2D basis for the splat. This is done using the method described
                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html
                //
                // This is a different approach than in the original work at INRIA. In that work they compute the
                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle
                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance
                // matrix (called 'conic') to determine fragment opacity.
                float a = cov2Dv.x;
                float d = cov2Dv.z;
                float b = cov2Dv.y;
                float D = a * d - b * b;
                float trace = a + d;
                float traceOver2 = 0.5 * trace;
                float term2 = sqrt(trace * trace / 4.0 - D);
                float eigenValue1 = traceOver2 + term2;
								float eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value

                const float maxSplatSize = 1024.0;
                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));
                // since the eigen vectors are orthogonal, we derive the second one from the first
                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);
                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);
                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);

                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;

								if (orthoZoom > 0.0) {
									ndcOffset *= orthoZoom;
								}

                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);
            }`,i=`
            precision highp float;
            #include <common>

            uniform vec3 debugColor;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;
						layout(location = 1) out vec4 gVelocity; 

            void main () {
                // compute the negative squared distance from the center of the splat to the
                // current fragment in the splat's local space.
                float A = -dot(vPosition, vPosition);
                if (A < -4.0) discard;
                vec3 color = vColor.rgb;
                A = exp(A) * vColor.a;
                gl_FragColor = vec4(color.rgb, A);
								gVelocity = vec4(0.0); // so it is ignored by TAA
            }`,r={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:t},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new Oe},viewport:{type:"v2",value:new Oe},basisViewport:{type:"v2",value:new Oe},debugColor:{type:"v3",value:new bi},covariancesTextureSize:{type:"v2",value:new Oe(1024,1024)},centersColorsTextureSize:{type:"v2",value:new Oe(1024,1024)},orthoZoom:{type:"f",value:-1}};return new xr({uniforms:r,vertexShader:e,fragmentShader:i,transparent:!0,alphaTest:1,blending:y0,depthTest:!0,depthWrite:!1,side:Oo})}static buildGeomtery(t){let e=new ni;e.setIndex([0,1,2,0,2,3]);let i=new Float32Array(4*3),r=new _i(i,3);e.setAttribute("position",r),r.setXYZ(0,-1,-1,0),r.setXYZ(1,-1,1,0),r.setXYZ(2,1,1,0),r.setXYZ(3,1,-1,0),r.needsUpdate=!0;let n=new kq().copy(e),s=new Uint32Array(t),a=new Ew(s,1,!1);return a.setUsage(rae),n.setAttribute("splatIndex",a),n.instanceCount=t,n}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach(r=>r.buildPreComputedBuffers()),this.covariances=new Float32Array(this.splatCount*6),this.colors=new Uint8Array(this.splatCount*4),this.centers=new Float32Array(this.splatCount*3);let t=0,e=0,i=0;for(let r of this.splatBuffers){let n=r.nsplats;this.colors.subarray(t,t+n*4).set(r.colorsA),t+=n*4,this.centers.subarray(e,e+n*3).set(r.decoded.xyz.denormDequant().data),e+=n*3,this.covariances.subarray(i,i+n*6).set(new Float32Array(r.precomputedCovarianceBufferData)),i+=n*6}}allocateAndStoreLocalSplatDataInTextures(){let t=this.splatCount,e=new Oe(4096,1024);for(;e.x*e.y*2<t*6;)e.y*=2;let i=new Oe(4096,1024);for(;i.x*i.y*4<t*4;)i.y*=2;let r,n;if(this.halfPrecisionCovariancesOnGPU){n=new Uint16Array(e.x*e.y*2);for(let u=0;u<this.covariances.length;u++)n[u]=Ide.toHalfFloat(this.covariances[u]);r=new al(n,e.x,e.y,SC,Ap)}else n=new Float32Array(e.x*e.y*2),n.set(this.covariances),r=new al(n,e.x,e.y,SC,rn);r.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=r,this.material.uniforms.covariancesTextureSize.value.copy(e);let s=new Uint32Array(i.x*i.y*4);for(let u=0;u<t;u++){let h=u*4,d=u*3,p=u*4;s[p]=TCe(this.colors[h],this.colors[h+1],this.colors[h+2],this.colors[h+3]),s[p+1]=AL(this.centers[d]),s[p+2]=AL(this.centers[d+1]),s[p+3]=AL(this.centers[d+2])}let a=new al(s,i.x,i.y,iq,pp);a.internalFormat="RGBA32UI",a.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=a,this.material.uniforms.centersColorsTextureSize.value.copy(i);let o=256*4,l=new Float32Array(256*16);for(let u=0;u<this.meshMatrixWorlds.length;u++)l.set(this.meshMatrixWorlds[u].elements,u*16);let c=new al(l,o,1,kn,rn);c.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=c,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:n,texture:r,size:e},centerColors:{data:s,texture:a,size:i},meshMatrixWorlds:{data:l,texture:c}}}updateIndexes(t){let e=this.geometry;e.attributes.splatIndex.set(t),e.attributes.splatIndex.needsUpdate=!0,e.instanceCount=t.length}updateUniforms(t,e,i,r){this.splatCount>0&&(z2.set(t.x*this.devicePixelRatio,t.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(z2),this.material.uniforms.basisViewport.value.set(2/z2.x,2/z2.y),this.material.uniforms.focal.value.set(e,i),this.material.uniforms.orthoZoom.value=r,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose()),this.removeFromParent()}},nZ,CCe=new Promise(t=>{nZ=t}),Sj=!1,U2;function DCe(){if(Sj)return;if(U2)return U2;async function t(){let e=await Cg(()=>import("./gaussian-splat-compression-BblNKJdU.js"),[]);nZ(e),Sj=!0}return U2=t(),U2}var sZ;CCe.then(t=>sZ=t);var PCe=class{constructor(t={}){PS(this,"updateView",function(){let e=new Ot,i=[],r=new W(0,0,-1),n=new W(0,0,-1),s=new W,a=new W;return function(o=!1,l){let c=this.updateMatrixWorldsInWorkerIfNeeded(),u=this.cropsChanged();if(!o){n.set(0,0,-1).applyQuaternion(l.quaternion);let d=!1,p=!1;if(n.dot(r)<=.95&&(d=!0),a.copy(l.position).sub(s).length()>=1&&(p=!0),!d&&!p&&!c&&!u&&!this.needsInitialRender)return}this.needsInitialRender=!1,s.copy(l.position),r.copy(n),e.copy(l.matrixWorld).invert(),e.premultiply(this.dummyPerspectiveMatrix),i[0]=l.position.x,i[1]=l.position.y,i[2]=l.position.z;let h={sort:{view:e.elements,cameraPosition:i,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...c?{newMatrixWorlds:this.meshMatrixWorlds}:{},...u?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=h:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(h))}}()),this.scene=t.scene,this.currentPage=null,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null,this.needsInitialRender=!0,this.dummyPerspectiveMatrix=new Ot().makePerspective(-1,1,-1,1,.1,1e3)}updateSplatMeshUniforms(t,e){let i=new Oe;this.splatMesh!==null&&this.splatMesh.getSplatCount()>0&&(t.getSize(i),this.cameraFocalLengthX=e.projectionMatrix.elements[0]*this.devicePixelRatio*i.x*.45,this.cameraFocalLengthY=e.projectionMatrix.elements[5]*this.devicePixelRatio*i.y*.45,this.splatMesh.updateUniforms(i,this.cameraFocalLengthX,this.cameraFocalLengthY,e.isPerspectiveCamera?-1:e.zoom*this.devicePixelRatio))}loadSplat(t={}){this.activePage=this.scene.activePage,t.position&&(t.position=new W().fromArray(t.position)),t.orientation&&(t.orientation=new Ci().fromArray(t.orientation)),t.halfPrecisionCovariances=!!t.halfPrecisionCovariances;let e=[];if(this.splatEntries=e,this.activePage.traverseVisibleEntity(s=>{s.data.type==="Splat"&&e.push(s)}),this.splatMesh&&this.splatMesh.dispose(),e.length===0)return this.splatMesh=null,!1;this.meshMatrixWorlds=e.map(s=>s.matrixWorld),this.meshMatrixWorldsOld=e.map(s=>s.matrixWorld.clone()),this.cropsArray=e.map(s=>s.data.crops.map(a=>a.data));let i=e.map(s=>new sZ.GSplineBuffer(new Uint8Array(s.data.buffer).buffer)),r=0,n=[0];for(let s of i)r+=s.getSplatCount(),n.push(r);return this.setupSplatMesh(i,r,t.position,t.orientation,t.halfPrecisionCovariances,this.devicePixelRatio,n,this.meshMatrixWorlds),this.setupSortWorker(r),!0}updateMatrixWorldsInWorkerIfNeeded(){let t=this.splatDataTextures.meshMatrixWorlds.data;for(let e=0;e<this.meshMatrixWorlds.length;e++)t.set(this.meshMatrixWorlds[e].elements,e*16);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,this.meshMatrixWorlds.every((e,i)=>e.equals(this.meshMatrixWorldsOld[i]))?!1:(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map(e=>e.clone()),!0)}cropsChanged(){let t=!1;return this.splatEntries.forEach((e,i)=>{var r;e.data.crops.forEach((n,s)=>{this.cropsArray[i][s]===void 0?(t=!0,this.cropsArray[i][s]=n.data):Object.entries(n.data).forEach(([a,o])=>{var l;Array.isArray(o)&&o.some((c,u)=>c!==this.cropsArray[i][s][a][u])?(t=!0,this.cropsArray[i][s][a]=o):o!==((l=this.cropsArray[i][s])==null?void 0:l[a])&&(t=!0,this.cropsArray[i][s][a]=o)})}),e.data.crops.length!==((r=this.cropsArray[i])==null?void 0:r.length)&&(this.cropsArray[i].length=e.data.crops.length,t=!0)}),t}setupSplatMesh(t,e,i=new W,r=new Ci,n=!1,s=1,a,o){this.splatMesh=nC.buildMesh(t,e,n,s,a,o),this.splatMesh.position.copy(i),this.splatMesh.quaternion.copy(r),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=99999,this.splatRenderCount=e,this.splatMesh.onBeforeRender=(l,c,u)=>this.update(l,u)}setupSortWorker(t){this.sortWorker=ACe(t),this.sortWorker.onmessage=e=>{var i;e.data.sortDone?(this.sortRunning=!1,(i=this.splatMesh)==null||i.updateIndexes(new Uint32Array(e.data.indexesBuffer)),this.lastSortTime=e.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):e.data.sortCanceled?this.sortRunning=!1:e.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):e.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.scene.activePage.add(this.splatMesh),this.needsInitialRender=!0)}}update(t,e){this.splatMesh!==null&&(this.updateSplatMeshUniforms(t,e),this.updateView(!1,e))}getSplatMesh(){return this.splatMesh}},fB=new Tp;fB.wireframe=!0;var wj=new W,U4=class extends ql{constructor(t,e){super(),this.data=t,this.sharedAssets=e,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.shapeBlendIntances=[],this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new wCe,this.invisibleObjects=new w1("jflkdsafjasdifjaslk",{...bU.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(t,e),this.matrixAutoUpdate=!1,this.errorPage=new Ca("fdasfa",{...V1.defaultData,name:""},{shared:e,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=xCe(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=yCe(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(t){let e=t.identity.join("-"),i=this.entityIdentityToEntity[e];i&&(t.uuid=i.uuid),this.entityIdentityToEntity[e]=t,this.entityByUuid[t.uuid]=t}markPenumbraSizeDirty(){for(let t of this.children)t instanceof Ca&&(t.penumbraSizeArrayCache=null)}findInstance(t){return this.entityIdentityToEntity[t.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(t){let e=this.find(t);if(e===void 0)return;let i=[],r=e;for(;r!==this;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:e,sortKey:i}}getAllSorted(t){let e=[];for(let i of t){let r=this.getWithSortKey(i.id);r!==void 0&&e.push(r)}return e.sort((i,r)=>CX(i.sortKey,r.sortKey)),e.map(i=>i.entity)}nonExistOrDescendantOf(t,e){let i=this.find(t);if(i===void 0)return!0;for(;i;){if(i.uuid===e)return!0;i=i.parent}return!1}find(t){if(this.activePage&&this.activePage.personalCamera.parent){if(t==="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera")return this.activePage.personalCamera;if(t===yb)return this.activePage.personalCamera}if(t===""||t===void 0)return;let e=this.entityByUuid[t];return e===void 0?this.getObjectByProperty("uuid",t):e}find2D(t){for(let e of this.children)if(e instanceof Ca&&e.uiScene){let i=e.uiScene.find(t);if(i)return i}}findScene2DfromObject2D(t){for(let e of this.children)if(e instanceof Ca&&e.uiScene&&e.uiScene.find(t))return e.uiScene}find2DInUIObjects(t){let e;return this.traverseEntity(i=>{e===void 0&&i instanceof Ro&&(e=i.uiCanvas.find(t))}),e}traverse2D(t){for(let e of this.children)e instanceof Ca&&e.uiScene&&e.uiScene.traverse(t)}debugEnsureEntity(t){let e=this.find(t);if(e){if(Array.isArray(e.identity)&&this.findInstance(e.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(t){this.toExpandCloner.add(t)}addPendingUpdateCloner(t){this.toUpdateCloner.add(t)}markToExpandCloner(t){this.toExpandCloner.add(t),t.traverseEntityAncestors(e=>{this.toExpandCloner.add(e)})}doPendingExpandCloner(){this.toExpandCloner.forEach(t=>{t.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(t=>{var e;(e=t.cloner)==null||e.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(t){this.pendingCommands.push(t)}applyPendingCommands(){this.pendingCommands.forEach(t=>t()),this.pendingCommands.length=0}updateByLibOp(t,e){t.path.length===1&&t.path[0]==="components"&&t.type===1&&this.createChildrenObjects([{...t.data.asset,id:t.id}],this.invisibleObjects,e)}updateTreeByOp(t,e){var i;if(t.path.length===0&&t.type===7){let r=t.parent===null?this:this.find(t.parent);if(r===void 0)throw new Error("unexpected");let n=this.createObject(t.id,t.data,t.children,r,t.localIndex,e);n.updateVisible(this),n.resetBBoxNeedsUpdate(),oh(n)&&yp(n.parent)&&(n.invalidateUpstreamBooleanData(),n.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(r),this.markNeedsRecomputeInstancesForChildren(n),this.markToExpandCloner(n),this.markPenumbraSizeDirty(),n.updatePathSnapping()}else if(t.path.length===0&&t.type===8){let r=this.find(t.id);if(r===void 0)throw new Error("unexpected");r.traverseEntity(s=>{s instanceof F0&&(this.shapeBlendIntances=this.shapeBlendIntances.filter(a=>a!==s))}),this.markToExpandCloner(r),r.resetBBoxNeedsUpdate(),this.unregisterObject(r);let n=r.parent;this.markNeedsRecomputeInstancesForAncessors(n),this.markNeedsRecomputeInstancesForChildren(r),this.markPenumbraSizeDirty(),r.parent.remove(r),yp(r.parent)&&(r.parent.invalidateUpstreamBooleanData(),r.parent.invalidateDownstreamBooleanData().recomputeBoolean()),oh(r)&&(r.freeBooleanPointer(),n instanceof N0&&n.invalidateDownstreamBooleanData().recomputeBoolean()),r instanceof O4&&r.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),this.pathConstraints.removeDependencies(r.uuid),r.updatePathSnapping()}else if(t.path.length===0&&t.type===9){let r=this.find(t.id);if(r===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(r);let n=r.parent;this.markNeedsRecomputeInstancesForAncessors(n),(i=r.cloner)==null||i.resetOnMove(),this.markToExpandCloner(r);let s=t.parent===null?this:this.find(t.parent);if(s===void 0)throw new Error("unexpected");s.add(r),this.markNeedsRecomputeInstancesForAncessors(s),this.markToExpandCloner(r),r.invalidateClonerTransform(r),r.updateVisible(this),r.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let a=t.localIndex;s.children.splice(a,0,s.children.pop()),oh(r)&&(r.invalidateUpstreamBooleanData(),yp(r.parent)?r.parent.invalidateDownstreamBooleanData().recomputeBoolean():n instanceof N0&&n.invalidateDownstreamBooleanData().recomputeBoolean()),r.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(t){var e;this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let i of this.children)i instanceof Ca&&(i.visible=i.uuid===t,i.visible&&(this.activePage=i,this.activePage.onActive(this)));this.activePage!==((e=this.splatViewer)==null?void 0:e.activePage)&&this.reloadSplats()}updateEntityByOp(t,e,i,r){if(e.type===0){if(("overrides"in e.props||"component"in e.props)&&this.markNeedsRecomputeInstances(),"visible"in e.props&&this.markPenumbraSizeDirty(),e.path.includes("overrides")&&"states"in e.props){let{rest:s}=e.props;e={...e,props:s},this.markNeedsRecomputeInstances()}e.path[0]==="pathSnapping"&&e.props.pathId!==void 0&&this.pathConstraints.setConstraint(t,e.props.pathId)}let n=this.find(t);if(n)try{uCe(n,e,i,{scene:this,shared:r}),n instanceof Gs&&n.updateGeometryGroupsIfNeeded()}catch(s){console.error(s)}}updateEntity2DByOp(t,e,i,r,n,s=[]){t.updateEntityByOp(e,i,r,n),this.traverseEntity(a=>{(a instanceof Ro||a instanceof Ca)&&(s.includes(a.frameId??"")||a.frameId===e)&&a.updateEntity2DByOp(e,i,r,n)})}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(t){this.activePage.switchActiveCamera(t)}isInvisibleObjects(t){return t===this.invisibleObjects||t.hasAnccestor(this.invisibleObjects)}init(t,e){let i=Object.entries(e.data.lib.components).map((r,n)=>({data:r[1].asset.data,children:r[1].asset.children,id:r[0],fi:n}));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:e}),this.add(this.invisibleObjects),this.createChildrenObjects(i,this.invisibleObjects,e),this.createChildrenObjects(t.objects,this,e),this.updatePage(t.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(e,!0),this.traverseEntity(r=>{r instanceof Io&&r.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(t){t.traverseEntity(e=>{(e.data.type==="Component"||e.data.type==="Instance")&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(t){gr.is(t)&&(t.data.type==="Component"&&this.markNeedsRecomputeInstances(),t.traverseAncestors(e=>{gr.is(e)&&e.data.type==="Component"&&this.markNeedsRecomputeInstances()}))}relativeizeInner(t,e,i,r,n,s,a){if(t){let o=r.find(t);o&&o!==r&&n.forInstancesRec(l=>{l.data=zw(l.data,c=>{let u=c.events.data(a.id),h=l.goUp(s);if(h){let d=[...TX(h.identity),t].join("-"),p=this.entityIdentityToEntity[d];if(p){let g=p.uuid,x=ra.zoom(u,e);x[i]=g}else console.warn("cannot find instance")}}).data})}}rewriteActions(t,e,i,r,n,s){t.forEach(a=>{a.data.type==="Transition"?this.relativeizeInner(a.data.object,[...e,a.id],"object",i,r,n,s):a.data.type==="Animation"?this.relativeizeInner(a.data.object,[...e,a.id],"object",i,r,n,s):a.data.type==="Conditional"&&(this.rewriteActions(a.data.ifActions,[...e,a.id,"ifActions"],i,r,n,s),this.rewriteActions(a.data.elseActions,[...e,a.id,"elseActions"],i,r,n,s))})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(t=>{if(t instanceof M1&&typeof t.identity=="string"&&t.data.type==="Component")return t.traverseEntity((e,i)=>{e.data.events.forEach(r=>{if(r.data.type==="GameControl"){let n=!1;if(e.forInstancesRec(s=>{s.data=zw(s.data,a=>{s.isInstanceRoot||(a.events.delete(r.id),n=!0)}).data}),n===!1)for(let s of nD.list)this.rewriteActions(r.data.gameActions[s],["gameActions",s],t,e,i,r)}else r.data.type==="Conditional"?(r.data.condition.type==="Distance"?(this.relativeizeInner(r.data.condition.fromObject,["condition"],"fromObject",t,e,i,r),this.relativeizeInner(r.data.condition.toObject,["condition"],"toObject",t,e,i,r)):r.data.condition.type==="State"?this.relativeizeInner(r.data.condition.object,["condition"],"object",t,e,i,r):r.data.condition.type==="Comparison"&&(r.data.condition.lOperand.type==="Property"&&this.relativeizeInner(r.data.condition.lOperand.value[0],["condition","lOperand","value"],0,t,e,i,r),r.data.condition.rOperand.type==="Property"&&this.relativeizeInner(r.data.condition.rOperand.value[0],["condition","rOperand","value"],0,t,e,i,r)),this.rewriteActions(r.data.inActions,["inActions"],t,e,i,r),this.rewriteActions(r.data.outActions,["outActions"],t,e,i,r)):"actions"in r.data&&this.rewriteActions(r.data.actions,["actions"],t,e,i,r)})}),!0})}expandInstances(t,e,i){let r=new Set;this.traverseEntity(n=>{if(n instanceof M1&&n.isInstanceRoot)return n.expandInstanceChildren({scene:this,shared:t,pendingDeletes:r}),e||n.resetBBoxNeedsUpdate(),i&&n.traverseEntity(s=>{i.addClip(s)}),!0});for(let n of r)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(n),I4(n)}recomputeInstances(t,e){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(i=>{i instanceof M1&&i.isInstanceRoot&&(i.component=void 0)}),this.expandInstances(t,!1,e))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(t){t.traverseEntity(e=>{let i=typeof e.identity=="string"?e.identity:e.identity.join("-");this.entityIdentityToEntity[i]===e&&(delete this.entityByUuid[e.uuid],delete this.entityIdentityToEntity[i]),e.dispose()})}clearScene(){for(let t of this.children)gr.is(t)&&t.disposeRecursively();this.children.length=0}resetAfterClear(t,e){this.init(t,e)}raycast(t){return this.raycast1(t,!1)}raycast1(t,e){let i=[],r=n=>{for(let s of n.children){let a=s.cloner;if(gr.is(s)&&!s.raycastLock&&(s.visible||a!=null&&a.object.data.visible))if(e===!0&&s.isInstanceRoot){let o=[];if(t.intersectObject(s,!0,o),o.length){let l=o[0];l.object=s,l.point.applyMatrix4(l.object.matrixWorld);let c=s.matrixWorld.clone().invert();l.point.applyMatrix4(c),i.push(l)}}else(oh(s)||tB(s)&&this.enableHelpers&&s.objectHelper.visible)&&(t.intersectObject(s,!1,i),dB(s,t,i)),r(s)}};return r(this.activePage),i}raycastWithClones(t){let e=[],i=r=>{for(let n of r.children){let s=n.cloner;gr.is(n)&&(n.visible||s!=null&&s.object.data.visible)&&((oh(n)||tB(n)&&this.enableHelpers&&n.objectHelper.visible)&&(t.intersectObject(n,!1,e),dB(n,t,e,!0)),i(n))}};return i(this),e}forEachEntity(t){for(let e of this.children)gr.is(e)&&t(e)}traverseConcreteEntity(t){for(let e of this.children)gr.is(e)&&e.isConcreteEntity&&e.traverseEntity(t)}traverseEntity(t){for(let e of this.children)gr.is(e)&&e.traverseEntity(t)}updateFont(t,e){this.traverseEntity(i=>{if(i instanceof Gs&&i.data.type==="Mesh"&&(i.data.geometry.type==="TextGeometry"||i.data.geometry.type==="InputGeometry")&&i.data.geometry.font===t){let r=i.geometry,n=i.data.geometry;r.updateFont(t,e).then(()=>{r.update(n);let s=i.invalidateDownstreamBooleanData();yp(s)&&s.recomputeBoolean()})}})}traverseObject(t){for(let e of this.children)U0.is(e)&&e.traverseObject(t)}traverseVisibleEntity(t){for(let e of this.children)gr.is(e)&&e.visible&&e.traverseVisibleEntity(t)}dispose(){this.clearScene()}createChildrenObjects(t,e,i){let r=0;for(let n of t)this.createObject(n.id,n.data,n.children,e,r,i),r+=1}registerObjectCreatedInLegacy(t){this.entityByUuid[t.uuid]=t}unregisterObject(t){delete this.entityByUuid[t.uuid];for(let e of t.children)this.unregisterObject(e)}createObject(t,e,i,r,n,s){var l;let a={scene:this,shared:s},o=z4(t,e,a);return o instanceof F0&&this.shapeBlendIntances.push(o),o&&(this.entityByUuid[t]=o,r.add(o),r.children.splice(n,0,r.children.pop()),i.length>0&&(o.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,o,s)),o.updateState(e,a),o instanceof Gs&&o.updateGeometryGroupsIfNeeded(),o.updateVisible(this),o.cloner&&this.toExpandCloner.add(o),(l=e.pathSnapping)!=null&&l.pathId&&this.pathConstraints.setConstraint(t,e.pathSnapping.pathId)),e.type==="Empty"&&e.animations&&o.traverseEntity(c=>{let u=c.dataPatched;if(c instanceof Gs&&u.bones&&u.boneInverses){let h=u.bones.map(g=>this.find(g)),d=u.boneInverses.map(g=>new Ot().fromArray(g)),p=new SN(h,d);c.bind(p,c.bindMatrix)}else c.matrixAutoUpdate=!0}),o}getCenter(t){let e=[];for(let r=0,n=t.length;r<n;++r){let{id:s,recursive:a}=t[r],o=this.find(s),l=a?o.recursiveBBox:o.singleBBox;e.push(...l.vertices)}let i=new Os;return i.setFromPoints(e),i.getCenter(wj),wj}copyMatrixWorld(t,e){if(t===null){e.identity();return}let i=this.find(t);i?e.copy(i.matrixWorld):e.identity()}copyParentMatrixWorld(t,e){var r;if(t===null){e.identity();return}let i=(r=this.find(t))==null?void 0:r.parent;i?e.copy(i.matrixWorld):e.identity()}traverseMaterial(t){this.traverseEntity(e=>{if(e instanceof hl)if(Array.isArray(e.material))for(let i=0;i<e.material.length;i++)e.material[i]instanceof wg&&t(e.material[i]);else e.material instanceof wg&&t(e.material)})}updateViewPlaneSize(t,e,i=!1){this.traverseConcreteEntity(r=>{r instanceof Io&&r.setViewplaneSize(t,e,i)})}initializeSplatViewer(){this.splatViewer=new PCe({scene:this}),this.reloadSplats()}reloadSplats(){var t;(t=this.splatViewer)==null||t.loadSplat()}},sC=(t,e)=>{let i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)},RCe=(t,e)=>{let i=e.x-t.x,r=e.y-t.y;return LCe(Math.atan2(r,i))},OCe=(t,e,i)=>{let r={x:0,y:0};return i=pB(i),r.x=t.x-e*Math.cos(i),r.y=t.y-e*Math.sin(i),r},pB=t=>t*(Math.PI/180),LCe=t=>t*(180/Math.PI),ICe=t=>isNaN(t.buttons)?t.pressure!==0:t.buttons!==0,TL=new Map,Mj=t=>{TL.has(t)&&clearTimeout(TL.get(t)),TL.set(t,setTimeout(t,100))},_D=(t,e,i)=>{let r=e.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],t.addEventListener?t.addEventListener(n,i,!1):t.attachEvent&&t.attachEvent(n,i)},Ej=(t,e,i)=>{let r=e.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],t.removeEventListener?t.removeEventListener(n,i):t.detachEvent&&t.detachEvent(n,i)},aZ=t=>(t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t),Aj=()=>{if(typeof window>"u")return;let t=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,e=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:t,y:e}},mB=(t,e)=>{e.top||e.right||e.bottom||e.left?(t.style.top=e.top,t.style.right=e.right,t.style.bottom=e.bottom,t.style.left=e.left):(t.style.left=e.x+"px",t.style.top=e.y+"px")},B4=(t,e,i)=>{let r=oZ(t);for(let n in r)if(r.hasOwnProperty(n))if(typeof e=="string")r[n]=e+" "+i;else{let s="";for(let a=0,o=e.length;a<o;a+=1)s+=e[a]+" "+i+", ";r[n]=s.slice(0,-2)}return r},zCe=(t,e)=>{let i=oZ(t);for(let r in i)i.hasOwnProperty(r)&&(i[r]=e);return i},oZ=t=>{let e={};return e[t]="",["webkit","Moz","o"].forEach(function(i){e[i+t.charAt(0).toUpperCase()+t.slice(1)]=""}),e},CL=(t,e)=>{for(let i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},UCe=(t,e)=>{let i={};for(let r in t)t.hasOwnProperty(r)&&e.hasOwnProperty(r)?i[r]=e[r]:t.hasOwnProperty(r)&&(i[r]=t[r]);return i},gB=(t,e)=>{if(t.length)for(let i=0,r=t.length;i<r;i+=1)e(t[i]);else e(t)},BCe=(t,e,i)=>({x:Math.min(Math.max(t.x,e.x-i),e.x+i),y:Math.min(Math.max(t.y,e.y-i),e.y+i)});typeof window<"u"&&(lZ="ontouchstart"in window,cZ=!!window.PointerEvent,uZ=!!window.MSPointerEvent);var lZ,cZ,uZ,hS={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},s1,Ww={};cZ?s1=hS.pointer:uZ?s1=hS.MSPointer:lZ?(s1=hS.touch,Ww=hS.mouse):s1=hS.mouse;function $0(){}$0.prototype.on=function(t,e){var i=this,r=t.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]=i._handlers_[n]||[],i._handlers_[n].push(e);return i};$0.prototype.off=function(t,e){var i=this;return i._handlers_=i._handlers_||{},t===void 0?i._handlers_={}:e===void 0?i._handlers_[t]=null:i._handlers_[t]&&i._handlers_[t].indexOf(e)>=0&&i._handlers_[t].splice(i._handlers_[t].indexOf(e),1),i};$0.prototype.trigger=function(t,e){var i=this,r=t.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach(function(a){a.call(i,{type:n,target:i},e)})};$0.prototype.config=function(t){var e=this;e.options=e.defaults||{},t&&(e.options=UCe(e.options,t))};$0.prototype.bindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[e]=function(){typeof i["on"+e]=="function"?i["on"+e].apply(i,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},_D(t,s1[e],i._domHandlers_[e]),Ww[e]&&_D(t,Ww[e],i._domHandlers_[e]),i};$0.prototype.unbindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},Ej(t,s1[e],i._domHandlers_[e]),Ww[e]&&Ej(t,Ww[e],i._domHandlers_[e]),delete i._domHandlers_[e],this};var N4=$0;function la(t,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=t,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(e),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=la.id,la.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}la.prototype=new N4;la.constructor=la;la.id=0;la.prototype.buildEl=function(t){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};la.prototype.stylize=function(){if(this.options.dataOnly)return this;var t=this.options.fadeTime+"ms",e=zCe("borderRadius","50%"),i=B4("transition","opacity",t),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},CL(r.el,i),this.options.shape==="circle"&&CL(r.back,e),CL(r.front,e),this.applyStyles(r),this};la.prototype.applyStyles=function(t){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var i in t[e])this.ui[e].style[i]=t[e][i];return this};la.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};la.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};la.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};la.prototype.show=function(t){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout(function(){e.ui.el.style.opacity=1},0),e.showTimeout=setTimeout(function(){e.trigger("shown",e.instance),typeof t=="function"&&t.call(this)},e.options.fadeTime)),e};la.prototype.hide=function(t){var e=this;if(e.options.dataOnly)return e;if(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout(function(){var i=e.options.mode==="dynamic"?"none":"block";e.ui.el.style.display=i,typeof t=="function"&&t.call(e),e.trigger("hidden",e.instance)},e.options.fadeTime),e.options.restJoystick){let i=e.options.restJoystick,r={};r.x=i===!0||i.x!==!1?0:e.instance.frontPosition.x,r.y=i===!0||i.y!==!1?0:e.instance.frontPosition.y,e.setPosition(t,r)}return e};la.prototype.setPosition=function(t,e){var i=this;i.frontPosition={x:e.x,y:e.y};var r=i.options.fadeTime+"ms",n={};n.front=B4("transition",["top","left"],r);var s={front:{}};s.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(n),i.applyStyles(s),i.restTimeout=setTimeout(function(){typeof t=="function"&&t.call(i),i.restCallback()},i.options.fadeTime)};la.prototype.restCallback=function(){var t=this,e={};e.front=B4("transition","none",""),t.applyStyles(e),t.trigger("rested",t.instance)};la.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};la.prototype.computeDirection=function(t){var e=t.angle.radian,i=Math.PI/4,r=Math.PI/2,n,s,a;if(e>i&&e<i*3&&!t.lockX?n="up":e>-i&&e<=i&&!t.lockY?n="left":e>-i*3&&e<=-i&&!t.lockX?n="down":t.lockY||(n="right"),t.lockY||(e>-r&&e<r?s="left":s="right"),t.lockX||(e>0?a="up":a="down"),t.force>this.options.threshold){var o={},l;for(l in this.direction)this.direction.hasOwnProperty(l)&&(o[l]=this.direction[l]);var c={};this.direction={x:s,y:a,angle:n},t.direction=this.direction;for(l in o)o[l]===this.direction[l]&&(c[l]=!0);if(c.x&&c.y&&c.angle)return t;(!c.x||!c.y)&&this.trigger("plain",t),c.x||this.trigger("plain:"+s,t),c.y||this.trigger("plain:"+a,t),c.angle||this.trigger("dir dir:"+n,t)}else this.resetDirection();return t};var NCe=la;function Ls(t,e){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=t,i.id=Ls.id,Ls.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(e),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let r=getComputedStyle(i.options.zone.parentElement);return r&&r.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}Ls.prototype=new N4;Ls.constructor=Ls;Ls.id=0;Ls.prototype.prepareNipples=function(){var t=this,e=t.nipples;e.on=t.on.bind(t),e.off=t.off.bind(t),e.options=t.options,e.destroy=t.destroy.bind(t),e.ids=t.ids,e.id=t.id,e.processOnMove=t.processOnMove.bind(t),e.processOnEnd=t.processOnEnd.bind(t),e.get=function(i){if(i===void 0)return e[0];for(var r=0,n=e.length;r<n;r+=1)if(e[r].identifier===i)return e[r];return!1}};Ls.prototype.bindings=function(){var t=this;t.bindEvt(t.options.zone,"start"),t.options.zone.style.touchAction="none",t.options.zone.style.msTouchAction="none"};Ls.prototype.begin=function(){var t=this,e=t.options;if(e.mode==="static"){var i=t.createNipple(e.position,t.manager.getIdentifier());i.add(),t.idles.push(i)}};Ls.prototype.createNipple=function(t,e){var i=this,r=i.manager.scroll,n={},s=i.options,a={x:i.parentIsFlex?r.x:r.x+i.box.left,y:i.parentIsFlex?r.y:r.y+i.box.top};if(t.x&&t.y)n={x:t.x-a.x,y:t.y-a.y};else if(t.top||t.right||t.bottom||t.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=t.top,o.style.right=t.right,o.style.bottom=t.bottom,o.style.left=t.left,o.style.position="absolute",s.zone.appendChild(o);var l=o.getBoundingClientRect();s.zone.removeChild(o),n=t,t={x:l.left+r.x,y:l.top+r.y}}var c=new NCe(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:e,position:t,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(mB(c.ui.el,n),mB(c.ui.front,c.frontPosition)),i.nipples.push(c),i.trigger("added "+c.identifier+":added",c),i.manager.trigger("added "+c.identifier+":added",c),i.bindNipple(c),c};Ls.prototype.updateBox=function(){var t=this;t.box=t.options.zone.getBoundingClientRect()};Ls.prototype.bindNipple=function(t){var e=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,e.trigger(i,s)};t.on("destroyed",e.onDestroyed.bind(e)),t.on("shown hidden rested dir plain",r),t.on("dir:up dir:right dir:down dir:left",r),t.on("plain:up plain:right plain:down plain:left",r)};Ls.prototype.pressureFn=function(t,e,i){var r=this,n=0;clearInterval(r.pressureIntervals[i]),r.pressureIntervals[i]=setInterval((function(){var s=t.force||t.pressure||t.webkitForce||0;s!==n&&(e.trigger("pressure",s),r.trigger("pressure "+e.identifier+":pressure",s),n=s)}).bind(r),100)};Ls.prototype.onstart=function(t){var e=this,i=e.options,r=t;t=aZ(t),e.updateBox();var n=function(s){e.actives.length<i.maxNumberOfNipples?e.processOnStart(s):r.type.match(/^touch/)&&(Object.keys(e.manager.ids).forEach(function(a){if(Object.values(r.touches).findIndex(function(l){return l.identifier===a})<0){var o=[t[0]];o.identifier=a,e.processOnEnd(o)}}),e.actives.length<i.maxNumberOfNipples&&e.processOnStart(s))};return gB(t,n),e.manager.bindDocument(),!1};Ls.prototype.processOnStart=function(t){var e=this,i=e.options,r,n=e.manager.getIdentifier(t),s=t.force||t.pressure||t.webkitForce||0,a={x:t.pageX,y:t.pageY},o=e.getOrCreate(n,a);o.identifier!==n&&e.manager.removeIdentifier(o.identifier),o.identifier=n;var l=function(u){u.trigger("start",u),e.trigger("start "+u.id+":start",u),u.show(),s>0&&e.pressureFn(t,u,u.identifier),e.processOnMove(t)};if((r=e.idles.indexOf(o))>=0&&e.idles.splice(r,1),e.actives.push(o),e.ids.push(o.identifier),i.mode!=="semi")l(o);else{var c=sC(a,o.position);if(c<=i.catchDistance)l(o);else{o.destroy(),e.processOnStart(t);return}}return o};Ls.prototype.getOrCreate=function(t,e){var i=this,r=i.options,n;return/(semi|static)/.test(r.mode)?(n=i.idles[0],n?(i.idles.splice(0,1),n):r.mode==="semi"?i.createNipple(e,t):(console.warn("Coudln't find the needed nipple."),!1)):(n=i.createNipple(e,t),n)};Ls.prototype.processOnMove=function(t){var e=this,i=e.options,r=e.manager.getIdentifier(t),n=e.nipples.get(r),s=e.manager.scroll;if(!ICe(t)){this.processOnEnd(t);return}if(!n){console.error("Found zombie joystick with ID "+r),e.manager.removeIdentifier(r);return}if(i.dynamicPage){var a=n.el.getBoundingClientRect();n.position={x:s.x+a.left,y:s.y+a.top}}n.identifier=r;var o=n.options.size/2,l={x:t.pageX,y:t.pageY};i.lockX&&(l.y=n.position.y),i.lockY&&(l.x=n.position.x);var c=sC(l,n.position),u=RCe(l,n.position),h=pB(u),d=c/o,p={distance:c,position:l},g,x;if(n.options.shape==="circle"?(g=Math.min(c,o),x=OCe(n.position,g,u)):(x=BCe(l,n.position,o),g=sC(x,n.position)),i.follow){if(c>o){let M=l.x-x.x,E=l.y-x.y;n.position.x+=M,n.position.y+=E,n.el.style.top=n.position.y-(e.box.top+s.y)+"px",n.el.style.left=n.position.x-(e.box.left+s.x)+"px",c=sC(l,n.position)}}else l=x,c=g;var v=l.x-n.position.x,b=l.y-n.position.y;n.frontPosition={x:v,y:b},i.dataOnly||mB(n.ui.front,n.frontPosition);var w={identifier:n.identifier,position:l,force:d,pressure:t.force||t.pressure||t.webkitForce||0,distance:c,angle:{radian:h,degree:u},vector:{x:v/o,y:-b/o},raw:p,instance:n,lockX:i.lockX,lockY:i.lockY};w=n.computeDirection(w),w.angle={radian:pB(180-u),degree:180-u},n.trigger("move",w),e.trigger("move "+n.id+":move",w)};Ls.prototype.processOnEnd=function(t){var e=this,i=e.options,r=e.manager.getIdentifier(t),n=e.nipples.get(r),s=e.manager.removeIdentifier(n.identifier);!n||(i.dataOnly||n.hide(function(){i.mode==="dynamic"&&(n.trigger("removed",n),e.trigger("removed "+n.id+":removed",n),e.manager.trigger("removed "+n.id+":removed",n),n.destroy())}),clearInterval(e.pressureIntervals[n.identifier]),n.resetDirection(),n.trigger("end",n),e.trigger("end "+n.id+":end",n),e.ids.indexOf(n.identifier)>=0&&e.ids.splice(e.ids.indexOf(n.identifier),1),e.actives.indexOf(n)>=0&&e.actives.splice(e.actives.indexOf(n),1),/(semi|static)/.test(i.mode)?e.idles.push(n):e.nipples.indexOf(n)>=0&&e.nipples.splice(e.nipples.indexOf(n),1),e.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(e.manager.ids[s.id]=s.identifier))};Ls.prototype.onDestroyed=function(t,e){var i=this;i.nipples.indexOf(e)>=0&&i.nipples.splice(i.nipples.indexOf(e),1),i.actives.indexOf(e)>=0&&i.actives.splice(i.actives.indexOf(e),1),i.idles.indexOf(e)>=0&&i.idles.splice(i.idles.indexOf(e),1),i.ids.indexOf(e.identifier)>=0&&i.ids.splice(i.ids.indexOf(e.identifier),1),i.manager.removeIdentifier(e.identifier),i.manager.unbindDocument()};Ls.prototype.destroy=function(){var t=this;t.unbindEvt(t.options.zone,"start"),t.nipples.forEach(function(i){i.destroy()});for(var e in t.pressureIntervals)t.pressureIntervals.hasOwnProperty(e)&&clearInterval(t.pressureIntervals[e]);t.trigger("destroyed",t.nipples),t.manager.unbindDocument(),t.off()};var FCe=Ls;function Ua(t){var e=this;e.ids={},e.index=0,e.collections=[],e.scroll=Aj(),e.config(t),e.prepareCollections();var i=function(){var n;e.collections.forEach(function(s){s.forEach(function(a){n=a.el.getBoundingClientRect(),a.position={x:e.scroll.x+n.left,y:e.scroll.y+n.top}})})};if(typeof window>"u")return e.collections;_D(window,"resize",function(){Mj(i)});var r=function(){e.scroll=Aj()};return _D(window,"scroll",function(){Mj(r)}),e.collections}Ua.prototype=new N4;Ua.constructor=Ua;Ua.prototype.prepareCollections=function(){var t=this;t.collections.create=t.create.bind(t),t.collections.on=t.on.bind(t),t.collections.off=t.off.bind(t),t.collections.destroy=t.destroy.bind(t),t.collections.get=function(e){var i;return t.collections.every(function(r){return i=r.get(e),!i}),i}};Ua.prototype.create=function(t){return this.createCollection(t)};Ua.prototype.createCollection=function(t){var e=this,i=new FCe(e,t);return e.bindCollection(i),e.collections.push(i),i};Ua.prototype.bindCollection=function(t){var e=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,e.trigger(i,s)};t.on("destroyed",e.onDestroyed.bind(e)),t.on("shown hidden rested dir plain",r),t.on("dir:up dir:right dir:down dir:left",r),t.on("plain:up plain:right plain:down plain:left",r)};Ua.prototype.bindDocument=function(){var t=this;t.binded||(t.bindEvt(document,"move").bindEvt(document,"end"),t.binded=!0)};Ua.prototype.unbindDocument=function(t){var e=this;(!Object.keys(e.ids).length||t===!0)&&(e.unbindEvt(document,"move").unbindEvt(document,"end"),e.binded=!1)};Ua.prototype.getIdentifier=function(t){var e;return t?(e=t.identifier===void 0?t.pointerId:t.identifier,e===void 0&&(e=this.latest||0)):e=this.index,this.ids[e]===void 0&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]};Ua.prototype.removeIdentifier=function(t){var e={};for(var i in this.ids)if(this.ids[i]===t){e.id=i,e.identifier=this.ids[i],delete this.ids[i];break}return e};Ua.prototype.onmove=function(t){var e=this;return e.onAny("move",t),!1};Ua.prototype.onend=function(t){var e=this;return e.onAny("end",t),!1};Ua.prototype.oncancel=function(t){var e=this;return e.onAny("end",t),!1};Ua.prototype.onAny=function(t,e){var i=this,r,n="processOn"+t.charAt(0).toUpperCase()+t.slice(1);e=aZ(e);var s=function(o,l,c){c.ids.indexOf(l)>=0&&(c[n](o),o._found_=!0)},a=function(o){r=i.getIdentifier(o),gB(i.collections,s.bind(null,o,r)),o._found_||i.removeIdentifier(r)};return gB(e,a),!1};Ua.prototype.destroy=function(){var t=this;t.unbindDocument(!0),t.ids={},t.index=0,t.collections.forEach(function(e){e.destroy()}),t.off()};Ua.prototype.onDestroyed=function(t,e){var i=this;if(i.collections.indexOf(e)<0)return!1;i.collections.splice(i.collections.indexOf(e),1)};var kCe=Ua,Tj=new kCe,VCe={create:function(t){return Tj.create(t)},factory:Tj},hZ=new Map,rw=new Map,d0=class{constructor(t,e,i,r){this.data=e;let{audio:n,volume:s,delay:a,loop:o}=e;if(!n)throw new Error("Missing property");let l=typeof n=="string"?r.getAudio(n).src:n.data;this.audioPlayer=new kS({src:l,volume:s,delay:a,loop:o}),rw.has(i.uuid)?rw.get(i.uuid).push(this):rw.set(i.uuid,[this]),hZ.set(t,this)}playByToggle(){this.data.toggle==="stop"?this.audioPlayer.status==="playing"?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):this.data.toggle==="pause"?this.audioPlayer.status==="playing"?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},vB=class{constructor(t){this.data=t}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(t){let e=hZ.get(t);!e||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):e.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(t){let e=rw.get(t);!(e!=null&&e.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(i=>i.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):e.forEach(i=>i.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let t=[...rw.values()];!t.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(e=>{e.forEach(i=>{i.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):t.forEach(e=>{e.forEach(i=>{i.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},dZ=class{constructor(t,e,i,r,n){if(this.data=e,this.shared=r,this.condition=n,e.interaction==="play")this.interaction=new d0(t,e,i,r);else if(e.interaction==="pause"||e.interaction==="stop")this.interaction=new vB(e);else throw new Error("Missing property")}dispatchBasic(){if(Cn(this.shared,this.condition)===!1)return!1;this.interaction instanceof d0?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(Cn(this.shared,this.condition)===!1)return!1;this.interaction instanceof d0?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(t){if(Cn(this.shared,this.condition)===!1)return!1;this.interaction instanceof d0&&(t==="start"?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},fZ=class{constructor(t,e,i,r){this.data=t,this.page=e,this.shared=i,this.condition=r,this.delay=0,this.emission=t.emission,t.delay!==void 0&&(this.delay=t.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop(this.delay):this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze(this.delay):this.unFreeze(this.delay)}start(t=0){if(t){this.delayTimerId=window.setTimeout(()=>{this.start(0),this.clearDelay()},t);return}this.particleSystem.start()}stop(t=0){if(t){this.delayTimerId=window.setTimeout(()=>{this.stop(0),this.clearDelay()},t);return}this.particleSystem.stop()}freeze(t=0){if(t){this.delayTimerId=window.setTimeout(()=>{this.freeze(0),this.clearDelay()},t);return}this.particleSystem.froze()}unFreeze(t=0){if(t){this.delayTimerId=window.setTimeout(()=>{this.unFreeze(0),this.clearDelay()},t);return}this.particleSystem.unFroze()}reset(t=0){if(t){this.delayTimerId=window.setTimeout(()=>{this.reset(0),this.clearDelay()},t);return}this.particleSystem.reset()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze();break}}dispatchBasic(){if(Cn(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze(this.delay);break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchConditional(){if(Cn(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchGameControl(t){if(Cn(this.shared,this.condition)===!1||!this.particleSystem)return!1;t==="start"?this.start(this.delay):this.stop(this.delay)}dispose(){!this.particleSystem||(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},HCe="text/plain",GCe="us-ascii",Cj=(t,e)=>e.some(i=>i instanceof RegExp?i.test(t):i===t),jCe=(t,{stripHash:e})=>{let i=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(t);if(!i)throw new Error(`Invalid URL: ${t}`);let{type:r,data:n,hash:s}=i.groups,a=r.split(";");s=e?"":s;let o=!1;a[a.length-1]==="base64"&&(a.pop(),o=!0);let l=(a.shift()||"").toLowerCase(),c=[...a.map(u=>{let[h,d=""]=u.split("=").map(p=>p.trim());return h==="charset"&&(d=d.toLowerCase(),d===GCe)?"":`${h}${d?`=${d}`:""}`}).filter(Boolean)];return o&&c.push("base64"),(c.length>0||l&&l!==HCe)&&c.unshift(l),`data:${c.join(";")},${o?n.trim():n}${s?`#${s}`:""}`};function WCe(t,e){if(e={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...e},t=t.trim(),/^data:/i.test(t))return jCe(t,e);if(/^view-source:/i.test(t))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=t.startsWith("//");!i&&/^\.*\//.test(t)||(t=t.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,e.defaultProtocol));let r=new URL(t);if(e.forceHttp&&e.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(e.forceHttp&&r.protocol==="https:"&&(r.protocol="http:"),e.forceHttps&&r.protocol==="http:"&&(r.protocol="https:"),e.stripAuthentication&&(r.username="",r.password=""),e.stripHash?r.hash="":e.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){let s=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,a=0,o="";for(;;){let c=s.exec(r.pathname);if(!c)break;let u=c[0],h=c.index,d=r.pathname.slice(a,h);o+=d.replace(/\/{2,}/g,"/"),o+=u,a=h+u.length}let l=r.pathname.slice(a,r.pathname.length);o+=l.replace(/\/{2,}/g,"/"),r.pathname=o}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}if(e.removeDirectoryIndex===!0&&(e.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(e.removeDirectoryIndex)&&e.removeDirectoryIndex.length>0){let s=r.pathname.split("/"),a=s[s.length-1];Cj(a,e.removeDirectoryIndex)&&(s=s.slice(0,-1),r.pathname=s.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),e.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(e.removeQueryParameters))for(let s of[...r.searchParams.keys()])Cj(s,e.removeQueryParameters)&&r.searchParams.delete(s);if(e.removeQueryParameters===!0&&(r.search=""),e.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}e.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,""));let n=t;return t=r.toString(),!e.removeSingleSlash&&r.pathname==="/"&&!n.endsWith("/")&&r.hash===""&&(t=t.replace(/\/$/,"")),(e.removeTrailingSlash||r.pathname==="/")&&r.hash===""&&e.removeSingleSlash&&(t=t.replace(/\/$/,"")),i&&!e.normalizeProtocol&&(t=t.replace(/^http:\/\//,"//")),e.stripProtocol&&(t=t.replace(/^(?:https?:)?\/\//,"")),t}var qCe=class{constructor({url:t,context:e},i,r,n){if(this.controlsManager=i,this.shared=r,this.condition=n,!t)throw new Error("Missing property");this.url=t.startsWith("mailto:")?t:WCe(t,{removeTrailingSlash:!1,removeSingleSlash:!1,stripWWW:!1}),this.context=e??"tab"}dispatch(){var t;if(Cn(this.shared,this.condition)===!1)return!1;AM?window.location.assign(this.url):(this.context==="tab"||AX&&this.context==="none"?window.open(this.url,"_blank"):this.context==="window"?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),(t=this.controlsManager.orbitControls)==null||t.onPointerUp(Ai[0]),l1e())}},pZ=class{constructor(t,e,i,r,n){this.data=t,this.page=e,this.controlsManager=i,this.shared=r,this.condition=n,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=s=>{var c,u;this.timeoutIdQueue.shift();let a=this.page.scene.find(s);if(a===void 0)return;let o=this.controlsManager.sharedGameControlGlobals.rapierWorld,l=o?(c=a.dataPatched.physics)==null?void 0:c.fusedBody:!0;if(a.cloner){for(let h of a.cloner.children)l?(h.playModeVisible=!1,h.rigidBody&&((u=a.dataPatched.physics)==null?void 0:u.rigidBody)==="positioned"&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(h.rigidBody.collider(0).handle),o.removeRigidBody(h.rigidBody),h.rigidBody=void 0),h.bvhGeometry&&(h.bvhGeometry=void 0)):this.clone===void 0||this.clone===h?(h.playModeVisible=!1,h.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(h.rigidBody.collider(0).handle),o.removeRigidBody(h.rigidBody),h.rigidBody=void 0)):h.playModeVisible===void 0&&(h.playModeVisible=!0);(l||this.clone===void 0||this.clone===!1)&&(a.visible=!1,a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0))}else a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0),a.visible=!1;o===void 0?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(h=>h.bvhGeometry!==void 0):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(h=>h.rigidBody!==void 0),a.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...t.objects]}dispatch(t){if(Cn(this.shared,this.condition)===!1)return!1;this.clone=t,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()}dispatchFromStart(){if(Cn(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))}dispose(){this.timeoutIdQueue.forEach(t=>window.clearTimeout(t))}},mZ=class{constructor(t,e,i,r,n){this.data=t,this.page=e,this.shared=i,this.eventManager=r,this.condition=n,this.shared=i}dispatch(){if(Cn(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout(()=>{var t;this.shared.reset(this.shared.data,!0),Q4(this.page,this.shared,!0),this.eventManager.reset(),(t=this.eventManager.controlsManager.gameControl)==null||t.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId},(this.data.delay??0)*1e3)}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},gZ={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},F4={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},XCe=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],SD={CSS:{},springs:{}};function dh(t,e,i){return Math.min(Math.max(t,e),i)}function nw(t,e){return t.indexOf(e)>-1}function DL(t,e){return t.apply(null,e)}var Di={arr:function(t){return Array.isArray(t)},obj:function(t){return nw(Object.prototype.toString.call(t),"Object")},pth:function(t){return Di.obj(t)&&t.hasOwnProperty("totalLength")},svg:function(t){return t instanceof SVGElement},inp:function(t){return t instanceof HTMLInputElement},dom:function(t){return!("isNode"in t)&&(t.nodeType||Di.svg(t))},str:function(t){return typeof t=="string"},fnc:function(t){return typeof t=="function"},und:function(t){return typeof t>"u"},hex:function(t){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)},rgb:function(t){return/^rgb/.test(t)},hsl:function(t){return/^hsl/.test(t)},col:function(t){return Di.hex(t)||Di.rgb(t)||Di.hsl(t)},key:function(t){return!gZ.hasOwnProperty(t)&&!F4.hasOwnProperty(t)&&t!=="targets"&&t!=="keyframes"}};function vZ(t){var e=/\(([^)]+)\)/.exec(t);return e?e[1].split(",").map(function(i){return parseFloat(i)}):[]}function yZ(t,e){var i=vZ(t),r=dh(Di.und(i[0])?1:i[0],.1,100),n=dh(Di.und(i[1])?100:i[1],.1,100),s=dh(Di.und(i[2])?10:i[2],.1,100),a=dh(Di.und(i[3])?0:i[3],.1,100),o=Math.sqrt(n/r),l=s/(2*Math.sqrt(n*r)),c=l<1?o*Math.sqrt(1-l*l):0,u=1,h=l<1?(l*o+-a)/c:-a+o;function d(g){var x=e?e*g/1e3:g;return l<1?x=Math.exp(-x*l*o)*(u*Math.cos(c*x)+h*Math.sin(c*x)):x=(u+h*x)*Math.exp(-x*o),g===0||g===1?g:1-x}function p(){var g=SD.springs[t];if(g)return g;for(var x=1/6,v=0,b=0;;)if(v+=x,d(v)===1){if(b++,b>=16)break}else b=0;var w=v*x*1e3;return SD.springs[t]=w,w}return e?d:p}function YCe(t){return t===void 0&&(t=10),function(e){return Math.ceil(dh(e,1e-6,1)*t)*(1/t)}}var QCe=function(){var t=11,e=1/(t-1);function i(u,h){return 1-3*h+3*u}function r(u,h){return 3*h-6*u}function n(u){return 3*u}function s(u,h,d){return((i(h,d)*u+r(h,d))*u+n(h))*u}function a(u,h,d){return 3*i(h,d)*u*u+2*r(h,d)*u+n(h)}function o(u,h,d,p,g){var x,v,b=0;do v=h+(d-h)/2,x=s(v,p,g)-u,x>0?d=v:h=v;while(Math.abs(x)>1e-7&&++b<10);return v}function l(u,h,d,p){for(var g=0;g<4;++g){var x=a(h,d,p);if(x===0)return h;var v=s(h,d,p)-u;h-=v/x}return h}function c(u,h,d,p){if(!(0<=u&&u<=1&&0<=d&&d<=1))return;var g=new Float32Array(t);if(u!==h||d!==p)for(var x=0;x<t;++x)g[x]=s(x*e,u,d);function v(b){for(var w=0,M=1,E=t-1;M!==E&&g[M]<=b;++M)w+=e;--M;var D=(b-g[M])/(g[M+1]-g[M]),T=w+D*e,L=a(T,u,d);return L>=.001?l(b,T,u,d):L===0?T:o(b,w,w+e,u,d)}return function(b){return u===h&&d===p||b===0||b===1?b:s(v(b),h,p)}}return c}(),xZ=function(){var t={linear:function(){return function(r){return r}}},e={Sine:function(){return function(r){return 1-Math.cos(r*Math.PI/2)}},Circ:function(){return function(r){return 1-Math.sqrt(1-r*r)}},Back:function(){return function(r){return r*r*(3*r-2)}},Bounce:function(){return function(r){for(var n,s=4;r<((n=Math.pow(2,--s))-1)/11;);return 1/Math.pow(4,3-s)-7.5625*Math.pow((n*3-2)/22-r,2)}},Elastic:function(r,n){r===void 0&&(r=1),n===void 0&&(n=.5);var s=dh(r,1,10),a=dh(n,.1,2);return function(o){return o===0||o===1?o:-s*Math.pow(2,10*(o-1))*Math.sin((o-1-a/(Math.PI*2)*Math.asin(1/s))*(Math.PI*2)/a)}}},i=["Quad","Cubic","Quart","Quint","Expo"];return i.forEach(function(r,n){e[r]=function(){return function(s){return Math.pow(s,n+2)}}}),Object.keys(e).forEach(function(r){var n=e[r];t["easeIn"+r]=n,t["easeOut"+r]=function(s,a){return function(o){return 1-n(s,a)(1-o)}},t["easeInOut"+r]=function(s,a){return function(o){return o<.5?n(s,a)(o*2)/2:1-n(s,a)(o*-2+2)/2}}}),t}();function k4(t,e){if(Di.fnc(t))return t;var i=t.split("(")[0],r=xZ[i],n=vZ(t);switch(i){case"spring":return yZ(t,e);case"cubicBezier":return DL(QCe,n);case"steps":return DL(YCe,n);default:return DL(r,n)}}function bZ(t){try{var e=document.querySelectorAll(t);return e}catch{return}}function eP(t,e){for(var i=t.length,r=arguments.length>=2?arguments[1]:void 0,n=[],s=0;s<i;s++)if(s in t){var a=t[s];e.call(r,a,s,t)&&n.push(a)}return n}function tP(t){return t.reduce(function(e,i){return e.concat(Di.arr(i)?tP(i):i)},[])}function Dj(t){return Di.arr(t)?t:(Di.str(t)&&(t=bZ(t)||t),t instanceof NodeList||t instanceof HTMLCollection?[].slice.call(t):[t])}function V4(t,e){return t.some(function(i){return i===e})}function H4(t){var e={};for(var i in t)e[i]=t[i];return e}function yB(t,e){var i=H4(t);for(var r in t)i[r]=e.hasOwnProperty(r)?e[r]:t[r];return i}function iP(t,e){var i=H4(t);for(var r in e)i[r]=Di.und(t[r])?e[r]:t[r];return i}function ZCe(t){var e=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(t);return e?"rgba("+e[1]+",1)":t}function KCe(t){var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=t.replace(e,function(o,l,c,u){return l+l+c+c+u+u}),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),n=parseInt(r[1],16),s=parseInt(r[2],16),a=parseInt(r[3],16);return"rgba("+n+","+s+","+a+",1)"}function JCe(t){var e=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(t),i=parseInt(e[1],10)/360,r=parseInt(e[2],10)/100,n=parseInt(e[3],10)/100,s=e[4]||1;function a(d,p,g){return g<0&&(g+=1),g>1&&(g-=1),g<1/6?d+(p-d)*6*g:g<1/2?p:g<2/3?d+(p-d)*(2/3-g)*6:d}var o,l,c;if(r==0)o=l=c=n;else{var u=n<.5?n*(1+r):n+r-n*r,h=2*n-u;o=a(h,u,i+1/3),l=a(h,u,i),c=a(h,u,i-1/3)}return"rgba("+o*255+","+l*255+","+c*255+","+s+")"}function $Ce(t){if(Di.rgb(t))return ZCe(t);if(Di.hex(t))return KCe(t);if(Di.hsl(t))return JCe(t)}function Sp(t){var e=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(t);if(e)return e[1]}function eDe(t){if(nw(t,"translate")||t==="perspective")return"px";if(nw(t,"rotate")||nw(t,"skew"))return"deg"}function xB(t,e){return Di.fnc(t)?t(e.target,e.id,e.total):t}function Ld(t,e){return t.getAttribute(e)}function G4(t,e,i){var r=Sp(e);if(V4([i,"deg","rad","turn"],r))return e;var n=SD.CSS[e+i];if(!Di.und(n))return n;var s=100,a=document.createElement(t.tagName),o=t.parentNode&&t.parentNode!==document?t.parentNode:document.body;o.appendChild(a),a.style.position="absolute",a.style.width=s+i;var l=s/a.offsetWidth;o.removeChild(a);var c=l*parseFloat(e);return SD.CSS[e+i]=c,c}function _Z(t,e,i){if(e in t.style){var r=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),n=t.style[e]||getComputedStyle(t).getPropertyValue(r)||"0";return i?G4(t,n,i):n}}function j4(t,e){if(Di.dom(t)&&!Di.inp(t)&&(Ld(t,e)||Di.svg(t)&&t[e]))return"attribute";if(Di.dom(t)&&V4(XCe,e))return"transform";if(Di.dom(t)&&e!=="transform"&&_Z(t,e))return"css";if(t[e]!=null)return"object"}function SZ(t){if(Di.dom(t)){for(var e=t.style.transform||"",i=/(\w+)\(([^)]*)\)/g,r=new Map,n;n=i.exec(e);)r.set(n[1],n[2]);return r}}function tDe(t,e,i,r){var n=nw(e,"scale")?1:0+eDe(e),s=SZ(t).get(e)||n;return i&&(i.transforms.list.set(e,s),i.transforms.last=e),r?G4(t,s,r):s}function W4(t,e,i,r){switch(j4(t,e)){case"transform":return tDe(t,e,r,i);case"css":return _Z(t,e,i);case"attribute":return Ld(t,e);default:return t[e]||0}}function q4(t,e){var i=/^(\*=|\+=|-=)/.exec(t);if(!i)return t;var r=Sp(t)||0,n=parseFloat(e),s=parseFloat(t.replace(i[0],""));switch(i[0][0]){case"+":return n+s+r;case"-":return n-s+r;case"*":return n*s+r}}function wZ(t,e){if(Di.col(t))return $Ce(t);if(/\s/g.test(t))return t;var i=Sp(t),r=i?t.substr(0,t.length-i.length):t;return e?r+e:r}function X4(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function iDe(t){return Math.PI*2*Ld(t,"r")}function rDe(t){return Ld(t,"width")*2+Ld(t,"height")*2}function nDe(t){return X4({x:Ld(t,"x1"),y:Ld(t,"y1")},{x:Ld(t,"x2"),y:Ld(t,"y2")})}function MZ(t){for(var e=t.points,i=0,r,n=0;n<e.numberOfItems;n++){var s=e.getItem(n);n>0&&(i+=X4(r,s)),r=s}return i}function sDe(t){var e=t.points;return MZ(t)+X4(e.getItem(e.numberOfItems-1),e.getItem(0))}function EZ(t){if(t.getTotalLength)return t.getTotalLength();switch(t.tagName.toLowerCase()){case"circle":return iDe(t);case"rect":return rDe(t);case"line":return nDe(t);case"polyline":return MZ(t);case"polygon":return sDe(t)}}function aDe(t){var e=EZ(t);return t.setAttribute("stroke-dasharray",e),e}function oDe(t){for(var e=t.parentNode;Di.svg(e)&&Di.svg(e.parentNode);)e=e.parentNode;return e}function AZ(t,e){var i=e||{},r=i.el||oDe(t),n=r.getBoundingClientRect(),s=Ld(r,"viewBox"),a=n.width,o=n.height,l=i.viewBox||(s?s.split(" "):[0,0,a,o]);return{el:r,viewBox:l,x:l[0]/1,y:l[1]/1,w:a/l[2],h:o/l[3]}}function lDe(t,e){var i=Di.str(t)?bZ(t)[0]:t,r=e||100;return function(n){return{property:n,el:i,svg:AZ(i),totalLength:EZ(i)*(r/100)}}}function cDe(t,e){function i(o){o===void 0&&(o=0);var l=e+o>=1?e+o:0;return t.el.getPointAtLength(l)}var r=AZ(t.el,t.svg),n=i(),s=i(-1),a=i(1);switch(t.property){case"x":return(n.x-r.x)*r.w;case"y":return(n.y-r.y)*r.h;case"angle":return Math.atan2(a.y-s.y,a.x-s.x)*180/Math.PI}}function Pj(t,e){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=wZ(Di.pth(t)?t.totalLength:t,e)+"";return{original:r,numbers:r.match(i)?r.match(i).map(Number):[0],strings:Di.str(t)||e?r.split(i):[]}}function TZ(t){var e=t?tP(Di.arr(t)?t.map(Dj):Dj(t)):[];return eP(e,function(i,r,n){return n.indexOf(i)===r})}function CZ(t){var e=TZ(t);return e.map(function(i,r){return{target:i,id:r,total:e.length,transforms:{list:SZ(i)}}})}function uDe(t,e){var i=H4(e);if(/^spring/.test(i.easing)&&(i.duration=yZ(i.easing)),Di.arr(t)){var r=t.length,n=r===2&&!Di.obj(t[0]);n?t={value:t}:Di.fnc(e.duration)||(i.duration=e.duration/r)}var s=Di.arr(t)?t:[t];return s.map(function(a,o){var l=Di.obj(a)&&!Di.pth(a)?a:{value:a};return Di.und(l.delay)&&(l.delay=o?0:e.delay),Di.und(l.endDelay)&&(l.endDelay=o===s.length-1?e.endDelay:0),l}).map(function(a){return iP(a,i)})}function hDe(t){for(var e=eP(tP(t.map(function(s){return Object.keys(s)})),function(s){return Di.key(s)}).reduce(function(s,a){return s.indexOf(a)<0&&s.push(a),s},[]),i={},r=function(s){var a=e[s];i[a]=t.map(function(o){var l={};for(var c in o)Di.key(c)?c==a&&(l.value=o[c]):l[c]=o[c];return l})},n=0;n<e.length;n++)r(n);return i}function dDe(t,e){var i=[],r=e.keyframes;r&&(e=iP(hDe(r),e));for(var n in e)Di.key(n)&&i.push({name:n,tweens:uDe(e[n],t)});return i}function fDe(t,e){var i={};for(var r in t){var n=xB(t[r],e);Di.arr(n)&&(n=n.map(function(s){return xB(s,e)}),n.length===1&&(n=n[0])),i[r]=n}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}function pDe(t,e){var i;return t.tweens.map(function(r){var n=fDe(r,e),s=n.value,a=Di.arr(s)?s[1]:s,o=Sp(a),l=W4(e.target,t.name,o,e),c=i?i.to.original:l,u=Di.arr(s)?s[0]:c,h=Sp(u)||Sp(l),d=o||h;return Di.und(a)&&(a=c),n.from=Pj(u,d),n.to=Pj(q4(a,u),d),n.start=i?i.end:0,n.end=n.start+n.delay+n.duration+n.endDelay,n.easing=k4(n.easing,n.duration),n.isPath=Di.pth(s),n.isColor=Di.col(n.from.original),n.isColor&&(n.round=1),i=n,n})}var DZ={css:function(t,e,i){return t.style[e]=i},attribute:function(t,e,i){return t.setAttribute(e,i)},object:function(t,e,i){return t[e]=i},transform:function(t,e,i,r,n){if(r.list.set(e,i),e===r.last||n){var s="";r.list.forEach(function(a,o){s+=o+"("+a+") "}),t.style.transform=s}}};function PZ(t,e){var i=CZ(t);i.forEach(function(r){for(var n in e){var s=xB(e[n],r),a=r.target,o=Sp(s),l=W4(a,n,o,r),c=o||Sp(l),u=q4(wZ(s,c),l),h=j4(a,n);DZ[h](a,n,u,r.transforms,!0)}})}function mDe(t,e){var i=j4(t.target,e.name);if(i){var r=pDe(e,t),n=r[r.length-1];return{type:i,property:e.name,animatable:t,tweens:r,duration:n.end,delay:r[0].delay,endDelay:n.endDelay}}}function gDe(t,e){return eP(tP(t.map(function(i){return e.map(function(r){return mDe(i,r)})})),function(i){return!Di.und(i)})}function RZ(t,e){var i=t.length,r=function(s){return s.timelineOffset?s.timelineOffset:0},n={};return n.duration=i?Math.max.apply(Math,t.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+l+s.duration*(s.loop??1)})):e.duration,n.delay=i?Math.min.apply(Math,t.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0;return r(s)+a+o+s.delay})):e.delay,n.endDelay=i?n.duration-Math.max.apply(Math,t.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+s.duration*(s.loop??1)-s.endDelay-l})):e.endDelay,n}var Rj=0;function vDe(t){var e=yB(gZ,t),i=yB(F4,t),r=dDe(i,t),n=CZ(t.targets),s=gDe(n,r),a=RZ(s,i),o=Rj;return Rj++,iP(e,{id:o,children:[],animatables:n,animations:s,duration:a.duration,delay:a.delay,endDelay:a.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}var su=[],Oj=[],aC,yDe=function(){function t(){aC=requestAnimationFrame(e)}function e(i){var r=su.length;if(r){for(var n=0;n<r;){var s=su[n];s.paused?(su.splice(n,1),r-=1):(s.tick(i),n++)}t()}else aC=cancelAnimationFrame(aC)}return t}();function xDe(t){document.hidden?(su.forEach(function(e){return e.pause(t.timeStamp)}),Oj=su.slice(0),Ps.running=su=[]):Oj.forEach(function(e){return e.play(t.timeStamp)})}typeof document<"u"&&document.addEventListener("visibilitychange",xDe);function Ps(t){t===void 0&&(t={});var e=0,i=0,r=0,n,s,a=0,o=null;function l(T){var L=window.Promise&&new Promise(function(P){return o=P});return T.finished=L,L}var c=vDe(t);l(c);function u(){var T=c.direction;T!=="alternate"&&(c.direction=T!=="normal"?"normal":"reverse"),c.reversed=!c.reversed,s.forEach(function(L){(L.loop===1||L.loop%2===0)&&(L.reversed=c.reversed)})}function h(){c.direction="normal",c.reversed=!1,s.forEach(function(T){return T.reversed=!1})}function d(T){return c.reversed?c.duration-T:T}function p(){e=0,i=d(c.currentTime)*(1/Ps.speed)}function g(T,L,P=!1){L&&(c.reversed?L.seek(L.duration*L.loop-(T-L.timelineOffset-L.pingPongDelayCorrection),P):L.seek(T-L.timelineOffset-L.startOnceDelay-L.pingPongDelayCorrection,P))}function x(T,L=!1){if(c.reversed)for(var P=a;P--;)g(T,s[P],L);else for(var R=0;R<a;R++)g(T,s[R],L)}function v(T){var ue,fe,xe,be,Ce,ge,Te,ce,Ue,ze;var L=0,P=c.animations,R=P.length;for(c.direction!=="alternate"&&((ue=c.parent)==null?void 0:ue.direction)==="alternate"?((fe=c.parent)==null?void 0:fe.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1&&((xe=c.parent)!=null&&xe.reversed&&c.direction==="alternate"?T=c.duration-c.delay+c.endDelay-T:T=c.duration+c.delay-c.endDelay-T):E(!1,(be=c.parent)==null?void 0:be.rewind,c.rewind,(Ce=c.parent)==null?void 0:Ce.reversePlayback,c.reversePlayback)&&((ge=c.parent)!=null&&ge.reversed&&c.direction==="alternate"?T=c.duration-c.delay+c.endDelay-T:T=c.duration+c.delay-c.endDelay-T);L<R;){var O=P[L],U=O.animatable,F=O.tweens,V=F.length-1,k=F[V];V&&(k=eP(F,function(De){return T<De.end})[0]||k);let Xe;(Te=c.parent)!=null&&Te.reversed&&c.direction==="alternate"?Xe=dh(T-k.start-k.endDelay,0,k.duration)/k.duration:Xe=dh(T-k.start-k.delay,0,k.duration)/k.duration;for(var K=isNaN(Xe)?1:k.easing(Xe),X=k.to.strings,$=k.round,Y=[],re=k.to.numbers.length,G=void 0,j=0;j<re;j++){var ee=void 0;let De,Ge;c.direction!=="alternate"?((ce=c.parent)==null?void 0:ce.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1?(De=k.to.numbers[j],Ge=k.from.numbers[j]||0):(Ge=k.to.numbers[j],De=k.from.numbers[j]||0):E(!0,(Ue=c.parent)==null?void 0:Ue.rewind,c.rewind,(ze=c.parent)==null?void 0:ze.reversePlayback,c.reversePlayback)?(De=k.to.numbers[j],Ge=k.from.numbers[j]||0):(Ge=k.to.numbers[j],De=k.from.numbers[j]||0),k.isPath?ee=cDe(k.value,K*Ge):ee=De+K*(Ge-De),$&&(k.isColor&&j>2||(ee=Math.round(ee*$)/$)),Y.push(ee)}var oe=X.length;if(!oe)G=Y[0];else{G=X[0];for(var Q=0;Q<oe;Q++){X[Q];var ae=X[Q+1],ne=Y[Q];isNaN(ne)||(ae?G+=ne+ae:G+=ne+" ")}}DZ[O.type](U.target,O.property,G,U.transforms),O.currentValue=G,L++}}function b(T){c[T]&&!c.passThrough&&c[T](c)}function w(){c.remaining&&c.remaining!==!0&&c.remaining--}let M={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function E(T,L,P,R,O){return M[T<<4|L<<3|P<<2|R<<1|O]}function D(T,L=!1){var F;var P=c.duration;let R=c.delay,O=P-c.endDelay;(F=c.parent)!=null&&F.reversed&&c.direction==="alternate"&&(R=c.endDelay,O=P-c.delay);var U=d(T);if(c.progress=dh(U/P*100,0,100),L||(c.reversePlayback=U<c.currentTime),a&&x(U,L),!c.began&&c.currentTime>=0&&(c.began=!0,b("begin")),!c.loopBegan&&c.currentTime>0&&(c.loopBegan=!0,b("loopBegin")),(c.reversed||U>=0)&&U<=R&&c.currentTime!==0&&(v(0),b("change")),(U>=O&&c.currentTime!==P+c.pingPongDelayCorrection||!P)&&(v(P),b("change")),U>R&&U<O?(c.changeBegan||(c.changeBegan=!0,c.changeCompleted=!1,b("changeBegin")),v(U),b("change")):c.changeBegan?(c.changeCompleted=!0,c.changeBegan=!1,b("change"),a&&b("timelineChangeComplete")):c.began&&U>O&&b("changeComplete"),c.currentTime=dh(U,0,P+c.pingPongDelayCorrection),c.began&&b("update"),T>=P)if(w(),!c.remaining)c.paused=!0,c.completed||(c.completed=!0,b("loopComplete"),b("complete"),!c.passThrough&&"Promise"in window&&(o(),l(c)));else{a?e+=c.duration/Ps.speed:e+=c.duration;for(let V of s)V.setStartTime(0),V.remaining=V.loop;b("loopComplete"),c.loopBegan=!1,c.direction==="alternate"?u():a&&h()}}return c.reset=function(){var T=c.direction;c.passThrough=!1,c.currentTime=0,c.progress=0,c.paused=!0,c.began=!1,c.loopBegan=!1,c.changeBegan=!1,c.completed=!1,c.changeCompleted=!1,c.reversePlayback=!1,c.reversed=T==="reverse",c.remaining=c.loop,s=c.children,a=s.length;for(var L=a;L--;)c.children[L].reset();v(c.reversed?c.duration:0)},c.setStartTime=function(T){e=T},c.set=function(T,L){return PZ(T,L),c},c.tick=function(T){r=T,e||(e=r),D((r+(i-e))*Ps.speed)},c.seek=function(T,L=!1){D(T-e,L)},c.pause=function(T){c.paused=!0,a&&(n=T??performance.now())},c.play=function(T){!c.paused||(c.completed&&c.reset(),c.paused=!1,su.push(c),a&&n!==void 0&&(e+=(T??performance.now())-n),aC||yDe())},c.reverse=function(){u(),c.completed=!c.reversed,p()},c.restart=function(){c.reset(),c.play()},c.reset(),c.autoplay&&c.play(),c}function Lj(t,e){for(var i=e.length;i--;)V4(t,e[i].animatable.target)&&e.splice(i,1)}function bDe(t){for(var e=TZ(t),i=su.length;i--;){var r=su[i],n=r.animations,s=r.children;Lj(e,n);for(var a=s.length;a--;){var o=s[a],l=o.animations;Lj(e,l),!l.length&&!o.children.length&&s.splice(a,1)}!n.length&&!s.length&&r.pause()}}function _De(t,e){e===void 0&&(e={});var i=e.direction||"normal",r=e.easing?k4(e.easing):null,n=e.grid,s=e.axis,a=e.from||0,o=a==="first",l=a==="center",c=a==="last",u=Di.arr(t),h=parseFloat(u?t[0]:t),d=u?parseFloat(t[1]):0,p=Sp(u?t[1]:t)||0,g=e.start||0+(u?h:0),x=[],v=0;return function(b,w,M){if(o&&(a=0),l&&(a=(M-1)/2),c&&(a=M-1),!x.length){for(var E=0;E<M;E++){if(!n)x.push(Math.abs(a-E));else{var D=l?(n[0]-1)/2:a%n[0],T=l?(n[1]-1)/2:Math.floor(a/n[0]),L=E%n[0],P=Math.floor(E/n[0]),R=D-L,O=T-P,U=Math.sqrt(R*R+O*O);s==="x"&&(U=-R),s==="y"&&(U=-O),x.push(U)}v=Math.max.apply(Math,x)}r&&(x=x.map(function(V){return r(V/v)*v})),i==="reverse"&&(x=x.map(function(V){return s?V<0?V*-1:-V:Math.abs(v-V)}))}var F=u?(d-h)/v:h;return g+F*(Math.round(x[w]*100)/100)+p}}function SDe(t){t===void 0&&(t={});var e=Ps(t);return e.duration=0,e.add=function(i,r){var n=su.indexOf(e),s=e.children;n>-1&&su.splice(n,1);function a(d){d.passThrough=!0}for(var o=0;o<s.length;o++)a(s[o]);var l=iP(i,yB(F4,t));l.targets=l.targets||t.targets;var c=e.duration;l.autoplay=!1,l.timelineOffset=Di.und(r)?c:q4(r,c),a(e);var u=Ps(l);a(u),s.push(u),u.parent=e;var h=RZ(s,t);return e.delay=h.delay,e.endDelay=h.endDelay,e.duration=h.duration,u.loop===!0&&(e.duration=1/0),e.seek(0),e.reset(),e.autoplay&&e.play(),e},e}Ps.version="3.2.0";Ps.speed=1;Ps.running=su;Ps.remove=bDe;Ps.get=W4;Ps.set=PZ;Ps.convertPx=G4;Ps.path=lDe;Ps.setDashoffset=aDe;Ps.stagger=_De;Ps.timeline=SDe;Ps.easing=k4;Ps.penner=xZ;Ps.random=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};var OZ=Ps,Ij=new W,zj=new W,Uj=new Ci;function wDe(t,e,i,r){if(r===0)return i.copy(t);if(r===1)return i.copy(e);let n=t.w*e.w+t.x*e.x+t.y*e.y+t.z*e.z;if(n>=1)return i.copy(t);let s=1-n*n;if(s<=Number.EPSILON){let u=1-r;return i.w=u*t.w+r*e.w,i.x=u*t.x+r*e.x,i.y=u*t.y+r*e.y,i.z=u*t.z+r*e.z,i.normalize(),i}let a=Math.sqrt(s),o=Math.atan2(a,n),l=Math.sin((1-r)*o)/a,c=Math.sin(r*o)/a;return i.w=t.w*l+e.w*c,i.x=t.x*l+e.x*c,i.y=t.y*l+e.y*c,i.z=t.z*l+e.z*c,i}function Ka(t,e,i,r,n,s){let a=i[t]!==void 0?i[t]:void 0,o=r[t];if(o==null)return;let l=a!=null?typeof a=="string"?Number(n.getVariable(a)??0):a:e[t],c=typeof o=="string"?Number(n.getVariable(o)??0):o;if(l!==c)return{update:u=>{let h=Qt.lerp(l,c,u);s?e[t]=Math.trunc(h):e[t]=h},start:()=>{e[t]=l},end:()=>{e[t]=c}}}function Y4(t,e,i,r,n,s){let a=i[t]?i[t]:void 0,o=r[t];if(!o)return;let l=e[t],c=[...a??l].map(h=>typeof h=="string"?Number(n.getVariable(h)??0):h),u=[...o].map(h=>typeof h=="string"?Number(n.getVariable(h)??0):h);if(!(c.length!==u.length||YN(c,u)))return{update:h=>{c.forEach((d,p)=>{let g=Qt.lerp(d,u[p],h);e[t][p]=s?Math.trunc(g):g})},start:()=>{Object.assign(e[t],c)},end:()=>{Object.assign(e[t],u)}}}function wD(t,e,i){return e.forEach((r,n)=>{t.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),t}function Bj(t,e,i,r,n){let s=i[t]?i[t]:void 0,a=r[t];if(!a)return;let o=e[t],l=s?wD(new W,s,n):o.clone(),c=wD(new W,a,n);if(!l.equals(c))return{update:u=>{o.lerpVectors(l,c,u)},start:()=>{o.copy(l)},end:()=>{o.copy(c)}}}function Nj(t,e,i){return e.forEach((r,n)=>{t.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),t}function MD(t,e,i,r,n){let s=i[t]?i[t]:void 0,a=r[t];if(!a)return;let o=e[t],l=!(o instanceof Oe),c=o instanceof Oe?o:new Oe().fromArray(o),u=s?Nj(new Oe,s,n):c.clone(),h=Nj(new Oe,a,n);if(!u.equals(h))return{update:d=>{c.lerpVectors(u,h,d),l&&(e[t]=c.toArray())},start:()=>{c.copy(u),l&&(e[t]=c.toArray())},end:()=>{c.copy(h),l&&(e[t]=c.toArray())}}}function MDe(t,e,i,r){let n=i[t]?i[t]:void 0,s=r[t];if(!s)return;let a=e[t],o=n?new Ot().fromArray(n):a.clone(),l=new W,c=new Ci,u=new W;o.decompose(l,c,u);let h=new Ot().fromArray(s),d=new W,p=new Ci,g=new W;if(h.decompose(d,p,g),!o.equals(h))return{update:x=>{Uj.slerpQuaternions(c,p,x),Ij.lerpVectors(l,d,x),zj.lerpVectors(u,g,x),a.compose(Ij,Uj,zj)},start:()=>{a.compose(l,c,u)},end:()=>{a.compose(d,p,g)}}}function EDe(t,e,i,r,n){let s=i[t]?i[t]:void 0,a=r[t];if(!a)return;let o=e[t],l=s?typeof s=="string"?n.getColor(s).clone():new bi().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new bi().setRGB(a.r,a.g,a.b);if(l.equals(c))return;let u=o.clone();return{update:h=>{var d,p;u.lerpColors(l,c,h),(p=(d=e[t])==null?void 0:d.copy)==null||p.call(d,u)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function B2(t,e,i,r,n){let s=i[t]?i[t]:void 0,a=r[t];if(!a)return;let o=e[t],l=new ro(o.r,o.g,o.b,o.a),c=s?typeof s=="string"?n.getColor(s).clone():new ro(s.r,s.g,s.b,s.a):l.clone(),u=typeof a=="string"?n.getColor(a).clone():new ro(a.r,a.g,a.b,a.a);if(!c.equals(u))return{update:h=>{l.lerpColors(c,u,h);let d=Qt.lerp(c.a,u.a,h);l.a=d,e[t]={r:l.r,g:l.g,b:l.b,a:l.a}},start:()=>{l.copy(c)},end:()=>{l.copy(u)}}}function Og(t,e,i,r,n){if(typeof e[t]=="number")return Ka(t,e,i??{},r,n);if(Array.isArray(e[t]))return Y4(t,e,i??{},r,n)}function ADe(t,e,i,r){var o,l,c,u;let n=[],s=t.cameraType==="OrthographicCamera"?(o=e.orthographic)==null?void 0:o.zoom:(l=e.perspective)==null?void 0:l.zoom,a=t.cameraType==="OrthographicCamera"?(c=i.orthographic)==null?void 0:c.zoom:(u=i.perspective)==null?void 0:u.zoom;if(a!==void 0){let h=s??t.zoom,d=a;h!==d&&n.push({update:p=>{t.zoom=Qt.lerp(h,d,p),t.updateProjectionMatrix()},start:()=>{t.zoom=h,t.updateProjectionMatrix()},end:()=>{t.zoom=d,t.updateProjectionMatrix()}})}if(i.targetOffset!==void 0){let h=Ka("targetOffset",t,e,i,r);h&&n.push(h)}return n}function TDe(t,e,i,r){if(i.scaleBaked===void 0)return;let n=(e.scaleBaked??t.data.geometry.scaleBaked).map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o),s=i.scaleBaked.map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o);if(S0.isEqual(n,s))return;let a=[];return a.push({update:o=>{t.updateGeometryInteractions({scaleBaked:[Qt.lerp(n[0],s[0],o),Qt.lerp(n[1],s[1],o),Qt.lerp(n[2],s[2],o)]},r),t.invalidateDownstreamBooleanData(),t.refreshAttachedClonersInteractions()},start:()=>{t.updateGeometryInteractions({scaleBaked:n},r),t.invalidateDownstreamBooleanData(),t.refreshAttachedClonersInteractions()},end:()=>{t.updateGeometryInteractions({scaleBaked:s},r),t.invalidateDownstreamBooleanData(),t.refreshAttachedClonersInteractions()}}),a}function CDe(t,e,i,r){if(!i.extrusion)return;let n=t.extrusion,s=e.extrusion??{},a=i.extrusion,o=[];return cY.forEach(l=>{let c=Og(l,n,s,a,r);c&&o.push(c)}),o}function DDe(t,e,i,r){let n=[];if(!("geometry"in i))return n;let s=t.geometry.userData.parameters,a="geometry"in e?e.geometry:{},o=i.geometry;if(t instanceof jw){let l=TDe(t,a,o,r);l&&n.push(...l)}else{let l={};if(Object.assign(l,Ud(s,zO),Ud(a,zO)),zO.forEach(c=>{let u=Og(c,l,a,o,r);u&&n.push(u)}),t instanceof O4){Object.assign(l,{extrusion:{...s.extrusion}});let c=CDe(l,a,o,r);c&&n.push(...c)}n.length&&n.push({update:c=>{t.updateGeometryInteractions(l,r),t.updateGeometryGroupsIfNeeded(),t.refreshAttachedClonersInteractions()},start:c=>{t.updateGeometryInteractions(l,r),t.updateGeometryGroupsIfNeeded(),t.refreshAttachedClonersInteractions()},end:c=>{t.updateGeometryInteractions(l,r),t.updateGeometryGroupsIfNeeded(),t.refreshAttachedClonersInteractions()}})}return n}function PDe(t,e,i,r){let n=[];if(i.intensity!==void 0){let s=Ka("intensity",t,e,i,r);s&&n.push(s)}if(i.color!==void 0){let s=EDe("color",t,e,i,r);s&&n.push(s)}return n}function RDe(t,e,i,r){let n=[];if(Array.isArray(t.material)){if(!("materials"in i&&i.materials))return n;let s="materials"in e&&e.materials?e.materials:[],a=i.materials;t.material.forEach((o,l)=>{if(!a[l])return;let c=s[l]??{},u=a[l];typeof c=="string"||typeof u=="string"||n.push(...Fj(o,c,u,r))})}else{if(!("material"in i&&i.material))return n;let s="material"in e&&e.material?e.material:{},a=i.material;if(typeof s=="string"||typeof a=="string")return n;n.push(...Fj(t.material,s,a,r))}return n}function Fj(t,e,i,r){var a;let n=[],s=n1(i,r)||!!e.layers&&n1(e,r);n.push(kDe(t,s));for(let o of t.layers){let l=(a=e.layers)==null?void 0:a.data(o.uuid),c=i.layers.data(o.uuid);if(!c||o.type!=="light"&&(!(o.visible??!0)||!(c.visible??!0)))continue;let u=o.getNames().filter(h=>!aY.some(d=>h.includes(d)));for(let h of u)try{let d=o.getValue(h),p;if(h==="colors")p=NDe(o,l,c,h);else if(Array.isArray(d))h==="steps"&&(p=BDe(o,l,c,h));else if(typeof d=="number")p=ODe(o,l,c,h,r);else{if(typeof d=="boolean")continue;d instanceof Oe?p=LDe(o,l,c,h):d instanceof W?p=IDe(o,l,c,h,r):d instanceof ro?p=UDe(o,l,c,h,r):d instanceof bi?p=zDe(o,l,c,h,r):"isTexture"in d&&(p=FDe(o,l,c,h))}p&&(Array.isArray(p)?n.push(...p):n.push(p))}catch(d){console.error(`lerpMaterial: unexpected material layer for ${h}`,d)}}return n}function ODe(t,e,i,r,n){if(!t.hasValue(r)||!(r in i))return;let s=e?e[r]:t.getValue(r),a=i[r],o=typeof s=="string"?Number(n.getVariable(s)??0):s,l=typeof a=="string"?Number(n.getVariable(a)??0):a;if(o!==l)return{update:c=>{t.setValue(r,Qt.lerp(o,l,c))},start:()=>{t.setValue(r,o)},end:()=>{t.setValue(r,l)}}}function LDe(t,e,i,r){if(!t.hasValue(r)||!(r in i))return;let n=t.getValue(r),s=e?new Oe().fromArray(e[r]):n.clone(),a=new Oe().fromArray(i[r]);if(!s.equals(a))return{update:o=>{n.lerpVectors(s,a,o)},start:()=>{n.copy(s)},end:()=>{n.copy(a)}}}function IDe(t,e,i,r,n){if(!t.hasValue(r)||!(r in i))return;let s=t.getValue(r),a=e?e[r]:void 0,o=i[r],l=a?wD(new W,a,n):s.clone(),c=wD(new W,o,n);if(!l.equals(c))return{update:u=>{s.lerpVectors(l,c,u)},start:()=>{s.copy(l)},end:()=>{s.copy(c)}}}function zDe(t,e,i,r,n){if(!t.hasValue(r)||!(r in i))return;let s=e?e[r]:void 0,a=i[r],o=t.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new bi().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new bi().setRGB(a.r,a.g,a.b);if(l.equals(c))return;let u=o.clone();return{update:h=>{t.getValue(r)!==u&&t.setValue(r,u),u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function UDe(t,e,i,r,n){if(!t.hasValue(r)||!(r in i))return;let s=e?e[r]:void 0,a=i[r],o=t.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new bi().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new ro(a.r,a.g,a.b,a.a);if(l.equals(c))return;let u=o.clone();return{update:h=>{t.getValue(r)!==u&&t.setValue(r,u),u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function BDe(t,e,i,r="steps"){if(!t.hasValue(r)||!(r in i))return;let n=[],s=t.getValue(r),a=e?e[r]:s,o=i[r];return YN(a,o)||n.push({update:l=>{let c=[...s];for(let u=0;u<s.length;++u){let h=a[u],d=o[u];c[u]=Qt.lerp(h,d,l)}t.setValue(r,c)},start:()=>{t.setValue(r,a)},end:()=>{t.setValue(r,o)}}),n.length?n:void 0}function NDe(t,e,i,r="colors"){if(!t.hasValue(r)||!(r in i))return;let n=[],s=t.getValue(r),a=e?e[r]:s.map(l=>l.toArray()),o=i[r];for(let l=0;l<s.length;++l){let c=[...a[l]],u=[...o[l]];QC.isEqual(c,u)||n.push({update:h=>{s[l].fromArray(QC.lerp(c,u,h))},start:()=>{s[l].fromArray(c)},end:()=>{s[l].fromArray(u)}})}return n.length?n:void 0}function FDe(t,e,i,r="texture"){var v,b;if(!t.hasValue(r)||!(r in i))return;let n=t.getNode("rotation"),s=((v=e==null?void 0:e[r])==null?void 0:v.rotation)??0,a=((b=i[r])==null?void 0:b.rotation)??0;if(n&&s!==a)return{update:w=>{n.value=Qt.lerp(s,a,w)*Qt.DEG2RAD},start:()=>{n.value=s*Qt.DEG2RAD},end:()=>{n.value=a*Qt.DEG2RAD}};let o=t.getNode("mat");if(!o)return;let l=e?e[r]:o,c=i[r],u=[...l.repeat],h=[...l.offset],d=[...c.repeat],p=[...c.offset],g=l.rotation??0,x=c.rotation??0;if(!vp.isEqual(u,d)||!vp.isEqual(h,p)||g!==x)return{update:w=>{o.repeat=vp.lerp(u,d,w),o.offset=vp.lerp(h,p,w),o.rotation=Qt.lerp(g,x,w),o.updateMatrix()},start:()=>{o.repeat=[...u],o.offset=[...h],o.rotation=g,o.updateMatrix()},end:()=>{o.repeat=[...d],o.offset=[...p],o.rotation=x,o.updateMatrix()}}}function kDe(t,e){return{update:()=>{t.transparent=e}}}var PL=new W,kj=new ia;function VDe(t,e,i,r,n){var g,x,v,b,w,M;let s=[],a,o,l,c,u,h,d,p;if(t instanceof za?(a=MD("position",t,e,i,n),a&&s.push(a),l=Ka("rotation",t,e,i,n),l&&s.push(l),c=MD("shear",t,e,i,n),c&&s.push(c)):(p={slide:((g=e.pathSnapping)==null?void 0:g.slide)??((x=t.updatedPathSnapping)==null?void 0:x.slide)??((v=t.dataPatched.pathSnapping)==null?void 0:v.slide)??0,offset:((b=e.pathSnapping)==null?void 0:b.offset)??((w=t.updatedPathSnapping)==null?void 0:w.offset)??((M=t.dataPatched.pathSnapping)==null?void 0:M.offset)??0},h=Ka("slide",p,e.pathSnapping??t.updatedPathSnapping??t.dataPatched.pathSnapping,i.pathSnapping??t.dataPatched.pathSnapping,n),h&&s.push(h),d=Ka("offset",p,e.pathSnapping??t.updatedPathSnapping??t.dataPatched.pathSnapping,i.pathSnapping??t.dataPatched.pathSnapping,n),d&&s.push(d),!h&&!d&&(a=Bj("position",t,e,i,n),a&&s.push(a),o=Bj("scale",t,e,i,n),o&&s.push(o),l=HDe(t,e,i,r,n),l&&s.push(l),u=MDe("hiddenMatrix",t,e,i),u&&s.push(u))),a||o||l||u||h||d){let E=t instanceof za?()=>{t.updateWorldMatrix(!0,!1,!0),t.resetBBoxNeedsUpdate()}:()=>{var D;t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),(D=t.parent)!=null&&D.matrixWorldFusedFalse&&(t.matrixWorld.multiplyMatrices(t.parent.matrixWorldFusedFalse,t.matrix),t.matrixWorldNeedsUpdate=!1),oh(t)&&yp(t.parent)&&t.invalidateDownstreamBooleanData(!0),t.updatePathSnapping(Object.assign({},e.pathSnapping,p))};s.push({update:E,start:E,end:E})}return s}function HDe(t,e,i,r,n){var u;let s=e!=null&&e.rotation?e.rotation.map(h=>(typeof h=="string"?Number(n.getVariable(h)??0):h)*Qt.DEG2RAD):void 0,a=(u=i.rotation)==null?void 0:u.map(h=>(typeof h=="string"?Number(n.getVariable(h)??0):h)*Qt.DEG2RAD);if(!a)return;let o=s?new W().fromArray(s):new W().setFromEuler(t.rotation),l=new W().fromArray(a);if(o.equals(l))return;let c=PL.subVectors(l,o);if(r&&c.toArray().every(h=>Math.abs(h)<2*Math.PI)){let h=new Ci().setFromEuler(kj.setFromVector3(o)),d=new Ci().setFromEuler(kj.setFromVector3(l));return{update:p=>{wDe(h,d,t.quaternion,p)},start:()=>{t.rotation.setFromVector3(o)},end:()=>{t.rotation.setFromVector3(l)}}}else return{update:h=>{PL.lerpVectors(o,l,h),t.rotation.setFromVector3(PL)},start:()=>{t.rotation.setFromVector3(o)},end:()=>{t.rotation.setFromVector3(l)}}}function GDe(t,e,i,r){let n=[];if(!("cloner"in i)||!t.cloner)return n;let s=t.cloner,a="cloner"in e?e.cloner:{},o=i.cloner;eY.forEach(p=>{let g;p==="count"?g=Ka("count",s.parameters,a,o,r,!0):g=Og(p,s.parameters,a??{},o,r),g&&n.push(g)});let l=jDe(s,a,o,r);l!=null&&l.length&&n.push(...l);let c=WDe(s,a,o,r);c!=null&&c.length&&n.push(...c);let u=qDe(s,a,o,r);u!=null&&u.length&&n.push(...u);let h=XDe(s,a,o,r);h!=null&&h.length&&n.push(...h);let d=YDe(s,a,o,r);return d!=null&&d.length&&n.push(...d),n.length&&n.push({update:()=>{s.update()}}),n}function jDe(t,e,i,r){if(t.parameters.type!=="radial")return;let n=e.radial,s=i.radial;if(!s)return;let a=t.parameters.radial,o=[];return tY.forEach(l=>{let c=Og(l,a,n??{},s,r);c&&o.push(c)}),o}function WDe(t,e,i,r){if(t.parameters.type!=="linear")return;let n=e.linear,s=i.linear;if(!s)return;let a=[],o=t.parameters.linear;return iY.forEach(l=>{let c=Og(l,o,n??{},s,r);c&&a.push(c)}),a}function qDe(t,e,i,r){if(t.parameters.type!=="grid")return;let n=e.grid,s=i.grid;if(!s)return;let a=[],o=t.parameters.grid;return rY.forEach(l=>{let c;l==="count"?c=Y4(l,o,n??{},s,r,!0):c=Og(l,o,n??{},s,r),c&&a.push(c)}),a}function XDe(t,e,i,r){if(t.parameters.type!=="toObject")return;let n=e.toObject,s=i.toObject;if(!s)return;let a=[],o=t.parameters.toObject;return nY.forEach(l=>{let c;l==="count"?c=Ka(l,o,n??{},s,r,!0):c=Og(l,o,n??{},s,r),c&&a.push(c)}),a}function YDe(t,e,i,r){if(!t.parameters.randomness)return;let n=e.randomnessObject,s=i.randomnessObject;if(!s)return;let a=[],o=t.parameters.randomnessObject;return sY.forEach(l=>{let c=Og(l,o,n??{},s,r);c&&a.push(c)}),a}function QDe(t,e){return{update:()=>{t instanceof Da&&(t.fill.enabled=e)}}}function ZDe(t,e){return{update:()=>{t instanceof Da&&(t.stroke.enabled=e)}}}function KDe(t,e){return{update:()=>{t instanceof Da&&(t.dropShadow.enabled=e)}}}function JDe(t,e){return{update:()=>{t instanceof Da&&(t.innerShadow.enabled=e)}}}function $De(t,e){return{update:()=>{t instanceof Da&&(t.backgroundBlur.enabled=e)}}}function e3e(t,e){return{update:()=>{t instanceof Da&&(t.layerBlur.enabled=e)}}}function t3e(t,e,i,r,n){let s=[],a,o,l,c,u,h,d,p,g,x,v,b,w,M,E;if("width"in t&&(a=Ka("width",t,e,i,n),a&&s.push(a)),"height"in t&&(o=Ka("height",t,e,i,n),o&&s.push(o)),t instanceof Da||t instanceof Nd){let D={...e.fill},T={...i.fill};D.enabled!==void 0&&D.enabled!==T.enabled&&(s.push(QDe(t,!0)),D.enabled||Object.assign(D,{enabled:!0,color:{...D.color,a:0}}),T.enabled||Object.assign(T,{enabled:!0,color:{...T.color,a:0}})),l=B2("color",t.fill,D,T,n),l&&s.push(l)}if(t instanceof Da){let D={...e.stroke},T={...i.stroke};(D.enabled||T.enabled)&&(s.push(ZDe(t,!0)),D.enabled||Object.assign(D,{enabled:!0,color:{...D.color,a:0}}),T.enabled||Object.assign(T,{enabled:!0,color:{...T.color,a:0}})),c=B2("color",t.stroke,D,T,n),c&&s.push(c),u=Ka("thickness",t.stroke,D,T,n),u&&s.push(u)}if(t instanceof Da){let D={...e.dropShadow},T={...i.dropShadow};(D.enabled||T.enabled)&&(s.push(KDe(t,!0)),D.enabled||Object.assign(D,{enabled:!0,color:{...D.color,a:0}}),T.enabled||Object.assign(T,{enabled:!0,color:{...T.color,a:0}})),h=B2("color",t.dropShadow,D,T,n),h&&s.push(h),d=Ka("blurRadius",t.dropShadow,D,T,n),d&&s.push(d),g=Ka("spread",t.dropShadow,D,T,n),g&&s.push(g),p=MD("offset",t.dropShadow,D,T,n),p&&s.push(p)}if(t instanceof Da){let D={...e.innerShadow},T={...i.innerShadow};(D.enabled||T.enabled)&&(s.push(JDe(t,!0)),D.enabled||Object.assign(D,{enabled:!0,color:{...D.color,a:0}}),T.enabled||Object.assign(T,{enabled:!0,color:{...T.color,a:0}})),x=B2("color",t.innerShadow,D,T,n),x&&s.push(x),v=Ka("blurRadius",t.innerShadow,D,T,n),v&&s.push(v),w=Ka("spread",t.innerShadow,D,T,n),w&&s.push(w),b=MD("offset",t.innerShadow,D,T,n),b&&s.push(b)}if(t instanceof Da||t instanceof Nd){let D={...e.backgroundBlur},T={...i.backgroundBlur};(D.enabled||T.enabled)&&(s.push($De(t,!0)),D.enabled||Object.assign(D,{enabled:!0,radius:0}),T.enabled||Object.assign(T,{enabled:!0,radius:0})),M=Ka("radius",t.backgroundBlur,D,T,n),M&&s.push(M)}if(t instanceof Da){let D={...e.layerBlur},T={...i.layerBlur};(D.enabled||T.enabled)&&(s.push(e3e(t,!0)),D.enabled||Object.assign(D,{enabled:!0,radius:0}),T.enabled||Object.assign(T,{enabled:!0,radius:0})),E=Ka("radius",t.layerBlur,D,T,n),E&&s.push(E)}if(t instanceof Nd||t instanceof LM){let D=Y4("cornerRadius",t,e,i,n);D&&s.push(D)}return s}function Vj(t,e,i,r,n){let s=[];return t.data.visible&&s.push(...VDe(t,e,i,n,r)),t instanceof za?s.push(...t3e(t,e,i,n,r)):(t.data.visible&&s.push(...GDe(t,e,i,r)),oh(t)?(t instanceof Gs&&t.data.visible&&s.push(...DDe(t,e,i,r)),t.data.visible&&s.push(...RDe(t,e,i,r))):kEe(t)?t.data.visible&&s.push(...PDe(t,e,i,r)):FEe(t)&&s.push(...ADe(t,e,i,r))),s.length?{update:a=>{s.forEach(o=>o.update(a))},start:a=>{s.forEach(o=>{var l;return(l=o.start)==null?void 0:l.call(o,a)})},end:a=>{s.forEach(o=>{var l;return(l=o.end)==null?void 0:l.call(o,a)})}}:void 0}var Hj=new W;function Q4(t,e,i=!1){var s;let r=[],n=a=>{let o=a.data;delete a.states,a.currentState=null,a.reversibleToState=null,a.currentTransitionEvent=null;for(let l of o.states){let c={...l.data};a.states||(a.states={}),a.states[l.id]=u0.patch(o,c)}jj(t.scene,a,null,e,o.events.find(l=>l.data.type==="Follow"||l.data.type==="LookAt")!==void 0),Gj(t)};t.scene.traverse2D(n),t.traverseChildren(a=>{var u,h,d,p,g,x;if(i&&((u=a.rigidBody)==null||u.setTranslation(a.position0,!0),(h=a.rigidBody)==null||h.setRotation(a.rotation0,!0),(d=a.rigidBody)==null||d.setLinvel(Hj,!0),(p=a.rigidBody)==null||p.setAngvel(Hj,!0)),!gr.is(a))return;let o=a.uuid,l=a.data;if(delete a.states,a.uuid===yb)return;let c=!1;r.some(v=>{var b;return(b=t.scene.find(o))==null?void 0:b.isDescendantOf(v)})?c=!0:((g=l.physics)==null?void 0:g.fusedBody)===!0&&l.physics.rigidBody==="dynamic"&&r.push(o),a.data=l,a.currentState=null,a.reversibleToState=null,a.currentTransitionEvent=null;for(let v of l.states){let b={...v.data};t.data.globalPhysics.usePhysics===!0&&l.physics&&(l.physics.rigidBody==="dynamic"||c)&&(v.data.position!==void 0&&delete b.position,v.data.rotation!==void 0&&delete b.rotation,v.data.hiddenMatrix!==void 0&&delete b.hiddenMatrix),a.states||(a.states={}),a.states[v.id]=o0.patch(l,b)}jj(t.scene,a,null,e,l.events.find(v=>v.data.type==="Follow"||v.data.type==="LookAt")!==void 0),a instanceof Ro&&a.frame&&(a.frame.traverse(v=>n(v)),(x=a.uiCanvas)==null||x.applySize())}),Gj(t),t.frame&&(t.frame.traverse(a=>n(a)),(s=t.uiCanvas)==null||s.applySize())}function Gj(t){t.traverseEntity(e=>{for(let i of e.data.events){let r=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":r.push(...i.data.actions);break;case"GameControl":for(let n of Object.values(i.data.gameActions))r.push(...n);break;case"DragDrop":r.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":r.push(...i.data.inActions,...i.data.outActions);break}for(let n of r)if(n.data.type==="Create"&&n.data.hideBase==="Yes"){let s=t.scene.find(n.data.object);s&&(s.visible=!1)}}})}function jj(t,e,i,r,n=!1){if(e instanceof Gs&&!(e instanceof F0)&&e.removeInteractionGeometry(r),e instanceof za?e.changeSelectedState(i,{shared:r},n):e.changeSelectedState(i,{scene:t,shared:r},n),e instanceof Gs&&e.updateGeometryGroupsIfNeeded(),e instanceof Io&&e.updateCameraState(e.dataPatched,{scene:t,shared:r}),!(e instanceof za)){if(e.cloner)for(let s of e.cloner.children)s.playModeVisible=void 0;e.updateVisible()}}function LZ(t){let e;if(t.easing===5){let{control1:i,control2:r}=t;e=`cubicBezier(
			${i[0]}, ${i[1]}, ${r[0]}, ${r[1]}
		)`}else if(t.easing===6){let{mass:i,stiffness:r,damping:n,velocity:s}=t;e=`spring( ${i}, ${r}, ${n}, ${s} )`}else{let i;switch(t.easing){case 0:i=qm.linear;break;case 1:i=qm.ease;break;case 2:i=qm.easeIn;break;case 3:i=qm.easeOut;break;case 4:i=qm.easeInOut;break;default:i=qm.linear}let[r,n,s,a]=i;e=`cubicBezier( ${r}, ${n}, ${s}, ${a} )`}return{duration:Math.max(t.duration,1e-4),easing:e}}function bB(t){let e={delay:0,loop:t.repeat===-1?!0:t.repeat+1};if(t.repeat===0)e.direction="normal",e.rewind=!1;else switch(t.direction){case"pingpong":e.direction="alternate",e.rewind=!1;break;case"pingpong-rewind":e.direction="alternate",e.rewind=!0;break;default:e.direction="normal",e.rewind=!1;break}switch(e.delay=0,e.endDelay=0,e.startOnceDelay=0,e.pingPongDelayCorrection=0,e.pingPongEndDelayCorrection=0,t.delayDirection){case"start-once":e.startOnceDelay=t.delay;break;case"start":e.delay=t.delay;break;case"end":e.endDelay=t.delay;break;case"start-end":case void 0:e.delay=t.delay,e.endDelay=t.delay;break}return e.direction==="alternate"&&(e.delay/=2,e.endDelay/=2,t.delayDirection==="start"?(e.pingPongDelayCorrection=e.delay,typeof e.loop=="number"&&e.loop%2===0&&(e.pingPongEndDelayCorrection=e.delay)):t.delayDirection==="end"?typeof e.loop=="number"&&e.loop%2!==0&&(e.pingPongEndDelayCorrection=e.endDelay):t.delayDirection==="start-end"&&(e.pingPongDelayCorrection=e.delay,e.pingPongEndDelayCorrection=e.endDelay)),e}var i3e={type:"beginState"},r3e={type:"completeState",isfromEntity:!1},Wj=class{constructor(t,e,i,r,n,s){if(this.object=t,this.data=r,this.sharedAssets=n,this.allowSlerp=s,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),this.targets.t===0||this.targets.t===1?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let a=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"beginState",state:a}),this.object instanceof za||this.object.traverseEntity(o=>{o!==this.object&&o instanceof Io&&o.dispatchEvent(i3e)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let a=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"completeState",state:a}),this.object instanceof za||this.object.traverseEntity(o=>{o!==this.object&&o instanceof Io&&o.dispatchEvent(r3e)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=Vj(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},e===void 0){let a=oC(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!a)throw new Error("Missing property");this.from=a}else{let a=oC(this.object,e);if(!a)throw new Error("Missing property");this.from=a}if(i===void 0)throw new Error("Missing property");{let a=oC(this.object,i);if(!a)throw new Error("Missing property");this.to=a}this.useCurrentState=e===void 0||i===void 0,this.params={targets:this.targets,t:1,autoplay:!1,...bB(r),...LZ(r),change:this.onChange},this.callback=Vj(this.object,e===void 0?{}:this.from.data,i===void 0?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},IZ=class extends lo{constructor(t,e,i,r,n){var a;if(super(),this.eventType=t,this.data=e,this.page=i,this.shared=r,this.condition=n,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.hasPlayedOnce=!1,this.onTimelineChangeComplete=()=>{var o;this.data.tweens[0].data.direction!=="normal"&&(this.toggleIsForward=!this.toggleIsForward),this.timelineNeedsRebuild!==!1&&((o=this.timeline)==null||o.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!e.object)throw new Error("Missing property");let s=this.page.scene.find(e.object)??((a=this.page.uiCanvas)==null?void 0:a.find(e.object))??this.page.scene.find2DInUIObjects(e.object);if(!s)throw new Error("Missing property");if(!s.states)throw new Error("Missing property");if(this.object=s,e.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay=e.tweens[0].data.delayDirection==="start-once"?e.tweens[0].data.delay:0,this.init()}get playing(){var t;return((t=this.timeline)==null?void 0:t.paused)===!1}get changeBegan(){return this.tweens.some(t=>t.changeBegan)??!1}init(){this.initialCurrentState=oC(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.data.runMode==="Toggle"&&V6(this.eventType)?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:t=!0,needsRebuild:e=!1,isRebuild:i=!1}={}){var r,n,s,a;try{let o=bB(this.data.tweens[0].data);i&&typeof o.loop=="number"&&o.loop--,(r=this.timeline)==null||r.pause(),this.timeline=OZ.timeline({autoplay:!1,...o,...o.loop===!0||o.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let l=this.tweens.findIndex(c=>c==null?void 0:c.changeBegan);if(e===!0&&(this.timelineNeedsRebuild=!0),t){let c=l===-1?0:l;for(let u=c;u<this.data.tweens.length-1;u++){let h=this.data.tweens[u],d=this.data.tweens[u+1],p;u===c&&(this.object.wasMovedByUser===!0||((n=this.object.previousAction)==null?void 0:n.changeBegan)===!0)?(p=void 0,this.object instanceof Io&&(this.object.wasMovedByUser=!1)):p=h.data.state===void 0?this.currentState:h.data.state;let g=new Wj(this.object,p,d.data.state===void 0?this.currentState:d.data.state,d.data,this.shared,this.data.allowSlerp??!1);l!==-1&&u===c&&Object.assign(g.params,{startOnceDelay:0}),this.tweens[u]=g,this.timeline.add(g.params,this.timeline.duration+(u===c?o.delay:0))}this.timeline.duration+=o.endDelay}else{let c=l===-1?this.data.tweens.length-1:l+1;for(let u=c;u>0;u--){let h=this.data.tweens[u],d=this.data.tweens[u-1],p;u===c&&(this.object.wasMovedByUser===!0||((s=this.object.previousAction)==null?void 0:s.changeBegan)===!0)?(p=void 0,this.object instanceof Io&&(this.object.wasMovedByUser=!1)):p=h.data.state===void 0?this.currentState:h.data.state;let g=new Wj(this.object,p,d.data.state===void 0?this.currentState:d.data.state,h.data,this.shared,this.data.allowSlerp??!1);l!==-1&&u===c&&Object.assign(g.params,{startOnceDelay:0}),this.tweens[u-1]=g,this.timeline.add(g.params,this.timeline.duration+(u===c?o.endDelay:0))}this.timeline.duration+=o.delay}}catch(o){o instanceof Error&&console.error(o.message)}((a=this.object.previousAction)==null?void 0:a.playing)===!0&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(Cn(this.shared,this.condition)===!1||V6(this.eventType)&&this.data.runMode==="Once"&&this.hasPlayedOnce||(this.hasPlayedOnce=!0,this.playing))return!1;clearTimeout(this.timeoutId);let t=bB(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout(()=>{try{this.buildTimeline(),this.timeline.play()}catch(e){e instanceof Error&&console.error(e.message)}},this.startOnceDelay+t)}pause(){var t;(t=this.timeline)==null||t.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let t=this.data.tweens[0].data.state===void 0?this.initialCurrentState:this.data.tweens[0].data.state;this.object instanceof za?this.object.changeSelectedState(t,{shared:this.shared}):this.object.changeSelectedState(t,{scene:this.page.scene,shared:this.shared}),this.object.currentState=t}seek(t){var e;if(Cn(this.shared,this.condition)===!1)return!1;this.timeline===void 0&&this.buildTimeline(),(e=this.timeline)==null||e.seek(t*this.timeline.duration,!0)}toggle(t){var e;if(Cn(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),this.toggleIsForward=t??!this.toggleIsForward,this.playing?((e=this.timeline)==null||e.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout(()=>{var i;(i=this.timeline)==null||i.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function oC(t,e){var n;let i,r;if(typeof e=="string"?(i=e,r=(n=t.states)==null?void 0:n[i]):e===null&&(i=null,r=t.data),!(i===void 0||r===void 0))return{id:i,data:r}}var n3e={type:"beginState"},qj={type:"completeState",isfromEntity:!1},Xj={type:"requestRender"},zZ=class extends lo{constructor(t,e,i,r){super(),this.data=t,this.page=e,this.shared=i,this.condition=r,this.toggleIsForward=!1,this.posStart=new W,this.posEnd=new W,this.qStart=new Ci,this.qEnd=new Ci,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(t=!1){if(!this.data.animate)return;let e=this.page.scene.find(this.data.targetCamera);if(!e||!e.visible)throw new ReferenceError("Target camera not founded or not visible");let i={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=OZ({targets:i,t:1,...LZ(this.data),update:()=>{i.t===0&&(this.data.runMode==="Toggle"&&!this.toggleIsForward?this.fromCamera&&(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)):(this.posEnd.copy(e.position),this.qEnd.copy(e.quaternion),this.zoomEnd=e.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(e.uuid)),this.page.activeCamera.dispatchEvent(n3e));let r=this.page.activeCamera;r.position.lerpVectors(this.posStart,this.posEnd,i.t),r.quaternion.slerpQuaternions(this.qStart,this.qEnd,i.t),r.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*i.t,r.wasMovedBySwitchCameraAction=!0,r.updateMatrix(),r.updateMatrixWorld(),r.updateProjectionMatrix(),r.dispatchEvent(Xj),i.t===1&&r.dispatchEvent(qj)}})}switchCamera(t){let e=this.page.activeCamera,i=this.page.scene.find(t);if(!i||!i.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(i),e.dispatchEvent({type:"cameraChange",camera:i})}play(){if(Cn(this.shared,this.condition)===!1)return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var t;delete this.timeoutId,this.data.animate?(this.buildAnimation(),(t=this.animation)==null||t.play()):this.switchCamera(this.data.targetCamera)},this.data.delay*1e3)}catch{}}pause(){var t;(t=this.animation)==null||t.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(t){var e,i;if(Cn(this.shared,this.condition)===!1)return!1;if(window.clearTimeout(this.timeoutId),delete this.timeoutId,t!==this.toggleIsForward)try{this.playing?((e=this.animation)==null||e.pause(),this.toggleIsForward=t??!this.toggleIsForward,this.buildAnimation(!0),(i=this.animation)==null||i.play()):this.timeoutId=window.setTimeout(()=>{var r,n;this.toggleIsForward=t??!this.toggleIsForward,this.data.animate?((r=this.animation)==null||r.pause(),this.buildAnimation(),(n=this.animation)==null||n.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.fromCamera&&this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(qj),this.page.activeCamera.dispatchEvent(Xj))},this.data.delay*1e3)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}};function UZ(t){let e=t==null?void 0:t.tracks.filter(i=>i.ValueTypeName==="vector"||i.ValueTypeName==="quaternion").map(i=>i.times.length);if(e!=null&&e.length){let i=Oxe(e);return i&&i>2?i:2}return 2}var BZ=class extends lo{constructor(t,e,i,r,n){var l,c,u;super(),this.data=t,this.page=e,this.animationControls=i,this.shared=r,this.condition=n,this.startOnceDelay=0,this.toggleIsForward=!1;let s=t.object,a=e.scene.find(t.object);a&&Array.isArray(a.identity)&&(s=a.identity[0]),this.data={...t,object:s};let o=this.animationControls.clipIdToAction[t.clipId+"/"+s];if(this.duration=((l=o==null?void 0:o.getClip())==null?void 0:l.duration)??1,this.data.crop2){let h=UZ(o==null?void 0:o.getClip());this.leftFrameTime=this.data.crop2[0]/(h-1)*this.duration,this.rightFrameTime=this.data.crop2[1]/(h-1)*this.duration}else{let h=(u=(c=o==null?void 0:o.getClip())==null?void 0:c.tracks[0])==null?void 0:u.times.length;h&&h>1?(this.leftFrameTime=this.data.crop[0]/h*this.duration,this.rightFrameTime=this.data.crop[1]/h*this.duration):(this.leftFrameTime=0,this.rightFrameTime=this.duration)}this.startOnceDelay=t.delay}get playing(){var t;return((t=this.threeAnimAction)==null?void 0:t.isRunning())??!1}play(t=!1){if(Cn(this.shared,this.condition)===!1)return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let e=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach(([r,n])=>{let s=r.split("/")[1];this.threeAnimAction!==n&&s===e&&n.isRunning()&&(t?n.fadeOut(.2):n.stop())}),t&&((i=this.threeAnimAction)==null||i.fadeIn(.2))},this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){var t;(t=this.threeAnimAction)==null||t.fadeOut(.2)}seek(t){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=Qt.clamp(this.threeAnimAction.time+1/60*t,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(t,e=!1){if(Cn(this.shared,this.condition)===!1)return!1;this.toggleIsForward=t??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let r=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach(([n,s])=>{let a=n.split("/")[1];this.threeAnimAction!==s&&a===r&&s.isRunning()&&(e?s.fadeOut(.2):s.stop())}),e&&((i=this.threeAnimAction)==null||i.fadeIn(.2))}},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){var e;let t=(e=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object])==null?void 0:e.getClip();t&&(t.duration=this.duration),this.pause()}},NZ=class{constructor(t,e,i,r,n){this.data=t,this.page=e,this.eventManager=i,this.shared=r,this.condition=n,this.timeOutId=-1,this.scene=e.scene}dispatch(){if(Cn(this.shared,this.condition)===!1)return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout(()=>{this.play()},this.data.delay*1e3))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every(e=>e.uuid!==this.data.target||e.data.uiScene))return;this.data.transition==="fade"&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,this.data.duration*1e3),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let t=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity(e=>{e.type==="ParticleSystem"&&(e.sleep(),e.wakeUp(),e.data.autoPlay?e.start():e.stop())}),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(t),Q4(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},FZ=class{constructor(t,e,i,r){this.data=t,this.page=e,this.shared=i,this.condition=r,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=Cn(this.shared,this.condition)}dispatch(){if(this.evaluatedCondition===!1)return!1;let t=this.shared.getVariable(this.data.variableId),e=kY(this.data.expression,this.shared,to.typeOfVariable(t));e!==void 0&&this.shared.updateVariable(this.data.variableId,typeof e=="string"?{textValue:e}:e)}dispose(){}},kZ=class{constructor(t,e,i,r){this.data=t,this.page=e,this.shared=i,this.condition=r,this.timeoutId=null}dispatchInner(){if(Cn(this.shared,this.condition)===!1)return!1;let t=this.shared.getDynamicVariablePlayState(this.data.variableId);if(this.data.mode==="PlayPause")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,t==="Playing"?"Paused":"Playing");else if(this.data.mode==="Play"&&t!=="Playing")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if(this.data.mode==="Stop"&&t!=="Stopped")this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if(this.data.mode==="Pause"&&t!=="Paused")this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if(this.data.mode==="Restart")this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if(this.data.mode==="Toggle"){let e=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);t==="Playing"?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,e===void 0?!1:!e):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!e),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let t=this.data.delay,e=this.shared.getDynamicVariablePlayState(this.data.variableId);this.data.mode==="PlayPause"&&e==="Playing"&&(t=this.data.pauseDelay),t!==0?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,this.dispatchInner()},t)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}},s3e=class{constructor(t,e,i,r){this.data=t,this.page=e,this.shared=i,this.condition=r}dispatch(){if(Cn(this.shared,this.condition)===!1)return!1;(this.data.target==="single"?this.data.variableId?[this.data.variableId]:[]:Object.keys(this.shared.getVariables())).forEach(t=>{var i;this.shared.getVariable(t);let e=(i=this.shared.data.variables.data(t))==null?void 0:i.value;e!==void 0&&this.shared.updateVariable(t,e),this.shared.enableLocalStorageForPersistentVariables&&localStorage.removeItem(JU(t))})}dispose(){}},a3e=class{constructor(t,e,i,r){this.data=t,this.page=e,this.shared=i,this.condition=r}dispatch(){var t;if(Cn(this.shared,this.condition)===!1)return!1;this.data.userAPIId&&((t=this.shared.getUserAPI(this.data.userAPIId))==null||t.callUserAPI(this.shared))}dispose(){}};function Cn(t,e){if(e===void 0)return!0;if(e.expression.length===0)return!1;let i=kY(e.expression,t,"boolean");return e.negate?!i:!!i}function qs(t,e,i,r,n,s){let a={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[],ClearLocalStorage:[],UserAPI:[]},o=l=>({id:c,data:u})=>{try{u.type==="Audio"?Mo[t.type].includes("Audio")&&a.Audio.push(new dZ(c,u,s,r,l)):u.type==="Video"&&!(s instanceof za)?Mo[t.type].includes("Video")&&a.Video.push(new HZ(c,u,s,r,l)):u.type==="Particles"?Mo[t.type].includes("Particles")&&a.Particles.push(new fZ(u,i,r,l)):u.type==="Link"?Mo[t.type].includes("Link")&&a.Link.push(new qCe(u,n.controlsManager,r,l)):u.type==="Create"?Mo[t.type].includes("Create")&&a.Create.push(new GZ(u,i,n.controlsManager,r,l)):u.type==="Destroy"?Mo[t.type].includes("Destroy")&&a.Destroy.push(new pZ(u,i,n.controlsManager,r,l)):u.type==="Reset"?Mo[t.type].includes("Reset")&&a.Reset.push(new mZ(u,i,r,n,l)):u.type==="Transition"?Mo[t.type].includes("Transition")&&a.Transition.push(new IZ(t.type,u,i,r,l)):u.type==="SwitchCamera"?Mo[t.type].includes("SwitchCamera")&&a.SwitchCamera.push(new zZ(u,i,r,l)):u.type==="SceneTransition"?Mo[t.type].includes("SceneTransition")&&a.SceneTransition.push(new NZ(u,i,n,r,l)):u.type==="Animation"?Mo[t.type].includes("Animation")&&a.Animation.push(new BZ(u,i,n.animationControls,r,l)):u.type==="SetVariable"?Mo[t.type].includes("SetVariable")&&a.SetVariable.push(new FZ(u,i,r,l)):u.type==="DynamicVariablePlay"?Mo[t.type].includes("DynamicVariablePlay")&&a.DynamicVariablePlay.push(new kZ(u,i,r,l)):u.type==="Conditional"?Mo[t.type].includes("Conditional")&&(u.ifActions.forEach(o({expression:u.condition,negate:!1})),u.elseActions.forEach(o({expression:u.condition,negate:!0}))):u.type==="ClearLocalStorage"?Mo[t.type].includes("ClearLocalStorage")&&a.ClearLocalStorage.push(new s3e(u,i,r,l)):u.type==="UserAPI"&&Mo[t.type].includes("UserAPI")&&a.UserAPI.push(new a3e(u,i,r,l))}catch{}};return e.forEach(o()),a}function Ia(t){Object.values(t).forEach(e=>{e.forEach(i=>{(i instanceof dZ||i instanceof HZ||i instanceof fZ||i instanceof BZ||i instanceof IZ||i instanceof GZ||i instanceof pZ||i instanceof zZ||i instanceof NZ||i instanceof mZ||i instanceof FZ||i instanceof kZ)&&i.dispose()})})}function o3e(t,e){let i;if("material"in t){let r=t.material;Array.isArray(r)?i=t.material[0].layers.find(n=>n.uuid===e):i=t.material.layers.find(n=>n.uuid===e)}if(i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}var VZ=new Map,sw=new Map,E1=class{constructor(t,e,i){this.data=e,this.delay=0,this.status="stopped";let{layerId:r,loop:n,volume:s,delay:a}=e;if(this.object=i,r===void 0)throw new Error("Missing property");let o=o3e(i,r);o&&(this.videoElement=o,this.videoElement.loop=n===1/0,AM&&(this.videoElement.autoplay=!0),s!==void 0&&(this.videoElement.volume=s)),a!==void 0&&(this.delay=a),sw.has(i.uuid)?sw.get(i.uuid).push(this):sw.set(i.uuid,[this]),VZ.set(t,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(t){if(!this.videoElement)return;let e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);t?(this.mute(),this.delay+=150):e?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let i=this.videoElement.play();i!==void 0&&i.then(r=>{}).catch(r=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){this.data.toggle==="stop"?this.status==="playing"?this.stop():(this.stop(),this.play()):this.data.toggle==="pause"?this.status==="playing"?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},_B=class{constructor(t){this.data=t}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(t){let e=VZ.get(t);!e||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e[this.data.interaction](),this.disposeDelay()},this.data.delay)):e[this.data.interaction]())}pauseAllVideosFromObject(t){let e=sw.get(t);!(e!=null&&e.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(i=>i[this.data.interaction]()),this.disposeDelay()},this.data.delay)):e.forEach(i=>i[this.data.interaction]()))}pauseAllVideos(){let t=[...sw.values()];!t.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(e=>{e.forEach(i=>{i[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):t.forEach(e=>{e.forEach(i=>{i[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},HZ=class{constructor(t,e,i,r,n){if(this.data=e,this.shared=r,this.condition=n,e.interaction==="play")this.interaction=new E1(t,e,i);else if(e.interaction==="pause"||e.interaction==="stop")this.interaction=new _B(e);else throw new Error("Missing property")}dispatchBasic(){if(Cn(this.shared,this.condition)===!1)return!1;this.interaction instanceof E1?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(Cn(this.shared,this.condition)===!1)return!1;this.interaction instanceof E1?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},Yj=(()=>{let t,e,i,r;function n(o){!t&&!Qj()&&(e==null?void 0:e.sharedGameControlGlobals.createdObjects.length)>0&&(t=requestAnimationFrame(s)),o&&(e=o,r=o.requestRender)}function s(o){let l=i?o-i:0,c=e.sharedGameControlGlobals.createdObjects,u=e.sharedGameControlGlobals.nCreatedPerAction,h=c.length,d=0;for(;d<h;){let p=c[d];p.userData.createdTime===void 0&&(p.userData.createdTime=o),p.userData.lifetime===void 0&&p.userData.quantity===void 0||p.userData.lifetime&&o-p.userData.createdTime<p.userData.lifetime||p.userData.quantity&&u[p.userData.actionId]<=p.userData.quantity?(p.userData.velocity&&(p.position.addScaledVector(p.userData.velocity,l/1e3),p.updateMatrix(),r()),d++):(u[p.userData.actionId]>p.userData.quantity&&u[p.userData.actionId]--,c.splice(d,1),p.removeFromParent(),e.sharedGameControlGlobals.rapierWorld&&p.rigidBody?(e.sharedGameControlGlobals.colliderToEntity.delete(p.rigidBody.collider(0).handle),e.sharedGameControlGlobals.rapierWorld.removeRigidBody(p.rigidBody)):(p.bvhGeometry=void 0,e.sharedGameControlGlobals.entitiesWithTransformAnim=e.sharedGameControlGlobals.entitiesWithTransformAnim.filter(g=>g.bvhGeometry!==void 0)),h--,r())}t=d>0?requestAnimationFrame(s):void 0,i=d>0?o:void 0}function a(){Qj()?t&&(cancelAnimationFrame(t),t=void 0,i=void 0):n()}return typeof document<"u"&&document.addEventListener("visibilitychange",a),n})();function Qj(){return!!document&&document.hidden}var Zj=new Ci,l3e=new W,c3e=new W,GZ=class{constructor(t,e,i,r,n){this.data=t,this.page=e,this.controlsManager=i,this.shared=r,this.condition=n,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=Qt.generateUUID(),this.dispatch=()=>{if(Cn(this.shared,this.condition)===!1)return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()},this.dispatchFromStart=()=>{if(Cn(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))},this.dispatchThrottled=Zxe(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{this.intervalId===null&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let a=new io(this.object);if(a.playModeVisible=!0,a.expand(),this.data.coordinateSystem!=="world"){let l=this.data.coordinateSystem,c=this.page.scene.find(l);c&&(c.updateMatrixWorldSVD(),a.hiddenMatrix.copy(c.matrixWorldRigid))}a.scale.copy(this.object.scale),a.position.fromArray(this.data.position),a.rotation.fromArray(this.data.rotation),a.updateMatrix(),this.page.add(a);let o=this.controlsManager.sharedGameControlGlobals;o.createdObjects.push(a),o.nCreatedPerAction[this.uniqueId]===void 0?o.nCreatedPerAction[this.uniqueId]=1:o.nCreatedPerAction[this.uniqueId]++,a.updateWorldMatrix(!0,!0),a.traverseObject(this.traverseObjectCB),Yj(),this.controlsManager.requestRender()},this.traverseObjectCB=a=>{var u,h,d,p;a.hasNonUniformScale&&a.updateMatrixWorldSVD();let o;if(this.controlsManager.sharedGameControlGlobals.rapierWorld){if(a instanceof eu)if(a.objectForSample){if(a.objectForSample.dataPatched.physics.fusedBody)return;o=a.object}else return a.object.dataPatched.physics.fusedBody===!0&&a.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(a instanceof io)o=a.object;else if(o=a,(u=o.dataPatched.cloner)==null?void 0:u.hideBase)return!0}else{if(a instanceof eu)return;a instanceof io?o=a.object:o=a}this.data.destroy==="Time"?a.userData.lifetime=this.data.lifetime*1e3:this.data.destroy==="Quantity"&&(a.userData.quantity=this.data.destroyAfterQuantity,a.userData.actionId=this.uniqueId);let l=new W().fromArray(this.data.velocity),c=o.dataPatched;if(!(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(a,o,{fromCreate:!0,dynamic:this.data.dynamic}),this.data.destroy==="Collision"&&((h=a.rigidBody)==null||h.collider(0).setActiveEvents(1),a.userData.hasCollisionDestroy=!0),a.matrixWorld.decompose(l3e,Zj,c3e),l.applyQuaternion(Zj),this.data.velocity.some(g=>g!==0)&&this.data.dynamic&&((d=a.rigidBody)==null||d.setLinvel(l.divideScalar(this.controlsManager.pixelsPerMeter),!0))):("geometry"in a.object&&this.controlsManager.addBoundsTree(a),this.data.velocity.some(g=>g!==0)&&this.data.dynamic&&(a.userData.velocity=l)),((p=o.dataPatched.physics)==null?void 0:p.fusedBody)===!0))return!0};let s=this.page.scene.find(this.data.object);if(!s)throw new Error("Missing Property");if(this.object=s,this.data.coordinateSystem!=="world"&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");Yj(i)}dispose(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(t=>window.clearTimeout(t)),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},jZ=200,RL=.02,OL=.3,u3e=65;new W;var Kj=new W,Jj=new W,h3e=new W,Jo=new W,Ol=new W,Im=new W,LL=new Ot,$j=new Ot,d3e=new Ot;new Ot;var Ju=new Ci,Gf=new Ci,bd=new ia(0,0,0,"YXZ"),f3e=new W(1,0,0),$u=new W(0,1,0),p3e=new W(0,0,1),e8=new W(1,1,1);new Xl;var m3e=1,g3e=.025,v3e=16e-6,t8=12,y3e=20,Ma=new nu,jc=new Os,x3e={type:"requestRender"},b3e={type:"updateMatrix"},i8=Math.PI/6,SB=class extends lo{constructor(t,e,i,r,n,s,a,o,l){var g;super(),this.object=t,this.domElement=e,this.data=i,this.gloabalPhysics=r,this.controlsManager=n,this.cameraFollow=s,this.camera=a,this.page=o,this.sharedAssets=l,this.enableDamping=!0,this.hiddenMatrix0=new Ot,this.target0=new W,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=jZ,this.euler0=new ia(0,0,0,"YXZ"),this.position0Cam=new W,this.quat0Cam=new Ci,this.scale0Cam=new W,this.hiddenMatrix0Cam=new Ot,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new nu(new W(0,-40,0),new W(0,40,0)),matrix:new Ot,position:new W,rotation:new Ci},this.euler=new ia(0,0,0,"YXZ"),this.eulerDelta=new W,this.lastPosition=new W,this.lastCameraQuaternion=new Ci,this.lastCameraPosition=new W,this.PI_2=Math.PI/2,this.prevMouse=new Oe,this.velocityTarget=new W,this.velocity=new W,this.directionXZ=new W,this.rotVelocityStick=new W,this.rotVelocityTarget=new W,this.rotVelocity=new W,this.rotDirection=new W,this.nonColliderRotOffset=new Ot,this.nonColliderPosOffset=new Ot,this.firstPointerId=-1,this.rot=new W,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new Ot,this.objectToTarget=new W,this.objectToTarget0=new W,this.objectToCamXZ=new W,this.objectToCamXZ0=new W,this.targetToCamera=new W,this.targetToCamera0=new W,this.cameraPolarAxis0=new W,this.targetPos=new W,this.targetQuat=new Ci,this.lerpFactorPos=new W().setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new Ci,this.objXZQuatInv=new Ci,this.objXZRotMat=new Ot,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new W,this.pushedVelocity=new W,this.groundYRotation=0,this.objectRealQuat=new Ci,this.colliderWorldQuat=new Ci,this.groundNormal=new W,this.groundTilt=new Ci,this.groundTiltInv=new Ci,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new W,this.quaternion=new Ci,this.scale=new W,this.initialAction=!0,this.onPointerDown=x=>{var v;!(x.target===this.domElement||x.target instanceof HTMLElement&&x.target.tagName==="SPLINE-VIEWER"&&((v=x.target.shadowRoot)!=null&&v.contains(this.domElement)))||this.firstPointerId!==-1||(this.firstPointerId=x.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.rotBy!=="keys"&&!vc&&!A6&&this.domElement.requestPointerLock(),this.prevMouse.set(x.clientX,x.clientY))},this.onPointerUp=x=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),x.pointerType==="mouse"&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=x=>{if(x.pointerId!==this.firstPointerId)return;let v=x.clientX-this.prevMouse.x,b=x.clientY-this.prevMouse.y;this.prevMouse.set(x.clientX,x.clientY),x.pointerType==="mouse"&&this.rotBy!=="keys"&&(A6&&a1e<15.5&&!vc?(this.eulerDelta.y=-v*this.mouseOrbitSensitivity,this.eulerDelta.x=-b*this.mouseOrbitSensitivity):(this.eulerDelta.y=-x.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-x.movementY*this.mouseOrbitSensitivity)),x.pointerType!=="mouse"&&this.rotByTouch==="drag"&&(this.eulerDelta.y=-v*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-b*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=x=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?SB.isLocked=!0:SB.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document!=null&&document.hidden)for(let x in this.movementState)this.movementState[x]=0},this.onKeyDown=x=>{!(x.target instanceof HTMLInputElement)&&(x.code==="ArrowLeft"||x.code==="ArrowUp"||x.code==="ArrowRight"||x.code==="ArrowDown"||x.code==="Space")&&x.preventDefault();for(let v of this.keyAssignments)if(x.key.toUpperCase()===v[1]||x.key===v[1]){this.movementState[v[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=x=>{for(let v of this.keyAssignments)if(x.key.toUpperCase()===v[1]||x.key===v[1]||x.code.slice(3,x.code.length).toUpperCase()===v[1]){this.movementState[v[0]]=0;break}},this.copyVRGamePadValues=(x,v)=>{for(let b=2;b<4;b++){let w=x.axes[b];v===0?b===2?this.movementState.movePosX=w:this.movementState.movePosZ=w:(x.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,b===2?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(w)>=.3&&(this.vrEulerYOffset+=w<0?1:-1),this.movementState.rotPosY=w):this.moveMode==="fly"&&(this.movementState.moveNegY=w))}},this.sharedGameControlGlobals=n.sharedGameControlGlobals,t===a&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let c=this.euler0.clone(),u=c.y;if(this.objectRealQuat.copy(this.quaternion),c.y=0,this.quaternion.setFromEuler(c),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),c.set(0,u,0),this.quaternion.setFromEuler(c),this.rot.setFromEuler(c),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||this.cameraFollow===!0)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),this.cameraFollow===!0){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy((g=this.camera)==null?void 0:g.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let x=new W(0,0,-1).applyQuaternion(this.camera.quaternion),v=new W().subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(v),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let b,w;Math.abs(x.y)<1e-6?(v.y=0,x.y=0,w=v.projectOnVector(x)):v.y/x.y>0?w=x.multiplyScalar(v.y/x.y):w=x.multiplyScalar(v.length()),this.targetToCamera0.copy(w).negate(),b=this.camera.position.clone().add(w),this.objectToTarget0.subVectors(b,this.position);let M=new ia().setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-M.x,M.x=0,M.z=0,M.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(M)}if(this.object instanceof Io&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=i.rotByTouch??"joystick",this.rotBy=i.rotBy??"keys",this.rotationMode=i.rotationMode??"normal",this.moveMode=i.moveMode??"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=(i.speedTranslate??250)*m3e,this.speedOrbit=(i.speedRotate??100)*g3e,this.mouseOrbitSensitivity=(i.speedRotate??100)*v3e,this.keyAssignments=i.keyAssignments.map(x=>{let v=[x[0],x[1]];return v[1]===""?v[1]="ArrowUp":v[1]===""?v[1]="ArrowLeft":v[1]===""?v[1]="ArrowDown":v[1]===""?v[1]="ArrowRight":v[1]===""?v[1]="Shift":v[1]===""?v[1]="Enter":v[1]==="Space"?v[1]=" ":v[1]===""?v[1]="Meta":v[1]==="Ctrl"?v[1]="Control":v[1]==="Esc"&&(v[1]="Escape"),v}),i.rotBy==="mouse"){let x;x=this.keyAssignments.findIndex(v=>v[0]==="rotNegX"),x!==-1&&(this.keyAssignments[x][1]=""),x=this.keyAssignments.findIndex(v=>v[0]==="rotPosX"),x!==-1&&(this.keyAssignments[x][1]=""),x=this.keyAssignments.findIndex(v=>v[0]==="rotPosY"),x!==-1&&(this.keyAssignments[x][1]=""),x=this.keyAssignments.findIndex(v=>v[0]==="rotNegY"),x!==-1&&(this.keyAssignments[x][1]="")}this.lerpFactorPosStart=1-.02**(1/((i.delayPos[0]??.3)*60)),this.lerpFactorPosEnd=1-.02**(1/((i.delayPos[1]??.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/((i.delayRot[0]??.3)*60)),this.lerpFactorRotEnd=1-.02**(1/((i.delayRot[1]??.3)*60)),this.lerpFactorPosCamera=1-.02**(1/((i.delayPosCamera??.3)*60)),this.lerpFactorRotCamera=1-.02**(1/((i.delayRotCamera??.3)*60)),this.gravity=(this.gloabalPhysics.gravity??F1.defaultData.gravity)*t8,this.usePhysics=this.gloabalPhysics.usePhysics??F1.defaultData.usePhysics,this.jumpPower=i.jumpPower*y3e,this.resetYPosition=this.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=i.alignToGround??!1,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=i.orientWith??sD.defaultDataThirdPerson.orientWith,this.slopeThresh=u3e*Math.PI/180,i.collider.type==="capsule"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=i.collider.height*RL/this.pixelsPerMeter,this.stepThresh=i.collider.height*OL/this.pixelsPerMeter,this.colliderHeight=i.collider.height):i.collider.type==="sphere"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*RL/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*OL/this.pixelsPerMeter,this.colliderHeight=i.collider.radius*2):(this.offset=i.collider.height*RL/this.pixelsPerMeter,this.stepThresh=i.collider.height*OL/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let h=new W().fromArray(i.collider.position),d=new Ci().setFromEuler(new ia().fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(h).multiply(this.scale),this.collider.rotation.copy(d),this.collider.matrix.compose(h,d,e8),i.cameraXAxis!==void 0&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),this.forwardDir=i.forwardDirection??"-z",this.isFirstPerson&&(this.forwardDir="-z"),this.runMultiplier=i.runMultiplier??2;let p=i.navmesh.destinationHelperRadius*2;if(p>0){let x=new ai;x.push({fi:0,data:{...Ta.defaultData("light","phong"),alpha:0},id:"layer1"}),x.push({fi:0,data:{...Ta.defaultData("color"),color:i.navmesh.destinationHelperColor,alpha:i.navmesh.destinationHelperColor.a},id:"layer2"});let v=new b4({layers:x},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new bn(yY.create({parameters:{width:p,height:p/10,hollow:.7}}),v),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a}this.activate()}reset(t=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),t){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let e=new ia().setFromQuaternion(this.quaternion,"YXZ"),i=e.y;this.objectRealQuat.copy(this.quaternion),e.y=0,this.quaternion.setFromEuler(e),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),e.set(0,i,0),this.quaternion.setFromEuler(e),this.rot.setFromEuler(e),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof Io?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();this.cameraFollow===!0&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){var t;this.deactivate(),(t=this.navMeshPathDest)!=null&&t.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let t=this.data,e=this.sharedAssets;t.gameActions!==void 0&&(this.actions={},nD.list.forEach(i=>{this.actions[i]=qs({...t,disabled:!1,type:"GameControl"},t.gameActions[i],this.page,e,this.controlsManager.eventManager,this.object)})),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),Ia(this.actions.idle),Ia(this.actions.move),Ia(this.actions.run),Ia(this.actions.jump)}dispatchStartEvent(t){this.actions[t]!==void 0&&(this.actionState[t]||(this.actionState[t]=!0,this.actions[t].Transition.forEach(e=>{e.play()}),this.actions[t].Animation.forEach(e=>{e.play(this.initialAction===!1)}),this.actions[t].Create.forEach(e=>{e.dispatchStart()}),this.actions[t].Audio.forEach(e=>{e.dispatchGameControl("start")}),this.actions[t].Particles.forEach(e=>{e.dispatchGameControl("start")})))}dispatchStopEvent(t){this.actions[t]!==void 0&&(!this.actionState[t]||(this.actionState[t]=!1,this.actions[t].Transition.forEach(e=>{e.stop(),e.object.currentState!==null&&e.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})}),this.actions[t].Create.forEach(e=>{e.dispatchStop()}),this.actions[t].Audio.forEach(e=>{e.dispatchGameControl("stop")}),this.actions[t].Particles.forEach(e=>{e.dispatchGameControl("stop")})))}get colliderWorldPosition(){return Jo.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(t,e,i){var o,l,c,u,h,d,p,g,x;if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let r=(this.isFirstFrame?16.6:t)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let n=r*60,s=!1;if(this.usePhysics&&this.collisionEnabled){let v=Ol.set(0,(this.velocity.y===0?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/(10*t8),1)*(this.gravity>0?1:-1):this.velocity.y)*r,0).divideScalar(this.pixelsPerMeter),b=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,v,(o=this.object.rigidBody)==null?void 0:o.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(b){this.onObject=!0,this.groundNormal.set(b.normal2.x,b.normal2.y,b.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(s=!0),((l=b.collider.parent())==null?void 0:l.bodyType())===0&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let w=b.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let M of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(M.rigidBody===w&&M.userData.isFollowingObj!==this.object.uuid){(M.hasNonUniformScale?M.matrixWorldRigid:M.matrixWorld).decompose(Jo,Gf,Ol),this.groundVelocity.subVectors(Jo,M.prevT),this.object.getWorldPosition(Ol).add(this.collider.position).sub(Jo),this.groundYRotation=bd.setFromQuaternion(Gf).y-M.prevR.y,Im.copy(Ol).applyAxisAngle($u,this.groundYRotation),this.groundVelocity.add(Im.sub(Ol)).divideScalar(r);break}}else this.onObject=!1}if(this.moveMode==="walk"&&this.collisionEnabled&&(this.movementState.jump===1&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*n),this.moveMode==="fly"&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.forwardDir==="+z"&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let v=this.navMeshPathDest.material;if(this.moveMode==="walk"&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let b=Jo.subVectors(this.path[1],this.position),w=Ol.subVectors(this.path[1],this.path[0]);b.dot(w)<0?this.path.shift():(this.directionXZ.x=w.x,this.directionXZ.z=w.z),v.opacity=v.userData.opacity0}else v.opacity-=.05*v.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,(this.moveMode==="walk"?this.velocityTarget.x+this.velocityTarget.z===0:this.velocityTarget.manhattanLength()===0)?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.moveMode==="walk"&&(this.lerpFactorPos.y=1),this.didHit===!1&&this.pushedVelocity.manhattanLength()===0||this.usePhysics===!1?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**n),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**n),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**n)):this.velocity.copy(this.velocityTarget),(this.moveMode==="walk"?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let a=h3e.copy(this.velocity);if(this.orientMode!=="none"&&this.isFirstPerson===!1){let v=Ol.copy(a);v.y=0,a.set(0,a.y,v.length()*(this.forwardDir==="+z"?1:-1))}if(this.directionXZ.manhattanLength()>0&&this.orientMode!=="none"&&this.isFirstPerson===!1)if(this.orientWith==="camera"&&this.path.length<=1){let v=Jo;this.camera.getWorldDirection(v);let b=Im.copy($u).multiplyScalar(v.dot($u));v.sub(b);let w=Ol.copy(this.directionXZ);w.x*=-1,this.rot.y=v.angleTo(w)*(v.cross(w).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*(this.forwardDir==="+z"?1:-1);if(bd.setFromVector3(this.rot),this.moveMode==="walk"&&(bd.x=0),a.applyEuler(bd),s&&(Gf.setFromUnitVectors($u,this.groundNormal),a.applyQuaternion(Gf)),i){let v=bd.set(0,this.vrEulerYOffset*i8,0);i.applyEuler(v),a.x+=i.x,a.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*r}if(this.usePhysics===!0){let v=Ol;this.pushedVelocity.set(0,0,0);for(let b of this.sharedGameControlGlobals.entitiesWithTransformAnim){let w=Im.setFromMatrixPosition(b.matrixWorld).sub(b.prevT).divideScalar(r).divideScalar(this.pixelsPerMeter),M=b.rigidBody.collider(0).castCollider(w,this.object.rigidBody.collider(0),Jo.copy(a).divideScalar(this.pixelsPerMeter),r,!1);w.multiplyScalar(this.pixelsPerMeter);let E=gr.is(b)?b:b.object;if(M!==null&&this.lastHitObj!==E){let D;b instanceof io&&(D=b);let T=this.sharedGameControlGlobals.entityToCollisionEvents[E.uuid];if(T)for(let L of T)L.data.target==="character"&&(L.dispatch(D),E.dispatchEvent(MB));this.lastHitObj=E}if(M!==null){this.pushedVelocity.copy(w),v.copy(M.normal1).applyQuaternion(b.quaternion);break}}if(this.pushedVelocity.manhattanLength()!==0){let b=v.dot(a);b<0&&a.addScaledVector(v,-b),a.add(this.pushedVelocity)}else a.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotationMode==="normal"&&(this.movementState.rotPosX||this.movementState.rotNegX)||this.rotationMode==="steer"&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||this.moveMode==="walk")?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,this.rotationMode==="normal"&&(this.movementState.rotPosY||this.movementState.rotNegY)||this.rotationMode==="steer"&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(r),this.rotVelocityStick),this.rotVelocityTarget.manhattanLength()===0?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**n):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**n),this.euler.x+=this.rotVelocity.x*r,this.euler.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y===0&&this.directionXZ.manhattanLength()===0?this.rotationAccumWhenOrientWithCamera=0:(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*r),this.isFirstPerson===!1&&this.orientMode!=="none"&&this.directionXZ.manhattanLength()>0){if(this.orientMode==="radial"){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle($u,this.euler.y-this.euler0.y);let v=Ol.copy(this.objectToCamXZ).normalize(),b=Im.copy(a).multiplyScalar(r);b.y=0;let w=b.sub(Jo.copy(v).multiplyScalar(b.dot(v))).cross(v).y;this.euler.y-=Math.atan2(w,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y!==0&&(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.euler.y=this.rot.y);if(this.cameraFollow===!0&&(this.moveMode==="walk"?this.cameraXAxis==="Limit"?this.euler.x=Qt.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=Qt.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):this.cameraXAxis==="Limit"&&(this.euler.x=Qt.clamp(this.euler.x,-this.PI_2,this.PI_2))),this.moveMode==="fly"?this.rot.x=this.euler.x:this.isFirstPerson&&(e?(bd.copy(e),bd.y=0):(bd.copy(this.euler),bd.y=0),this.nonColliderRotOffset.makeRotationFromEuler(bd)),e&&(this.moveMode==="walk"?(this.rot.y=e.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(e),this.rot.y+=this.vrEulerYOffset*i8),Ju.setFromAxisAngle(f3e,this.rot.x),Gf.setFromAxisAngle($u,this.rot.y),Gf.multiply(Ju),Ju.setFromAxisAngle(p3e,this.rot.z),Gf.multiply(Ju),this.quaternion.copy(Gf),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let v=Ol.copy(a).multiplyScalar(r/this.pixelsPerMeter),b=null;this.didHit=!1;let w=new W;for(let M=0;M<5;M++){let E=v.length(),D=Im.copy(v).normalize();if(b=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(w),this.colliderWorldQuat,D,(c=this.object.rigidBody)==null?void 0:c.collider(0).shape,E,!1,24,void 0,void 0,this.object.rigidBody),b!==null){this.didHit=!0;let T=this.sharedGameControlGlobals.colliderToEntity.get(b.collider.handle);if(T!==this.lastHitObj&&M===0){this.lastHitObj=T;let O=this.sharedGameControlGlobals.entityToCollisionEvents[T==null?void 0:T.uuid];if(O){for(let U of O)if(U.data.target==="character"){let F=((u=this.sharedGameControlGlobals.rapierWorld)==null?void 0:u.getCollider(b.collider.handle))._parent,V;if(T.cloner){for(let k of T.cloner.children)if(k.rigidBody===F){V=k;break}}U.dispatch(V),T.dispatchEvent(MB)}}}let L=Kj.set(b.normal2.x,b.normal2.y,b.normal2.z).applyQuaternion(this.colliderWorldQuat),P=Jj.copy(D).multiplyScalar(b.toi).dot(L),R=b.toi;if(R===0&&(this.position.y+=this.offset*this.pixelsPerMeter),P>this.offset&&(R=b.toi*(P-this.offset)/P,w.addScaledVector(D,R)),v.copy(D).multiplyScalar(E-R),Math.acos(-L.y)>this.slopeThresh){let O=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(w),U=Im.copy(b.witness2).applyQuaternion(this.colliderWorldQuat);U.y=0;let F=O.add(U);F.y+=this.stepThresh;let V=this.sharedGameControlGlobals.rapierWorld.castShape(F,this.colliderWorldQuat,v,(h=this.object.rigidBody)==null?void 0:h.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);V!==null&&V.toi===0&&(L.y=0,L.normalize())}v.addScaledVector(L,-v.dot(L))}else{M===0&&this.directionXZ.manhattanLength()!==0&&(this.lastHitObj=null),w.add(v);break}}this.position.addScaledVector(w,this.pixelsPerMeter),(d=this.object.rigidBody)==null||d.setTranslation(Jo.copy(this.position).divideScalar(this.pixelsPerMeter),!0),(p=this.object.rigidBody)==null||p.setRotation(Ju.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let v=this.onObject?1:5,b=a.multiplyScalar(r/v);for(let w=0;w<v;w++)this.position.add(b),this.collisionAdjustment(r/v)}else this.position.addScaledVector(a,r);if(this.moveMode==="walk"&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),this.cameraFollow===!0){this.updateFollowArms();let v=this.objectToTarget.add(this.position),b=this.targetToCamera.add(v);LL.lookAt(b,v,$u).setPosition(b),LL.decompose(this.targetPos,this.targetQuat,Jo),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**n),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**n),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.cameraYAxis==="Limit"&&this.orientMode==="cartesian"&&(this.euler.y=Qt.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=Qt.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(b3e),this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(this.camera===void 0||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&(this.moveMode==="fly"||this.onObject===!0||this.collisionEnabled===!1)&&(this.navMeshPathDest===null||this.navMeshPathDest.material.opacity<-.04*((x=(g=this.navMeshPathDest)==null?void 0:g.material)==null?void 0:x.userData.opacity0))?!1:(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(x3e),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let t=Ju.setFromAxisAngle($u,this.cameraYAxis==="Limit"&&this.orientMode!=="radial"?Qt.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&this.objectToTarget.applyQuaternion(t);let e;this.cameraXAxis==="Limit"?e=Qt.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):e=Qt.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=Jo.copy(this.cameraPolarAxis0);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&i.applyQuaternion(t);let r=Gf.setFromAxisAngle(i,e);this.cameraYAxis!=="Locked"&&this.targetToCamera.applyQuaternion(t),this.cameraXAxis!=="Locked"&&this.targetToCamera.applyQuaternion(r)}groundTiltAdjustment(t){$u.angleTo(t)*180/Math.PI<15||$u.angleTo(t)*180/Math.PI>85?Ju.identity():Ju.setFromUnitVectors($u,t),this.groundTilt.slerp(Ju,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(t){var n;let e=Jj.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let i=LL.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(Jo,Ju,Ol).compose(Jo,Ju,e8);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(s=>{if(s===this.object||s.isDescendantOf(this.object))return;jc.makeEmpty(),s.updateMatrixWorldSVD();let a=s.matrixWorldRigid,o=$j.copy(a).invert(),l=d3e.copy($j).multiply(i);Ma.copy(this.collider.segment),Ma.start.applyMatrix4(l),Ma.end.applyMatrix4(l);let c=Kj.copy(this.position).applyMatrix4(o);jc.expandByPoint(Ma.start),jc.expandByPoint(Ma.end),jc.min.addScalar(-this.collider.radius),jc.max.addScalar(this.collider.radius),s.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder(u){return u.distanceToPoint(Ma.end)},intersectsBounds:u=>u.intersectsBox(jc),intersectsTriangle:u=>{let h=Jo,d=Ol,p=u.closestPointToSegment(Ma,h,d);if(p<this.collider.radius){let g=this.collider.radius-p,x=d.sub(h).normalize(),v=Im.copy(c);v.addScaledVector(x,g);let b=v.applyMatrix4(a).sub(this.position);e.add(b),Ma.start.addScaledVector(x,g),Ma.end.addScaledVector(x,g)}}})}),jc.makeEmpty(),Ma.copy(this.collider.segment),Ma.start.applyMatrix4(i),Ma.end.applyMatrix4(i),jc.expandByPoint(Ma.start),jc.expandByPoint(Ma.end),jc.min.addScalar(-this.collider.radius),jc.max.addScalar(this.collider.radius),(n=this.sharedGameControlGlobals.staticMeshBVH)==null||n.shapecast({traverseBoundsOrder(s){return s.distanceToPoint(Ma.end)},intersectsBounds:s=>s.intersectsBox(jc),intersectsTriangle:s=>{let a=Jo,o=Ol,l=s.closestPointToSegment(Ma,a,o);if(l<this.collider.radius){let c=this.collider.radius-l,u=o.sub(a).normalize();this.alignToGround&&this.groundTiltAdjustment(u),e.addScaledVector(u,c),Ma.start.addScaledVector(u,c),Ma.end.addScaledVector(u,c)}}}),this.onObject=Math.abs(e.y)>Math.abs(t*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let r=Math.max(0,e.length()-1e-5);e.normalize().multiplyScalar(r),this.position.add(e)}},WZ=SB;WZ.isLocked=!1;var _3e=Dg(Q7());function qZ(t){let e=t.elements,i=e[0]**2+e[1]**2+e[2]**2,r=e[4]**2+e[5]**2+e[6]**2,n=e[8]**2+e[9]**2+e[10]**2,s=e[0]**2+e[4]**2+e[8]**2,a=e[1]**2+e[5]**2+e[9]**2,o=e[2]**2+e[6]**2+e[10]**2,l=1e-8;return i<l||r<l||n<l||s<l||a<l||o<l}function op(t,e){let i=new ni;if(e&&qZ(e))return i.setAttribute("position",new Wt([],3)),i.setIndex([]),i;if(!t.getAttribute("position"))return i.setAttribute("position",new Wt([],3)),i.setIndex([]),i;let{positions:r,triIndices:n}=Z3(t.getAttribute("position"),t.getIndex());return i.setAttribute("position",new Wt(r,3)),i.setIndex(n),e&&i.applyMatrix4(e),i}var S3e=new Ot,w3e=new Ot,_d=[[0,0,0],[0,0,0],[0,0,0]];function XZ(t){let e=t.elements;_d[0][0]=e[0],_d[0][1]=e[4],_d[0][2]=e[8],_d[1][0]=e[1],_d[1][1]=e[5],_d[1][2]=e[9],_d[2][0]=e[2],_d[2][1]=e[6],_d[2][2]=e[10];let{u:i,v:r}=(0,_3e.SVD)(_d),n=S3e.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),s=w3e.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1);return n.multiply(s.transpose())}var M3e=class extends Hq{constructor(){super(),this.layers.enable(3),this.layers.enable(8),this.layers.enable(9)}setFromCamera(t,e){e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):e.isPerspectiveCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(e),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(t,e=!0,i=[]){return t.forEach(r=>{r.visible&&this.intersectObject(r,e,i)}),i}createRaycastLineHelper(){let t=new Rg({color:65280,linewidth:10}),e=new W(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new W(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),r=this.camera.far-this.camera.near,n=new W().addVectors(e,i.multiplyScalar(r)),s=new ni;return s.setFromPoints([e,n]),new CC(s,t)}},YZ=t=>t instanceof w1||t instanceof M1;function E3e(t,e){return t.distance-e.distance}function QZ(t,e,i){if(!(!ap(e)||!e.visible)){oh(e)&&e.raycast(t,i);for(let r of e.children)QZ(t,r,i)}}function lC(t,e,i,r=!1){if(!r&&!i.some(s=>ED(t,s)!==void 0))return[];let n=[];return e.children.forEach(s=>QZ(t,s,n)),n.sort(E3e),n}function wB(t){let e=[];if(t.length){let i=t[0].object;ap(i)&&e.push(i);let r=i.parent;for(;r;)YZ(r)&&e.push(r),r=r.parent}return e}function lp(t,e,i,r){let n=t.frame;if(n){let s=e[0]*n.width,a=(1-e[1])*n.height;for(let o of i){let l=o===n.uuid?n:n.find(o);if(l!=null&&l.intersects(s,a))return r(l),!0}}return!1}function ED(t,e){if(oh(e)){if(e.visible){let i=[];return e.raycast(t,i),i.length?i[0]:void 0}}else if(YZ(e))return ZZ(t,e)}function ZZ(t,e){if(!(!ap(e)||!e.visible)){if(oh(e)){let i=[];if(e.raycast(t,i),i.length)return i[0]}for(let i of e.children){let r=ZZ(t,i);if(r)return r}}}function A3e(t,e,i){return{x:(t-(i.left+window.scrollX))/i.width*2-1,y:-((e-(i.top+window.scrollY))/i.height)*2+1}}function T3e(t,e,i){return{x:(t-(i.left+window.scrollX))/i.width,y:1-(e-(i.top+window.scrollY))/i.height}}var C3e=class{constructor(t,e,i,r,n,s,a,o){this.renderer=t,this.publish=e,this.scene=i,this.getCamera=r,this.sharedAssets=n,this.requestRender=s,this.isExport=a,this.frame=o,this.raycaster=new M3e,this._useWindowEvents=!1,this.pointerWorld={x:0,y:0},this.pointerScreen={x:0,y:0},this._useWindowEvents=e.mouseEventTarget==="window",this.domElement=t.domElement,this.eventElement=this._useWindowEvents?window:t.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(t){this._useWindowEvents=t,this.eventElement=t?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(t){this._domRect=t}get domRect(){return this._domRect}updateRaycaster(t){var r;let{pageX:e,pageY:i}=((r=t.touches)==null?void 0:r.length)>0?t.touches[0]:t;this.pointerWorld=A3e(e,i,this._domRect),this.pointerScreen=T3e(e,i,this._domRect),this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}},Uo=class{constructor(t){this.eventContext=t,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},Z4=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],KZ=t=>{var e;return(e=Z4.find(([i,r])=>r===t))==null?void 0:e[0]},IM=t=>{var e;return(e=Z4.find(([i])=>i===t))==null?void 0:e[1]},D3e=(t,e)=>{let i=KZ(t);if(i){let r=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(r,"target",{writable:!1,value:e}),r}},P3e=class extends Uo{constructor(){super(...arguments),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=t=>{var r;if(!t.eventName||!t.target||t.eventName==="Scroll")return;let e=(r=this.splineEvents[KZ(t.eventName)])==null?void 0:r[t.target.uuid];if(!e)return;t.eventName==="Scroll"&&t.deltaY!==void 0&&Object.assign(e,{deltaY:t.deltaY});let{domElement:i}=this.eventContext;i.dispatchEvent(e)}}connect(){let{page:t}=this.eventContext;t.traverseEntity(e=>{var i,r;if((i=e.data)!=null&&i.events.length){for(let[n,s]of Z4)if(e.data.events.some(a=>a.data.type===s&&!a.data.disabled)){this.objectsPerEvents.has(n)?(r=this.objectsPerEvents.get(n))==null||r.push(e):this.objectsPerEvents.set(n,[e]);let a={id:e.uuid,name:e.name},o=D3e(s,a),l=this.splineEvents[n];l?l[e.uuid]=o:this.splineEvents[n]={[e.uuid]:o}}}}),this.objectsPerEvents.forEach(e=>{e.forEach(i=>{i.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(t=>{t.forEach(e=>{e.removeEventListener("beginEvent",this.onBeginEvent)})})}},R3e=class{constructor(t,e,i,r,n,s){if(this.id=t,this.data=e,this.object=i,this.entered=!1,(e.type==="KeyDown"||e.type==="KeyUp"||e.type==="KeyPress")&&!e.key)throw new Error("Missing property");this.actions=qs(e,e.actions,r,n,s,i)}disconnect(){Ia(this.actions)}dispatchHeld(t){this.actions.Create.forEach(e=>{t&&e.dispatchThrottled.cancel(),e.dispatchThrottled()})}dispatch(t=!1){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.data.type==="MousePress"||this.data.type==="KeyPress"?this.entered||(this.entered=!0,this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.playFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStart())):(this.actions.Transition.some(e=>e.playing&&e.data.runMode!=="Toggle")||this.actions.Transition.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.SwitchCamera.some(e=>e.playing&&e.data.runMode!=="Toggle")||this.actions.SwitchCamera.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.Animation.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()})),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),t===!1&&this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Particles.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent()),this.actions.Create.forEach(t=>t.dispatchStop()))}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.playFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent())),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}},O3e=class extends Uo{constructor(t,e,i){super(t),this.eventManager=e,this.useForRaycastProperty=i,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=r=>{if(this.useForRaycastProperty===!0&&this.sceneInterects===null){this.eventContext.updateRaycaster(r);let{raycaster:n,page:s}=this.eventContext,a=lC(n,s,[],!0);this.sceneInterects=a,a.length&&(this.eventContext.sharedAssets.raycastProperty={x:a[0].point.x,y:a[0].point.y,z:a[0].point.z,objX:a[0].object.matrixWorld.elements[12],objY:a[0].object.matrixWorld.elements[13],objZ:a[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{(n.data.type==="MouseDown"||n.data.type==="MousePress")&&(this.onCanvasRaycast(r),n.dispatch())})},this.onCanvasMouseUp=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{n.data.type==="MouseUp"?(this.onCanvasRaycast(r),n.dispatch()):n.data.type==="MousePress"&&n.dispatchRelease()})},this.onMouseDown=r=>{Ai.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseDown"))},this.onMouseUp=r=>{Ai.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=r=>{Ai.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent())},this.onMousePressRelease=r=>{Ai.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent(!0))},this.onKeyDown=r=>{this.heldKeys[r.key]||(this.handleKeyEvent(r,"KeyDown"),this.handleKeyEventHeld(r,"KeyDown",!0)),this.heldKeys[r.key]=!0},this.onKeyUp=r=>{this.handleKeyEvent(r,"KeyUp"),this.handleKeyEventHeld(r,"KeyUp",!0)},this.onKeyPressDown=r=>{this.heldKeysPress[r.key]?this.handleKeyEventHeld(r,"KeyPress"):(this.handleKeyEvent(r,"KeyPress"),this.handleKeyEventHeld(r,"KeyPress",!0)),this.heldKeysPress[r.key]=!0},this.onKeyPressUp=r=>{this.handleKeyEvent(r,"KeyPress",!0)},this.releaseHeldKey=r=>{delete this.heldKeys[r.key]},this.releaseHeldKeyPress=r=>{delete this.heldKeysPress[r.key]},this._onUserEvent=({eventName:r,target:n,reverse:s})=>{var o,l,c,u;if(!r||!n)return;let a=IM(r);a&&(a==="MouseDown"||a==="MouseUp"||a==="MousePress"?(n.dispatchEvent({type:"beginEvent",eventName:a}),(l=(o=this.eventsPerObjects[a])==null?void 0:o[n.uuid])==null||l.forEach(h=>{h.dispatchUserEvent(s)})):(a==="KeyDown"||a==="KeyUp"||a==="KeyPress")&&(n.dispatchEvent({type:"beginEvent",eventName:a}),(u=(c=this.eventsPerObjects[a])==null?void 0:c[n.uuid])==null||u.forEach(h=>{h.dispatchUserEvent()})))}}connect(){var n,s,a,o,l,c;let{page:t,sharedAssets:e,domElement:i}=this.eventContext,r=(u,h)=>{var p,g;if(!((p=u.data)!=null&&p.events.length))return;let d=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let x of d){let v=this.eventsPerObjects[x];if(u.data.events.filter(({data:b})=>b.type===x&&b.disabled!==!0).forEach(({id:b,data:w})=>{try{let M=new R3e(b,w,u,t,e,this.eventManager);M.actions.Video.length&&(this.hasVideoAction=!0),(w.type==="MouseDown"||w.type==="MouseUp"||w.type==="MousePress")&&(w.mode==="Canvas"||w.mode==="Window")?this.canvasMouseEvents.push(M):(v[u.uuid]?v[u.uuid].some(E=>E.id===M.id)||v[u.uuid].push(M):v[u.uuid]=[M],u instanceof F0&&u.traverseChildren(E=>{var D;if(!E.visible)return!0;E instanceof Gs&&((D=E.data.geometry.shapeBlendNode)==null?void 0:D.operation)!==2&&(v[E.uuid]?v[E.uuid].push(M):v[E.uuid]=[M])}))}catch{}}),((g=v[u.uuid])==null?void 0:g.length)&&(this.objectsPerTypes[x].push(u instanceof za&&(x==="MouseDown"||x==="MouseUp"||x==="MousePress")?h:u),u instanceof F0)){let b=this.objectsPerTypes[x];u.traverseChildren(w=>{if(!w.visible)return!0;w instanceof Gs&&b.indexOf(w)===-1&&b.push(w)})}}};t.traverseEntity(u=>{var h;(u instanceof Ro||u instanceof Ca)&&((h=u.frame)==null||h.traverse(d=>{r(d,u)})),r(u)}),this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),i.addEventListener("pointerdown",this.onCanvasMouseDown),i.addEventListener("pointerup",this.onCanvasMouseUp),((n=this.objectsPerTypes.MouseDown)!=null&&n.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMouseDown)),(s=this.objectsPerTypes.MouseUp)!=null&&s.length&&(this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMouseUp)),(a=this.objectsPerTypes.MousePress)!=null&&a.length&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMousePressRelease)),(o=this.objectsPerTypes.KeyDown)!=null&&o.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),(l=this.objectsPerTypes.KeyUp)!=null&&l.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),(c=this.objectsPerTypes.KeyPress)!=null&&c.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([u,h])=>{h.forEach(d=>{d.addEventListener("userEvent",this._onUserEvent)})})}disconnect(){let{domElement:t}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},t.removeEventListener("pointerdown",this.onCanvasMouseDown),t.removeEventListener("pointerup",this.onCanvasMouseUp),t.removeEventListener("pointerdown",this.onMouseDown),t.removeEventListener("pointerdown",this.onMousePressDown),t.removeEventListener("pointerup",this.onMouseUp),t.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(e=>{Object.values(e).forEach(i=>{i.forEach(r=>{r.disconnect()})})}),this.canvasMouseEvents.forEach(e=>{e.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([e,i])=>{i.forEach(r=>{r.removeEventListener("userEvent",this._onUserEvent)})})}handleMouseEvent(t){var o,l,c,u;let{stopRaycast:e,raycaster:i,page:r,pointerScreen:n}=this.eventContext,s=this.objectsPerTypes[t],a=s.filter(h=>!(h instanceof za));if(!(!s.length&&!this.useForRaycastProperty)&&!(r.uiCanvas&&lp(r,[n.x,n.y],Object.keys(this.eventsPerObjects[t]),h=>{this.handleObjectMouseEventDispatch(h,t)}))){if(e||this.useForRaycastProperty){let h;if(this.sceneInterects===null?h=lC(i,r,a,this.useForRaycastProperty):(h=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&h.length&&(this.eventContext.sharedAssets.raycastProperty={x:h[0].point.x,y:h[0].point.y,z:h[0].point.z,objX:h[0].object.matrixWorld.elements[12],objY:h[0].object.matrixWorld.elements[13],objZ:h[0].object.matrixWorld.elements[14]}),e){let d=[((l=(o=h[0])==null?void 0:o.uv)==null?void 0:l.x)??0,((u=(c=h[0])==null?void 0:c.uv)==null?void 0:u.y)??0];wB(h).forEach(p=>{p instanceof Ro&&lp(p,d,Object.keys(this.eventsPerObjects[t]),g=>{this.handleObjectMouseEventDispatch(g,t)}),this.eventsPerObjects[t][p.uuid]&&this.handleObjectMouseEventDispatch(p,t)})}}e||a.forEach(h=>{var p,g;let d=ED(i,h);d&&(this.handleObjectMouseEventDispatch(h,t),h instanceof Ro&&lp(h,[((p=d==null?void 0:d.uv)==null?void 0:p.x)??0,((g=d==null?void 0:d.uv)==null?void 0:g.y)??0],Object.keys(this.eventsPerObjects[t]),x=>{this.handleObjectMouseEventDispatch(x,t)}))})}}handleMousePressEvent(t=!1){let e="MousePress",i=this.objectsPerTypes[e],r=i.filter(s=>!(s instanceof za)),n=[];if(i.length){if(!t){let{stopRaycast:s,raycaster:a,page:o,pointerScreen:l}=this.eventContext,c=!1;if(o.uiCanvas&&(c=lp(o,[l.x,l.y],Object.keys(this.eventsPerObjects[e]),u=>{n.push(u)})),s&&!c){let u=lC(a,o,r);n=wB(u),u.forEach(h=>{var d,p;h.object instanceof Ro&&lp(h.object,[((d=h==null?void 0:h.uv)==null?void 0:d.x)??0,((p=h==null?void 0:h.uv)==null?void 0:p.y)??0],Object.keys(this.eventsPerObjects[e]),g=>{n.push(g)})})}else r.forEach(u=>{var d,p;let h=ED(a,u);h&&(n.push(u),u instanceof Ro&&lp(u,[((d=h==null?void 0:h.uv)==null?void 0:d.x)??0,((p=h==null?void 0:h.uv)==null?void 0:p.y)??0],Object.keys(this.eventsPerObjects[e]),g=>{n.push(g)}))})}this._prevObjects.length&&this._prevObjects.forEach(s=>{n.includes(s)||this.handleObjectMouseEventDispatchRelease(s,e)}),n.length&&n.forEach(s=>{this.handleObjectMouseEventDispatch(s,e)}),this._prevObjects=n}}handleObjectMouseEventDispatch(t,e){var i,r;t.dispatchEvent({type:"beginEvent",eventName:e}),(r=(i=this.eventsPerObjects[e])==null?void 0:i[t.uuid])==null||r.forEach(n=>{n.dispatch()})}handleObjectMouseEventDispatchRelease(t,e){var i,r;t.dispatchEvent({type:"beginEvent",eventName:e}),(r=(i=this.eventsPerObjects[e])==null?void 0:i[t.uuid])==null||r.forEach(n=>{n.dispatchRelease()})}handleKeyEvent(t,e,i=!1){this.objectsPerTypes[e].forEach(r=>{let n=this.eventsPerObjects[e][r.uuid];n.some(({data:s})=>"key"in s&&s.key===t.key)&&r.dispatchEvent({type:"beginEvent",eventName:e}),n.forEach(s=>{"key"in s.data&&s.data.key===t.key&&(i?s.dispatchRelease():s.dispatch(!0))})})}handleKeyEventHeld(t,e,i=!1){this.objectsPerTypes[e].forEach(r=>{this.eventsPerObjects[e][r.uuid].forEach(n=>{"key"in n.data&&n.data.key===t.key&&n.dispatchHeld(i)})})}},L3e=new W,I3e=new W,JZ=class{constructor(t,e,i,r,n){this.actionsIn=qs(t,t.inActions,i,r,n,e),this.actionsOut=qs(t,t.outActions,i,r,n,e)}disconnect(){Ia(this.actionsIn),Ia(this.actionsOut)}},z3e=class extends JZ{constructor(t,e,i,r,n,s){super(e,i,r,n,s),this.id=t,this.data=e,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let d of this.objects)if(!d.visible)return;let c=L3e.setFromMatrixPosition(this.objects[0].matrixWorld),u=I3e.setFromMatrixPosition(this.objects[1].matrixWorld),h=c.distanceTo(u)<=this.distance?"in":"out";if(this.stage!==h){this.stage=h;let d=h==="in"?this.actionsIn:this.actionsOut;d.Audio.forEach(p=>p.dispatchConditional()),d.Particles.forEach(p=>p.dispatchConditional()),d.Video.forEach(p=>p.dispatchConditional()),d.Link.forEach(p=>p.dispatch()),d.Create.forEach(p=>p.dispatch()),d.Destroy.forEach(p=>p.dispatch()),d.Reset.forEach(p=>p.dispatch()),d.Transition.forEach(p=>{p.object.currentTransitionEvent!==this&&(p.object.currentTransitionEvent=this),p.init()}),d.Transition.forEach(p=>p.play()),d.Animation.forEach(p=>p.play()),d.SwitchCamera.forEach(p=>p.play()),d.SceneTransition.forEach(p=>p.dispatch()),d.SetVariable.forEach(p=>p.checkConditions()),d.SetVariable.forEach(p=>p.dispatch()),d.DynamicVariablePlay.forEach(p=>p.dispatch()),d.ClearLocalStorage.forEach(p=>p.dispatch()),d.UserAPI.forEach(p=>p.dispatch())}};let{distance:a,fromObject:o,toObject:l}=e.condition;this.distance=a;for(let c of[o,l]){if(!c)throw new Error("Missing property");let u=r.find(c);if(!u)throw new Error("Missing property");this.objects.push(u)}}connect(){window.setTimeout(()=>{this.objects.forEach(t=>{t.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}),this.onUpdateMatrixWorld()},0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(t=>{t.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})}},U3e=class extends JZ{constructor(t,e,i,r,n,s){var l;super(e,i,r,n,s),this.id=t,this.data=e,this.object=i,this.onBegin=({target:c,state:u})=>{this.toState!==u&&(this.actionsOut.Audio.forEach(h=>h.dispatchConditional()),this.actionsOut.Particles.forEach(h=>h.dispatchConditional()),this.actionsOut.Video.forEach(h=>h.dispatchConditional()),this.actionsOut.Link.forEach(h=>h.dispatch()),this.actionsOut.Create.forEach(h=>h.dispatch()),this.actionsOut.Destroy.forEach(h=>h.dispatch()),this.actionsOut.Reset.forEach(h=>h.dispatch()),this.actionsIn.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(h=>h.play()),this.actionsOut.Animation.forEach(h=>h.play()),this.actionsIn.SwitchCamera.forEach(h=>h.pause()),this.actionsOut.SwitchCamera.forEach(h=>h.play()),this.actionsOut.SceneTransition.forEach(h=>h.dispatch()),this.actionsOut.SetVariable.forEach(h=>h.checkConditions()),this.actionsOut.SetVariable.forEach(h=>h.dispatch()),this.actionsOut.DynamicVariablePlay.forEach(h=>h.dispatch()),this.actionsOut.ClearLocalStorage.forEach(h=>h.dispatch()),this.actionsOut.UserAPI.forEach(h=>h.dispatch()))},this.onComplete=({target:c,state:u})=>{this.toState===u&&(this.actionsIn.Audio.forEach(h=>h.dispatchConditional()),this.actionsIn.Particles.forEach(h=>h.dispatchConditional()),this.actionsIn.Video.forEach(h=>h.dispatchConditional()),this.actionsIn.Link.forEach(h=>h.dispatch()),this.actionsIn.Create.forEach(h=>h.dispatch()),this.actionsIn.Destroy.forEach(h=>h.dispatch()),this.actionsIn.Reset.forEach(h=>h.dispatch()),this.actionsOut.Transition.forEach(h=>h.pause()),this.actionsOut.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(h=>h.play()),this.actionsIn.Animation.forEach(h=>h.play()),this.actionsOut.SwitchCamera.forEach(h=>h.pause()),this.actionsIn.SwitchCamera.forEach(h=>h.play()),this.actionsIn.SceneTransition.forEach(h=>h.dispatch()),this.actionsIn.SetVariable.forEach(h=>h.checkConditions()),this.actionsIn.SetVariable.forEach(h=>h.dispatch()),this.actionsIn.DynamicVariablePlay.forEach(h=>h.dispatch()),this.actionsOut.ClearLocalStorage.forEach(h=>h.dispatch()),this.actionsOut.UserAPI.forEach(h=>h.dispatch()))};let{condition:a}=e;if(!a.object)throw new Error("Missing property");let o=r.find(a.object)??r.scene.find2D(a.object);if(!o)throw new Error("Missing property");if(this.toObject=o,a.state&&!((l=this.toObject.states)!=null&&l[a.state]))throw new Error("Missing property");this.toState=a.state}connect(){a0(this.actionsOut).forEach(t=>{var e;(e=this.actionsOut[t])!=null&&e.length&&this.toObject.addEventListener("beginState",this.onBegin)}),a0(this.actionsIn).forEach(t=>{var e;(e=this.actionsIn[t])!=null&&e.length&&this.toObject.addEventListener("completeState",this.onComplete)})}disconnect(){super.disconnect(),a0(this.actionsOut).forEach(t=>{var e;(e=this.actionsIn[t])!=null&&e.length&&this.toObject.removeEventListener("beginState",this.onBegin)}),a0(this.actionsIn).forEach(t=>{var e;(e=this.actionsIn[t])!=null&&e.length&&this.toObject.removeEventListener("completeState",this.onComplete)})}},B3e=class extends Uo{constructor(t,e){super(t),this.eventManager=e,this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1}connect(){super.connect();let{page:t,sharedAssets:e}=this.eventContext;t.traverseEntity(i=>{var r;if((r=i.data)!=null&&r.events.length){for(let{id:n,data:s}of i.data.events)if(!s.disabled&&s.type==="Conditional")try{let a;s.condition.type==="Comparison"||(s.condition.type==="Distance"?a=new z3e(n,s,i,t,e,this.eventManager):s.condition.type==="State"&&(a=new U3e(n,s,i,t,e,this.eventManager))),a&&(this.eventsPerConditions[s.condition.type].push(a),(a.actionsIn.Video.length||a.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch{}}}),Object.values(this.eventsPerConditions).forEach(i=>i.forEach(r=>r.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(t=>t.forEach(e=>e.disconnect()))}},dS=new W,zm=new W,Tv=new W,r8=new Bl,N3e=.01,Hr=new W,ea=new W,n8=new W,f0=new Ci,IL=new ia,F3e=new Ot,zL=new Hs,xx=new W,Sd=new W,UL=.2;function BL(t,e){!e||(e[0]<e[1]&&(t.x=Math.min(Math.max(t.x,e[0]),e[1])),e[2]<e[3]&&(t.y=Math.min(Math.max(t.y,e[2]),e[3])),e[4]<e[5]&&(t.z=Math.min(Math.max(t.z,e[4]),e[5])))}var k3e=function(){let t=new Ot;return(e,i,r)=>{let n=e.obj;t.copy(n.hiddenMatrix),n.parent!==null&&t.premultiply(n.parent.matrixWorld),t.invert(),n.position.copy(i),e.reference==="global"&&BL(n.position,e.limits),n.position.applyMatrix4(t),e.reference==="parent"?BL(n.position,e.limits):e.reference==="local"&&(f0.copy(e.quat0).invert(),n.position.sub(e.position0),n.position.applyQuaternion(f0),BL(n.position,e.limits),f0.invert(),n.position.applyQuaternion(f0),n.position.add(e.position0)),t.multiply(r??n.matrixWorld).decompose(Hr,n.quaternion,ea),n.updateMatrix(),n.hasNonUniformScale&&(n.updateMatrixWorld(),n.updateMatrixWorldSVD()),n instanceof hl&&yp(n.parent)&&n.invalidateDownstreamBooleanData(!0)}}(),V3e=class{constructor(t,e,i,r,n,s,a){this.object=t,this.id=e,this.data=i,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=this.data.resetSpeed===0?1:8/this.data.resetSpeed+1,this.snapDampingFactor=this.data.snapSpeed===0?1:8/this.data.snapSpeed+1,this.actionsDrag=qs(i,i.dragDropActions.drag,r,n,s,this.object),this.actionsDrop=qs(i,i.dragDropActions.drop,r,n,s,this.object);let o=[];this.data.objects.forEach(l=>{let c=r.find(l);!c||c.data.visible!==!1&&(o.push(c),a[c.uuid]&&a[c.uuid].forEach(u=>{let h=r.find(u);!h||h.data.visible!==!1&&o.push(h)}))}),this.data.dropDestinations.forEach(l=>{let c=r.find(l);!c||c.data.visible!==!1&&(this.dropDestIds.push(c.uuid),a[c.uuid]&&a[c.uuid].forEach(u=>{let h=r.find(u);!h||h.data.visible!==!1&&this.dropDestIds.push(h.uuid)}))}),this.dragItems=o.map(l=>(this.data.planeMode==="locked"&&(l.userData.lockedPlane=!0),l.userData.worldPosition0=new W().setFromMatrixPosition(l.matrixWorld),{obj:l,fromPosition:new W().setFromMatrixPosition(l.matrixWorld),pointStart:new W,pointEnd:new W,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:new W().copy(l.position),quat0:new Ci().copy(l.quaternion),snapped:!1,orientationMatrix:new Ot,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return this.activeIdx!==null?this.dragItems[this.activeIdx]:null}dispose(){Ia(this.actionsDrag),Ia(this.actionsDrop),this.dragItems.forEach(t=>{t.fromPosition.copy(t.obj.userData.worldPosition0),t.pointStart.copy(t.fromPosition),t.pointEnd.copy(t.pointStart),t.obj.recursiveBBoxNeedsUpdate=!0,t.obj.userData.lockedPlane=void 0,t.obj.position.copy(t.position0),t.obj.quaternion.copy(t.quat0),t.obj.updateMatrix()})}},H3e=class extends Uo{constructor(t,e){super(t),this.eventManager=e,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=i=>{var a;if(Ai.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if(this.lastDropDestination=null,s.length===0){this.activeEvent=null;return}for(let o of this.events){let l=0;for(let{obj:c,pointEnd:u,pointStart:h}of o.dragItems){if(c===s[0].object||c===s[0].object.object||gr.is(c)&&c.isAncestorOf(s[0].object.uuid)){if(o.activeIdx=l,o.activeDragItem.reset=!1,o.activeDragItem.currentDampingFactor=o.data.dampingFactor,o.activeDragItem.snapped=!1,o.data.cursor==="hand"&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){o.activeDragItem.obj.rigidBody&&o.activeDragItem.obj.rigidBody.setBodyType(2,!0);let d=o.activeDragItem.obj;c.hasNonUniformScale&&c.updateMatrixWorldSVD(),(d.hasNonUniformScale?d.matrixWorldRigid:d.matrixWorld).decompose(Hr,f0,ea),IL.setFromQuaternion(f0),d.prevR===void 0?(d.prevR=IL.clone(),d.prevT=Hr.clone()):(d.prevR.copy(IL),d.prevT.copy(Hr)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(o.activeDragItem.obj)}this.calcPlaneIntersectPos(c,h,o.data.plane,o.data.referenceFrame),u.copy(h),(this.eventManager.controlsManager.usePhysics&&((a=c.data.physics)==null?void 0:a.rigidBody)==="dynamic"||o.data.drop===!1||o.data.resetOnSnapFail===!1)&&o.activeDragItem.fromPosition.setFromMatrixPosition(o.activeDragItem.obj.matrixWorld),this.activeEvent=o,this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1);return}l++}}this.activeEvent=null},this.onPointerMove=i=>{var a,o,l,c;if(Ai.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if(Ai.length===0){let u=!1;for(let h of this.events){for(let{obj:d}of h.dragItems)if(d===((a=s[0])==null?void 0:a.object)||d===((l=(o=s[0])==null?void 0:o.object)==null?void 0:l.object)||gr.is(d)&&d.isAncestorOf((c=s[0])==null?void 0:c.object.uuid)){switch(u=!0,h.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move");break}break}if(u)break}u||this.setCursor("default");return}if(this.activeEvent&&this.activeEvent.activeDragItem){let u=this.activeEvent.activeDragItem;u.snapped=!1;let h;if(this.activeEvent.data.drop&&(h=s.filter(d=>u.obj!==d.object&&!u.obj.isAncestorOf(d.object.uuid)&&!(d.object instanceof w1)&&(this.activeEvent.data.dropOn==="all"||this.activeEvent.dropDestIds.some(p=>p===d.object.uuid||n.scene.find(p).isAncestorOf(d.object.uuid))))[0]),h){let d=n8.copy(h.face.normal).applyMatrix3(zL.getNormalMatrix(h.object.matrixWorld));if(this.activeEvent.data.snapTo==="center")u.fromPosition.setFromMatrixPosition(h.object.matrixWorld);else if(this.activeEvent.data.snapTo==="surface"){if(u.fromPosition.copy(h.point),this.activeEvent.data.snapSurfaceMode==="bbox"){Hr.copy(d).applyMatrix3(zL.setFromMatrix4(u.obj.matrixWorld).transpose());let p=u.obj;Hr.x>UL?ea.x=-p.recursiveBBox.min.x:Hr.x<-.2&&(ea.x=-p.recursiveBBox.max.x),Hr.y>UL?ea.y=-p.recursiveBBox.min.y:Hr.y<-.2&&(ea.y=-p.recursiveBBox.max.y),Hr.z>UL?ea.z=-p.recursiveBBox.min.z:Hr.z<-.2&&(ea.z=-p.recursiveBBox.max.z),ea.applyMatrix3(zL.invert())}else ea.copy(d).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);u.fromPosition.add(ea)}this.activeEvent.data.autoOrient&&(Hr.set(0,1,0).cross(d),Hr.length()<1e-4&&Hr.set(-1,0,0).cross(d),ea.crossVectors(n8,Hr),u.orientationMatrix.makeBasis(Hr,ea,d)),u.pointStart.copy(u.fromPosition),u.pointEnd.copy(u.pointStart),u.currentDampingFactor=this.activeEvent.snapDampingFactor,u.snapped=!0,this.lastDropDestination!==h.object&&(this.lastDropDestination=h.object,this.activeEvent.actionsDrop.Transition.forEach(p=>{p.play()}),this.activeEvent.actionsDrop.Animation.forEach(p=>{p.play()}),this.activeEvent.actionsDrop.Audio.forEach(p=>{p.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Particles.forEach(p=>{p.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(p=>{p.dispatchThrottled()}))}else u.orientationMatrix.makeRotationFromQuaternion(u.quat0),this.lastDropDestination=null,u.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(u.obj,u.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(d=>{d.stop(),d.object.currentState!==null&&d.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Animation.forEach(d=>{d.stop()}),this.activeEvent.actionsDrop.Audio.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.Particles.forEach(d=>{d.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(d=>{d.dispatchThrottled()}),this.activeEvent.actionsDrag.SetVariable.forEach(d=>d.checkConditions()),this.activeEvent.actionsDrag.SetVariable.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.ClearLocalStorage.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.UserAPI.forEach(d=>d.dispatch()),this.activeEvent.wasDragEventTriggered===!1&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(d=>{d.play()}),this.activeEvent.actionsDrag.Animation.forEach(d=>{d.play()}),this.activeEvent.actionsDrag.Audio.forEach(d=>{d.dispatchGameControl("start")}),this.activeEvent.actionsDrag.Particles.forEach(d=>{d.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(d=>{d.stop(),d.object.currentState!==null&&d.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(d=>{d.stop()}))},500),this.updateDragItem(u),u.obj.dispatchEvent({type:"requestRender"})}},this.onPointerUp=i=>{var r;if(this.activeEvent&&this.activeEvent.activeDragItem){this.activeEvent.data.cursor==="hand"&&this.setCursor("grab");let n=((r=this.activeEvent.activeDragItem.obj.data.physics)==null?void 0:r.rigidBody)==="dynamic";this.activeEvent.activeDragItem.snapped===!1&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(this.eventManager.controlsManager.usePhysics===!1||!n)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&n&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),this.activeEvent.wasDragEventTriggered===!0&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(s=>{s.stop(),s.object.currentState!==null&&s.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(s=>{s.stop()}),this.activeEvent.actionsDrag.Audio.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.checkConditions()),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.ClearLocalStorage.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.UserAPI.forEach(s=>s.dispatch())),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}}}connect(){let t={};if(this.eventContext.page.traverseEntity(i=>{i.component&&(t[i.component.uuid]?t[i.component.uuid].push(i.uuid):t[i.component.uuid]=[i.uuid])}),this.eventContext.page.traverseEntity(i=>{var r;(r=i.data)==null||r.events.filter(n=>n.data.type==="DragDrop"&&!n.data.disabled).forEach(n=>{this.events.push(new V3e(i,n.id,n.data,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager,t))})}),!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let e=this.eventContext.domElement;e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointermove",this.onPointerMove),e.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let t=this.eventContext.domElement;t.removeEventListener("pointerdown",this.onPointerDown),t.removeEventListener("pointermove",this.onPointerMove),t.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(e=>e.dispose())}setCursor(t){this.eventContext.domElement.style.cursor=t}onAnimationFrameDamping(){for(let t of this.events)for(let e of t.dragItems)e.paused||this.updateDragItem(e,!0)}calcPlaneIntersectPos(t,e,i,r){let{getCamera:n,raycaster:s}=this.eventContext;n().getWorldDirection(zm),zm.negate();let a=f0.identity();switch(r==="parent"?F3e.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix).decompose(Hr,a,ea):r==="local"&&t.matrixWorld.decompose(Hr,a,ea),i){case"x":Hr.set(1,0,0).applyQuaternion(a),xx.copy(zm).cross(Hr),Sd.copy(Hr).cross(xx);break;case"y":Hr.set(0,1,0).applyQuaternion(a),xx.copy(zm).cross(Hr),Sd.copy(Hr).cross(xx);break;case"z":Hr.set(0,0,1).applyQuaternion(a),xx.copy(zm).cross(Hr),Sd.copy(Hr).cross(xx);break;case"xy":Sd.set(0,0,1).applyQuaternion(a);break;case"yz":Sd.set(1,0,0).applyQuaternion(a);break;case"xz":Sd.set(0,1,0).applyQuaternion(a);break;case"adaptive":zm.angleTo(ea.set(0,1,0))>Math.PI/6?(Hr.crossVectors(ea.set(0,1,0),zm),Sd.crossVectors(Hr,ea)):Sd.set(0,1,0);break;default:Sd.copy(zm);break}Tv.setFromMatrixPosition(t.matrixWorld);let o=t.userData.lockedPlane?t.userData.worldPosition0:Tv;if(r8.setFromNormalAndCoplanarPoint(Sd,o),!!s.ray.intersectPlane(r8,e)&&(i==="x"||i==="y"||i==="z")){let l=ea.subVectors(e,o).dot(Hr);e.copy(o).addScaledVector(Hr,l)}}updateDragItem(t,e=!1){var i,r;Tv.setFromMatrixPosition(t.obj.matrixWorld),t.reset==="current"?dS.subVectors(t.fromPosition,Tv).divideScalar(t.currentDampingFactor):t.reset==="original"?(dS.subVectors(t.obj.userData.worldPosition0,Tv).divideScalar(t.currentDampingFactor),t.fromPosition.copy(t.obj.userData.worldPosition0),t.pointStart.copy(t.fromPosition),t.pointEnd.copy(t.pointStart)):dS.subVectors(t.pointEnd,t.pointStart).add(t.fromPosition).sub(Tv).divideScalar(t.currentDampingFactor),t.paused=t.currentDampingFactor>1?dS.length()<N3e:!0,(this.activeEvent&&this.activeEvent.data.dampingFactor===1||e)&&k3e(t,dS.add(Tv),(i=this.activeEvent)!=null&&i.data.drop&&((r=this.activeEvent)!=null&&r.data.autoOrient)?t.orientationMatrix:null),t.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},bx=new W,NL=new W,jf=new W,Wf=new W,s8=new Bl,G3e=.01,j3e={type:"requestRender"},W3e=function(){let t=new W,e=new W;return(i,r,n)=>n>0?(t.subVectors(i,r),t.length()<=n?i:e.copy(r).add(t.normalize().multiplyScalar(n))):r}(),a8=function(){let t=new Ot;return(e,i)=>{e.position.copy(i),e.parent!==null&&(t.copy(e.parent.matrixWorld).invert(),e.position.applyMatrix4(t)),t.copy(e.hiddenMatrix).invert(),e.position.applyMatrix4(t),e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),e instanceof hl&&yp(e.parent)&&e.invalidateDownstreamBooleanData(!0)}}(),q3e=class{constructor(t,e,i,r,n,s){this.data=t,this.id=e,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new W,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...eU.defaultData,...t,...t.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},t.target===void 0||t.target==="cursor"||(this.target=r.find(t.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=qs(t,t.actions,r,n,s,i)}},X3e=class extends Uo{constructor(t,e){super(t),this.eventManager=e,this.events=[],this.pairOfEventListeners=[],this.onMouseMove=i=>{if(!(Ai.length>1)){this.eventContext.updateRaycaster(i);for(let r of this.events)r.target===void 0&&this.updateSingleEvent(r)}},this.onMouseEnter=i=>{for(let r of this.events)r.target===void 0&&(r.isReset=!1,r.currentDampingFactor=r.data.dampingFactor)},this.onMouseLeave=i=>{for(let r of this.events)r.target===void 0&&(r.data.resetOnPointerLeave&&(r.isReset=!0,r.currentDampingFactor=r.resetDampingFactor),this.updateSingleEvent(r))},this.onTargetChange=i=>()=>{this.updateSingleEvent(i)}}connect(){let{page:t}=this.eventContext;if(t.traverseEntity(r=>{var s,a;let n=(s=r.data)==null?void 0:s.events.find(o=>o.data.type==="Follow"&&!o.data.disabled);n&&(!t.data.globalPhysics.usePhysics||((a=r.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new q3e(n.data,n.id,r,t,this.eventContext.sharedAssets,this.eventManager))}),!this.events.length)return;let{domElement:e,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),vc&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events)if(r.target!==void 0){let n=r.target,s=this.onTargetChange(r);this.pairOfEventListeners.push([n,s]),n.addEventListener("requestRender",s)}}disconnect(){if(!this.events.length)return;let{domElement:t,eventElement:e}=this.eventContext;this.domEventsNeeded.clear(),vc&&t.removeEventListener("pointerdown",this.onMouseMove),e.removeEventListener("pointermove",this.onMouseMove),t.removeEventListener("pointerenter",this.onMouseEnter),t.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let i of this.events)i.paused=!0,i.isReset=!1,Ia(i.actions)}onAnimationFrameDamping(){for(let t of this.events)t.paused||this.updateSingleEvent(t,!0)}updateSingleEvent(t,e=!1){var a;this.events.forEach(o=>{o.actions.Create.forEach(l=>{l.dispatchThrottled()})});let{plane:i,limitDistance:r,limitDistanceEnabled:n}=t.data;if(t.object.getWorldPosition(jf),t.isReset)Wf.copy(t.worldPosition0);else if(t.target)t.target.getWorldPosition(Wf);else{let{getCamera:o,raycaster:l}=this.eventContext;if(i==="custom"?(o().getWorldDirection(NL),NL.negate(),bx.copy(NL)):i==="xy"?bx.set(0,0,1):i==="xz"?bx.set(0,1,0):i==="yz"&&bx.set(1,0,0),s8.setFromNormalAndCoplanarPoint(bx,jf),!l.ray.intersectPlane(s8,Wf))return}if(!t.isReset){if(Wf.distanceTo(t.worldPosition0)>r&&n&&t.target)if(t.snapComplete=!1,t.data.snapDelay&&(t.delayFinished=!1,typeof window<"u"&&t.timeoutId!==null&&(window.clearTimeout(t.timeoutId),t.timeoutId=null)),t.wasOutside=!0,t.data.resetAfterDistanceLimit)Wf.copy(t.worldPosition0),t.currentDampingFactor=t.resetDampingFactor;else return;else if(t.wasOutside&&(t.data.snapDelay&&typeof window<"u"&&(t.timeoutId=window.setTimeout(()=>{t.delayFinished=!0,t.paused=!1,this.updateSingleEvent(t)},t.data.snapDelay*1e3)),t.currentDampingFactor=t.data.dampingFactor,t.wasOutside=!1),t.delayFinished===!1)return}t.data.enabledTranslation[0]===!1&&(Wf.x=jf.x),t.data.enabledTranslation[1]===!1&&(Wf.y=jf.y),t.data.enabledTranslation[2]===!1&&(Wf.z=jf.z);let s=W3e(jf,Wf,t.wasOutside?0:t.data.maxDelta);if(t.currentDampingFactor>1){let o=bx.subVectors(s,jf).divideScalar(t.currentDampingFactor);jf.add(o),e&&a8(t.object,jf),t.paused=o.length()<G3e}else a8(t.object,s),t.paused=!0;(a=t.object)==null||a.dispatchEvent({type:"beginEvent",eventName:"Follow"}),t.object.dispatchEvent(j3e)}},fS=new W,N2=new W,pS=new Ot,_x=new Ci,Um=new Ci,mS=new W,gS=new W,Cv=new W,qf=new W,FL=new Bl,Y3e=1e-6,Q3e={type:"requestRender"},Z3e={type:"changeRotation"},o8=function(){let t=new Ot;return function(e,i){e.parent!==null?t.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix):t.copy(e.hiddenMatrix),i.premultiply(XZ(t).invert()),e.rotation.setFromRotationMatrix(i),e.updateMatrix(),e instanceof hl&&yp(e.parent)&&e.invalidateDownstreamBooleanData(!0)}}(),K3e=class{constructor(t,e,i,r){this.id=e,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new Ci,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...tU.defaultData,...t,...t.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},t.target===void 0||t.target==="cursor"||(this.target=r.find(t.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},J3e=class extends Uo{constructor(){super(...arguments),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=t=>{if(!(Ai.length>1)){this._lastMouseEvent=t,this.eventContext.updateRaycaster(t);for(let e of this.events)e.target===void 0&&this.updateSingleEvent(e)}},this.onMouseEnter=t=>{for(let e of this.events)e.target===void 0&&(e.isReset=!1,e.currentDampingFactor=e.data.dampingFactor)},this.onMouseLeave=t=>{for(let e of this.events)e.target===void 0&&(e.data.resetOnPointerLeave&&(e.isReset=!0,e.currentDampingFactor=e.resetDampingFactor),this.updateSingleEvent(e))},this.onScroll=t=>{if(this._lastMouseEvent){let e=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(e)}},this.onTargetChange=t=>()=>{this.updateSingleEvent(t)},this.createUserEventListener=t=>({eventName:e,target:i})=>{if(!e||!i)return;let r=IM(e);r&&r==="LookAt"&&this.updateSingleEvent(t)}}connect(){let{page:t}=this.eventContext;if(t.traverseEntity(r=>{var s,a;let n=(s=r.data)==null?void 0:s.events.find(o=>o.data.type==="LookAt"&&!o.data.disabled);n&&(!t.data.globalPhysics.usePhysics||((a=r.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new K3e(n.data,n.id,r,t))}),!this.events.length)return;let{domElement:e,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),vc&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?i.addEventListener("scroll",this.onScroll):(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events){if(r.target!==void 0){let a=this.onTargetChange(r),o=r.target;this.pairOfEventListeners.push([o,a]),o.addEventListener("requestRender",a)}let n=this.createUserEventListener(r),s=r.object;this.pairOfUserEventListeners.push([s,n]),s.addEventListener("userEvent",n)}}disconnect(){if(!this.events.length)return;let{domElement:t,eventElement:e}=this.eventContext;this.domEventsNeeded.clear(),vc&&t.removeEventListener("pointerdown",this.onMouseMove),e.removeEventListener("pointermove",this.onMouseMove),t.removeEventListener("pointerenter",this.onMouseEnter),t.removeEventListener("pointerleave",this.onMouseLeave),e.removeEventListener("scroll",this.onScroll);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let[i,r]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",r);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let t of this.events)t.paused||this.updateSingleEvent(t)}updateSingleEvent(t){var d;let{tilt:e,axis:i,distance:r,plane:n,limitDistance:s,enabledRotation:a,limitDistanceEnabled:o}=t.data,{getCamera:l,raycaster:c}=this.eventContext,{object:u,target:h}=t;if(u.getWorldPosition(mS),!t.isReset)if(t.target)t.target.getWorldPosition(gS);else{if(n==="custom"?(l().getWorldDirection(N2),N2.negate(),FL.setFromNormalAndCoplanarPoint(N2,mS)):(n==="xy"?fS.set(0,0,1):n==="xz"?fS.set(0,1,0):n==="yz"&&fS.set(1,0,0),FL.setFromNormalAndCoplanarPoint(fS,mS)),!c.ray.intersectPlane(FL,gS))return;r>0&&(n==="custom"||n===void 0)&&gS.addScaledVector(N2,r)}if(t.isReset||(h?e==="target"?Cv.copy(h.up).applyMatrix4(pS.extractRotation(h.matrixWorld)).normalize():a.some(p=>p===!1)?(i==="x"?(qf.set(0,0,1),a[2]===!1&&qf.set(0,1,0)):i==="y"?(qf.set(1,0,0),a[0]===!1&&qf.set(0,0,1)):(qf.set(0,1,0),a[1]===!1&&qf.set(1,0,0)),Cv.copy(qf).applyQuaternion(t.worldQuaternion0).normalize()):Cv.set(0,1,0):n==="custom"?Cv.set(0,1,0):Cv.copy(fS)),t.isReset)Um.copy(t.worldQuaternion0);else if(mS.distanceTo(gS)>s&&o&&h)if(t.data.snapDelay&&(t.delayFinished=!1,typeof window<"u"&&t.timeoutId!==null&&(window.clearTimeout(t.timeoutId),t.timeoutId=null)),t.wasOutside=!0,t.data.resetAfterDistanceLimit)Um.copy(t.worldQuaternion0),t.currentDampingFactor=t.resetDampingFactor;else return;else{if(t.wasOutside&&(t.data.snapDelay&&typeof window<"u"&&(t.timeoutId=window.setTimeout(()=>{t.delayFinished=!0,t.paused=!1,this.updateSingleEvent(t)},t.data.snapDelay*1e3)),t.currentDampingFactor=t.data.dampingFactor,t.wasOutside=!1),t.delayFinished===!1)return;$3e(pS,gS,mS,Cv,i,qf),Um.setFromRotationMatrix(pS),_x.setFromUnitVectors(qf.applyQuaternion(Um),Cv),a.some(p=>p===!1)&&e!=="target"&&Um.premultiply(_x).normalize()}t.currentDampingFactor>1?(u.updateWorldMatrix(!0,!1),_x.setFromRotationMatrix(XZ(u.matrixWorld)),_x.slerp(Um,1/t.currentDampingFactor),o8(u,pS.makeRotationFromQuaternion(_x)),t.paused=8*(1-_x.dot(Um))<Y3e):(o8(u,pS.makeRotationFromQuaternion(Um)),t.paused=!0),(d=t.object)==null||d.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),u.dispatchEvent(Q3e),u.dispatchEvent(Z3e)}},Wc=new W,$s=new W,As=new W;function $3e(t,e,i,r,n,s){let a=t.elements;As.subVectors(e,i),As.lengthSq()===0&&(As.z=1),As.normalize(),$s.crossVectors(r,As),$s.lengthSq()===0&&(Math.abs(r.z)===1?As.x+=1e-4:As.z+=1e-4,As.normalize(),$s.crossVectors(r,As)),$s.normalize(),Wc.crossVectors(As,$s),n==="x"?s.z===1?[$s,Wc,As]=[As,$s,Wc]:($s.negate(),[$s,As]=[As,$s]):n==="y"?s.x===1?[$s,Wc,As]=[Wc,As,$s]:($s.negate(),[Wc,As]=[As,Wc]):s.x===1&&($s.negate(),[$s,Wc]=[Wc,$s]),a[0]=$s.x,a[4]=Wc.x,a[8]=As.x,a[1]=$s.y,a[5]=Wc.y,a[9]=As.y,a[2]=$s.z,a[6]=Wc.z,a[10]=As.z}var ePe=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.entered=!1,this.actions=qs(e,e.actions,r,n,s,i)}disconnect(){Ia(this.actions)}dispatchEnter(){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.entered||(this.entered=!0,this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.play()),this.actions.Create.forEach(t=>t.dispatchStart()),this.actions.Particles.forEach(t=>t.dispatchBasic()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent()),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()))}dispatchLeave(){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.entered&&(this.entered=!1,this.actions.Create.forEach(t=>t.dispatchStop()),this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Particles.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent()))}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.playFromCurrent()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent())),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}},tPe=class extends Uo{constructor(t,e){super(t),this.eventManager=e,this.eventsPerObjects={},this.objects=[],this.objects2D=[],this._prevObjects=[],this.onMouseDown=i=>{Ai.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onMouseUp=i=>{Ai.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=i=>{Ai.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a;if(!i||!r)return;let s=IM(i);s&&s==="MouseHover"&&(r.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(a=this.eventsPerObjects[r.uuid])==null||a.forEach(o=>o.dispatchUserEvent(n)))}}connect(){let{page:t,sharedAssets:e}=this.eventContext,i=(n,s)=>{var a,o;if(!(!n.visible||!((a=n.data)!=null&&a.events.length))){for(let{id:l,data:c}of n.data.events)if(!c.disabled&&c.type==="MouseHover")try{let u=new ePe(l,c,n,t,e,this.eventManager);this.eventsPerObjects[n.uuid]?this.eventsPerObjects[n.uuid].push(u):this.eventsPerObjects[n.uuid]=[u]}catch{}(o=this.eventsPerObjects[n.uuid])!=null&&o.length&&this.objects.push(n instanceof za?s:n)}};if(t.traverseEntity(n=>{var s;(n instanceof Ro||n instanceof Ca)&&((s=n.frame)==null||s.traverse(a=>{i(a,n)})),i(n)}),!this.objects.length)return;let{domElement:r}=this.eventContext;this.domEventsNeeded.clear(),vc&&(this.domEventsNeeded.add("pointerdown"),r.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),r.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),r.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(n=>{n.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:t}=this.eventContext;this.domEventsNeeded.clear(),vc&&(t.removeEventListener("pointerdown",this.onMouseDown),t.removeEventListener("pointerup",this.onMouseUp)),t.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(e=>{e.forEach(i=>{i.disconnect()})}),this.objects.forEach(e=>{e.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(t=!1){let e=[];if(!t){let{stopRaycast:i,raycaster:r,page:n,pointerScreen:s}=this.eventContext,a=!1;if(n.uiCanvas&&(a=lp(n,[s.x,s.y],Object.keys(this.eventsPerObjects),o=>{e.push(o)})),i&&!a){let o=lC(r,n,this.objects);e=wB(o),o.forEach(l=>{var c,u;l.object instanceof Ro&&lp(l.object,[((c=l==null?void 0:l.uv)==null?void 0:c.x)??0,((u=l==null?void 0:l.uv)==null?void 0:u.y)??0],Object.keys(this.eventsPerObjects),h=>{e.push(h)})})}else this.objects.forEach(o=>{var c,u;let l=ED(r,o);l&&(e.push(o),o instanceof Ro&&lp(o,[((c=l==null?void 0:l.uv)==null?void 0:c.x)??0,((u=l==null?void 0:l.uv)==null?void 0:u.y)??0],Object.keys(this.eventsPerObjects),h=>{e.push(h)}))})}this._prevObjects.length&&this._prevObjects.forEach(i=>{var r;e.includes(i)||(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchLeave()))}),e.length&&e.forEach(i=>{var r;i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchEnter())}),this._prevObjects=e}},iPe=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.scrollCounter=0,this.actions=qs(e,e.actions,r,n,s,i)}connect(){this.scrollCounter=0}disconnect(){Ia(this.actions)}dispatch(t){this.actions.Transition.forEach(r=>{r.object.currentTransitionEvent!==this&&(r.object.currentTransitionEvent=this,r.init())});let e=t>0?1:-1;this.scrollCounter+=e,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(r=>r.seek(i)),this.actions.Animation.forEach(r=>r.seek(e)),this.actions.Create.forEach(r=>r.dispatchThrottled()),this.actions.SetVariable.forEach(r=>r.checkConditions()),this.actions.SetVariable.forEach(r=>r.dispatch()),this.actions.DynamicVariablePlay.forEach(r=>r.dispatch()),this.actions.ClearLocalStorage.forEach(r=>r.dispatch()),this.actions.UserAPI.forEach(r=>r.dispatch())}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>{e.playFromCurrent()}),this.actions.Animation.forEach(e=>{e.playFromCurrent()})),this.actions.Create.forEach(e=>e.dispatchThrottled()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}},rPe=class{constructor(t,e,i,r,n,s,a){this.id=t,this.data=e,this.object=i,this.domElement=s,this.eventManager=a,this.scrollStart=0,this.scrollEnd=0,this.actions=qs(e,e.actions,r,n,a,i)}getStickyParentElement(){let t=this.domElement;for(;t;){if(window.getComputedStyle(t).position==="sticky")return t;t=t.parentElement}return null}computeScrollBounds(){let t=this.getStickyParentElement(),e=t==null?void 0:t.parentElement,i=this.domElement.getBoundingClientRect(),r={top:i.top,bottom:i.bottom,left:i.left,right:i.right,width:i.width,height:i.height};if(e){let c=e.getBoundingClientRect(),u=window.getComputedStyle(t),h=parseFloat(u.marginTop)+parseFloat(u.marginBottom),d=parseFloat(u.top),p=parseFloat(u.bottom),g=c.height-h;if(!isNaN(d))i.top===d?(r.top+=c.top-d,r.bottom+=c.top-d):i.top<0&&(r.top-=g-i.height,r.bottom-=g-i.height);else if(!isNaN(p)){let x=document.body.clientHeight??window.innerHeight,v=window.innerWidth-(document.documentElement.clientWidth??window.innerWidth);i.bottom===x-p?(r.top+=c.top-i.height+p+v,r.bottom+=c.top-i.height+p+v):i.bottom<x-p&&(r.top-=g-i.height,r.bottom-=g-i.height)}}let n=document.body,s=document.documentElement,a=window.pageYOffset||s.scrollTop||n.scrollTop,o=s.clientTop||n.clientTop||0,l=Math.round(r.top+a-o);if(this.data.startFrom==="enter"){let c=window.innerHeight,u=r.height,h=this.data.enterAnchor,d=h==="top"?c:h==="bottom"?c-u:c-u*.5;this.scrollStart=l-d}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=r,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){Ia(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return this.box===void 0||this.box.width===0&&this.box.height===0&&this.box.top===0&&this.box.bottom===0}computeScroll({x:t,y:e}){this.actions.Transition.forEach(n=>{n.object.currentTransitionEvent!==this&&(n.object.currentTransitionEvent=this,n.init())});let i=this.scrollEnd-this.scrollStart,r=Math.min(1,Math.max(0,(e-this.scrollStart)/i));this.actions.Transition.forEach(n=>n.seek(r)),this.actions.Animation.forEach(n=>n.seek(r)),this.actions.Create.forEach(n=>n.dispatchThrottled()),this.actions.SetVariable.forEach(n=>n.checkConditions()),this.actions.SetVariable.forEach(n=>n.dispatch()),this.actions.DynamicVariablePlay.forEach(n=>n.dispatch()),this.actions.ClearLocalStorage.forEach(n=>n.dispatch()),this.actions.UserAPI.forEach(n=>n.dispatch())}dispatch(t){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(t)}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>{e.playFromCurrent()}),this.actions.Animation.forEach(e=>{e.playFromCurrent()})),this.actions.Create.forEach(e=>e.dispatchThrottled()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}},nPe=class extends Uo{constructor(t,e){super(t),this.managers=e,this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([i,r])=>{r.forEach(n=>n.handleResize())})},this.onScroll=i=>{if(!this.isInview)return;let r={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([n,s])=>{n.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:r}),s.forEach(a=>a.dispatch(r))})},this.onWheel=i=>{!this.isInview||i.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([r,n])=>{r.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:i.deltaY}),n.forEach(s=>s.dispatch(i.deltaY))})},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a;if(!i||!r)return;let s=IM(i);s&&s==="Scroll"&&(r.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),(a=this.wheelEventsPerObject.get(r))==null||a.forEach(o=>{o.dispatchUserEvent(n)}))}}connect(){let{page:t,sharedAssets:e,domElement:i,isExport:r}=this.eventContext,n=s=>{var a,o,l;if((a=s.data)!=null&&a.events.length){for(let{id:c,data:u}of s.data.events)if(!u.disabled&&u.type==="Scroll")if(u.trigger==="load"||!r){let h=new iPe(c,u,s,t,e,this.managers);this.wheelEventsPerObject.has(s)?(o=this.wheelEventsPerObject.get(s))==null||o.push(h):this.wheelEventsPerObject.set(s,[h])}else{let h=new rPe(c,u,s,t,e,i,this.managers);this.scrollEventsPerObject.has(s)?(l=this.scrollEventsPerObject.get(s))==null||l.push(h):this.scrollEventsPerObject.set(s,[h])}}};t.traverseEntity(s=>{var a;(s instanceof Ro||s instanceof Ca)&&((a=s.frame)==null||a.traverse(o=>{n(o)})),n(s)}),this.intersectionObserver=new IntersectionObserver(s=>{let a=s[0];a&&(this.isInview=a.isIntersecting)},{root:null}),this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([t,e])=>{e.forEach(i=>i.disconnect()),t.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([t,e])=>{e.forEach(i=>i.disconnect()),t.removeEventListener("userEvent",this.onUserEvent)})}},sPe=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.actions=qs(e,e.actions,r,n,s,i)}disconnect(){Ia(this.actions)}dispatch(){this.actions.Transition.forEach(t=>{t.play()}),this.actions.Animation.forEach(t=>{t.play()}),this.actions.SwitchCamera.forEach(t=>{t.play()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()),this.actions.Create.forEach(t=>{t.dispatchFromStart()}),this.actions.Destroy.forEach(t=>{t.dispatchFromStart()})}dispatchAfter(t){this.actions.Audio.forEach(e=>{(e.interaction.data.triggerAfter??"any")===t&&(e.interaction instanceof d0?e.interaction.audioPlayer.play():e.interaction instanceof vB&&e.interaction.dispatch())}),this.actions.Video.forEach(e=>{let i=e.interaction.data.triggerAfter??"autoplay";i===t&&(e.interaction instanceof E1?e.interaction.play(i==="autoplay"):e.interaction instanceof _B&&e.interaction.dispatch())}),this.actions.Particles.forEach(e=>{(e.data.triggerAfter??"any")===t&&e.dispatchBasic()})}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.playFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent())),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch()}),this.actions.Audio.forEach(e=>{e.interaction instanceof d0?e.interaction.audioPlayer.play():e.interaction instanceof vB&&e.interaction.dispatch()}),this.actions.Video.forEach(e=>{e.interaction instanceof E1?e.interaction.play():e.interaction instanceof _B&&e.interaction.dispatch()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()})}},aPe=class extends Uo{constructor(t,e){super(t),this.eventManager=e,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:i,isExport:r}=this.eventContext,n=r?document:i;n.removeEventListener("pointerdown",this.onAny),n.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([s,a])=>{s.dispatchEvent({type:"beginEvent",eventName:"Start"}),a.forEach(o=>{o.dispatchAfter("any")})})},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.actions.Audio.forEach(s=>{s.interaction instanceof d0&&s.interaction.audioPlayer.play()}),n.actions.Video.forEach(s=>{let a=s.interaction.data.triggerAfter??"autoplay";s.interaction instanceof E1&&s.interaction.play(a==="autoplay")}),n.actions.Particles.forEach(s=>{s.dispatchBasic()})})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("autoplay")})})},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a,o;if(!i||!r)return;let s=IM(i);s&&s==="Start"&&(r instanceof za||r.dispatchEvent({type:"beginEvent",eventName:"Start"}),(a=this.eventsPerObject.get(r))==null||a.forEach(l=>{l.dispatchUserEvent(n)}),(o=this.eventsAfterPerObject.get(r))==null||o.forEach(l=>{l.dispatchUserEvent(n)}))}}connect(){let{sharedAssets:t,page:e}=this.eventContext,i=r=>{var n,s,a,o,l;if((n=r.data)!=null&&n.events.length)for(let{id:c,data:u}of r.data.events){if(u.disabled||u.type!=="Start")continue;let h=new sPe(c,u,r,e,t,this.eventManager);(h.actions.Transition.length||h.actions.Animation.length||h.actions.SwitchCamera.length||h.actions.Create.length||h.actions.Destroy.length||h.actions.SceneTransition.length||h.actions.Reset.length||h.actions.SetVariable.length||h.actions.DynamicVariablePlay.length||h.actions.ClearLocalStorage.length||h.actions.UserAPI.length)&&(this.eventsPerObject.has(r)?(s=this.eventsPerObject.get(r))==null||s.push(h):this.eventsPerObject.set(r,[h])),h.actions.Audio.length&&(this.eventsAfterPerObject.has(r)?(a=this.eventsAfterPerObject.get(r))==null||a.push(h):this.eventsAfterPerObject.set(r,[h])),h.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(r)?(o=this.eventsAfterPerObject.get(r))==null||o.push(h):this.eventsAfterPerObject.set(r,[h])),h.actions.Particles.length&&(this.eventsAfterPerObject.has(r)?(l=this.eventsAfterPerObject.get(r))==null||l.push(h):this.eventsAfterPerObject.set(r,[h]))}};if(e.traverseEntity(r=>{var n;(r instanceof Ro||r instanceof Ca)&&((n=r.frame)==null||n.traverse(s=>{i(s)})),i(r)}),[...this.eventsAfterPerObject.values()].some(r=>r.length)){if(this.eventManager.activateCount===0){let{domElement:r,isExport:n}=this.eventContext,s=n?document:r;s.addEventListener("pointerdown",this.onMouseDown,{once:!0}),s.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),s.addEventListener("pointerdown",this.onAny),s.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([a,o])=>{a.addEventListener("userEvent",this.onUserEvent)})}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach(([r,n])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(s=>s.dispatch()),r.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(t=>t.length)){let{domElement:t,isExport:e}=this.eventContext,i=e?document:t;i.removeEventListener("pointerdown",this.onMouseDown),i.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([r,n])=>{r.removeEventListener("userEvent",this.onUserEvent),n.forEach(s=>s.disconnect())})}[...this.eventsPerObject.entries()].forEach(([t,e])=>{t.removeEventListener("userEvent",this.onUserEvent),e.forEach(i=>i.disconnect())}),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},oPe=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.initialDisabled=!1,this.actions=qs(e,e.actions,r,n,s,i),this.target=e.target}disconnect(){Ia(this.actions)}dispatch(t){this.initialDisabled||(this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.actions.Transition.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.Animation.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch(t??!1)}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}},lPe=class extends Uo{constructor(t,e,i,r,n){super(t),this.sharedVariables=e,this.eventManager=i,this.needsMouse=r,this.needsRaycast=n,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.isOutOfFocus=!1,this.events=[],this.onFrame=s=>{let a=this.eventContext.sharedAssets;if(this.rafId=window.requestAnimationFrame(this.onFrame),this.isOutOfFocus)return;let o=new Date,l=[],c=[];for(let d=0;d<this.propertiesToWatch.length;d++){let{objectId:p,property:g,prevValue:x}=this.propertiesToWatch[d],v=this.eventContext.scene.find(p),b=rU.propertyPaths[g];if(b[0]==="width"||b[0]==="height"||b[0]==="depth")v=v.geometry.userData.parameters[b[0]];else for(let w=0;w<b.length;w++)v=v[b[w]];x===null?this.propertiesToWatch[d].prevValue=v instanceof W?v.clone():v:(v instanceof W?!v.equals(x):x!==v)&&(c.push({objId:p,property:g}),v instanceof W?this.propertiesToWatch[d].prevValue.copy(v):this.propertiesToWatch[d].prevValue=v)}for(let d=0;d<this.variablesToWatch.length;d++){let{id:p,prevValue:g}=this.variablesToWatch[d],x=a.getVariable(p);x!==g&&(l.push(p),this.variablesToWatch[d].prevValue=x)}for(let d=0;d<this.dynamicVars.length;d++){let{id:p,expectedTime:g,last:x,data:v,timerSeconds:b,startValue:w}=this.dynamicVars[d],M=1e3;if((v.dynamicVariableType==="timer"||v.dynamicVariableType==="stopwatch")&&v.format==="number3decimal"?M=1:v.dynamicVariableType==="counter"?M=v.updateInterval:v.dynamicVariableType==="random"&&(M=v.isStatic?1/0:v.updateInterval),g===-1){this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+M;continue}if(!((a.getDynamicVariablePlayState(p)==="Stopped"||a.getDynamicVariablePlayState(p)==="Restarted")&&(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+M,v.dynamicVariableType==="counter"&&a.getVariable(p)!==w&&(a.updateVariable(p,w),this.eventManager.requestRender()),(v.dynamicVariableType==="timer"||v.dynamicVariableType==="stopwatch")&&this.dynamicVars[d].timerSeconds!==w&&(this.dynamicVars[d].timerSeconds=w,a.updateVariable(p,Kc.getFormattedTimerTime(w,v)),this.eventManager.requestRender()),a.getDynamicVariablePlayState(p)==="Restarted"&&a.setDynamicVariablePlayState(p,"Playing"),a.getDynamicVariablePlayState(p)==="Stopped"))){if(a.getDynamicVariablePlayState(p)==="Paused"){this.dynamicVars[d].deltaToExpectedTime===void 0&&(this.dynamicVars[d].deltaToExpectedTime=Math.max(this.dynamicVars[d].expectedTime-s,0)),this.dynamicVars[d].last=s-(M-this.dynamicVars[d].deltaToExpectedTime),this.dynamicVars[d].expectedTime=s+this.dynamicVars[d].deltaToExpectedTime;continue}else this.dynamicVars[d].deltaToExpectedTime=void 0;if(s>=g)if(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime+=M,v.dynamicVariableType==="random"){let E=v.min+Math.random()*(v.max-v.min),D=v.decimals;E=Math.round(E*Math.pow(10,D))/Math.pow(10,D),a.updateVariable(p,E),l.push(p),this.eventManager.requestRender()}else if(v.dynamicVariableType==="counter"){let E=a.getVariable(p),D=a.getDynamicVariableToggleIsForward(p)??!0,T=a.getVariable(p)+v.increment*(D?1:-1);v.hasEnd&&(T=v.increment>0?Qt.clamp(T,w,v.endValue):Qt.clamp(T,v.endValue,w),T===w&&a.setDynamicVariableToggleIsForward(p,void 0),v.repeat?T===v.endValue&&(T=w):(T===w||T===v.endValue)&&a.setDynamicVariablePlayState(p,"Paused")),T!==E&&(l.push(p),a.updateVariable(p,T),this.eventManager.requestRender())}else if(v.dynamicVariableType==="time"){let E=a.getVariable(p),D=_G(o,v);if(typeof E=="object"&&"textValue"in E&&typeof D=="object"&&"textValue"in D){if(Array.isArray(E.textValue)&&Array.isArray(D.textValue)){if(E.textValue.every((T,L)=>T===D.textValue[L]))continue}else if(E.textValue===D.textValue)continue}else if(E===D)continue;a.updateVariable(p,D),l.push(p),this.eventManager.requestRender()}else{let E=to.isTextValue(v.endValue)?l8(v.endValue.textValue):v.endValue,D=a.getDynamicVariableToggleIsForward(p)??!0,T=b+(s-x)/1e3*(v.dynamicVariableType==="timer"?-1:1)*(D?1:-1);T=Math.max(T,0),v.hasEnd&&(T=v.dynamicVariableType==="stopwatch"?Qt.clamp(T,w,E):Qt.clamp(T,E,w),T===w&&a.setDynamicVariableToggleIsForward(p,void 0),v.repeat?Math.abs(T-E)<(v.format==="number3decimal"?1e-4:.1)&&(T=w):(Math.abs(T-w)<(v.format==="number3decimal"?1e-4:.1)||Math.abs(T-E)<(v.format==="number3decimal"?1e-4:.1))&&a.setDynamicVariablePlayState(p,"Paused")),T!==b&&(l.push(p),this.dynamicVars[d].timerSeconds=T,a.updateVariable(p,Kc.getFormattedTimerTime(T,v)),this.eventManager.requestRender())}}}let u=!1;a.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=a.mouseProperty,u=!0);let h=!1;a.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=a.raycastProperty,h=!0),this.events.forEach(d=>{(l.includes(d.data.variableId)||c.find(p=>p.objId===d.data.objectId&&p.property===d.data.property)||d.data.variableId==="mouseProperty"&&u||d.data.variableId==="raycastProperty"&&h)&&(d.dispatch(),this.eventManager.requestRender())})},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()}}pause(){this.isOutOfFocus||(this.isOutOfFocus=!0,this.pauseTime=Date.now())}resume(){if(!this.isOutOfFocus)return;this.isOutOfFocus=!1;let t=Date.now()-this.pauseTime;for(let e=0;e<this.dynamicVars.length;e++)this.dynamicVars[e].last+=t,this.dynamicVars[e].expectedTime+=t}connect(){this.eventContext.page.traverseEntity(e=>{var i;(i=e.data)==null||i.events.filter(r=>r.data.type==="VariableChange"&&!r.data.disabled).forEach(r=>{this.events.push(new cPe(r.id,r.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.propertiesToWatch=this.events.filter(e=>e.data.variableId==="objectProperty"&&e.data.objectId!==null).map(e=>({objectId:e.data.objectId,property:e.data.property,prevValue:null}));let t=this.eventContext.sharedAssets;this.sharedVariables.forEach(({id:e,data:i})=>{if(!("dynamicVariableType"in i)){this.events.find(n=>n.data.variableId===e)&&this.variablesToWatch.push({id:e,prevValue:t.getVariable(e)});return}let r;if(i.dynamicVariableType==="timer"||i.dynamicVariableType==="stopwatch"){let n;if(to.isTextValue(i.value)&&Array.isArray(i.value.textValue)){let s=i.value.textValue;s.length===3?n=s[2]+s[1]*60+s[0]*3600:n=s[1]+s[0]*60}else n=i.value;r=n,this.dynamicVars.push({id:e,last:-1,expectedTime:-1,data:i,timerSeconds:n,startValue:r})}else i.dynamicVariableType==="time"&&t.updateVariable(e,_G(new Date,i)),i.dynamicVariableType==="counter"&&(r=to.isTextValue(i.value)?l8(i.value.textValue):i.value),this.dynamicVars.push({id:e,last:-1,expectedTime:-1,data:i,startValue:r})}),this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach(t=>t.dispose())}},cPe=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.actions=qs(e,e.actions,r,n,s,i)}dispatch(){let t=this.actions;t.Audio.forEach(e=>e.dispatchConditional()),t.Particles.forEach(e=>e.dispatchConditional()),t.Video.forEach(e=>e.dispatchConditional()),t.Create.forEach(e=>e.dispatch()),t.Destroy.forEach(e=>e.dispatch()),t.Reset.forEach(e=>e.dispatch()),t.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()}),t.Transition.forEach(e=>e.play()),t.Animation.forEach(e=>e.play()),t.SwitchCamera.forEach(e=>e.play()),t.SceneTransition.forEach(e=>e.dispatch()),t.SetVariable.forEach(e=>e.checkConditions()),t.SetVariable.forEach(e=>e.dispatch()),t.DynamicVariablePlay.forEach(e=>e.dispatch()),t.ClearLocalStorage.forEach(e=>e.dispatch()),t.UserAPI.forEach(e=>e.dispatch())}dispose(){Ia(this.actions)}};function l8(t){return t.length===3?t[2]+t[1]*60+t[0]*3600:t[1]+t[0]*60}var uPe="https://unpkg.com/@splinetool/runtime@1.9.82/build/",hPe="https://unpkg.com/@splinetool/navmesh-wasm@1.9.82/build/",dPe=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import('${uPe}' + 'navmesh.js'),
		fetch('${hPe}' + 'navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,fPe=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import(self.location.origin + '/_libraries/navmesh.js'),
		fetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,pPe=`

onmessage = function(messageEvent) {
	const meshData = messageEvent.data;
	const positions = meshData[0];
	const offset = meshData[1];
	const indices = meshData[2];
	const indicesLength = meshData[3];
	const parameters = meshData[4];

	const module = self.module;
	const rc = new module.rcConfig();
	rc.cs = parameters.cs;
	rc.ch = parameters.ch;
	rc.borderSize = parameters.borderSize ? parameters.borderSize : 0;
	rc.tileSize = parameters.tileSize ? parameters.tileSize : 0;
	rc.walkableSlopeAngle = parameters.walkableSlopeAngle;
	rc.walkableHeight = parameters.walkableHeight;
	rc.walkableClimb = parameters.walkableClimb;
	rc.walkableRadius = parameters.walkableRadius;
	rc.maxEdgeLen = parameters.maxEdgeLen;
	rc.maxSimplificationError = parameters.maxSimplificationError;
	rc.minRegionArea = parameters.minRegionArea;
	rc.mergeRegionArea = parameters.mergeRegionArea;
	rc.maxVertsPerPoly = parameters.maxVertsPerPoly;
	rc.detailSampleDist = parameters.detailSampleDist;
	rc.detailSampleMaxError = parameters.detailSampleMaxError;

	if (!self.navMesh) {
		self.navMesh = new module.NavMesh();
	}
	self.navMesh.build(positions, offset, indices, indicesLength, rc);

	const navmeshData = navMesh.getNavmeshData();
	const arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);
	const ret = new Uint8Array(navmeshData.size);
	ret.set(arrView);
	navMesh.freeNavmeshData(navmeshData);

	postMessage(ret);
}
`,mPe=.001,gPe={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1},$Z,fr,Xa;h1e.then(t=>{$Z=t,fr=new t.Vec3,Xa=new t.Vec3});var vPe=new W,yPe=class{constructor(t=!1,e=!1){this.usePhysics=t,this.isExport=e,this.onPointerDown=i=>{if(Ai.length!==1)return;let{raycaster:r,page:n}=this.eventContext;this.eventContext.updateRaycaster(i);let s=n.raycastWithClones(r);if(s.length!==0){if(this.gameControl){let a=vPe.copy(this.gameControl.colliderWorldPosition);a.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(a,s[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(i,r)=>n=>{var d,p,g,x,v,b,w;let s;if(n instanceof eu)if(n.objectForSample){if(n.objectForSample.dataPatched.physics.fusedBody)return;s=n.object}else return n.object.dataPatched.physics.fusedBody===!0&&n.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(n instanceof io)s=n.object;else if(s=n,((d=s.dataPatched.cloner)==null?void 0:d.disabled)===!1&&((p=s.dataPatched.cloner)==null?void 0:p.hideBase)&&((g=s.dataPatched.physics)==null?void 0:g.fusedBody)!==!0)return!0;if(r&&!s.userData.navmesh)return;let a=s.dataPatched;if(!a.visible&&((x=a.physics)==null?void 0:x.enabled)!==!0)return!0;n.updateMatrixWorldSVD();let o=AD(a),l=s.userData.hasDestroy,c=s.userData.hasDrag,u=!1,h=!1;for(let M of a.events)M.data.disabled!==!0&&(M.data.type==="GameControl"?u=!0:M.data.type==="Follow"&&(h=!0));if(u||o||h||l||c)return!0;if(this.usePhysics&&((v=a.physics)==null?void 0:v.rigidBody)==="dynamic"){if(this.usePhysics&&((b=a.physics)!=null&&b.fusedBody))return!0}else if("geometry"in n&&n.geometry&&i.push(op(n.geometry,n.matrixWorld)),this.usePhysics&&((w=a.physics)==null?void 0:w.fusedBody))return n.traverseObject((M,E)=>{var L,P;if(E===0)return;let D;if(M instanceof eu)if(M.objectForSample){if(M.objectForSample.dataPatched.physics.fusedBody)return;D=M.object}else return M.object.dataPatched.physics.fusedBody===!0&&M.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(M instanceof io)D=M.object;else if(D=M,(L=M.dataPatched.cloner)==null?void 0:L.hideBase)return!0;let T=D.dataPatched;if(!T.visible&&((P=T.physics)==null?void 0:P.enabled)!==!0)return!0;"geometry"in M&&M.geometry&&i.push(op(M.geometry,M.matrixWorld))}),!0},this.traverseNoPhysics=(i,r)=>n=>{let s;if(n instanceof eu)return;n instanceof io?s=n.object:s=n;let a=s.dataPatched;if(a.physics.enabled==="visibility"?!a.visible:!a.physics.enabled)return!0;if(r&&!s.userData.navmesh)return;let o=n.geometry,l=s.userData.hasDestroy===!0,c=s.userData.hasDrag===!0;if(AD(a)||l||c||s.dataPatched.events.some(u=>u.data.disabled!==!0&&u.data.type==="GameControl"))return!0;o&&i.push(op(o,n.matrixWorld))},this.navmeshWasm=$Z,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(e?dPe:fPe)+pPe])),this._worker=new Worker(this._workerURL)}init(t,e,i){this.gameControl=e,this.eventContext=i,this.setDefaultQueryExtent(new W().setScalar(t.ch*t.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.page,t,r=>{this.buildFromNavmeshData(r.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(t,e,i){e.objects.forEach(l=>{var u;let c=t.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=!0}),(u=c.cloner)==null||u.traverseObject(h=>{h.userData.navmesh=!0})});let r=[],n=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(r,e.zones==="custom");if(t.traverseChildren(n),e.objects.forEach(l=>{var u;let c=t.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=void 0}),(u=c.cloner)==null||u.traverseObject(h=>{h.userData.navmesh=void 0})}),r.length===0)return!1;let s=h0(r),{positions:a,triIndices:o}=Z3(s.getAttribute("position"),s.getIndex());return this._worker.postMessage([a,a.length/3,o,o.length,{...gPe,...e}]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let t,e,i=this.navMesh.getDebugNavMesh(),r=i.getTriangleCount(),n=new Uint32Array(r*3),s=new Float32Array(r*3*3);for(t=0;t<r*3;t++)n[t]=t;for(t=0;t<r;t++)for(e=0;e<3;e++){let o=i.getTriangle(t).getPoint(e);s[t*9+e*3+0]=o.x,s[t*9+e*3+1]=o.y,s[t*9+e*3+2]=o.z}let a=new ni;return a.setIndex(new _i(n,1)),a.setAttribute("position",new _i(s,3)),a}getClosestPoint(t){return fr.x=t.x,fr.y=t.y,fr.z=t.z,this.navMesh.getClosestPoint(fr)}getClosestPointToRef(t,e){fr.x=t.x,fr.y=t.y,fr.z=t.z;let i=this.navMesh.getClosestPoint(fr);e.set(i.x,i.y,i.z)}getRandomPointAround(t,e){return fr.x=t.x,fr.y=t.y,fr.z=t.z,this.navMesh.getRandomPointAround(fr,e)}getRandomPointAroundToRef(t,e,i){fr.x=t.x,fr.y=t.y,fr.z=t.z;let r=this.navMesh.getRandomPointAround(fr,e);i.set(r.x,r.y,r.z)}moveAlong(t,e){return fr.x=t.x,fr.y=t.y,fr.z=t.z,Xa.x=e.x,Xa.y=e.y,Xa.z=e.z,this.navMesh.moveAlong(fr,Xa)}moveAlongToRef(t,e,i){return fr.x=t.x,fr.y=t.y,fr.z=t.z,Xa.x=e.x,Xa.y=e.y,Xa.z=e.z,this.navMesh.moveAlong(fr,Xa)}computePath(t,e){let i=this.getClosestPoint(e);if(Xa.x=i.x,Xa.y=i.y,Xa.z=i.z,Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)+Math.pow(e.z-i.z,2))>this.getDefaultQueryExtent().y)return[];this.getClosestPoint(t);let r=this.navMesh.computePath(fr,Xa),n=r.getPointCount(),s=[];for(let a=0;a<n;a++){let o=r.getPoint(a);s.push(new W(o.x,o.y,o.z))}return s}createCrowd(t,e){return new xPe(this,t,e)}setDefaultQueryExtent(t){fr.x=t.x,fr.y=t.y,fr.z=t.z,this.navMesh.setDefaultQueryExtent(fr)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(t){let e=t.length*t.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(e),r=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,e);r.set(t);let n=new this.navmeshWasm.NavmeshData;n.dataPointer=r.byteOffset,n.size=t.length,this.navMesh.buildFromNavmeshData(n),this.navmeshWasm._free(r.byteOffset)}getNavmeshData(){let t=this.navMesh.getNavmeshData(),e=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,t.dataPointer,t.size),i=new Uint8Array(t.size);return i.set(e),this.navMesh.freeNavmeshData(t),i}getDefaultQueryExtentToRef(t){let e=this.navMesh.getDefaultQueryExtent();t.set(e.x,e.y,e.z)}dispose(){var t;this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),(t=this.eventContext)==null||t.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(t,e,i){return fr.x=t.x,fr.y=t.y,fr.z=t.z,this.navMesh.addCylinderObstacle(fr,e,i)}addBoxObstacle(t,e,i){return fr.x=t.x,fr.y=t.y,fr.z=t.z,Xa.x=e.x,Xa.y=e.y,Xa.z=e.z,this.navMesh.addBoxObstacle(fr,Xa,i)}removeObstacle(t){this.navMesh.removeObstacle(t)}isSupported(){return this.navmeshWasm!==void 0}},xPe=class{constructor(t,e,i){this.navmeshWasmWrapper=t,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(e,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(t,e){}addAgent(t,e,i){let r=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;r.radius=e.radius,r.height=e.height,r.maxAcceleration=e.maxAcceleration,r.maxSpeed=e.maxSpeed,r.collisionQueryRange=e.collisionQueryRange,r.pathOptimizationRange=e.pathOptimizationRange,r.separationWeight=e.separationWeight,r.updateFlags=7,r.obstacleAvoidanceType=0,r.queryFilterType=0,r.userData=0;let n=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z),r);return this.transforms.push(i),this.agents.push(n),this.reachRadii.push(e.reachRadius?e.reachRadius:e.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new W(0,0,0)),n}getAgentPosition(t){return this.crowd.getAgentPosition(t)}getAgentPositionToRef(t,e){let i=this.crowd.getAgentPosition(t);e.set(i.x,i.y,i.z)}getAgentVelocity(t){return this.crowd.getAgentVelocity(t)}getAgentVelocityToRef(t,e){let i=this.crowd.getAgentVelocity(t);e.set(i.x,i.y,i.z)}getAgentNextTargetPath(t){return this.crowd.getAgentNextTargetPath(t)}getAgentNextTargetPathToRef(t,e){let i=this.crowd.getAgentNextTargetPath(t);e.set(i.x,i.y,i.z)}getAgentState(t){return this.crowd.getAgentState(t)}overOffmeshConnection(t){return this.crowd.overOffmeshConnection(t)}agentGoto(t,e){this.crowd.agentGoto(t,new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z));let i=this.agents.indexOf(t);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(e.x,e.y,e.z))}agentTeleport(t,e){this.crowd.agentTeleport(t,new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z))}updateAgentParameters(t,e){let i=this.crowd.getAgentParameters(t);e.radius!==void 0&&(i.radius=e.radius),e.height!==void 0&&(i.height=e.height),e.maxAcceleration!==void 0&&(i.maxAcceleration=e.maxAcceleration),e.maxSpeed!==void 0&&(i.maxSpeed=e.maxSpeed),e.collisionQueryRange!==void 0&&(i.collisionQueryRange=e.collisionQueryRange),e.pathOptimizationRange!==void 0&&(i.pathOptimizationRange=e.pathOptimizationRange),e.separationWeight!==void 0&&(i.separationWeight=e.separationWeight),this.crowd.setAgentParameters(t,i)}removeAgent(t){this.crowd.removeAgent(t);let e=this.agents.indexOf(t);e>-1&&(this.agents.splice(e,1),this.transforms.splice(e,1),this.reachRadii.splice(e,1),this._agentDestinationArmed.splice(e,1),this._agentDestination.splice(e,1))}getAgents(){return this.agents}update(t){if(this.navmeshWasmWrapper.navMesh.update(),t<=mPe)return;let e=1/60,i=10;{let r=Math.floor(t/e);r>i&&(r=i),r<1&&(r=1);let n=t/r;for(let s=0;s<r;s++)this.crowd.update(n)}for(let r=0;r<this.agents.length;r++){let n=this.agents[r],s=this.getAgentPosition(n);if(this.transforms[r].copy(s),this._agentDestinationArmed[r]){let a=s.x-this._agentDestination[r].x,o=s.z-this._agentDestination[r].z,l=this.reachRadii[r],c=this._agentDestination[r].y-this.reachRadii[r],u=this._agentDestination[r].y+this.reachRadii[r],h=a*a+o*o;s.y>c&&s.y<u&&h<l*l&&(this.onReachTarget(n,this._agentDestination[r]),this._agentDestinationArmed[r]=!1)}}}setDefaultQueryExtent(t){let e=new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z);this.crowd.setDefaultQueryExtent(e)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(t){let e=this.crowd.getDefaultQueryExtent();t.set(e.x,e.y,e.z)}getCorners(t){let e,i=this.crowd.getCorners(t),r=i.getPointCount(),n=[];for(e=0;e<r;e++){let s=i.getPoint(e);n.push(new W(s.x,s.y,s.z))}return n}dispose(){this.crowd.destroy()}};function bPe(t){let e=!1;return t.scene.objects.forEach(i=>{i.data.type==="Page"&&!e&&i.data.publish.gameControlObject&&Bw.traverseModuleInstances(t,i.id,(r,n,s)=>{for(let a of s)a.data.type==="GameControl"&&a.data.navmesh.enabled&&(e=!0)})}),e}var _Pe={type:"change"},c8={type:"changeZoom"},SPe={type:"changePan"},Dv={type:"start"},Pv={type:"end",changed:!0},wPe={type:"end",changed:!1},kL=new Ci,u8=new Oe,MPe=2*Math.PI,EPe=1e-8,APe=.01,VL=new W,F2=new Oe,HL=new W,k2=new Ci,h8=new Ot,TPe={type:"requestRender"},eK=class extends lo{constructor(t,e,i={isPlayMode:!1,isExport:!1}){super(),this.object=t,this.domElement=e,this.options=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,kc.DOLLY_ROTATE,kc.PAN],this.offset=new W,this.eye=new W,this.lastPosition=new W,this.lastQuaternion=new Ci,this.current=new Oe,this.overShoot=new Oe,this.overRatio=new Oe,this.spherical=new NV,this.sphericalDelta=new NV,this.panOffset=new W,this.panLeftV=new W,this.panUpV=new W,this.panV=new W,this.rotateStart=new Oe,this.rotateEnd=new Oe,this.rotateDelta=new Oe,this.panStart=new Oe,this.panEnd=new Oe,this.panDelta=new Oe,this.dollyStart=new Oe,this.dollyEnd=new Oe,this.dollyDelta=new Oe,this.rotationRangeFactor=new Oe,this.panRangeFactor=new Oe,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=r=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=r.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(HL,k2,VL),this.offset.copy(HL).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&this.state===-1&&this.rotateLeft((this.autoRotateClockwise===!0?1:-1)*this.getAutoRotationAngle()),this.rotationLimitsMode!==0&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),this.rotationLimitsMode!==2&&(this.spherical.phi+=this.sphericalDelta.phi),(this.rotationLimitsMode!==1||this.autoRotate===!0)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&this.object.isPerspectiveCamera&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),this.panLimitsMode!==0&&(this.target.applyQuaternion(kL.copy(k2).invert()),this.panOffset.applyQuaternion(kL),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(k2),this.panOffset.applyQuaternion(k2)),this.panLimitsMode===2&&(this.panOffset.y=0),this.panLimitsMode===1&&(this.panOffset.x=0),this.state===-1&&!this.gesture?(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)):(this.target.add(this.panOffset),this.panOffset.set(0,0,0)),this.offset.setFromSpherical(this.spherical),HL.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(h8.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(h8));let r=this.spherical.phi%MPe;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(Kr.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),r>0&&r>Math.PI||r<0&&r>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),this.state===-1||this.enableDamping===!0){let n=this.hoverRotatePanMode===1?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-n,this.sphericalDelta.phi*=1-n}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>APe||8*(1-this.lastQuaternion.dot(this.object.quaternion))>EPe?(this.dispatchEvent(_Pe),this.object.dispatchEvent(TPe),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=r=>{this.enabled!==!1&&(r.pointerType==="touch"||r.pointerType==="pen"&&vc?this.onPointerDownTouch(r):this.onPointerDownMouse(r),this.state!==-1&&(this.isPointerDown=!0,this.dispatchEvent(Dv),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&vc||this.domElement.setPointerCapture(r.pointerId)))},this.onPointerLeave=r=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(this.hoverRotatePanMode===1?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,VL.subVectors(this.position0,this.target0),this.spherical.setFromVector3(VL),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):this.hoverRotatePanMode===2&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=r},this.onPointerEnter=r=>{this.resetHoverEffectOnPointerLeave||this.pointerLeaveEvent===void 0?F2.set(r.clientX-this.domElement.clientWidth/2,r.clientY-this.domElement.clientHeight/2):F2.set(r.clientX-this.pointerLeaveEvent.clientX,r.clientY-this.pointerLeaveEvent.clientY),this.hoverRotatePanMode===1?(this.rotateDelta.copy(F2).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(u8,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(r.clientX,r.clientY)):this.hoverRotatePanMode===2&&(this.panDelta.copy(F2).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(r.clientX,r.clientY)),this.update()},this.onPointerMove=r=>{this.enabled!==!1&&(this.checkRaycastLock()||(r.pointerType==="touch"||r.pointerType==="pen"&&vc?this.onPointerMoveTouch(r):this.onPointerMoveMouse(r),r.stopPropagation()))},this.onPointerUp=r=>{this.isPointerDown=!1,Ai.length===0&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),Ai.length>1&&r.preventDefault(),this.hasChange?this.dispatchEvent(Pv):this.dispatchEvent(wPe),this.state=-1,r&&(r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&vc||this.domElement.releasePointerCapture(r.pointerId))},this.onPointerDownMouse=r=>{let n;switch(this.useKeyEvents?n=this.mouseButtons[r.button]:n=this.mouseButtonsPlay[r.button],n){case 0:if(r.altKey===!0&&!r.shiftKey&&!KA(r)){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else if(this.key===" "){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;case 4:if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2;break;case 3:if(KA(r)||r.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}break;case 5:if(KA(r)||r.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else{if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=r=>{switch(this.state){case 0:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(r);break;case 1:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(r);break;case 2:if(this.enablePan===!1)return;this.handleMouseMovePan(r);break}this.object.wasMovedByUser=!0},this.onPointerDownTouch=r=>{switch(Ai.length>1&&r.preventDefault(),this.touches[Ai.length-1]){case kc.ROTATE:if(this.enableRotate===!1){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case kc.PAN:if(this.enablePan===!1){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case kc.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(),this.state=5;break;case kc.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=r=>{switch(Ai.length>1&&r.preventDefault(),this.state){case 3:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(r),this.update();break;case 4:if(this.enablePan===!1)return;this.handleTouchMovePan(r),this.update();break;case 5:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(r),this.update();break;case 6:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(r),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=Ow(()=>this.dispatchEvent(Pv),33),this.onMouseWheel=r=>{this.enabled===!1||this.enableZoom===!1&&this.enablePan===!1||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&r.preventDefault(),this.dispatchEvent(Dv),this.handleMouseWheel(r),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=r=>{if(r.preventDefault(),this.enabled!==!1&&!this.checkRaycastLock()&&!AM)if(r.type==="gesturechange"){if(this.enableZoom===!1||this.isTouchZoom===!1)return;this.dispatchEvent(Dv),r.scale>this.prevScale?this.dollyIn(this.getZoomScale()):r.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=r.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(Pv)},this.onContextMenu=r=>{r.preventDefault()},this.onTouchEnd=r=>{r.preventDefault()},this.onKeyDown=r=>{this.enabled!==!1&&(this.key=r.key,r.key===" "&&this.dispatchEvent(Dv))},this.onKeyUp=r=>{this.enabled!==!1&&(this.key=void 0,this.state!==-1&&r.key==="Alt"&&this.onPointerUp(Ai[0]),r.key===" "&&this.dispatchEvent(Pv))},this.onPointerHover=r=>{r.pointerType!=="mouse"||this.enabled===!1||this.state!==-1||this.hoverRotatePanMode===2&&this.isPanOverShoot||this.hoverRotatePanMode===1&&this.isRotateOverShoot||(this.isPointerDown=!0,this.hoverRotatePanMode===2?this.handleMouseMovePan(r,this.hoverRotatePanStrength):this.hoverRotatePanMode===1&&this.handleMouseMoveRotate(r,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=r=>{r.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.initialSphericalRadius=this.spherical.radius,this.addEventListenersToCamera()}dispatchEvent(t){t.type==="start"?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(t)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(t){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=t,this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(t,e){this.setEnableDampingSpeed(t.enableDamping),this.enablePan=t.enablePan,this.enableZoom=t.enableZoom,this.enableRotate=t.enableRotate,this.rotationLimitsMode=t.rotationLimitsMode,this.thetaIsFree=t.rotationHorizontalOffset.min===t.rotationHorizontalOffset.max&&t.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=t.rotationVerticalOffset.min===t.rotationVerticalOffset.max&&t.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=t.panLimitsMode,this.panSoftLimit=t.panSoftLimit,this.rotationSoftLimit=t.rotationSoftLimit,this.hoverRotatePanMode=t.hoverRotatePanMode,this.hoverRotateDamping=t.hoverRotateDamping??this.dampingFactor,this.useWindowEvents=e==="window",this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let i=t.hoverRotatePanStrength/100;this.hoverRotatePanStrength=i**2,this.zoomLimitsEnabled=t.zoomLimitsEnabled,this.minZoom=t.zoomLimits.min,this.maxZoom=Math.max(t.zoomLimits.min,t.zoomLimits.max),this.minDistance=1e3/this.maxZoom,this.maxDistance=Math.max(this.minDistance,1e3/t.zoomLimits.min),this.autoRotate=t.autoRotate,this.autoRotateSpeed=t.autoRotateSpeed,this.autoRotateClockwise=t.autoRotateClockwise;let r=this.object.getTarget().applyQuaternion(kL.copy(this.object.quaternion).invert());this.minV=-t.panVerticalOffset.min+r.y,this.maxV=t.panVerticalOffset.max+r.y,this.minH=-t.panHorizontalOffset.min+r.x,this.maxH=t.panHorizontalOffset.max+r.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=wd(this.spherical.phi-t.rotationVerticalOffset.min),this.maxPhi=wd(this.spherical.phi+t.rotationVerticalOffset.max),this.minTheta=wd(wd(this.spherical.theta)-t.rotationHorizontalOffset.min),this.maxTheta=wd(wd(this.spherical.theta)+t.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,t.orbitTouches===1&&(this.touches[0]=kc.ROTATE),t.panTouches===1&&(this.touches[0]=kc.PAN),t.orbitTouches===2&&(this.touches[1]=kc.DOLLY_ROTATE),t.panTouches===2&&(this.touches[1]=kc.DOLLY_PAN),t.orbitTouches===3&&(this.touches[2]=kc.ROTATE),t.panTouches===3&&(this.touches[2]=kc.PAN),this.isTouchZoom=t.isTouchZoom,this.resetHoverEffectOnPointerLeave=t.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(t,e,i,r,n,s,a,o){this.overShoot.set(0,0);let l,c,u;t instanceof W?(l=t.x,c=t.y,this.current.set(this.target.x,this.target.y),u=!0):(l=t.theta,c=t.phi,this.current.set(wd(this.spherical.theta),wd(this.spherical.phi)),u=!1),i===0&&(this.current.x+=l,this.current.y+=c),(e===3||e===2)&&(!u&&this.isThetaFlipped?this.current.x>r&&this.current.x<0?this.overShoot.x=r-this.current.x:this.current.x<n&&this.current.x>0&&(this.overShoot.x=n-this.current.x):this.current.x>r?this.overShoot.x=r-this.current.x:this.current.x<n&&(this.overShoot.x=n-this.current.x)),(e===3||e===1)&&(this.current.y>s?this.overShoot.y=s-this.current.y:this.current.y<a&&(this.overShoot.y=a-this.current.y)),u||(this.overShoot.x=wd(this.overShoot.x),this.overShoot.y=wd(this.overShoot.y)),i!==0?(this.overRatio.copy(this.overShoot).divide(o),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),i===1&&(this.overRatio.x=d8(Math.abs(this.overRatio.x)),this.overRatio.y=d8(Math.abs(this.overRatio.y))),this.isPointerDown||i===1?i===2&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),c*this.overShoot.y<0&&!this.phiIsFree&&(c*=1-this.overRatio.y)):i===2&&(!u&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||u&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=this.overShoot.x*.05),this.phiIsFree||(c=this.overShoot.y*.05),u?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):u?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,c+=this.overShoot.y),t instanceof W?(t.x=l,t.y=c):(this.thetaIsFree||(t.theta=l),this.phiIsFree||(t.phi=c))}setEnableDampingSpeed(t){this.enableDamping=t,this.rotateSpeed=t===!0?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(t){this.sphericalDelta.theta-=t}rotateUp(t){this.sphericalDelta.phi-=t}panLeft(t,e){this.panLeftV.setFromMatrixColumn(e,0),this.panLeftV.multiplyScalar(-t),this.panOffset.add(this.panLeftV)}panUp(t,e){this.panUpV.setFromMatrixColumn(e,1),this.panUpV.multiplyScalar(t),this.panOffset.add(this.panUpV)}pan(t,e){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){let r=this.object.position;this.panV.copy(r).sub(this.target);let n=this.panV.length();n*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*t*n/i.clientHeight,this.object.matrixWorld),this.panUp(2*e*n/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(t*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent(SPe)}dollyOut(t){this.object.isPerspectiveCamera?this.scale/=t:this.object.isOrthographicCamera&&(this.object.zoom*=t,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(c8)}dollyIn(t){this.object.isPerspectiveCamera?this.scale*=t:this.object.isOrthographicCamera&&(this.object.zoom/=t,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(c8)}zoomOut(t=this.getZoomScale()){this.dispatchEvent(Dv),this.dollyOut(t),this.dispatchEvent(Pv)}zoomIn(t=this.getZoomScale()){this.dispatchEvent(Dv),this.dollyIn(t),this.dispatchEvent(Pv)}setZoom(t){if(this.dispatchEvent(Dv),this.object.isPerspectiveCamera){let e=this.initialSphericalRadius/t/this.spherical.radius;this.scale=e}else this.object.isOrthographicCamera&&(this.object.zoom=t,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0);this.dispatchEvent(Pv)}handleMouseDownRotate(t){this.rotateStart.set(t.clientX,t.clientY)}handleMouseDownDolly(t){this.dollyStart.set(t.clientX,t.clientY)}handleMouseDownPan(t){this.panStart.set(t.clientX,t.clientY)}handleMouseMoveRotate(t,e=1){t.movementX!==void 0?this.rotateDelta.set(t.movementX,t.movementY):(this.rotateEnd.set(t.clientX,t.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*e).rotateAround(u8,-this.object.angleOffsetFromUp);let i=this.domElement,r=this.useWindowEvents?window.innerHeight:i.clientHeight,n=2*Math.PI*this.rotateDelta.x/r,s=2*Math.PI*this.rotateDelta.y/r;this.rotateLeft(n),this.rotateUp(s),this.update()}handleMouseMoveDolly(t){this.dollyEnd.set(t.clientX,t.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(t,e=1){t.movementX!==void 0?this.panDelta.set(t.movementX,t.movementY):(this.panEnd.set(t.clientX,t.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*e),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(t){if(s1e===!1&&KA(t)===!1&&o1e(t)===!0){if(this.enablePan===!1)return;this.gesture?(this.panDelta.set(-t.deltaX,-t.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),t.altKey?this.pan(0,this.panDelta.y):t.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1},30)}else{if(this.enableZoom===!1||this.gesture)return;t.deltaY===0?t.deltaX<0?this.dollyIn(this.getZoomScale()):t.deltaX>0&&this.dollyOut(this.getZoomScale()):t.deltaY<0?this.dollyIn(this.getZoomScale()):t.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(Ai.length===2){let t=.5*(Ai[0].pageX+Ai[1].pageX),e=.5*(Ai[0].pageY+Ai[1].pageY);this.rotateStart.set(t,e)}else this.rotateStart.set(Ai[0].pageX,Ai[0].pageY)}handleTouchStartPan(){if(Ai.length===2){let t=.5*(Ai[0].pageX+Ai[1].pageX),e=.5*(Ai[0].pageY+Ai[1].pageY);this.panStart.set(t,e)}else this.panStart.set(Ai[0].pageX,Ai[0].pageY)}handleTouchStartDolly(){let t=Ai[0].pageX-Ai[1].pageX,e=Ai[0].pageY-Ai[1].pageY,i=Math.sqrt(t*t+e*e);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(t){if(Ai.length===2){let i=PO(t),r=.5*(t.pageX+i.x),n=.5*(t.pageY+i.y);this.rotateEnd.set(r,n)}else{if(t.pointerId!==Ai[0].pointerId)return;this.rotateEnd.set(t.pageX,t.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let e=this.domElement;e&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/e.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/e.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(t){if(Ai.length===2){let e=PO(t),i=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);this.panEnd.set(i,r)}else{if(t.pointerId!==Ai[0].pointerId)return;this.panEnd.set(t.pageX,t.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(t){let e=PO(t),i=t.pageX-e.x,r=t.pageY-e.y,n=Math.sqrt(i*i+r*r);this.dollyEnd.set(0,n),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(t){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(t),this.enablePan&&this.handleTouchMovePan(t)}handleTouchMoveDollyRotate(t){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(t),this.enableRotate&&this.handleTouchMoveRotate(t)}checkRaycastLock(){var t;if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let e=(t=this.options)==null?void 0:t.showCameraLock;return e&&e(),!0}}else return!1}};function wd(t){let e=Math.PI*2;for(;t<=-Math.PI;)t+=e;for(;t>Math.PI;)t-=e;return t}function d8(t){return 1-Math.pow(1-t,4)}var f8=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.page=r,this.currentIntersectedObjects=[],this.actions=qs(e,e.actions,r,n,s,i),this.target=e.target,this.triggeringObjects=[];for(let a of e.triggeringObjects){let o=r.scene.find(a);o&&this.triggeringObjects.push(o)}}isValidTriggeringObject(t){return this.target==="all"?!0:this.triggeringObjects.some(e=>e===t||e.isAncestorOf(t.uuid)||t.isAncestorOf(e.uuid))}disconnect(){Ia(this.actions)}dispatch(){this.object.destroyedInAction||(this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.SwitchCamera.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch(!1)}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()))}},wr;f1e.then(t=>wr=t);var Ns=new W,eh=new Ci,Bm=new W,GL=new ia(0,0,0,"YXZ"),p8=new ia(0,0,0,"XYZ"),th=new W,jL=new W,WL=new W(1,1,1),Sx=new Ci,V2=new Ot,m8=new Ot,CPe={type:"updateMatrix"},g8=new Ci,qL=new Xl,MB={type:"beginEvent",eventName:"Collision"},DPe={type:"beginEvent",eventName:"Trigger"};function PPe(t){if(Bw.physicsEnabled(t.scene.objects))return!0;let e=!1;return t.scene.objects.traverse((i,r)=>{if(r.events){if(Array.isArray(r.events)){for(let n of r.events)if(n.data.disabled!==!0&&n.data.type==="GameControl"&&n.data.collisionEnabled){e=!0;break}}else for(let n of Object.values(r.events))if(n.disabled!==!0&&n.type==="GameControl"&&n.collisionEnabled){e=!0;break}}}),e}var AD=t=>t.states.some(e=>e.data.position!==void 0||e.data.rotation!==void 0||e.data.hiddenMatrix!==void 0||e.data.cloner!==void 0||e.data.pathSnapping!==void 0),RPe=class{constructor(t){this.eventContext=t,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=e=>{if(e.bodyType()!==wr.RigidBodyType.Dynamic)return;e.isSleeping()||this.nActiveRigidBodies++;let[i,r,n]=this.rigidBodyToMesh.get(e.handle);if(Ns.copy(e.translation()).multiplyScalar(this.pixelsPerMeter),eh.copy(e.rotation()),i.matrixWorld.compose(Ns,eh,r),i.hasNonUniformScale&&i.matrixWorld.multiply(i.shearScale),i.dispatchEvent(CPe),n){let s=i.cloner;if(s&&s.objectForSample===void 0){s.matrixWorld.copy(i.matrixWorld);for(let a of s.children)a.updateMatrixWorld(!0)}for(let a of i.children)a.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(e,i,r)=>{var a,o,l,c;if(r===!1)return;let n,s;if(this.sensorToTriggerEvent[e]?(n=this.sensorToTriggerEvent[e],s=this.sharedGameControlGlobals.colliderToEntity.get(i)):this.sensorToTriggerEvent[i]&&(n=this.sensorToTriggerEvent[i],s=this.sharedGameControlGlobals.colliderToEntity.get(e)),n&&s&&n.isValidTriggeringObject(s)){n.dispatch();return}for(let u=this.sharedGameControlGlobals.createdObjects.length-1;u>=0;u--){let h=this.sharedGameControlGlobals.createdObjects[u];if(h.userData.hasCollisionDestroy&&(((a=h.rigidBody)==null?void 0:a.collider(0).handle)===e||((o=h.rigidBody)==null?void 0:o.collider(0).handle)===i)){this.sharedGameControlGlobals.createdObjects.splice(u,1),h.removeFromParent(),requestAnimationFrame(()=>{var d;return(d=this.sharedGameControlGlobals.rapierWorld)==null?void 0:d.removeRigidBody(h.rigidBody)});break}}if(((l=this.gameControl)==null?void 0:l.object)!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(e)){let u=this.sharedGameControlGlobals.colliderToEntity.get(i),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h===void 0)return;for(let d of h)d.data.target==="character"&&this.dispatchCollisionEvent(d,u,i)}else if(((c=this.gameControl)==null?void 0:c.object)!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(i)){let u=this.sharedGameControlGlobals.colliderToEntity.get(e),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h===void 0)return;for(let d of h)d.data.target==="character"&&this.dispatchCollisionEvent(d,u,e)}else{let u=this.sharedGameControlGlobals.colliderToEntity.get(e),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h!==void 0)for(let g of h)g.data.target==="scene"&&this.dispatchCollisionEvent(g,u,e);let d=this.sharedGameControlGlobals.colliderToEntity.get(i),p=this.sharedGameControlGlobals.entityToCollisionEvents[d==null?void 0:d.uuid];if(p!==void 0)for(let g of p)g.data.target==="scene"&&this.dispatchCollisionEvent(g,d,i)}},this.isExport=t.isExport,this.sharedAssets=t.sharedAssets,this.renderer=t.renderer,this.requestRender=t.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=jZ,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(t){t.forEach(e=>{e.addEventListener("connected",i=>{"gamepad"in i.data&&"axes"in i.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(i.data.gamepad)})})}markIsDestroyTarget(){this.page.traverseVisibleEntity(t=>{var i,r;let e=t.dataPatched;for(let n of e.events){if(n.data.disabled===!0)continue;let s=(r=(i=n.data.actions)==null?void 0:i.find(a=>a.data.type==="Destroy"))==null?void 0:r.data;if(s)for(let a of s.objects){let o=this.page.scene.find(a);o&&(o.userData.hasDestroy=!0)}}})}markIsDragObject(){this.page.traverseVisibleEntity(t=>{let e=t.dataPatched;for(let i of e.events)if(!(i.data.disabled===!0||i.data.type!=="DragDrop"))for(let r of i.data.objects){let n=this.page.scene.find(r);n&&(n.userData.hasDrag=!0)}})}initBVH(){let t=[];if(this.page.traverseChildren(e=>{var c,u;let i,r=e instanceof ew,n=e instanceof tw;if(e instanceof eu||r||n)return;e instanceof io?i=e.object:i=e;let s=i.dataPatched;if(((c=s.physics)==null?void 0:c.enabled)==="visibility"?!s.visible:!((u=s.physics)!=null&&u.enabled))return!0;let a=e.geometry,o=i.userData.hasDestroy===!0,l=i.userData.hasDrag===!0;if(AD(s)||o||l||i.dataPatched.events.some(h=>h.data.disabled!==!0&&(h.data.type==="GameControl"||h.data.type==="Follow")))return e.updateMatrixWorldSVD(),this.addBoundsTree(e),!0;a&&t.push(op(a,e.matrixWorld))}),t.length>0){let e=h0(t,!1);this.sharedGameControlGlobals.staticMeshBVH=new JS(e)}}addRigidBody(t,e,i){if(qZ(t.matrixWorld))return;let r=[],n="geometry"in t?t.geometry:void 0,s=e.dataPatched;if((n==null?void 0:n.getAttribute("position"))!==void 0&&r.push(op(n,t.shearScale)),s.physics.fusedBody){let a=this.gatherChildrenGeom(t,r);t.traverseObject(a),t.children.forEach(l=>l.updateMatrixWorld(!0));let o=t.cloner;o&&o.objectForSample===void 0&&s.physics.rigidBody==="dynamic"&&(o.traverseObject(a),o.children.forEach(l=>l.updateMatrixWorld(!0)))}if(r.length>0){let a,o=!i.fromCreate&&s.physics.rigidBody==="dynamic"||i.fromCreate&&i.dynamic;o?(a=wr.RigidBodyDesc.dynamic(),a.setLinearDamping(s.physics.damping).setAngularDamping(s.physics.damping).setAdditionalMass(1e-9).setGravityScale(s.physics.gravityScale).enabledRotations(...s.physics.enabledRotation).enabledTranslations(...s.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(a=wr.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(t)):a=wr.RigidBodyDesc.fixed();let l=h0(r);(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(Ns,eh,Bm),t.position0=Ns.clone().divideScalar(this.pixelsPerMeter),t.rotation0=eh.clone(),Ns.divideScalar(this.pixelsPerMeter),a.setTranslation(Ns.x,Ns.y,Ns.z).setRotation(eh),n?l==null||l.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):l==null||l.scale(Bm.x/this.pixelsPerMeter,Bm.y/this.pixelsPerMeter,Bm.z/this.pixelsPerMeter);let c=this.sharedGameControlGlobals.rapierWorld.createRigidBody(a);o&&this.rigidBodyToMesh.set(c.handle,[t,Bm.clone(),s.physics.fusedBody]);let u=!(s.geometry===void 0||s.geometry.type==="SubdivGeometry"||s.geometry.type==="NonParametricGeometry"||s.geometry.type==="BooleanGeometry"||s.geometry.type==="VectorGeometry"||s.geometry.type==="StarGeometry"||s.geometry.type==="RectangleGeometry"||s.geometry.type==="EllipseGeometry"||s.geometry.type==="TriangleGeometry"||s.geometry.type==="TorusGeometry"||s.geometry.type==="HelixGeometry");try{this.addCollider(c,s.physics,l,e,u)}catch{try{this.addCollider(c,s.physics,l,e,!1)}catch(h){console.error(h)}}t.rigidBody=c}}addBoundsTree(t){var i,r;let e=[];if(((i=t.geometry)==null?void 0:i.getAttribute("position"))!==void 0&&((r=t.geometry)==null?void 0:r.getAttribute("position").count)>0&&e.push(op(t.geometry,t.shearScale)),t.traverseObject(this.gatherChildrenGeom(t,e)),t.children.forEach(n=>n.updateMatrixWorld(!0)),e.length>0){let n=h0(e,!1);t.bvhGeometry=n,n.getAttribute("position").count>0&&(t.bvhGeometry.boundsTree=new JS(n),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(t))}}addCollider(t,e,i,r,n=!0){var o,l;if((i==null?void 0:i.getAttribute("position").count)===0||((o=i==null?void 0:i.getIndex())==null?void 0:o.count)===0)return;let s;i&&(e.colliderType==="trimesh"?s=wr.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):s=wr.ColliderDesc.convexMesh(i.getAttribute("position").array,n?i.getIndex().array:void 0)),s.setFrictionCombineRule(wr.CoefficientCombineRule.Average).setRestitutionCombineRule(wr.CoefficientCombineRule.Average).setDensity(e.density).setFriction(e.friction).setRestitution(e.restitution);let a=this.sharedGameControlGlobals.rapierWorld.createCollider(s,t);this.sharedGameControlGlobals.colliderToEntity.set(a.handle,r),(l=this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid])!=null&&l.some(c=>c.target==="scene")&&a.setActiveEvents(wr.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(t,e){return(i,r)=>{var o;if(r===0)return;let n;if(i instanceof eu)if(i.objectForSample){if(i.objectForSample.dataPatched.physics.fusedBody)return;n=i.object}else return i.object.dataPatched.physics.fusedBody===!0&&i.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(i instanceof io)n=i.object;else if(n=i,(o=n.dataPatched.cloner)==null?void 0:o.hideBase)return!0;let s=n.dataPatched;if(s.physics.enabled==="visibility"?!s.visible:!s.physics.enabled)return!0;r===1?t.hasNonUniformScale?i.matrixWorld.multiplyMatrices(t.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let a=i.geometry;(a==null?void 0:a.getAttribute("position"))!==void 0&&e.push(op(a,i.matrixWorld))}}activate(t){var d,p;if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=t,this.usePhysics=this.page.data.globalPhysics.usePhysics;let e=this.page.playCamera,i=!1,r=5,n=8,s=9,a="drag",o=this.page.data.publish.gameControlObject,l=o!==null?this.page.find(o):null,c=null;if(l)for(let g of l.data.events){if(g.data.disabled||g.data.type!=="GameControl")continue;let x=l;for(;this.usePhysics&&((d=x=x.parent)==null?void 0:d.parent)!==null;)(p=x.data.physics)==null||p.fusedBody;g.data.collisionEnabled&&(this.needsCollisionDetection=!0),c===null&&(c=g.data)}if(this.page.traverseEntity(g=>{for(let x of g.dataPatched.events)if(x.data.disabled===!1&&x.data.type==="Trigger")return this.needsCollisionDetection=!0,!0}),l&&c&&(l.data.visible===!0||l.data.physics.enabled===!0)){i=i||c.camera===e.uuid||l.uuid===e.uuid;let g=new WZ(l,this.renderer.domElement,c,this.eventContext.page.data.globalPhysics,this,l.uuid!==e.uuid&&c.camera===e.uuid,e,this.page,this.sharedAssets);this.gameControl=g,r=c.joystickPosLoc,n=c.joystickRotLoc,s=c.jumpTouchButtonLoc,a=c.rotByTouch,vc&&c.touchControl&&(this.joystickToGameControls[r]="pos",c.moveMode==="walk"&&(this.joystickToGameControls[s]="jmp"),a==="joystick"&&(this.joystickToGameControls[n]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let g=this.gameControl.data;if(!this.navigationMeshWrapper){this.navigationMeshWrapper=new yPe(this.usePhysics,this.isExport);let x;g.collider.type==="sphere"?x=g.collider.radius*2:x=g.collider.height,x=Math.floor(x/g.navmesh.ch-1),this.navigationMeshWrapper.init({...g.navmesh,walkableHeight:x},this.gameControl,this.eventContext)}}if(i===!1){let{enableRotate:g,enablePan:x,enableZoom:v,autoRotate:b,hoverRotatePanMode:w}=this.eventManager.publish.orbitControls;(g||x||v||b||w!==0)&&(this.orbitControls=new eK(e,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let u=this.renderer.domElement.width/this.renderer.getPixelRatio(),h=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((g,x)=>{let v=document.body.appendChild(document.createElement("div")),[b,w,M]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[x],E=(u-5*b)/4+b,D={},T=g==="jmp",L=T?0:b;x<10?(x<5?D.top=L/2:D.bottom=L/2,D.left=L/2+x%5*E):x===10?(D.left=L/2,D.top=h/2):(D.right=L/2,D.top=h/2),D.top?D.top-=w[1]:D.bottom+=w[1],D.left?D.left+=w[0]:D.right-=w[0];for(let O in D)D[O]+="px";if(T){let O=v.appendChild(document.createElement("div"));Object.assign(O.style,D,{position:"absolute",width:b+"px",height:b+"px",backgroundColor:`rgba(255,255,255,${M==="show"?.4:0})`,zIndex:"9999",borderRadius:b+"px",border:M==="show"?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let U=b/16*16*.4;M==="show"&&(O.innerHTML=`
						<svg width="${U}" height="${b*.4}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					`),O.addEventListener("pointerdown",()=>{this.gameControl.movementState.jump=1,this.requestRender()}),O.addEventListener("touchend",F=>F.preventDefault()),this.joysticks[x]=[void 0,v];return}let P={zone:v,mode:"static",position:D,size:b};M==="hide"&&(P.restOpacity=0);let R=VCe.create(P);R.on("move",(O,U)=>{let F=this.gameControl;g==="pos"?U.force<.2?F.moveForce=0:(F.movementState.movePosZ=Math.sin(-U.angle.radian),F.movementState.movePosX=Math.cos(-U.angle.radian),U.force>1.2?F.movementState.run=1:F.movementState.run=0,U.force<.3?F.moveForce=(U.force-.2)/.1:F.moveForce=1):g==="rot"&&(U.force<.2?F.rotForce=0:(F.movementState.rotPosX=U.vector.y,F.movementState.rotPosY=-U.vector.x,U.force<.3?F.rotForce=(U.force-.2)/.1:F.rotForce=1)),this.requestRender()}),R.on("end",(O,U)=>{let F=this.gameControl;g==="pos"?(F.movementState.movePosZ=0,F.movementState.movePosX=0,F.moveForce=1):g==="rot"&&(F.movementState.rotPosX=0,F.movementState.rotPosY=0,F.rotForce=1)}),this.joysticks[x]=[R,v]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout(()=>{this.collisionEvents.forEach(g=>g.initialDisabled=!1)},80)}initPhysics(){var a;(a=this.sharedGameControlGlobals.rapierWorld)==null||a.free(),this.sharedGameControlGlobals.rapierWorld=new wr.World(new wr.Vector3(0,this.gravity,0)),this.events=new wr.EventQueue(!0);let t=[],e=[];if(this.page.traverseChildren(o=>{var b,w,M,E;let l;if(o instanceof eu)if(o.objectForSample){if(o.objectForSample.dataPatched.physics.fusedBody)return;l=o.object}else return o.object.dataPatched.physics.fusedBody===!0&&o.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(o instanceof io)l=o.object;else{if(o instanceof tw||o instanceof ew)return;if(l=o,((b=l.dataPatched.cloner)==null?void 0:b.disabled)===!1&&((w=l.dataPatched.cloner)==null?void 0:w.hideBase)&&((M=l.dataPatched.physics)==null?void 0:M.fusedBody)!==!0)return!0}let c=l.dataPatched,u;for(let D of c.events)D.data.disabled!==!0&&D.data.type==="GameControl"&&(u=D.data);if(!c.physics||(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled))return!0;o.updateMatrixWorldSVD();let h=AD(c),d=!1,p=l.userData.hasDestroy,g=l.userData.hasDrag,x=!1;for(let D of c.events)if(D.data.disabled!==!0){if(D.data.type==="Collision"){d=!0;let T=new oPe(D.id,D.data,l,this.page,this.sharedAssets,this.eventManager);T.initialDisabled=!0,this.collisionEvents.push(T),this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].every(L=>L.id!==D.id)?this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].push(T):this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]=[T]}else if(D.data.type==="Follow"){x=!0;let T=D.data.target;o.traverseVisible(L=>{L.userData.isFollowingObj=T})}}c.physics.rigidBody==="dynamic"&&c.physics.fusedBody===!1&&(o.matrixWorldFusedFalse=o.matrixWorld.clone());let v=o.geometry;if(u!==void 0){let D=wr.RigidBodyDesc.kinematicPositionBased();(o.hasNonUniformScale?o.matrixWorldRigid:o.matrixWorld).decompose(Ns,eh,Bm),o.position0=Ns.clone().divideScalar(this.pixelsPerMeter),o.rotation0=eh.clone(),Ns.divideScalar(this.pixelsPerMeter),D.setTranslation(Ns.x,Ns.y,Ns.z).setRotation(eh);let T=this.sharedGameControlGlobals.rapierWorld.createRigidBody(D);o.rigidBody=T;let L;u.collider.type==="sphere"?L=wr.ColliderDesc.ball(u.collider.radius/this.pixelsPerMeter):u.collider.type==="capsule"?L=wr.ColliderDesc.capsule((u.collider.height/2-u.collider.radius)/this.pixelsPerMeter,u.collider.radius/this.pixelsPerMeter):L=wr.ColliderDesc.cuboid(u.collider.width/this.pixelsPerMeter/2,u.collider.height/this.pixelsPerMeter/2,u.collider.depth/this.pixelsPerMeter/2),L.setFrictionCombineRule(wr.CoefficientCombineRule.Average).setRestitutionCombineRule(wr.CoefficientCombineRule.Average).setDensity(c.physics.density).setFriction(c.physics.friction).setRestitution(c.physics.restitution);let P=this.sharedGameControlGlobals.rapierWorld.createCollider(L,T);this.sharedGameControlGlobals.colliderToEntity.set(P.handle,l),Ns.fromArray(u.collider.position).multiply(Bm.setFromMatrixScale(l.matrixWorld)).divideScalar(this.pixelsPerMeter),P.setTranslationWrtParent(Ns);let R=new Ci().setFromEuler(new ia().setFromVector3(new W().fromArray(u.collider.rotation)));P.setRotationWrtParent(R),P.setActiveEvents(wr.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(l,!0)}else c.physics.rigidBody==="dynamic"||h||x||p||g||d?(this.addRigidBody(o,l,{hasFollow:x,hasTransformAnim:h,hasDrag:g}),this.generateSensorColliderDescs(l,c.physics.fusedBody)):(v&&t.push(op(v,o.matrixWorld)),c.physics.fusedBody&&o.traverseObject((D,T)=>{var O;if(T===0)return;let L;if(D instanceof eu)if(D.objectForSample){if(D.objectForSample.dataPatched.physics.fusedBody)return;L=D.object}else return D.object.dataPatched.physics.fusedBody===!0&&D.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else{if(D instanceof tw||D instanceof ew)return;if(D instanceof io)L=D.object;else if(L=D,(O=L.dataPatched.cloner)==null?void 0:O.hideBase)return!0}let P=L.dataPatched;if(P.physics.enabled==="visibility"?!P.visible:!P.physics.enabled)return!0;let R=D.geometry;(R==null?void 0:R.getAttribute("position"))!==void 0&&t.push(op(R,D.matrixWorld))}),this.generateSensorColliderDescs(l,c.physics.fusedBody,e));if(((E=c.physics)==null?void 0:E.fusedBody)===!0||u)return!0}),t.length===0)return;let i=h0(t);i.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let r=wr.RigidBodyDesc.fixed(),n=this.sharedGameControlGlobals.rapierWorld.createRigidBody(r),s=wr.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array).setFrictionCombineRule(wr.CoefficientCombineRule.Multiply).setRestitutionCombineRule(wr.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(s,n);for(let[o,l]of e){let c=this.sharedGameControlGlobals.rapierWorld.createCollider(o,n);this.sensorToTriggerEvent[c.handle]=l}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity(t=>{for(let e of t.dataPatched.events)if(e.data.type==="Trigger"&&e.data.disabled!==!0){let i=new f8(e.id,e.data,t,this.page,this.sharedAssets,this.eventManager),r=new Ot().compose(th.fromArray(e.data.position),Sx.setFromEuler(p8.fromArray(e.data.rotation)),WL);if(e.data.triggerZone==="box"){let n=new Os;n.min.fromArray(e.data.size).multiplyScalar(-.5),n.max.fromArray(e.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([n,r,t,i])}else this.sharedGameControlGlobals.triggers.push([e.data.radius,r,t,i])}}),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach(t=>t.disconnect()),this.sharedGameControlGlobals.triggers.forEach(t=>t[3].disconnect()),this.sharedGameControlGlobals.triggers.length=0}deactivate(){var t,e,i,r;if(this.isEnabled){this.isEnabled=!1,this.page.traverse(n=>{let s=n;s.matrixWorldFusedFalse&&(s.matrixWorldFusedFalse=void 0),s.rigidBody&&(s.rigidBody=void 0),s.position0&&(s.position0=void 0),s.rotation0&&(s.rotation0=void 0)}),(t=this.sharedGameControlGlobals.rapierWorld)==null||t.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),(e=this.gameControl)==null||e.reset(),(i=this.gameControl)==null||i.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach(([n,s])=>{n==null||n.destroy(),s.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),(r=this.navigationMeshWrapper)==null||r.dispose(),this.navigationMeshWrapper=void 0;for(let n of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))n.forEach(s=>s.disconnect());this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(t,e,i){if(!this.isEnabled)return!0;let r=!0;if(this.orbitControls!==void 0&&this.orbitControls.needsUpdate&&(r=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,r=!1):this.initializationCounter===2&&this.gameControl&&(r=!this.gameControl.update(t,e,i)&&r),this.usePhysics===!1&&this.checkTrigger(),this.usePhysics){let n=.016666666666666666;if(t===0)r=this.stepPhysics()&&r;else{let s=t/1e3;s<n&&s>n*.55&&(s=n),this.accumulator+=s;let a=performance.now(),o=0,l=6;for(;this.accumulator>=n&&o<l&&(r=this.stepPhysics()&&r,this.accumulator-=n,o++,!(performance.now()-a>n*1e3)););this.accumulator=this.accumulator%n}}return r}stepPhysics(){var t;for(let e of this.sharedGameControlGlobals.entitiesWithTransformAnim){(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(Ns,eh,Bm),GL.setFromQuaternion(eh);let i=e;i.prevR===void 0?(i.prevR=GL.clone(),i.prevT=Ns.clone()):(i.prevR.copy(GL),i.prevT.copy(Ns)),e.rigidBody&&(e.rigidBody.setNextKinematicTranslation(Ns.divideScalar(this.pixelsPerMeter)),e.rigidBody.setNextKinematicRotation(eh))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),(t=this.events)==null||t.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(t,e,i){var s;let r=((s=this.sharedGameControlGlobals.rapierWorld)==null?void 0:s.getCollider(i))._parent,n;if(e.cloner){for(let a of e.cloner.children)if(a.rigidBody===r){n=a;break}}t.dispatch(n),e.dispatchEvent(MB)}updateUseWindowEvents(t){var e;(e=this.orbitControls)==null||e.updateUseWindowEvents(t)}generateSensorColliderDescs(t,e,i){let r=m8.copy(t.matrixWorld).invert();t.traverseEntity((n,s)=>{if(e===!1&&s===1)return!0;for(let a of n.dataPatched.events)if(a.data.type==="Trigger"&&a.data.disabled!==!0){let o=new f8(a.id,a.data,n,this.page,this.sharedAssets,this.eventManager),l;if(a.data.triggerZone==="box"?l=wr.ColliderDesc.cuboid(...a.data.size.map(c=>c/(2*this.pixelsPerMeter))):l=wr.ColliderDesc.ball(a.data.radius/this.pixelsPerMeter),l.setDensity(0).setSensor(!0).setActiveEvents(wr.ActiveEvents.COLLISION_EVENTS),th.fromArray(a.data.position),Sx.setFromEuler(p8.fromArray(a.data.rotation)),V2.compose(th,Sx,WL).premultiply(n.matrixWorld),i?(V2.decompose(th,Sx,jL),l.setActiveCollisionTypes(wr.ActiveCollisionTypes.KINEMATIC_FIXED|wr.ActiveCollisionTypes.DYNAMIC_FIXED)):(V2.premultiply(r).decompose(th,Sx,jL),t.rigidBody.bodyType()===wr.RigidBodyType.Dynamic||(t.rigidBody.bodyType()===wr.RigidBodyType.Fixed?l.setActiveCollisionTypes(wr.ActiveCollisionTypes.KINEMATIC_FIXED|wr.ActiveCollisionTypes.DYNAMIC_FIXED):l.setActiveCollisionTypes(wr.ActiveCollisionTypes.KINEMATIC_KINEMATIC|wr.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),th.divideScalar(this.pixelsPerMeter),l.setTranslation(th.x,th.y,th.z),l.setRotation(Sx),i)i.push([l,o]);else{let c=this.sharedGameControlGlobals.rapierWorld.createCollider(l,t.rigidBody);this.sensorToTriggerEvent[c.handle]=o}}})}checkTrigger(){let t;for(let e=0;e<this.sharedGameControlGlobals.triggers.length;e++){let[i,r,n,s]=this.sharedGameControlGlobals.triggers[e];for(let a=0;a<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;a++){let o=this.sharedGameControlGlobals.entitiesWithTransformAnim[a];if(n===o||s.isValidTriggeringObject(gr.is(o)?o:o.object)===!1)continue;let l=m8.copy(n.matrixWorld).decompose(th,g8,jL).compose(th,g8,WL).multiply(r),c=V2.copy(o.matrixWorld).invert().multiply(l);i instanceof Os?t=o.bvhGeometry.boundsTree.intersectsBox(i,c):(qL.radius=i,qL.center.setFromMatrixPosition(c),t=o.bvhGeometry.boundsTree.intersectsSphere(qL)),t?s.currentIntersectedObjects.indexOf(o)===-1&&(s.currentIntersectedObjects.push(o),s.dispatch(),n.dispatchEvent(DPe)):s.currentIntersectedObjects=s.currentIntersectedObjects.filter(u=>u!==o)}}}};function OPe(t){let e=this._clip.duration,i=this._clip.start??0,r=this.loop,n=this.time+t,s=this._loopCount,a=r===mN;if(t===0)return s===-1?n:a&&(s&1)===1?e-(n-i):n;if(r===rq){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=e)n=e;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(s===-1&&(t>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=e||n<i){let o=Math.floor((n-i)/(e-i));n-=(e-i)*o,s+=Math.abs(o);let l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a||(n=t>0?e:i,this.repetitions===1&&(n=e)),this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(l===1){let c=t<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return e-(n-i)}return n}var v8=!1,LPe=class{constructor(t,e,i,r){this.scene=t,this.requestRender=e,this.updateDisplayProgress=i,this.animationInspectorState=r,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=n=>{n.data.type==="Empty"&&n.data.animations&&n.data.animations.forEach((s,a)=>{let o=s[0]+"/";if(Array.isArray(n.identity)?o+=n.identity[0]:o+=n.uuid,this.clipIdToAction[o])return;let l=Uz.parse(JSON.parse(s[2]));n.animations[a]=l;let c=this.mixer.clipAction(l,n);v8===!1&&(Object.getPrototypeOf(c)._updateTime=OPe,v8=!0),c.clampWhenFinished=!0,this.clipIdToAction[o]=c})},this.mixer=new Ade(t),this.scene.traverseEntity(this.addClip)}deleteClip(t,e){let i=this.scene.find(e);if(!i)return;let r=i.animations.find(s=>s.uuid===t);if(!r)return;let n=this.clipIdToAction[t];!n||(n.stop(),this.mixer.uncacheClip(r),delete this.clipIdToAction[t],i.animations=i.animations.filter(s=>s.uuid!==t))}get isPlaying(){return Object.values(this.clipIdToAction).some(t=>t.isRunning())}playFromInspector(t){this.mixer.stopAllAction();let e=this.clipIdToAction[t];!e||(e.play(),this.activeClip=e.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach(t=>{t.repetitions=1/0,t.loop=nq}),this.mixer.stopAllAction(),this.requestRender()}play(t){let e=t.clipId+"/"+t.object,i=this.clipIdToAction[e];if(i)return t&&(t.repeat>=0&&(i.repetitions=t.repeat+1),t.direction==="pingpong"&&t.repeat!==0&&(i.loop=mN)),i.play(),i.paused=!1,this.requestRender(),i}resumeFromInspector(t){let e=this.clipIdToAction[t];!e||(e.play(),e.paused=!1,this.requestRender())}pauseFromInspector(t){let e=this.clipIdToAction[t];!e||(e.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(t){var e;if(this.needsUpdate)this.needsUpdate=!1;else if(this.isPlaying===!1||(e=this.animationInspectorState)!=null&&e.isScrubbing)return;this.mixer.update(t/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*(this.maxFrames-1)%(this.maxFrames-1))),this.requestRender()}get maxFrames(){return UZ(this.activeClip??void 0)}setProgressFromInspector(t,e){if(!this.clipIdToAction[e])return;this.activeClip!==this.clipIdToAction[e].getClip()&&this.playFromInspector(e);let i=this.clipIdToAction[e].paused;this.clipIdToAction[e].paused=!1,this.mixer.setTime(Math.min(t/(this.maxFrames-1),.9999)*this.activeClip.duration),this.requestRender(),i&&(this.clipIdToAction[e].paused=!0)}},XL=new WeakMap,IPe=class extends SM{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,e,i,r){let n=new Bz(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(t,s=>{this.decodeDracoFile(s,e).catch(r)},i,r)}decodeDracoFile(t,e,i,r){let n={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};return this.decodeGeometry(t,n).then(e)}decodeGeometry(t,e){let i=JSON.stringify(e);if(XL.has(t)){let o=XL.get(t);if(o.key===i)return o.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r,n=this.workerNextTaskID++,s=t.byteLength,a=this._getWorker(n,s).then(o=>(r=o,new Promise((l,c)=>{r._callbacks[n]={resolve:l,reject:c},r.postMessage({type:"decode",id:n,taskConfig:e,buffer:t},[t])}))).then(o=>this._createGeometry(o.geometry));return a.catch(()=>!0).then(()=>{r&&n&&this._releaseTask(r,n)}),XL.set(t,{key:i,promise:a}),a}_createGeometry(t){let e=new ni;t.index&&e.setIndex(new _i(t.index.array,1));for(let i=0;i<t.attributes.length;i++){let r=t.attributes[i],n=r.name,s=r.array,a=r.itemSize;e.setAttribute(n,new _i(s,a))}return e}_loadLibrary(t,e){let i=new Bz(this.manager);return i.setPath(this.decoderPath),i.setResponseType(e),i.setWithCredentials(this.withCredentials),new Promise((r,n)=>{i.load(t,r,void 0,n)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(i=>{let r=i[0];t||(this.decoderConfig.wasmBinary=i[1]);let n=zPe.toString(),s=["/* draco decoder */",r,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(t,e){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(n){let s=n.data;switch(s.type){case"decode":r._callbacks[s.id].resolve(s);break;case"error":r._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,n){return r._taskLoad>n._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[t]=e,i._taskLoad+=e,i})}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};function zPe(){let t,e;onmessage=function(a){let o=a.data;switch(o.type){case"init":t=o.decoderConfig,e=new Promise(function(u){t.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(t)});break;case"decode":let l=o.buffer,c=o.taskConfig;e.then(u=>{let h=u.draco,d=new h.Decoder,p=new h.DecoderBuffer;p.Init(new Int8Array(l),l.byteLength);try{let g=i(h,d,p,c),x=g.attributes.map(v=>v.array.buffer);g.index&&x.push(g.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:g},x)}catch(g){console.error(g),self.postMessage({type:"error",id:o.id,error:g.message})}finally{h.destroy(p),h.destroy(d)}});break}};function i(a,o,l,c){let u=c.attributeIDs,h=c.attributeTypes,d,p,g=o.GetEncodedGeometryType(l);if(g===a.TRIANGULAR_MESH)d=new a.Mesh,p=o.DecodeBufferToMesh(l,d);else if(g===a.POINT_CLOUD)d=new a.PointCloud,p=o.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());let x={index:null,attributes:[]};for(let v in u){let b=self[h[v]],w,M;if(c.useUniqueIDs)M=u[v],w=o.GetAttributeByUniqueId(d,M);else{if(M=o.GetAttributeId(d,a[u[v]]),M===-1)continue;w=o.GetAttribute(d,M)}x.attributes.push(n(a,o,d,v,b,w))}return g===a.TRIANGULAR_MESH&&(x.index=r(a,o,d)),a.destroy(d),x}function r(a,o,l){let c=l.num_faces()*3,u=c*4,h=a._malloc(u);o.GetTrianglesUInt32Array(l,u,h);let d=new Uint32Array(a.HEAPF32.buffer,h,c).slice();return a._free(h),{array:d,itemSize:1}}function n(a,o,l,c,u,h){let d=h.num_components(),p=l.num_points()*d,g=p*u.BYTES_PER_ELEMENT,x=s(a,u),v=a._malloc(g);o.GetAttributeDataArrayForAllPoints(l,h,x,g,v);let b=new u(a.HEAPF32.buffer,v,p).slice();return a._free(v),{name:c,array:b,itemSize:d}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}var dg;function UPe(){return dg||(dg=new IPe,dg.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),dg.decoderPending}async function BPe(t){if(dg){let e={attributeIDs:dg.defaultAttributeIDs,attributeTypes:dg.defaultAttributeTypes,useUniqueIDs:!1},i;try{i=await dg.decodeGeometry(new Int8Array(t).buffer,e)}catch(r){console.error(r)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([r,n])=>({name:r,itemSize:n.itemSize,array:n.array}))}}return null}async function NPe(t,e){let[i,r]=VX(Jz.deserialize(new Uint8Array(t)));return dY(i),r.result().data}function FPe(t){let e=[];return t.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="NonParametricGeometry"&&r.geometry.data.draco!==void 0&&e.push(r)}),e}async function kPe(t){for(let e of t){let i=await BPe(e.geometry.data.draco);if(i){let r=e.geometry.data;i.index&&(r.index={array:i.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let n={};i.attributes.forEach(({name:s,array:a,itemSize:o})=>{n[s]={array:a,itemSize:o,type:"Float32Array",normalized:!1}}),r.attributes=n,r.draco=void 0}}}var VPe=class{constructor(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0],this._delay=500,this._distance=2,this._onMouseDown=t=>{let e=[t.clientX,t.clientY],i=new Date().getTime();if(this._clickCount>0){let r=e[0]-this._lastPosition[0],n=e[1]-this._lastPosition[1];Math.sqrt(r*r+n*n)>this._distance&&(this._clickCount=0)}this._lastPosition=e,this._clickCount=i-this._lastTime>this._delay?1:this._clickCount+1,this._lastTime=i},this._onMouseUp=t=>{}}start(t,e=500,i=2){this._target&&this.stop(),this.reset(),this._delay=e,this._distance=i,this._target=t,this._target.addEventListener("pointerdown",this._onMouseDown,!1),this._target.addEventListener("pointerup",this._onMouseUp,!1)}stop(){this._target&&(this._target.removeEventListener("pointerdown",this._onMouseDown,!1),this._target.removeEventListener("pointerup",this._onMouseUp,!1),this._target=void 0)}get clickCount(){return this._clickCount}reset(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0]}},HPe=class{constructor(t,e,i,r,n,s,a,o){this.eventId=t,this.id=e,this.data=i,this.dataEvent=r,this.object=n,this.stage=!1,this.actions=qs(r,i.actions,s,a,o,n)}disconnect(){Ia(this.actions)}dispatchIn(){this.actions.Audio.forEach(t=>t.dispatchBasic()),this.actions.Particles.forEach(t=>t.dispatchBasic()),this.actions.Video.forEach(t=>t.dispatchBasic()),this.actions.Create.forEach(t=>t.dispatch()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.Reset.forEach(t=>t.dispatch()),this.actions.Link.forEach(t=>t.dispatch()),this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.actions.Transition.forEach(t=>t.toggle()),this.actions.Animation.forEach(t=>t.play()),this.actions.SwitchCamera.forEach(t=>t.play()),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}dispatchOut(){this.actions.Transition.forEach(t=>{t.toggle()})}},GPe=class extends Uo{constructor(t,e){super(t),this.eventManager=e,this.breakpoints=[],this.resize=(i,r)=>{this.breakpoints.forEach(n=>{let s=iU.deviceToSize(n.data.size),a=n.dataEvent.orientation==="horizontal"?i:r,o;switch(n.data.operator){case"<":o=a<s[0];break;case">":o=a>s[0];break;case"<>":o=a>s[0]&&a<s[1];break}n.stage!==o&&(n.stage=o,n.stage?n.dispatchIn():n.dispatchOut())})},this.onResizeObserver=new ResizeObserver(i=>{for(let r of i){let{width:n,height:s}=r.contentRect;this.resize(n,s)}})}connect(){let{page:t,sharedAssets:e,domElement:i}=this.eventContext;this.onResizeObserver.observe(i);let r=n=>{var s;if(!(!n.visible||!((s=n.data)!=null&&s.events.length)))for(let{data:a,id:o}of n.data.events)a.disabled||a.type==="Resize"&&a.breakpoints.forEach(({data:l,id:c})=>{try{let u=new HPe(o,c,l,a,n,t,e,this.eventManager);this.breakpoints.push(u)}catch{}})};t.traverseEntity(n=>{var s;(n instanceof Ro||n instanceof Ca)&&((s=n.frame)==null||s.traverse(a=>{r(a)})),r(n)})}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach(t=>{t.disconnect()}),this.breakpoints=[]}},jPe=class extends Uo{constructor(t,e){super(t),this.eventManager=e,this.userAPIs={},this.events=[],this.onSuccess=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchSuccess()})},this.onError=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchError()})},this.userAPIs=t.sharedAssets.getUserAPIs()}connect(){this.eventContext.page.traverseEntity(t=>{var e;(e=t.data)==null||e.events.filter(i=>i.data.type==="API"&&!i.data.disabled).forEach(i=>{this.events.push(new WPe(i.id,i.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userAPIs).forEach(([t,e])=>{e.on("success",this.onSuccess),e.on("error",this.onError),e.autostart&&e.callUserAPI(this.eventContext.sharedAssets)})}disconnect(){Object.entries(this.userAPIs).forEach(([t,e])=>{e.off("success",this.onSuccess),e.off("error",this.onError)})}},WPe=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.successActions=qs(e,e.successActions,r,n,s,i),this.errorActions=qs(e,e.errorActions,r,n,s,i)}dispatchSuccess(){this.dispatchActions(this.successActions)}dispatchError(){this.dispatchActions(this.errorActions)}dispatchActions(t){t.Audio.forEach(e=>e.dispatchConditional()),t.Particles.forEach(e=>e.dispatchConditional()),t.Video.forEach(e=>e.dispatchConditional()),t.Create.forEach(e=>e.dispatch()),t.Destroy.forEach(e=>e.dispatch()),t.Reset.forEach(e=>e.dispatch()),t.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()}),t.Transition.forEach(e=>e.play()),t.Animation.forEach(e=>e.play()),t.SwitchCamera.forEach(e=>e.play()),t.SceneTransition.forEach(e=>e.dispatch()),t.SetVariable.forEach(e=>e.checkConditions()),t.SetVariable.forEach(e=>e.dispatch()),t.DynamicVariablePlay.forEach(e=>e.dispatch()),t.ClearLocalStorage.forEach(e=>e.dispatch()),t.UserAPI.forEach(e=>e.dispatch())}},qPe=class extends Uo{constructor(t,e){super(t),this.eventManager=e,this.userWebhooks={},this.events=[],this.onMessage=({userWebhookId:i})=>{this.events.forEach(r=>{r.data.userWebhookId===i&&r.dispatch()})},this.userWebhooks=t.sharedAssets.getUserWebhooks()}connect(){this.eventContext.page.traverseEntity(t=>{var e;(e=t.data)==null||e.events.filter(i=>i.data.type==="WEBHOOK"&&!i.data.disabled).forEach(i=>{this.events.push(new XPe(i.id,i.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userWebhooks).forEach(([t,e])=>{e.connect(),e.on("message",this.onMessage)})}disconnect(){Object.entries(this.userWebhooks).forEach(([t,e])=>{e.off("message",this.onMessage),e.disconnect()})}},XPe=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.actions=qs(e,e.actions,r,n,s,i)}dispatch(){let t=this.actions;t.Audio.forEach(e=>e.dispatchConditional()),t.Particles.forEach(e=>e.dispatchConditional()),t.Video.forEach(e=>e.dispatchConditional()),t.Create.forEach(e=>e.dispatch()),t.Destroy.forEach(e=>e.dispatch()),t.Reset.forEach(e=>e.dispatch()),t.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()}),t.Transition.forEach(e=>e.play()),t.Animation.forEach(e=>e.play()),t.SwitchCamera.forEach(e=>e.play()),t.SceneTransition.forEach(e=>e.dispatch()),t.SetVariable.forEach(e=>e.checkConditions()),t.SetVariable.forEach(e=>e.dispatch()),t.DynamicVariablePlay.forEach(e=>e.dispatch()),t.ClearLocalStorage.forEach(e=>e.dispatch()),t.UserAPI.forEach(e=>e.dispatch())}};function YPe(){let t=document.createElement("textarea");return t.style.position="fixed",t.style.top="200px",t.style.left="400px",t.style.zIndex="-1",t.style.border="1px solid rgba(255,0,0,0.5)",t.style.width="10px",t.style.height="500px",t.style.color="white",t.style.opacity="0.5",t.style.background="transparent",t.style.display="none",t.style.margin="0px",t.style.padding="0px",t.style.boxSizing="content-box",t.style.pointerEvents="none",t}var QPe=new W(0,0,1),y8=new W,x8=new W,b8=new Hs,ZPe=class{constructor(t,e,i,r,n){this.containerScene=t,this.raycaster=e,this.sharedAssets=i,this.requestRender=r,this.onExit=n,this.htmlInput=null,this.virtualInput=null,this.helper=new VQ,this.doubleClickHandler=new VPe,this.isDragging=!1,this.plane=new Bl,this.caretInterval=0,this.planeIntersection=new W,this.projected=new Oe,this._lastIndex=0,this._isFirstDragMove=!1,this.selectionOnDragStart=0,this.onTextMaterialChanged=()=>{var a;let s=(a=this.virtualInput)==null?void 0:a.data;if(this.virtualInput!==void 0&&s){let o=s.material,l=typeof o=="string"?this.sharedAssets.data.materials[o]:o,c=rTe(l,this.sharedAssets);this.helper.setCaretColor(c)}},this.stopAnimateTextCursor=()=>{clearInterval(this.caretInterval),this.helper&&(this.helper.caretMesh.visible=!1)},this.startAnimateTextCursor=()=>{this.stopAnimateTextCursor(),this.helper&&(this.helper.caretMesh.visible=!0,this.caretInterval=setInterval(()=>{this.helper&&(this.helper.caretMesh.visible=!this.helper.caretMesh.visible),this.requestRender()},600))},this.handleCaretUpdate=s=>{if(!this.htmlInput||!this.virtualInput)return;let a=this.helper,o=(s==null?void 0:s.key)==="ArrowLeft"||(s==null?void 0:s.key)==="ArrowRight",l=(s==null?void 0:s.key)==="ArrowUp"||(s==null?void 0:s.key)==="ArrowDown";this.htmlInput.selectionStart===this.htmlInput.selectionEnd?(a.setCaretPosition(this.htmlInput.selectionStart,{horizontalKeyMove:o,verticalKeyMove:l}),this.startAnimateTextCursor()):a.setSelection(this.htmlInput.selectionStart,this.htmlInput.selectionEnd),this.requestRender()},this.containerScene.add(this.helper)}createInput(){return this.htmlInput=YPe(),this.htmlInput}connect(){}disconnect(){var t;this.stopAnimateTextCursor(),this.helper.hide(),(t=this.htmlInput)==null||t.remove(),this.doubleClickHandler.stop()}handleMouseDown(){var s,a;if(!this.htmlInput||!this.virtualInput)return!0;this.getPointOnPlane();let t=this.doubleClickHandler.clickCount,{index:e,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,t>1?"inside":"previous")??{index:0,lineIndex:0,characterIndex:0};(a=(s=this.virtualInput)==null?void 0:s.wrappedText)!=null&&a.length&&this.virtualInput.wrappedText[i][Math.max(0,r-1)]===`
`&&(e--,r--),this._lastIndex=e,this._isFirstDragMove=!0;let n=this.checkClickedObject();if(t===1){if(n===null)return this.onExit(this.virtualInput),!0;this.selectionOnDragStart=e,this.isDragging=!0,this.setInputSelection(e)}else n===this.virtualInput&&(t===2?this.selectClosestWord(i,r):t>2&&(this.setInputSelection(0,this.htmlInput.value.length),this.doubleClickHandler.reset()))}handleMouseUp(){this.applyRangeToTextInput(),this.isDragging=!1,this._isFirstDragMove=!1}handleMouseMove(){!this.virtualInput||(this._isFirstDragMove&&this.doubleClickHandler.clickCount>1&&(this.selectionOnDragStart=this._lastIndex,this.isDragging=!0,this.setInputSelection(this._lastIndex)),this._isFirstDragMove=!1,this.getPointOnPlane(),this.applyRangeToTextInput())}focus(t){var e;if(this.virtualInput=t,this.updateTextInputStyles(),this.htmlInput)if(t){let i=(e=this.data)==null?void 0:e.geometry.text;this.htmlInput.value=typeof i=="string"?"":(i==null?void 0:i.textValue.toString())??""}else this.htmlInput.value=""}blur(){}get data(){let{virtualInput:t}=this;if(t)return t.dataPatched}applyRangeToTextInput(){var n;if(!this.isDragging||!this.virtualInput||!this.htmlInput)return;let t=this.selectionOnDragStart,{index:e,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,this.doubleClickHandler.clickCount>2?"inside":"previous")??{index:0};i!==void 0&&r!==void 0&&((n=this.virtualInput)==null?void 0:n.wrappedText[i][r-1])===`
`&&e--,this.htmlInput.setSelectionRange(Math.min(t,e),Math.max(t,e))}checkClickedObject(){if(this.virtualInput){let t=this.raycaster.intersectObject(this.virtualInput,!1);if(t.length>0){let e=t[0];if(e.object instanceof L4)return e.object}}return null}selectClosestWord(t,e){if(!this.virtualInput)return;let i=this.virtualInput.wrappedText,r=i[t],n=e+1,s=e;r[e]!==" "&&(n=this.findNextCharOccurence(r,e,"forward"," "),s=this.findNextCharOccurence(r,e,"backward"," "),s>0&&s++,n>=r.length-1&&t===i.length-1&&n++);let a=this.helper,o=a.getGlobalIndexFromLineAndCharIndexes(i,t,s),l=a.getGlobalIndexFromLineAndCharIndexes(i,t,n);this.setInputSelection(o,l)}findNextCharOccurence(t,e,i,r=" "){let n=Math.max(0,t.length-1),s=i==="forward"?n:0,a=i==="forward"?1:-1,o=Math.max(Math.min(e,n),0);for(;o!==s;)if(o+=a,t.charAt(o)===r)return o;return s}getPointOnPlane(){var e;let t=(e=this.virtualInput)==null?void 0:e.data;if(!(!this.virtualInput||!t)&&this.raycaster.ray.intersectsPlane(this.plane)){this.planeIntersection===null&&(this.planeIntersection=new W);let i=this.raycaster.ray.intersectPlane(this.plane,this.planeIntersection);if(i){this.planeIntersection.copy(this.virtualInput.worldToLocal(i));let r=typeof t.geometry.width=="number"?t.geometry.width:1,n=typeof t.geometry.height=="number"?t.geometry.height:1;this.projected.set(i.x+r*.5,i.y-n*.5)}}}updatePlane(){var e;let t=(e=this.virtualInput)==null?void 0:e.data;this.virtualInput&&t&&(b8.getNormalMatrix(this.virtualInput.matrixWorld),y8.copy(QPe).applyMatrix3(b8).normalize(),this.virtualInput.localToWorld(x8.set(0,0,t.geometry.depth)),this.plane.setFromNormalAndCoplanarPoint(y8,x8))}setInputSelection(t,e=t){var i;(i=this.htmlInput)==null||i.setSelectionRange(t,e),setTimeout(()=>{var r;(r=this.htmlInput)==null||r.focus()})}updateTextInputStyles(){var e;let t=(e=this.virtualInput)==null?void 0:e.data;this.virtualInput&&t&&this.htmlInput&&(this.htmlInput.style.fontSize=t.geometry.fontSize+"px",this.htmlInput.style.letterSpacing=t.geometry.letterSpacing*t.geometry.fontSize+"px",this.htmlInput.style.lineHeight=t.geometry.fontSize*t.geometry.lineHeight+"px",this.htmlInput.style.width=t.geometry.width+"px",this.htmlInput.style.height=t.geometry.height+"px",this.htmlInput.style.textAlign=KPe(t.geometry.horizontalAlign))}};function KPe(t){return t===4?"justify":t===2?"right":t===3?"center":"left"}var tK=(t,e)=>{if(typeof t=="string"){let i=e.data(t);if(i)return tK(i.value,e)}return to.getDisplayedValue(t)};function _8(t,e){let i=t.text,r="";if(typeof i=="string"){let n=e.variables.data(r);n&&(r=tK(n.value,e.variables))}else r=i.textValue.toString();return r}var JPe=class extends Uo{constructor(t,e){super(t),this.eventManager=e,this._textInputs=[],this.sceneHelpers=new ql,this.helper=new VQ,this._onMouseDownFocusIn=i=>{if(Ai.length>1)return;this.eventContext.updateRaycaster(i);let r=null;if(this.eventContext.raycaster){for(let n of this._textInputs)if(this.eventContext.raycaster.intersectObject(n,!0).length>0){r=n;break}}this.focusOnTextInput(r),this._onCaretUpdate(),this._onMouseUp(),this.textInputManager.doubleClickHandler.start(this.eventContext.domElement),this.textInputManager.doubleClickHandler._onMouseDown(i),this._onMouseDown(i)},this.onExit=()=>{let{virtualInput:i}=this.textInputManager;if(i===null)return;let r=this.textInputManager.htmlInput;this.helper.hide(),r==null||r.setSelectionRange(r.value.length,r.value.length),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0);let{domElement:n}=this.eventContext;n.removeEventListener("pointerdown",this._onMouseDown,!1),n.removeEventListener("pointerup",this._onMouseUp,!1),n.removeEventListener("pointermove",this._onMouseMove,!1),window.removeEventListener("keydown",this._onKeyPress),this.textInputManager.doubleClickHandler.reset(),n.addEventListener("pointerdown",this._onMouseDownFocusIn),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers()},this._onMouseDown=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseDown(),this.textInputManager.virtualInput&&this.eventContext.raycaster.intersectObject(this.textInputManager.virtualInput,!0).length>0&&this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1)},this._onMouseUp=()=>{this.textInputManager.handleMouseUp(),this.eventManager.controlsManager.orbitControls&&!this.eventManager.controlsManager.orbitControls.enabled&&(this.eventManager.controlsManager.orbitControls.enabled=!0)},this._onMouseMove=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseMove()},this._onTextEdit=i=>{let{htmlInput:r,virtualInput:n,helper:s}=this.textInputManager;if(!r||!n)return;let a=r.value;n.textGeometry.setText(a).then(()=>{this.eventContext.requestRender()});let o=n.data;s.update();let l=o.geometry.text;if(typeof l=="string"){let c=l;this.eventContext.sharedAssets.updateVariable(c,{textValue:a})}this.textInputManager.updateTextInputStyles(),this._onCaretUpdate()},this._onCaretUpdate=i=>{this.textInputManager.handleCaretUpdate(i)},this._onKeyPress=i=>{i.key==="Escape"&&this.onExit()},this.textInputManager=new ZPe(this.sceneHelpers,t.raycaster,t.sharedAssets,t.requestRender,this.onExit)}connect(){let t=[];if(this.eventContext.scene.traverseEntity(r=>{r instanceof L4&&t.push(r)}),this._textInputs=t,t.length===0)return;let{domElement:e}=this.eventContext;e.addEventListener("pointerdown",this._onMouseDownFocusIn),this.textInputManager.connect();let i=this.textInputManager.createInput();document.body.appendChild(i),i.style.display="none",i.addEventListener("keyup",this._onCaretUpdate),i.addEventListener("keydown",this._onCaretUpdate),i.addEventListener("beforeinput",this._onCaretUpdate),i.addEventListener("paste",this._onCaretUpdate),i.addEventListener("cut",this._onCaretUpdate),i.addEventListener("select",this._onCaretUpdate),i.addEventListener("selectstart",this._onCaretUpdate)}disconnect(){let t=this.textInputManager.htmlInput,{domElement:e}=this.eventContext;e.removeEventListener("pointerdown",this._onMouseDownFocusIn),t==null||t.removeEventListener("keyup",this._onCaretUpdate),t==null||t.removeEventListener("keydown",this._onCaretUpdate),t==null||t.removeEventListener("beforeinput",this._onCaretUpdate),t==null||t.removeEventListener("paste",this._onCaretUpdate),t==null||t.removeEventListener("cut",this._onCaretUpdate),t==null||t.removeEventListener("select",this._onCaretUpdate),t==null||t.removeEventListener("selectstart",this._onCaretUpdate),this._textInputs.forEach(i=>{let r=_8(i.data.geometry,this.eventContext.sharedAssets.data);i.textGeometry.setText(r)}),e.removeEventListener("pointerdown",this._onMouseDown,!1),e.removeEventListener("pointerup",this._onMouseUp,!1),e.removeEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers(),this.textInputManager.disconnect()}focusOnTextInput(t){this.textInputManager.focus(t),this.textInputManager.onTextMaterialChanged();let e=this.textInputManager.htmlInput;if(!e||t===null)return;this.textInputManager.updateTextInputStyles(),this.eventContext.renderer.sceneHelpersOnTop=this.sceneHelpers,this.eventContext.renderer.pipeline.enableHelpers(),this.textInputManager.isDragging=!1;let i=_8(t.textGeometry.userData.parameters,this.eventContext.sharedAssets.data);e.value=i,e.setSelectionRange(0,0),this.textInputManager.helper.show(t),e.style.display="block",e.addEventListener("input",this._onTextEdit),this.textInputManager.updatePlane();let{domElement:r}=this.eventContext;r.removeEventListener("pointerdown",this._onMouseDownFocusIn),r.addEventListener("pointerdown",this._onMouseDown,!1),r.addEventListener("pointerup",this._onMouseUp,!1),r.addEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress)}},$Pe=class extends Uo{constructor(t,e){super(t),this.eventManager=e,this.events=[],this.onVoice=({value:i,frequencies:r})=>{this.events.forEach(n=>{n.dispatch()})}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(t=>{var e;(e=t.data)==null||e.events.filter(i=>i.data.type==="AIAssistantListener"&&!i.data.disabled).forEach(i=>{this.events.push(new eRe(i.id,i.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("voice",this.onVoice))}disconnect(){var t;(t=this.openAIRealtime)==null||t.off("voice",this.onVoice)}},eRe=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.actions=qs(e,e.actions,r,n,s,i)}dispatch(){this.dispatchActions(this.actions)}dispatchActions(t){t.Audio.forEach(e=>e.dispatchConditional()),t.Particles.forEach(e=>e.dispatchConditional()),t.Video.forEach(e=>e.dispatchConditional()),t.Create.forEach(e=>e.dispatch()),t.Destroy.forEach(e=>e.dispatch()),t.Reset.forEach(e=>e.dispatch()),t.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()}),t.Transition.forEach(e=>e.play()),t.Animation.forEach(e=>e.play()),t.SwitchCamera.forEach(e=>e.play()),t.SceneTransition.forEach(e=>e.dispatch()),t.SetVariable.forEach(e=>e.checkConditions()),t.SetVariable.forEach(e=>e.dispatch()),t.DynamicVariablePlay.forEach(e=>e.dispatch()),t.ClearLocalStorage.forEach(e=>e.dispatch()),t.UserAPI.forEach(e=>e.dispatch())}},tRe=class extends Uo{constructor(t,e){super(t),this.eventManager=e,this.events=[],this.onTriggerEvent=({description:i,direction:r})=>{let n=this.events.find(s=>s.data.description===i);n&&(r==="backward"?n.dispatchReverse():n.dispatch())}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(t=>{var e;(e=t.data)==null||e.events.filter(i=>i.data.type==="AIAssistantTrigger"&&!i.data.disabled).forEach(i=>{this.events.push(new iRe(i.id,i.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("trigger_event",this.onTriggerEvent))}disconnect(){var t;(t=this.openAIRealtime)==null||t.off("trigger_event",this.onTriggerEvent)}},iRe=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.actions=qs(e,e.actions,r,n,s,i)}dispatch(){let t=this.actions;t.Audio.forEach(e=>e.dispatchConditional()),t.Particles.forEach(e=>e.dispatchConditional()),t.Video.forEach(e=>e.dispatchConditional()),t.Create.forEach(e=>e.dispatch()),t.Destroy.forEach(e=>e.dispatch()),t.Reset.forEach(e=>e.dispatch()),t.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()}),t.Transition.forEach(e=>e.play()),t.Animation.forEach(e=>e.play()),t.SwitchCamera.forEach(e=>e.play()),t.SceneTransition.forEach(e=>e.dispatch()),t.SetVariable.forEach(e=>e.checkConditions()),t.SetVariable.forEach(e=>e.dispatch()),t.DynamicVariablePlay.forEach(e=>e.dispatch()),t.ClearLocalStorage.forEach(e=>e.dispatch()),t.UserAPI.forEach(e=>e.dispatch())}dispatchReverse(){let t=this.actions;t.Transition.forEach(e=>e.reverseFromCurrent()),t.Particles.forEach(e=>e.reverseFromCurrent()),t.Animation.forEach(e=>e.reverseFromCurrent()),t.SwitchCamera.forEach(e=>e.reverseFromCurrent()),t.Create.forEach(e=>e.dispatchStop())}},rRe=class{constructor(t,e,i,r,n){this.publish=t,this.controlsManager=e,this.animationControls=i,this.eventContext=r,this.sharedVariables=n,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onTouchMovePreventScroll=s=>{let a=window.parent!==window,o=document.documentElement.scrollHeight>document.documentElement.clientHeight||document.documentElement.scrollWidth>document.documentElement.clientWidth;(s.touches.length>1||this.preventTouchScroll||a===!1&&o===!1)&&s.preventDefault()},this.onMouseWheelPreventScroll=s=>{this.preventScroll&&s.preventDefault()},this.onMouseMove=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:s.buttons>0}},this.onMouseDown=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!0}},this.onMouseUp=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!1}},this.getMousePosition=s=>{var c;let{domRect:a}=this.eventContext,{pageX:o,pageY:l}=((c=s.touches)==null?void 0:c.length)>0?s.touches[0]:s;return{x:o-(a.left+window.scrollX),y:l-(a.top+window.scrollY)}},this.stopRaycast=t.stopRaycast,this.preventScroll=t.preventScroll,this.preventTouchScroll=t.preventTouchScroll,this.hideCursor=t.hideCursor,this.requestRender=r.requestRender}activate(t=!1){var r;if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new P3e(this.eventContext),VariableChange:new lPe(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),API:new jPe(this.eventContext,this),WEBHOOK:new qPe(this.eventContext,this),AIAssistantListener:new $Pe(this.eventContext,this),AIAssistantTrigger:new tRe(this.eventContext,this),Conditional:new B3e(this.eventContext,this),Start:new aPe(this.eventContext,this),Basic:new O3e(this.eventContext,this,this.needsRaycast),MouseHover:new tPe(this.eventContext,this),Scroll:new nPe(this.eventContext,this),Follow:new X3e(this.eventContext,this),DragDrop:new H3e(this.eventContext,this),LookAt:new J3e(this.eventContext),Resize:new GPe(this.eventContext,this),Textfields:new JPe(this.eventContext,this)};let{page:e,domElement:i}=this.eventContext;this.hideCursor&&(i.style.cursor="none"),e.traverseEntity(n=>{n.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(n=>n.connect()),i.addEventListener("wheel",this.onMouseWheelPreventScroll),i.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++,t||((r=this.eventContext.sharedAssets.openAIRealtime)==null||r.connect())}deactivate(t=!1){var r,n;if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:e,domElement:i}=this.eventContext;i.style.cursor="",Object.values(this.handlers).forEach(s=>s.disconnect()),(r=this.controlsManager.gameControl)==null||r.disposeActions(),this.controlsManager.disconnectEvents(),e.traverseEntity(s=>{s.removeEventListener("requestRender",this.requestRender),s.destroyedInAction=!1}),i.removeEventListener("touchmove",this.onTouchMovePreventScroll),i.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode(),t||((n=this.eventContext.sharedAssets.openAIRealtime)==null||n.disconnect())}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(!0),this.activate(!0),this.controlsManager.deactivate(),this.controlsManager.activate(this),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(t){let e=this.isEnabled;e&&this.deactivate(),this.eventContext.useWindowEvents=t,e&&this.activate()}initializeActionsDependentStates(){let t=this.eventContext.sharedAssets;t.resetDynamicVariablePlayState();let e=i=>{if(i.data.type==="Conditional"&&(i.data.ifActions.forEach(e),i.data.elseActions.forEach(e)),i.data.type==="Conditional"||i.data.type==="SetVariable")for(let r of i.data.type==="Conditional"?i.data.condition:i.data.expression)"id"in r&&Array.isArray(r.id)&&(r.id[0]==="mouse"&&(this.needsMouse=!0),r.id[0]==="raycast"&&(this.needsRaycast=!0));i.data.type==="DynamicVariablePlay"&&i.data.variableId!==""&&(i.data.mode==="Play"||i.data.mode==="PlayPause"||i.data.mode==="Toggle")&&t.setDynamicVariablePlayState(i.data.variableId,"Stopped")};this.eventContext.page.traverseEntity(i=>{var r;if((r=i.data)!=null&&r.events.length)for(let n of i.data.events)if(n.data.type==="VariableChange"&&(n.data.variableId==="mouseProperty"&&(this.needsMouse=!0),n.data.variableId==="raycastProperty"&&(this.needsRaycast=!0)),n.data.type==="Conditional")for(let s of["inActions","outActions"])n.data[s].forEach(e);else if(n.data.type==="DragDrop")for(let s of["drag","drop"])n.data.dragDropActions[s].forEach(e);else if(n.data.type==="GameControl")for(let s of["idle","move","jump","run"])n.data.gameActions[s].forEach(e);else if(n.data.type==="Resize")for(let s of n.data.breakpoints)s.data.actions.forEach(e);else n.data.type==="LookAt"||n.data.type==="API"||n.data.actions.forEach(e)})}},nRe=class{constructor(t,e,i,r,n){this._aspect=1,this.enableResponsive=!1,this._renderer=t,this._camera=e,this._frameSize=new Oe().copy(i),this._editorSize=new Oe().copy(r),this._aspect=e.aspect,this._fov=n??e.fov}set frameSize(t){this._frameSize.copy(t)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let t=this._frameSize.x,e=this._frameSize.y,i=this._editorSize.y;this._aspect=t/e,e<=i&&(this._camera.zoom*=i/e),this._renderer.setViewport(0,0,t,e)}updateCamera(t=!0){if(this._camera)if(this._camera.cameraType==="PerspectiveCamera"){let e=this._frameSize.y,i=this._editorSize.y,r=this._fov;if(t&&e>i){let n=sRe(e,1080,2160,1,15)/100;r*=e/i,r*=1-n}this._camera.aspect=this._aspect,this._camera.fov=r,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(t){this._camera=t,this._aspect=t.aspect,this._fov=t.fov}revert(){let t=window.innerWidth,e=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,t,e),this._renderer.setSize(t,e)),this._camera&&(this._camera.aspect=t/e,this._camera.fov=this._fov,this._camera.setViewplaneSize(t,e,this.enableResponsive),this._camera.updateProjectionMatrix())}};function sRe(t,e,i,r,n){return(t-e)/(i-e)*(n-r)+r}var aRe=class{get sharedAssets(){return this.shared}constructor(t,e={},i=!0){this.shared=new S4(t.shared,e,!0,i),this.scene=new U4(t.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(t,e){this.scene.clearScene(),this.sharedAssets.reset(t.shared),this.scene.resetAfterClear(t.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let t of this.scene.children)t instanceof Ca&&!t.uiScene&&t.personalCamera.updateState(t.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(t=>{t instanceof Gs&&t.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},oRe=class{constructor({x:t=10,y:e=10}){this._startTime=0;let i=document.getElementById("spe-perfs");i?this.element=i:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${t}px`,this.element.style.top=`${e}px`}dispose(){var t;(t=this.element.parentElement)==null||t.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let t=performance.now()-this._startTime;this.element.innerHTML=t.toFixed(3)+" ms"}};function lRe(t){let e;if(t.index)for(let i=0;i<t.index.array.length;i+=3)e=t.index.array[i],t.index.array[i]=t.index.array[i+2],t.index.array[i+2]=e}function aw(t){return t instanceof jw?"SubdivObject":t.geometry.type==="NonParametricGeometry"?"NonParametric":"Mesh"}function cRe(t,e){let i={};return t.traverseEntity(r=>{var l;if(!r.visible||!(r instanceof hl)||r.type!=="Mesh"||Array.isArray(r.material)||r.states&&Object.keys(r.states).length)return;let n=r.parent;for(;n;){if(n instanceof hl&&r.states&&Object.keys(r.states).length)return;n=n.parent}let s=r.material.uuid,a=e.shared.materials[s];if(a){if(!Oa.isMergable(a))return}else{let c=(l=e.scene.objects.get(r.uuid))==null?void 0:l.data;if(c&&"material"in c&&typeof c.material!="string"){if(!Oa.isMergable(c.material))return;s=Oa.getHash(c.material)}}i[s]||(i[s]={});let o=i[s][aw(r)];if(o){if(o.push(r),r.cloner)for(let c of r.cloner.children)o.push(c)}else if(i[s][aw(r)]=[r],r.cloner)for(let c of r.cloner.children)i[s][aw(r)].push(c)}),i}function uRe(t){let e=0;return Object.values(t).forEach(i=>{Object.values(i).forEach(r=>{let n=r.length;n>e&&(e=n)})}),e}function hRe(t,e){let i=cRe(e,t),r=uRe(i),n=new Array(r),s=0,a=new Array(r),o=0,l=new Array(r),c=0,u=new Array(r),h=0;for(let[d,p]of Object.entries(i))for(let g of Object.values(p)){if(o=0,c=0,g.forEach(v=>{v instanceof hl&&(a[o++]=v.geometry.clone(),l[c++]=v)}),c<2)continue;for(let v=0;v<c;v++)l[v].updateWorldMatrix(!0,!1),a[v].applyMatrix4(l[v].matrixWorld),l[v].matrixWorld.determinant()<0&&lRe(a[v]);let x=h0(a.slice(0,o),!1);if(x){let v;switch(d){case"SubdivObject":{console.warn("Turning subdiv object into mesh"),v=new bn(x,l[0].material);break}default:{v=new bn(x,l[0].material);break}}v.castShadow=l[0].castShadow,v.receiveShadow=l[0].receiveShadow,e.add(v);let b=w=>{h=0;for(let M of w)M.children&&b(M.children),M instanceof hl&&(Array.isArray(M.material)||i[M.material.uuid]&&i[M.material.uuid][aw(M)]&&i[M.material.uuid][aw(M)].length>1||(u[h++]=M));for(let M=0;M<h;M++)e.attach(u[M])};for(let w=0;w<c;w++){let M=l[w];b(M.children),n[s++]=M}}}for(let d=0;d<s;d++)n[d].removeFromParent()}var dRe=Dg(use(),1),fRe=new Oe;function pRe(t){let e="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";t.endsWith(".spline")?console.warn(e+" The .spline files are only meant to be used by the Editor."):t.endsWith(".splinecode")||console.warn(e)}var mRe=class{constructor(t,{renderOnDemand:e,renderMode:i="auto"}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=r=>{var n,s,a,o,l,c,u,h,d,p,g,x,v;if(this.time=r,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,(n=this._perfs)==null||n.start(),!this._renderer){(s=this._perfs)==null||s.end();return}if(!this._isPaused&&(this.renderMode==="manual"&&!this._renderRequested||this.renderMode==="auto"&&this._skipRender)){(a=this._perfs)==null||a.end();return}if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&((o=this._eventManager.handlers)!=null&&o.Start.hasVideoAction||(l=this._eventManager.handlers)!=null&&l.Basic.hasVideoAction||(c=this._eventManager.handlers)!=null&&c.Conditional.hasVideoAction)&&(this._skipRender=!1),(u=this._animationControls)==null||u.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,(h=this._scene)==null||h.traverseVisibleEntity(b=>{b.type==="ParticleSystem"&&(b.update(this.dt),this._skipRender=!1)}),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),(d=this._eventManager)!=null&&d.isEnabled&&(((p=this._eventManager.handlers)==null?void 0:p.Follow).onAnimationFrameDamping(),((g=this._eventManager.handlers)==null?void 0:g.LookAt).onAnimationFrameDamping(),((x=this._eventManager.handlers)==null?void 0:x.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let b=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=b,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),(v=this._perfs)==null||v.end()},this._resize=r=>{var n,s,a,o,l,c,u,h,d,p;if(this._renderer){if(this._viewportMode===1&&this._frameView&&(this._frameView.frameSize=fRe.set(this._viewportWidth,this._viewportHeight)),r){let g=this._viewportWidth,x=this._viewportHeight;this._renderer.setSize(g-1,x-1,!1),this._renderer.setSize(g,x,!1)}else this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1);if(this._camera=(n=this._scene)==null?void 0:n.activeCamera,(u=this._scene)==null||u.updateViewPlaneSize(((a=(s=this._frameView)==null?void 0:s.frameSize)==null?void 0:a.x)??this._viewportWidth,((l=(o=this._frameView)==null?void 0:o.frameSize)==null?void 0:l.y)??this._viewportHeight,((c=this._frameView)==null?void 0:c.enableResponsive)??!1),this._camera){let g=Object.values(((h=this._data)==null?void 0:h.frames)??{})[0].preset??"fullscreen";(d=this._frameView)==null||d.setCamera(this._camera),(p=this._frameView)==null||p.updateCamera(g!=="fullscreen"),this._camera.cameraType==="PerspectiveCamera"&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}},this._debouncedResize=Ow(this._resize,10),this._onScroll=r=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())},this.canvas=t,this.renderMode=e?"auto":i,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new oRe({x:10,y:10})),c1e(t)}async load(t,e,i){pRe(t),this.disposed=!1;let r=await(await fetch(t,i)).arrayBuffer();await this.start(r,{variables:e})}async start(t,{interactive:e=!0,variables:i}={}){var l,c,u,h;if(this.disposed)return;let r=await NPe(t);this._data=r;let n=FPe(r);r.version&&(0,dRe.default)(r.version,"1.9.82")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([n.length&&UPe(),WG(r)&&fwe(),yEe(r)&&cwe(),Bw.physicsEnabled(r.scene.objects)&&p1e(),kG(r)&&YMe(),_j(r)&&DCe(),qMe(r)&&WMe(),dj(r)&&mTe(),bPe(r)&&d1e()].filter(Boolean)),n.length&&await kPe(n),(l=this._eventManager)==null||l.deactivate(),(c=this._controls)==null||c.deactivate(),(u=this._scene)==null||u.dispose();let s=new aRe(r);if(s.resetPersonalCameraFromDocumentData(),this._scene=s.scene,this._sharedAssetsManager=s.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let d=performance.now();hRe(r,s.scene);let p=performance.now();console.log("Merged geometries in ",p-d," ms")}WG(r)&&this._scene.traverse(d=>{yp(d)&&d.recomputeBoolean()}),this._sharedAssetsManager.setRequestRender(()=>{var d;this._requestRenderAutoMode(),(d=this._scene)==null||d.traverse(p=>{p instanceof eu&&p.pendingMediaLoad&&p.update()})}),(h=this._scene)==null||h.traverse(d=>{d.type==="ParticleSystem"&&(d.wakeUp(),d.data.autoPlay?d.start():d.stop())});let a=Object.keys(r.shared.fonts).map(d=>this._sharedAssetsManager.getFont(d).loadingPromise);if(Promise.all(a).then(()=>{s.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()}),kG(r)&&PPe(r)&&await Promise.all(a),dj(r)){let d=[];this._scene.traverseEntity(p=>{(p instanceof Ro||p instanceof Ca)&&p.uiCanvas&&d.push(p.uiCanvas)}),await Promise.all(d.map(p=>p.promise))}if(this._scene.rewriteEventsBeforeGoToPlayMode(),Q4(this._scene.activePage,this._sharedAssetsManager),!this._renderer&&(this._renderer=new tTe({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=r.scene.publish.hdTransmission===!0,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.enableUIOverlay(),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode),r.shared.images.SplineWatermark)){let d=this._sharedAssetsManager.getImage("SplineWatermark");await d.loadPromise;let p=d.getTexture(1001);this._renderer.pipeline.setWatermark(p)}_j(r)&&this._scene.initializeSplatViewer(),r.scene.blueNoiseTextureData!==void 0&&this._renderer.pipeline.updateBlueNoiseTexture(r.scene.blueNoiseTextureData);let o=Object.values(r.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):(o.preset==="fullscreen"?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=o.size[0],this._viewportHeight=o.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new nRe(this._renderer,this._camera,new Oe(this._viewportWidth,this._viewportHeight),new Oe(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(o.allowResponsive??!1)&&o.preset==="fullscreen"),e){let d=new C3e(this._renderer,this.data.scene.publish,this._scene,()=>this._scene.activeCamera,this._sharedAssetsManager,this._requestRenderAutoMode,!0,o);this._scene.updateMatrixWorld(!0),this._controls=new RPe(d),this._animationControls=new LPe(this._scene,this._requestRenderAutoMode),this._eventManager=new rRe(r.scene.publish,this._controls,this._animationControls,d,r.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),this._scene.activePage.data.postprocessing.depthOfField.enabled&&Promise.all(this._sharedAssetsManager.getImageLoadPromises()).then(()=>{this._resize(!0)}),i!==void 0&&this.setVariables(i),this.dt===0&&(this.render(performance.now()),setTimeout(()=>{var d;(d=this._renderer)==null||d.setAnimationLoop(this.render)},0)),this._resizeObserverTimeout=setTimeout(()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver(()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()}),this._resizeObserver.observe(this.canvas.parentElement))},300),document.addEventListener("scroll",this._onScroll)}setVariables(t){if(this._data!==void 0){let e=Object.entries(t);for(let[i,r]of e)this.setVariable(i,r)}}setVariable(t,e){var r;let i=this._getVariableByName(t);if(i&&!("dynamicVariableType"in i.data)){let n=e;typeof i.data.value=="number"?n=typeof e=="number"?e:typeof e=="boolean"?e===!0?1:0:parseFloat(e):typeof i.data.value=="boolean"?n=typeof e=="number"?!!e:typeof e=="boolean"?e:e.toLocaleLowerCase()==="false"?!1:!!e:typeof i.data.value!="string"&&i.data.value.textValue!==void 0&&(n=e.toString());let s=typeof n=="string"?{textValue:n}:n;(r=this._sharedAssetsManager)==null||r.updateVariable(i.id,s),this.requestRender(),this._requestRenderAutoMode()}else i===void 0?console.warn(`No variable named ${t} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in i.data&&console.warn(`Dynamic variables like ${t} cannot be updated from code.`)}getVariables(){let t={};return this._data&&this._data.shared.variables.forEach(e=>{t[e.data.name]===void 0&&(t[e.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(e.id)))}),t}getVariable(t){let e=this._getVariableByName(t);if(e){let i=this._sharedAssetsManager.getVariable(e.id);return this._getVariableValue(i)}}_getVariableValue(t){return typeof t!="string"&&to.isTextValue(t)?to.getDisplayedValue(t):t}_getVariableByName(t){if(this._data){if(this._variablesCache.has(t))return this._variablesCache.get(t);let e=this._data.shared.variables.find(i=>i.data.name===t);return e&&this._variablesCache.set(t,e),e}}findObjectById(t){var i;let e=(i=this._scene)==null?void 0:i.getObjectByProperty("uuid",t);return this._createProxyObject(e)}findObjectByName(t){var i;let e=(i=this._scene)==null?void 0:i.getObjectByName(t);return this._createProxyObject(e)}getAllObjects(){var e;let t=[];return(e=this._scene)==null||e.traverseEntity(i=>{if(i.uuid!==yb&&!this._scene.isInvisibleObjects(i)&&!(i instanceof Ca)){let r=this._createProxyObject(i);r&&t.push(r)}}),t}getSplineEvents(){var t,e;return((e=(t=this._eventManager)==null?void 0:t.handlers)==null?void 0:e.Spline).splineEvents}emitEvent(t,e){var i;(i=this.findObjectById(e)||this.findObjectByName(e))==null||i.emitEvent(t)}emitEventReverse(t,e){var i;(i=this.findObjectById(e)||this.findObjectByName(e))==null||i.emitEventReverse(t)}addEventListener(t,e){this.canvas.addEventListener(t,e)}removeEventListener(t,e){this.canvas.removeEventListener(t,e)}setZoom(t){var e,i;((e=this._controls)==null?void 0:e.orbitControls)instanceof eK&&((i=this._controls)==null||i.orbitControls.setZoom(t))}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(t,e){this._viewportWidth=t,this._viewportHeight=e,this._viewportMode=2,this._resize()}setBackgroundColor(t){var a;let{r:e,g:i,b:r,a:n}={r:0,g:0,b:0,a:1},s=new ro(e,i,r,n);try{s.setStyle(t)}catch{console.error("This is not a valid css color",t)}(a=this._scene)==null||a.activePage.setBackgroundColor(s),this._requestRenderAutoMode()}dispose(){var t,e,i,r,n,s,a;this.disposed=!0,(t=this._eventManager)==null||t.deactivate(),(e=this._scene)==null||e.dispose(),(i=this._sharedAssetsManager)==null||i.dispose(),this._proxyObjectCache.forEach(o=>{YV.unsubscribe(o)}),this._variablesCache.clear(),(r=this._renderer)==null||r.setAnimationLoop(null),(n=this._renderer)==null||n.dispose(),this._renderer=void 0,(s=this._sharedAssetsManager)==null||s.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),this._resizeObserverTimeout!==void 0&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),(a=this._controls)==null||a.deactivate(),this.dt=0,u1e(this.canvas),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){var t,e,i;this._isPaused||((t=this._renderer)==null||t.setAnimationLoop(null),this._isPaused=!0,(e=this._eventManager)==null||e.pause(),(i=this._controls)!=null&&i.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){var t,e,i;!this._isPaused||(this._isPaused=!1,(t=this._eventManager)==null||t.resume(),(e=this._controls)!=null&&e.orbitControls&&(this._controls.orbitControls.enabled=!0),(i=this._renderer)==null||i.setAnimationLoop(this.render))}setGlobalEvents(t){var e;(e=this._eventManager)==null||e.updateUseWindowEvents(t)}get data(){return this._data}_createProxyObject(t){var n;if(t==null)return;if(this._proxyObjectCache.has(t.uuid))return this._proxyObjectCache.get(t.uuid);let e;t.traverseAncestors(s=>{s instanceof Ca&&(e=s.name)});let i={name:t.name,uuid:t.uuid,visible:t.visible,intensity:t.intensity,position:t.position,rotation:t.rotation,scale:t.scale,type:t.data.type,page:e,parentUuid:t.parent instanceof Ca||t instanceof U4||(n=t.parent)==null?void 0:n.uuid,emitEvent(s){t.dispatchEvent({type:"userEvent",eventName:s})},emitEventReverse(s){t.dispatchEvent({type:"userEvent",eventName:s,reverse:!0})}},r=YV(i,(s,a)=>{var o;typeof t[s]!="object"&&((o=Object.getOwnPropertyDescriptor(t,s))!=null&&o.writable)&&(t[s]=a),this._requestRenderAutoMode(),t.updateMatrix()});return this._proxyObjectCache.set(t.uuid,r),r}setUIWasmUrl(t){bQ.skiaWasmUrl=t}},YL,S8;function gRe(){if(S8)return YL;S8=1;var t="Expected a function",e=NaN,i="[object Symbol]",r=/^\s+|\s+$/g,n=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,o=parseInt,l=typeof gA=="object"&&gA&&gA.Object===Object&&gA,c=typeof self=="object"&&self&&self.Object===Object&&self,u=l||c||Function("return this")(),h=Object.prototype,d=h.toString,p=Math.max,g=Math.min,x=function(){return u.Date.now()};function v(D,T,L){var P,R,O,U,F,V,k=0,K=!1,X=!1,$=!0;if(typeof D!="function")throw new TypeError(t);T=E(T)||0,b(L)&&(K=!!L.leading,X="maxWait"in L,O=X?p(E(L.maxWait)||0,T):O,$="trailing"in L?!!L.trailing:$);function Y(ue){var fe=P,xe=R;return P=R=void 0,k=ue,U=D.apply(xe,fe),U}function re(ue){return k=ue,F=setTimeout(ee,T),K?Y(ue):U}function G(ue){var fe=ue-V,xe=ue-k,be=T-fe;return X?g(be,O-xe):be}function j(ue){var fe=ue-V,xe=ue-k;return V===void 0||fe>=T||fe<0||X&&xe>=O}function ee(){var ue=x();if(j(ue))return oe(ue);F=setTimeout(ee,G(ue))}function oe(ue){return F=void 0,$&&P?Y(ue):(P=R=void 0,U)}function Q(){F!==void 0&&clearTimeout(F),k=0,P=V=R=F=void 0}function ae(){return F===void 0?U:oe(x())}function ne(){var ue=x(),fe=j(ue);if(P=arguments,R=this,V=ue,fe){if(F===void 0)return re(V);if(X)return F=setTimeout(ee,T),Y(V)}return F===void 0&&(F=setTimeout(ee,T)),U}return ne.cancel=Q,ne.flush=ae,ne}function b(D){var T=typeof D;return!!D&&(T=="object"||T=="function")}function w(D){return!!D&&typeof D=="object"}function M(D){return typeof D=="symbol"||w(D)&&d.call(D)==i}function E(D){if(typeof D=="number")return D;if(M(D))return e;if(b(D)){var T=typeof D.valueOf=="function"?D.valueOf():D;D=b(T)?T+"":T}if(typeof D!="string")return D===0?D:+D;D=D.replace(r,"");var L=s.test(D);return L||a.test(D)?o(D.slice(2),L?2:8):n.test(D)?e:+D}return YL=v,YL}var vRe=gRe();const yRe=x3(vRe);function xRe(t){return e=>{t.forEach(i=>{typeof i=="function"?i(e):i!=null&&(i.current=e)})}}const bRe=[],_Re={width:"100%",height:"100%"},SRe=Me.forwardRef(function({className:t,children:e,debounceTime:i=300,ignoreDimensions:r=bRe,parentSizeStyles:n,enableDebounceLeadingCall:s=!0,resizeObserverPolyfill:a,...o},l){const c=Me.useRef(null),u=Me.useRef(0),[h,d]=Me.useState({width:0,height:0,top:0,left:0}),p=Me.useMemo(()=>{const g=Array.isArray(r)?r:[r];return yRe(x=>{d(v=>Object.keys(v).filter(b=>v[b]!==x[b]).every(b=>g.includes(b))?v:x)},i,{leading:s})},[i,s,r]);return Me.useEffect(()=>{const g=a||window.ResizeObserver,x=new g(v=>{v.forEach(b=>{const{left:w,top:M,width:E,height:D}=(b==null?void 0:b.contentRect)??{};u.current=window.requestAnimationFrame(()=>{p({width:E,height:D,top:M,left:w})})})});return c.current&&x.observe(c.current),()=>{window.cancelAnimationFrame(u.current),x.disconnect(),p.cancel()}},[p,a]),Pe.jsx("div",{style:{..._Re,...n},ref:xRe([l,c]),className:t,...o,children:e({...h,ref:c.current,resize:p})})}),wRe=Me.forwardRef(({scene:t,style:e,onSplineMouseDown:i,onSplineMouseUp:r,onSplineMouseHover:n,onSplineKeyDown:s,onSplineKeyUp:a,onSplineStart:o,onSplineLookAt:l,onSplineFollow:c,onSplineScroll:u,onLoad:h,renderOnDemand:d=!0,children:p,...g},x)=>{const v=Me.useRef(null),[b,w]=Me.useState(!0),[M,E]=Me.useState();if(M)throw M;return Me.useEffect(()=>{w(!0);let D;const T=[{name:"mouseDown",cb:i},{name:"mouseUp",cb:r},{name:"mouseHover",cb:n},{name:"keyDown",cb:s},{name:"keyUp",cb:a},{name:"start",cb:o},{name:"lookAt",cb:l},{name:"follow",cb:c},{name:"scroll",cb:u}];if(v.current){D=new mRe(v.current,{renderOnDemand:d});async function L(){await D.load(t);for(let P of T)P.cb&&D.addEventListener(P.name,P.cb);w(!1),h==null||h(D)}L().catch(P=>{E(P)})}return()=>{for(let L of T)L.cb&&D.removeEventListener(L.name,L.cb);D.dispose()}},[t]),Pe.jsx(SRe,{ref:x,parentSizeStyles:{overflow:"hidden",...e},debounceTime:50,...g,children:()=>Pe.jsxs(Pe.Fragment,{children:[b&&p,Pe.jsx("canvas",{ref:v,style:{display:b?"none":"block"}})]})})});function iK(){return Pe.jsx("div",{style:{height:"100vh"},children:Pe.jsx(wRe,{scene:"https://prod.spline.design/Z8XuY8Nf4msNsbHi/scene.splinecode"})})}function MRe(){const[t,e]=Me.useState(""),i=iN(),r=n=>{n.preventDefault(),t.trim()&&i(`/search?q=${encodeURIComponent(t)}`)};return Pe.jsxs("div",{className:"flex h-screen w-full overflow-hidden",children:[Pe.jsxs("div",{className:"w-1/2 bg-[#CACACA] flex flex-col items-center justify-center px-8",children:[Pe.jsx("h1",{className:"text-5xl md:text-6xl font-bold text-black mb-6",children:"CourseFinder"}),Pe.jsxs("div",{className:"w-full max-w-xl mb-8",children:[Pe.jsx("p",{className:"text-xl md:text-2xl text-black mb-8 text-center",children:"Find classes easily with natural language"}),Pe.jsxs("form",{onSubmit:r,className:"flex w-full",children:[Pe.jsx(w7,{type:"text",placeholder:"Search for classes",className:"flex-grow bg-white/90 text-black text-lg placeholder:text-gray-500 rounded-l-lg rounded-r-none border-0 p-3 ",value:t,onChange:n=>e(n.target.value)}),Pe.jsx(w3,{type:"submit",className:"bg-black hover:bg-gray-700 text-white rounded-l-none rounded-r-lg px-6 text-lg cursor-pointer",children:"Search"})]})]})]}),Pe.jsxs("div",{className:"w-1/2 relative",children:[Pe.jsx("div",{className:"w-full h-full",children:Pe.jsx(iK,{})}),Pe.jsx("div",{className:"absolute right-0 top-0 w-1/3 h-full",children:Pe.jsx(Y7,{})})]})]})}function VS({initialQuery:t=""}){const[e,i]=Me.useState(t),r=iN();Me.useEffect(()=>{i(t)},[t]);const n=s=>{s.preventDefault(),e.trim()&&r(`/search?q=${encodeURIComponent(e)}`)};return Pe.jsx("div",{className:"bg-white shadow-sm p-4 sticky top-0 z-10",children:Pe.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[Pe.jsx(S3,{to:"/",className:"text-2xl font-bold",children:"CourseFinder"}),Pe.jsxs("form",{onSubmit:n,className:"flex w-full max-w-xl",children:[Pe.jsx(w7,{type:"text",placeholder:"Search for classes",className:"rounded-r-none",value:e,onChange:s=>i(s.target.value)}),Pe.jsx(w3,{type:"submit",className:"rounded-l-none",children:"Search"})]})]})})}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const rP="174",cC={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},ERe={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},rK=0,EB=1,nK=2,ARe=3,sK=0,nP=1,ow=2,sh=3,Op=0,ll=1,ch=2,wp=0,E0=1,AB=2,TB=3,CB=4,aK=5,tg=100,oK=101,lK=102,cK=103,uK=104,hK=200,dK=201,fK=202,pK=203,TD=204,CD=205,mK=206,gK=207,vK=208,yK=209,xK=210,bK=211,_K=212,SK=213,wK=214,DD=0,PD=1,RD=2,k0=3,OD=4,LD=5,ID=6,zD=7,zM=0,MK=1,EK=2,Fd=0,AK=1,TK=2,CK=3,K4=4,DK=5,PK=6,RK=7,DB="attached",OK="detached",sP=300,Lp=301,Eg=302,qw=303,Xw=304,wb=306,Yw=1e3,tu=1001,Qw=1002,no=1003,J4=1004,TRe=1004,a1=1005,CRe=1005,Cs=1006,lw=1007,DRe=1007,Id=1008,PRe=1008,bh=1009,$4=1010,eF=1011,W1=1012,aP=1013,Ip=1014,jl=1015,Mb=1016,oP=1017,lP=1018,V0=1020,tF=35902,iF=1021,rF=1022,Lo=1023,nF=1024,sF=1025,A0=1026,H0=1027,cP=1028,UM=1029,aF=1030,uP=1031,RRe=1032,hP=1033,cw=33776,uw=33777,hw=33778,dw=33779,UD=35840,BD=35841,ND=35842,FD=35843,kD=36196,VD=37492,HD=37496,GD=37808,jD=37809,WD=37810,qD=37811,XD=37812,YD=37813,QD=37814,ZD=37815,KD=37816,JD=37817,$D=37818,e3=37819,t3=37820,i3=37821,fw=36492,r3=36494,n3=36495,oF=36283,s3=36284,a3=36285,o3=36286,LK=2200,IK=2201,zK=2202,Zw=2300,l3=2301,uC=2302,p0=2400,m0=2401,Kw=2402,dP=2500,lF=2501,ORe=0,LRe=1,IRe=2,UK=3200,cF=3201,zRe=3202,URe=3203,Lg=0,BK=1,hp="",Co="srgb",Ag="srgb-linear",Jw="linear",tn="srgb",BRe=0,Qv=7680,NRe=7681,FRe=7682,kRe=7683,VRe=34055,HRe=34056,GRe=5386,jRe=512,WRe=513,qRe=514,XRe=515,YRe=516,QRe=517,ZRe=518,PB=519,NK=512,FK=513,kK=514,uF=515,VK=516,HK=517,GK=518,jK=519,$w=35044,KRe=35048,JRe=35040,$Re=35045,eOe=35049,tOe=35041,iOe=35046,rOe=35050,nOe=35042,sOe="100",RB="300 es",fh=2e3,eM=2001,aOe={COMPUTE:"compute",RENDER:"render"};let rf=class{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(i)===-1&&r[e].push(i)}hasEventListener(e,i){const r=this._listeners;return r===void 0?!1:r[e]!==void 0&&r[e].indexOf(i)!==-1}removeEventListener(e,i){const r=this._listeners;if(r===void 0)return;const n=r[e];if(n!==void 0){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}}dispatchEvent(e){const i=this._listeners;if(i===void 0)return;const r=i[e.type];if(r!==void 0){e.target=this;const n=r.slice(0);for(let s=0,a=n.length;s<a;s++)n[s].call(this,e);e.target=null}}};const Eo=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let w8=1234567;const T0=Math.PI/180,q1=180/Math.PI;function xc(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Eo[t&255]+Eo[t>>8&255]+Eo[t>>16&255]+Eo[t>>24&255]+"-"+Eo[e&255]+Eo[e>>8&255]+"-"+Eo[e>>16&15|64]+Eo[e>>24&255]+"-"+Eo[i&63|128]+Eo[i>>8&255]+"-"+Eo[i>>16&255]+Eo[i>>24&255]+Eo[r&255]+Eo[r>>8&255]+Eo[r>>16&255]+Eo[r>>24&255]).toLowerCase()}function Qi(t,e,i){return Math.max(e,Math.min(i,t))}function hF(t,e){return(t%e+e)%e}function oOe(t,e,i,r,n){return r+(t-e)*(n-r)/(i-e)}function lOe(t,e,i){return t!==e?(i-t)/(e-t):0}function pw(t,e,i){return(1-i)*t+i*e}function cOe(t,e,i,r){return pw(t,e,1-Math.exp(-i*r))}function uOe(t,e=1){return e-Math.abs(hF(t,e*2)-e)}function hOe(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*(3-2*t))}function dOe(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*t*(t*(t*6-15)+10))}function fOe(t,e){return t+Math.floor(Math.random()*(e-t+1))}function pOe(t,e){return t+Math.random()*(e-t)}function mOe(t){return t*(.5-Math.random())}function gOe(t){t!==void 0&&(w8=t);let e=w8+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function vOe(t){return t*T0}function yOe(t){return t*q1}function xOe(t){return(t&t-1)===0&&t!==0}function bOe(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function _Oe(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function SOe(t,e,i,r,n){const s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((e+r)/2),u=a((e+r)/2),h=s((e-r)/2),d=a((e-r)/2),p=s((r-e)/2),g=a((r-e)/2);switch(n){case"XYX":t.set(o*u,l*h,l*d,o*c);break;case"YZY":t.set(l*d,o*u,l*h,o*c);break;case"ZXZ":t.set(l*h,l*d,o*u,o*c);break;case"XZX":t.set(o*u,l*g,l*p,o*c);break;case"YXY":t.set(l*p,o*u,l*g,o*c);break;case"ZYZ":t.set(l*g,l*p,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function sl(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function $i(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const wOe={DEG2RAD:T0,RAD2DEG:q1,generateUUID:xc,clamp:Qi,euclideanModulo:hF,mapLinear:oOe,inverseLerp:lOe,lerp:pw,damp:cOe,pingpong:uOe,smoothstep:hOe,smootherstep:dOe,randInt:fOe,randFloat:pOe,randFloatSpread:mOe,seededRandom:gOe,degToRad:vOe,radToDeg:yOe,isPowerOfTwo:xOe,ceilPowerOfTwo:bOe,floorPowerOfTwo:_Oe,setQuaternionFromProperEuler:SOe,normalize:$i,denormalize:sl};class Tt{constructor(e=0,i=0){Tt.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,r=this.y,n=e.elements;return this.x=n[0]*i+n[3]*r+n[6],this.y=n[1]*i+n[4]*r+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Qi(this.x,e.x,i.x),this.y=Qi(this.y,e.y,i.y),this}clampScalar(e,i){return this.x=Qi(this.x,e,i),this.y=Qi(this.y,e,i),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Qi(r,e,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(e)/i;return Math.acos(Qi(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,r=this.y-e.y;return i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const r=Math.cos(i),n=Math.sin(i),s=this.x-e.x,a=this.y-e.y;return this.x=s*r-a*n+e.x,this.y=s*n+a*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Yi{constructor(e,i,r,n,s,a,o,l,c){Yi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,r,n,s,a,o,l,c)}set(e,i,r,n,s,a,o,l,c){const u=this.elements;return u[0]=e,u[1]=n,u[2]=o,u[3]=i,u[4]=s,u[5]=l,u[6]=r,u[7]=a,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],this}extractBasis(e,i,r){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const r=e.elements,n=i.elements,s=this.elements,a=r[0],o=r[3],l=r[6],c=r[1],u=r[4],h=r[7],d=r[2],p=r[5],g=r[8],x=n[0],v=n[3],b=n[6],w=n[1],M=n[4],E=n[7],D=n[2],T=n[5],L=n[8];return s[0]=a*x+o*w+l*D,s[3]=a*v+o*M+l*T,s[6]=a*b+o*E+l*L,s[1]=c*x+u*w+h*D,s[4]=c*v+u*M+h*T,s[7]=c*b+u*E+h*L,s[2]=d*x+p*w+g*D,s[5]=d*v+p*M+g*T,s[8]=d*b+p*E+g*L,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8];return i*a*u-i*o*c-r*s*u+r*o*l+n*s*c-n*a*l}invert(){const e=this.elements,i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=u*a-o*c,d=o*l-u*s,p=c*s-a*l,g=i*h+r*d+n*p;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const x=1/g;return e[0]=h*x,e[1]=(n*c-u*r)*x,e[2]=(o*r-n*a)*x,e[3]=d*x,e[4]=(u*i-n*l)*x,e[5]=(n*s-o*i)*x,e[6]=p*x,e[7]=(r*l-c*i)*x,e[8]=(a*i-r*s)*x,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,r,n,s,a,o){const l=Math.cos(s),c=Math.sin(s);return this.set(r*l,r*c,-r*(l*a+c*o)+a+e,-n*c,n*l,-n*(-c*a+l*o)+o+i,0,0,1),this}scale(e,i){return this.premultiply(QL.makeScale(e,i)),this}rotate(e){return this.premultiply(QL.makeRotation(-e)),this}translate(e,i){return this.premultiply(QL.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,-r,0,r,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,r=e.elements;for(let n=0;n<9;n++)if(i[n]!==r[n])return!1;return!0}fromArray(e,i=0){for(let r=0;r<9;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){const r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const QL=new Yi;function WK(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const MOe={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function o1(t,e){return new MOe[t](e)}function tM(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function qK(){const t=tM("canvas");return t.style.display="block",t}const M8={};function Zv(t){t in M8||(M8[t]=!0,console.warn(t))}function EOe(t,e,i){return new Promise(function(r,n){function s(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:n();break;case t.TIMEOUT_EXPIRED:setTimeout(s,i);break;default:r()}}setTimeout(s,i)})}function AOe(t){const e=t.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function TOe(t){const e=t.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const E8=new Yi().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),A8=new Yi().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function COe(){const t={enabled:!0,workingColorSpace:Ag,spaces:{},convert:function(n,s,a){return this.enabled===!1||s===a||!s||!a||(this.spaces[s].transfer===tn&&(n.r=Mp(n.r),n.g=Mp(n.g),n.b=Mp(n.b)),this.spaces[s].primaries!==this.spaces[a].primaries&&(n.applyMatrix3(this.spaces[s].toXYZ),n.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===tn&&(n.r=A1(n.r),n.g=A1(n.g),n.b=A1(n.b))),n},fromWorkingColorSpace:function(n,s){return this.convert(n,this.workingColorSpace,s)},toWorkingColorSpace:function(n,s){return this.convert(n,s,this.workingColorSpace)},getPrimaries:function(n){return this.spaces[n].primaries},getTransfer:function(n){return n===hp?Jw:this.spaces[n].transfer},getLuminanceCoefficients:function(n,s=this.workingColorSpace){return n.fromArray(this.spaces[s].luminanceCoefficients)},define:function(n){Object.assign(this.spaces,n)},_getMatrix:function(n,s,a){return n.copy(this.spaces[s].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(n){return this.spaces[n].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(n=this.workingColorSpace){return this.spaces[n].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],i=[.2126,.7152,.0722],r=[.3127,.329];return t.define({[Ag]:{primaries:e,whitePoint:r,transfer:Jw,toXYZ:E8,fromXYZ:A8,luminanceCoefficients:i,workingColorSpaceConfig:{unpackColorSpace:Co},outputColorSpaceConfig:{drawingBufferColorSpace:Co}},[Co]:{primaries:e,whitePoint:r,transfer:tn,toXYZ:E8,fromXYZ:A8,luminanceCoefficients:i,outputColorSpaceConfig:{drawingBufferColorSpace:Co}}}),t}const Er=COe();function Mp(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function A1(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}let wx;class XK{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{wx===void 0&&(wx=tM("canvas")),wx.width=e.width,wx.height=e.height;const r=wx.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),i=wx}return i.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=tM("canvas");i.width=e.width,i.height=e.height;const r=i.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const n=r.getImageData(0,0,e.width,e.height),s=n.data;for(let a=0;a<s.length;a++)s[a]=Mp(s[a]/255)*255;return r.putImageData(n,0,0),i}else if(e.data){const i=e.data.slice(0);for(let r=0;r<i.length;r++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[r]=Math.floor(Mp(i[r]/255)*255):i[r]=Mp(i[r]);return{data:i,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let DOe=0;class fg{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:DOe++}),this.uuid=xc(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let a=0,o=n.length;a<o;a++)n[a].isDataTexture?s.push(ZL(n[a].image)):s.push(ZL(n[a]))}else s=ZL(n);r.url=s}return i||(e.images[this.uuid]=r),r}}function ZL(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?XK.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let POe=0;class ss extends rf{constructor(e=ss.DEFAULT_IMAGE,i=ss.DEFAULT_MAPPING,r=tu,n=tu,s=Cs,a=Id,o=Lo,l=bh,c=ss.DEFAULT_ANISOTROPY,u=hp){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:POe++}),this.uuid=xc(),this.name="",this.source=new fg(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=r,this.wrapT=n,this.magFilter=s,this.minFilter=a,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new Tt(0,0),this.repeat=new Tt(1,1),this.center=new Tt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Yi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==sP)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Yw:e.x=e.x-Math.floor(e.x);break;case tu:e.x=e.x<0?0:1;break;case Qw:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Yw:e.y=e.y-Math.floor(e.y);break;case tu:e.y=e.y<0?0:1;break;case Qw:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}ss.DEFAULT_IMAGE=null;ss.DEFAULT_MAPPING=sP;ss.DEFAULT_ANISOTROPY=1;class Ar{constructor(e=0,i=0,r=0,n=1){Ar.prototype.isVector4=!0,this.x=e,this.y=i,this.z=r,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,r,n){return this.x=e,this.y=i,this.z=r,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,r=this.y,n=this.z,s=this.w,a=e.elements;return this.x=a[0]*i+a[4]*r+a[8]*n+a[12]*s,this.y=a[1]*i+a[5]*r+a[9]*n+a[13]*s,this.z=a[2]*i+a[6]*r+a[10]*n+a[14]*s,this.w=a[3]*i+a[7]*r+a[11]*n+a[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,r,n,s;const l=e.elements,c=l[0],u=l[4],h=l[8],d=l[1],p=l[5],g=l[9],x=l[2],v=l[6],b=l[10];if(Math.abs(u-d)<.01&&Math.abs(h-x)<.01&&Math.abs(g-v)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+x)<.1&&Math.abs(g+v)<.1&&Math.abs(c+p+b-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const M=(c+1)/2,E=(p+1)/2,D=(b+1)/2,T=(u+d)/4,L=(h+x)/4,P=(g+v)/4;return M>E&&M>D?M<.01?(r=0,n=.707106781,s=.707106781):(r=Math.sqrt(M),n=T/r,s=L/r):E>D?E<.01?(r=.707106781,n=0,s=.707106781):(n=Math.sqrt(E),r=T/n,s=P/n):D<.01?(r=.707106781,n=.707106781,s=0):(s=Math.sqrt(D),r=L/s,n=P/s),this.set(r,n,s,i),this}let w=Math.sqrt((v-g)*(v-g)+(h-x)*(h-x)+(d-u)*(d-u));return Math.abs(w)<.001&&(w=1),this.x=(v-g)/w,this.y=(h-x)/w,this.z=(d-u)/w,this.w=Math.acos((c+p+b-1)/2),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Qi(this.x,e.x,i.x),this.y=Qi(this.y,e.y,i.y),this.z=Qi(this.z,e.z,i.z),this.w=Qi(this.w,e.w,i.w),this}clampScalar(e,i){return this.x=Qi(this.x,e,i),this.y=Qi(this.y,e,i),this.z=Qi(this.z,e,i),this.w=Qi(this.w,e,i),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Qi(r,e,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this.w=e.w+(i.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class fP extends rf{constructor(e=1,i=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=i,this.depth=1,this.scissor=new Ar(0,0,e,i),this.scissorTest=!1,this.viewport=new Ar(0,0,e,i);const n={width:e,height:i,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Cs,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},r);const s=new ss(n,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);s.flipY=!1,s.generateMipmaps=r.generateMipmaps,s.internalFormat=r.internalFormat,this.textures=[];const a=r.count;for(let o=0;o<a;o++)this.textures[o]=s.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,i,r=1){if(this.width!==e||this.height!==i||this.depth!==r){this.width=e,this.height=i,this.depth=r;for(let n=0,s=this.textures.length;n<s;n++)this.textures[n].image.width=e,this.textures[n].image.height=i,this.textures[n].image.depth=r;this.dispose()}this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,r=e.textures.length;i<r;i++){this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0,this.textures[i].renderTarget=this;const n=Object.assign({},e.textures[i].image);this.textures[i].source=new fg(n)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Yd extends fP{constructor(e=1,i=1,r={}){super(e,i,r),this.isWebGLRenderTarget=!0}}class BM extends ss{constructor(e=null,i=1,r=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:i,height:r,depth:n},this.magFilter=no,this.minFilter=no,this.wrapR=tu,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class ROe extends Yd{constructor(e=1,i=1,r=1,n={}){super(e,i,n),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new BM(null,e,i,r),this.texture.isRenderTargetTexture=!0}}class pP extends ss{constructor(e=null,i=1,r=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:i,height:r,depth:n},this.magFilter=no,this.minFilter=no,this.wrapR=tu,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class OOe extends Yd{constructor(e=1,i=1,r=1,n={}){super(e,i,n),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new pP(null,e,i,r),this.texture.isRenderTargetTexture=!0}}class so{constructor(e=0,i=0,r=0,n=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=r,this._w=n}static slerpFlat(e,i,r,n,s,a,o){let l=r[n+0],c=r[n+1],u=r[n+2],h=r[n+3];const d=s[a+0],p=s[a+1],g=s[a+2],x=s[a+3];if(o===0){e[i+0]=l,e[i+1]=c,e[i+2]=u,e[i+3]=h;return}if(o===1){e[i+0]=d,e[i+1]=p,e[i+2]=g,e[i+3]=x;return}if(h!==x||l!==d||c!==p||u!==g){let v=1-o;const b=l*d+c*p+u*g+h*x,w=b>=0?1:-1,M=1-b*b;if(M>Number.EPSILON){const D=Math.sqrt(M),T=Math.atan2(D,b*w);v=Math.sin(v*T)/D,o=Math.sin(o*T)/D}const E=o*w;if(l=l*v+d*E,c=c*v+p*E,u=u*v+g*E,h=h*v+x*E,v===1-o){const D=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=D,c*=D,u*=D,h*=D}}e[i]=l,e[i+1]=c,e[i+2]=u,e[i+3]=h}static multiplyQuaternionsFlat(e,i,r,n,s,a){const o=r[n],l=r[n+1],c=r[n+2],u=r[n+3],h=s[a],d=s[a+1],p=s[a+2],g=s[a+3];return e[i]=o*g+u*h+l*p-c*d,e[i+1]=l*g+u*d+c*h-o*p,e[i+2]=c*g+u*p+o*d-l*h,e[i+3]=u*g-o*h-l*d-c*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,r,n){return this._x=e,this._y=i,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i=!0){const r=e._x,n=e._y,s=e._z,a=e._order,o=Math.cos,l=Math.sin,c=o(r/2),u=o(n/2),h=o(s/2),d=l(r/2),p=l(n/2),g=l(s/2);switch(a){case"XYZ":this._x=d*u*h+c*p*g,this._y=c*p*h-d*u*g,this._z=c*u*g+d*p*h,this._w=c*u*h-d*p*g;break;case"YXZ":this._x=d*u*h+c*p*g,this._y=c*p*h-d*u*g,this._z=c*u*g-d*p*h,this._w=c*u*h+d*p*g;break;case"ZXY":this._x=d*u*h-c*p*g,this._y=c*p*h+d*u*g,this._z=c*u*g+d*p*h,this._w=c*u*h-d*p*g;break;case"ZYX":this._x=d*u*h-c*p*g,this._y=c*p*h+d*u*g,this._z=c*u*g-d*p*h,this._w=c*u*h+d*p*g;break;case"YZX":this._x=d*u*h+c*p*g,this._y=c*p*h+d*u*g,this._z=c*u*g-d*p*h,this._w=c*u*h-d*p*g;break;case"XZY":this._x=d*u*h-c*p*g,this._y=c*p*h-d*u*g,this._z=c*u*g+d*p*h,this._w=c*u*h+d*p*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return i===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,i){const r=i/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const i=e.elements,r=i[0],n=i[4],s=i[8],a=i[1],o=i[5],l=i[9],c=i[2],u=i[6],h=i[10],d=r+o+h;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(u-l)*p,this._y=(s-c)*p,this._z=(a-n)*p}else if(r>o&&r>h){const p=2*Math.sqrt(1+r-o-h);this._w=(u-l)/p,this._x=.25*p,this._y=(n+a)/p,this._z=(s+c)/p}else if(o>h){const p=2*Math.sqrt(1+o-r-h);this._w=(s-c)/p,this._x=(n+a)/p,this._y=.25*p,this._z=(l+u)/p}else{const p=2*Math.sqrt(1+h-r-o);this._w=(a-n)/p,this._x=(s+c)/p,this._y=(l+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let r=e.dot(i)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Qi(this.dot(e),-1,1)))}rotateTowards(e,i){const r=this.angleTo(e);if(r===0)return this;const n=Math.min(1,i/r);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){const r=e._x,n=e._y,s=e._z,a=e._w,o=i._x,l=i._y,c=i._z,u=i._w;return this._x=r*u+a*o+n*c-s*l,this._y=n*u+a*l+s*o-r*c,this._z=s*u+a*c+r*l-n*o,this._w=a*u-r*o-n*l-s*c,this._onChangeCallback(),this}slerp(e,i){if(i===0)return this;if(i===1)return this.copy(e);const r=this._x,n=this._y,s=this._z,a=this._w;let o=a*e._w+r*e._x+n*e._y+s*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=r,this._y=n,this._z=s,this;const l=1-o*o;if(l<=Number.EPSILON){const p=1-i;return this._w=p*a+i*this._w,this._x=p*r+i*this._x,this._y=p*n+i*this._y,this._z=p*s+i*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,o),h=Math.sin((1-i)*u)/c,d=Math.sin(i*u)/c;return this._w=a*h+this._w*d,this._x=r*h+this._x*d,this._y=n*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,i,r){return this.copy(e).slerp(i,r)}random(){const e=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),r=Math.random(),n=Math.sqrt(1-r),s=Math.sqrt(r);return this.set(n*Math.sin(e),n*Math.cos(e),s*Math.sin(i),s*Math.cos(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Se{constructor(e=0,i=0,r=0){Se.prototype.isVector3=!0,this.x=e,this.y=i,this.z=r}set(e,i,r){return r===void 0&&(r=this.z),this.x=e,this.y=i,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(T8.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(T8.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,r=this.y,n=this.z,s=e.elements;return this.x=s[0]*i+s[3]*r+s[6]*n,this.y=s[1]*i+s[4]*r+s[7]*n,this.z=s[2]*i+s[5]*r+s[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,r=this.y,n=this.z,s=e.elements,a=1/(s[3]*i+s[7]*r+s[11]*n+s[15]);return this.x=(s[0]*i+s[4]*r+s[8]*n+s[12])*a,this.y=(s[1]*i+s[5]*r+s[9]*n+s[13])*a,this.z=(s[2]*i+s[6]*r+s[10]*n+s[14])*a,this}applyQuaternion(e){const i=this.x,r=this.y,n=this.z,s=e.x,a=e.y,o=e.z,l=e.w,c=2*(a*n-o*r),u=2*(o*i-s*n),h=2*(s*r-a*i);return this.x=i+l*c+a*h-o*u,this.y=r+l*u+o*c-s*h,this.z=n+l*h+s*u-a*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,r=this.y,n=this.z,s=e.elements;return this.x=s[0]*i+s[4]*r+s[8]*n,this.y=s[1]*i+s[5]*r+s[9]*n,this.z=s[2]*i+s[6]*r+s[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Qi(this.x,e.x,i.x),this.y=Qi(this.y,e.y,i.y),this.z=Qi(this.z,e.z,i.z),this}clampScalar(e,i){return this.x=Qi(this.x,e,i),this.y=Qi(this.y,e,i),this.z=Qi(this.z,e,i),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Qi(r,e,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const r=e.x,n=e.y,s=e.z,a=i.x,o=i.y,l=i.z;return this.x=n*l-s*o,this.y=s*a-r*l,this.z=r*o-n*a,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const r=e.dot(this)/i;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return KL.copy(this).projectOnVector(e),this.sub(KL)}reflect(e){return this.sub(KL.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(e)/i;return Math.acos(Qi(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return i*i+r*r+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,r){const n=Math.sin(i)*e;return this.x=n*Math.sin(r),this.y=Math.cos(i)*e,this.z=n*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,r){return this.x=e*Math.sin(i),this.y=r,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=r,this.z=n,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,r=Math.sqrt(1-i*i);return this.x=r*Math.cos(e),this.y=i,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const KL=new Se,T8=new so;class ao{constructor(e=new Se(1/0,1/0,1/0),i=new Se(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i+=3)this.expandByPoint(ih.fromArray(e,i));return this}setFromBufferAttribute(e){this.makeEmpty();for(let i=0,r=e.count;i<r;i++)this.expandByPoint(ih.fromBufferAttribute(e,i));return this}setFromPoints(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const r=ih.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const s=r.getAttribute("position");if(i===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let a=0,o=s.count;a<o;a++)e.isMesh===!0?e.getVertexPosition(a,ih):ih.fromBufferAttribute(s,a),ih.applyMatrix4(e.matrixWorld),this.expandByPoint(ih);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),H2.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),H2.copy(r.boundingBox)),H2.applyMatrix4(e.matrixWorld),this.union(H2)}const n=e.children;for(let s=0,a=n.length;s<a;s++)this.expandByObject(n[s],i);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,ih),ih.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,r;return e.normal.x>0?(i=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),i<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(vS),G2.subVectors(this.max,vS),Mx.subVectors(e.a,vS),Ex.subVectors(e.b,vS),Ax.subVectors(e.c,vS),Nm.subVectors(Ex,Mx),Fm.subVectors(Ax,Ex),Rv.subVectors(Mx,Ax);let i=[0,-Nm.z,Nm.y,0,-Fm.z,Fm.y,0,-Rv.z,Rv.y,Nm.z,0,-Nm.x,Fm.z,0,-Fm.x,Rv.z,0,-Rv.x,-Nm.y,Nm.x,0,-Fm.y,Fm.x,0,-Rv.y,Rv.x,0];return!JL(i,Mx,Ex,Ax,G2)||(i=[1,0,0,0,1,0,0,0,1],!JL(i,Mx,Ex,Ax,G2))?!1:(j2.crossVectors(Nm,Fm),i=[j2.x,j2.y,j2.z],JL(i,Mx,Ex,Ax,G2))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,ih).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(ih).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Xf[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Xf[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Xf[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Xf[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Xf[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Xf[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Xf[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Xf[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Xf),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Xf=[new Se,new Se,new Se,new Se,new Se,new Se,new Se,new Se],ih=new Se,H2=new ao,Mx=new Se,Ex=new Se,Ax=new Se,Nm=new Se,Fm=new Se,Rv=new Se,vS=new Se,G2=new Se,j2=new Se,Ov=new Se;function JL(t,e,i,r,n){for(let s=0,a=t.length-3;s<=a;s+=3){Ov.fromArray(t,s);const o=n.x*Math.abs(Ov.x)+n.y*Math.abs(Ov.y)+n.z*Math.abs(Ov.z),l=e.dot(Ov),c=i.dot(Ov),u=r.dot(Ov);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}const LOe=new ao,yS=new Se,$L=new Se;class oo{constructor(e=new Se,i=-1){this.isSphere=!0,this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){const r=this.center;i!==void 0?r.copy(i):LOe.setFromPoints(e).getCenter(r);let n=0;for(let s=0,a=e.length;s<a;s++)n=Math.max(n,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){const r=this.center.distanceToSquared(e);return i.copy(e),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;yS.subVectors(e,this.center);const i=yS.lengthSq();if(i>this.radius*this.radius){const r=Math.sqrt(i),n=(r-this.radius)*.5;this.center.addScaledVector(yS,n/r),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):($L.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(yS.copy(e.center).add($L)),this.expandByPoint(yS.copy(e.center).sub($L))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Yf=new Se,eI=new Se,W2=new Se,km=new Se,tI=new Se,q2=new Se,iI=new Se;class Eb{constructor(e=new Se,i=new Se(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Yf)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);const r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const i=Yf.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(Yf.copy(this.origin).addScaledVector(this.direction,i),Yf.distanceToSquared(e))}distanceSqToSegment(e,i,r,n){eI.copy(e).add(i).multiplyScalar(.5),W2.copy(i).sub(e).normalize(),km.copy(this.origin).sub(eI);const s=e.distanceTo(i)*.5,a=-this.direction.dot(W2),o=km.dot(this.direction),l=-km.dot(W2),c=km.lengthSq(),u=Math.abs(1-a*a);let h,d,p,g;if(u>0)if(h=a*l-o,d=a*o-l,g=s*u,h>=0)if(d>=-g)if(d<=g){const x=1/u;h*=x,d*=x,p=h*(h+a*d+2*o)+d*(a*h+d+2*l)+c}else d=s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+c;else d=-s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+c;else d<=-g?(h=Math.max(0,-(-a*s+o)),d=h>0?-s:Math.min(Math.max(-s,-l),s),p=-h*h+d*(d+2*l)+c):d<=g?(h=0,d=Math.min(Math.max(-s,-l),s),p=d*(d+2*l)+c):(h=Math.max(0,-(a*s+o)),d=h>0?s:Math.min(Math.max(-s,-l),s),p=-h*h+d*(d+2*l)+c);else d=a>0?-s:s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+c;return r&&r.copy(this.origin).addScaledVector(this.direction,h),n&&n.copy(eI).addScaledVector(W2,d),p}intersectSphere(e,i){Yf.subVectors(e.center,this.origin);const r=Yf.dot(this.direction),n=Yf.dot(Yf)-r*r,s=e.radius*e.radius;if(n>s)return null;const a=Math.sqrt(s-n),o=r-a,l=r+a;return l<0?null:o<0?this.at(l,i):this.at(o,i)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const i=e.normal.dot(this.direction);if(i===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/i;return r>=0?r:null}intersectPlane(e,i){const r=this.distanceToPlane(e);return r===null?null:this.at(r,i)}intersectsPlane(e){const i=e.distanceToPoint(this.origin);return i===0||e.normal.dot(this.direction)*i<0}intersectBox(e,i){let r,n,s,a,o,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return c>=0?(r=(e.min.x-d.x)*c,n=(e.max.x-d.x)*c):(r=(e.max.x-d.x)*c,n=(e.min.x-d.x)*c),u>=0?(s=(e.min.y-d.y)*u,a=(e.max.y-d.y)*u):(s=(e.max.y-d.y)*u,a=(e.min.y-d.y)*u),r>a||s>n||((s>r||isNaN(r))&&(r=s),(a<n||isNaN(n))&&(n=a),h>=0?(o=(e.min.z-d.z)*h,l=(e.max.z-d.z)*h):(o=(e.max.z-d.z)*h,l=(e.min.z-d.z)*h),r>l||o>n)||((o>r||r!==r)&&(r=o),(l<n||n!==n)&&(n=l),n<0)?null:this.at(r>=0?r:n,i)}intersectsBox(e){return this.intersectBox(e,Yf)!==null}intersectTriangle(e,i,r,n,s){tI.subVectors(i,e),q2.subVectors(r,e),iI.crossVectors(tI,q2);let a=this.direction.dot(iI),o;if(a>0){if(n)return null;o=1}else if(a<0)o=-1,a=-a;else return null;km.subVectors(this.origin,e);const l=o*this.direction.dot(q2.crossVectors(km,q2));if(l<0)return null;const c=o*this.direction.dot(tI.cross(km));if(c<0||l+c>a)return null;const u=-o*km.dot(iI);return u<0?null:this.at(u/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ui{constructor(e,i,r,n,s,a,o,l,c,u,h,d,p,g,x,v){Ui.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,r,n,s,a,o,l,c,u,h,d,p,g,x,v)}set(e,i,r,n,s,a,o,l,c,u,h,d,p,g,x,v){const b=this.elements;return b[0]=e,b[4]=i,b[8]=r,b[12]=n,b[1]=s,b[5]=a,b[9]=o,b[13]=l,b[2]=c,b[6]=u,b[10]=h,b[14]=d,b[3]=p,b[7]=g,b[11]=x,b[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ui().fromArray(this.elements)}copy(e){const i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(e){const i=this.elements,r=e.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,r){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,i,r){return this.set(e.x,i.x,r.x,0,e.y,i.y,r.y,0,e.z,i.z,r.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,r=e.elements,n=1/Tx.setFromMatrixColumn(e,0).length(),s=1/Tx.setFromMatrixColumn(e,1).length(),a=1/Tx.setFromMatrixColumn(e,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[3]=0,i[4]=r[4]*s,i[5]=r[5]*s,i[6]=r[6]*s,i[7]=0,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,r=e.x,n=e.y,s=e.z,a=Math.cos(r),o=Math.sin(r),l=Math.cos(n),c=Math.sin(n),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const d=a*u,p=a*h,g=o*u,x=o*h;i[0]=l*u,i[4]=-l*h,i[8]=c,i[1]=p+g*c,i[5]=d-x*c,i[9]=-o*l,i[2]=x-d*c,i[6]=g+p*c,i[10]=a*l}else if(e.order==="YXZ"){const d=l*u,p=l*h,g=c*u,x=c*h;i[0]=d+x*o,i[4]=g*o-p,i[8]=a*c,i[1]=a*h,i[5]=a*u,i[9]=-o,i[2]=p*o-g,i[6]=x+d*o,i[10]=a*l}else if(e.order==="ZXY"){const d=l*u,p=l*h,g=c*u,x=c*h;i[0]=d-x*o,i[4]=-a*h,i[8]=g+p*o,i[1]=p+g*o,i[5]=a*u,i[9]=x-d*o,i[2]=-a*c,i[6]=o,i[10]=a*l}else if(e.order==="ZYX"){const d=a*u,p=a*h,g=o*u,x=o*h;i[0]=l*u,i[4]=g*c-p,i[8]=d*c+x,i[1]=l*h,i[5]=x*c+d,i[9]=p*c-g,i[2]=-c,i[6]=o*l,i[10]=a*l}else if(e.order==="YZX"){const d=a*l,p=a*c,g=o*l,x=o*c;i[0]=l*u,i[4]=x-d*h,i[8]=g*h+p,i[1]=h,i[5]=a*u,i[9]=-o*u,i[2]=-c*u,i[6]=p*h+g,i[10]=d-x*h}else if(e.order==="XZY"){const d=a*l,p=a*c,g=o*l,x=o*c;i[0]=l*u,i[4]=-h,i[8]=c*u,i[1]=d*h+x,i[5]=a*u,i[9]=p*h-g,i[2]=g*h-p,i[6]=o*u,i[10]=x*h+d}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(IOe,e,zOe)}lookAt(e,i,r){const n=this.elements;return fc.subVectors(e,i),fc.lengthSq()===0&&(fc.z=1),fc.normalize(),Vm.crossVectors(r,fc),Vm.lengthSq()===0&&(Math.abs(r.z)===1?fc.x+=1e-4:fc.z+=1e-4,fc.normalize(),Vm.crossVectors(r,fc)),Vm.normalize(),X2.crossVectors(fc,Vm),n[0]=Vm.x,n[4]=X2.x,n[8]=fc.x,n[1]=Vm.y,n[5]=X2.y,n[9]=fc.y,n[2]=Vm.z,n[6]=X2.z,n[10]=fc.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const r=e.elements,n=i.elements,s=this.elements,a=r[0],o=r[4],l=r[8],c=r[12],u=r[1],h=r[5],d=r[9],p=r[13],g=r[2],x=r[6],v=r[10],b=r[14],w=r[3],M=r[7],E=r[11],D=r[15],T=n[0],L=n[4],P=n[8],R=n[12],O=n[1],U=n[5],F=n[9],V=n[13],k=n[2],K=n[6],X=n[10],$=n[14],Y=n[3],re=n[7],G=n[11],j=n[15];return s[0]=a*T+o*O+l*k+c*Y,s[4]=a*L+o*U+l*K+c*re,s[8]=a*P+o*F+l*X+c*G,s[12]=a*R+o*V+l*$+c*j,s[1]=u*T+h*O+d*k+p*Y,s[5]=u*L+h*U+d*K+p*re,s[9]=u*P+h*F+d*X+p*G,s[13]=u*R+h*V+d*$+p*j,s[2]=g*T+x*O+v*k+b*Y,s[6]=g*L+x*U+v*K+b*re,s[10]=g*P+x*F+v*X+b*G,s[14]=g*R+x*V+v*$+b*j,s[3]=w*T+M*O+E*k+D*Y,s[7]=w*L+M*U+E*K+D*re,s[11]=w*P+M*F+E*X+D*G,s[15]=w*R+M*V+E*$+D*j,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],r=e[4],n=e[8],s=e[12],a=e[1],o=e[5],l=e[9],c=e[13],u=e[2],h=e[6],d=e[10],p=e[14],g=e[3],x=e[7],v=e[11],b=e[15];return g*(+s*l*h-n*c*h-s*o*d+r*c*d+n*o*p-r*l*p)+x*(+i*l*p-i*c*d+s*a*d-n*a*p+n*c*u-s*l*u)+v*(+i*c*h-i*o*p-s*a*h+r*a*p+s*o*u-r*c*u)+b*(-n*o*u-i*l*h+i*o*d+n*a*h-r*a*d+r*l*u)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,r){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=i,n[14]=r),this}invert(){const e=this.elements,i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],g=e[12],x=e[13],v=e[14],b=e[15],w=h*v*c-x*d*c+x*l*p-o*v*p-h*l*b+o*d*b,M=g*d*c-u*v*c-g*l*p+a*v*p+u*l*b-a*d*b,E=u*x*c-g*h*c+g*o*p-a*x*p-u*o*b+a*h*b,D=g*h*l-u*x*l-g*o*d+a*x*d+u*o*v-a*h*v,T=i*w+r*M+n*E+s*D;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const L=1/T;return e[0]=w*L,e[1]=(x*d*s-h*v*s-x*n*p+r*v*p+h*n*b-r*d*b)*L,e[2]=(o*v*s-x*l*s+x*n*c-r*v*c-o*n*b+r*l*b)*L,e[3]=(h*l*s-o*d*s-h*n*c+r*d*c+o*n*p-r*l*p)*L,e[4]=M*L,e[5]=(u*v*s-g*d*s+g*n*p-i*v*p-u*n*b+i*d*b)*L,e[6]=(g*l*s-a*v*s-g*n*c+i*v*c+a*n*b-i*l*b)*L,e[7]=(a*d*s-u*l*s+u*n*c-i*d*c-a*n*p+i*l*p)*L,e[8]=E*L,e[9]=(g*h*s-u*x*s-g*r*p+i*x*p+u*r*b-i*h*b)*L,e[10]=(a*x*s-g*o*s+g*r*c-i*x*c-a*r*b+i*o*b)*L,e[11]=(u*o*s-a*h*s-u*r*c+i*h*c+a*r*p-i*o*p)*L,e[12]=D*L,e[13]=(u*x*n-g*h*n+g*r*d-i*x*d-u*r*v+i*h*v)*L,e[14]=(g*o*n-a*x*n-g*r*l+i*x*l+a*r*v-i*o*v)*L,e[15]=(a*h*n-u*o*n+u*r*l-i*h*l-a*r*d+i*o*d)*L,this}scale(e){const i=this.elements,r=e.x,n=e.y,s=e.z;return i[0]*=r,i[4]*=n,i[8]*=s,i[1]*=r,i[5]*=n,i[9]*=s,i[2]*=r,i[6]*=n,i[10]*=s,i[3]*=r,i[7]*=n,i[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,r,n))}makeTranslation(e,i,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const r=Math.cos(i),n=Math.sin(i),s=1-r,a=e.x,o=e.y,l=e.z,c=s*a,u=s*o;return this.set(c*a+r,c*o-n*l,c*l+n*o,0,c*o+n*l,u*o+r,u*l-n*a,0,c*l-n*o,u*l+n*a,s*l*l+r,0,0,0,0,1),this}makeScale(e,i,r){return this.set(e,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,i,r,n,s,a){return this.set(1,r,s,0,e,1,a,0,i,n,1,0,0,0,0,1),this}compose(e,i,r){const n=this.elements,s=i._x,a=i._y,o=i._z,l=i._w,c=s+s,u=a+a,h=o+o,d=s*c,p=s*u,g=s*h,x=a*u,v=a*h,b=o*h,w=l*c,M=l*u,E=l*h,D=r.x,T=r.y,L=r.z;return n[0]=(1-(x+b))*D,n[1]=(p+E)*D,n[2]=(g-M)*D,n[3]=0,n[4]=(p-E)*T,n[5]=(1-(d+b))*T,n[6]=(v+w)*T,n[7]=0,n[8]=(g+M)*L,n[9]=(v-w)*L,n[10]=(1-(d+x))*L,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,i,r){const n=this.elements;let s=Tx.set(n[0],n[1],n[2]).length();const a=Tx.set(n[4],n[5],n[6]).length(),o=Tx.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),e.x=n[12],e.y=n[13],e.z=n[14],rh.copy(this);const c=1/s,u=1/a,h=1/o;return rh.elements[0]*=c,rh.elements[1]*=c,rh.elements[2]*=c,rh.elements[4]*=u,rh.elements[5]*=u,rh.elements[6]*=u,rh.elements[8]*=h,rh.elements[9]*=h,rh.elements[10]*=h,i.setFromRotationMatrix(rh),r.x=s,r.y=a,r.z=o,this}makePerspective(e,i,r,n,s,a,o=fh){const l=this.elements,c=2*s/(i-e),u=2*s/(r-n),h=(i+e)/(i-e),d=(r+n)/(r-n);let p,g;if(o===fh)p=-(a+s)/(a-s),g=-2*a*s/(a-s);else if(o===eM)p=-a/(a-s),g=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=g,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,i,r,n,s,a,o=fh){const l=this.elements,c=1/(i-e),u=1/(r-n),h=1/(a-s),d=(i+e)*c,p=(r+n)*u;let g,x;if(o===fh)g=(a+s)*h,x=-2*h;else if(o===eM)g=s*h,x=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-p,l[2]=0,l[6]=0,l[10]=x,l[14]=-g,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const i=this.elements,r=e.elements;for(let n=0;n<16;n++)if(i[n]!==r[n])return!1;return!0}fromArray(e,i=0){for(let r=0;r<16;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){const r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e[i+9]=r[9],e[i+10]=r[10],e[i+11]=r[11],e[i+12]=r[12],e[i+13]=r[13],e[i+14]=r[14],e[i+15]=r[15],e}}const Tx=new Se,rh=new Ui,IOe=new Se(0,0,0),zOe=new Se(1,1,1),Vm=new Se,X2=new Se,fc=new Se,C8=new Ui,D8=new so;class Sc{constructor(e=0,i=0,r=0,n=Sc.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=r,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,r,n=this._order){return this._x=e,this._y=i,this._z=r,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,r=!0){const n=e.elements,s=n[0],a=n[4],o=n[8],l=n[1],c=n[5],u=n[9],h=n[2],d=n[6],p=n[10];switch(i){case"XYZ":this._y=Math.asin(Qi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Qi(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Qi(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Qi(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(Qi(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-Qi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,r){return C8.makeRotationFromQuaternion(e),this.setFromRotationMatrix(C8,i,r)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return D8.setFromEuler(this),this.setFromQuaternion(D8,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Sc.DEFAULT_ORDER="XYZ";class X1{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let UOe=0;const P8=new Se,Cx=new so,Qf=new Ui,Y2=new Se,xS=new Se,BOe=new Se,NOe=new so,R8=new Se(1,0,0),O8=new Se(0,1,0),L8=new Se(0,0,1),I8={type:"added"},FOe={type:"removed"},Dx={type:"childadded",child:null},rI={type:"childremoved",child:null};class Ir extends rf{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:UOe++}),this.uuid=xc(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ir.DEFAULT_UP.clone();const e=new Se,i=new Sc,r=new so,n=new Se(1,1,1);function s(){r.setFromEuler(i,!1)}function a(){i.setFromQuaternion(r,void 0,!1)}i._onChange(s),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Ui},normalMatrix:{value:new Yi}}),this.matrix=new Ui,this.matrixWorld=new Ui,this.matrixAutoUpdate=Ir.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ir.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new X1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return Cx.setFromAxisAngle(e,i),this.quaternion.multiply(Cx),this}rotateOnWorldAxis(e,i){return Cx.setFromAxisAngle(e,i),this.quaternion.premultiply(Cx),this}rotateX(e){return this.rotateOnAxis(R8,e)}rotateY(e){return this.rotateOnAxis(O8,e)}rotateZ(e){return this.rotateOnAxis(L8,e)}translateOnAxis(e,i){return P8.copy(e).applyQuaternion(this.quaternion),this.position.add(P8.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(R8,e)}translateY(e){return this.translateOnAxis(O8,e)}translateZ(e){return this.translateOnAxis(L8,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Qf.copy(this.matrixWorld).invert())}lookAt(e,i,r){e.isVector3?Y2.copy(e):Y2.set(e,i,r);const n=this.parent;this.updateWorldMatrix(!0,!1),xS.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Qf.lookAt(xS,Y2,this.up):Qf.lookAt(Y2,xS,this.up),this.quaternion.setFromRotationMatrix(Qf),n&&(Qf.extractRotation(n.matrixWorld),Cx.setFromRotationMatrix(Qf),this.quaternion.premultiply(Cx.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(I8),Dx.child=e,this.dispatchEvent(Dx),Dx.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(FOe),rI.child=e,this.dispatchEvent(rI),rI.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Qf.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Qf.multiply(e.parent.matrixWorld)),e.applyMatrix4(Qf),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(I8),Dx.child=e,this.dispatchEvent(Dx),Dx.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let r=0,n=this.children.length;r<n;r++){const a=this.children[r].getObjectByProperty(e,i);if(a!==void 0)return a}}getObjectsByProperty(e,i,r=[]){this[e]===i&&r.push(this);const n=this.children;for(let s=0,a=n.length;s<a;s++)n[s].getObjectsByProperty(e,i,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xS,e,BOe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xS,NOe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].updateMatrixWorld(e)}updateWorldMatrix(e,i){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i===!0){const n=this.children;for(let s=0,a=n.length;s<a;s++)n[s].updateWorldMatrix(!1,!0)}}toJSON(e){const i=e===void 0||typeof e=="string",r={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),n.maxInstanceCount=this._maxInstanceCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(n.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),this.boundingBox!==null&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()}));function s(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(e.shapes,h)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(s(e.materials,this.material[l]));n.material=o}else n.material=s(e.materials,this.material);if(this.children.length>0){n.children=[];for(let o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];n.animations.push(s(e.animations,l))}}if(i){const o=a(e.geometries),l=a(e.materials),c=a(e.textures),u=a(e.images),h=a(e.shapes),d=a(e.skeletons),p=a(e.animations),g=a(e.nodes);o.length>0&&(r.geometries=o),l.length>0&&(r.materials=l),c.length>0&&(r.textures=c),u.length>0&&(r.images=u),h.length>0&&(r.shapes=h),d.length>0&&(r.skeletons=d),p.length>0&&(r.animations=p),g.length>0&&(r.nodes=g)}return r.object=n,r;function a(o){const l=[];for(const c in o){const u=o[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let r=0;r<e.children.length;r++){const n=e.children[r];this.add(n.clone())}return this}}Ir.DEFAULT_UP=new Se(0,1,0);Ir.DEFAULT_MATRIX_AUTO_UPDATE=!0;Ir.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const nh=new Se,Zf=new Se,nI=new Se,Kf=new Se,Px=new Se,Rx=new Se,z8=new Se,sI=new Se,aI=new Se,oI=new Se,lI=new Ar,cI=new Ar,uI=new Ar;class Vl{constructor(e=new Se,i=new Se,r=new Se){this.a=e,this.b=i,this.c=r}static getNormal(e,i,r,n){n.subVectors(r,i),nh.subVectors(e,i),n.cross(nh);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(e,i,r,n,s){nh.subVectors(n,i),Zf.subVectors(r,i),nI.subVectors(e,i);const a=nh.dot(nh),o=nh.dot(Zf),l=nh.dot(nI),c=Zf.dot(Zf),u=Zf.dot(nI),h=a*c-o*o;if(h===0)return s.set(0,0,0),null;const d=1/h,p=(c*l-o*u)*d,g=(a*u-o*l)*d;return s.set(1-p-g,g,p)}static containsPoint(e,i,r,n){return this.getBarycoord(e,i,r,n,Kf)===null?!1:Kf.x>=0&&Kf.y>=0&&Kf.x+Kf.y<=1}static getInterpolation(e,i,r,n,s,a,o,l){return this.getBarycoord(e,i,r,n,Kf)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,Kf.x),l.addScaledVector(a,Kf.y),l.addScaledVector(o,Kf.z),l)}static getInterpolatedAttribute(e,i,r,n,s,a){return lI.setScalar(0),cI.setScalar(0),uI.setScalar(0),lI.fromBufferAttribute(e,i),cI.fromBufferAttribute(e,r),uI.fromBufferAttribute(e,n),a.setScalar(0),a.addScaledVector(lI,s.x),a.addScaledVector(cI,s.y),a.addScaledVector(uI,s.z),a}static isFrontFacing(e,i,r,n){return nh.subVectors(r,i),Zf.subVectors(e,i),nh.cross(Zf).dot(n)<0}set(e,i,r){return this.a.copy(e),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(e,i,r,n){return this.a.copy(e[i]),this.b.copy(e[r]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,i,r,n){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return nh.subVectors(this.c,this.b),Zf.subVectors(this.a,this.b),nh.cross(Zf).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Vl.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return Vl.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,r,n,s){return Vl.getInterpolation(e,this.a,this.b,this.c,i,r,n,s)}containsPoint(e){return Vl.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Vl.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const r=this.a,n=this.b,s=this.c;let a,o;Px.subVectors(n,r),Rx.subVectors(s,r),sI.subVectors(e,r);const l=Px.dot(sI),c=Rx.dot(sI);if(l<=0&&c<=0)return i.copy(r);aI.subVectors(e,n);const u=Px.dot(aI),h=Rx.dot(aI);if(u>=0&&h<=u)return i.copy(n);const d=l*h-u*c;if(d<=0&&l>=0&&u<=0)return a=l/(l-u),i.copy(r).addScaledVector(Px,a);oI.subVectors(e,s);const p=Px.dot(oI),g=Rx.dot(oI);if(g>=0&&p<=g)return i.copy(s);const x=p*c-l*g;if(x<=0&&c>=0&&g<=0)return o=c/(c-g),i.copy(r).addScaledVector(Rx,o);const v=u*g-p*h;if(v<=0&&h-u>=0&&p-g>=0)return z8.subVectors(s,n),o=(h-u)/(h-u+(p-g)),i.copy(n).addScaledVector(z8,o);const b=1/(v+x+d);return a=x*b,o=d*b,i.copy(r).addScaledVector(Px,a).addScaledVector(Rx,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const YK={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Hm={h:0,s:0,l:0},Q2={h:0,s:0,l:0};function hI(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*6*(2/3-i):t}class Zt{constructor(e,i,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,i,r)}set(e,i,r){if(i===void 0&&r===void 0){const n=e;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(e,i,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=Co){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Er.toWorkingColorSpace(this,i),this}setRGB(e,i,r,n=Er.workingColorSpace){return this.r=e,this.g=i,this.b=r,Er.toWorkingColorSpace(this,n),this}setHSL(e,i,r,n=Er.workingColorSpace){if(e=hF(e,1),i=Qi(i,0,1),r=Qi(r,0,1),i===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+i):r+i-r*i,a=2*r-s;this.r=hI(a,s,e+1/3),this.g=hI(a,s,e),this.b=hI(a,s,e-1/3)}return Er.toWorkingColorSpace(this,n),this}setStyle(e,i=Co){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=n[1],o=n[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,i);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,i);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=n[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,i);if(a===6)return this.setHex(parseInt(s,16),i);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,i);return this}setColorName(e,i=Co){const r=YK[e.toLowerCase()];return r!==void 0?this.setHex(r,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Mp(e.r),this.g=Mp(e.g),this.b=Mp(e.b),this}copyLinearToSRGB(e){return this.r=A1(e.r),this.g=A1(e.g),this.b=A1(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Co){return Er.fromWorkingColorSpace(Ao.copy(this),e),Math.round(Qi(Ao.r*255,0,255))*65536+Math.round(Qi(Ao.g*255,0,255))*256+Math.round(Qi(Ao.b*255,0,255))}getHexString(e=Co){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=Er.workingColorSpace){Er.fromWorkingColorSpace(Ao.copy(this),i);const r=Ao.r,n=Ao.g,s=Ao.b,a=Math.max(r,n,s),o=Math.min(r,n,s);let l,c;const u=(o+a)/2;if(o===a)l=0,c=0;else{const h=a-o;switch(c=u<=.5?h/(a+o):h/(2-a-o),a){case r:l=(n-s)/h+(n<s?6:0);break;case n:l=(s-r)/h+2;break;case s:l=(r-n)/h+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,i=Er.workingColorSpace){return Er.fromWorkingColorSpace(Ao.copy(this),i),e.r=Ao.r,e.g=Ao.g,e.b=Ao.b,e}getStyle(e=Co){Er.fromWorkingColorSpace(Ao.copy(this),e);const i=Ao.r,r=Ao.g,n=Ao.b;return e!==Co?`color(${e} ${i.toFixed(3)} ${r.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(r*255)},${Math.round(n*255)})`}offsetHSL(e,i,r){return this.getHSL(Hm),this.setHSL(Hm.h+e,Hm.s+i,Hm.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,r){return this.r=e.r+(i.r-e.r)*r,this.g=e.g+(i.g-e.g)*r,this.b=e.b+(i.b-e.b)*r,this}lerpHSL(e,i){this.getHSL(Hm),e.getHSL(Q2);const r=pw(Hm.h,Q2.h,i),n=pw(Hm.s,Q2.s,i),s=pw(Hm.l,Q2.l,i);return this.setHSL(r,n,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const i=this.r,r=this.g,n=this.b,s=e.elements;return this.r=s[0]*i+s[3]*r+s[6]*n,this.g=s[1]*i+s[4]*r+s[7]*n,this.b=s[2]*i+s[5]*r+s[8]*n,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ao=new Zt;Zt.NAMES=YK;let kOe=0;class Bo extends rf{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:kOe++}),this.uuid=xc(),this.name="",this.type="Material",this.blending=E0,this.side=Op,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=TD,this.blendDst=CD,this.blendEquation=tg,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Zt(0,0,0),this.blendAlpha=0,this.depthFunc=k0,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=PB,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Qv,this.stencilZFail=Qv,this.stencilZPass=Qv,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const i in e){const r=e[i];if(r===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const n=this[i];if(n===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[i]=r}}toJSON(e){const i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==E0&&(r.blending=this.blending),this.side!==Op&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==TD&&(r.blendSrc=this.blendSrc),this.blendDst!==CD&&(r.blendDst=this.blendDst),this.blendEquation!==tg&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==k0&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==PB&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Qv&&(r.stencilFail=this.stencilFail),this.stencilZFail!==Qv&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==Qv&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function n(s){const a=[];for(const o in s){const l=s[o];delete l.metadata,a.push(l)}return a}if(i){const s=n(e.textures),a=n(e.images);s.length>0&&(r.textures=s),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const i=e.clippingPlanes;let r=null;if(i!==null){const n=i.length;r=new Array(n);for(let s=0;s!==n;++s)r[s]=i[s].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Fp extends Bo{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Zt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Sc,this.combine=zM,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const dp=VOe();function VOe(){const t=new ArrayBuffer(4),e=new Float32Array(t),i=new Uint32Array(t),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(r[l]=1024>>-c-14,r[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(r[l]=c+15<<10,r[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;(c&8388608)===0;)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:e,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function Il(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=Qi(t,-65504,65504),dp.floatView[0]=t;const e=dp.uint32View[0],i=e>>23&511;return dp.baseTable[i]+((e&8388607)>>dp.shiftTable[i])}function HS(t){const e=t>>10;return dp.uint32View[0]=dp.mantissaTable[dp.offsetTable[e]+(t&1023)]+dp.exponentTable[e],dp.floatView[0]}class HOe{static toHalfFloat(e){return Il(e)}static fromHalfFloat(e){return HS(e)}}const Fs=new Se,Z2=new Tt;let GOe=0;class fn{constructor(e,i,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:GOe++}),this.name="",this.array=e,this.itemSize=i,this.count=e!==void 0?e.length/i:0,this.normalized=r,this.usage=$w,this.updateRanges=[],this.gpuType=jl,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,i,r){e*=this.itemSize,r*=i.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[e+n]=i.array[r+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let i=0,r=this.count;i<r;i++)Z2.fromBufferAttribute(this,i),Z2.applyMatrix3(e),this.setXY(i,Z2.x,Z2.y);else if(this.itemSize===3)for(let i=0,r=this.count;i<r;i++)Fs.fromBufferAttribute(this,i),Fs.applyMatrix3(e),this.setXYZ(i,Fs.x,Fs.y,Fs.z);return this}applyMatrix4(e){for(let i=0,r=this.count;i<r;i++)Fs.fromBufferAttribute(this,i),Fs.applyMatrix4(e),this.setXYZ(i,Fs.x,Fs.y,Fs.z);return this}applyNormalMatrix(e){for(let i=0,r=this.count;i<r;i++)Fs.fromBufferAttribute(this,i),Fs.applyNormalMatrix(e),this.setXYZ(i,Fs.x,Fs.y,Fs.z);return this}transformDirection(e){for(let i=0,r=this.count;i<r;i++)Fs.fromBufferAttribute(this,i),Fs.transformDirection(e),this.setXYZ(i,Fs.x,Fs.y,Fs.z);return this}set(e,i=0){return this.array.set(e,i),this}getComponent(e,i){let r=this.array[e*this.itemSize+i];return this.normalized&&(r=sl(r,this.array)),r}setComponent(e,i,r){return this.normalized&&(r=$i(r,this.array)),this.array[e*this.itemSize+i]=r,this}getX(e){let i=this.array[e*this.itemSize];return this.normalized&&(i=sl(i,this.array)),i}setX(e,i){return this.normalized&&(i=$i(i,this.array)),this.array[e*this.itemSize]=i,this}getY(e){let i=this.array[e*this.itemSize+1];return this.normalized&&(i=sl(i,this.array)),i}setY(e,i){return this.normalized&&(i=$i(i,this.array)),this.array[e*this.itemSize+1]=i,this}getZ(e){let i=this.array[e*this.itemSize+2];return this.normalized&&(i=sl(i,this.array)),i}setZ(e,i){return this.normalized&&(i=$i(i,this.array)),this.array[e*this.itemSize+2]=i,this}getW(e){let i=this.array[e*this.itemSize+3];return this.normalized&&(i=sl(i,this.array)),i}setW(e,i){return this.normalized&&(i=$i(i,this.array)),this.array[e*this.itemSize+3]=i,this}setXY(e,i,r){return e*=this.itemSize,this.normalized&&(i=$i(i,this.array),r=$i(r,this.array)),this.array[e+0]=i,this.array[e+1]=r,this}setXYZ(e,i,r,n){return e*=this.itemSize,this.normalized&&(i=$i(i,this.array),r=$i(r,this.array),n=$i(n,this.array)),this.array[e+0]=i,this.array[e+1]=r,this.array[e+2]=n,this}setXYZW(e,i,r,n,s){return e*=this.itemSize,this.normalized&&(i=$i(i,this.array),r=$i(r,this.array),n=$i(n,this.array),s=$i(s,this.array)),this.array[e+0]=i,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==$w&&(e.usage=this.usage),e}}class jOe extends fn{constructor(e,i,r){super(new Int8Array(e),i,r)}}class WOe extends fn{constructor(e,i,r){super(new Uint8Array(e),i,r)}}class qOe extends fn{constructor(e,i,r){super(new Uint8ClampedArray(e),i,r)}}class XOe extends fn{constructor(e,i,r){super(new Int16Array(e),i,r)}}class dF extends fn{constructor(e,i,r){super(new Uint16Array(e),i,r)}}class YOe extends fn{constructor(e,i,r){super(new Int32Array(e),i,r)}}class fF extends fn{constructor(e,i,r){super(new Uint32Array(e),i,r)}}class QOe extends fn{constructor(e,i,r){super(new Uint16Array(e),i,r),this.isFloat16BufferAttribute=!0}getX(e){let i=HS(this.array[e*this.itemSize]);return this.normalized&&(i=sl(i,this.array)),i}setX(e,i){return this.normalized&&(i=$i(i,this.array)),this.array[e*this.itemSize]=Il(i),this}getY(e){let i=HS(this.array[e*this.itemSize+1]);return this.normalized&&(i=sl(i,this.array)),i}setY(e,i){return this.normalized&&(i=$i(i,this.array)),this.array[e*this.itemSize+1]=Il(i),this}getZ(e){let i=HS(this.array[e*this.itemSize+2]);return this.normalized&&(i=sl(i,this.array)),i}setZ(e,i){return this.normalized&&(i=$i(i,this.array)),this.array[e*this.itemSize+2]=Il(i),this}getW(e){let i=HS(this.array[e*this.itemSize+3]);return this.normalized&&(i=sl(i,this.array)),i}setW(e,i){return this.normalized&&(i=$i(i,this.array)),this.array[e*this.itemSize+3]=Il(i),this}setXY(e,i,r){return e*=this.itemSize,this.normalized&&(i=$i(i,this.array),r=$i(r,this.array)),this.array[e+0]=Il(i),this.array[e+1]=Il(r),this}setXYZ(e,i,r,n){return e*=this.itemSize,this.normalized&&(i=$i(i,this.array),r=$i(r,this.array),n=$i(n,this.array)),this.array[e+0]=Il(i),this.array[e+1]=Il(r),this.array[e+2]=Il(n),this}setXYZW(e,i,r,n,s){return e*=this.itemSize,this.normalized&&(i=$i(i,this.array),r=$i(r,this.array),n=$i(n,this.array),s=$i(s,this.array)),this.array[e+0]=Il(i),this.array[e+1]=Il(r),this.array[e+2]=Il(n),this.array[e+3]=Il(s),this}}class di extends fn{constructor(e,i,r){super(new Float32Array(e),i,r)}}let ZOe=0;const qc=new Ui,dI=new Ir,Ox=new Se,pc=new ao,bS=new ao,Ea=new Se;class sr extends rf{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:ZOe++}),this.uuid=xc(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(WK(e)?fF:dF)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,r=0){this.groups.push({start:e,count:i,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new Yi().getNormalMatrix(e);r.applyNormalMatrix(s),r.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return qc.makeRotationFromQuaternion(e),this.applyMatrix4(qc),this}rotateX(e){return qc.makeRotationX(e),this.applyMatrix4(qc),this}rotateY(e){return qc.makeRotationY(e),this.applyMatrix4(qc),this}rotateZ(e){return qc.makeRotationZ(e),this.applyMatrix4(qc),this}translate(e,i,r){return qc.makeTranslation(e,i,r),this.applyMatrix4(qc),this}scale(e,i,r){return qc.makeScale(e,i,r),this.applyMatrix4(qc),this}lookAt(e){return dI.lookAt(e),dI.updateMatrix(),this.applyMatrix4(dI.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ox).negate(),this.translate(Ox.x,Ox.y,Ox.z),this}setFromPoints(e){const i=this.getAttribute("position");if(i===void 0){const r=[];for(let n=0,s=e.length;n<s;n++){const a=e[n];r.push(a.x,a.y,a.z||0)}this.setAttribute("position",new di(r,3))}else{const r=Math.min(e.length,i.count);for(let n=0;n<r;n++){const s=e[n];i.setXYZ(n,s.x,s.y,s.z||0)}e.length>i.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),i.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ao);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Se(-1/0,-1/0,-1/0),new Se(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let r=0,n=i.length;r<n;r++){const s=i[r];pc.setFromBufferAttribute(s),this.morphTargetsRelative?(Ea.addVectors(this.boundingBox.min,pc.min),this.boundingBox.expandByPoint(Ea),Ea.addVectors(this.boundingBox.max,pc.max),this.boundingBox.expandByPoint(Ea)):(this.boundingBox.expandByPoint(pc.min),this.boundingBox.expandByPoint(pc.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new oo);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Se,1/0);return}if(e){const r=this.boundingSphere.center;if(pc.setFromBufferAttribute(e),i)for(let s=0,a=i.length;s<a;s++){const o=i[s];bS.setFromBufferAttribute(o),this.morphTargetsRelative?(Ea.addVectors(pc.min,bS.min),pc.expandByPoint(Ea),Ea.addVectors(pc.max,bS.max),pc.expandByPoint(Ea)):(pc.expandByPoint(bS.min),pc.expandByPoint(bS.max))}pc.getCenter(r);let n=0;for(let s=0,a=e.count;s<a;s++)Ea.fromBufferAttribute(e,s),n=Math.max(n,r.distanceToSquared(Ea));if(i)for(let s=0,a=i.length;s<a;s++){const o=i[s],l=this.morphTargetsRelative;for(let c=0,u=o.count;c<u;c++)Ea.fromBufferAttribute(o,c),l&&(Ox.fromBufferAttribute(e,c),Ea.add(Ox)),n=Math.max(n,r.distanceToSquared(Ea))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=i.position,n=i.normal,s=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new fn(new Float32Array(4*r.count),4));const a=this.getAttribute("tangent"),o=[],l=[];for(let P=0;P<r.count;P++)o[P]=new Se,l[P]=new Se;const c=new Se,u=new Se,h=new Se,d=new Tt,p=new Tt,g=new Tt,x=new Se,v=new Se;function b(P,R,O){c.fromBufferAttribute(r,P),u.fromBufferAttribute(r,R),h.fromBufferAttribute(r,O),d.fromBufferAttribute(s,P),p.fromBufferAttribute(s,R),g.fromBufferAttribute(s,O),u.sub(c),h.sub(c),p.sub(d),g.sub(d);const U=1/(p.x*g.y-g.x*p.y);isFinite(U)&&(x.copy(u).multiplyScalar(g.y).addScaledVector(h,-p.y).multiplyScalar(U),v.copy(h).multiplyScalar(p.x).addScaledVector(u,-g.x).multiplyScalar(U),o[P].add(x),o[R].add(x),o[O].add(x),l[P].add(v),l[R].add(v),l[O].add(v))}let w=this.groups;w.length===0&&(w=[{start:0,count:e.count}]);for(let P=0,R=w.length;P<R;++P){const O=w[P],U=O.start,F=O.count;for(let V=U,k=U+F;V<k;V+=3)b(e.getX(V+0),e.getX(V+1),e.getX(V+2))}const M=new Se,E=new Se,D=new Se,T=new Se;function L(P){D.fromBufferAttribute(n,P),T.copy(D);const R=o[P];M.copy(R),M.sub(D.multiplyScalar(D.dot(R))).normalize(),E.crossVectors(T,R);const U=E.dot(l[P])<0?-1:1;a.setXYZW(P,M.x,M.y,M.z,U)}for(let P=0,R=w.length;P<R;++P){const O=w[P],U=O.start,F=O.count;for(let V=U,k=U+F;V<k;V+=3)L(e.getX(V+0)),L(e.getX(V+1)),L(e.getX(V+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new fn(new Float32Array(i.count*3),3),this.setAttribute("normal",r);else for(let d=0,p=r.count;d<p;d++)r.setXYZ(d,0,0,0);const n=new Se,s=new Se,a=new Se,o=new Se,l=new Se,c=new Se,u=new Se,h=new Se;if(e)for(let d=0,p=e.count;d<p;d+=3){const g=e.getX(d+0),x=e.getX(d+1),v=e.getX(d+2);n.fromBufferAttribute(i,g),s.fromBufferAttribute(i,x),a.fromBufferAttribute(i,v),u.subVectors(a,s),h.subVectors(n,s),u.cross(h),o.fromBufferAttribute(r,g),l.fromBufferAttribute(r,x),c.fromBufferAttribute(r,v),o.add(u),l.add(u),c.add(u),r.setXYZ(g,o.x,o.y,o.z),r.setXYZ(x,l.x,l.y,l.z),r.setXYZ(v,c.x,c.y,c.z)}else for(let d=0,p=i.count;d<p;d+=3)n.fromBufferAttribute(i,d+0),s.fromBufferAttribute(i,d+1),a.fromBufferAttribute(i,d+2),u.subVectors(a,s),h.subVectors(n,s),u.cross(h),r.setXYZ(d+0,u.x,u.y,u.z),r.setXYZ(d+1,u.x,u.y,u.z),r.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,r=e.count;i<r;i++)Ea.fromBufferAttribute(e,i),Ea.normalize(),e.setXYZ(i,Ea.x,Ea.y,Ea.z)}toNonIndexed(){function e(o,l){const c=o.array,u=o.itemSize,h=o.normalized,d=new c.constructor(l.length*u);let p=0,g=0;for(let x=0,v=l.length;x<v;x++){o.isInterleavedBufferAttribute?p=l[x]*o.data.stride+o.offset:p=l[x]*u;for(let b=0;b<u;b++)d[g++]=c[p++]}return new fn(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new sr,r=this.index.array,n=this.attributes;for(const o in n){const l=n[o],c=e(l,r);i.setAttribute(o,c)}const s=this.morphAttributes;for(const o in s){const l=[],c=s[o];for(let u=0,h=c.length;u<h;u++){const d=c[u],p=e(d,r);l.push(p)}i.morphAttributes[o]=l}i.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const c=a[o];i.addGroup(c.start,c.count,c.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const r=this.attributes;for(const l in r){const c=r[l];e.data.attributes[l]=c.toJSON(e.data)}const n={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,d=c.length;h<d;h++){const p=c[h];u.push(p.toJSON(e.data))}u.length>0&&(n[l]=u,s=!0)}s&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(i));const n=e.attributes;for(const c in n){const u=n[c];this.setAttribute(c,u.clone(i))}const s=e.morphAttributes;for(const c in s){const u=[],h=s[c];for(let d=0,p=h.length;d<p;d++)u.push(h[d].clone(i));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let c=0,u=a.length;c<u;c++){const h=a[c];this.addGroup(h.start,h.count,h.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const U8=new Ui,Lv=new Eb,K2=new oo,B8=new Se,J2=new Se,$2=new Se,eT=new Se,fI=new Se,tT=new Se,N8=new Se,iT=new Se;class is extends Ir{constructor(e=new sr,i=new Fp){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=i,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(e,i){const r=this.geometry,n=r.attributes.position,s=r.morphAttributes.position,a=r.morphTargetsRelative;i.fromBufferAttribute(n,e);const o=this.morphTargetInfluences;if(s&&o){tT.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=o[l],h=s[l];u!==0&&(fI.fromBufferAttribute(h,e),a?tT.addScaledVector(fI,u):tT.addScaledVector(fI.sub(i),u))}i.add(tT)}return i}raycast(e,i){const r=this.geometry,n=this.material,s=this.matrixWorld;n!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),K2.copy(r.boundingSphere),K2.applyMatrix4(s),Lv.copy(e.ray).recast(e.near),!(K2.containsPoint(Lv.origin)===!1&&(Lv.intersectSphere(K2,B8)===null||Lv.origin.distanceToSquared(B8)>(e.far-e.near)**2))&&(U8.copy(s).invert(),Lv.copy(e.ray).applyMatrix4(U8),!(r.boundingBox!==null&&Lv.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,i,Lv)))}_computeIntersections(e,i,r){let n;const s=this.geometry,a=this.material,o=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,p=s.drawRange;if(o!==null)if(Array.isArray(a))for(let g=0,x=d.length;g<x;g++){const v=d[g],b=a[v.materialIndex],w=Math.max(v.start,p.start),M=Math.min(o.count,Math.min(v.start+v.count,p.start+p.count));for(let E=w,D=M;E<D;E+=3){const T=o.getX(E),L=o.getX(E+1),P=o.getX(E+2);n=rT(this,b,e,r,c,u,h,T,L,P),n&&(n.faceIndex=Math.floor(E/3),n.face.materialIndex=v.materialIndex,i.push(n))}}else{const g=Math.max(0,p.start),x=Math.min(o.count,p.start+p.count);for(let v=g,b=x;v<b;v+=3){const w=o.getX(v),M=o.getX(v+1),E=o.getX(v+2);n=rT(this,a,e,r,c,u,h,w,M,E),n&&(n.faceIndex=Math.floor(v/3),i.push(n))}}else if(l!==void 0)if(Array.isArray(a))for(let g=0,x=d.length;g<x;g++){const v=d[g],b=a[v.materialIndex],w=Math.max(v.start,p.start),M=Math.min(l.count,Math.min(v.start+v.count,p.start+p.count));for(let E=w,D=M;E<D;E+=3){const T=E,L=E+1,P=E+2;n=rT(this,b,e,r,c,u,h,T,L,P),n&&(n.faceIndex=Math.floor(E/3),n.face.materialIndex=v.materialIndex,i.push(n))}}else{const g=Math.max(0,p.start),x=Math.min(l.count,p.start+p.count);for(let v=g,b=x;v<b;v+=3){const w=v,M=v+1,E=v+2;n=rT(this,a,e,r,c,u,h,w,M,E),n&&(n.faceIndex=Math.floor(v/3),i.push(n))}}}}function KOe(t,e,i,r,n,s,a,o){let l;if(e.side===ll?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,e.side===Op,o),l===null)return null;iT.copy(o),iT.applyMatrix4(t.matrixWorld);const c=i.ray.origin.distanceTo(iT);return c<i.near||c>i.far?null:{distance:c,point:iT.clone(),object:t}}function rT(t,e,i,r,n,s,a,o,l,c){t.getVertexPosition(o,J2),t.getVertexPosition(l,$2),t.getVertexPosition(c,eT);const u=KOe(t,e,i,r,J2,$2,eT,N8);if(u){const h=new Se;Vl.getBarycoord(N8,J2,$2,eT,h),n&&(u.uv=Vl.getInterpolatedAttribute(n,o,l,c,h,new Tt)),s&&(u.uv1=Vl.getInterpolatedAttribute(s,o,l,c,h,new Tt)),a&&(u.normal=Vl.getInterpolatedAttribute(a,o,l,c,h,new Se),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const d={a:o,b:l,c,normal:new Se,materialIndex:0};Vl.getNormal(J2,$2,eT,d.normal),u.face=d,u.barycoord=h}return u}class ey extends sr{constructor(e=1,i=1,r=1,n=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a};const o=this;n=Math.floor(n),s=Math.floor(s),a=Math.floor(a);const l=[],c=[],u=[],h=[];let d=0,p=0;g("z","y","x",-1,-1,r,i,e,a,s,0),g("z","y","x",1,-1,r,i,-e,a,s,1),g("x","z","y",1,1,e,r,i,n,a,2),g("x","z","y",1,-1,e,r,-i,n,a,3),g("x","y","z",1,-1,e,i,r,n,s,4),g("x","y","z",-1,-1,e,i,-r,n,s,5),this.setIndex(l),this.setAttribute("position",new di(c,3)),this.setAttribute("normal",new di(u,3)),this.setAttribute("uv",new di(h,2));function g(x,v,b,w,M,E,D,T,L,P,R){const O=E/L,U=D/P,F=E/2,V=D/2,k=T/2,K=L+1,X=P+1;let $=0,Y=0;const re=new Se;for(let G=0;G<X;G++){const j=G*U-V;for(let ee=0;ee<K;ee++){const oe=ee*O-F;re[x]=oe*w,re[v]=j*M,re[b]=k,c.push(re.x,re.y,re.z),re[x]=0,re[v]=0,re[b]=T>0?1:-1,u.push(re.x,re.y,re.z),h.push(ee/L),h.push(1-G/P),$+=1}}for(let G=0;G<P;G++)for(let j=0;j<L;j++){const ee=d+j+K*G,oe=d+j+K*(G+1),Q=d+(j+1)+K*(G+1),ae=d+(j+1)+K*G;l.push(ee,oe,ae),l.push(oe,Q,ae),Y+=6}o.addGroup(p,Y,R),p+=Y,d+=$}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ey(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Y1(t){const e={};for(const i in t){e[i]={};for(const r in t[i]){const n=t[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?n.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][r]=null):e[i][r]=n.clone():Array.isArray(n)?e[i][r]=n.slice():e[i][r]=n}}return e}function tl(t){const e={};for(let i=0;i<t.length;i++){const r=Y1(t[i]);for(const n in r)e[n]=r[n]}return e}function JOe(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}function QK(t){const e=t.getRenderTarget();return e===null?t.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Er.workingColorSpace}const pF={clone:Y1,merge:tl};var $Oe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,eLe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class _h extends Bo{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=$Oe,this.fragmentShader=eLe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Y1(e.uniforms),this.uniformsGroups=JOe(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const i=super.toJSON(e);i.glslVersion=this.glslVersion,i.uniforms={};for(const n in this.uniforms){const a=this.uniforms[n].value;a&&a.isTexture?i.uniforms[n]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?i.uniforms[n]={type:"c",value:a.getHex()}:a&&a.isVector2?i.uniforms[n]={type:"v2",value:a.toArray()}:a&&a.isVector3?i.uniforms[n]={type:"v3",value:a.toArray()}:a&&a.isVector4?i.uniforms[n]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?i.uniforms[n]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?i.uniforms[n]={type:"m4",value:a.toArray()}:i.uniforms[n]={value:a}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const r={};for(const n in this.extensions)this.extensions[n]===!0&&(r[n]=!0);return Object.keys(r).length>0&&(i.extensions=r),i}}class mP extends Ir{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ui,this.projectionMatrix=new Ui,this.projectionMatrixInverse=new Ui,this.coordinateSystem=fh}copy(e,i){return super.copy(e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Gm=new Se,F8=new Tt,k8=new Tt;class Pa extends mP{constructor(e=50,i=1,r=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=n,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const i=.5*this.getFilmHeight()/e;this.fov=q1*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(T0*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return q1*2*Math.atan(Math.tan(T0*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,i,r){Gm.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Gm.x,Gm.y).multiplyScalar(-e/Gm.z),Gm.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(Gm.x,Gm.y).multiplyScalar(-e/Gm.z)}getViewSize(e,i){return this.getViewBounds(e,F8,k8),i.subVectors(k8,F8)}setViewOffset(e,i,r,n,s,a){this.aspect=e/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let i=e*Math.tan(T0*.5*this.fov)/this.zoom,r=2*i,n=this.aspect*r,s=-.5*n;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,c=a.fullHeight;s+=a.offsetX*n/l,i-=a.offsetY*r/c,n*=a.width/l,r*=a.height/c}const o=this.filmOffset;o!==0&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,i,i-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const Lx=-90,Ix=1;class ZK extends Ir{constructor(e,i,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new Pa(Lx,Ix,e,i);n.layers=this.layers,this.add(n);const s=new Pa(Lx,Ix,e,i);s.layers=this.layers,this.add(s);const a=new Pa(Lx,Ix,e,i);a.layers=this.layers,this.add(a);const o=new Pa(Lx,Ix,e,i);o.layers=this.layers,this.add(o);const l=new Pa(Lx,Ix,e,i);l.layers=this.layers,this.add(l);const c=new Pa(Lx,Ix,e,i);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,i=this.children.concat(),[r,n,s,a,o,l]=i;for(const c of i)this.remove(c);if(e===fh)r.up.set(0,1,0),r.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===eM)r.up.set(0,-1,0),r.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of i)this.add(c),c.updateMatrixWorld()}update(e,i){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:n}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,a,o,l,c,u]=this.children,h=e.getRenderTarget(),d=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),g=e.xr.enabled;e.xr.enabled=!1;const x=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,n),e.render(i,s),e.setRenderTarget(r,1,n),e.render(i,a),e.setRenderTarget(r,2,n),e.render(i,o),e.setRenderTarget(r,3,n),e.render(i,l),e.setRenderTarget(r,4,n),e.render(i,c),r.texture.generateMipmaps=x,e.setRenderTarget(r,5,n),e.render(i,u),e.setRenderTarget(h,d,p),e.xr.enabled=g,r.texture.needsPMREMUpdate=!0}}class NM extends ss{constructor(e,i,r,n,s,a,o,l,c,u){e=e!==void 0?e:[],i=i!==void 0?i:Lp,super(e,i,r,n,s,a,o,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class KK extends Yd{constructor(e=1,i={}){super(e,e,i),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},n=[r,r,r,r,r,r];this.texture=new NM(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Cs}fromEquirectangularTexture(e,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new ey(5,5,5),s=new _h({name:"CubemapFromEquirect",uniforms:Y1(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:ll,blending:wp});s.uniforms.tEquirect.value=i;const a=new is(n,s),o=i.minFilter;return i.minFilter===Id&&(i.minFilter=Cs),new ZK(1,10,this).update(e,a),i.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,i,r,n){const s=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(i,r,n);e.setRenderTarget(s)}}class l1 extends Ir{constructor(){super(),this.isGroup=!0,this.type="Group"}}const tLe={type:"move"};class hC{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new l1,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new l1,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Se,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Se),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new l1,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Se,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Se),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const i=this._hand;if(i)for(const r of e.hand.values())this._getHandJoint(i,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,i,r){let n=null,s=null,a=null;const o=this._targetRay,l=this._grip,c=this._hand;if(e&&i.session.visibilityState!=="visible-blurred"){if(c&&e.hand){a=!0;for(const x of e.hand.values()){const v=i.getJointPose(x,r),b=this._getHandJoint(c,x);v!==null&&(b.matrix.fromArray(v.transform.matrix),b.matrix.decompose(b.position,b.rotation,b.scale),b.matrixWorldNeedsUpdate=!0,b.jointRadius=v.radius),b.visible=v!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],d=u.position.distanceTo(h.position),p=.02,g=.005;c.inputState.pinching&&d>p+g?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&d<=p-g&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=i.getPose(e.gripSpace,r),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(n=i.getPose(e.targetRaySpace,r),n===null&&s!==null&&(n=s),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(tLe)))}return o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=a!==null),this}_getHandJoint(e,i){if(e.joints[i.jointName]===void 0){const r=new l1;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[i.jointName]=r,e.add(r)}return e.joints[i.jointName]}}class gP{constructor(e,i=25e-5){this.isFogExp2=!0,this.name="",this.color=new Zt(e),this.density=i}clone(){return new gP(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class vP{constructor(e,i=1,r=1e3){this.isFog=!0,this.name="",this.color=new Zt(e),this.near=i,this.far=r}clone(){return new vP(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class mF extends Ir{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Sc,this.environmentIntensity=1,this.environmentRotation=new Sc,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const i=super.toJSON(e);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(i.object.environmentIntensity=this.environmentIntensity),i.object.environmentRotation=this.environmentRotation.toArray(),i}}class yP{constructor(e,i){this.isInterleavedBuffer=!0,this.array=e,this.stride=i,this.count=e!==void 0?e.length/i:0,this.usage=$w,this.updateRanges=[],this.version=0,this.uuid=xc()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,i,r){e*=this.stride,r*=i.stride;for(let n=0,s=this.stride;n<s;n++)this.array[e+n]=i.array[r+n];return this}set(e,i=0){return this.array.set(e,i),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=xc()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(i,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=xc()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const $o=new Se;class G0{constructor(e,i,r,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=r,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,r=this.data.count;i<r;i++)$o.fromBufferAttribute(this,i),$o.applyMatrix4(e),this.setXYZ(i,$o.x,$o.y,$o.z);return this}applyNormalMatrix(e){for(let i=0,r=this.count;i<r;i++)$o.fromBufferAttribute(this,i),$o.applyNormalMatrix(e),this.setXYZ(i,$o.x,$o.y,$o.z);return this}transformDirection(e){for(let i=0,r=this.count;i<r;i++)$o.fromBufferAttribute(this,i),$o.transformDirection(e),this.setXYZ(i,$o.x,$o.y,$o.z);return this}getComponent(e,i){let r=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(r=sl(r,this.array)),r}setComponent(e,i,r){return this.normalized&&(r=$i(r,this.array)),this.data.array[e*this.data.stride+this.offset+i]=r,this}setX(e,i){return this.normalized&&(i=$i(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=$i(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=$i(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=$i(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=sl(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=sl(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=sl(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=sl(i,this.array)),i}setXY(e,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(i=$i(i,this.array),r=$i(r,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this}setXYZ(e,i,r,n){return e=e*this.data.stride+this.offset,this.normalized&&(i=$i(i,this.array),r=$i(r,this.array),n=$i(n,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this.data.array[e+2]=n,this}setXYZW(e,i,r,n,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=$i(i,this.array),r=$i(r,this.array),n=$i(n,this.array),s=$i(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[n+s])}return new fn(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new G0(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[n+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class gF extends Bo{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Zt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let zx;const _S=new Se,Ux=new Se,Bx=new Se,Nx=new Tt,SS=new Tt,JK=new Ui,nT=new Se,wS=new Se,sT=new Se,V8=new Tt,pI=new Tt,H8=new Tt;class $K extends Ir{constructor(e=new gF){if(super(),this.isSprite=!0,this.type="Sprite",zx===void 0){zx=new sr;const i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new yP(i,5);zx.setIndex([0,1,2,0,2,3]),zx.setAttribute("position",new G0(r,3,0,!1)),zx.setAttribute("uv",new G0(r,2,3,!1))}this.geometry=zx,this.material=e,this.center=new Tt(.5,.5)}raycast(e,i){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ux.setFromMatrixScale(this.matrixWorld),JK.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Bx.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Ux.multiplyScalar(-Bx.z);const r=this.material.rotation;let n,s;r!==0&&(s=Math.cos(r),n=Math.sin(r));const a=this.center;aT(nT.set(-.5,-.5,0),Bx,a,Ux,n,s),aT(wS.set(.5,-.5,0),Bx,a,Ux,n,s),aT(sT.set(.5,.5,0),Bx,a,Ux,n,s),V8.set(0,0),pI.set(1,0),H8.set(1,1);let o=e.ray.intersectTriangle(nT,wS,sT,!1,_S);if(o===null&&(aT(wS.set(-.5,.5,0),Bx,a,Ux,n,s),pI.set(0,1),o=e.ray.intersectTriangle(nT,sT,wS,!1,_S),o===null))return;const l=e.ray.origin.distanceTo(_S);l<e.near||l>e.far||i.push({distance:l,point:_S.clone(),uv:Vl.getInterpolation(_S,nT,wS,sT,V8,pI,H8,new Tt),face:null,object:this})}copy(e,i){return super.copy(e,i),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function aT(t,e,i,r,n,s){Nx.subVectors(t,i).addScalar(.5).multiply(r),n!==void 0?(SS.x=s*Nx.x-n*Nx.y,SS.y=n*Nx.x+s*Nx.y):SS.copy(Nx),t.copy(e),t.x+=SS.x,t.y+=SS.y,t.applyMatrix4(JK)}const oT=new Se,G8=new Se;class eJ extends Ir{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const i=e.levels;for(let r=0,n=i.length;r<n;r++){const s=i[r];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,i=0,r=0){i=Math.abs(i);const n=this.levels;let s;for(s=0;s<n.length&&!(i<n[s].distance);s++);return n.splice(s,0,{distance:i,hysteresis:r,object:e}),this.add(e),this}removeLevel(e){const i=this.levels;for(let r=0;r<i.length;r++)if(i[r].distance===e){const n=i.splice(r,1);return this.remove(n[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const i=this.levels;if(i.length>0){let r,n;for(r=1,n=i.length;r<n;r++){let s=i[r].distance;if(i[r].object.visible&&(s-=s*i[r].hysteresis),e<s)break}return i[r-1].object}return null}raycast(e,i){if(this.levels.length>0){oT.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(oT);this.getObjectForDistance(n).raycast(e,i)}}update(e){const i=this.levels;if(i.length>1){oT.setFromMatrixPosition(e.matrixWorld),G8.setFromMatrixPosition(this.matrixWorld);const r=oT.distanceTo(G8)/e.zoom;i[0].object.visible=!0;let n,s;for(n=1,s=i.length;n<s;n++){let a=i[n].distance;if(i[n].object.visible&&(a-=a*i[n].hysteresis),r>=a)i[n-1].object.visible=!1,i[n].object.visible=!0;else break}for(this._currentLevel=n-1;n<s;n++)i[n].object.visible=!1}}toJSON(e){const i=super.toJSON(e);this.autoUpdate===!1&&(i.object.autoUpdate=!1),i.object.levels=[];const r=this.levels;for(let n=0,s=r.length;n<s;n++){const a=r[n];i.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return i}}const j8=new Se,W8=new Ar,q8=new Ar,iLe=new Se,X8=new Ui,lT=new Se,mI=new oo,Y8=new Ui,gI=new Eb;class tJ extends is{constructor(e,i){super(e,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=DB,this.bindMatrix=new Ui,this.bindMatrixInverse=new Ui,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new ao),this.boundingBox.makeEmpty();const i=e.getAttribute("position");for(let r=0;r<i.count;r++)this.getVertexPosition(r,lT),this.boundingBox.expandByPoint(lT)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new oo),this.boundingSphere.makeEmpty();const i=e.getAttribute("position");for(let r=0;r<i.count;r++)this.getVertexPosition(r,lT),this.boundingSphere.expandByPoint(lT)}copy(e,i){return super.copy(e,i),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,i){const r=this.material,n=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),mI.copy(this.boundingSphere),mI.applyMatrix4(n),e.ray.intersectsSphere(mI)!==!1&&(Y8.copy(n).invert(),gI.copy(e.ray).applyMatrix4(Y8),!(this.boundingBox!==null&&gI.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,i,gI)))}getVertexPosition(e,i){return super.getVertexPosition(e,i),this.applyBoneTransform(e,i),i}bind(e,i){this.skeleton=e,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Ar,i=this.geometry.attributes.skinWeight;for(let r=0,n=i.count;r<n;r++){e.fromBufferAttribute(i,r);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),i.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===DB?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===OK?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,i){const r=this.skeleton,n=this.geometry;W8.fromBufferAttribute(n.attributes.skinIndex,e),q8.fromBufferAttribute(n.attributes.skinWeight,e),j8.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let s=0;s<4;s++){const a=q8.getComponent(s);if(a!==0){const o=W8.getComponent(s);X8.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),i.addScaledVector(iLe.copy(j8).applyMatrix4(X8),a)}}return i.applyMatrix4(this.bindMatrixInverse)}}class vF extends Ir{constructor(){super(),this.isBone=!0,this.type="Bone"}}class kd extends ss{constructor(e=null,i=1,r=1,n,s,a,o,l,c=no,u=no,h,d){super(null,a,o,l,c,u,n,s,h,d),this.isDataTexture=!0,this.image={data:e,width:i,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Q8=new Ui,rLe=new Ui;class xP{constructor(e=[],i=[]){this.uuid=xc(),this.bones=e.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),i.length===0)this.calculateInverses();else if(e.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new Ui)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,i=this.bones.length;e<i;e++){const r=new Ui;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,i=this.bones.length;e<i;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,i=this.bones.length;e<i;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,i=this.boneInverses,r=this.boneMatrices,n=this.boneTexture;for(let s=0,a=e.length;s<a;s++){const o=e[s]?e[s].matrixWorld:rLe;Q8.multiplyMatrices(o,i[s]),Q8.toArray(r,s*16)}n!==null&&(n.needsUpdate=!0)}clone(){return new xP(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4);i.set(this.boneMatrices);const r=new kd(i,e,e,Lo,jl);return r.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=r,this}getBoneByName(e){for(let i=0,r=this.bones.length;i<r;i++){const n=this.bones[i];if(n.name===e)return n}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,i){this.uuid=e.uuid;for(let r=0,n=e.bones.length;r<n;r++){const s=e.bones[r];let a=i[s];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),a=new vF),this.bones.push(a),this.boneInverses.push(new Ui().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const i=this.bones,r=this.boneInverses;for(let n=0,s=i.length;n<s;n++){const a=i[n];e.bones.push(a.uuid);const o=r[n];e.boneInverses.push(o.toArray())}return e}}class j0 extends fn{constructor(e,i,r,n=1){super(e,i,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Fx=new Ui,Z8=new Ui,cT=[],K8=new ao,nLe=new Ui,MS=new is,ES=new oo;class iJ extends is{constructor(e,i,r){super(e,i),this.isInstancedMesh=!0,this.instanceMatrix=new j0(new Float32Array(r*16),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let n=0;n<r;n++)this.setMatrixAt(n,nLe)}computeBoundingBox(){const e=this.geometry,i=this.count;this.boundingBox===null&&(this.boundingBox=new ao),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,Fx),K8.copy(e.boundingBox).applyMatrix4(Fx),this.boundingBox.union(K8)}computeBoundingSphere(){const e=this.geometry,i=this.count;this.boundingSphere===null&&(this.boundingSphere=new oo),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,Fx),ES.copy(e.boundingSphere).applyMatrix4(Fx),this.boundingSphere.union(ES)}copy(e,i){return super.copy(e,i),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,i){i.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,i){i.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,i){const r=i.morphTargetInfluences,n=this.morphTexture.source.data.data,s=r.length+1,a=e*s+1;for(let o=0;o<r.length;o++)r[o]=n[a+o]}raycast(e,i){const r=this.matrixWorld,n=this.count;if(MS.geometry=this.geometry,MS.material=this.material,MS.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),ES.copy(this.boundingSphere),ES.applyMatrix4(r),e.ray.intersectsSphere(ES)!==!1))for(let s=0;s<n;s++){this.getMatrixAt(s,Fx),Z8.multiplyMatrices(r,Fx),MS.matrixWorld=Z8,MS.raycast(e,cT);for(let a=0,o=cT.length;a<o;a++){const l=cT[a];l.instanceId=s,l.object=this,i.push(l)}cT.length=0}}setColorAt(e,i){this.instanceColor===null&&(this.instanceColor=new j0(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),i.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,i){i.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,i){const r=i.morphTargetInfluences,n=r.length+1;this.morphTexture===null&&(this.morphTexture=new kd(new Float32Array(n*this.count),n,this.count,cP,jl));const s=this.morphTexture.source.data.data;let a=0;for(let c=0;c<r.length;c++)a+=r[c];const o=this.geometry.morphTargetsRelative?1:1-a,l=n*e;s[l]=o,s.set(r,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const vI=new Se,sLe=new Se,aLe=new Yi;class Ym{constructor(e=new Se(1,0,0),i=0){this.isPlane=!0,this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,r,n){return this.normal.set(e,i,r),this.constant=n,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,r){const n=vI.subVectors(r,i).cross(sLe.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,i){const r=e.delta(vI),n=this.normal.dot(r);if(n===0)return this.distanceToPoint(e.start)===0?i.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:i.copy(e.start).addScaledVector(r,s)}intersectsLine(e){const i=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return i<0&&r>0||r<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){const r=i||aLe.getNormalMatrix(e),n=this.coplanarPoint(vI).applyMatrix4(e),s=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Iv=new oo,uT=new Se;class FM{constructor(e=new Ym,i=new Ym,r=new Ym,n=new Ym,s=new Ym,a=new Ym){this.planes=[e,i,r,n,s,a]}set(e,i,r,n,s,a){const o=this.planes;return o[0].copy(e),o[1].copy(i),o[2].copy(r),o[3].copy(n),o[4].copy(s),o[5].copy(a),this}copy(e){const i=this.planes;for(let r=0;r<6;r++)i[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,i=fh){const r=this.planes,n=e.elements,s=n[0],a=n[1],o=n[2],l=n[3],c=n[4],u=n[5],h=n[6],d=n[7],p=n[8],g=n[9],x=n[10],v=n[11],b=n[12],w=n[13],M=n[14],E=n[15];if(r[0].setComponents(l-s,d-c,v-p,E-b).normalize(),r[1].setComponents(l+s,d+c,v+p,E+b).normalize(),r[2].setComponents(l+a,d+u,v+g,E+w).normalize(),r[3].setComponents(l-a,d-u,v-g,E-w).normalize(),r[4].setComponents(l-o,d-h,v-x,E-M).normalize(),i===fh)r[5].setComponents(l+o,d+h,v+x,E+M).normalize();else if(i===eM)r[5].setComponents(o,h,x,M).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Iv.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const i=e.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),Iv.copy(i.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Iv)}intersectsSprite(e){return Iv.center.set(0,0,0),Iv.radius=.7071067811865476,Iv.applyMatrix4(e.matrixWorld),this.intersectsSphere(Iv)}intersectsSphere(e){const i=this.planes,r=e.center,n=-e.radius;for(let s=0;s<6;s++)if(i[s].distanceToPoint(r)<n)return!1;return!0}intersectsBox(e){const i=this.planes;for(let r=0;r<6;r++){const n=i[r];if(uT.x=n.normal.x>0?e.max.x:e.min.x,uT.y=n.normal.y>0?e.max.y:e.min.y,uT.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(uT)<0)return!1}return!0}containsPoint(e){const i=this.planes;for(let r=0;r<6;r++)if(i[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function yI(t,e){return t-e}function oLe(t,e){return t.z-e.z}function lLe(t,e){return e.z-t.z}class cLe{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,i,r,n){const s=this.pool,a=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});const o=s[this.index];a.push(o),this.index++,o.start=e,o.count=i,o.z=r,o.index=n}reset(){this.list.length=0,this.index=0}}const Ll=new Ui,uLe=new Zt(1,1,1),xI=new FM,hT=new ao,zv=new oo,AS=new Se,J8=new Se,hLe=new Se,bI=new cLe,To=new is,dT=[];function dLe(t,e,i=0){const r=e.itemSize;if(t.isInterleavedBufferAttribute||t.array.constructor!==e.array.constructor){const n=t.count;for(let s=0;s<n;s++)for(let a=0;a<r;a++)e.setComponent(s+i,a,t.getComponent(s,a))}else e.array.set(t.array,i*r);e.needsUpdate=!0}function Uv(t,e){if(t.constructor!==e.constructor){const i=Math.min(t.length,e.length);for(let r=0;r<i;r++)e[r]=t[r]}else{const i=Math.min(t.length,e.length);e.set(new t.constructor(t.buffer,0,i))}}class rJ extends is{constructor(e,i,r=i*2,n){super(new sr,n),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=i,this._maxIndexCount=r,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4),r=new kd(i,e,e,Lo,jl);this._matricesTexture=r}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const i=new Uint32Array(e*e),r=new kd(i,e,e,UM,Ip);this._indirectTexture=r}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const i=new Float32Array(e*e*4).fill(1),r=new kd(i,e,e,Lo,jl);r.colorSpace=Er.workingColorSpace,this._colorsTexture=r}_initializeGeometry(e){const i=this.geometry,r=this._maxVertexCount,n=this._maxIndexCount;if(this._geometryInitialized===!1){for(const s in e.attributes){const a=e.getAttribute(s),{array:o,itemSize:l,normalized:c}=a,u=new o.constructor(r*l),h=new fn(u,l,c);i.setAttribute(s,h)}if(e.getIndex()!==null){const s=r>65535?new Uint32Array(n):new Uint16Array(n);i.setIndex(new fn(s,1))}this._geometryInitialized=!0}}_validateGeometry(e){const i=this.geometry;if(!!e.getIndex()!=!!i.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const r in i.attributes){if(!e.hasAttribute(r))throw new Error(`THREE.BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);const n=e.getAttribute(r),s=i.getAttribute(r);if(n.itemSize!==s.itemSize||n.normalized!==s.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const i=this._instanceInfo;if(e<0||e>=i.length||i[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const i=this._geometryInfo;if(e<0||e>=i.length||i[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ao);const e=this.boundingBox,i=this._instanceInfo;e.makeEmpty();for(let r=0,n=i.length;r<n;r++){if(i[r].active===!1)continue;const s=i[r].geometryIndex;this.getMatrixAt(r,Ll),this.getBoundingBoxAt(s,hT).applyMatrix4(Ll),e.union(hT)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new oo);const e=this.boundingSphere,i=this._instanceInfo;e.makeEmpty();for(let r=0,n=i.length;r<n;r++){if(i[r].active===!1)continue;const s=i[r].geometryIndex;this.getMatrixAt(r,Ll),this.getBoundingSphereAt(s,zv).applyMatrix4(Ll),e.union(zv)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const r={visible:!0,active:!0,geometryIndex:e};let n=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(yI),n=this._availableInstanceIds.shift(),this._instanceInfo[n]=r):(n=this._instanceInfo.length,this._instanceInfo.push(r));const s=this._matricesTexture;Ll.identity().toArray(s.image.data,n*16),s.needsUpdate=!0;const a=this._colorsTexture;return a&&(uLe.toArray(a.image.data,n*4),a.needsUpdate=!0),this._visibilityChanged=!0,n}addGeometry(e,i=-1,r=-1){this._initializeGeometry(e),this._validateGeometry(e);const n={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},s=this._geometryInfo;n.vertexStart=this._nextVertexStart,n.reservedVertexCount=i===-1?e.getAttribute("position").count:i;const a=e.getIndex();if(a!==null&&(n.indexStart=this._nextIndexStart,n.reservedIndexCount=r===-1?a.count:r),n.indexStart!==-1&&n.indexStart+n.reservedIndexCount>this._maxIndexCount||n.vertexStart+n.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let l;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(yI),l=this._availableGeometryIds.shift(),s[l]=n):(l=this._geometryCount,this._geometryCount++,s.push(n)),this.setGeometryAt(l,e),this._nextIndexStart=n.indexStart+n.reservedIndexCount,this._nextVertexStart=n.vertexStart+n.reservedVertexCount,l}setGeometryAt(e,i){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(i);const r=this.geometry,n=r.getIndex()!==null,s=r.getIndex(),a=i.getIndex(),o=this._geometryInfo[e];if(n&&a.count>o.reservedIndexCount||i.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const l=o.vertexStart,c=o.reservedVertexCount;o.vertexCount=i.getAttribute("position").count;for(const u in r.attributes){const h=i.getAttribute(u),d=r.getAttribute(u);dLe(h,d,l);const p=h.itemSize;for(let g=h.count,x=c;g<x;g++){const v=l+g;for(let b=0;b<p;b++)d.setComponent(v,b,0)}d.needsUpdate=!0,d.addUpdateRange(l*p,c*p)}if(n){const u=o.indexStart,h=o.reservedIndexCount;o.indexCount=i.getIndex().count;for(let d=0;d<a.count;d++)s.setX(u+d,l+a.getX(d));for(let d=a.count,p=h;d<p;d++)s.setX(u+d,l);s.needsUpdate=!0,s.addUpdateRange(u,o.reservedIndexCount)}return o.start=n?o.indexStart:o.vertexStart,o.count=n?o.indexCount:o.vertexCount,o.boundingBox=null,i.boundingBox!==null&&(o.boundingBox=i.boundingBox.clone()),o.boundingSphere=null,i.boundingSphere!==null&&(o.boundingSphere=i.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const i=this._geometryInfo;if(e>=i.length||i[e].active===!1)return this;const r=this._instanceInfo;for(let n=0,s=r.length;n<s;n++)r[n].active&&r[n].geometryIndex===e&&this.deleteInstance(n);return i[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,i=0;const r=this._geometryInfo,n=r.map((a,o)=>o).sort((a,o)=>r[a].vertexStart-r[o].vertexStart),s=this.geometry;for(let a=0,o=r.length;a<o;a++){const l=n[a],c=r[l];if(c.active!==!1){if(s.index!==null){if(c.indexStart!==i){const{indexStart:u,vertexStart:h,reservedIndexCount:d}=c,p=s.index,g=p.array,x=e-h;for(let v=u;v<u+d;v++)g[v]=g[v]+x;p.array.copyWithin(i,u,u+d),p.addUpdateRange(i,d),c.indexStart=i}i+=c.reservedIndexCount}if(c.vertexStart!==e){const{vertexStart:u,reservedVertexCount:h}=c,d=s.attributes;for(const p in d){const g=d[p],{array:x,itemSize:v}=g;x.copyWithin(e*v,u*v,(u+h)*v),g.addUpdateRange(e*v,h*v)}c.vertexStart=e}e+=c.reservedVertexCount,c.start=s.index?c.indexStart:c.vertexStart,this._nextIndexStart=s.index?c.indexStart+c.reservedIndexCount:0,this._nextVertexStart=c.vertexStart+c.reservedVertexCount}}return this}getBoundingBoxAt(e,i){if(e>=this._geometryCount)return null;const r=this.geometry,n=this._geometryInfo[e];if(n.boundingBox===null){const s=new ao,a=r.index,o=r.attributes.position;for(let l=n.start,c=n.start+n.count;l<c;l++){let u=l;a&&(u=a.getX(u)),s.expandByPoint(AS.fromBufferAttribute(o,u))}n.boundingBox=s}return i.copy(n.boundingBox),i}getBoundingSphereAt(e,i){if(e>=this._geometryCount)return null;const r=this.geometry,n=this._geometryInfo[e];if(n.boundingSphere===null){const s=new oo;this.getBoundingBoxAt(e,hT),hT.getCenter(s.center);const a=r.index,o=r.attributes.position;let l=0;for(let c=n.start,u=n.start+n.count;c<u;c++){let h=c;a&&(h=a.getX(h)),AS.fromBufferAttribute(o,h),l=Math.max(l,s.center.distanceToSquared(AS))}s.radius=Math.sqrt(l),n.boundingSphere=s}return i.copy(n.boundingSphere),i}setMatrixAt(e,i){this.validateInstanceId(e);const r=this._matricesTexture,n=this._matricesTexture.image.data;return i.toArray(n,e*16),r.needsUpdate=!0,this}getMatrixAt(e,i){return this.validateInstanceId(e),i.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,i){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),i.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,i){return this.validateInstanceId(e),i.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,i){return this.validateInstanceId(e),this._instanceInfo[e].visible===i?this:(this._instanceInfo[e].visible=i,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,i){return this.validateInstanceId(e),this.validateGeometryId(i),this._instanceInfo[e].geometryIndex=i,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,i={}){this.validateGeometryId(e);const r=this._geometryInfo[e];return i.vertexStart=r.vertexStart,i.vertexCount=r.vertexCount,i.reservedVertexCount=r.reservedVertexCount,i.indexStart=r.indexStart,i.indexCount=r.indexCount,i.reservedIndexCount=r.reservedIndexCount,i.start=r.start,i.count=r.count,i}setInstanceCount(e){const i=this._availableInstanceIds,r=this._instanceInfo;for(i.sort(yI);i[i.length-1]===r.length;)r.pop(),i.pop();if(e<r.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const n=new Int32Array(e),s=new Int32Array(e);Uv(this._multiDrawCounts,n),Uv(this._multiDrawStarts,s),this._multiDrawCounts=n,this._multiDrawStarts=s,this._maxInstanceCount=e;const a=this._indirectTexture,o=this._matricesTexture,l=this._colorsTexture;a.dispose(),this._initIndirectTexture(),Uv(a.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),Uv(o.image.data,this._matricesTexture.image.data),l&&(l.dispose(),this._initColorsTexture(),Uv(l.image.data,this._colorsTexture.image.data))}setGeometrySize(e,i){const r=[...this._geometryInfo].filter(o=>o.active);if(Math.max(...r.map(o=>o.vertexStart+o.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${i}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...r.map(l=>l.indexStart+l.reservedIndexCount))>i)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${i}. Cannot shrink further.`);const s=this.geometry;s.dispose(),this._maxVertexCount=e,this._maxIndexCount=i,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new sr,this._initializeGeometry(s));const a=this.geometry;s.index&&Uv(s.index.array,a.index.array);for(const o in s.attributes)Uv(s.attributes[o].array,a.attributes[o].array)}raycast(e,i){const r=this._instanceInfo,n=this._geometryInfo,s=this.matrixWorld,a=this.geometry;To.material=this.material,To.geometry.index=a.index,To.geometry.attributes=a.attributes,To.geometry.boundingBox===null&&(To.geometry.boundingBox=new ao),To.geometry.boundingSphere===null&&(To.geometry.boundingSphere=new oo);for(let o=0,l=r.length;o<l;o++){if(!r[o].visible||!r[o].active)continue;const c=r[o].geometryIndex,u=n[c];To.geometry.setDrawRange(u.start,u.count),this.getMatrixAt(o,To.matrixWorld).premultiply(s),this.getBoundingBoxAt(c,To.geometry.boundingBox),this.getBoundingSphereAt(c,To.geometry.boundingSphere),To.raycast(e,dT);for(let h=0,d=dT.length;h<d;h++){const p=dT[h];p.object=this,p.batchId=o,i.push(p)}dT.length=0}To.material=null,To.geometry.index=null,To.geometry.attributes={},To.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(i=>({...i,boundingBox:i.boundingBox!==null?i.boundingBox.clone():null,boundingSphere:i.boundingSphere!==null?i.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(i=>({...i})),this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,i,r,n,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=n.getIndex(),o=a===null?1:a.array.BYTES_PER_ELEMENT,l=this._instanceInfo,c=this._multiDrawStarts,u=this._multiDrawCounts,h=this._geometryInfo,d=this.perObjectFrustumCulled,p=this._indirectTexture,g=p.image.data;d&&(Ll.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),xI.setFromProjectionMatrix(Ll,e.coordinateSystem));let x=0;if(this.sortObjects){Ll.copy(this.matrixWorld).invert(),AS.setFromMatrixPosition(r.matrixWorld).applyMatrix4(Ll),J8.set(0,0,-1).transformDirection(r.matrixWorld).transformDirection(Ll);for(let w=0,M=l.length;w<M;w++)if(l[w].visible&&l[w].active){const E=l[w].geometryIndex;this.getMatrixAt(w,Ll),this.getBoundingSphereAt(E,zv).applyMatrix4(Ll);let D=!1;if(d&&(D=!xI.intersectsSphere(zv)),!D){const T=h[E],L=hLe.subVectors(zv.center,AS).dot(J8);bI.push(T.start,T.count,L,w)}}const v=bI.list,b=this.customSort;b===null?v.sort(s.transparent?lLe:oLe):b.call(this,v,r);for(let w=0,M=v.length;w<M;w++){const E=v[w];c[x]=E.start*o,u[x]=E.count,g[x]=E.index,x++}bI.reset()}else for(let v=0,b=l.length;v<b;v++)if(l[v].visible&&l[v].active){const w=l[v].geometryIndex;let M=!1;if(d&&(this.getMatrixAt(v,Ll),this.getBoundingSphereAt(w,zv).applyMatrix4(Ll),M=!xI.intersectsSphere(zv)),!M){const E=h[w];c[x]=E.start*o,u[x]=E.count,g[x]=v,x++}}p.needsUpdate=!0,this._multiDrawCount=x,this._visibilityChanged=!1}onBeforeShadow(e,i,r,n,s,a){this.onBeforeRender(e,null,n,s,a)}}class fl extends Bo{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Zt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const c3=new Se,u3=new Se,$8=new Ui,TS=new Eb,fT=new oo,_I=new Se,eW=new Se;class Tg extends Ir{constructor(e=new sr,i=new fl){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=i,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,r=[0];for(let n=1,s=i.count;n<s;n++)c3.fromBufferAttribute(i,n-1),u3.fromBufferAttribute(i,n),r[n]=r[n-1],r[n]+=c3.distanceTo(u3);e.setAttribute("lineDistance",new di(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,i){const r=this.geometry,n=this.matrixWorld,s=e.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),fT.copy(r.boundingSphere),fT.applyMatrix4(n),fT.radius+=s,e.ray.intersectsSphere(fT)===!1)return;$8.copy(n).invert(),TS.copy(e.ray).applyMatrix4($8);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=this.isLineSegments?2:1,u=r.index,d=r.attributes.position;if(u!==null){const p=Math.max(0,a.start),g=Math.min(u.count,a.start+a.count);for(let x=p,v=g-1;x<v;x+=c){const b=u.getX(x),w=u.getX(x+1),M=pT(this,e,TS,l,b,w,x);M&&i.push(M)}if(this.isLineLoop){const x=u.getX(g-1),v=u.getX(p),b=pT(this,e,TS,l,x,v,g-1);b&&i.push(b)}}else{const p=Math.max(0,a.start),g=Math.min(d.count,a.start+a.count);for(let x=p,v=g-1;x<v;x+=c){const b=pT(this,e,TS,l,x,x+1,x);b&&i.push(b)}if(this.isLineLoop){const x=pT(this,e,TS,l,g-1,p,g-1);x&&i.push(x)}}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function pT(t,e,i,r,n,s,a){const o=t.geometry.attributes.position;if(c3.fromBufferAttribute(o,n),u3.fromBufferAttribute(o,s),i.distanceSqToSegment(c3,u3,_I,eW)>r)return;_I.applyMatrix4(t.matrixWorld);const c=e.ray.origin.distanceTo(_I);if(!(c<e.near||c>e.far))return{distance:c,point:eW.clone().applyMatrix4(t.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:t}}const tW=new Se,iW=new Se;class nf extends Tg{constructor(e,i){super(e,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,r=[];for(let n=0,s=i.count;n<s;n+=2)tW.fromBufferAttribute(i,n),iW.fromBufferAttribute(i,n+1),r[n]=n===0?0:r[n-1],r[n+1]=r[n]+tW.distanceTo(iW);e.setAttribute("lineDistance",new di(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class nJ extends Tg{constructor(e,i){super(e,i),this.isLineLoop=!0,this.type="LineLoop"}}class yF extends Bo{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Zt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const rW=new Ui,OB=new Eb,mT=new oo,gT=new Se;class sJ extends Ir{constructor(e=new sr,i=new yF){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=i,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,i){const r=this.geometry,n=this.matrixWorld,s=e.params.Points.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),mT.copy(r.boundingSphere),mT.applyMatrix4(n),mT.radius+=s,e.ray.intersectsSphere(mT)===!1)return;rW.copy(n).invert(),OB.copy(e.ray).applyMatrix4(rW);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=r.index,h=r.attributes.position;if(c!==null){const d=Math.max(0,a.start),p=Math.min(c.count,a.start+a.count);for(let g=d,x=p;g<x;g++){const v=c.getX(g);gT.fromBufferAttribute(h,v),nW(gT,v,l,n,e,i,this)}}else{const d=Math.max(0,a.start),p=Math.min(h.count,a.start+a.count);for(let g=d,x=p;g<x;g++)gT.fromBufferAttribute(h,g),nW(gT,g,l,n,e,i,this)}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function nW(t,e,i,r,n,s,a){const o=OB.distanceSqToPoint(t);if(o<i){const l=new Se;OB.closestPointToPoint(t,l),l.applyMatrix4(r);const c=n.ray.origin.distanceTo(l);if(c<n.near||c>n.far)return;s.push({distance:c,distanceToRay:Math.sqrt(o),point:l,index:e,face:null,faceIndex:null,barycoord:null,object:a})}}class aJ extends ss{constructor(e,i,r,n,s,a,o,l,c){super(e,i,r,n,s,a,o,l,c),this.isVideoTexture=!0,this.minFilter=a!==void 0?a:Cs,this.magFilter=s!==void 0?s:Cs,this.generateMipmaps=!1;const u=this;function h(){u.needsUpdate=!0,e.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class fLe extends aJ{constructor(e,i,r,n,s,a,o,l){super({},e,i,r,n,s,a,o,l),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class pLe extends ss{constructor(e,i){super({width:e,height:i}),this.isFramebufferTexture=!0,this.magFilter=no,this.minFilter=no,this.generateMipmaps=!1,this.needsUpdate=!0}}class bP extends ss{constructor(e,i,r,n,s,a,o,l,c,u,h,d){super(null,a,o,l,c,u,n,s,h,d),this.isCompressedTexture=!0,this.image={width:i,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class mLe extends bP{constructor(e,i,r,n,s,a){super(e,i,r,s,a),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=tu,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class gLe extends bP{constructor(e,i,r){super(void 0,e[0].width,e[0].height,i,r,Lp),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class vLe extends ss{constructor(e,i,r,n,s,a,o,l,c){super(e,i,r,n,s,a,o,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class xF extends ss{constructor(e,i,r,n,s,a,o,l,c,u=A0){if(u!==A0&&u!==H0)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&u===A0&&(r=Ip),r===void 0&&u===H0&&(r=V0),super(null,n,s,a,o,l,u,r,c),this.isDepthTexture=!0,this.image={width:e,height:i},this.magFilter=o!==void 0?o:no,this.minFilter=l!==void 0?l:no,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new fg(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const i=super.toJSON(e);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}class Eh{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(e,i){const r=this.getUtoTmapping(e);return this.getPoint(r,i)}getPoints(e=5){const i=[];for(let r=0;r<=e;r++)i.push(this.getPoint(r/e));return i}getSpacedPoints(e=5){const i=[];for(let r=0;r<=e;r++)i.push(this.getPointAt(r/e));return i}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let r,n=this.getPoint(0),s=0;i.push(0);for(let a=1;a<=e;a++)r=this.getPoint(a/e),s+=r.distanceTo(n),i.push(s),n=r;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,i=null){const r=this.getLengths();let n=0;const s=r.length;let a;i?a=i:a=e*r[s-1];let o=0,l=s-1,c;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),c=r[n]-a,c<0)o=n+1;else if(c>0)l=n-1;else{l=n;break}if(n=l,r[n]===a)return n/(s-1);const u=r[n],d=r[n+1]-u,p=(a-u)/d;return(n+p)/(s-1)}getTangent(e,i){let n=e-1e-4,s=e+1e-4;n<0&&(n=0),s>1&&(s=1);const a=this.getPoint(n),o=this.getPoint(s),l=i||(a.isVector2?new Tt:new Se);return l.copy(o).sub(a).normalize(),l}getTangentAt(e,i){const r=this.getUtoTmapping(e);return this.getTangent(r,i)}computeFrenetFrames(e,i=!1){const r=new Se,n=[],s=[],a=[],o=new Se,l=new Ui;for(let p=0;p<=e;p++){const g=p/e;n[p]=this.getTangentAt(g,new Se)}s[0]=new Se,a[0]=new Se;let c=Number.MAX_VALUE;const u=Math.abs(n[0].x),h=Math.abs(n[0].y),d=Math.abs(n[0].z);u<=c&&(c=u,r.set(1,0,0)),h<=c&&(c=h,r.set(0,1,0)),d<=c&&r.set(0,0,1),o.crossVectors(n[0],r).normalize(),s[0].crossVectors(n[0],o),a[0].crossVectors(n[0],s[0]);for(let p=1;p<=e;p++){if(s[p]=s[p-1].clone(),a[p]=a[p-1].clone(),o.crossVectors(n[p-1],n[p]),o.length()>Number.EPSILON){o.normalize();const g=Math.acos(Qi(n[p-1].dot(n[p]),-1,1));s[p].applyMatrix4(l.makeRotationAxis(o,g))}a[p].crossVectors(n[p],s[p])}if(i===!0){let p=Math.acos(Qi(s[0].dot(s[e]),-1,1));p/=e,n[0].dot(o.crossVectors(s[0],s[e]))>0&&(p=-p);for(let g=1;g<=e;g++)s[g].applyMatrix4(l.makeRotationAxis(n[g],p*g)),a[g].crossVectors(n[g],s[g])}return{tangents:n,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class _P extends Eh{constructor(e=0,i=0,r=1,n=1,s=0,a=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=i,this.xRadius=r,this.yRadius=n,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(e,i=new Tt){const r=i,n=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(a?s=0:s=n),this.aClockwise===!0&&!a&&(s===n?s=-n:s=s-n);const o=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=l-this.aX,p=c-this.aY;l=d*u-p*h+this.aX,c=d*h+p*u+this.aY}return r.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class oJ extends _P{constructor(e,i,r,n,s,a){super(e,i,r,r,n,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function bF(){let t=0,e=0,i=0,r=0;function n(s,a,o,l){t=s,e=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){n(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,u,h){let d=(a-s)/c-(o-s)/(c+u)+(o-a)/u,p=(o-a)/u-(l-a)/(u+h)+(l-o)/h;d*=u,p*=u,n(a,o,d,p)},calc:function(s){const a=s*s,o=a*s;return t+e*s+i*a+r*o}}}const vT=new Se,SI=new bF,wI=new bF,MI=new bF;class lJ extends Eh{constructor(e=[],i=!1,r="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=i,this.curveType=r,this.tension=n}getPoint(e,i=new Se){const r=i,n=this.points,s=n.length,a=(s-(this.closed?0:1))*e;let o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:l===0&&o===s-1&&(o=s-2,l=1);let c,u;this.closed||o>0?c=n[(o-1)%s]:(vT.subVectors(n[0],n[1]).add(n[0]),c=vT);const h=n[o%s],d=n[(o+1)%s];if(this.closed||o+2<s?u=n[(o+2)%s]:(vT.subVectors(n[s-1],n[s-2]).add(n[s-1]),u=vT),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let g=Math.pow(c.distanceToSquared(h),p),x=Math.pow(h.distanceToSquared(d),p),v=Math.pow(d.distanceToSquared(u),p);x<1e-4&&(x=1),g<1e-4&&(g=x),v<1e-4&&(v=x),SI.initNonuniformCatmullRom(c.x,h.x,d.x,u.x,g,x,v),wI.initNonuniformCatmullRom(c.y,h.y,d.y,u.y,g,x,v),MI.initNonuniformCatmullRom(c.z,h.z,d.z,u.z,g,x,v)}else this.curveType==="catmullrom"&&(SI.initCatmullRom(c.x,h.x,d.x,u.x,this.tension),wI.initCatmullRom(c.y,h.y,d.y,u.y,this.tension),MI.initCatmullRom(c.z,h.z,d.z,u.z,this.tension));return r.set(SI.calc(l),wI.calc(l),MI.calc(l)),r}copy(e){super.copy(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const n=e.points[i];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,r=this.points.length;i<r;i++){const n=this.points[i];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const n=e.points[i];this.points.push(new Se().fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function sW(t,e,i,r,n){const s=(r-e)*.5,a=(n-i)*.5,o=t*t,l=t*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*t+i}function yLe(t,e){const i=1-t;return i*i*e}function xLe(t,e){return 2*(1-t)*t*e}function bLe(t,e){return t*t*e}function mw(t,e,i,r){return yLe(t,e)+xLe(t,i)+bLe(t,r)}function _Le(t,e){const i=1-t;return i*i*i*e}function SLe(t,e){const i=1-t;return 3*i*i*t*e}function wLe(t,e){return 3*(1-t)*t*t*e}function MLe(t,e){return t*t*t*e}function gw(t,e,i,r,n){return _Le(t,e)+SLe(t,i)+wLe(t,r)+MLe(t,n)}class _F extends Eh{constructor(e=new Tt,i=new Tt,r=new Tt,n=new Tt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=i,this.v2=r,this.v3=n}getPoint(e,i=new Tt){const r=i,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(gw(e,n.x,s.x,a.x,o.x),gw(e,n.y,s.y,a.y,o.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class cJ extends Eh{constructor(e=new Se,i=new Se,r=new Se,n=new Se){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=i,this.v2=r,this.v3=n}getPoint(e,i=new Se){const r=i,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(gw(e,n.x,s.x,a.x,o.x),gw(e,n.y,s.y,a.y,o.y),gw(e,n.z,s.z,a.z,o.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class SF extends Eh{constructor(e=new Tt,i=new Tt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=i}getPoint(e,i=new Tt){const r=i;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new Tt){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class uJ extends Eh{constructor(e=new Se,i=new Se){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=i}getPoint(e,i=new Se){const r=i;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new Se){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class wF extends Eh{constructor(e=new Tt,i=new Tt,r=new Tt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=i,this.v2=r}getPoint(e,i=new Tt){const r=i,n=this.v0,s=this.v1,a=this.v2;return r.set(mw(e,n.x,s.x,a.x),mw(e,n.y,s.y,a.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class MF extends Eh{constructor(e=new Se,i=new Se,r=new Se){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=i,this.v2=r}getPoint(e,i=new Se){const r=i,n=this.v0,s=this.v1,a=this.v2;return r.set(mw(e,n.x,s.x,a.x),mw(e,n.y,s.y,a.y),mw(e,n.z,s.z,a.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class EF extends Eh{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,i=new Tt){const r=i,n=this.points,s=(n.length-1)*e,a=Math.floor(s),o=s-a,l=n[a===0?a:a-1],c=n[a],u=n[a>n.length-2?n.length-1:a+1],h=n[a>n.length-3?n.length-1:a+2];return r.set(sW(o,l.x,c.x,u.x,h.x),sW(o,l.y,c.y,u.y,h.y)),r}copy(e){super.copy(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const n=e.points[i];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,r=this.points.length;i<r;i++){const n=this.points[i];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const n=e.points[i];this.points.push(new Tt().fromArray(n))}return this}}var h3=Object.freeze({__proto__:null,ArcCurve:oJ,CatmullRomCurve3:lJ,CubicBezierCurve:_F,CubicBezierCurve3:cJ,EllipseCurve:_P,LineCurve:SF,LineCurve3:uJ,QuadraticBezierCurve:wF,QuadraticBezierCurve3:MF,SplineCurve:EF});class hJ extends Eh{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(i)){const r=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new h3[r](i,e))}return this}getPoint(e,i){const r=e*this.getLength(),n=this.getCurveLengths();let s=0;for(;s<n.length;){if(n[s]>=r){const a=n[s]-r,o=this.curves[s],l=o.getLength(),c=l===0?0:1-a/l;return o.getPointAt(c,i)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let i=0;for(let r=0,n=this.curves.length;r<n;r++)i+=this.curves[r].getLength(),e.push(i);return this.cacheLengths=e,e}getSpacedPoints(e=40){const i=[];for(let r=0;r<=e;r++)i.push(this.getPoint(r/e));return this.autoClose&&i.push(i[0]),i}getPoints(e=12){const i=[];let r;for(let n=0,s=this.curves;n<s.length;n++){const a=s[n],o=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,l=a.getPoints(o);for(let c=0;c<l.length;c++){const u=l[c];r&&r.equals(u)||(i.push(u),r=u)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(e){super.copy(e),this.curves=[];for(let i=0,r=e.curves.length;i<r;i++){const n=e.curves[i];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let i=0,r=this.curves.length;i<r;i++){const n=this.curves[i];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let i=0,r=e.curves.length;i<r;i++){const n=e.curves[i];this.curves.push(new h3[n.type]().fromJSON(n))}return this}}class iM extends hJ{constructor(e){super(),this.type="Path",this.currentPoint=new Tt,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let i=1,r=e.length;i<r;i++)this.lineTo(e[i].x,e[i].y);return this}moveTo(e,i){return this.currentPoint.set(e,i),this}lineTo(e,i){const r=new SF(this.currentPoint.clone(),new Tt(e,i));return this.curves.push(r),this.currentPoint.set(e,i),this}quadraticCurveTo(e,i,r,n){const s=new wF(this.currentPoint.clone(),new Tt(e,i),new Tt(r,n));return this.curves.push(s),this.currentPoint.set(r,n),this}bezierCurveTo(e,i,r,n,s,a){const o=new _F(this.currentPoint.clone(),new Tt(e,i),new Tt(r,n),new Tt(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(e){const i=[this.currentPoint.clone()].concat(e),r=new EF(i);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,i,r,n,s,a){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,i+l,r,n,s,a),this}absarc(e,i,r,n,s,a){return this.absellipse(e,i,r,r,n,s,a),this}ellipse(e,i,r,n,s,a,o,l){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,i+u,r,n,s,a,o,l),this}absellipse(e,i,r,n,s,a,o,l){const c=new _P(e,i,r,n,s,a,o,l);if(this.curves.length>0){const h=c.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class kM extends sr{constructor(e=[new Tt(0,-.5),new Tt(.5,0),new Tt(0,.5)],i=12,r=0,n=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:i,phiStart:r,phiLength:n},i=Math.floor(i),n=Qi(n,0,Math.PI*2);const s=[],a=[],o=[],l=[],c=[],u=1/i,h=new Se,d=new Tt,p=new Se,g=new Se,x=new Se;let v=0,b=0;for(let w=0;w<=e.length-1;w++)switch(w){case 0:v=e[w+1].x-e[w].x,b=e[w+1].y-e[w].y,p.x=b*1,p.y=-v,p.z=b*0,x.copy(p),p.normalize(),l.push(p.x,p.y,p.z);break;case e.length-1:l.push(x.x,x.y,x.z);break;default:v=e[w+1].x-e[w].x,b=e[w+1].y-e[w].y,p.x=b*1,p.y=-v,p.z=b*0,g.copy(p),p.x+=x.x,p.y+=x.y,p.z+=x.z,p.normalize(),l.push(p.x,p.y,p.z),x.copy(g)}for(let w=0;w<=i;w++){const M=r+w*u*n,E=Math.sin(M),D=Math.cos(M);for(let T=0;T<=e.length-1;T++){h.x=e[T].x*E,h.y=e[T].y,h.z=e[T].x*D,a.push(h.x,h.y,h.z),d.x=w/i,d.y=T/(e.length-1),o.push(d.x,d.y);const L=l[3*T+0]*E,P=l[3*T+1],R=l[3*T+0]*D;c.push(L,P,R)}}for(let w=0;w<i;w++)for(let M=0;M<e.length-1;M++){const E=M+w*e.length,D=E,T=E+e.length,L=E+e.length+1,P=E+1;s.push(D,T,P),s.push(L,P,T)}this.setIndex(s),this.setAttribute("position",new di(a,3)),this.setAttribute("uv",new di(o,2)),this.setAttribute("normal",new di(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new kM(e.points,e.segments,e.phiStart,e.phiLength)}}class SP extends kM{constructor(e=1,i=1,r=4,n=8){const s=new iM;s.absarc(0,-i/2,e,Math.PI*1.5,0),s.absarc(0,i/2,e,0,Math.PI*.5),super(s.getPoints(r),n),this.type="CapsuleGeometry",this.parameters={radius:e,length:i,capSegments:r,radialSegments:n}}static fromJSON(e){return new SP(e.radius,e.length,e.capSegments,e.radialSegments)}}class wP extends sr{constructor(e=1,i=32,r=0,n=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:i,thetaStart:r,thetaLength:n},i=Math.max(3,i);const s=[],a=[],o=[],l=[],c=new Se,u=new Tt;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let h=0,d=3;h<=i;h++,d+=3){const p=r+h/i*n;c.x=e*Math.cos(p),c.y=e*Math.sin(p),a.push(c.x,c.y,c.z),o.push(0,0,1),u.x=(a[d]/e+1)/2,u.y=(a[d+1]/e+1)/2,l.push(u.x,u.y)}for(let h=1;h<=i;h++)s.push(h,h+1,0);this.setIndex(s),this.setAttribute("position",new di(a,3)),this.setAttribute("normal",new di(o,3)),this.setAttribute("uv",new di(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new wP(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Ab extends sr{constructor(e=1,i=1,r=1,n=32,s=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l};const c=this;n=Math.floor(n),s=Math.floor(s);const u=[],h=[],d=[],p=[];let g=0;const x=[],v=r/2;let b=0;w(),a===!1&&(e>0&&M(!0),i>0&&M(!1)),this.setIndex(u),this.setAttribute("position",new di(h,3)),this.setAttribute("normal",new di(d,3)),this.setAttribute("uv",new di(p,2));function w(){const E=new Se,D=new Se;let T=0;const L=(i-e)/r;for(let P=0;P<=s;P++){const R=[],O=P/s,U=O*(i-e)+e;for(let F=0;F<=n;F++){const V=F/n,k=V*l+o,K=Math.sin(k),X=Math.cos(k);D.x=U*K,D.y=-O*r+v,D.z=U*X,h.push(D.x,D.y,D.z),E.set(K,L,X).normalize(),d.push(E.x,E.y,E.z),p.push(V,1-O),R.push(g++)}x.push(R)}for(let P=0;P<n;P++)for(let R=0;R<s;R++){const O=x[R][P],U=x[R+1][P],F=x[R+1][P+1],V=x[R][P+1];(e>0||R!==0)&&(u.push(O,U,V),T+=3),(i>0||R!==s-1)&&(u.push(U,F,V),T+=3)}c.addGroup(b,T,0),b+=T}function M(E){const D=g,T=new Tt,L=new Se;let P=0;const R=E===!0?e:i,O=E===!0?1:-1;for(let F=1;F<=n;F++)h.push(0,v*O,0),d.push(0,O,0),p.push(.5,.5),g++;const U=g;for(let F=0;F<=n;F++){const k=F/n*l+o,K=Math.cos(k),X=Math.sin(k);L.x=R*X,L.y=v*O,L.z=R*K,h.push(L.x,L.y,L.z),d.push(0,O,0),T.x=K*.5+.5,T.y=X*.5*O+.5,p.push(T.x,T.y),g++}for(let F=0;F<n;F++){const V=D+F,k=U+F;E===!0?u.push(k,k+1,V):u.push(k+1,k,V),P+=3}c.addGroup(b,P,E===!0?1:2),b+=P}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ab(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class MP extends Ab{constructor(e=1,i=1,r=32,n=1,s=!1,a=0,o=Math.PI*2){super(0,e,i,r,n,s,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(e){return new MP(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Ig extends sr{constructor(e=[],i=[],r=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:i,radius:r,detail:n};const s=[],a=[];o(n),c(r),u(),this.setAttribute("position",new di(s,3)),this.setAttribute("normal",new di(s.slice(),3)),this.setAttribute("uv",new di(a,2)),n===0?this.computeVertexNormals():this.normalizeNormals();function o(w){const M=new Se,E=new Se,D=new Se;for(let T=0;T<i.length;T+=3)p(i[T+0],M),p(i[T+1],E),p(i[T+2],D),l(M,E,D,w)}function l(w,M,E,D){const T=D+1,L=[];for(let P=0;P<=T;P++){L[P]=[];const R=w.clone().lerp(E,P/T),O=M.clone().lerp(E,P/T),U=T-P;for(let F=0;F<=U;F++)F===0&&P===T?L[P][F]=R:L[P][F]=R.clone().lerp(O,F/U)}for(let P=0;P<T;P++)for(let R=0;R<2*(T-P)-1;R++){const O=Math.floor(R/2);R%2===0?(d(L[P][O+1]),d(L[P+1][O]),d(L[P][O])):(d(L[P][O+1]),d(L[P+1][O+1]),d(L[P+1][O]))}}function c(w){const M=new Se;for(let E=0;E<s.length;E+=3)M.x=s[E+0],M.y=s[E+1],M.z=s[E+2],M.normalize().multiplyScalar(w),s[E+0]=M.x,s[E+1]=M.y,s[E+2]=M.z}function u(){const w=new Se;for(let M=0;M<s.length;M+=3){w.x=s[M+0],w.y=s[M+1],w.z=s[M+2];const E=v(w)/2/Math.PI+.5,D=b(w)/Math.PI+.5;a.push(E,1-D)}g(),h()}function h(){for(let w=0;w<a.length;w+=6){const M=a[w+0],E=a[w+2],D=a[w+4],T=Math.max(M,E,D),L=Math.min(M,E,D);T>.9&&L<.1&&(M<.2&&(a[w+0]+=1),E<.2&&(a[w+2]+=1),D<.2&&(a[w+4]+=1))}}function d(w){s.push(w.x,w.y,w.z)}function p(w,M){const E=w*3;M.x=e[E+0],M.y=e[E+1],M.z=e[E+2]}function g(){const w=new Se,M=new Se,E=new Se,D=new Se,T=new Tt,L=new Tt,P=new Tt;for(let R=0,O=0;R<s.length;R+=9,O+=6){w.set(s[R+0],s[R+1],s[R+2]),M.set(s[R+3],s[R+4],s[R+5]),E.set(s[R+6],s[R+7],s[R+8]),T.set(a[O+0],a[O+1]),L.set(a[O+2],a[O+3]),P.set(a[O+4],a[O+5]),D.copy(w).add(M).add(E).divideScalar(3);const U=v(D);x(T,O+0,w,U),x(L,O+2,M,U),x(P,O+4,E,U)}}function x(w,M,E,D){D<0&&w.x===1&&(a[M]=w.x-1),E.x===0&&E.z===0&&(a[M]=D/2/Math.PI+.5)}function v(w){return Math.atan2(w.z,-w.x)}function b(w){return Math.atan2(-w.y,Math.sqrt(w.x*w.x+w.z*w.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ig(e.vertices,e.indices,e.radius,e.details)}}class EP extends Ig{constructor(e=1,i=0){const r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,e,i),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new EP(e.radius,e.detail)}}const yT=new Se,xT=new Se,EI=new Se,bT=new Vl;class dJ extends sr{constructor(e=null,i=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:i},e!==null){const n=Math.pow(10,4),s=Math.cos(T0*i),a=e.getIndex(),o=e.getAttribute("position"),l=a?a.count:o.count,c=[0,0,0],u=["a","b","c"],h=new Array(3),d={},p=[];for(let g=0;g<l;g+=3){a?(c[0]=a.getX(g),c[1]=a.getX(g+1),c[2]=a.getX(g+2)):(c[0]=g,c[1]=g+1,c[2]=g+2);const{a:x,b:v,c:b}=bT;if(x.fromBufferAttribute(o,c[0]),v.fromBufferAttribute(o,c[1]),b.fromBufferAttribute(o,c[2]),bT.getNormal(EI),h[0]=`${Math.round(x.x*n)},${Math.round(x.y*n)},${Math.round(x.z*n)}`,h[1]=`${Math.round(v.x*n)},${Math.round(v.y*n)},${Math.round(v.z*n)}`,h[2]=`${Math.round(b.x*n)},${Math.round(b.y*n)},${Math.round(b.z*n)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let w=0;w<3;w++){const M=(w+1)%3,E=h[w],D=h[M],T=bT[u[w]],L=bT[u[M]],P=`${E}_${D}`,R=`${D}_${E}`;R in d&&d[R]?(EI.dot(d[R].normal)<=s&&(p.push(T.x,T.y,T.z),p.push(L.x,L.y,L.z)),d[R]=null):P in d||(d[P]={index0:c[w],index1:c[M],normal:EI.clone()})}}for(const g in d)if(d[g]){const{index0:x,index1:v}=d[g];yT.fromBufferAttribute(o,x),xT.fromBufferAttribute(o,v),p.push(yT.x,yT.y,yT.z),p.push(xT.x,xT.y,xT.z)}this.setAttribute("position",new di(p,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}let C0=class extends iM{constructor(e){super(e),this.uuid=xc(),this.type="Shape",this.holes=[]}getPointsHoles(e){const i=[];for(let r=0,n=this.holes.length;r<n;r++)i[r]=this.holes[r].getPoints(e);return i}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let i=0,r=e.holes.length;i<r;i++){const n=e.holes[i];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let i=0,r=this.holes.length;i<r;i++){const n=this.holes[i];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let i=0,r=e.holes.length;i<r;i++){const n=e.holes[i];this.holes.push(new iM().fromJSON(n))}return this}};class ELe{static triangulate(e,i,r=2){const n=i&&i.length,s=n?i[0]*r:e.length;let a=fJ(e,0,s,r,!0);const o=[];if(!a||a.next===a.prev)return o;let l,c,u,h,d,p,g;if(n&&(a=PLe(e,i,a,r)),e.length>80*r){l=u=e[0],c=h=e[1];for(let x=r;x<s;x+=r)d=e[x],p=e[x+1],d<l&&(l=d),p<c&&(c=p),d>u&&(u=d),p>h&&(h=p);g=Math.max(u-l,h-c),g=g!==0?32767/g:0}return rM(a,o,r,l,c,g,0),o}}function fJ(t,e,i,r,n){let s,a;if(n===VLe(t,e,i,r)>0)for(s=e;s<i;s+=r)a=aW(s,t[s],t[s+1],a);else for(s=i-r;s>=e;s-=r)a=aW(s,t[s],t[s+1],a);return a&&AP(a,a.next)&&(sM(a),a=a.next),a}function W0(t,e){if(!t)return t;e||(e=t);let i=t,r;do if(r=!1,!i.steiner&&(AP(i,i.next)||ts(i.prev,i,i.next)===0)){if(sM(i),i=e=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==e);return e}function rM(t,e,i,r,n,s,a){if(!t)return;!a&&s&&zLe(t,r,n,s);let o=t,l,c;for(;t.prev!==t.next;){if(l=t.prev,c=t.next,s?TLe(t,r,n,s):ALe(t)){e.push(l.i/i|0),e.push(t.i/i|0),e.push(c.i/i|0),sM(t),t=c.next,o=c.next;continue}if(t=c,t===o){a?a===1?(t=CLe(W0(t),e,i),rM(t,e,i,r,n,s,2)):a===2&&DLe(t,e,i,r,n,s):rM(W0(t),e,i,r,n,s,1);break}}}function ALe(t){const e=t.prev,i=t,r=t.next;if(ts(e,i,r)>=0)return!1;const n=e.x,s=i.x,a=r.x,o=e.y,l=i.y,c=r.y,u=n<s?n<a?n:a:s<a?s:a,h=o<l?o<c?o:c:l<c?l:c,d=n>s?n>a?n:a:s>a?s:a,p=o>l?o>c?o:c:l>c?l:c;let g=r.next;for(;g!==e;){if(g.x>=u&&g.x<=d&&g.y>=h&&g.y<=p&&c1(n,o,s,l,a,c,g.x,g.y)&&ts(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function TLe(t,e,i,r){const n=t.prev,s=t,a=t.next;if(ts(n,s,a)>=0)return!1;const o=n.x,l=s.x,c=a.x,u=n.y,h=s.y,d=a.y,p=o<l?o<c?o:c:l<c?l:c,g=u<h?u<d?u:d:h<d?h:d,x=o>l?o>c?o:c:l>c?l:c,v=u>h?u>d?u:d:h>d?h:d,b=LB(p,g,e,i,r),w=LB(x,v,e,i,r);let M=t.prevZ,E=t.nextZ;for(;M&&M.z>=b&&E&&E.z<=w;){if(M.x>=p&&M.x<=x&&M.y>=g&&M.y<=v&&M!==n&&M!==a&&c1(o,u,l,h,c,d,M.x,M.y)&&ts(M.prev,M,M.next)>=0||(M=M.prevZ,E.x>=p&&E.x<=x&&E.y>=g&&E.y<=v&&E!==n&&E!==a&&c1(o,u,l,h,c,d,E.x,E.y)&&ts(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;M&&M.z>=b;){if(M.x>=p&&M.x<=x&&M.y>=g&&M.y<=v&&M!==n&&M!==a&&c1(o,u,l,h,c,d,M.x,M.y)&&ts(M.prev,M,M.next)>=0)return!1;M=M.prevZ}for(;E&&E.z<=w;){if(E.x>=p&&E.x<=x&&E.y>=g&&E.y<=v&&E!==n&&E!==a&&c1(o,u,l,h,c,d,E.x,E.y)&&ts(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function CLe(t,e,i){let r=t;do{const n=r.prev,s=r.next.next;!AP(n,s)&&pJ(n,r,r.next,s)&&nM(n,s)&&nM(s,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(s.i/i|0),sM(r),sM(r.next),r=t=s),r=r.next}while(r!==t);return W0(r)}function DLe(t,e,i,r,n,s){let a=t;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&NLe(a,o)){let l=mJ(a,o);a=W0(a,a.next),l=W0(l,l.next),rM(a,e,i,r,n,s,0),rM(l,e,i,r,n,s,0);return}o=o.next}a=a.next}while(a!==t)}function PLe(t,e,i,r){const n=[];let s,a,o,l,c;for(s=0,a=e.length;s<a;s++)o=e[s]*r,l=s<a-1?e[s+1]*r:t.length,c=fJ(t,o,l,r,!1),c===c.next&&(c.steiner=!0),n.push(BLe(c));for(n.sort(RLe),s=0;s<n.length;s++)i=OLe(n[s],i);return i}function RLe(t,e){return t.x-e.x}function OLe(t,e){const i=LLe(t,e);if(!i)return e;const r=mJ(i,t);return W0(r,r.next),W0(i,i.next)}function LLe(t,e){let i=e,r=-1/0,n;const s=t.x,a=t.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const d=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>r&&(r=d,n=i.x<i.next.x?i:i.next,d===s))return n}i=i.next}while(i!==e);if(!n)return null;const o=n,l=n.x,c=n.y;let u=1/0,h;i=n;do s>=i.x&&i.x>=l&&s!==i.x&&c1(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),nM(i,t)&&(h<u||h===u&&(i.x>n.x||i.x===n.x&&ILe(n,i)))&&(n=i,u=h)),i=i.next;while(i!==o);return n}function ILe(t,e){return ts(t.prev,t,e.prev)<0&&ts(e.next,t,t.next)<0}function zLe(t,e,i,r){let n=t;do n.z===0&&(n.z=LB(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,ULe(n)}function ULe(t){let e,i,r,n,s,a,o,l,c=1;do{for(i=t,t=null,s=null,a=0;i;){for(a++,r=i,o=0,e=0;e<c&&(o++,r=r.nextZ,!!r);e++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(a>1);return t}function LB(t,e,i,r,n){return t=(t-i)*n|0,e=(e-r)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function BLe(t){let e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function c1(t,e,i,r,n,s,a,o){return(n-a)*(e-o)>=(t-a)*(s-o)&&(t-a)*(r-o)>=(i-a)*(e-o)&&(i-a)*(s-o)>=(n-a)*(r-o)}function NLe(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!FLe(t,e)&&(nM(t,e)&&nM(e,t)&&kLe(t,e)&&(ts(t.prev,t,e.prev)||ts(t,e.prev,e))||AP(t,e)&&ts(t.prev,t,t.next)>0&&ts(e.prev,e,e.next)>0)}function ts(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function AP(t,e){return t.x===e.x&&t.y===e.y}function pJ(t,e,i,r){const n=ST(ts(t,e,i)),s=ST(ts(t,e,r)),a=ST(ts(i,r,t)),o=ST(ts(i,r,e));return!!(n!==s&&a!==o||n===0&&_T(t,i,e)||s===0&&_T(t,r,e)||a===0&&_T(i,t,r)||o===0&&_T(i,e,r))}function _T(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function ST(t){return t>0?1:t<0?-1:0}function FLe(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&pJ(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function nM(t,e){return ts(t.prev,t,t.next)<0?ts(t,e,t.next)>=0&&ts(t,t.prev,e)>=0:ts(t,e,t.prev)<0||ts(t,t.next,e)<0}function kLe(t,e){let i=t,r=!1;const n=(t.x+e.x)/2,s=(t.y+e.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==t);return r}function mJ(t,e){const i=new IB(t.i,t.x,t.y),r=new IB(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function aW(t,e,i,r){const n=new IB(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function sM(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function IB(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function VLe(t,e,i,r){let n=0;for(let s=e,a=i-r;s<i;s+=r)n+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return n}class Vd{static area(e){const i=e.length;let r=0;for(let n=i-1,s=0;s<i;n=s++)r+=e[n].x*e[s].y-e[s].x*e[n].y;return r*.5}static isClockWise(e){return Vd.area(e)<0}static triangulateShape(e,i){const r=[],n=[],s=[];oW(e),lW(r,e);let a=e.length;i.forEach(oW);for(let l=0;l<i.length;l++)n.push(a),a+=i[l].length,lW(r,i[l]);const o=ELe.triangulate(r,n);for(let l=0;l<o.length;l+=3)s.push(o.slice(l,l+3));return s}}function oW(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function lW(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class TP extends sr{constructor(e=new C0([new Tt(.5,.5),new Tt(-.5,.5),new Tt(-.5,-.5),new Tt(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:i},e=Array.isArray(e)?e:[e];const r=this,n=[],s=[];for(let o=0,l=e.length;o<l;o++){const c=e[o];a(c)}this.setAttribute("position",new di(n,3)),this.setAttribute("uv",new di(s,2)),this.computeVertexNormals();function a(o){const l=[],c=i.curveSegments!==void 0?i.curveSegments:12,u=i.steps!==void 0?i.steps:1,h=i.depth!==void 0?i.depth:1;let d=i.bevelEnabled!==void 0?i.bevelEnabled:!0,p=i.bevelThickness!==void 0?i.bevelThickness:.2,g=i.bevelSize!==void 0?i.bevelSize:p-.1,x=i.bevelOffset!==void 0?i.bevelOffset:0,v=i.bevelSegments!==void 0?i.bevelSegments:3;const b=i.extrudePath,w=i.UVGenerator!==void 0?i.UVGenerator:HLe;let M,E=!1,D,T,L,P;b&&(M=b.getSpacedPoints(u),E=!0,d=!1,D=b.computeFrenetFrames(u,!1),T=new Se,L=new Se,P=new Se),d||(v=0,p=0,g=0,x=0);const R=o.extractPoints(c);let O=R.shape;const U=R.holes;if(!Vd.isClockWise(O)){O=O.reverse();for(let ge=0,Te=U.length;ge<Te;ge++){const ce=U[ge];Vd.isClockWise(ce)&&(U[ge]=ce.reverse())}}const V=Vd.triangulateShape(O,U),k=O;for(let ge=0,Te=U.length;ge<Te;ge++){const ce=U[ge];O=O.concat(ce)}function K(ge,Te,ce){return Te||console.error("THREE.ExtrudeGeometry: vec does not exist"),ge.clone().addScaledVector(Te,ce)}const X=O.length,$=V.length;function Y(ge,Te,ce){let Ue,ze,Xe;const De=ge.x-Te.x,Ge=ge.y-Te.y,We=ce.x-ge.x,se=ce.y-ge.y,H=De*De+Ge*Ge,Z=De*se-Ge*We;if(Math.abs(Z)>Number.EPSILON){const pe=Math.sqrt(H),we=Math.sqrt(We*We+se*se),J=Te.x-Ge/pe,He=Te.y+De/pe,je=ce.x-se/we,Ye=ce.y+We/we,Ve=((je-J)*se-(Ye-He)*We)/(De*se-Ge*We);Ue=J+De*Ve-ge.x,ze=He+Ge*Ve-ge.y;const Ke=Ue*Ue+ze*ze;if(Ke<=2)return new Tt(Ue,ze);Xe=Math.sqrt(Ke/2)}else{let pe=!1;De>Number.EPSILON?We>Number.EPSILON&&(pe=!0):De<-Number.EPSILON?We<-Number.EPSILON&&(pe=!0):Math.sign(Ge)===Math.sign(se)&&(pe=!0),pe?(Ue=-Ge,ze=De,Xe=Math.sqrt(H)):(Ue=De,ze=Ge,Xe=Math.sqrt(H/2))}return new Tt(Ue/Xe,ze/Xe)}const re=[];for(let ge=0,Te=k.length,ce=Te-1,Ue=ge+1;ge<Te;ge++,ce++,Ue++)ce===Te&&(ce=0),Ue===Te&&(Ue=0),re[ge]=Y(k[ge],k[ce],k[Ue]);const G=[];let j,ee=re.concat();for(let ge=0,Te=U.length;ge<Te;ge++){const ce=U[ge];j=[];for(let Ue=0,ze=ce.length,Xe=ze-1,De=Ue+1;Ue<ze;Ue++,Xe++,De++)Xe===ze&&(Xe=0),De===ze&&(De=0),j[Ue]=Y(ce[Ue],ce[Xe],ce[De]);G.push(j),ee=ee.concat(j)}for(let ge=0;ge<v;ge++){const Te=ge/v,ce=p*Math.cos(Te*Math.PI/2),Ue=g*Math.sin(Te*Math.PI/2)+x;for(let ze=0,Xe=k.length;ze<Xe;ze++){const De=K(k[ze],re[ze],Ue);ue(De.x,De.y,-ce)}for(let ze=0,Xe=U.length;ze<Xe;ze++){const De=U[ze];j=G[ze];for(let Ge=0,We=De.length;Ge<We;Ge++){const se=K(De[Ge],j[Ge],Ue);ue(se.x,se.y,-ce)}}}const oe=g+x;for(let ge=0;ge<X;ge++){const Te=d?K(O[ge],ee[ge],oe):O[ge];E?(L.copy(D.normals[0]).multiplyScalar(Te.x),T.copy(D.binormals[0]).multiplyScalar(Te.y),P.copy(M[0]).add(L).add(T),ue(P.x,P.y,P.z)):ue(Te.x,Te.y,0)}for(let ge=1;ge<=u;ge++)for(let Te=0;Te<X;Te++){const ce=d?K(O[Te],ee[Te],oe):O[Te];E?(L.copy(D.normals[ge]).multiplyScalar(ce.x),T.copy(D.binormals[ge]).multiplyScalar(ce.y),P.copy(M[ge]).add(L).add(T),ue(P.x,P.y,P.z)):ue(ce.x,ce.y,h/u*ge)}for(let ge=v-1;ge>=0;ge--){const Te=ge/v,ce=p*Math.cos(Te*Math.PI/2),Ue=g*Math.sin(Te*Math.PI/2)+x;for(let ze=0,Xe=k.length;ze<Xe;ze++){const De=K(k[ze],re[ze],Ue);ue(De.x,De.y,h+ce)}for(let ze=0,Xe=U.length;ze<Xe;ze++){const De=U[ze];j=G[ze];for(let Ge=0,We=De.length;Ge<We;Ge++){const se=K(De[Ge],j[Ge],Ue);E?ue(se.x,se.y+M[u-1].y,M[u-1].x+ce):ue(se.x,se.y,h+ce)}}}Q(),ae();function Q(){const ge=n.length/3;if(d){let Te=0,ce=X*Te;for(let Ue=0;Ue<$;Ue++){const ze=V[Ue];fe(ze[2]+ce,ze[1]+ce,ze[0]+ce)}Te=u+v*2,ce=X*Te;for(let Ue=0;Ue<$;Ue++){const ze=V[Ue];fe(ze[0]+ce,ze[1]+ce,ze[2]+ce)}}else{for(let Te=0;Te<$;Te++){const ce=V[Te];fe(ce[2],ce[1],ce[0])}for(let Te=0;Te<$;Te++){const ce=V[Te];fe(ce[0]+X*u,ce[1]+X*u,ce[2]+X*u)}}r.addGroup(ge,n.length/3-ge,0)}function ae(){const ge=n.length/3;let Te=0;ne(k,Te),Te+=k.length;for(let ce=0,Ue=U.length;ce<Ue;ce++){const ze=U[ce];ne(ze,Te),Te+=ze.length}r.addGroup(ge,n.length/3-ge,1)}function ne(ge,Te){let ce=ge.length;for(;--ce>=0;){const Ue=ce;let ze=ce-1;ze<0&&(ze=ge.length-1);for(let Xe=0,De=u+v*2;Xe<De;Xe++){const Ge=X*Xe,We=X*(Xe+1),se=Te+Ue+Ge,H=Te+ze+Ge,Z=Te+ze+We,pe=Te+Ue+We;xe(se,H,Z,pe)}}}function ue(ge,Te,ce){l.push(ge),l.push(Te),l.push(ce)}function fe(ge,Te,ce){be(ge),be(Te),be(ce);const Ue=n.length/3,ze=w.generateTopUV(r,n,Ue-3,Ue-2,Ue-1);Ce(ze[0]),Ce(ze[1]),Ce(ze[2])}function xe(ge,Te,ce,Ue){be(ge),be(Te),be(Ue),be(Te),be(ce),be(Ue);const ze=n.length/3,Xe=w.generateSideWallUV(r,n,ze-6,ze-3,ze-2,ze-1);Ce(Xe[0]),Ce(Xe[1]),Ce(Xe[3]),Ce(Xe[1]),Ce(Xe[2]),Ce(Xe[3])}function be(ge){n.push(l[ge*3+0]),n.push(l[ge*3+1]),n.push(l[ge*3+2])}function Ce(ge){s.push(ge.x),s.push(ge.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),i=this.parameters.shapes,r=this.parameters.options;return GLe(i,r,e)}static fromJSON(e,i){const r=[];for(let s=0,a=e.shapes.length;s<a;s++){const o=i[e.shapes[s]];r.push(o)}const n=e.options.extrudePath;return n!==void 0&&(e.options.extrudePath=new h3[n.type]().fromJSON(n)),new TP(r,e.options)}}const HLe={generateTopUV:function(t,e,i,r,n){const s=e[i*3],a=e[i*3+1],o=e[r*3],l=e[r*3+1],c=e[n*3],u=e[n*3+1];return[new Tt(s,a),new Tt(o,l),new Tt(c,u)]},generateSideWallUV:function(t,e,i,r,n,s){const a=e[i*3],o=e[i*3+1],l=e[i*3+2],c=e[r*3],u=e[r*3+1],h=e[r*3+2],d=e[n*3],p=e[n*3+1],g=e[n*3+2],x=e[s*3],v=e[s*3+1],b=e[s*3+2];return Math.abs(o-u)<Math.abs(a-c)?[new Tt(a,1-l),new Tt(c,1-h),new Tt(d,1-g),new Tt(x,1-b)]:[new Tt(o,1-l),new Tt(u,1-h),new Tt(p,1-g),new Tt(v,1-b)]}};function GLe(t,e,i){if(i.shapes=[],Array.isArray(t))for(let r=0,n=t.length;r<n;r++){const s=t[r];i.shapes.push(s.uuid)}else i.shapes.push(t.uuid);return i.options=Object.assign({},e),e.extrudePath!==void 0&&(i.options.extrudePath=e.extrudePath.toJSON()),i}class CP extends Ig{constructor(e=1,i=0){const r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(n,s,e,i),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new CP(e.radius,e.detail)}}class VM extends Ig{constructor(e=1,i=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,n,e,i),this.type="OctahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new VM(e.radius,e.detail)}}class kp extends sr{constructor(e=1,i=1,r=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:r,heightSegments:n};const s=e/2,a=i/2,o=Math.floor(r),l=Math.floor(n),c=o+1,u=l+1,h=e/o,d=i/l,p=[],g=[],x=[],v=[];for(let b=0;b<u;b++){const w=b*d-a;for(let M=0;M<c;M++){const E=M*h-s;g.push(E,-w,0),x.push(0,0,1),v.push(M/o),v.push(1-b/l)}}for(let b=0;b<l;b++)for(let w=0;w<o;w++){const M=w+c*b,E=w+c*(b+1),D=w+1+c*(b+1),T=w+1+c*b;p.push(M,E,T),p.push(E,D,T)}this.setIndex(p),this.setAttribute("position",new di(g,3)),this.setAttribute("normal",new di(x,3)),this.setAttribute("uv",new di(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new kp(e.width,e.height,e.widthSegments,e.heightSegments)}}class DP extends sr{constructor(e=.5,i=1,r=32,n=1,s=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:i,thetaSegments:r,phiSegments:n,thetaStart:s,thetaLength:a},r=Math.max(3,r),n=Math.max(1,n);const o=[],l=[],c=[],u=[];let h=e;const d=(i-e)/n,p=new Se,g=new Tt;for(let x=0;x<=n;x++){for(let v=0;v<=r;v++){const b=s+v/r*a;p.x=h*Math.cos(b),p.y=h*Math.sin(b),l.push(p.x,p.y,p.z),c.push(0,0,1),g.x=(p.x/i+1)/2,g.y=(p.y/i+1)/2,u.push(g.x,g.y)}h+=d}for(let x=0;x<n;x++){const v=x*(r+1);for(let b=0;b<r;b++){const w=b+v,M=w,E=w+r+1,D=w+r+2,T=w+1;o.push(M,E,T),o.push(E,D,T)}}this.setIndex(o),this.setAttribute("position",new di(l,3)),this.setAttribute("normal",new di(c,3)),this.setAttribute("uv",new di(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new DP(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class PP extends sr{constructor(e=new C0([new Tt(0,.5),new Tt(-.5,-.5),new Tt(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:i};const r=[],n=[],s=[],a=[];let o=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let u=0;u<e.length;u++)c(e[u]),this.addGroup(o,l,u),o+=l,l=0;this.setIndex(r),this.setAttribute("position",new di(n,3)),this.setAttribute("normal",new di(s,3)),this.setAttribute("uv",new di(a,2));function c(u){const h=n.length/3,d=u.extractPoints(i);let p=d.shape;const g=d.holes;Vd.isClockWise(p)===!1&&(p=p.reverse());for(let v=0,b=g.length;v<b;v++){const w=g[v];Vd.isClockWise(w)===!0&&(g[v]=w.reverse())}const x=Vd.triangulateShape(p,g);for(let v=0,b=g.length;v<b;v++){const w=g[v];p=p.concat(w)}for(let v=0,b=p.length;v<b;v++){const w=p[v];n.push(w.x,w.y,0),s.push(0,0,1),a.push(w.x,w.y)}for(let v=0,b=x.length;v<b;v++){const w=x[v],M=w[0]+h,E=w[1]+h,D=w[2]+h;r.push(M,E,D),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),i=this.parameters.shapes;return jLe(i,e)}static fromJSON(e,i){const r=[];for(let n=0,s=e.shapes.length;n<s;n++){const a=i[e.shapes[n]];r.push(a)}return new PP(r,e.curveSegments)}}function jLe(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,r=t.length;i<r;i++){const n=t[i];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}class HM extends sr{constructor(e=1,i=32,r=16,n=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:r,phiStart:n,phiLength:s,thetaStart:a,thetaLength:o},i=Math.max(3,Math.floor(i)),r=Math.max(2,Math.floor(r));const l=Math.min(a+o,Math.PI);let c=0;const u=[],h=new Se,d=new Se,p=[],g=[],x=[],v=[];for(let b=0;b<=r;b++){const w=[],M=b/r;let E=0;b===0&&a===0?E=.5/i:b===r&&l===Math.PI&&(E=-.5/i);for(let D=0;D<=i;D++){const T=D/i;h.x=-e*Math.cos(n+T*s)*Math.sin(a+M*o),h.y=e*Math.cos(a+M*o),h.z=e*Math.sin(n+T*s)*Math.sin(a+M*o),g.push(h.x,h.y,h.z),d.copy(h).normalize(),x.push(d.x,d.y,d.z),v.push(T+E,1-M),w.push(c++)}u.push(w)}for(let b=0;b<r;b++)for(let w=0;w<i;w++){const M=u[b][w+1],E=u[b][w],D=u[b+1][w],T=u[b+1][w+1];(b!==0||a>0)&&p.push(M,E,T),(b!==r-1||l<Math.PI)&&p.push(E,D,T)}this.setIndex(p),this.setAttribute("position",new di(g,3)),this.setAttribute("normal",new di(x,3)),this.setAttribute("uv",new di(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new HM(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class RP extends Ig{constructor(e=1,i=0){const r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,n,e,i),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new RP(e.radius,e.detail)}}class OP extends sr{constructor(e=1,i=.4,r=12,n=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:i,radialSegments:r,tubularSegments:n,arc:s},r=Math.floor(r),n=Math.floor(n);const a=[],o=[],l=[],c=[],u=new Se,h=new Se,d=new Se;for(let p=0;p<=r;p++)for(let g=0;g<=n;g++){const x=g/n*s,v=p/r*Math.PI*2;h.x=(e+i*Math.cos(v))*Math.cos(x),h.y=(e+i*Math.cos(v))*Math.sin(x),h.z=i*Math.sin(v),o.push(h.x,h.y,h.z),u.x=e*Math.cos(x),u.y=e*Math.sin(x),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(g/n),c.push(p/r)}for(let p=1;p<=r;p++)for(let g=1;g<=n;g++){const x=(n+1)*p+g-1,v=(n+1)*(p-1)+g-1,b=(n+1)*(p-1)+g,w=(n+1)*p+g;a.push(x,v,w),a.push(v,b,w)}this.setIndex(a),this.setAttribute("position",new di(o,3)),this.setAttribute("normal",new di(l,3)),this.setAttribute("uv",new di(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new OP(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class LP extends sr{constructor(e=1,i=.4,r=64,n=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a},r=Math.floor(r),n=Math.floor(n);const o=[],l=[],c=[],u=[],h=new Se,d=new Se,p=new Se,g=new Se,x=new Se,v=new Se,b=new Se;for(let M=0;M<=r;++M){const E=M/r*s*Math.PI*2;w(E,s,a,e,p),w(E+.01,s,a,e,g),v.subVectors(g,p),b.addVectors(g,p),x.crossVectors(v,b),b.crossVectors(x,v),x.normalize(),b.normalize();for(let D=0;D<=n;++D){const T=D/n*Math.PI*2,L=-i*Math.cos(T),P=i*Math.sin(T);h.x=p.x+(L*b.x+P*x.x),h.y=p.y+(L*b.y+P*x.y),h.z=p.z+(L*b.z+P*x.z),l.push(h.x,h.y,h.z),d.subVectors(h,p).normalize(),c.push(d.x,d.y,d.z),u.push(M/r),u.push(D/n)}}for(let M=1;M<=r;M++)for(let E=1;E<=n;E++){const D=(n+1)*(M-1)+(E-1),T=(n+1)*M+(E-1),L=(n+1)*M+E,P=(n+1)*(M-1)+E;o.push(D,T,P),o.push(T,L,P)}this.setIndex(o),this.setAttribute("position",new di(l,3)),this.setAttribute("normal",new di(c,3)),this.setAttribute("uv",new di(u,2));function w(M,E,D,T,L){const P=Math.cos(M),R=Math.sin(M),O=D/E*M,U=Math.cos(O);L.x=T*(2+U)*.5*P,L.y=T*(2+U)*R*.5,L.z=T*Math.sin(O)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new LP(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class IP extends sr{constructor(e=new MF(new Se(-1,-1,0),new Se(-1,1,0),new Se(1,1,0)),i=64,r=1,n=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:i,radius:r,radialSegments:n,closed:s};const a=e.computeFrenetFrames(i,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new Se,l=new Se,c=new Tt;let u=new Se;const h=[],d=[],p=[],g=[];x(),this.setIndex(g),this.setAttribute("position",new di(h,3)),this.setAttribute("normal",new di(d,3)),this.setAttribute("uv",new di(p,2));function x(){for(let M=0;M<i;M++)v(M);v(s===!1?i:0),w(),b()}function v(M){u=e.getPointAt(M/i,u);const E=a.normals[M],D=a.binormals[M];for(let T=0;T<=n;T++){const L=T/n*Math.PI*2,P=Math.sin(L),R=-Math.cos(L);l.x=R*E.x+P*D.x,l.y=R*E.y+P*D.y,l.z=R*E.z+P*D.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=u.x+r*l.x,o.y=u.y+r*l.y,o.z=u.z+r*l.z,h.push(o.x,o.y,o.z)}}function b(){for(let M=1;M<=i;M++)for(let E=1;E<=n;E++){const D=(n+1)*(M-1)+(E-1),T=(n+1)*M+(E-1),L=(n+1)*M+E,P=(n+1)*(M-1)+E;g.push(D,T,P),g.push(T,L,P)}}function w(){for(let M=0;M<=i;M++)for(let E=0;E<=n;E++)c.x=M/i,c.y=E/n,p.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new IP(new h3[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class gJ extends sr{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const i=[],r=new Set,n=new Se,s=new Se;if(e.index!==null){const a=e.attributes.position,o=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){const h=l[c],d=h.start,p=h.count;for(let g=d,x=d+p;g<x;g+=3)for(let v=0;v<3;v++){const b=o.getX(g+v),w=o.getX(g+(v+1)%3);n.fromBufferAttribute(a,b),s.fromBufferAttribute(a,w),cW(n,s,r)===!0&&(i.push(n.x,n.y,n.z),i.push(s.x,s.y,s.z))}}}else{const a=e.attributes.position;for(let o=0,l=a.count/3;o<l;o++)for(let c=0;c<3;c++){const u=3*o+c,h=3*o+(c+1)%3;n.fromBufferAttribute(a,u),s.fromBufferAttribute(a,h),cW(n,s,r)===!0&&(i.push(n.x,n.y,n.z),i.push(s.x,s.y,s.z))}}this.setAttribute("position",new di(i,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function cW(t,e,i){const r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,n=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return i.has(r)===!0||i.has(n)===!0?!1:(i.add(r),i.add(n),!0)}var uW=Object.freeze({__proto__:null,BoxGeometry:ey,CapsuleGeometry:SP,CircleGeometry:wP,ConeGeometry:MP,CylinderGeometry:Ab,DodecahedronGeometry:EP,EdgesGeometry:dJ,ExtrudeGeometry:TP,IcosahedronGeometry:CP,LatheGeometry:kM,OctahedronGeometry:VM,PlaneGeometry:kp,PolyhedronGeometry:Ig,RingGeometry:DP,ShapeGeometry:PP,SphereGeometry:HM,TetrahedronGeometry:RP,TorusGeometry:OP,TorusKnotGeometry:LP,TubeGeometry:IP,WireframeGeometry:gJ});class vJ extends Bo{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Zt(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class yJ extends _h{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class AF extends Bo{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Zt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Zt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lg,this.normalScale=new Tt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Sc,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class xJ extends AF{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Tt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Qi(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Zt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Zt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Zt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class bJ extends Bo{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Zt(16777215),this.specular=new Zt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Zt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lg,this.normalScale=new Tt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Sc,this.combine=zM,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class _J extends Bo{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Zt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Zt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lg,this.normalScale=new Tt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class SJ extends Bo{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lg,this.normalScale=new Tt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class wJ extends Bo{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Zt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Zt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lg,this.normalScale=new Tt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Sc,this.combine=zM,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class zP extends Bo{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=UK,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class UP extends Bo{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class MJ extends Bo{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Zt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lg,this.normalScale=new Tt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class EJ extends fl{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function g0(t,e,i){return!t||!i&&t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)}function AJ(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function TJ(t){function e(n,s){return t[n]-t[s]}const i=t.length,r=new Array(i);for(let n=0;n!==i;++n)r[n]=n;return r.sort(e),r}function zB(t,e,i){const r=t.length,n=new t.constructor(r);for(let s=0,a=0;a!==r;++s){const o=i[s]*e;for(let l=0;l!==e;++l)n[a++]=t[o+l]}return n}function TF(t,e,i,r){let n=1,s=t[0];for(;s!==void 0&&s[r]===void 0;)s=t[n++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(e.push(s.time),i.push(...a)),s=t[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(e.push(s.time),a.toArray(i,i.length)),s=t[n++];while(s!==void 0);else do a=s[r],a!==void 0&&(e.push(s.time),i.push(a)),s=t[n++];while(s!==void 0)}function WLe(t,e,i,r,n=30){const s=t.clone();s.name=e;const a=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],u=c.getValueSize(),h=[],d=[];for(let p=0;p<c.times.length;++p){const g=c.times[p]*n;if(!(g<i||g>=r)){h.push(c.times[p]);for(let x=0;x<u;++x)d.push(c.values[p*u+x])}}h.length!==0&&(c.times=g0(h,c.times.constructor),c.values=g0(d,c.values.constructor),a.push(c))}s.tracks=a;let o=1/0;for(let l=0;l<s.tracks.length;++l)o>s.tracks[l].times[0]&&(o=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*o);return s.resetDuration(),s}function qLe(t,e=0,i=t,r=30){r<=0&&(r=30);const n=i.tracks.length,s=e/r;for(let a=0;a<n;++a){const o=i.tracks[a],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const c=t.tracks.find(function(b){return b.name===o.name&&b.ValueTypeName===l});if(c===void 0)continue;let u=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);let d=0;const p=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=p/3);const g=o.times.length-1;let x;if(s<=o.times[0]){const b=u,w=h-u;x=o.values.slice(b,w)}else if(s>=o.times[g]){const b=g*h+u,w=b+h-u;x=o.values.slice(b,w)}else{const b=o.createInterpolant(),w=u,M=h-u;b.evaluate(s),x=b.resultBuffer.slice(w,M)}l==="quaternion"&&new so().fromArray(x).normalize().conjugate().toArray(x);const v=c.times.length;for(let b=0;b<v;++b){const w=b*p+d;if(l==="quaternion")so.multiplyQuaternionsFlat(c.values,w,x,0,c.values,w);else{const M=p-d*2;for(let E=0;E<M;++E)c.values[w+E]-=x[E]}}}return t.blendMode=lF,t}const XLe={convertArray:g0,isTypedArray:AJ,getKeyframeOrder:TJ,sortedArray:zB,flattenJSON:TF,subclip:WLe,makeClipAdditive:qLe};class GM{constructor(e,i,r,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new i.constructor(r),this.sampleValues=i,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const i=this.parameterPositions;let r=this._cachedIndex,n=i[r],s=i[r-1];e:{t:{let a;i:{r:if(!(e<n)){for(let o=r+2;;){if(n===void 0){if(e<s)break r;return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===o)break;if(s=n,n=i[++r],e<n)break t}a=i.length;break i}if(!(e>=s)){const o=i[1];e<o&&(r=2,s=o);for(let l=r-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===l)break;if(n=s,s=i[--r-1],e>=s)break t}a=r,r=0;break i}break e}for(;r<a;){const o=r+a>>>1;e<i[o]?a=o:r=o+1}if(n=i[r],s=i[r-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===void 0)return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,s,n)}return this.interpolate_(r,s,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const i=this.resultBuffer,r=this.sampleValues,n=this.valueSize,s=e*n;for(let a=0;a!==n;++a)i[a]=r[s+a];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class CJ extends GM{constructor(e,i,r,n){super(e,i,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:p0,endingEnd:p0}}intervalChanged_(e,i,r){const n=this.parameterPositions;let s=e-2,a=e+1,o=n[s],l=n[a];if(o===void 0)switch(this.getSettings_().endingStart){case m0:s=e,o=2*i-r;break;case Kw:s=n.length-2,o=i+n[s]-n[s+1];break;default:s=e,o=r}if(l===void 0)switch(this.getSettings_().endingEnd){case m0:a=e,l=2*r-i;break;case Kw:a=1,l=r+n[1]-n[0];break;default:a=e-1,l=i}const c=(r-i)*.5,u=this.valueSize;this._weightPrev=c/(i-o),this._weightNext=c/(l-r),this._offsetPrev=s*u,this._offsetNext=a*u}interpolate_(e,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,u=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,p=this._weightNext,g=(r-i)/(n-i),x=g*g,v=x*g,b=-d*v+2*d*x-d*g,w=(1+d)*v+(-1.5-2*d)*x+(-.5+d)*g+1,M=(-1-p)*v+(1.5+p)*x+.5*g,E=p*v-p*x;for(let D=0;D!==o;++D)s[D]=b*a[u+D]+w*a[c+D]+M*a[l+D]+E*a[h+D];return s}}class CF extends GM{constructor(e,i,r,n){super(e,i,r,n)}interpolate_(e,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,u=(r-i)/(n-i),h=1-u;for(let d=0;d!==o;++d)s[d]=a[c+d]*h+a[l+d]*u;return s}}class DJ extends GM{constructor(e,i,r,n){super(e,i,r,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class Ah{constructor(e,i,r,n){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=g0(i,this.TimeBufferType),this.values=g0(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const i=e.constructor;let r;if(i.toJSON!==this.toJSON)r=i.toJSON(e);else{r={name:e.name,times:g0(e.times,Array),values:g0(e.values,Array)};const n=e.getInterpolation();n!==e.DefaultInterpolation&&(r.interpolation=n)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new DJ(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new CF(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new CJ(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let i;switch(e){case Zw:i=this.InterpolantFactoryMethodDiscrete;break;case l3:i=this.InterpolantFactoryMethodLinear;break;case uC:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Zw;case this.InterpolantFactoryMethodLinear:return l3;case this.InterpolantFactoryMethodSmooth:return uC}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const i=this.times;for(let r=0,n=i.length;r!==n;++r)i[r]+=e}return this}scale(e){if(e!==1){const i=this.times;for(let r=0,n=i.length;r!==n;++r)i[r]*=e}return this}trim(e,i){const r=this.times,n=r.length;let s=0,a=n-1;for(;s!==n&&r[s]<e;)++s;for(;a!==-1&&r[a]>i;)--a;if(++a,s!==0||a!==n){s>=a&&(a=Math.max(a,1),s=a-1);const o=this.getValueSize();this.times=r.slice(s,a),this.values=this.values.slice(s*o,a*o)}return this}validate(){let e=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,n=this.values,s=r.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==s;o++){const l=r[o];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,l),e=!1;break}if(a!==null&&a>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,l,a),e=!1;break}a=l}if(n!==void 0&&AJ(n))for(let o=0,l=n.length;o!==l;++o){const c=n[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),i=this.values.slice(),r=this.getValueSize(),n=this.getInterpolation()===uC,s=e.length-1;let a=1;for(let o=1;o<s;++o){let l=!1;const c=e[o],u=e[o+1];if(c!==u&&(o!==1||c!==e[0]))if(n)l=!0;else{const h=o*r,d=h-r,p=h+r;for(let g=0;g!==r;++g){const x=i[h+g];if(x!==i[d+g]||x!==i[p+g]){l=!0;break}}}if(l){if(o!==a){e[a]=e[o];const h=o*r,d=a*r;for(let p=0;p!==r;++p)i[d+p]=i[h+p]}++a}}if(s>0){e[a]=e[s];for(let o=s*r,l=a*r,c=0;c!==r;++c)i[l+c]=i[o+c];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=i.slice(0,a*r)):(this.times=e,this.values=i),this}clone(){const e=this.times.slice(),i=this.values.slice(),r=this.constructor,n=new r(this.name,e,i);return n.createInterpolant=this.createInterpolant,n}}Ah.prototype.TimeBufferType=Float32Array;Ah.prototype.ValueBufferType=Float32Array;Ah.prototype.DefaultInterpolation=l3;class ty extends Ah{constructor(e,i,r){super(e,i,r)}}ty.prototype.ValueTypeName="bool";ty.prototype.ValueBufferType=Array;ty.prototype.DefaultInterpolation=Zw;ty.prototype.InterpolantFactoryMethodLinear=void 0;ty.prototype.InterpolantFactoryMethodSmooth=void 0;class DF extends Ah{}DF.prototype.ValueTypeName="color";class aM extends Ah{}aM.prototype.ValueTypeName="number";class PJ extends GM{constructor(e,i,r,n){super(e,i,r,n)}interpolate_(e,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(r-i)/(n-i);let c=e*o;for(let u=c+o;c!==u;c+=4)so.slerpFlat(s,0,a,c-o,a,c,l);return s}}class jM extends Ah{InterpolantFactoryMethodLinear(e){return new PJ(this.times,this.values,this.getValueSize(),e)}}jM.prototype.ValueTypeName="quaternion";jM.prototype.InterpolantFactoryMethodSmooth=void 0;class iy extends Ah{constructor(e,i,r){super(e,i,r)}}iy.prototype.ValueTypeName="string";iy.prototype.ValueBufferType=Array;iy.prototype.DefaultInterpolation=Zw;iy.prototype.InterpolantFactoryMethodLinear=void 0;iy.prototype.InterpolantFactoryMethodSmooth=void 0;class oM extends Ah{}oM.prototype.ValueTypeName="vector";class lM{constructor(e="",i=-1,r=[],n=dP){this.name=e,this.tracks=r,this.duration=i,this.blendMode=n,this.uuid=xc(),this.duration<0&&this.resetDuration()}static parse(e){const i=[],r=e.tracks,n=1/(e.fps||1);for(let a=0,o=r.length;a!==o;++a)i.push(QLe(r[a]).scale(n));const s=new this(e.name,e.duration,i,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const i=[],r=e.tracks,n={name:e.name,duration:e.duration,tracks:i,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,a=r.length;s!==a;++s)i.push(Ah.toJSON(r[s]));return n}static CreateFromMorphTargetSequence(e,i,r,n){const s=i.length,a=[];for(let o=0;o<s;o++){let l=[],c=[];l.push((o+s-1)%s,o,(o+1)%s),c.push(0,1,0);const u=TJ(l);l=zB(l,1,u),c=zB(c,1,u),!n&&l[0]===0&&(l.push(s),c.push(c[0])),a.push(new aM(".morphTargetInfluences["+i[o].name+"]",l,c).scale(1/r))}return new this(e,-1,a)}static findByName(e,i){let r=e;if(!Array.isArray(e)){const n=e;r=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<r.length;n++)if(r[n].name===i)return r[n];return null}static CreateClipsFromMorphTargetSequences(e,i,r){const n={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,l=e.length;o<l;o++){const c=e[o],u=c.name.match(s);if(u&&u.length>1){const h=u[1];let d=n[h];d||(n[h]=d=[]),d.push(c)}}const a=[];for(const o in n)a.push(this.CreateFromMorphTargetSequence(o,n[o],i,r));return a}static parseAnimation(e,i){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(h,d,p,g,x){if(p.length!==0){const v=[],b=[];TF(p,v,b,g),v.length!==0&&x.push(new h(d,v,b))}},n=[],s=e.name||"default",a=e.fps||30,o=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let h=0;h<c.length;h++){const d=c[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const p={};let g;for(g=0;g<d.length;g++)if(d[g].morphTargets)for(let x=0;x<d[g].morphTargets.length;x++)p[d[g].morphTargets[x]]=-1;for(const x in p){const v=[],b=[];for(let w=0;w!==d[g].morphTargets.length;++w){const M=d[g];v.push(M.time),b.push(M.morphTarget===x?1:0)}n.push(new aM(".morphTargetInfluence["+x+"]",v,b))}l=p.length*a}else{const p=".bones["+i[h].name+"]";r(oM,p+".position",d,"pos",n),r(jM,p+".quaternion",d,"rot",n),r(oM,p+".scale",d,"scl",n)}}return n.length===0?null:new this(s,l,n,o)}resetDuration(){const e=this.tracks;let i=0;for(let r=0,n=e.length;r!==n;++r){const s=this.tracks[r];i=Math.max(i,s.times[s.times.length-1])}return this.duration=i,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let i=0;i<this.tracks.length;i++)e=e&&this.tracks[i].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let i=0;i<this.tracks.length;i++)e.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function YLe(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return aM;case"vector":case"vector2":case"vector3":case"vector4":return oM;case"color":return DF;case"quaternion":return jM;case"bool":case"boolean":return ty;case"string":return iy}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function QLe(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=YLe(t.type);if(t.times===void 0){const i=[],r=[];TF(t.keys,i,r,"value"),t.times=i,t.values=r}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const xp={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class PF{constructor(e,i,r){const n=this;let s=!1,a=0,o=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=i,this.onError=r,this.itemStart=function(u){o++,s===!1&&n.onStart!==void 0&&n.onStart(u,a,o),s=!0},this.itemEnd=function(u){a++,n.onProgress!==void 0&&n.onProgress(u,a,o),a===o&&(s=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(u){n.onError!==void 0&&n.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,h){return c.push(u,h),this},this.removeHandler=function(u){const h=c.indexOf(u);return h!==-1&&c.splice(h,2),this},this.getHandler=function(u){for(let h=0,d=c.length;h<d;h+=2){const p=c[h],g=c[h+1];if(p.global&&(p.lastIndex=0),p.test(u))return g}return null}}}const RJ=new PF;class Ql{constructor(e){this.manager=e!==void 0?e:RJ,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,i){const r=this;return new Promise(function(n,s){r.load(e,n,i,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Ql.DEFAULT_MATERIAL_NAME="__DEFAULT";const Jf={};class ZLe extends Error{constructor(e,i){super(e),this.response=i}}class zp extends Ql{constructor(e){super(e)}load(e,i,r,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=xp.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{i&&i(s),this.manager.itemEnd(e)},0),s;if(Jf[e]!==void 0){Jf[e].push({onLoad:i,onProgress:r,onError:n});return}Jf[e]=[],Jf[e].push({onLoad:i,onProgress:r,onError:n});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,l=this.responseType;fetch(a).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=Jf[e],h=c.body.getReader(),d=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),p=d?parseInt(d):0,g=p!==0;let x=0;const v=new ReadableStream({start(b){w();function w(){h.read().then(({done:M,value:E})=>{if(M)b.close();else{x+=E.byteLength;const D=new ProgressEvent("progress",{lengthComputable:g,loaded:x,total:p});for(let T=0,L=u.length;T<L;T++){const P=u[T];P.onProgress&&P.onProgress(D)}b.enqueue(E),w()}},M=>{b.error(M)})}}});return new Response(v)}else throw new ZLe(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,o));case"json":return c.json();default:if(o===void 0)return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(o),d=h&&h[1]?h[1].toLowerCase():void 0,p=new TextDecoder(d);return c.arrayBuffer().then(g=>p.decode(g))}}}).then(c=>{xp.add(e,c);const u=Jf[e];delete Jf[e];for(let h=0,d=u.length;h<d;h++){const p=u[h];p.onLoad&&p.onLoad(c)}}).catch(c=>{const u=Jf[e];if(u===void 0)throw this.manager.itemError(e),c;delete Jf[e];for(let h=0,d=u.length;h<d;h++){const p=u[h];p.onError&&p.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class KLe extends Ql{constructor(e){super(e)}load(e,i,r,n){const s=this,a=new zp(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(e)}},r,n)}parse(e){const i=[];for(let r=0;r<e.length;r++){const n=lM.parse(e[r]);i.push(n)}return i}}class JLe extends Ql{constructor(e){super(e)}load(e,i,r,n){const s=this,a=[],o=new bP,l=new zp(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let c=0;function u(h){l.load(e[h],function(d){const p=s.parse(d,!0);a[h]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},c+=1,c===6&&(p.mipmapCount===1&&(o.minFilter=Cs),o.image=a,o.format=p.format,o.needsUpdate=!0,i&&i(o))},r,n)}if(Array.isArray(e))for(let h=0,d=e.length;h<d;++h)u(h);else l.load(e,function(h){const d=s.parse(h,!0);if(d.isCubemap){const p=d.mipmaps.length/d.mipmapCount;for(let g=0;g<p;g++){a[g]={mipmaps:[]};for(let x=0;x<d.mipmapCount;x++)a[g].mipmaps.push(d.mipmaps[g*d.mipmapCount+x]),a[g].format=d.format,a[g].width=d.width,a[g].height=d.height}o.image=a}else o.image.width=d.width,o.image.height=d.height,o.mipmaps=d.mipmaps;d.mipmapCount===1&&(o.minFilter=Cs),o.format=d.format,o.needsUpdate=!0,i&&i(o)},r,n);return o}}class cM extends Ql{constructor(e){super(e)}load(e,i,r,n){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=xp.get(e);if(a!==void 0)return s.manager.itemStart(e),setTimeout(function(){i&&i(a),s.manager.itemEnd(e)},0),a;const o=tM("img");function l(){u(),xp.add(e,this),i&&i(this),s.manager.itemEnd(e)}function c(h){u(),n&&n(h),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(e),o.src=e,o}}class $Le extends Ql{constructor(e){super(e)}load(e,i,r,n){const s=new NM;s.colorSpace=Co;const a=new cM(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function l(c){a.load(e[c],function(u){s.images[c]=u,o++,o===6&&(s.needsUpdate=!0,i&&i(s))},void 0,n)}for(let c=0;c<e.length;++c)l(c);return s}}class eIe extends Ql{constructor(e){super(e)}load(e,i,r,n){const s=this,a=new kd,o=new zp(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(e,function(l){let c;try{c=s.parse(l)}catch(u){if(n!==void 0)n(u);else{console.error(u);return}}c.image!==void 0?a.image=c.image:c.data!==void 0&&(a.image.width=c.width,a.image.height=c.height,a.image.data=c.data),a.wrapS=c.wrapS!==void 0?c.wrapS:tu,a.wrapT=c.wrapT!==void 0?c.wrapT:tu,a.magFilter=c.magFilter!==void 0?c.magFilter:Cs,a.minFilter=c.minFilter!==void 0?c.minFilter:Cs,a.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(a.colorSpace=c.colorSpace),c.flipY!==void 0&&(a.flipY=c.flipY),c.format!==void 0&&(a.format=c.format),c.type!==void 0&&(a.type=c.type),c.mipmaps!==void 0&&(a.mipmaps=c.mipmaps,a.minFilter=Id),c.mipmapCount===1&&(a.minFilter=Cs),c.generateMipmaps!==void 0&&(a.generateMipmaps=c.generateMipmaps),a.needsUpdate=!0,i&&i(a,c)},r,n),a}}class tIe extends Ql{constructor(e){super(e)}load(e,i,r,n){const s=new ss,a=new cM(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){s.image=o,s.needsUpdate=!0,i!==void 0&&i(s)},r,n),s}}class zg extends Ir{constructor(e,i=1){super(),this.isLight=!0,this.type="Light",this.color=new Zt(e),this.intensity=i}dispose(){}copy(e,i){return super.copy(e,i),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const i=super.toJSON(e);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(i.object.target=this.target.uuid),i}}class OJ extends zg{constructor(e,i,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ir.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Zt(i)}copy(e,i){return super.copy(e,i),this.groundColor.copy(e.groundColor),this}}const AI=new Ui,hW=new Se,dW=new Se;class RF{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Tt(512,512),this.map=null,this.mapPass=null,this.matrix=new Ui,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new FM,this._frameExtents=new Tt(1,1),this._viewportCount=1,this._viewports=[new Ar(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const i=this.camera,r=this.matrix;hW.setFromMatrixPosition(e.matrixWorld),i.position.copy(hW),dW.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(dW),i.updateMatrixWorld(),AI.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(AI),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(AI)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class iIe extends RF{constructor(){super(new Pa(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const i=this.camera,r=q1*2*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=e.distance||i.far;(r!==i.fov||n!==i.aspect||s!==i.far)&&(i.fov=r,i.aspect=n,i.far=s,i.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class LJ extends zg{constructor(e,i,r=0,n=Math.PI/3,s=0,a=2){super(e,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ir.DEFAULT_UP),this.updateMatrix(),this.target=new Ir,this.distance=r,this.angle=n,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new iIe}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const fW=new Ui,CS=new Se,TI=new Se;class rIe extends RF{constructor(){super(new Pa(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Tt(4,2),this._viewportCount=6,this._viewports=[new Ar(2,1,1,1),new Ar(0,1,1,1),new Ar(3,1,1,1),new Ar(1,1,1,1),new Ar(3,0,1,1),new Ar(1,0,1,1)],this._cubeDirections=[new Se(1,0,0),new Se(-1,0,0),new Se(0,0,1),new Se(0,0,-1),new Se(0,1,0),new Se(0,-1,0)],this._cubeUps=[new Se(0,1,0),new Se(0,1,0),new Se(0,1,0),new Se(0,1,0),new Se(0,0,1),new Se(0,0,-1)]}updateMatrices(e,i=0){const r=this.camera,n=this.matrix,s=e.distance||r.far;s!==r.far&&(r.far=s,r.updateProjectionMatrix()),CS.setFromMatrixPosition(e.matrixWorld),r.position.copy(CS),TI.copy(r.position),TI.add(this._cubeDirections[i]),r.up.copy(this._cubeUps[i]),r.lookAt(TI),r.updateMatrixWorld(),n.makeTranslation(-CS.x,-CS.y,-CS.z),fW.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(fW)}}class IJ extends zg{constructor(e,i,r=0,n=2){super(e,i),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=n,this.shadow=new rIe}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class WM extends mP{constructor(e=-1,i=1,r=1,n=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=r,this.bottom=n,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,i,r,n,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=r-e,a=r+e,o=n+i,l=n-i;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,a=s+c*this.view.width,o-=u*this.view.offsetY,l=o-u*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}class nIe extends RF{constructor(){super(new WM(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class zJ extends zg{constructor(e,i){super(e,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ir.DEFAULT_UP),this.updateMatrix(),this.target=new Ir,this.shadow=new nIe}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class UJ extends zg{constructor(e,i){super(e,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class BJ extends zg{constructor(e,i,r=10,n=10){super(e,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const i=super.toJSON(e);return i.object.width=this.width,i.object.height=this.height,i}}class NJ{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Se)}set(e){for(let i=0;i<9;i++)this.coefficients[i].copy(e[i]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,i){const r=e.x,n=e.y,s=e.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.282095),i.addScaledVector(a[1],.488603*n),i.addScaledVector(a[2],.488603*s),i.addScaledVector(a[3],.488603*r),i.addScaledVector(a[4],1.092548*(r*n)),i.addScaledVector(a[5],1.092548*(n*s)),i.addScaledVector(a[6],.315392*(3*s*s-1)),i.addScaledVector(a[7],1.092548*(r*s)),i.addScaledVector(a[8],.546274*(r*r-n*n)),i}getIrradianceAt(e,i){const r=e.x,n=e.y,s=e.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.886227),i.addScaledVector(a[1],2*.511664*n),i.addScaledVector(a[2],2*.511664*s),i.addScaledVector(a[3],2*.511664*r),i.addScaledVector(a[4],2*.429043*r*n),i.addScaledVector(a[5],2*.429043*n*s),i.addScaledVector(a[6],.743125*s*s-.247708),i.addScaledVector(a[7],2*.429043*r*s),i.addScaledVector(a[8],.429043*(r*r-n*n)),i}add(e){for(let i=0;i<9;i++)this.coefficients[i].add(e.coefficients[i]);return this}addScaledSH(e,i){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],i);return this}scale(e){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(e);return this}lerp(e,i){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],i);return this}equals(e){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(e.coefficients[i]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,i=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].fromArray(e,i+n*3);return this}toArray(e=[],i=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].toArray(e,i+n*3);return e}static getBasisAt(e,i){const r=e.x,n=e.y,s=e.z;i[0]=.282095,i[1]=.488603*n,i[2]=.488603*s,i[3]=.488603*r,i[4]=1.092548*r*n,i[5]=1.092548*n*s,i[6]=.315392*(3*s*s-1),i[7]=1.092548*r*s,i[8]=.546274*(r*r-n*n)}}class FJ extends zg{constructor(e=new NJ,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const i=super.toJSON(e);return i.object.sh=this.sh.toArray(),i}}class BP extends Ql{constructor(e){super(e),this.textures={}}load(e,i,r,n){const s=this,a=new zp(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(e)}},r,n)}parse(e){const i=this.textures;function r(s){return i[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),i[s]}const n=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(n.uuid=e.uuid),e.name!==void 0&&(n.name=e.name),e.color!==void 0&&n.color!==void 0&&n.color.setHex(e.color),e.roughness!==void 0&&(n.roughness=e.roughness),e.metalness!==void 0&&(n.metalness=e.metalness),e.sheen!==void 0&&(n.sheen=e.sheen),e.sheenColor!==void 0&&(n.sheenColor=new Zt().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(n.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&n.emissive!==void 0&&n.emissive.setHex(e.emissive),e.specular!==void 0&&n.specular!==void 0&&n.specular.setHex(e.specular),e.specularIntensity!==void 0&&(n.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&n.specularColor!==void 0&&n.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(n.shininess=e.shininess),e.clearcoat!==void 0&&(n.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(n.dispersion=e.dispersion),e.iridescence!==void 0&&(n.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(n.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(n.transmission=e.transmission),e.thickness!==void 0&&(n.thickness=e.thickness),e.attenuationDistance!==void 0&&(n.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&n.attenuationColor!==void 0&&n.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(n.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(n.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(n.fog=e.fog),e.flatShading!==void 0&&(n.flatShading=e.flatShading),e.blending!==void 0&&(n.blending=e.blending),e.combine!==void 0&&(n.combine=e.combine),e.side!==void 0&&(n.side=e.side),e.shadowSide!==void 0&&(n.shadowSide=e.shadowSide),e.opacity!==void 0&&(n.opacity=e.opacity),e.transparent!==void 0&&(n.transparent=e.transparent),e.alphaTest!==void 0&&(n.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(n.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(n.depthFunc=e.depthFunc),e.depthTest!==void 0&&(n.depthTest=e.depthTest),e.depthWrite!==void 0&&(n.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(n.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(n.blendSrc=e.blendSrc),e.blendDst!==void 0&&(n.blendDst=e.blendDst),e.blendEquation!==void 0&&(n.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(n.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(n.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(n.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&n.blendColor!==void 0&&n.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(n.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(n.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(n.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(n.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(n.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(n.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(n.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(n.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(n.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(n.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(n.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(n.rotation=e.rotation),e.linewidth!==void 0&&(n.linewidth=e.linewidth),e.dashSize!==void 0&&(n.dashSize=e.dashSize),e.gapSize!==void 0&&(n.gapSize=e.gapSize),e.scale!==void 0&&(n.scale=e.scale),e.polygonOffset!==void 0&&(n.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(n.dithering=e.dithering),e.alphaToCoverage!==void 0&&(n.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(n.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(n.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(n.visible=e.visible),e.toneMapped!==void 0&&(n.toneMapped=e.toneMapped),e.userData!==void 0&&(n.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?n.vertexColors=e.vertexColors>0:n.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const a=e.uniforms[s];switch(n.uniforms[s]={},a.type){case"t":n.uniforms[s].value=r(a.value);break;case"c":n.uniforms[s].value=new Zt().setHex(a.value);break;case"v2":n.uniforms[s].value=new Tt().fromArray(a.value);break;case"v3":n.uniforms[s].value=new Se().fromArray(a.value);break;case"v4":n.uniforms[s].value=new Ar().fromArray(a.value);break;case"m3":n.uniforms[s].value=new Yi().fromArray(a.value);break;case"m4":n.uniforms[s].value=new Ui().fromArray(a.value);break;default:n.uniforms[s].value=a.value}}if(e.defines!==void 0&&(n.defines=e.defines),e.vertexShader!==void 0&&(n.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(n.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(n.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)n.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(n.lights=e.lights),e.clipping!==void 0&&(n.clipping=e.clipping),e.size!==void 0&&(n.size=e.size),e.sizeAttenuation!==void 0&&(n.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(n.map=r(e.map)),e.matcap!==void 0&&(n.matcap=r(e.matcap)),e.alphaMap!==void 0&&(n.alphaMap=r(e.alphaMap)),e.bumpMap!==void 0&&(n.bumpMap=r(e.bumpMap)),e.bumpScale!==void 0&&(n.bumpScale=e.bumpScale),e.normalMap!==void 0&&(n.normalMap=r(e.normalMap)),e.normalMapType!==void 0&&(n.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),n.normalScale=new Tt().fromArray(s)}return e.displacementMap!==void 0&&(n.displacementMap=r(e.displacementMap)),e.displacementScale!==void 0&&(n.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(n.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(n.roughnessMap=r(e.roughnessMap)),e.metalnessMap!==void 0&&(n.metalnessMap=r(e.metalnessMap)),e.emissiveMap!==void 0&&(n.emissiveMap=r(e.emissiveMap)),e.emissiveIntensity!==void 0&&(n.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(n.specularMap=r(e.specularMap)),e.specularIntensityMap!==void 0&&(n.specularIntensityMap=r(e.specularIntensityMap)),e.specularColorMap!==void 0&&(n.specularColorMap=r(e.specularColorMap)),e.envMap!==void 0&&(n.envMap=r(e.envMap)),e.envMapRotation!==void 0&&n.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(n.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(n.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(n.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(n.lightMap=r(e.lightMap)),e.lightMapIntensity!==void 0&&(n.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(n.aoMap=r(e.aoMap)),e.aoMapIntensity!==void 0&&(n.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(n.gradientMap=r(e.gradientMap)),e.clearcoatMap!==void 0&&(n.clearcoatMap=r(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(n.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(n.clearcoatNormalMap=r(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(n.clearcoatNormalScale=new Tt().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(n.iridescenceMap=r(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(n.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(n.transmissionMap=r(e.transmissionMap)),e.thicknessMap!==void 0&&(n.thicknessMap=r(e.thicknessMap)),e.anisotropyMap!==void 0&&(n.anisotropyMap=r(e.anisotropyMap)),e.sheenColorMap!==void 0&&(n.sheenColorMap=r(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(n.sheenRoughnessMap=r(e.sheenRoughnessMap)),n}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return BP.createMaterialFromType(e)}static createMaterialFromType(e){const i={ShadowMaterial:vJ,SpriteMaterial:gF,RawShaderMaterial:yJ,ShaderMaterial:_h,PointsMaterial:yF,MeshPhysicalMaterial:xJ,MeshStandardMaterial:AF,MeshPhongMaterial:bJ,MeshToonMaterial:_J,MeshNormalMaterial:SJ,MeshLambertMaterial:wJ,MeshDepthMaterial:zP,MeshDistanceMaterial:UP,MeshBasicMaterial:Fp,MeshMatcapMaterial:MJ,LineDashedMaterial:EJ,LineBasicMaterial:fl,Material:Bo};return new i[e]}}class UB{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let i="";for(let r=0,n=e.length;r<n;r++)i+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(i))}catch{return i}}static extractUrlBase(e){const i=e.lastIndexOf("/");return i===-1?"./":e.slice(0,i+1)}static resolveURL(e,i){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(e)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:i+e)}}class OF extends sr{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class kJ extends Ql{constructor(e){super(e)}load(e,i,r,n){const s=this,a=new zp(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(e)}},r,n)}parse(e){const i={},r={};function n(p,g){if(i[g]!==void 0)return i[g];const v=p.interleavedBuffers[g],b=s(p,v.buffer),w=o1(v.type,b),M=new yP(w,v.stride);return M.uuid=v.uuid,i[g]=M,M}function s(p,g){if(r[g]!==void 0)return r[g];const v=p.arrayBuffers[g],b=new Uint32Array(v).buffer;return r[g]=b,b}const a=e.isInstancedBufferGeometry?new OF:new sr,o=e.data.index;if(o!==void 0){const p=o1(o.type,o.array);a.setIndex(new fn(p,1))}const l=e.data.attributes;for(const p in l){const g=l[p];let x;if(g.isInterleavedBufferAttribute){const v=n(e.data,g.data);x=new G0(v,g.itemSize,g.offset,g.normalized)}else{const v=o1(g.type,g.array),b=g.isInstancedBufferAttribute?j0:fn;x=new b(v,g.itemSize,g.normalized)}g.name!==void 0&&(x.name=g.name),g.usage!==void 0&&x.setUsage(g.usage),a.setAttribute(p,x)}const c=e.data.morphAttributes;if(c)for(const p in c){const g=c[p],x=[];for(let v=0,b=g.length;v<b;v++){const w=g[v];let M;if(w.isInterleavedBufferAttribute){const E=n(e.data,w.data);M=new G0(E,w.itemSize,w.offset,w.normalized)}else{const E=o1(w.type,w.array);M=new fn(E,w.itemSize,w.normalized)}w.name!==void 0&&(M.name=w.name),x.push(M)}a.morphAttributes[p]=x}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const h=e.data.groups||e.data.drawcalls||e.data.offsets;if(h!==void 0)for(let p=0,g=h.length;p!==g;++p){const x=h[p];a.addGroup(x.start,x.count,x.materialIndex)}const d=e.data.boundingSphere;if(d!==void 0){const p=new Se;d.center!==void 0&&p.fromArray(d.center),a.boundingSphere=new oo(p,d.radius)}return e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class sIe extends Ql{constructor(e){super(e)}load(e,i,r,n){const s=this,a=this.path===""?UB.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const o=new zp(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(h){n!==void 0&&n(h),console.error("THREE:ObjectLoader: Can't parse "+e+".",h.message);return}const u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){n!==void 0&&n(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(c,i)},r,n)}async loadAsync(e,i){const r=this,n=this.path===""?UB.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const s=new zp(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const a=await s.loadAsync(e,i),o=JSON.parse(a),l=o.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await r.parseAsync(o)}parse(e,i){const r=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,n),a=this.parseImages(e.images,function(){i!==void 0&&i(c)}),o=this.parseTextures(e.textures,a),l=this.parseMaterials(e.materials,o),c=this.parseObject(e.object,s,l,o,r),u=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,u),this.bindLightTargets(c),i!==void 0){let h=!1;for(const d in a)if(a[d].data instanceof HTMLImageElement){h=!0;break}h===!1&&i(c)}return c}async parseAsync(e){const i=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),n=this.parseGeometries(e.geometries,r),s=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,s),o=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,n,o,a,i),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),this.bindLightTargets(l),l}parseShapes(e){const i={};if(e!==void 0)for(let r=0,n=e.length;r<n;r++){const s=new C0().fromJSON(e[r]);i[s.uuid]=s}return i}parseSkeletons(e,i){const r={},n={};if(i.traverse(function(s){s.isBone&&(n[s.uuid]=s)}),e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=new xP().fromJSON(e[s],n);r[o.uuid]=o}return r}parseGeometries(e,i){const r={};if(e!==void 0){const n=new kJ;for(let s=0,a=e.length;s<a;s++){let o;const l=e[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":o=n.parse(l);break;default:l.type in uW?o=uW[l.type].fromJSON(l,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}o.uuid=l.uuid,l.name!==void 0&&(o.name=l.name),l.userData!==void 0&&(o.userData=l.userData),r[l.uuid]=o}}return r}parseMaterials(e,i){const r={},n={};if(e!==void 0){const s=new BP;s.setTextures(i);for(let a=0,o=e.length;a<o;a++){const l=e[a];r[l.uuid]===void 0&&(r[l.uuid]=s.parse(l)),n[l.uuid]=r[l.uuid]}}return n}parseAnimations(e){const i={};if(e!==void 0)for(let r=0;r<e.length;r++){const n=e[r],s=lM.parse(n);i[s.uuid]=s}return i}parseImages(e,i){const r=this,n={};let s;function a(l){return r.manager.itemStart(l),s.load(l,function(){r.manager.itemEnd(l)},void 0,function(){r.manager.itemError(l),r.manager.itemEnd(l)})}function o(l){if(typeof l=="string"){const c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:r.resourcePath+c;return a(u)}else return l.data?{data:o1(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new PF(i);s=new cM(l),s.setCrossOrigin(this.crossOrigin);for(let c=0,u=e.length;c<u;c++){const h=e[c],d=h.url;if(Array.isArray(d)){const p=[];for(let g=0,x=d.length;g<x;g++){const v=d[g],b=o(v);b!==null&&(b instanceof HTMLImageElement?p.push(b):p.push(new kd(b.data,b.width,b.height)))}n[h.uuid]=new fg(p)}else{const p=o(h.url);n[h.uuid]=new fg(p)}}}return n}async parseImagesAsync(e){const i=this,r={};let n;async function s(a){if(typeof a=="string"){const o=a,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:i.resourcePath+o;return await n.loadAsync(l)}else return a.data?{data:o1(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){n=new cM(this.manager),n.setCrossOrigin(this.crossOrigin);for(let a=0,o=e.length;a<o;a++){const l=e[a],c=l.url;if(Array.isArray(c)){const u=[];for(let h=0,d=c.length;h<d;h++){const p=c[h],g=await s(p);g!==null&&(g instanceof HTMLImageElement?u.push(g):u.push(new kd(g.data,g.width,g.height)))}r[l.uuid]=new fg(u)}else{const u=await s(l.url);r[l.uuid]=new fg(u)}}}return r}parseTextures(e,i){function r(s,a){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),a[s])}const n={};if(e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=e[s];o.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),i[o.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const l=i[o.image],c=l.data;let u;Array.isArray(c)?(u=new NM,c.length===6&&(u.needsUpdate=!0)):(c&&c.data?u=new kd:u=new ss,c&&(u.needsUpdate=!0)),u.source=l,u.uuid=o.uuid,o.name!==void 0&&(u.name=o.name),o.mapping!==void 0&&(u.mapping=r(o.mapping,aIe)),o.channel!==void 0&&(u.channel=o.channel),o.offset!==void 0&&u.offset.fromArray(o.offset),o.repeat!==void 0&&u.repeat.fromArray(o.repeat),o.center!==void 0&&u.center.fromArray(o.center),o.rotation!==void 0&&(u.rotation=o.rotation),o.wrap!==void 0&&(u.wrapS=r(o.wrap[0],pW),u.wrapT=r(o.wrap[1],pW)),o.format!==void 0&&(u.format=o.format),o.internalFormat!==void 0&&(u.internalFormat=o.internalFormat),o.type!==void 0&&(u.type=o.type),o.colorSpace!==void 0&&(u.colorSpace=o.colorSpace),o.minFilter!==void 0&&(u.minFilter=r(o.minFilter,mW)),o.magFilter!==void 0&&(u.magFilter=r(o.magFilter,mW)),o.anisotropy!==void 0&&(u.anisotropy=o.anisotropy),o.flipY!==void 0&&(u.flipY=o.flipY),o.generateMipmaps!==void 0&&(u.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(u.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(u.compareFunction=o.compareFunction),o.userData!==void 0&&(u.userData=o.userData),n[o.uuid]=u}return n}parseObject(e,i,r,n,s){let a;function o(d){return i[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",d),i[d]}function l(d){if(d!==void 0){if(Array.isArray(d)){const p=[];for(let g=0,x=d.length;g<x;g++){const v=d[g];r[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",v),p.push(r[v])}return p}return r[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",d),r[d]}}function c(d){return n[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",d),n[d]}let u,h;switch(e.type){case"Scene":a=new mF,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new Zt(e.background):a.background=c(e.background)),e.environment!==void 0&&(a.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new vP(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new gP(e.fog.color,e.fog.density)),e.fog.name!==""&&(a.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(a.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(a.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new Pa(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new WM(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new UJ(e.color,e.intensity);break;case"DirectionalLight":a=new zJ(e.color,e.intensity),a.target=e.target||"";break;case"PointLight":a=new IJ(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new BJ(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new LJ(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),a.target=e.target||"";break;case"HemisphereLight":a=new OJ(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new FJ().fromJSON(e);break;case"SkinnedMesh":u=o(e.geometry),h=l(e.material),a=new tJ(u,h),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":u=o(e.geometry),h=l(e.material),a=new is(u,h);break;case"InstancedMesh":u=o(e.geometry),h=l(e.material);const d=e.count,p=e.instanceMatrix,g=e.instanceColor;a=new iJ(u,h,d),a.instanceMatrix=new j0(new Float32Array(p.array),16),g!==void 0&&(a.instanceColor=new j0(new Float32Array(g.array),g.itemSize));break;case"BatchedMesh":u=o(e.geometry),h=l(e.material),a=new rJ(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,h),a.geometry=u,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._visibility=e.visibility,a._active=e.active,a._bounds=e.bounds.map(x=>{const v=new ao;v.min.fromArray(x.boxMin),v.max.fromArray(x.boxMax);const b=new oo;return b.radius=x.sphereRadius,b.center.fromArray(x.sphereCenter),{boxInitialized:x.boxInitialized,box:v,sphereInitialized:x.sphereInitialized,sphere:b}}),a._maxInstanceCount=e.maxInstanceCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._geometryCount=e.geometryCount,a._matricesTexture=c(e.matricesTexture.uuid),e.colorsTexture!==void 0&&(a._colorsTexture=c(e.colorsTexture.uuid));break;case"LOD":a=new eJ;break;case"Line":a=new Tg(o(e.geometry),l(e.material));break;case"LineLoop":a=new nJ(o(e.geometry),l(e.material));break;case"LineSegments":a=new nf(o(e.geometry),l(e.material));break;case"PointCloud":case"Points":a=new sJ(o(e.geometry),l(e.material));break;case"Sprite":a=new $K(l(e.material));break;case"Group":a=new l1;break;case"Bone":a=new vF;break;default:a=new Ir}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.up!==void 0&&a.up.fromArray(e.up),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(a.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const d=e.children;for(let p=0;p<d.length;p++)a.add(this.parseObject(d[p],i,r,n,s))}if(e.animations!==void 0){const d=e.animations;for(let p=0;p<d.length;p++){const g=d[p];a.animations.push(s[g])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const d=e.levels;for(let p=0;p<d.length;p++){const g=d[p],x=a.getObjectByProperty("uuid",g.object);x!==void 0&&a.addLevel(x,g.distance,g.hysteresis)}}return a}bindSkeletons(e,i){Object.keys(i).length!==0&&e.traverse(function(r){if(r.isSkinnedMesh===!0&&r.skeleton!==void 0){const n=i[r.skeleton];n===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",r.skeleton):r.bind(n,r.bindMatrix)}})}bindLightTargets(e){e.traverse(function(i){if(i.isDirectionalLight||i.isSpotLight){const r=i.target,n=e.getObjectByProperty("uuid",r);n!==void 0?i.target=n:i.target=new Ir}})}}const aIe={UVMapping:sP,CubeReflectionMapping:Lp,CubeRefractionMapping:Eg,EquirectangularReflectionMapping:qw,EquirectangularRefractionMapping:Xw,CubeUVReflectionMapping:wb},pW={RepeatWrapping:Yw,ClampToEdgeWrapping:tu,MirroredRepeatWrapping:Qw},mW={NearestFilter:no,NearestMipmapNearestFilter:J4,NearestMipmapLinearFilter:a1,LinearFilter:Cs,LinearMipmapNearestFilter:lw,LinearMipmapLinearFilter:Id};class oIe extends Ql{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,i,r,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=xp.get(e);if(a!==void 0){if(s.manager.itemStart(e),a.then){a.then(c=>{i&&i(c),s.manager.itemEnd(e)}).catch(c=>{n&&n(c)});return}return setTimeout(function(){i&&i(a),s.manager.itemEnd(e)},0),a}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader;const l=fetch(e,o).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){return xp.add(e,c),i&&i(c),s.manager.itemEnd(e),c}).catch(function(c){n&&n(c),xp.remove(e),s.manager.itemError(e),s.manager.itemEnd(e)});xp.add(e,l),s.manager.itemStart(e)}}let wT,LF=class{static getContext(){return wT===void 0&&(wT=new(window.AudioContext||window.webkitAudioContext)),wT}static setContext(e){wT=e}};class lIe extends Ql{constructor(e){super(e)}load(e,i,r,n){const s=this,a=new zp(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{const c=l.slice(0);LF.getContext().decodeAudioData(c,function(h){i(h)}).catch(o)}catch(c){o(c)}},r,n);function o(l){n?n(l):console.error(l),s.manager.itemError(e)}}}const gW=new Ui,vW=new Ui,Bv=new Ui;class cIe{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Pa,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Pa,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const i=this._cache;if(i.focus!==e.focus||i.fov!==e.fov||i.aspect!==e.aspect*this.aspect||i.near!==e.near||i.far!==e.far||i.zoom!==e.zoom||i.eyeSep!==this.eyeSep){i.focus=e.focus,i.fov=e.fov,i.aspect=e.aspect*this.aspect,i.near=e.near,i.far=e.far,i.zoom=e.zoom,i.eyeSep=this.eyeSep,Bv.copy(e.projectionMatrix);const n=i.eyeSep/2,s=n*i.near/i.focus,a=i.near*Math.tan(T0*i.fov*.5)/i.zoom;let o,l;vW.elements[12]=-n,gW.elements[12]=n,o=-a*i.aspect+s,l=a*i.aspect+s,Bv.elements[0]=2*i.near/(l-o),Bv.elements[8]=(l+o)/(l-o),this.cameraL.projectionMatrix.copy(Bv),o=-a*i.aspect-s,l=a*i.aspect-s,Bv.elements[0]=2*i.near/(l-o),Bv.elements[8]=(l+o)/(l-o),this.cameraR.projectionMatrix.copy(Bv)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(vW),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(gW)}}class VJ extends Pa{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e,this.index=0}}class IF{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=yW(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=yW();e=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=e}return e}}function yW(){return performance.now()}const Nv=new Se,xW=new so,uIe=new Se,Fv=new Se;class hIe extends Ir{constructor(){super(),this.type="AudioListener",this.context=LF.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new IF}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const i=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Nv,xW,uIe),Fv.set(0,0,-1).applyQuaternion(xW),i.positionX){const n=this.context.currentTime+this.timeDelta;i.positionX.linearRampToValueAtTime(Nv.x,n),i.positionY.linearRampToValueAtTime(Nv.y,n),i.positionZ.linearRampToValueAtTime(Nv.z,n),i.forwardX.linearRampToValueAtTime(Fv.x,n),i.forwardY.linearRampToValueAtTime(Fv.y,n),i.forwardZ.linearRampToValueAtTime(Fv.z,n),i.upX.linearRampToValueAtTime(r.x,n),i.upY.linearRampToValueAtTime(r.y,n),i.upZ.linearRampToValueAtTime(r.z,n)}else i.setPosition(Nv.x,Nv.y,Nv.z),i.setOrientation(Fv.x,Fv.y,Fv.z,r.x,r.y,r.z)}}class HJ extends Ir{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const i=this.context.createBufferSource();return i.buffer=this.buffer,i.loop=this.loop,i.loopStart=this.loopStart,i.loopEnd=this.loopEnd,i.onended=this.onEnded.bind(this),i.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=i,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,i=this.filters.length;e<i;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,i=this.filters.length;e<i;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,i){return super.copy(e,i),e.sourceType!=="buffer"?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const kv=new Se,bW=new so,dIe=new Se,Vv=new Se;class fIe extends HJ{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,i,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=i,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(kv,bW,dIe),Vv.set(0,0,1).applyQuaternion(bW);const i=this.panner;if(i.positionX){const r=this.context.currentTime+this.listener.timeDelta;i.positionX.linearRampToValueAtTime(kv.x,r),i.positionY.linearRampToValueAtTime(kv.y,r),i.positionZ.linearRampToValueAtTime(kv.z,r),i.orientationX.linearRampToValueAtTime(Vv.x,r),i.orientationY.linearRampToValueAtTime(Vv.y,r),i.orientationZ.linearRampToValueAtTime(Vv.z,r)}else i.setPosition(kv.x,kv.y,kv.z),i.setOrientation(Vv.x,Vv.y,Vv.z)}}class pIe{constructor(e,i=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=i,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const i=this.getFrequencyData();for(let r=0;r<i.length;r++)e+=i[r];return e/i.length}}class GJ{constructor(e,i,r){this.binding=e,this.valueSize=r;let n,s,a;switch(i){case"quaternion":n=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:n=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,i){const r=this.buffer,n=this.valueSize,s=e*n+n;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==n;++o)r[s+o]=r[o];a=i}else{a+=i;const o=i/a;this._mixBufferRegion(r,s,0,o,n)}this.cumulativeWeight=a}accumulateAdditive(e){const i=this.buffer,r=this.valueSize,n=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(i,n,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const i=this.valueSize,r=this.buffer,n=e*i+i,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=i*this._origIndex;this._mixBufferRegion(r,n,l,1-s,i)}a>0&&this._mixBufferRegionAdditive(r,n,this._addIndex*i,1,i);for(let l=i,c=i+i;l!==c;++l)if(r[l]!==r[l+i]){o.setValue(r,n);break}}saveOriginalState(){const e=this.binding,i=this.buffer,r=this.valueSize,n=r*this._origIndex;e.getValue(i,n);for(let s=r,a=n;s!==a;++s)i[s]=i[n+s%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,i=e+this.valueSize;for(let r=e;r<i;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[i+r]=this.buffer[e+r]}_select(e,i,r,n,s){if(n>=.5)for(let a=0;a!==s;++a)e[i+a]=e[r+a]}_slerp(e,i,r,n){so.slerpFlat(e,i,e,i,e,r,n)}_slerpAdditive(e,i,r,n,s){const a=this._workIndex*s;so.multiplyQuaternionsFlat(e,a,e,i,e,r),so.slerpFlat(e,i,e,i,e,a,n)}_lerp(e,i,r,n,s){const a=1-n;for(let o=0;o!==s;++o){const l=i+o;e[l]=e[l]*a+e[r+o]*n}}_lerpAdditive(e,i,r,n,s){for(let a=0;a!==s;++a){const o=i+a;e[o]=e[o]+e[r+a]*n}}}const zF="\\[\\]\\.:\\/",mIe=new RegExp("["+zF+"]","g"),UF="[^"+zF+"]",gIe="[^"+zF.replace("\\.","")+"]",vIe=/((?:WC+[\/:])*)/.source.replace("WC",UF),yIe=/(WCOD+)?/.source.replace("WCOD",gIe),xIe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",UF),bIe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",UF),_Ie=new RegExp("^"+vIe+yIe+xIe+bIe+"$"),SIe=["material","materials","bones","map"];class wIe{constructor(e,i,r){const n=r||Lr.parseTrackName(i);this._targetGroup=e,this._bindings=e.subscribe_(i,n)}getValue(e,i){this.bind();const r=this._targetGroup.nCachedObjects_,n=this._bindings[r];n!==void 0&&n.getValue(e,i)}setValue(e,i){const r=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=r.length;n!==s;++n)r[n].setValue(e,i)}bind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=e.length;i!==r;++i)e[i].bind()}unbind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=e.length;i!==r;++i)e[i].unbind()}}class Lr{constructor(e,i,r){this.path=i,this.parsedPath=r||Lr.parseTrackName(i),this.node=Lr.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,r){return e&&e.isAnimationObjectGroup?new Lr.Composite(e,i,r):new Lr(e,i,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(mIe,"")}static parseTrackName(e){const i=_Ie.exec(e);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const s=r.nodeName.substring(n+1);SIe.indexOf(s)!==-1&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=s)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,i){if(i===void 0||i===""||i==="."||i===-1||i===e.name||i===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(i);if(r!==void 0)return r}if(e.children){const r=function(s){for(let a=0;a<s.length;a++){const o=s[a];if(o.name===i||o.uuid===i)return o;const l=r(o.children);if(l)return l}return null},n=r(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)e[i++]=r[n]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=e[i++]}_setValue_array_setNeedsUpdate(e,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node;const i=this.parsedPath,r=i.objectName,n=i.propertyName;let s=i.propertyIndex;if(e||(e=Lr.findNode(this.rootNode,i.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let c=i.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const a=e[n];if(a===void 0){const c=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?o=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(n==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Lr.Composite=wIe;Lr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Lr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Lr.prototype.GetterByBindingType=[Lr.prototype._getValue_direct,Lr.prototype._getValue_array,Lr.prototype._getValue_arrayElement,Lr.prototype._getValue_toArray];Lr.prototype.SetterByBindingTypeAndVersioning=[[Lr.prototype._setValue_direct,Lr.prototype._setValue_direct_setNeedsUpdate,Lr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Lr.prototype._setValue_array,Lr.prototype._setValue_array_setNeedsUpdate,Lr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Lr.prototype._setValue_arrayElement,Lr.prototype._setValue_arrayElement_setNeedsUpdate,Lr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Lr.prototype._setValue_fromArray,Lr.prototype._setValue_fromArray_setNeedsUpdate,Lr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class MIe{constructor(){this.isAnimationObjectGroup=!0,this.uuid=xc(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let r=0,n=arguments.length;r!==n;++r)e[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}add(){const e=this._objects,i=this._indicesByUUID,r=this._paths,n=this._parsedPaths,s=this._bindings,a=s.length;let o,l=e.length,c=this.nCachedObjects_;for(let u=0,h=arguments.length;u!==h;++u){const d=arguments[u],p=d.uuid;let g=i[p];if(g===void 0){g=l++,i[p]=g,e.push(d);for(let x=0,v=a;x!==v;++x)s[x].push(new Lr(d,r[x],n[x]))}else if(g<c){o=e[g];const x=--c,v=e[x];i[v.uuid]=g,e[g]=v,i[p]=x,e[x]=d;for(let b=0,w=a;b!==w;++b){const M=s[b],E=M[x];let D=M[g];M[g]=E,D===void 0&&(D=new Lr(d,r[b],n[b])),M[x]=D}}else e[g]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,i=this._indicesByUUID,r=this._bindings,n=r.length;let s=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const l=arguments[a],c=l.uuid,u=i[c];if(u!==void 0&&u>=s){const h=s++,d=e[h];i[d.uuid]=u,e[u]=d,i[c]=h,e[h]=l;for(let p=0,g=n;p!==g;++p){const x=r[p],v=x[h],b=x[u];x[u]=v,x[h]=b}}}this.nCachedObjects_=s}uncache(){const e=this._objects,i=this._indicesByUUID,r=this._bindings,n=r.length;let s=this.nCachedObjects_,a=e.length;for(let o=0,l=arguments.length;o!==l;++o){const c=arguments[o],u=c.uuid,h=i[u];if(h!==void 0)if(delete i[u],h<s){const d=--s,p=e[d],g=--a,x=e[g];i[p.uuid]=h,e[h]=p,i[x.uuid]=d,e[d]=x,e.pop();for(let v=0,b=n;v!==b;++v){const w=r[v],M=w[d],E=w[g];w[h]=M,w[d]=E,w.pop()}}else{const d=--a,p=e[d];d>0&&(i[p.uuid]=h),e[h]=p,e.pop();for(let g=0,x=n;g!==x;++g){const v=r[g];v[h]=v[d],v.pop()}}}this.nCachedObjects_=s}subscribe_(e,i){const r=this._bindingsIndicesByPath;let n=r[e];const s=this._bindings;if(n!==void 0)return s[n];const a=this._paths,o=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,h=new Array(c);n=s.length,r[e]=n,a.push(e),o.push(i),s.push(h);for(let d=u,p=l.length;d!==p;++d){const g=l[d];h[d]=new Lr(g,e,i)}return h}unsubscribe_(e){const i=this._bindingsIndicesByPath,r=i[e];if(r!==void 0){const n=this._paths,s=this._parsedPaths,a=this._bindings,o=a.length-1,l=a[o],c=e[o];i[c]=r,a[r]=l,a.pop(),s[r]=s[o],s.pop(),n[r]=n[o],n.pop()}}}class jJ{constructor(e,i,r=null,n=i.blendMode){this._mixer=e,this._clip=i,this._localRoot=r,this.blendMode=n;const s=i.tracks,a=s.length,o=new Array(a),l={endingStart:p0,endingEnd:p0};for(let c=0;c!==a;++c){const u=s[c].createInterpolant(null);o[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=IK,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,i){return this.loop=e,this.repetitions=i,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,i,r){if(e.fadeOut(i),this.fadeIn(i),r){const n=this._clip.duration,s=e._clip.duration,a=s/n,o=n/s;e.warp(1,a,i),this.warp(o,1,i)}return this}crossFadeTo(e,i,r){return e.crossFadeFrom(this,i,r)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,i,r){const n=this._mixer,s=n.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,c=o.sampleValues;return l[0]=s,l[1]=s+r,c[0]=e/a,c[1]=i/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,i,r,n){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*r;l<0||r===0?i=0:(this._startTime=null,i=r*l)}i*=this._updateTimeScale(e);const a=this._updateTime(i),o=this._updateWeight(e);if(o>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case lF:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulateAdditive(o);break;case dP:default:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulate(n,o)}}}_updateWeight(e){let i=0;if(this.enabled){i=this.weight;const r=this._weightInterpolant;if(r!==null){const n=r.evaluate(e)[0];i*=n,e>r.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(e){let i=0;if(!this.paused){i=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const n=r.evaluate(e)[0];i*=n,e>r.parameterPositions[1]&&(this.stopWarping(),i===0?this.paused=!0:this.timeScale=i)}}return this._effectiveTimeScale=i,i}_updateTime(e){const i=this._clip.duration,r=this.loop;let n=this.time+e,s=this._loopCount;const a=r===zK;if(e===0)return s===-1?n:a&&(s&1)===1?i-n:n;if(r===LK){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=i)n=i;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=i||n<0){const o=Math.floor(n/i);n-=i*o,s+=Math.abs(o);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?i:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return i-n}return n}_setEndings(e,i,r){const n=this._interpolantSettings;r?(n.endingStart=m0,n.endingEnd=m0):(e?n.endingStart=this.zeroSlopeAtStart?m0:p0:n.endingStart=Kw,i?n.endingEnd=this.zeroSlopeAtEnd?m0:p0:n.endingEnd=Kw)}_scheduleFading(e,i,r){const n=this._mixer,s=n.time;let a=this._weightInterpolant;a===null&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=s,l[0]=i,o[1]=s+e,l[1]=r,this}}const EIe=new Float32Array(1);class AIe extends rf{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,i){const r=e._localRoot||this._root,n=e._clip.tracks,s=n.length,a=e._propertyBindings,o=e._interpolants,l=r.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let h=0;h!==s;++h){const d=n[h],p=d.name;let g=u[p];if(g!==void 0)++g.referenceCount,a[h]=g;else{if(g=a[h],g!==void 0){g._cacheIndex===null&&(++g.referenceCount,this._addInactiveBinding(g,l,p));continue}const x=i&&i._propertyBindings[h].binding.parsedPath;g=new GJ(Lr.create(r,p,x),d.ValueTypeName,d.getValueSize()),++g.referenceCount,this._addInactiveBinding(g,l,p),a[h]=g}o[h].resultBuffer=g.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const r=(e._localRoot||this._root).uuid,n=e._clip.uuid,s=this._actionsByClip[n];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,n,r)}const i=e._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const i=e._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const i=e._cacheIndex;return i!==null&&i<this._nActiveActions}_addInactiveAction(e,i,r){const n=this._actions,s=this._actionsByClip;let a=s[i];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[i]=a;else{const o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=n.length,n.push(e),a.actionByRoot[r]=e}_removeInactiveAction(e){const i=this._actions,r=i[i.length-1],n=e._cacheIndex;r._cacheIndex=n,i[n]=r,i.pop(),e._cacheIndex=null;const s=e._clip.uuid,a=this._actionsByClip,o=a[s],l=o.knownActions,c=l[l.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),e._byClipCacheIndex=null;const h=o.actionByRoot,d=(e._localRoot||this._root).uuid;delete h[d],l.length===0&&delete a[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const i=e._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const i=this._actions,r=e._cacheIndex,n=this._nActiveActions++,s=i[n];e._cacheIndex=n,i[n]=e,s._cacheIndex=r,i[r]=s}_takeBackAction(e){const i=this._actions,r=e._cacheIndex,n=--this._nActiveActions,s=i[n];e._cacheIndex=n,i[n]=e,s._cacheIndex=r,i[r]=s}_addInactiveBinding(e,i,r){const n=this._bindingsByRootAndName,s=this._bindings;let a=n[i];a===void 0&&(a={},n[i]=a),a[r]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const i=this._bindings,r=e.binding,n=r.rootNode.uuid,s=r.path,a=this._bindingsByRootAndName,o=a[n],l=i[i.length-1],c=e._cacheIndex;l._cacheIndex=c,i[c]=l,i.pop(),delete o[s],Object.keys(o).length===0&&delete a[n]}_lendBinding(e){const i=this._bindings,r=e._cacheIndex,n=this._nActiveBindings++,s=i[n];e._cacheIndex=n,i[n]=e,s._cacheIndex=r,i[r]=s}_takeBackBinding(e){const i=this._bindings,r=e._cacheIndex,n=--this._nActiveBindings,s=i[n];e._cacheIndex=n,i[n]=e,s._cacheIndex=r,i[r]=s}_lendControlInterpolant(){const e=this._controlInterpolants,i=this._nActiveControlInterpolants++;let r=e[i];return r===void 0&&(r=new CF(new Float32Array(2),new Float32Array(2),1,EIe),r.__cacheIndex=i,e[i]=r),r}_takeBackControlInterpolant(e){const i=this._controlInterpolants,r=e.__cacheIndex,n=--this._nActiveControlInterpolants,s=i[n];e.__cacheIndex=n,i[n]=e,s.__cacheIndex=r,i[r]=s}clipAction(e,i,r){const n=i||this._root,s=n.uuid;let a=typeof e=="string"?lM.findByName(n,e):e;const o=a!==null?a.uuid:e,l=this._actionsByClip[o];let c=null;if(r===void 0&&(a!==null?r=a.blendMode:r=dP),l!==void 0){const h=l.actionByRoot[s];if(h!==void 0&&h.blendMode===r)return h;c=l.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;const u=new jJ(this,a,i,r);return this._bindAction(u,c),this._addInactiveAction(u,o,s),u}existingAction(e,i){const r=i||this._root,n=r.uuid,s=typeof e=="string"?lM.findByName(r,e):e,a=s?s.uuid:e,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[n]||null}stopAllAction(){const e=this._actions,i=this._nActiveActions;for(let r=i-1;r>=0;--r)e[r].stop();return this}update(e){e*=this.timeScale;const i=this._actions,r=this._nActiveActions,n=this.time+=e,s=Math.sign(e),a=this._accuIndex^=1;for(let c=0;c!==r;++c)i[c]._update(n,e,s,a);const o=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)o[c].apply(a);return this}setTime(e){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const i=this._actions,r=e.uuid,n=this._actionsByClip,s=n[r];if(s!==void 0){const a=s.knownActions;for(let o=0,l=a.length;o!==l;++o){const c=a[o];this._deactivateAction(c);const u=c._cacheIndex,h=i[i.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,i[u]=h,i.pop(),this._removeInactiveBindingsForAction(c)}delete n[r]}}uncacheRoot(e){const i=e.uuid,r=this._actionsByClip;for(const a in r){const o=r[a].actionByRoot,l=o[i];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const n=this._bindingsByRootAndName,s=n[i];if(s!==void 0)for(const a in s){const o=s[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,i){const r=this.existingAction(e,i);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class TIe extends fP{constructor(e=1,i=1,r=1,n={}){super(e,i,n),this.isRenderTarget3D=!0,this.depth=r,this.texture=new pP(null,e,i,r),this.texture.isRenderTargetTexture=!0}}class CIe extends fP{constructor(e=1,i=1,r=1,n={}){super(e,i,n),this.isRenderTargetArray=!0,this.depth=r,this.texture=new BM(null,e,i,r),this.texture.isRenderTargetTexture=!0}}class BF{constructor(e){this.value=e}clone(){return new BF(this.value.clone===void 0?this.value:this.value.clone())}}let DIe=0;class PIe extends rf{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:DIe++}),this.name="",this.usage=$w,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const i=this.uniforms.indexOf(e);return i!==-1&&this.uniforms.splice(i,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const i=e.uniforms;this.uniforms.length=0;for(let r=0,n=i.length;r<n;r++){const s=Array.isArray(i[r])?i[r]:[i[r]];for(let a=0;a<s.length;a++)this.uniforms.push(s[a].clone())}return this}clone(){return new this.constructor().copy(this)}}class RIe extends yP{constructor(e,i,r=1){super(e,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const i=super.clone(e);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(e){const i=super.toJSON(e);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}class OIe{constructor(e,i,r,n,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=i,this.itemSize=r,this.elementSize=n,this.count=s,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,i){return this.type=e,this.elementSize=i,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const _W=new Ui;class WJ{constructor(e,i,r=0,n=1/0){this.ray=new Eb(e,i),this.near=r,this.far=n,this.camera=null,this.layers=new X1,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,i){this.ray.set(e,i)}setFromCamera(e,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}setFromXRController(e){return _W.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(_W),this}intersectObject(e,i=!0,r=[]){return BB(e,this,r,i),r.sort(SW),r}intersectObjects(e,i=!0,r=[]){for(let n=0,s=e.length;n<s;n++)BB(e[n],this,r,i);return r.sort(SW),r}}function SW(t,e){return t.distance-e.distance}function BB(t,e,i,r){let n=!0;if(t.layers.test(e.layers)&&t.raycast(e,i)===!1&&(n=!1),n===!0&&r===!0){const s=t.children;for(let a=0,o=s.length;a<o;a++)BB(s[a],e,i,!0)}}class LIe{constructor(e=1,i=0,r=0){this.radius=e,this.phi=i,this.theta=r}set(e,i,r){return this.radius=e,this.phi=i,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Qi(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,r){return this.radius=Math.sqrt(e*e+i*i+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(Qi(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class IIe{constructor(e=1,i=0,r=0){this.radius=e,this.theta=i,this.y=r}set(e,i,r){return this.radius=e,this.theta=i,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=i,this}clone(){return new this.constructor().copy(this)}}class NF{constructor(e,i,r,n){NF.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,i,r,n)}identity(){return this.set(1,0,0,1),this}fromArray(e,i=0){for(let r=0;r<4;r++)this.elements[r]=e[r+i];return this}set(e,i,r,n){const s=this.elements;return s[0]=e,s[2]=i,s[1]=r,s[3]=n,this}}const wW=new Tt;class zIe{constructor(e=new Tt(1/0,1/0),i=new Tt(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromPoints(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const r=wW.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,wW).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const MW=new Se,MT=new Se;class UIe{constructor(e=new Se,i=new Se){this.start=e,this.end=i}set(e,i){return this.start.copy(e),this.end.copy(i),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,i){return this.delta(i).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,i){MW.subVectors(e,this.start),MT.subVectors(this.end,this.start);const r=MT.dot(MT);let s=MT.dot(MW)/r;return i&&(s=Qi(s,0,1)),s}closestPointToPoint(e,i,r){const n=this.closestPointToPointParameter(e,i);return this.delta(r).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const EW=new Se;class BIe extends Ir{constructor(e,i){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=i,this.type="SpotLightHelper";const r=new sr,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,l=32;a<l;a++,o++){const c=a/l*Math.PI*2,u=o/l*Math.PI*2;n.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}r.setAttribute("position",new di(n,3));const s=new fl({fog:!1,toneMapped:!1});this.cone=new nf(r,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,i=e*Math.tan(this.light.angle);this.cone.scale.set(i,i,e),EW.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(EW),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const jm=new Se,ET=new Ui,CI=new Ui;class NIe extends nf{constructor(e){const i=qJ(e),r=new sr,n=[],s=[],a=new Zt(0,0,1),o=new Zt(0,1,0);for(let c=0;c<i.length;c++){const u=i[c];u.parent&&u.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),s.push(a.r,a.g,a.b),s.push(o.r,o.g,o.b))}r.setAttribute("position",new di(n,3)),r.setAttribute("color",new di(s,3));const l=new fl({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=i,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const i=this.bones,r=this.geometry,n=r.getAttribute("position");CI.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<i.length;s++){const o=i[s];o.parent&&o.parent.isBone&&(ET.multiplyMatrices(CI,o.matrixWorld),jm.setFromMatrixPosition(ET),n.setXYZ(a,jm.x,jm.y,jm.z),ET.multiplyMatrices(CI,o.parent.matrixWorld),jm.setFromMatrixPosition(ET),n.setXYZ(a+1,jm.x,jm.y,jm.z),a+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function qJ(t){const e=[];t.isBone===!0&&e.push(t);for(let i=0;i<t.children.length;i++)e.push(...qJ(t.children[i]));return e}class FIe extends is{constructor(e,i,r){const n=new HM(i,4,2),s=new Fp({wireframe:!0,fog:!1,toneMapped:!1});super(n,s),this.light=e,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const kIe=new Se,AW=new Zt,TW=new Zt;class VIe extends Ir{constructor(e,i,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const n=new VM(i);n.rotateY(Math.PI*.5),this.material=new Fp({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=n.getAttribute("position"),a=new Float32Array(s.count*3);n.setAttribute("color",new fn(a,3)),this.add(new is(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const i=e.geometry.getAttribute("color");AW.copy(this.light.color),TW.copy(this.light.groundColor);for(let r=0,n=i.count;r<n;r++){const s=r<n/2?AW:TW;i.setXYZ(r,s.r,s.g,s.b)}i.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(kIe.setFromMatrixPosition(this.light.matrixWorld).negate())}}class HIe extends nf{constructor(e=10,i=10,r=4473924,n=8947848){r=new Zt(r),n=new Zt(n);const s=i/2,a=e/i,o=e/2,l=[],c=[];for(let d=0,p=0,g=-o;d<=i;d++,g+=a){l.push(-o,0,g,o,0,g),l.push(g,0,-o,g,0,o);const x=d===s?r:n;x.toArray(c,p),p+=3,x.toArray(c,p),p+=3,x.toArray(c,p),p+=3,x.toArray(c,p),p+=3}const u=new sr;u.setAttribute("position",new di(l,3)),u.setAttribute("color",new di(c,3));const h=new fl({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class GIe extends nf{constructor(e=10,i=16,r=8,n=64,s=4473924,a=8947848){s=new Zt(s),a=new Zt(a);const o=[],l=[];if(i>1)for(let h=0;h<i;h++){const d=h/i*(Math.PI*2),p=Math.sin(d)*e,g=Math.cos(d)*e;o.push(0,0,0),o.push(p,0,g);const x=h&1?s:a;l.push(x.r,x.g,x.b),l.push(x.r,x.g,x.b)}for(let h=0;h<r;h++){const d=h&1?s:a,p=e-e/r*h;for(let g=0;g<n;g++){let x=g/n*(Math.PI*2),v=Math.sin(x)*p,b=Math.cos(x)*p;o.push(v,0,b),l.push(d.r,d.g,d.b),x=(g+1)/n*(Math.PI*2),v=Math.sin(x)*p,b=Math.cos(x)*p,o.push(v,0,b),l.push(d.r,d.g,d.b)}}const c=new sr;c.setAttribute("position",new di(o,3)),c.setAttribute("color",new di(l,3));const u=new fl({vertexColors:!0,toneMapped:!1});super(c,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const CW=new Se,AT=new Se,DW=new Se;class jIe extends Ir{constructor(e,i,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",i===void 0&&(i=1);let n=new sr;n.setAttribute("position",new di([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));const s=new fl({fog:!1,toneMapped:!1});this.lightPlane=new Tg(n,s),this.add(this.lightPlane),n=new sr,n.setAttribute("position",new di([0,0,0,0,0,1],3)),this.targetLine=new Tg(n,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),CW.setFromMatrixPosition(this.light.matrixWorld),AT.setFromMatrixPosition(this.light.target.matrixWorld),DW.subVectors(AT,CW),this.lightPlane.lookAt(AT),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(AT),this.targetLine.scale.z=DW.length()}}const TT=new Se,gs=new mP;class WIe extends nf{constructor(e){const i=new sr,r=new fl({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],s=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(g,x){l(g),l(x)}function l(g){n.push(0,0,0),s.push(0,0,0),a[g]===void 0&&(a[g]=[]),a[g].push(n.length/3-1)}i.setAttribute("position",new di(n,3)),i.setAttribute("color",new di(s,3)),super(i,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const c=new Zt(16755200),u=new Zt(16711680),h=new Zt(43775),d=new Zt(16777215),p=new Zt(3355443);this.setColors(c,u,h,d,p)}setColors(e,i,r,n,s){const o=this.geometry.getAttribute("color");o.setXYZ(0,e.r,e.g,e.b),o.setXYZ(1,e.r,e.g,e.b),o.setXYZ(2,e.r,e.g,e.b),o.setXYZ(3,e.r,e.g,e.b),o.setXYZ(4,e.r,e.g,e.b),o.setXYZ(5,e.r,e.g,e.b),o.setXYZ(6,e.r,e.g,e.b),o.setXYZ(7,e.r,e.g,e.b),o.setXYZ(8,e.r,e.g,e.b),o.setXYZ(9,e.r,e.g,e.b),o.setXYZ(10,e.r,e.g,e.b),o.setXYZ(11,e.r,e.g,e.b),o.setXYZ(12,e.r,e.g,e.b),o.setXYZ(13,e.r,e.g,e.b),o.setXYZ(14,e.r,e.g,e.b),o.setXYZ(15,e.r,e.g,e.b),o.setXYZ(16,e.r,e.g,e.b),o.setXYZ(17,e.r,e.g,e.b),o.setXYZ(18,e.r,e.g,e.b),o.setXYZ(19,e.r,e.g,e.b),o.setXYZ(20,e.r,e.g,e.b),o.setXYZ(21,e.r,e.g,e.b),o.setXYZ(22,e.r,e.g,e.b),o.setXYZ(23,e.r,e.g,e.b),o.setXYZ(24,i.r,i.g,i.b),o.setXYZ(25,i.r,i.g,i.b),o.setXYZ(26,i.r,i.g,i.b),o.setXYZ(27,i.r,i.g,i.b),o.setXYZ(28,i.r,i.g,i.b),o.setXYZ(29,i.r,i.g,i.b),o.setXYZ(30,i.r,i.g,i.b),o.setXYZ(31,i.r,i.g,i.b),o.setXYZ(32,r.r,r.g,r.b),o.setXYZ(33,r.r,r.g,r.b),o.setXYZ(34,r.r,r.g,r.b),o.setXYZ(35,r.r,r.g,r.b),o.setXYZ(36,r.r,r.g,r.b),o.setXYZ(37,r.r,r.g,r.b),o.setXYZ(38,n.r,n.g,n.b),o.setXYZ(39,n.r,n.g,n.b),o.setXYZ(40,s.r,s.g,s.b),o.setXYZ(41,s.r,s.g,s.b),o.setXYZ(42,s.r,s.g,s.b),o.setXYZ(43,s.r,s.g,s.b),o.setXYZ(44,s.r,s.g,s.b),o.setXYZ(45,s.r,s.g,s.b),o.setXYZ(46,s.r,s.g,s.b),o.setXYZ(47,s.r,s.g,s.b),o.setXYZ(48,s.r,s.g,s.b),o.setXYZ(49,s.r,s.g,s.b),o.needsUpdate=!0}update(){const e=this.geometry,i=this.pointMap,r=1,n=1;gs.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const s=this.camera.coordinateSystem===fh?-1:0;Ts("c",i,e,gs,0,0,s),Ts("t",i,e,gs,0,0,1),Ts("n1",i,e,gs,-1,-1,s),Ts("n2",i,e,gs,r,-1,s),Ts("n3",i,e,gs,-1,n,s),Ts("n4",i,e,gs,r,n,s),Ts("f1",i,e,gs,-1,-1,1),Ts("f2",i,e,gs,r,-1,1),Ts("f3",i,e,gs,-1,n,1),Ts("f4",i,e,gs,r,n,1),Ts("u1",i,e,gs,r*.7,n*1.1,s),Ts("u2",i,e,gs,-1*.7,n*1.1,s),Ts("u3",i,e,gs,0,n*2,s),Ts("cf1",i,e,gs,-1,0,1),Ts("cf2",i,e,gs,r,0,1),Ts("cf3",i,e,gs,0,-1,1),Ts("cf4",i,e,gs,0,n,1),Ts("cn1",i,e,gs,-1,0,s),Ts("cn2",i,e,gs,r,0,s),Ts("cn3",i,e,gs,0,-1,s),Ts("cn4",i,e,gs,0,n,s),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ts(t,e,i,r,n,s,a){TT.set(n,s,a).unproject(r);const o=e[t];if(o!==void 0){const l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],TT.x,TT.y,TT.z)}}const CT=new ao;class qIe extends nf{constructor(e,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(8*3),s=new sr;s.setIndex(new fn(r,1)),s.setAttribute("position",new fn(n,3)),super(s,new fl({color:i,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&CT.setFromObject(this.object),CT.isEmpty())return;const e=CT.min,i=CT.max,r=this.geometry.attributes.position,n=r.array;n[0]=i.x,n[1]=i.y,n[2]=i.z,n[3]=e.x,n[4]=i.y,n[5]=i.z,n[6]=e.x,n[7]=e.y,n[8]=i.z,n[9]=i.x,n[10]=e.y,n[11]=i.z,n[12]=i.x,n[13]=i.y,n[14]=e.z,n[15]=e.x,n[16]=i.y,n[17]=e.z,n[18]=e.x,n[19]=e.y,n[20]=e.z,n[21]=i.x,n[22]=e.y,n[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,i){return super.copy(e,i),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class XIe extends nf{constructor(e,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new sr;s.setIndex(new fn(r,1)),s.setAttribute("position",new di(n,3)),super(s,new fl({color:i,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const i=this.box;i.isEmpty()||(i.getCenter(this.position),i.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class YIe extends Tg{constructor(e,i=1,r=16776960){const n=r,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new sr;a.setAttribute("position",new di(s,3)),a.computeBoundingSphere(),super(a,new fl({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=i;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new sr;l.setAttribute("position",new di(o,3)),l.computeBoundingSphere(),this.add(new is(l,new Fp({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const PW=new Se;let DT,DI;class QIe extends Ir{constructor(e=new Se(0,0,1),i=new Se(0,0,0),r=1,n=16776960,s=r*.2,a=s*.2){super(),this.type="ArrowHelper",DT===void 0&&(DT=new sr,DT.setAttribute("position",new di([0,0,0,0,1,0],3)),DI=new Ab(0,.5,1,5,1),DI.translate(0,-.5,0)),this.position.copy(i),this.line=new Tg(DT,new fl({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new is(DI,new Fp({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,s,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{PW.set(e.z,0,-e.x).normalize();const i=Math.acos(e.y);this.quaternion.setFromAxisAngle(PW,i)}}setLength(e,i=e*.2,r=i*.2){this.line.scale.set(1,Math.max(1e-4,e-i),1),this.line.updateMatrix(),this.cone.scale.set(r,i,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class ZIe extends nf{constructor(e=1){const i=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],n=new sr;n.setAttribute("position",new di(i,3)),n.setAttribute("color",new di(r,3));const s=new fl({vertexColors:!0,toneMapped:!1});super(n,s),this.type="AxesHelper"}setColors(e,i,r){const n=new Zt,s=this.geometry.attributes.color.array;return n.set(e),n.toArray(s,0),n.toArray(s,3),n.set(i),n.toArray(s,6),n.toArray(s,9),n.set(r),n.toArray(s,12),n.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class KIe{constructor(){this.type="ShapePath",this.color=new Zt,this.subPaths=[],this.currentPath=null}moveTo(e,i){return this.currentPath=new iM,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,i),this}lineTo(e,i){return this.currentPath.lineTo(e,i),this}quadraticCurveTo(e,i,r,n){return this.currentPath.quadraticCurveTo(e,i,r,n),this}bezierCurveTo(e,i,r,n,s,a){return this.currentPath.bezierCurveTo(e,i,r,n,s,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function i(b){const w=[];for(let M=0,E=b.length;M<E;M++){const D=b[M],T=new C0;T.curves=D.curves,w.push(T)}return w}function r(b,w){const M=w.length;let E=!1;for(let D=M-1,T=0;T<M;D=T++){let L=w[D],P=w[T],R=P.x-L.x,O=P.y-L.y;if(Math.abs(O)>Number.EPSILON){if(O<0&&(L=w[T],R=-R,P=w[D],O=-O),b.y<L.y||b.y>P.y)continue;if(b.y===L.y){if(b.x===L.x)return!0}else{const U=O*(b.x-L.x)-R*(b.y-L.y);if(U===0)return!0;if(U<0)continue;E=!E}}else{if(b.y!==L.y)continue;if(P.x<=b.x&&b.x<=L.x||L.x<=b.x&&b.x<=P.x)return!0}}return E}const n=Vd.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,o,l;const c=[];if(s.length===1)return o=s[0],l=new C0,l.curves=o.curves,c.push(l),c;let u=!n(s[0].getPoints());u=e?!u:u;const h=[],d=[];let p=[],g=0,x;d[g]=void 0,p[g]=[];for(let b=0,w=s.length;b<w;b++)o=s[b],x=o.getPoints(),a=n(x),a=e?!a:a,a?(!u&&d[g]&&g++,d[g]={s:new C0,p:x},d[g].s.curves=o.curves,u&&g++,p[g]=[]):p[g].push({h:o,p:x[0]});if(!d[0])return i(s);if(d.length>1){let b=!1,w=0;for(let M=0,E=d.length;M<E;M++)h[M]=[];for(let M=0,E=d.length;M<E;M++){const D=p[M];for(let T=0;T<D.length;T++){const L=D[T];let P=!0;for(let R=0;R<d.length;R++)r(L.p,d[R].p)&&(M!==R&&w++,P?(P=!1,h[R].push(L)):b=!0);P&&h[M].push(L)}}w>0&&b===!1&&(p=h)}let v;for(let b=0,w=d.length;b<w;b++){l=d[b].s,c.push(l),v=p[b];for(let M=0,E=v.length;M<E;M++)l.holes.push(v[M].h)}return c}}class JIe extends rf{constructor(e,i=null){super(),this.object=e,this.domElement=i,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}function $Ie(t,e){const i=t.image&&t.image.width?t.image.width/t.image.height:1;return i>e?(t.repeat.x=1,t.repeat.y=i/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2):(t.repeat.x=e/i,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0),t}function eze(t,e){const i=t.image&&t.image.width?t.image.width/t.image.height:1;return i>e?(t.repeat.x=e/i,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0):(t.repeat.x=1,t.repeat.y=i/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2),t}function tze(t){return t.repeat.x=1,t.repeat.y=1,t.offset.x=0,t.offset.y=0,t}function NB(t,e,i,r){const n=ize(r);switch(i){case iF:return t*e;case nF:return t*e;case sF:return t*e*2;case cP:return t*e/n.components*n.byteLength;case UM:return t*e/n.components*n.byteLength;case aF:return t*e*2/n.components*n.byteLength;case uP:return t*e*2/n.components*n.byteLength;case rF:return t*e*3/n.components*n.byteLength;case Lo:return t*e*4/n.components*n.byteLength;case hP:return t*e*4/n.components*n.byteLength;case cw:case uw:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case hw:case dw:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case BD:case FD:return Math.max(t,16)*Math.max(e,8)/4;case UD:case ND:return Math.max(t,8)*Math.max(e,8)/2;case kD:case VD:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case HD:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case GD:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case jD:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case WD:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case qD:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case XD:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case YD:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case QD:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case ZD:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case KD:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case JD:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case $D:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case e3:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case t3:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case i3:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case fw:case r3:case n3:return Math.ceil(t/4)*Math.ceil(e/4)*16;case oF:case s3:return Math.ceil(t/4)*Math.ceil(e/4)*8;case a3:case o3:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${i} format.`)}function ize(t){switch(t){case bh:case $4:return{byteLength:1,components:1};case W1:case eF:case Mb:return{byteLength:2,components:1};case oP:case lP:return{byteLength:2,components:4};case Ip:case aP:case jl:return{byteLength:4,components:1};case tF:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}class rze{static contain(e,i){return $Ie(e,i)}static cover(e,i){return eze(e,i)}static fill(e){return tze(e)}static getByteLength(e,i,r,n){return NB(e,i,r,n)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:rP}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=rP);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function XJ(){let t=null,e=!1,i=null,r=null;function n(s,a){i(s,a),r=t.requestAnimationFrame(n)}return{start:function(){e!==!0&&i!==null&&(r=t.requestAnimationFrame(n),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){i=s},setContext:function(s){t=s}}}function nze(t){const e=new WeakMap;function i(o,l){const c=o.array,u=o.usage,h=c.byteLength,d=t.createBuffer();t.bindBuffer(l,d),t.bufferData(l,c,u),o.onUploadCallback();let p;if(c instanceof Float32Array)p=t.FLOAT;else if(c instanceof Uint16Array)o.isFloat16BufferAttribute?p=t.HALF_FLOAT:p=t.UNSIGNED_SHORT;else if(c instanceof Int16Array)p=t.SHORT;else if(c instanceof Uint32Array)p=t.UNSIGNED_INT;else if(c instanceof Int32Array)p=t.INT;else if(c instanceof Int8Array)p=t.BYTE;else if(c instanceof Uint8Array)p=t.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)p=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:d,type:p,bytesPerElement:c.BYTES_PER_ELEMENT,version:o.version,size:h}}function r(o,l,c){const u=l.array,h=l.updateRanges;if(t.bindBuffer(c,o),h.length===0)t.bufferSubData(c,0,u);else{h.sort((p,g)=>p.start-g.start);let d=0;for(let p=1;p<h.length;p++){const g=h[d],x=h[p];x.start<=g.start+g.count+1?g.count=Math.max(g.count,x.start+x.count-g.start):(++d,h[d]=x)}h.length=d+1;for(let p=0,g=h.length;p<g;p++){const x=h[p];t.bufferSubData(c,x.start*u.BYTES_PER_ELEMENT,u,x.start,x.count)}l.clearUpdateRanges()}l.onUploadCallback()}function n(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function s(o){o.isInterleavedBufferAttribute&&(o=o.data);const l=e.get(o);l&&(t.deleteBuffer(l.buffer),e.delete(o))}function a(o,l){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const u=e.get(o);(!u||u.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const c=e.get(o);if(c===void 0)e.set(o,i(o,l));else if(c.version<o.version){if(c.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(c.buffer,o,l),c.version=o.version}}return{get:n,remove:s,update:a}}var sze=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,aze=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,oze=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,lze=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,cze=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,uze=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,hze=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,dze=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,fze=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,pze=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,mze=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,gze=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,vze=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,yze=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,xze=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,bze=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,_ze=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Sze=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,wze=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Mze=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Eze=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Aze=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,Tze=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,Cze=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Dze=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Pze=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Rze=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Oze=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Lze=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Ize=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,zze="gl_FragColor = linearToOutputTexel( gl_FragColor );",Uze=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Bze=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Nze=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Fze=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,kze=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Vze=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Hze=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Gze=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,jze=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Wze=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,qze=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Xze=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Yze=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Qze=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Zze=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Kze=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,Jze=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,$ze=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,eUe=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,tUe=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,iUe=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,rUe=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,nUe=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,sUe=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,aUe=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,oUe=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,lUe=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,cUe=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,uUe=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,hUe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,dUe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,fUe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,pUe=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,mUe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,gUe=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,vUe=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,yUe=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,xUe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,bUe=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,_Ue=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,SUe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,wUe=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,MUe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,EUe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,AUe=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,TUe=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,CUe=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,DUe=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,PUe=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,RUe=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,OUe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,LUe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,IUe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,zUe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,UUe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,BUe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,NUe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,FUe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,kUe=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,VUe=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,HUe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,GUe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,jUe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,WUe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,qUe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,XUe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,YUe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,QUe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,ZUe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,KUe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,JUe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,$Ue=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,eBe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,tBe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,iBe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,rBe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const nBe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,sBe=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,aBe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,oBe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,lBe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cBe=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,uBe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,hBe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,dBe=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,fBe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,pBe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,mBe=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,gBe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,vBe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,yBe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,xBe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,bBe=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,_Be=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,SBe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,wBe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,MBe=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,EBe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,ABe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,TBe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,CBe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,DBe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,PBe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,RBe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,OBe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,LBe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,IBe=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,zBe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,UBe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,BBe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Ji={alphahash_fragment:sze,alphahash_pars_fragment:aze,alphamap_fragment:oze,alphamap_pars_fragment:lze,alphatest_fragment:cze,alphatest_pars_fragment:uze,aomap_fragment:hze,aomap_pars_fragment:dze,batching_pars_vertex:fze,batching_vertex:pze,begin_vertex:mze,beginnormal_vertex:gze,bsdfs:vze,iridescence_fragment:yze,bumpmap_pars_fragment:xze,clipping_planes_fragment:bze,clipping_planes_pars_fragment:_ze,clipping_planes_pars_vertex:Sze,clipping_planes_vertex:wze,color_fragment:Mze,color_pars_fragment:Eze,color_pars_vertex:Aze,color_vertex:Tze,common:Cze,cube_uv_reflection_fragment:Dze,defaultnormal_vertex:Pze,displacementmap_pars_vertex:Rze,displacementmap_vertex:Oze,emissivemap_fragment:Lze,emissivemap_pars_fragment:Ize,colorspace_fragment:zze,colorspace_pars_fragment:Uze,envmap_fragment:Bze,envmap_common_pars_fragment:Nze,envmap_pars_fragment:Fze,envmap_pars_vertex:kze,envmap_physical_pars_fragment:Kze,envmap_vertex:Vze,fog_vertex:Hze,fog_pars_vertex:Gze,fog_fragment:jze,fog_pars_fragment:Wze,gradientmap_pars_fragment:qze,lightmap_pars_fragment:Xze,lights_lambert_fragment:Yze,lights_lambert_pars_fragment:Qze,lights_pars_begin:Zze,lights_toon_fragment:Jze,lights_toon_pars_fragment:$ze,lights_phong_fragment:eUe,lights_phong_pars_fragment:tUe,lights_physical_fragment:iUe,lights_physical_pars_fragment:rUe,lights_fragment_begin:nUe,lights_fragment_maps:sUe,lights_fragment_end:aUe,logdepthbuf_fragment:oUe,logdepthbuf_pars_fragment:lUe,logdepthbuf_pars_vertex:cUe,logdepthbuf_vertex:uUe,map_fragment:hUe,map_pars_fragment:dUe,map_particle_fragment:fUe,map_particle_pars_fragment:pUe,metalnessmap_fragment:mUe,metalnessmap_pars_fragment:gUe,morphinstance_vertex:vUe,morphcolor_vertex:yUe,morphnormal_vertex:xUe,morphtarget_pars_vertex:bUe,morphtarget_vertex:_Ue,normal_fragment_begin:SUe,normal_fragment_maps:wUe,normal_pars_fragment:MUe,normal_pars_vertex:EUe,normal_vertex:AUe,normalmap_pars_fragment:TUe,clearcoat_normal_fragment_begin:CUe,clearcoat_normal_fragment_maps:DUe,clearcoat_pars_fragment:PUe,iridescence_pars_fragment:RUe,opaque_fragment:OUe,packing:LUe,premultiplied_alpha_fragment:IUe,project_vertex:zUe,dithering_fragment:UUe,dithering_pars_fragment:BUe,roughnessmap_fragment:NUe,roughnessmap_pars_fragment:FUe,shadowmap_pars_fragment:kUe,shadowmap_pars_vertex:VUe,shadowmap_vertex:HUe,shadowmask_pars_fragment:GUe,skinbase_vertex:jUe,skinning_pars_vertex:WUe,skinning_vertex:qUe,skinnormal_vertex:XUe,specularmap_fragment:YUe,specularmap_pars_fragment:QUe,tonemapping_fragment:ZUe,tonemapping_pars_fragment:KUe,transmission_fragment:JUe,transmission_pars_fragment:$Ue,uv_pars_fragment:eBe,uv_pars_vertex:tBe,uv_vertex:iBe,worldpos_vertex:rBe,background_vert:nBe,background_frag:sBe,backgroundCube_vert:aBe,backgroundCube_frag:oBe,cube_vert:lBe,cube_frag:cBe,depth_vert:uBe,depth_frag:hBe,distanceRGBA_vert:dBe,distanceRGBA_frag:fBe,equirect_vert:pBe,equirect_frag:mBe,linedashed_vert:gBe,linedashed_frag:vBe,meshbasic_vert:yBe,meshbasic_frag:xBe,meshlambert_vert:bBe,meshlambert_frag:_Be,meshmatcap_vert:SBe,meshmatcap_frag:wBe,meshnormal_vert:MBe,meshnormal_frag:EBe,meshphong_vert:ABe,meshphong_frag:TBe,meshphysical_vert:CBe,meshphysical_frag:DBe,meshtoon_vert:PBe,meshtoon_frag:RBe,points_vert:OBe,points_frag:LBe,shadow_vert:IBe,shadow_frag:zBe,sprite_vert:UBe,sprite_frag:BBe},Yt={common:{diffuse:{value:new Zt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Yi},alphaMap:{value:null},alphaMapTransform:{value:new Yi},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Yi}},envmap:{envMap:{value:null},envMapRotation:{value:new Yi},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Yi}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Yi}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Yi},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Yi},normalScale:{value:new Tt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Yi},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Yi}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Yi}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Yi}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Zt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Zt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Yi},alphaTest:{value:0},uvTransform:{value:new Yi}},sprite:{diffuse:{value:new Zt(16777215)},opacity:{value:1},center:{value:new Tt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Yi},alphaMap:{value:null},alphaMapTransform:{value:new Yi},alphaTest:{value:0}}},ah={basic:{uniforms:tl([Yt.common,Yt.specularmap,Yt.envmap,Yt.aomap,Yt.lightmap,Yt.fog]),vertexShader:Ji.meshbasic_vert,fragmentShader:Ji.meshbasic_frag},lambert:{uniforms:tl([Yt.common,Yt.specularmap,Yt.envmap,Yt.aomap,Yt.lightmap,Yt.emissivemap,Yt.bumpmap,Yt.normalmap,Yt.displacementmap,Yt.fog,Yt.lights,{emissive:{value:new Zt(0)}}]),vertexShader:Ji.meshlambert_vert,fragmentShader:Ji.meshlambert_frag},phong:{uniforms:tl([Yt.common,Yt.specularmap,Yt.envmap,Yt.aomap,Yt.lightmap,Yt.emissivemap,Yt.bumpmap,Yt.normalmap,Yt.displacementmap,Yt.fog,Yt.lights,{emissive:{value:new Zt(0)},specular:{value:new Zt(1118481)},shininess:{value:30}}]),vertexShader:Ji.meshphong_vert,fragmentShader:Ji.meshphong_frag},standard:{uniforms:tl([Yt.common,Yt.envmap,Yt.aomap,Yt.lightmap,Yt.emissivemap,Yt.bumpmap,Yt.normalmap,Yt.displacementmap,Yt.roughnessmap,Yt.metalnessmap,Yt.fog,Yt.lights,{emissive:{value:new Zt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ji.meshphysical_vert,fragmentShader:Ji.meshphysical_frag},toon:{uniforms:tl([Yt.common,Yt.aomap,Yt.lightmap,Yt.emissivemap,Yt.bumpmap,Yt.normalmap,Yt.displacementmap,Yt.gradientmap,Yt.fog,Yt.lights,{emissive:{value:new Zt(0)}}]),vertexShader:Ji.meshtoon_vert,fragmentShader:Ji.meshtoon_frag},matcap:{uniforms:tl([Yt.common,Yt.bumpmap,Yt.normalmap,Yt.displacementmap,Yt.fog,{matcap:{value:null}}]),vertexShader:Ji.meshmatcap_vert,fragmentShader:Ji.meshmatcap_frag},points:{uniforms:tl([Yt.points,Yt.fog]),vertexShader:Ji.points_vert,fragmentShader:Ji.points_frag},dashed:{uniforms:tl([Yt.common,Yt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ji.linedashed_vert,fragmentShader:Ji.linedashed_frag},depth:{uniforms:tl([Yt.common,Yt.displacementmap]),vertexShader:Ji.depth_vert,fragmentShader:Ji.depth_frag},normal:{uniforms:tl([Yt.common,Yt.bumpmap,Yt.normalmap,Yt.displacementmap,{opacity:{value:1}}]),vertexShader:Ji.meshnormal_vert,fragmentShader:Ji.meshnormal_frag},sprite:{uniforms:tl([Yt.sprite,Yt.fog]),vertexShader:Ji.sprite_vert,fragmentShader:Ji.sprite_frag},background:{uniforms:{uvTransform:{value:new Yi},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ji.background_vert,fragmentShader:Ji.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Yi}},vertexShader:Ji.backgroundCube_vert,fragmentShader:Ji.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ji.cube_vert,fragmentShader:Ji.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ji.equirect_vert,fragmentShader:Ji.equirect_frag},distanceRGBA:{uniforms:tl([Yt.common,Yt.displacementmap,{referencePosition:{value:new Se},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ji.distanceRGBA_vert,fragmentShader:Ji.distanceRGBA_frag},shadow:{uniforms:tl([Yt.lights,Yt.fog,{color:{value:new Zt(0)},opacity:{value:1}}]),vertexShader:Ji.shadow_vert,fragmentShader:Ji.shadow_frag}};ah.physical={uniforms:tl([ah.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Yi},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Yi},clearcoatNormalScale:{value:new Tt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Yi},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Yi},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Yi},sheen:{value:0},sheenColor:{value:new Zt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Yi},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Yi},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Yi},transmissionSamplerSize:{value:new Tt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Yi},attenuationDistance:{value:0},attenuationColor:{value:new Zt(0)},specularColor:{value:new Zt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Yi},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Yi},anisotropyVector:{value:new Tt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Yi}}]),vertexShader:Ji.meshphysical_vert,fragmentShader:Ji.meshphysical_frag};const PT={r:0,b:0,g:0},Hv=new Sc,NBe=new Ui;function FBe(t,e,i,r,n,s,a){const o=new Zt(0);let l=s===!0?0:1,c,u,h=null,d=0,p=null;function g(M){let E=M.isScene===!0?M.background:null;return E&&E.isTexture&&(E=(M.backgroundBlurriness>0?i:e).get(E)),E}function x(M){let E=!1;const D=g(M);D===null?b(o,l):D&&D.isColor&&(b(D,1),E=!0);const T=t.xr.getEnvironmentBlendMode();T==="additive"?r.buffers.color.setClear(0,0,0,1,a):T==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,a),(t.autoClear||E)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))}function v(M,E){const D=g(E);D&&(D.isCubeTexture||D.mapping===wb)?(u===void 0&&(u=new is(new ey(1,1,1),new _h({name:"BackgroundCubeMaterial",uniforms:Y1(ah.backgroundCube.uniforms),vertexShader:ah.backgroundCube.vertexShader,fragmentShader:ah.backgroundCube.fragmentShader,side:ll,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(T,L,P){this.matrixWorld.copyPosition(P.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(u)),Hv.copy(E.backgroundRotation),Hv.x*=-1,Hv.y*=-1,Hv.z*=-1,D.isCubeTexture&&D.isRenderTargetTexture===!1&&(Hv.y*=-1,Hv.z*=-1),u.material.uniforms.envMap.value=D,u.material.uniforms.flipEnvMap.value=D.isCubeTexture&&D.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=E.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(NBe.makeRotationFromEuler(Hv)),u.material.toneMapped=Er.getTransfer(D.colorSpace)!==tn,(h!==D||d!==D.version||p!==t.toneMapping)&&(u.material.needsUpdate=!0,h=D,d=D.version,p=t.toneMapping),u.layers.enableAll(),M.unshift(u,u.geometry,u.material,0,0,null)):D&&D.isTexture&&(c===void 0&&(c=new is(new kp(2,2),new _h({name:"BackgroundMaterial",uniforms:Y1(ah.background.uniforms),vertexShader:ah.background.vertexShader,fragmentShader:ah.background.fragmentShader,side:Op,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=D,c.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,c.material.toneMapped=Er.getTransfer(D.colorSpace)!==tn,D.matrixAutoUpdate===!0&&D.updateMatrix(),c.material.uniforms.uvTransform.value.copy(D.matrix),(h!==D||d!==D.version||p!==t.toneMapping)&&(c.material.needsUpdate=!0,h=D,d=D.version,p=t.toneMapping),c.layers.enableAll(),M.unshift(c,c.geometry,c.material,0,0,null))}function b(M,E){M.getRGB(PT,QK(t)),r.buffers.color.setClear(PT.r,PT.g,PT.b,E,a)}function w(){u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0),c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0)}return{getClearColor:function(){return o},setClearColor:function(M,E=1){o.set(M),l=E,b(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(M){l=M,b(o,l)},render:x,addToRenderList:v,dispose:w}}function kBe(t,e){const i=t.getParameter(t.MAX_VERTEX_ATTRIBS),r={},n=d(null);let s=n,a=!1;function o(O,U,F,V,k){let K=!1;const X=h(V,F,U);s!==X&&(s=X,c(s.object)),K=p(O,V,F,k),K&&g(O,V,F,k),k!==null&&e.update(k,t.ELEMENT_ARRAY_BUFFER),(K||a)&&(a=!1,E(O,U,F,V),k!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(k).buffer))}function l(){return t.createVertexArray()}function c(O){return t.bindVertexArray(O)}function u(O){return t.deleteVertexArray(O)}function h(O,U,F){const V=F.wireframe===!0;let k=r[O.id];k===void 0&&(k={},r[O.id]=k);let K=k[U.id];K===void 0&&(K={},k[U.id]=K);let X=K[V];return X===void 0&&(X=d(l()),K[V]=X),X}function d(O){const U=[],F=[],V=[];for(let k=0;k<i;k++)U[k]=0,F[k]=0,V[k]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:U,enabledAttributes:F,attributeDivisors:V,object:O,attributes:{},index:null}}function p(O,U,F,V){const k=s.attributes,K=U.attributes;let X=0;const $=F.getAttributes();for(const Y in $)if($[Y].location>=0){const G=k[Y];let j=K[Y];if(j===void 0&&(Y==="instanceMatrix"&&O.instanceMatrix&&(j=O.instanceMatrix),Y==="instanceColor"&&O.instanceColor&&(j=O.instanceColor)),G===void 0||G.attribute!==j||j&&G.data!==j.data)return!0;X++}return s.attributesNum!==X||s.index!==V}function g(O,U,F,V){const k={},K=U.attributes;let X=0;const $=F.getAttributes();for(const Y in $)if($[Y].location>=0){let G=K[Y];G===void 0&&(Y==="instanceMatrix"&&O.instanceMatrix&&(G=O.instanceMatrix),Y==="instanceColor"&&O.instanceColor&&(G=O.instanceColor));const j={};j.attribute=G,G&&G.data&&(j.data=G.data),k[Y]=j,X++}s.attributes=k,s.attributesNum=X,s.index=V}function x(){const O=s.newAttributes;for(let U=0,F=O.length;U<F;U++)O[U]=0}function v(O){b(O,0)}function b(O,U){const F=s.newAttributes,V=s.enabledAttributes,k=s.attributeDivisors;F[O]=1,V[O]===0&&(t.enableVertexAttribArray(O),V[O]=1),k[O]!==U&&(t.vertexAttribDivisor(O,U),k[O]=U)}function w(){const O=s.newAttributes,U=s.enabledAttributes;for(let F=0,V=U.length;F<V;F++)U[F]!==O[F]&&(t.disableVertexAttribArray(F),U[F]=0)}function M(O,U,F,V,k,K,X){X===!0?t.vertexAttribIPointer(O,U,F,k,K):t.vertexAttribPointer(O,U,F,V,k,K)}function E(O,U,F,V){x();const k=V.attributes,K=F.getAttributes(),X=U.defaultAttributeValues;for(const $ in K){const Y=K[$];if(Y.location>=0){let re=k[$];if(re===void 0&&($==="instanceMatrix"&&O.instanceMatrix&&(re=O.instanceMatrix),$==="instanceColor"&&O.instanceColor&&(re=O.instanceColor)),re!==void 0){const G=re.normalized,j=re.itemSize,ee=e.get(re);if(ee===void 0)continue;const oe=ee.buffer,Q=ee.type,ae=ee.bytesPerElement,ne=Q===t.INT||Q===t.UNSIGNED_INT||re.gpuType===aP;if(re.isInterleavedBufferAttribute){const ue=re.data,fe=ue.stride,xe=re.offset;if(ue.isInstancedInterleavedBuffer){for(let be=0;be<Y.locationSize;be++)b(Y.location+be,ue.meshPerAttribute);O.isInstancedMesh!==!0&&V._maxInstanceCount===void 0&&(V._maxInstanceCount=ue.meshPerAttribute*ue.count)}else for(let be=0;be<Y.locationSize;be++)v(Y.location+be);t.bindBuffer(t.ARRAY_BUFFER,oe);for(let be=0;be<Y.locationSize;be++)M(Y.location+be,j/Y.locationSize,Q,G,fe*ae,(xe+j/Y.locationSize*be)*ae,ne)}else{if(re.isInstancedBufferAttribute){for(let ue=0;ue<Y.locationSize;ue++)b(Y.location+ue,re.meshPerAttribute);O.isInstancedMesh!==!0&&V._maxInstanceCount===void 0&&(V._maxInstanceCount=re.meshPerAttribute*re.count)}else for(let ue=0;ue<Y.locationSize;ue++)v(Y.location+ue);t.bindBuffer(t.ARRAY_BUFFER,oe);for(let ue=0;ue<Y.locationSize;ue++)M(Y.location+ue,j/Y.locationSize,Q,G,j*ae,j/Y.locationSize*ue*ae,ne)}}else if(X!==void 0){const G=X[$];if(G!==void 0)switch(G.length){case 2:t.vertexAttrib2fv(Y.location,G);break;case 3:t.vertexAttrib3fv(Y.location,G);break;case 4:t.vertexAttrib4fv(Y.location,G);break;default:t.vertexAttrib1fv(Y.location,G)}}}}w()}function D(){P();for(const O in r){const U=r[O];for(const F in U){const V=U[F];for(const k in V)u(V[k].object),delete V[k];delete U[F]}delete r[O]}}function T(O){if(r[O.id]===void 0)return;const U=r[O.id];for(const F in U){const V=U[F];for(const k in V)u(V[k].object),delete V[k];delete U[F]}delete r[O.id]}function L(O){for(const U in r){const F=r[U];if(F[O.id]===void 0)continue;const V=F[O.id];for(const k in V)u(V[k].object),delete V[k];delete F[O.id]}}function P(){R(),a=!0,s!==n&&(s=n,c(s.object))}function R(){n.geometry=null,n.program=null,n.wireframe=!1}return{setup:o,reset:P,resetDefaultState:R,dispose:D,releaseStatesOfGeometry:T,releaseStatesOfProgram:L,initAttributes:x,enableAttribute:v,disableUnusedAttributes:w}}function VBe(t,e,i){let r;function n(c){r=c}function s(c,u){t.drawArrays(r,c,u),i.update(u,r,1)}function a(c,u,h){h!==0&&(t.drawArraysInstanced(r,c,u,h),i.update(u,r,h))}function o(c,u,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,c,0,u,0,h);let p=0;for(let g=0;g<h;g++)p+=u[g];i.update(p,r,1)}function l(c,u,h,d){if(h===0)return;const p=e.get("WEBGL_multi_draw");if(p===null)for(let g=0;g<c.length;g++)a(c[g],u[g],d[g]);else{p.multiDrawArraysInstancedWEBGL(r,c,0,u,0,d,0,h);let g=0;for(let x=0;x<h;x++)g+=u[x]*d[x];i.update(g,r,1)}}this.setMode=n,this.render=s,this.renderInstances=a,this.renderMultiDraw=o,this.renderMultiDrawInstances=l}function HBe(t,e,i,r){let n;function s(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const L=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(L.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function a(L){return!(L!==Lo&&r.convert(L)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(L){const P=L===Mb&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(L!==bh&&r.convert(L)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&L!==jl&&!P)}function l(L){if(L==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";L="mediump"}return L==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=i.precision!==void 0?i.precision:"highp";const u=l(c);u!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",u,"instead."),c=u);const h=i.logarithmicDepthBuffer===!0,d=i.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),p=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),g=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),x=t.getParameter(t.MAX_TEXTURE_SIZE),v=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),b=t.getParameter(t.MAX_VERTEX_ATTRIBS),w=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),M=t.getParameter(t.MAX_VARYING_VECTORS),E=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),D=g>0,T=t.getParameter(t.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:l,textureFormatReadable:a,textureTypeReadable:o,precision:c,logarithmicDepthBuffer:h,reverseDepthBuffer:d,maxTextures:p,maxVertexTextures:g,maxTextureSize:x,maxCubemapSize:v,maxAttributes:b,maxVertexUniforms:w,maxVaryings:M,maxFragmentUniforms:E,vertexTextures:D,maxSamples:T}}function GBe(t){const e=this;let i=null,r=0,n=!1,s=!1;const a=new Ym,o=new Yi,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const p=h.length!==0||d||r!==0||n;return n=d,r=h.length,p},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){i=u(h,d,0)},this.setState=function(h,d,p){const g=h.clippingPlanes,x=h.clipIntersection,v=h.clipShadows,b=t.get(h);if(!n||g===null||g.length===0||s&&!v)s?u(null):c();else{const w=s?0:r,M=w*4;let E=b.clippingState||null;l.value=E,E=u(g,d,M,p);for(let D=0;D!==M;++D)E[D]=i[D];b.clippingState=E,this.numIntersection=x?this.numPlanes:0,this.numPlanes+=w}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(h,d,p,g){const x=h!==null?h.length:0;let v=null;if(x!==0){if(v=l.value,g!==!0||v===null){const b=p+x*4,w=d.matrixWorldInverse;o.getNormalMatrix(w),(v===null||v.length<b)&&(v=new Float32Array(b));for(let M=0,E=p;M!==x;++M,E+=4)a.copy(h[M]).applyMatrix4(w,o),a.normal.toArray(v,E),v[E+3]=a.constant}l.value=v,l.needsUpdate=!0}return e.numPlanes=x,e.numIntersection=0,v}}function jBe(t){let e=new WeakMap;function i(a,o){return o===qw?a.mapping=Lp:o===Xw&&(a.mapping=Eg),a}function r(a){if(a&&a.isTexture){const o=a.mapping;if(o===qw||o===Xw)if(e.has(a)){const l=e.get(a).texture;return i(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const c=new KK(l.height);return c.fromEquirectangularTexture(t,a),e.set(a,c),a.addEventListener("dispose",n),i(c.texture,a.mapping)}else return null}}return a}function n(a){const o=a.target;o.removeEventListener("dispose",n);const l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function s(){e=new WeakMap}return{get:r,dispose:s}}const u1=4,RW=[.125,.215,.35,.446,.526,.582],n0=20,PI=new WM,OW=new Zt;let RI=null,OI=0,LI=0,II=!1;const Kv=(1+Math.sqrt(5))/2,kx=1/Kv,LW=[new Se(-Kv,kx,0),new Se(Kv,kx,0),new Se(-kx,0,Kv),new Se(kx,0,Kv),new Se(0,Kv,-kx),new Se(0,Kv,kx),new Se(-1,1,-1),new Se(1,1,-1),new Se(-1,1,1),new Se(1,1,1)],WBe=new Se;class FB{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,i=0,r=.1,n=100,s={}){const{size:a=256,position:o=WBe}=s;RI=this._renderer.getRenderTarget(),OI=this._renderer.getActiveCubeFace(),LI=this._renderer.getActiveMipmapLevel(),II=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,r,n,l,o),i>0&&this._blur(l,0,0,i),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,i=null){return this._fromTexture(e,i)}fromCubemap(e,i=null){return this._fromTexture(e,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=UW(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=zW(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(RI,OI,LI),this._renderer.xr.enabled=II,e.scissorTest=!1,RT(e,0,0,e.width,e.height)}_fromTexture(e,i){e.mapping===Lp||e.mapping===Eg?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),RI=this._renderer.getRenderTarget(),OI=this._renderer.getActiveCubeFace(),LI=this._renderer.getActiveMipmapLevel(),II=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=i||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,r={magFilter:Cs,minFilter:Cs,generateMipmaps:!1,type:Mb,format:Lo,colorSpace:Ag,depthBuffer:!1},n=IW(e,i,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=IW(e,i,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=qBe(s)),this._blurMaterial=XBe(s,e,i)}return n}_compileMaterial(e){const i=new is(this._lodPlanes[0],e);this._renderer.compile(i,PI)}_sceneToCubeUV(e,i,r,n,s){const l=new Pa(90,1,i,r),c=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],h=this._renderer,d=h.autoClear,p=h.toneMapping;h.getClearColor(OW),h.toneMapping=Fd,h.autoClear=!1;const g=new Fp({name:"PMREM.Background",side:ll,depthWrite:!1,depthTest:!1}),x=new is(new ey,g);let v=!1;const b=e.background;b?b.isColor&&(g.color.copy(b),e.background=null,v=!0):(g.color.copy(OW),v=!0);for(let w=0;w<6;w++){const M=w%3;M===0?(l.up.set(0,c[w],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x+u[w],s.y,s.z)):M===1?(l.up.set(0,0,c[w]),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y+u[w],s.z)):(l.up.set(0,c[w],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y,s.z+u[w]));const E=this._cubeSize;RT(n,M*E,w>2?E:0,E,E),h.setRenderTarget(n),v&&h.render(x,l),h.render(e,l)}x.geometry.dispose(),x.material.dispose(),h.toneMapping=p,h.autoClear=d,e.background=b}_textureToCubeUV(e,i){const r=this._renderer,n=e.mapping===Lp||e.mapping===Eg;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=UW()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=zW());const s=n?this._cubemapMaterial:this._equirectMaterial,a=new is(this._lodPlanes[0],s),o=s.uniforms;o.envMap.value=e;const l=this._cubeSize;RT(i,0,0,3*l,2*l),r.setRenderTarget(i),r.render(a,PI)}_applyPMREM(e){const i=this._renderer,r=i.autoClear;i.autoClear=!1;const n=this._lodPlanes.length;for(let s=1;s<n;s++){const a=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),o=LW[(n-s-1)%LW.length];this._blur(e,s-1,s,a,o)}i.autoClear=r}_blur(e,i,r,n,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,i,r,n,"latitudinal",s),this._halfBlur(a,e,r,r,n,"longitudinal",s)}_halfBlur(e,i,r,n,s,a,o){const l=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new is(this._lodPlanes[n],c),d=c.uniforms,p=this._sizeLods[r]-1,g=isFinite(s)?Math.PI/(2*p):2*Math.PI/(2*n0-1),x=s/g,v=isFinite(s)?1+Math.floor(u*x):n0;v>n0&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${n0}`);const b=[];let w=0;for(let L=0;L<n0;++L){const P=L/x,R=Math.exp(-P*P/2);b.push(R),L===0?w+=R:L<v&&(w+=2*R)}for(let L=0;L<b.length;L++)b[L]=b[L]/w;d.envMap.value=e.texture,d.samples.value=v,d.weights.value=b,d.latitudinal.value=a==="latitudinal",o&&(d.poleAxis.value=o);const{_lodMax:M}=this;d.dTheta.value=g,d.mipInt.value=M-r;const E=this._sizeLods[n],D=3*E*(n>M-u1?n-M+u1:0),T=4*(this._cubeSize-E);RT(i,D,T,3*E,2*E),l.setRenderTarget(i),l.render(h,PI)}}function qBe(t){const e=[],i=[],r=[];let n=t;const s=t-u1+1+RW.length;for(let a=0;a<s;a++){const o=Math.pow(2,n);i.push(o);let l=1/o;a>t-u1?l=RW[a-t+u1-1]:a===0&&(l=0),r.push(l);const c=1/(o-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],p=6,g=6,x=3,v=2,b=1,w=new Float32Array(x*g*p),M=new Float32Array(v*g*p),E=new Float32Array(b*g*p);for(let T=0;T<p;T++){const L=T%3*2/3-1,P=T>2?0:-1,R=[L,P,0,L+2/3,P,0,L+2/3,P+1,0,L,P,0,L+2/3,P+1,0,L,P+1,0];w.set(R,x*g*T),M.set(d,v*g*T);const O=[T,T,T,T,T,T];E.set(O,b*g*T)}const D=new sr;D.setAttribute("position",new fn(w,x)),D.setAttribute("uv",new fn(M,v)),D.setAttribute("faceIndex",new fn(E,b)),e.push(D),n>u1&&n--}return{lodPlanes:e,sizeLods:i,sigmas:r}}function IW(t,e,i){const r=new Yd(t,e,i);return r.texture.mapping=wb,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function RT(t,e,i,r,n){t.viewport.set(e,i,r,n),t.scissor.set(e,i,r,n)}function XBe(t,e,i){const r=new Float32Array(n0),n=new Se(0,1,0);return new _h({name:"SphericalGaussianBlur",defines:{n:n0,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:FF(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:wp,depthTest:!1,depthWrite:!1})}function zW(){return new _h({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:FF(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:wp,depthTest:!1,depthWrite:!1})}function UW(){return new _h({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:FF(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:wp,depthTest:!1,depthWrite:!1})}function FF(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function YBe(t){let e=new WeakMap,i=null;function r(o){if(o&&o.isTexture){const l=o.mapping,c=l===qw||l===Xw,u=l===Lp||l===Eg;if(c||u){let h=e.get(o);const d=h!==void 0?h.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==d)return i===null&&(i=new FB(t)),h=c?i.fromEquirectangular(o,h):i.fromCubemap(o,h),h.texture.pmremVersion=o.pmremVersion,e.set(o,h),h.texture;if(h!==void 0)return h.texture;{const p=o.image;return c&&p&&p.height>0||u&&p&&n(p)?(i===null&&(i=new FB(t)),h=c?i.fromEquirectangular(o):i.fromCubemap(o),h.texture.pmremVersion=o.pmremVersion,e.set(o,h),o.addEventListener("dispose",s),h.texture):null}}}return o}function n(o){let l=0;const c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function s(o){const l=o.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function a(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function QBe(t){const e={};function i(r){if(e[r]!==void 0)return e[r];let n;switch(r){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(r)}return e[r]=n,n}return{has:function(r){return i(r)!==null},init:function(){i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance"),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture"),i("WEBGL_render_shared_exponent")},get:function(r){const n=i(r);return n===null&&Zv("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function ZBe(t,e,i,r){const n={},s=new WeakMap;function a(h){const d=h.target;d.index!==null&&e.remove(d.index);for(const g in d.attributes)e.remove(d.attributes[g]);d.removeEventListener("dispose",a),delete n[d.id];const p=s.get(d);p&&(e.remove(p),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(h,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function l(h){const d=h.attributes;for(const p in d)e.update(d[p],t.ARRAY_BUFFER)}function c(h){const d=[],p=h.index,g=h.attributes.position;let x=0;if(p!==null){const w=p.array;x=p.version;for(let M=0,E=w.length;M<E;M+=3){const D=w[M+0],T=w[M+1],L=w[M+2];d.push(D,T,T,L,L,D)}}else if(g!==void 0){const w=g.array;x=g.version;for(let M=0,E=w.length/3-1;M<E;M+=3){const D=M+0,T=M+1,L=M+2;d.push(D,T,T,L,L,D)}}else return;const v=new(WK(d)?fF:dF)(d,1);v.version=x;const b=s.get(h);b&&e.remove(b),s.set(h,v)}function u(h){const d=s.get(h);if(d){const p=h.index;p!==null&&d.version<p.version&&c(h)}else c(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function KBe(t,e,i){let r;function n(d){r=d}let s,a;function o(d){s=d.type,a=d.bytesPerElement}function l(d,p){t.drawElements(r,p,s,d*a),i.update(p,r,1)}function c(d,p,g){g!==0&&(t.drawElementsInstanced(r,p,s,d*a,g),i.update(p,r,g))}function u(d,p,g){if(g===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,p,0,s,d,0,g);let v=0;for(let b=0;b<g;b++)v+=p[b];i.update(v,r,1)}function h(d,p,g,x){if(g===0)return;const v=e.get("WEBGL_multi_draw");if(v===null)for(let b=0;b<d.length;b++)c(d[b]/a,p[b],x[b]);else{v.multiDrawElementsInstancedWEBGL(r,p,0,s,d,0,x,0,g);let b=0;for(let w=0;w<g;w++)b+=p[w]*x[w];i.update(b,r,1)}}this.setMode=n,this.setIndex=o,this.render=l,this.renderInstances=c,this.renderMultiDraw=u,this.renderMultiDrawInstances=h}function JBe(t){const e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case t.TRIANGLES:i.triangles+=o*(s/3);break;case t.LINES:i.lines+=o*(s/2);break;case t.LINE_STRIP:i.lines+=o*(s-1);break;case t.LINE_LOOP:i.lines+=o*s;break;case t.POINTS:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:n,update:r}}function $Be(t,e,i){const r=new WeakMap,n=new Ar;function s(a,o,l){const c=a.morphTargetInfluences,u=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,h=u!==void 0?u.length:0;let d=r.get(o);if(d===void 0||d.count!==h){let R=function(){L.dispose(),r.delete(o),o.removeEventListener("dispose",R)};d!==void 0&&d.texture.dispose();const p=o.morphAttributes.position!==void 0,g=o.morphAttributes.normal!==void 0,x=o.morphAttributes.color!==void 0,v=o.morphAttributes.position||[],b=o.morphAttributes.normal||[],w=o.morphAttributes.color||[];let M=0;p===!0&&(M=1),g===!0&&(M=2),x===!0&&(M=3);let E=o.attributes.position.count*M,D=1;E>e.maxTextureSize&&(D=Math.ceil(E/e.maxTextureSize),E=e.maxTextureSize);const T=new Float32Array(E*D*4*h),L=new BM(T,E,D,h);L.type=jl,L.needsUpdate=!0;const P=M*4;for(let O=0;O<h;O++){const U=v[O],F=b[O],V=w[O],k=E*D*4*O;for(let K=0;K<U.count;K++){const X=K*P;p===!0&&(n.fromBufferAttribute(U,K),T[k+X+0]=n.x,T[k+X+1]=n.y,T[k+X+2]=n.z,T[k+X+3]=0),g===!0&&(n.fromBufferAttribute(F,K),T[k+X+4]=n.x,T[k+X+5]=n.y,T[k+X+6]=n.z,T[k+X+7]=0),x===!0&&(n.fromBufferAttribute(V,K),T[k+X+8]=n.x,T[k+X+9]=n.y,T[k+X+10]=n.z,T[k+X+11]=V.itemSize===4?n.w:1)}}d={count:h,texture:L,size:new Tt(E,D)},r.set(o,d),o.addEventListener("dispose",R)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)l.getUniforms().setValue(t,"morphTexture",a.morphTexture,i);else{let p=0;for(let x=0;x<c.length;x++)p+=c[x];const g=o.morphTargetsRelative?1:1-p;l.getUniforms().setValue(t,"morphTargetBaseInfluence",g),l.getUniforms().setValue(t,"morphTargetInfluences",c)}l.getUniforms().setValue(t,"morphTargetsTexture",d.texture,i),l.getUniforms().setValue(t,"morphTargetsTextureSize",d.size)}return{update:s}}function eNe(t,e,i,r){let n=new WeakMap;function s(l){const c=r.render.frame,u=l.geometry,h=e.get(l,u);if(n.get(h)!==c&&(e.update(h),n.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),n.get(l)!==c&&(i.update(l.instanceMatrix,t.ARRAY_BUFFER),l.instanceColor!==null&&i.update(l.instanceColor,t.ARRAY_BUFFER),n.set(l,c))),l.isSkinnedMesh){const d=l.skeleton;n.get(d)!==c&&(d.update(),n.set(d,c))}return h}function a(){n=new WeakMap}function o(l){const c=l.target;c.removeEventListener("dispose",o),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:a}}const YJ=new ss,BW=new xF(1,1),QJ=new BM,ZJ=new pP,KJ=new NM,NW=[],FW=[],kW=new Float32Array(16),VW=new Float32Array(9),HW=new Float32Array(4);function Tb(t,e,i){const r=t[0];if(r<=0||r>0)return t;const n=e*i;let s=NW[n];if(s===void 0&&(s=new Float32Array(n),NW[n]=s),e!==0){r.toArray(s,0);for(let a=1,o=0;a!==e;++a)o+=i,t[a].toArray(s,o)}return s}function ca(t,e){if(t.length!==e.length)return!1;for(let i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}function ua(t,e){for(let i=0,r=e.length;i<r;i++)t[i]=e[i]}function NP(t,e){let i=FW[e];i===void 0&&(i=new Int32Array(e),FW[e]=i);for(let r=0;r!==e;++r)i[r]=t.allocateTextureUnit();return i}function tNe(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function iNe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(ca(i,e))return;t.uniform2fv(this.addr,e),ua(i,e)}}function rNe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(ca(i,e))return;t.uniform3fv(this.addr,e),ua(i,e)}}function nNe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(ca(i,e))return;t.uniform4fv(this.addr,e),ua(i,e)}}function sNe(t,e){const i=this.cache,r=e.elements;if(r===void 0){if(ca(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),ua(i,e)}else{if(ca(i,r))return;HW.set(r),t.uniformMatrix2fv(this.addr,!1,HW),ua(i,r)}}function aNe(t,e){const i=this.cache,r=e.elements;if(r===void 0){if(ca(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),ua(i,e)}else{if(ca(i,r))return;VW.set(r),t.uniformMatrix3fv(this.addr,!1,VW),ua(i,r)}}function oNe(t,e){const i=this.cache,r=e.elements;if(r===void 0){if(ca(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),ua(i,e)}else{if(ca(i,r))return;kW.set(r),t.uniformMatrix4fv(this.addr,!1,kW),ua(i,r)}}function lNe(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function cNe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(ca(i,e))return;t.uniform2iv(this.addr,e),ua(i,e)}}function uNe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(ca(i,e))return;t.uniform3iv(this.addr,e),ua(i,e)}}function hNe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(ca(i,e))return;t.uniform4iv(this.addr,e),ua(i,e)}}function dNe(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function fNe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(ca(i,e))return;t.uniform2uiv(this.addr,e),ua(i,e)}}function pNe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(ca(i,e))return;t.uniform3uiv(this.addr,e),ua(i,e)}}function mNe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(ca(i,e))return;t.uniform4uiv(this.addr,e),ua(i,e)}}function gNe(t,e,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n);let s;this.type===t.SAMPLER_2D_SHADOW?(BW.compareFunction=uF,s=BW):s=YJ,i.setTexture2D(e||s,n)}function vNe(t,e,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(e||ZJ,n)}function yNe(t,e,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(e||KJ,n)}function xNe(t,e,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(e||QJ,n)}function bNe(t){switch(t){case 5126:return tNe;case 35664:return iNe;case 35665:return rNe;case 35666:return nNe;case 35674:return sNe;case 35675:return aNe;case 35676:return oNe;case 5124:case 35670:return lNe;case 35667:case 35671:return cNe;case 35668:case 35672:return uNe;case 35669:case 35673:return hNe;case 5125:return dNe;case 36294:return fNe;case 36295:return pNe;case 36296:return mNe;case 35678:case 36198:case 36298:case 36306:case 35682:return gNe;case 35679:case 36299:case 36307:return vNe;case 35680:case 36300:case 36308:case 36293:return yNe;case 36289:case 36303:case 36311:case 36292:return xNe}}function _Ne(t,e){t.uniform1fv(this.addr,e)}function SNe(t,e){const i=Tb(e,this.size,2);t.uniform2fv(this.addr,i)}function wNe(t,e){const i=Tb(e,this.size,3);t.uniform3fv(this.addr,i)}function MNe(t,e){const i=Tb(e,this.size,4);t.uniform4fv(this.addr,i)}function ENe(t,e){const i=Tb(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function ANe(t,e){const i=Tb(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function TNe(t,e){const i=Tb(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function CNe(t,e){t.uniform1iv(this.addr,e)}function DNe(t,e){t.uniform2iv(this.addr,e)}function PNe(t,e){t.uniform3iv(this.addr,e)}function RNe(t,e){t.uniform4iv(this.addr,e)}function ONe(t,e){t.uniform1uiv(this.addr,e)}function LNe(t,e){t.uniform2uiv(this.addr,e)}function INe(t,e){t.uniform3uiv(this.addr,e)}function zNe(t,e){t.uniform4uiv(this.addr,e)}function UNe(t,e,i){const r=this.cache,n=e.length,s=NP(i,n);ca(r,s)||(t.uniform1iv(this.addr,s),ua(r,s));for(let a=0;a!==n;++a)i.setTexture2D(e[a]||YJ,s[a])}function BNe(t,e,i){const r=this.cache,n=e.length,s=NP(i,n);ca(r,s)||(t.uniform1iv(this.addr,s),ua(r,s));for(let a=0;a!==n;++a)i.setTexture3D(e[a]||ZJ,s[a])}function NNe(t,e,i){const r=this.cache,n=e.length,s=NP(i,n);ca(r,s)||(t.uniform1iv(this.addr,s),ua(r,s));for(let a=0;a!==n;++a)i.setTextureCube(e[a]||KJ,s[a])}function FNe(t,e,i){const r=this.cache,n=e.length,s=NP(i,n);ca(r,s)||(t.uniform1iv(this.addr,s),ua(r,s));for(let a=0;a!==n;++a)i.setTexture2DArray(e[a]||QJ,s[a])}function kNe(t){switch(t){case 5126:return _Ne;case 35664:return SNe;case 35665:return wNe;case 35666:return MNe;case 35674:return ENe;case 35675:return ANe;case 35676:return TNe;case 5124:case 35670:return CNe;case 35667:case 35671:return DNe;case 35668:case 35672:return PNe;case 35669:case 35673:return RNe;case 5125:return ONe;case 36294:return LNe;case 36295:return INe;case 36296:return zNe;case 35678:case 36198:case 36298:case 36306:case 35682:return UNe;case 35679:case 36299:case 36307:return BNe;case 35680:case 36300:case 36308:case 36293:return NNe;case 36289:case 36303:case 36311:case 36292:return FNe}}class VNe{constructor(e,i,r){this.id=e,this.addr=r,this.cache=[],this.type=i.type,this.setValue=bNe(i.type)}}class HNe{constructor(e,i,r){this.id=e,this.addr=r,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=kNe(i.type)}}class GNe{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,i,r){const n=this.seq;for(let s=0,a=n.length;s!==a;++s){const o=n[s];o.setValue(e,i[o.id],r)}}}const zI=/(\w+)(\])?(\[|\.)?/g;function GW(t,e){t.seq.push(e),t.map[e.id]=e}function jNe(t,e,i){const r=t.name,n=r.length;for(zI.lastIndex=0;;){const s=zI.exec(r),a=zI.lastIndex;let o=s[1];const l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===n){GW(i,c===void 0?new VNe(o,t,e):new HNe(o,t,e));break}else{let h=i.map[o];h===void 0&&(h=new GNe(o),GW(i,h)),i=h}}}class dC{constructor(e,i){this.seq=[],this.map={};const r=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let n=0;n<r;++n){const s=e.getActiveUniform(i,n),a=e.getUniformLocation(i,s.name);jNe(s,a,this)}}setValue(e,i,r,n){const s=this.map[i];s!==void 0&&s.setValue(e,r,n)}setOptional(e,i,r){const n=i[r];n!==void 0&&this.setValue(e,r,n)}static upload(e,i,r,n){for(let s=0,a=i.length;s!==a;++s){const o=i[s],l=r[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,n)}}static seqWithValue(e,i){const r=[];for(let n=0,s=e.length;n!==s;++n){const a=e[n];a.id in i&&r.push(a)}return r}}function jW(t,e,i){const r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}const WNe=37297;let qNe=0;function XNe(t,e){const i=t.split(`
`),r=[],n=Math.max(e-6,0),s=Math.min(e+6,i.length);for(let a=n;a<s;a++){const o=a+1;r.push(`${o===e?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}const WW=new Yi;function YNe(t){Er._getMatrix(WW,Er.workingColorSpace,t);const e=`mat3( ${WW.elements.map(i=>i.toFixed(4))} )`;switch(Er.getTransfer(t)){case Jw:return[e,"LinearTransferOETF"];case tn:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",t),[e,"LinearTransferOETF"]}}function qW(t,e,i){const r=t.getShaderParameter(e,t.COMPILE_STATUS),n=t.getShaderInfoLog(e).trim();if(r&&n==="")return"";const s=/ERROR: 0:(\d+)/.exec(n);if(s){const a=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+XNe(t.getShaderSource(e),a)}else return n}function QNe(t,e){const i=YNe(e);return[`vec4 ${t}( vec4 value ) {`,`	return ${i[1]}( vec4( value.rgb * ${i[0]}, value.a ) );`,"}"].join(`
`)}function ZNe(t,e){let i;switch(e){case AK:i="Linear";break;case TK:i="Reinhard";break;case CK:i="Cineon";break;case K4:i="ACESFilmic";break;case PK:i="AgX";break;case RK:i="Neutral";break;case DK:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}const OT=new Se;function KNe(){Er.getLuminanceCoefficients(OT);const t=OT.x.toFixed(4),e=OT.y.toFixed(4),i=OT.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${t}, ${e}, ${i} );`,"	return dot( weights, rgb );","}"].join(`
`)}function JNe(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(GS).join(`
`)}function $Ne(t){const e=[];for(const i in t){const r=t[i];r!==!1&&e.push("#define "+i+" "+r)}return e.join(`
`)}function e4e(t,e){const i={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const s=t.getActiveAttrib(e,n),a=s.name;let o=1;s.type===t.FLOAT_MAT2&&(o=2),s.type===t.FLOAT_MAT3&&(o=3),s.type===t.FLOAT_MAT4&&(o=4),i[a]={type:s.type,location:t.getAttribLocation(e,a),locationSize:o}}return i}function GS(t){return t!==""}function XW(t,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function YW(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const t4e=/^[ \t]*#include +<([\w\d./]+)>/gm;function kB(t){return t.replace(t4e,r4e)}const i4e=new Map;function r4e(t,e){let i=Ji[e];if(i===void 0){const r=i4e.get(e);if(r!==void 0)i=Ji[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return kB(i)}const n4e=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function QW(t){return t.replace(n4e,s4e)}function s4e(t,e,i,r){let n="";for(let s=parseInt(e);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function ZW(t){let e=`precision ${t.precision} float;
	precision ${t.precision} int;
	precision ${t.precision} sampler2D;
	precision ${t.precision} samplerCube;
	precision ${t.precision} sampler3D;
	precision ${t.precision} sampler2DArray;
	precision ${t.precision} sampler2DShadow;
	precision ${t.precision} samplerCubeShadow;
	precision ${t.precision} sampler2DArrayShadow;
	precision ${t.precision} isampler2D;
	precision ${t.precision} isampler3D;
	precision ${t.precision} isamplerCube;
	precision ${t.precision} isampler2DArray;
	precision ${t.precision} usampler2D;
	precision ${t.precision} usampler3D;
	precision ${t.precision} usamplerCube;
	precision ${t.precision} usampler2DArray;
	`;return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function a4e(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===nP?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===ow?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===sh&&(e="SHADOWMAP_TYPE_VSM"),e}function o4e(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Lp:case Eg:e="ENVMAP_TYPE_CUBE";break;case wb:e="ENVMAP_TYPE_CUBE_UV";break}return e}function l4e(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case Eg:e="ENVMAP_MODE_REFRACTION";break}return e}function c4e(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case zM:e="ENVMAP_BLENDING_MULTIPLY";break;case MK:e="ENVMAP_BLENDING_MIX";break;case EK:e="ENVMAP_BLENDING_ADD";break}return e}function u4e(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const i=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function h4e(t,e,i,r){const n=t.getContext(),s=i.defines;let a=i.vertexShader,o=i.fragmentShader;const l=a4e(i),c=o4e(i),u=l4e(i),h=c4e(i),d=u4e(i),p=JNe(i),g=$Ne(s),x=n.createProgram();let v,b,w=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(v=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,g].filter(GS).join(`
`),v.length>0&&(v+=`
`),b=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,g].filter(GS).join(`
`),b.length>0&&(b+=`
`)):(v=[ZW(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,g,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.batchingColor?"#define USE_BATCHING_COLOR":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.instancingMorph?"#define USE_INSTANCING_MORPH":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(GS).join(`
`),b=[ZW(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,g,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.dispersion?"#define USE_DISPERSION":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor||i.batchingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Fd?"#define TONE_MAPPING":"",i.toneMapping!==Fd?Ji.tonemapping_pars_fragment:"",i.toneMapping!==Fd?ZNe("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Ji.colorspace_pars_fragment,QNe("linearToOutputTexel",i.outputColorSpace),KNe(),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(GS).join(`
`)),a=kB(a),a=XW(a,i),a=YW(a,i),o=kB(o),o=XW(o,i),o=YW(o,i),a=QW(a),o=QW(o),i.isRawShaderMaterial!==!0&&(w=`#version 300 es
`,v=[p,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,b=["#define varying in",i.glslVersion===RB?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===RB?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+b);const M=w+v+a,E=w+b+o,D=jW(n,n.VERTEX_SHADER,M),T=jW(n,n.FRAGMENT_SHADER,E);n.attachShader(x,D),n.attachShader(x,T),i.index0AttributeName!==void 0?n.bindAttribLocation(x,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(x,0,"position"),n.linkProgram(x);function L(U){if(t.debug.checkShaderErrors){const F=n.getProgramInfoLog(x).trim(),V=n.getShaderInfoLog(D).trim(),k=n.getShaderInfoLog(T).trim();let K=!0,X=!0;if(n.getProgramParameter(x,n.LINK_STATUS)===!1)if(K=!1,typeof t.debug.onShaderError=="function")t.debug.onShaderError(n,x,D,T);else{const $=qW(n,D,"vertex"),Y=qW(n,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(x,n.VALIDATE_STATUS)+`

Material Name: `+U.name+`
Material Type: `+U.type+`

Program Info Log: `+F+`
`+$+`
`+Y)}else F!==""?console.warn("THREE.WebGLProgram: Program Info Log:",F):(V===""||k==="")&&(X=!1);X&&(U.diagnostics={runnable:K,programLog:F,vertexShader:{log:V,prefix:v},fragmentShader:{log:k,prefix:b}})}n.deleteShader(D),n.deleteShader(T),P=new dC(n,x),R=e4e(n,x)}let P;this.getUniforms=function(){return P===void 0&&L(this),P};let R;this.getAttributes=function(){return R===void 0&&L(this),R};let O=i.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return O===!1&&(O=n.getProgramParameter(x,WNe)),O},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(x),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=qNe++,this.cacheKey=e,this.usedTimes=1,this.program=x,this.vertexShader=D,this.fragmentShader=T,this}let d4e=0;class f4e{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.vertexShader,r=e.fragmentShader,n=this._getShaderStage(i),s=this._getShaderStage(r),a=this._getShaderCacheForMaterial(e);return a.has(n)===!1&&(a.add(n),n.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(e){const i=this.materialCache.get(e);for(const r of i)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const i=this.materialCache;let r=i.get(e);return r===void 0&&(r=new Set,i.set(e,r)),r}_getShaderStage(e){const i=this.shaderCache;let r=i.get(e);return r===void 0&&(r=new p4e(e),i.set(e,r)),r}}class p4e{constructor(e){this.id=d4e++,this.code=e,this.usedTimes=0}}function m4e(t,e,i,r,n,s,a){const o=new X1,l=new f4e,c=new Set,u=[],h=n.logarithmicDepthBuffer,d=n.vertexTextures;let p=n.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function x(R){return c.add(R),R===0?"uv":`uv${R}`}function v(R,O,U,F,V){const k=F.fog,K=V.geometry,X=R.isMeshStandardMaterial?F.environment:null,$=(R.isMeshStandardMaterial?i:e).get(R.envMap||X),Y=$&&$.mapping===wb?$.image.height:null,re=g[R.type];R.precision!==null&&(p=n.getMaxPrecision(R.precision),p!==R.precision&&console.warn("THREE.WebGLProgram.getParameters:",R.precision,"not supported, using",p,"instead."));const G=K.morphAttributes.position||K.morphAttributes.normal||K.morphAttributes.color,j=G!==void 0?G.length:0;let ee=0;K.morphAttributes.position!==void 0&&(ee=1),K.morphAttributes.normal!==void 0&&(ee=2),K.morphAttributes.color!==void 0&&(ee=3);let oe,Q,ae,ne;if(re){const Ft=ah[re];oe=Ft.vertexShader,Q=Ft.fragmentShader}else oe=R.vertexShader,Q=R.fragmentShader,l.update(R),ae=l.getVertexShaderID(R),ne=l.getFragmentShaderID(R);const ue=t.getRenderTarget(),fe=t.state.buffers.depth.getReversed(),xe=V.isInstancedMesh===!0,be=V.isBatchedMesh===!0,Ce=!!R.map,ge=!!R.matcap,Te=!!$,ce=!!R.aoMap,Ue=!!R.lightMap,ze=!!R.bumpMap,Xe=!!R.normalMap,De=!!R.displacementMap,Ge=!!R.emissiveMap,We=!!R.metalnessMap,se=!!R.roughnessMap,H=R.anisotropy>0,Z=R.clearcoat>0,pe=R.dispersion>0,we=R.iridescence>0,J=R.sheen>0,He=R.transmission>0,je=H&&!!R.anisotropyMap,Ye=Z&&!!R.clearcoatMap,Ve=Z&&!!R.clearcoatNormalMap,Ke=Z&&!!R.clearcoatRoughnessMap,at=we&&!!R.iridescenceMap,ut=we&&!!R.iridescenceThicknessMap,ht=J&&!!R.sheenColorMap,$e=J&&!!R.sheenRoughnessMap,St=!!R.specularMap,Pt=!!R.specularColorMap,Kt=!!R.specularIntensityMap,le=He&&!!R.transmissionMap,Re=He&&!!R.thicknessMap,Ee=!!R.gradientMap,Qe=!!R.alphaMap,ot=R.alphaTest>0,pt=!!R.alphaHash,Bt=!!R.extensions;let Jt=Fd;R.toneMapped&&(ue===null||ue.isXRRenderTarget===!0)&&(Jt=t.toneMapping);const qt={shaderID:re,shaderType:R.type,shaderName:R.name,vertexShader:oe,fragmentShader:Q,defines:R.defines,customVertexShaderID:ae,customFragmentShaderID:ne,isRawShaderMaterial:R.isRawShaderMaterial===!0,glslVersion:R.glslVersion,precision:p,batching:be,batchingColor:be&&V._colorsTexture!==null,instancing:xe,instancingColor:xe&&V.instanceColor!==null,instancingMorph:xe&&V.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:ue===null?t.outputColorSpace:ue.isXRRenderTarget===!0?ue.texture.colorSpace:Ag,alphaToCoverage:!!R.alphaToCoverage,map:Ce,matcap:ge,envMap:Te,envMapMode:Te&&$.mapping,envMapCubeUVHeight:Y,aoMap:ce,lightMap:Ue,bumpMap:ze,normalMap:Xe,displacementMap:d&&De,emissiveMap:Ge,normalMapObjectSpace:Xe&&R.normalMapType===BK,normalMapTangentSpace:Xe&&R.normalMapType===Lg,metalnessMap:We,roughnessMap:se,anisotropy:H,anisotropyMap:je,clearcoat:Z,clearcoatMap:Ye,clearcoatNormalMap:Ve,clearcoatRoughnessMap:Ke,dispersion:pe,iridescence:we,iridescenceMap:at,iridescenceThicknessMap:ut,sheen:J,sheenColorMap:ht,sheenRoughnessMap:$e,specularMap:St,specularColorMap:Pt,specularIntensityMap:Kt,transmission:He,transmissionMap:le,thicknessMap:Re,gradientMap:Ee,opaque:R.transparent===!1&&R.blending===E0&&R.alphaToCoverage===!1,alphaMap:Qe,alphaTest:ot,alphaHash:pt,combine:R.combine,mapUv:Ce&&x(R.map.channel),aoMapUv:ce&&x(R.aoMap.channel),lightMapUv:Ue&&x(R.lightMap.channel),bumpMapUv:ze&&x(R.bumpMap.channel),normalMapUv:Xe&&x(R.normalMap.channel),displacementMapUv:De&&x(R.displacementMap.channel),emissiveMapUv:Ge&&x(R.emissiveMap.channel),metalnessMapUv:We&&x(R.metalnessMap.channel),roughnessMapUv:se&&x(R.roughnessMap.channel),anisotropyMapUv:je&&x(R.anisotropyMap.channel),clearcoatMapUv:Ye&&x(R.clearcoatMap.channel),clearcoatNormalMapUv:Ve&&x(R.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ke&&x(R.clearcoatRoughnessMap.channel),iridescenceMapUv:at&&x(R.iridescenceMap.channel),iridescenceThicknessMapUv:ut&&x(R.iridescenceThicknessMap.channel),sheenColorMapUv:ht&&x(R.sheenColorMap.channel),sheenRoughnessMapUv:$e&&x(R.sheenRoughnessMap.channel),specularMapUv:St&&x(R.specularMap.channel),specularColorMapUv:Pt&&x(R.specularColorMap.channel),specularIntensityMapUv:Kt&&x(R.specularIntensityMap.channel),transmissionMapUv:le&&x(R.transmissionMap.channel),thicknessMapUv:Re&&x(R.thicknessMap.channel),alphaMapUv:Qe&&x(R.alphaMap.channel),vertexTangents:!!K.attributes.tangent&&(Xe||H),vertexColors:R.vertexColors,vertexAlphas:R.vertexColors===!0&&!!K.attributes.color&&K.attributes.color.itemSize===4,pointsUvs:V.isPoints===!0&&!!K.attributes.uv&&(Ce||Qe),fog:!!k,useFog:R.fog===!0,fogExp2:!!k&&k.isFogExp2,flatShading:R.flatShading===!0,sizeAttenuation:R.sizeAttenuation===!0,logarithmicDepthBuffer:h,reverseDepthBuffer:fe,skinning:V.isSkinnedMesh===!0,morphTargets:K.morphAttributes.position!==void 0,morphNormals:K.morphAttributes.normal!==void 0,morphColors:K.morphAttributes.color!==void 0,morphTargetsCount:j,morphTextureStride:ee,numDirLights:O.directional.length,numPointLights:O.point.length,numSpotLights:O.spot.length,numSpotLightMaps:O.spotLightMap.length,numRectAreaLights:O.rectArea.length,numHemiLights:O.hemi.length,numDirLightShadows:O.directionalShadowMap.length,numPointLightShadows:O.pointShadowMap.length,numSpotLightShadows:O.spotShadowMap.length,numSpotLightShadowsWithMaps:O.numSpotLightShadowsWithMaps,numLightProbes:O.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:R.dithering,shadowMapEnabled:t.shadowMap.enabled&&U.length>0,shadowMapType:t.shadowMap.type,toneMapping:Jt,decodeVideoTexture:Ce&&R.map.isVideoTexture===!0&&Er.getTransfer(R.map.colorSpace)===tn,decodeVideoTextureEmissive:Ge&&R.emissiveMap.isVideoTexture===!0&&Er.getTransfer(R.emissiveMap.colorSpace)===tn,premultipliedAlpha:R.premultipliedAlpha,doubleSided:R.side===ch,flipSided:R.side===ll,useDepthPacking:R.depthPacking>=0,depthPacking:R.depthPacking||0,index0AttributeName:R.index0AttributeName,extensionClipCullDistance:Bt&&R.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Bt&&R.extensions.multiDraw===!0||be)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:R.customProgramCacheKey()};return qt.vertexUv1s=c.has(1),qt.vertexUv2s=c.has(2),qt.vertexUv3s=c.has(3),c.clear(),qt}function b(R){const O=[];if(R.shaderID?O.push(R.shaderID):(O.push(R.customVertexShaderID),O.push(R.customFragmentShaderID)),R.defines!==void 0)for(const U in R.defines)O.push(U),O.push(R.defines[U]);return R.isRawShaderMaterial===!1&&(w(O,R),M(O,R),O.push(t.outputColorSpace)),O.push(R.customProgramCacheKey),O.join()}function w(R,O){R.push(O.precision),R.push(O.outputColorSpace),R.push(O.envMapMode),R.push(O.envMapCubeUVHeight),R.push(O.mapUv),R.push(O.alphaMapUv),R.push(O.lightMapUv),R.push(O.aoMapUv),R.push(O.bumpMapUv),R.push(O.normalMapUv),R.push(O.displacementMapUv),R.push(O.emissiveMapUv),R.push(O.metalnessMapUv),R.push(O.roughnessMapUv),R.push(O.anisotropyMapUv),R.push(O.clearcoatMapUv),R.push(O.clearcoatNormalMapUv),R.push(O.clearcoatRoughnessMapUv),R.push(O.iridescenceMapUv),R.push(O.iridescenceThicknessMapUv),R.push(O.sheenColorMapUv),R.push(O.sheenRoughnessMapUv),R.push(O.specularMapUv),R.push(O.specularColorMapUv),R.push(O.specularIntensityMapUv),R.push(O.transmissionMapUv),R.push(O.thicknessMapUv),R.push(O.combine),R.push(O.fogExp2),R.push(O.sizeAttenuation),R.push(O.morphTargetsCount),R.push(O.morphAttributeCount),R.push(O.numDirLights),R.push(O.numPointLights),R.push(O.numSpotLights),R.push(O.numSpotLightMaps),R.push(O.numHemiLights),R.push(O.numRectAreaLights),R.push(O.numDirLightShadows),R.push(O.numPointLightShadows),R.push(O.numSpotLightShadows),R.push(O.numSpotLightShadowsWithMaps),R.push(O.numLightProbes),R.push(O.shadowMapType),R.push(O.toneMapping),R.push(O.numClippingPlanes),R.push(O.numClipIntersection),R.push(O.depthPacking)}function M(R,O){o.disableAll(),O.supportsVertexTextures&&o.enable(0),O.instancing&&o.enable(1),O.instancingColor&&o.enable(2),O.instancingMorph&&o.enable(3),O.matcap&&o.enable(4),O.envMap&&o.enable(5),O.normalMapObjectSpace&&o.enable(6),O.normalMapTangentSpace&&o.enable(7),O.clearcoat&&o.enable(8),O.iridescence&&o.enable(9),O.alphaTest&&o.enable(10),O.vertexColors&&o.enable(11),O.vertexAlphas&&o.enable(12),O.vertexUv1s&&o.enable(13),O.vertexUv2s&&o.enable(14),O.vertexUv3s&&o.enable(15),O.vertexTangents&&o.enable(16),O.anisotropy&&o.enable(17),O.alphaHash&&o.enable(18),O.batching&&o.enable(19),O.dispersion&&o.enable(20),O.batchingColor&&o.enable(21),R.push(o.mask),o.disableAll(),O.fog&&o.enable(0),O.useFog&&o.enable(1),O.flatShading&&o.enable(2),O.logarithmicDepthBuffer&&o.enable(3),O.reverseDepthBuffer&&o.enable(4),O.skinning&&o.enable(5),O.morphTargets&&o.enable(6),O.morphNormals&&o.enable(7),O.morphColors&&o.enable(8),O.premultipliedAlpha&&o.enable(9),O.shadowMapEnabled&&o.enable(10),O.doubleSided&&o.enable(11),O.flipSided&&o.enable(12),O.useDepthPacking&&o.enable(13),O.dithering&&o.enable(14),O.transmission&&o.enable(15),O.sheen&&o.enable(16),O.opaque&&o.enable(17),O.pointsUvs&&o.enable(18),O.decodeVideoTexture&&o.enable(19),O.decodeVideoTextureEmissive&&o.enable(20),O.alphaToCoverage&&o.enable(21),R.push(o.mask)}function E(R){const O=g[R.type];let U;if(O){const F=ah[O];U=pF.clone(F.uniforms)}else U=R.uniforms;return U}function D(R,O){let U;for(let F=0,V=u.length;F<V;F++){const k=u[F];if(k.cacheKey===O){U=k,++U.usedTimes;break}}return U===void 0&&(U=new h4e(t,O,R,s),u.push(U)),U}function T(R){if(--R.usedTimes===0){const O=u.indexOf(R);u[O]=u[u.length-1],u.pop(),R.destroy()}}function L(R){l.remove(R)}function P(){l.dispose()}return{getParameters:v,getProgramCacheKey:b,getUniforms:E,acquireProgram:D,releaseProgram:T,releaseShaderCache:L,programs:u,dispose:P}}function g4e(){let t=new WeakMap;function e(a){return t.has(a)}function i(a){let o=t.get(a);return o===void 0&&(o={},t.set(a,o)),o}function r(a){t.delete(a)}function n(a,o,l){t.get(a)[o]=l}function s(){t=new WeakMap}return{has:e,get:i,remove:r,update:n,dispose:s}}function v4e(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function KW(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function JW(){const t=[];let e=0;const i=[],r=[],n=[];function s(){e=0,i.length=0,r.length=0,n.length=0}function a(h,d,p,g,x,v){let b=t[e];return b===void 0?(b={id:h.id,object:h,geometry:d,material:p,groupOrder:g,renderOrder:h.renderOrder,z:x,group:v},t[e]=b):(b.id=h.id,b.object=h,b.geometry=d,b.material=p,b.groupOrder=g,b.renderOrder=h.renderOrder,b.z=x,b.group=v),e++,b}function o(h,d,p,g,x,v){const b=a(h,d,p,g,x,v);p.transmission>0?r.push(b):p.transparent===!0?n.push(b):i.push(b)}function l(h,d,p,g,x,v){const b=a(h,d,p,g,x,v);p.transmission>0?r.unshift(b):p.transparent===!0?n.unshift(b):i.unshift(b)}function c(h,d){i.length>1&&i.sort(h||v4e),r.length>1&&r.sort(d||KW),n.length>1&&n.sort(d||KW)}function u(){for(let h=e,d=t.length;h<d;h++){const p=t[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:u,sort:c}}function y4e(){let t=new WeakMap;function e(r,n){const s=t.get(r);let a;return s===void 0?(a=new JW,t.set(r,[a])):n>=s.length?(a=new JW,s.push(a)):a=s[n],a}function i(){t=new WeakMap}return{get:e,dispose:i}}function x4e(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new Se,color:new Zt};break;case"SpotLight":i={position:new Se,direction:new Se,color:new Zt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Se,color:new Zt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Se,skyColor:new Zt,groundColor:new Zt};break;case"RectAreaLight":i={color:new Zt,position:new Se,halfWidth:new Se,halfHeight:new Se};break}return t[e.id]=i,i}}}function b4e(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Tt};break;case"SpotLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Tt};break;case"PointLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Tt,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=i,i}}}let _4e=0;function S4e(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function w4e(t){const e=new x4e,i=b4e(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)r.probe.push(new Se);const n=new Se,s=new Ui,a=new Ui;function o(c){let u=0,h=0,d=0;for(let R=0;R<9;R++)r.probe[R].set(0,0,0);let p=0,g=0,x=0,v=0,b=0,w=0,M=0,E=0,D=0,T=0,L=0;c.sort(S4e);for(let R=0,O=c.length;R<O;R++){const U=c[R],F=U.color,V=U.intensity,k=U.distance,K=U.shadow&&U.shadow.map?U.shadow.map.texture:null;if(U.isAmbientLight)u+=F.r*V,h+=F.g*V,d+=F.b*V;else if(U.isLightProbe){for(let X=0;X<9;X++)r.probe[X].addScaledVector(U.sh.coefficients[X],V);L++}else if(U.isDirectionalLight){const X=e.get(U);if(X.color.copy(U.color).multiplyScalar(U.intensity),U.castShadow){const $=U.shadow,Y=i.get(U);Y.shadowIntensity=$.intensity,Y.shadowBias=$.bias,Y.shadowNormalBias=$.normalBias,Y.shadowRadius=$.radius,Y.shadowMapSize=$.mapSize,r.directionalShadow[p]=Y,r.directionalShadowMap[p]=K,r.directionalShadowMatrix[p]=U.shadow.matrix,w++}r.directional[p]=X,p++}else if(U.isSpotLight){const X=e.get(U);X.position.setFromMatrixPosition(U.matrixWorld),X.color.copy(F).multiplyScalar(V),X.distance=k,X.coneCos=Math.cos(U.angle),X.penumbraCos=Math.cos(U.angle*(1-U.penumbra)),X.decay=U.decay,r.spot[x]=X;const $=U.shadow;if(U.map&&(r.spotLightMap[D]=U.map,D++,$.updateMatrices(U),U.castShadow&&T++),r.spotLightMatrix[x]=$.matrix,U.castShadow){const Y=i.get(U);Y.shadowIntensity=$.intensity,Y.shadowBias=$.bias,Y.shadowNormalBias=$.normalBias,Y.shadowRadius=$.radius,Y.shadowMapSize=$.mapSize,r.spotShadow[x]=Y,r.spotShadowMap[x]=K,E++}x++}else if(U.isRectAreaLight){const X=e.get(U);X.color.copy(F).multiplyScalar(V),X.halfWidth.set(U.width*.5,0,0),X.halfHeight.set(0,U.height*.5,0),r.rectArea[v]=X,v++}else if(U.isPointLight){const X=e.get(U);if(X.color.copy(U.color).multiplyScalar(U.intensity),X.distance=U.distance,X.decay=U.decay,U.castShadow){const $=U.shadow,Y=i.get(U);Y.shadowIntensity=$.intensity,Y.shadowBias=$.bias,Y.shadowNormalBias=$.normalBias,Y.shadowRadius=$.radius,Y.shadowMapSize=$.mapSize,Y.shadowCameraNear=$.camera.near,Y.shadowCameraFar=$.camera.far,r.pointShadow[g]=Y,r.pointShadowMap[g]=K,r.pointShadowMatrix[g]=U.shadow.matrix,M++}r.point[g]=X,g++}else if(U.isHemisphereLight){const X=e.get(U);X.skyColor.copy(U.color).multiplyScalar(V),X.groundColor.copy(U.groundColor).multiplyScalar(V),r.hemi[b]=X,b++}}v>0&&(t.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Yt.LTC_FLOAT_1,r.rectAreaLTC2=Yt.LTC_FLOAT_2):(r.rectAreaLTC1=Yt.LTC_HALF_1,r.rectAreaLTC2=Yt.LTC_HALF_2)),r.ambient[0]=u,r.ambient[1]=h,r.ambient[2]=d;const P=r.hash;(P.directionalLength!==p||P.pointLength!==g||P.spotLength!==x||P.rectAreaLength!==v||P.hemiLength!==b||P.numDirectionalShadows!==w||P.numPointShadows!==M||P.numSpotShadows!==E||P.numSpotMaps!==D||P.numLightProbes!==L)&&(r.directional.length=p,r.spot.length=x,r.rectArea.length=v,r.point.length=g,r.hemi.length=b,r.directionalShadow.length=w,r.directionalShadowMap.length=w,r.pointShadow.length=M,r.pointShadowMap.length=M,r.spotShadow.length=E,r.spotShadowMap.length=E,r.directionalShadowMatrix.length=w,r.pointShadowMatrix.length=M,r.spotLightMatrix.length=E+D-T,r.spotLightMap.length=D,r.numSpotLightShadowsWithMaps=T,r.numLightProbes=L,P.directionalLength=p,P.pointLength=g,P.spotLength=x,P.rectAreaLength=v,P.hemiLength=b,P.numDirectionalShadows=w,P.numPointShadows=M,P.numSpotShadows=E,P.numSpotMaps=D,P.numLightProbes=L,r.version=_4e++)}function l(c,u){let h=0,d=0,p=0,g=0,x=0;const v=u.matrixWorldInverse;for(let b=0,w=c.length;b<w;b++){const M=c[b];if(M.isDirectionalLight){const E=r.directional[h];E.direction.setFromMatrixPosition(M.matrixWorld),n.setFromMatrixPosition(M.target.matrixWorld),E.direction.sub(n),E.direction.transformDirection(v),h++}else if(M.isSpotLight){const E=r.spot[p];E.position.setFromMatrixPosition(M.matrixWorld),E.position.applyMatrix4(v),E.direction.setFromMatrixPosition(M.matrixWorld),n.setFromMatrixPosition(M.target.matrixWorld),E.direction.sub(n),E.direction.transformDirection(v),p++}else if(M.isRectAreaLight){const E=r.rectArea[g];E.position.setFromMatrixPosition(M.matrixWorld),E.position.applyMatrix4(v),a.identity(),s.copy(M.matrixWorld),s.premultiply(v),a.extractRotation(s),E.halfWidth.set(M.width*.5,0,0),E.halfHeight.set(0,M.height*.5,0),E.halfWidth.applyMatrix4(a),E.halfHeight.applyMatrix4(a),g++}else if(M.isPointLight){const E=r.point[d];E.position.setFromMatrixPosition(M.matrixWorld),E.position.applyMatrix4(v),d++}else if(M.isHemisphereLight){const E=r.hemi[x];E.direction.setFromMatrixPosition(M.matrixWorld),E.direction.transformDirection(v),x++}}}return{setup:o,setupView:l,state:r}}function $W(t){const e=new w4e(t),i=[],r=[];function n(u){c.camera=u,i.length=0,r.length=0}function s(u){i.push(u)}function a(u){r.push(u)}function o(){e.setup(i)}function l(u){e.setupView(i,u)}const c={lightsArray:i,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:n,state:c,setupLights:o,setupLightsView:l,pushLight:s,pushShadow:a}}function M4e(t){let e=new WeakMap;function i(n,s=0){const a=e.get(n);let o;return a===void 0?(o=new $W(t),e.set(n,[o])):s>=a.length?(o=new $W(t),a.push(o)):o=a[s],o}function r(){e=new WeakMap}return{get:i,dispose:r}}const E4e=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,A4e=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function T4e(t,e,i){let r=new FM;const n=new Tt,s=new Tt,a=new Ar,o=new zP({depthPacking:cF}),l=new UP,c={},u=i.maxTextureSize,h={[Op]:ll,[ll]:Op,[ch]:ch},d=new _h({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Tt},radius:{value:4}},vertexShader:E4e,fragmentShader:A4e}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const g=new sr;g.setAttribute("position",new fn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const x=new is(g,d),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=nP;let b=this.type;this.render=function(T,L,P){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||T.length===0)return;const R=t.getRenderTarget(),O=t.getActiveCubeFace(),U=t.getActiveMipmapLevel(),F=t.state;F.setBlending(wp),F.buffers.color.setClear(1,1,1,1),F.buffers.depth.setTest(!0),F.setScissorTest(!1);const V=b!==sh&&this.type===sh,k=b===sh&&this.type!==sh;for(let K=0,X=T.length;K<X;K++){const $=T[K],Y=$.shadow;if(Y===void 0){console.warn("THREE.WebGLShadowMap:",$,"has no shadow.");continue}if(Y.autoUpdate===!1&&Y.needsUpdate===!1)continue;n.copy(Y.mapSize);const re=Y.getFrameExtents();if(n.multiply(re),s.copy(Y.mapSize),(n.x>u||n.y>u)&&(n.x>u&&(s.x=Math.floor(u/re.x),n.x=s.x*re.x,Y.mapSize.x=s.x),n.y>u&&(s.y=Math.floor(u/re.y),n.y=s.y*re.y,Y.mapSize.y=s.y)),Y.map===null||V===!0||k===!0){const j=this.type!==sh?{minFilter:no,magFilter:no}:{};Y.map!==null&&Y.map.dispose(),Y.map=new Yd(n.x,n.y,j),Y.map.texture.name=$.name+".shadowMap",Y.camera.updateProjectionMatrix()}t.setRenderTarget(Y.map),t.clear();const G=Y.getViewportCount();for(let j=0;j<G;j++){const ee=Y.getViewport(j);a.set(s.x*ee.x,s.y*ee.y,s.x*ee.z,s.y*ee.w),F.viewport(a),Y.updateMatrices($,j),r=Y.getFrustum(),E(L,P,Y.camera,$,this.type)}Y.isPointLightShadow!==!0&&this.type===sh&&w(Y,P),Y.needsUpdate=!1}b=this.type,v.needsUpdate=!1,t.setRenderTarget(R,O,U)};function w(T,L){const P=e.update(x);d.defines.VSM_SAMPLES!==T.blurSamples&&(d.defines.VSM_SAMPLES=T.blurSamples,p.defines.VSM_SAMPLES=T.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),T.mapPass===null&&(T.mapPass=new Yd(n.x,n.y)),d.uniforms.shadow_pass.value=T.map.texture,d.uniforms.resolution.value=T.mapSize,d.uniforms.radius.value=T.radius,t.setRenderTarget(T.mapPass),t.clear(),t.renderBufferDirect(L,null,P,d,x,null),p.uniforms.shadow_pass.value=T.mapPass.texture,p.uniforms.resolution.value=T.mapSize,p.uniforms.radius.value=T.radius,t.setRenderTarget(T.map),t.clear(),t.renderBufferDirect(L,null,P,p,x,null)}function M(T,L,P,R){let O=null;const U=P.isPointLight===!0?T.customDistanceMaterial:T.customDepthMaterial;if(U!==void 0)O=U;else if(O=P.isPointLight===!0?l:o,t.localClippingEnabled&&L.clipShadows===!0&&Array.isArray(L.clippingPlanes)&&L.clippingPlanes.length!==0||L.displacementMap&&L.displacementScale!==0||L.alphaMap&&L.alphaTest>0||L.map&&L.alphaTest>0){const F=O.uuid,V=L.uuid;let k=c[F];k===void 0&&(k={},c[F]=k);let K=k[V];K===void 0&&(K=O.clone(),k[V]=K,L.addEventListener("dispose",D)),O=K}if(O.visible=L.visible,O.wireframe=L.wireframe,R===sh?O.side=L.shadowSide!==null?L.shadowSide:L.side:O.side=L.shadowSide!==null?L.shadowSide:h[L.side],O.alphaMap=L.alphaMap,O.alphaTest=L.alphaTest,O.map=L.map,O.clipShadows=L.clipShadows,O.clippingPlanes=L.clippingPlanes,O.clipIntersection=L.clipIntersection,O.displacementMap=L.displacementMap,O.displacementScale=L.displacementScale,O.displacementBias=L.displacementBias,O.wireframeLinewidth=L.wireframeLinewidth,O.linewidth=L.linewidth,P.isPointLight===!0&&O.isMeshDistanceMaterial===!0){const F=t.properties.get(O);F.light=P}return O}function E(T,L,P,R,O){if(T.visible===!1)return;if(T.layers.test(L.layers)&&(T.isMesh||T.isLine||T.isPoints)&&(T.castShadow||T.receiveShadow&&O===sh)&&(!T.frustumCulled||r.intersectsObject(T))){T.modelViewMatrix.multiplyMatrices(P.matrixWorldInverse,T.matrixWorld);const V=e.update(T),k=T.material;if(Array.isArray(k)){const K=V.groups;for(let X=0,$=K.length;X<$;X++){const Y=K[X],re=k[Y.materialIndex];if(re&&re.visible){const G=M(T,re,R,O);T.onBeforeShadow(t,T,L,P,V,G,Y),t.renderBufferDirect(P,null,V,G,T,Y),T.onAfterShadow(t,T,L,P,V,G,Y)}}}else if(k.visible){const K=M(T,k,R,O);T.onBeforeShadow(t,T,L,P,V,K,null),t.renderBufferDirect(P,null,V,K,T,null),T.onAfterShadow(t,T,L,P,V,K,null)}}const F=T.children;for(let V=0,k=F.length;V<k;V++)E(F[V],L,P,R,O)}function D(T){T.target.removeEventListener("dispose",D);for(const P in c){const R=c[P],O=T.target.uuid;O in R&&(R[O].dispose(),delete R[O])}}}const C4e={[DD]:PD,[RD]:ID,[OD]:zD,[k0]:LD,[PD]:DD,[ID]:RD,[zD]:OD,[LD]:k0};function D4e(t,e){function i(){let le=!1;const Re=new Ar;let Ee=null;const Qe=new Ar(0,0,0,0);return{setMask:function(ot){Ee!==ot&&!le&&(t.colorMask(ot,ot,ot,ot),Ee=ot)},setLocked:function(ot){le=ot},setClear:function(ot,pt,Bt,Jt,qt){qt===!0&&(ot*=Jt,pt*=Jt,Bt*=Jt),Re.set(ot,pt,Bt,Jt),Qe.equals(Re)===!1&&(t.clearColor(ot,pt,Bt,Jt),Qe.copy(Re))},reset:function(){le=!1,Ee=null,Qe.set(-1,0,0,0)}}}function r(){let le=!1,Re=!1,Ee=null,Qe=null,ot=null;return{setReversed:function(pt){if(Re!==pt){const Bt=e.get("EXT_clip_control");Re?Bt.clipControlEXT(Bt.LOWER_LEFT_EXT,Bt.ZERO_TO_ONE_EXT):Bt.clipControlEXT(Bt.LOWER_LEFT_EXT,Bt.NEGATIVE_ONE_TO_ONE_EXT);const Jt=ot;ot=null,this.setClear(Jt)}Re=pt},getReversed:function(){return Re},setTest:function(pt){pt?ue(t.DEPTH_TEST):fe(t.DEPTH_TEST)},setMask:function(pt){Ee!==pt&&!le&&(t.depthMask(pt),Ee=pt)},setFunc:function(pt){if(Re&&(pt=C4e[pt]),Qe!==pt){switch(pt){case DD:t.depthFunc(t.NEVER);break;case PD:t.depthFunc(t.ALWAYS);break;case RD:t.depthFunc(t.LESS);break;case k0:t.depthFunc(t.LEQUAL);break;case OD:t.depthFunc(t.EQUAL);break;case LD:t.depthFunc(t.GEQUAL);break;case ID:t.depthFunc(t.GREATER);break;case zD:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}Qe=pt}},setLocked:function(pt){le=pt},setClear:function(pt){ot!==pt&&(Re&&(pt=1-pt),t.clearDepth(pt),ot=pt)},reset:function(){le=!1,Ee=null,Qe=null,ot=null,Re=!1}}}function n(){let le=!1,Re=null,Ee=null,Qe=null,ot=null,pt=null,Bt=null,Jt=null,qt=null;return{setTest:function(Ft){le||(Ft?ue(t.STENCIL_TEST):fe(t.STENCIL_TEST))},setMask:function(Ft){Re!==Ft&&!le&&(t.stencilMask(Ft),Re=Ft)},setFunc:function(Ft,Ni,Oi){(Ee!==Ft||Qe!==Ni||ot!==Oi)&&(t.stencilFunc(Ft,Ni,Oi),Ee=Ft,Qe=Ni,ot=Oi)},setOp:function(Ft,Ni,Oi){(pt!==Ft||Bt!==Ni||Jt!==Oi)&&(t.stencilOp(Ft,Ni,Oi),pt=Ft,Bt=Ni,Jt=Oi)},setLocked:function(Ft){le=Ft},setClear:function(Ft){qt!==Ft&&(t.clearStencil(Ft),qt=Ft)},reset:function(){le=!1,Re=null,Ee=null,Qe=null,ot=null,pt=null,Bt=null,Jt=null,qt=null}}}const s=new i,a=new r,o=new n,l=new WeakMap,c=new WeakMap;let u={},h={},d=new WeakMap,p=[],g=null,x=!1,v=null,b=null,w=null,M=null,E=null,D=null,T=null,L=new Zt(0,0,0),P=0,R=!1,O=null,U=null,F=null,V=null,k=null;const K=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let X=!1,$=0;const Y=t.getParameter(t.VERSION);Y.indexOf("WebGL")!==-1?($=parseFloat(/^WebGL (\d)/.exec(Y)[1]),X=$>=1):Y.indexOf("OpenGL ES")!==-1&&($=parseFloat(/^OpenGL ES (\d)/.exec(Y)[1]),X=$>=2);let re=null,G={};const j=t.getParameter(t.SCISSOR_BOX),ee=t.getParameter(t.VIEWPORT),oe=new Ar().fromArray(j),Q=new Ar().fromArray(ee);function ae(le,Re,Ee,Qe){const ot=new Uint8Array(4),pt=t.createTexture();t.bindTexture(le,pt),t.texParameteri(le,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(le,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let Bt=0;Bt<Ee;Bt++)le===t.TEXTURE_3D||le===t.TEXTURE_2D_ARRAY?t.texImage3D(Re,0,t.RGBA,1,1,Qe,0,t.RGBA,t.UNSIGNED_BYTE,ot):t.texImage2D(Re+Bt,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,ot);return pt}const ne={};ne[t.TEXTURE_2D]=ae(t.TEXTURE_2D,t.TEXTURE_2D,1),ne[t.TEXTURE_CUBE_MAP]=ae(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),ne[t.TEXTURE_2D_ARRAY]=ae(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),ne[t.TEXTURE_3D]=ae(t.TEXTURE_3D,t.TEXTURE_3D,1,1),s.setClear(0,0,0,1),a.setClear(1),o.setClear(0),ue(t.DEPTH_TEST),a.setFunc(k0),ze(!1),Xe(EB),ue(t.CULL_FACE),ce(wp);function ue(le){u[le]!==!0&&(t.enable(le),u[le]=!0)}function fe(le){u[le]!==!1&&(t.disable(le),u[le]=!1)}function xe(le,Re){return h[le]!==Re?(t.bindFramebuffer(le,Re),h[le]=Re,le===t.DRAW_FRAMEBUFFER&&(h[t.FRAMEBUFFER]=Re),le===t.FRAMEBUFFER&&(h[t.DRAW_FRAMEBUFFER]=Re),!0):!1}function be(le,Re){let Ee=p,Qe=!1;if(le){Ee=d.get(Re),Ee===void 0&&(Ee=[],d.set(Re,Ee));const ot=le.textures;if(Ee.length!==ot.length||Ee[0]!==t.COLOR_ATTACHMENT0){for(let pt=0,Bt=ot.length;pt<Bt;pt++)Ee[pt]=t.COLOR_ATTACHMENT0+pt;Ee.length=ot.length,Qe=!0}}else Ee[0]!==t.BACK&&(Ee[0]=t.BACK,Qe=!0);Qe&&t.drawBuffers(Ee)}function Ce(le){return g!==le?(t.useProgram(le),g=le,!0):!1}const ge={[tg]:t.FUNC_ADD,[oK]:t.FUNC_SUBTRACT,[lK]:t.FUNC_REVERSE_SUBTRACT};ge[cK]=t.MIN,ge[uK]=t.MAX;const Te={[hK]:t.ZERO,[dK]:t.ONE,[fK]:t.SRC_COLOR,[TD]:t.SRC_ALPHA,[xK]:t.SRC_ALPHA_SATURATE,[vK]:t.DST_COLOR,[mK]:t.DST_ALPHA,[pK]:t.ONE_MINUS_SRC_COLOR,[CD]:t.ONE_MINUS_SRC_ALPHA,[yK]:t.ONE_MINUS_DST_COLOR,[gK]:t.ONE_MINUS_DST_ALPHA,[bK]:t.CONSTANT_COLOR,[_K]:t.ONE_MINUS_CONSTANT_COLOR,[SK]:t.CONSTANT_ALPHA,[wK]:t.ONE_MINUS_CONSTANT_ALPHA};function ce(le,Re,Ee,Qe,ot,pt,Bt,Jt,qt,Ft){if(le===wp){x===!0&&(fe(t.BLEND),x=!1);return}if(x===!1&&(ue(t.BLEND),x=!0),le!==aK){if(le!==v||Ft!==R){if((b!==tg||E!==tg)&&(t.blendEquation(t.FUNC_ADD),b=tg,E=tg),Ft)switch(le){case E0:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case AB:t.blendFunc(t.ONE,t.ONE);break;case TB:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case CB:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",le);break}else switch(le){case E0:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case AB:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case TB:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case CB:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",le);break}w=null,M=null,D=null,T=null,L.set(0,0,0),P=0,v=le,R=Ft}return}ot=ot||Re,pt=pt||Ee,Bt=Bt||Qe,(Re!==b||ot!==E)&&(t.blendEquationSeparate(ge[Re],ge[ot]),b=Re,E=ot),(Ee!==w||Qe!==M||pt!==D||Bt!==T)&&(t.blendFuncSeparate(Te[Ee],Te[Qe],Te[pt],Te[Bt]),w=Ee,M=Qe,D=pt,T=Bt),(Jt.equals(L)===!1||qt!==P)&&(t.blendColor(Jt.r,Jt.g,Jt.b,qt),L.copy(Jt),P=qt),v=le,R=!1}function Ue(le,Re){le.side===ch?fe(t.CULL_FACE):ue(t.CULL_FACE);let Ee=le.side===ll;Re&&(Ee=!Ee),ze(Ee),le.blending===E0&&le.transparent===!1?ce(wp):ce(le.blending,le.blendEquation,le.blendSrc,le.blendDst,le.blendEquationAlpha,le.blendSrcAlpha,le.blendDstAlpha,le.blendColor,le.blendAlpha,le.premultipliedAlpha),a.setFunc(le.depthFunc),a.setTest(le.depthTest),a.setMask(le.depthWrite),s.setMask(le.colorWrite);const Qe=le.stencilWrite;o.setTest(Qe),Qe&&(o.setMask(le.stencilWriteMask),o.setFunc(le.stencilFunc,le.stencilRef,le.stencilFuncMask),o.setOp(le.stencilFail,le.stencilZFail,le.stencilZPass)),Ge(le.polygonOffset,le.polygonOffsetFactor,le.polygonOffsetUnits),le.alphaToCoverage===!0?ue(t.SAMPLE_ALPHA_TO_COVERAGE):fe(t.SAMPLE_ALPHA_TO_COVERAGE)}function ze(le){O!==le&&(le?t.frontFace(t.CW):t.frontFace(t.CCW),O=le)}function Xe(le){le!==rK?(ue(t.CULL_FACE),le!==U&&(le===EB?t.cullFace(t.BACK):le===nK?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):fe(t.CULL_FACE),U=le}function De(le){le!==F&&(X&&t.lineWidth(le),F=le)}function Ge(le,Re,Ee){le?(ue(t.POLYGON_OFFSET_FILL),(V!==Re||k!==Ee)&&(t.polygonOffset(Re,Ee),V=Re,k=Ee)):fe(t.POLYGON_OFFSET_FILL)}function We(le){le?ue(t.SCISSOR_TEST):fe(t.SCISSOR_TEST)}function se(le){le===void 0&&(le=t.TEXTURE0+K-1),re!==le&&(t.activeTexture(le),re=le)}function H(le,Re,Ee){Ee===void 0&&(re===null?Ee=t.TEXTURE0+K-1:Ee=re);let Qe=G[Ee];Qe===void 0&&(Qe={type:void 0,texture:void 0},G[Ee]=Qe),(Qe.type!==le||Qe.texture!==Re)&&(re!==Ee&&(t.activeTexture(Ee),re=Ee),t.bindTexture(le,Re||ne[le]),Qe.type=le,Qe.texture=Re)}function Z(){const le=G[re];le!==void 0&&le.type!==void 0&&(t.bindTexture(le.type,null),le.type=void 0,le.texture=void 0)}function pe(){try{t.compressedTexImage2D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function we(){try{t.compressedTexImage3D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function J(){try{t.texSubImage2D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function He(){try{t.texSubImage3D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function je(){try{t.compressedTexSubImage2D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function Ye(){try{t.compressedTexSubImage3D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function Ve(){try{t.texStorage2D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function Ke(){try{t.texStorage3D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function at(){try{t.texImage2D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function ut(){try{t.texImage3D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function ht(le){oe.equals(le)===!1&&(t.scissor(le.x,le.y,le.z,le.w),oe.copy(le))}function $e(le){Q.equals(le)===!1&&(t.viewport(le.x,le.y,le.z,le.w),Q.copy(le))}function St(le,Re){let Ee=c.get(Re);Ee===void 0&&(Ee=new WeakMap,c.set(Re,Ee));let Qe=Ee.get(le);Qe===void 0&&(Qe=t.getUniformBlockIndex(Re,le.name),Ee.set(le,Qe))}function Pt(le,Re){const Qe=c.get(Re).get(le);l.get(Re)!==Qe&&(t.uniformBlockBinding(Re,Qe,le.__bindingPointIndex),l.set(Re,Qe))}function Kt(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),a.setReversed(!1),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),u={},re=null,G={},h={},d=new WeakMap,p=[],g=null,x=!1,v=null,b=null,w=null,M=null,E=null,D=null,T=null,L=new Zt(0,0,0),P=0,R=!1,O=null,U=null,F=null,V=null,k=null,oe.set(0,0,t.canvas.width,t.canvas.height),Q.set(0,0,t.canvas.width,t.canvas.height),s.reset(),a.reset(),o.reset()}return{buffers:{color:s,depth:a,stencil:o},enable:ue,disable:fe,bindFramebuffer:xe,drawBuffers:be,useProgram:Ce,setBlending:ce,setMaterial:Ue,setFlipSided:ze,setCullFace:Xe,setLineWidth:De,setPolygonOffset:Ge,setScissorTest:We,activeTexture:se,bindTexture:H,unbindTexture:Z,compressedTexImage2D:pe,compressedTexImage3D:we,texImage2D:at,texImage3D:ut,updateUBOMapping:St,uniformBlockBinding:Pt,texStorage2D:Ve,texStorage3D:Ke,texSubImage2D:J,texSubImage3D:He,compressedTexSubImage2D:je,compressedTexSubImage3D:Ye,scissor:ht,viewport:$e,reset:Kt}}function P4e(t,e,i,r,n,s,a){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new Tt,u=new WeakMap;let h;const d=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function g(se,H){return p?new OffscreenCanvas(se,H):tM("canvas")}function x(se,H,Z){let pe=1;const we=We(se);if((we.width>Z||we.height>Z)&&(pe=Z/Math.max(we.width,we.height)),pe<1)if(typeof HTMLImageElement<"u"&&se instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&se instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&se instanceof ImageBitmap||typeof VideoFrame<"u"&&se instanceof VideoFrame){const J=Math.floor(pe*we.width),He=Math.floor(pe*we.height);h===void 0&&(h=g(J,He));const je=H?g(J,He):h;return je.width=J,je.height=He,je.getContext("2d").drawImage(se,0,0,J,He),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+we.width+"x"+we.height+") to ("+J+"x"+He+")."),je}else return"data"in se&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+we.width+"x"+we.height+")."),se;return se}function v(se){return se.generateMipmaps}function b(se){t.generateMipmap(se)}function w(se){return se.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:se.isWebGL3DRenderTarget?t.TEXTURE_3D:se.isWebGLArrayRenderTarget||se.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D}function M(se,H,Z,pe,we=!1){if(se!==null){if(t[se]!==void 0)return t[se];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+se+"'")}let J=H;if(H===t.RED&&(Z===t.FLOAT&&(J=t.R32F),Z===t.HALF_FLOAT&&(J=t.R16F),Z===t.UNSIGNED_BYTE&&(J=t.R8)),H===t.RED_INTEGER&&(Z===t.UNSIGNED_BYTE&&(J=t.R8UI),Z===t.UNSIGNED_SHORT&&(J=t.R16UI),Z===t.UNSIGNED_INT&&(J=t.R32UI),Z===t.BYTE&&(J=t.R8I),Z===t.SHORT&&(J=t.R16I),Z===t.INT&&(J=t.R32I)),H===t.RG&&(Z===t.FLOAT&&(J=t.RG32F),Z===t.HALF_FLOAT&&(J=t.RG16F),Z===t.UNSIGNED_BYTE&&(J=t.RG8)),H===t.RG_INTEGER&&(Z===t.UNSIGNED_BYTE&&(J=t.RG8UI),Z===t.UNSIGNED_SHORT&&(J=t.RG16UI),Z===t.UNSIGNED_INT&&(J=t.RG32UI),Z===t.BYTE&&(J=t.RG8I),Z===t.SHORT&&(J=t.RG16I),Z===t.INT&&(J=t.RG32I)),H===t.RGB_INTEGER&&(Z===t.UNSIGNED_BYTE&&(J=t.RGB8UI),Z===t.UNSIGNED_SHORT&&(J=t.RGB16UI),Z===t.UNSIGNED_INT&&(J=t.RGB32UI),Z===t.BYTE&&(J=t.RGB8I),Z===t.SHORT&&(J=t.RGB16I),Z===t.INT&&(J=t.RGB32I)),H===t.RGBA_INTEGER&&(Z===t.UNSIGNED_BYTE&&(J=t.RGBA8UI),Z===t.UNSIGNED_SHORT&&(J=t.RGBA16UI),Z===t.UNSIGNED_INT&&(J=t.RGBA32UI),Z===t.BYTE&&(J=t.RGBA8I),Z===t.SHORT&&(J=t.RGBA16I),Z===t.INT&&(J=t.RGBA32I)),H===t.RGB&&Z===t.UNSIGNED_INT_5_9_9_9_REV&&(J=t.RGB9_E5),H===t.RGBA){const He=we?Jw:Er.getTransfer(pe);Z===t.FLOAT&&(J=t.RGBA32F),Z===t.HALF_FLOAT&&(J=t.RGBA16F),Z===t.UNSIGNED_BYTE&&(J=He===tn?t.SRGB8_ALPHA8:t.RGBA8),Z===t.UNSIGNED_SHORT_4_4_4_4&&(J=t.RGBA4),Z===t.UNSIGNED_SHORT_5_5_5_1&&(J=t.RGB5_A1)}return(J===t.R16F||J===t.R32F||J===t.RG16F||J===t.RG32F||J===t.RGBA16F||J===t.RGBA32F)&&e.get("EXT_color_buffer_float"),J}function E(se,H){let Z;return se?H===null||H===Ip||H===V0?Z=t.DEPTH24_STENCIL8:H===jl?Z=t.DEPTH32F_STENCIL8:H===W1&&(Z=t.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):H===null||H===Ip||H===V0?Z=t.DEPTH_COMPONENT24:H===jl?Z=t.DEPTH_COMPONENT32F:H===W1&&(Z=t.DEPTH_COMPONENT16),Z}function D(se,H){return v(se)===!0||se.isFramebufferTexture&&se.minFilter!==no&&se.minFilter!==Cs?Math.log2(Math.max(H.width,H.height))+1:se.mipmaps!==void 0&&se.mipmaps.length>0?se.mipmaps.length:se.isCompressedTexture&&Array.isArray(se.image)?H.mipmaps.length:1}function T(se){const H=se.target;H.removeEventListener("dispose",T),P(H),H.isVideoTexture&&u.delete(H)}function L(se){const H=se.target;H.removeEventListener("dispose",L),O(H)}function P(se){const H=r.get(se);if(H.__webglInit===void 0)return;const Z=se.source,pe=d.get(Z);if(pe){const we=pe[H.__cacheKey];we.usedTimes--,we.usedTimes===0&&R(se),Object.keys(pe).length===0&&d.delete(Z)}r.remove(se)}function R(se){const H=r.get(se);t.deleteTexture(H.__webglTexture);const Z=se.source,pe=d.get(Z);delete pe[H.__cacheKey],a.memory.textures--}function O(se){const H=r.get(se);if(se.depthTexture&&(se.depthTexture.dispose(),r.remove(se.depthTexture)),se.isWebGLCubeRenderTarget)for(let pe=0;pe<6;pe++){if(Array.isArray(H.__webglFramebuffer[pe]))for(let we=0;we<H.__webglFramebuffer[pe].length;we++)t.deleteFramebuffer(H.__webglFramebuffer[pe][we]);else t.deleteFramebuffer(H.__webglFramebuffer[pe]);H.__webglDepthbuffer&&t.deleteRenderbuffer(H.__webglDepthbuffer[pe])}else{if(Array.isArray(H.__webglFramebuffer))for(let pe=0;pe<H.__webglFramebuffer.length;pe++)t.deleteFramebuffer(H.__webglFramebuffer[pe]);else t.deleteFramebuffer(H.__webglFramebuffer);if(H.__webglDepthbuffer&&t.deleteRenderbuffer(H.__webglDepthbuffer),H.__webglMultisampledFramebuffer&&t.deleteFramebuffer(H.__webglMultisampledFramebuffer),H.__webglColorRenderbuffer)for(let pe=0;pe<H.__webglColorRenderbuffer.length;pe++)H.__webglColorRenderbuffer[pe]&&t.deleteRenderbuffer(H.__webglColorRenderbuffer[pe]);H.__webglDepthRenderbuffer&&t.deleteRenderbuffer(H.__webglDepthRenderbuffer)}const Z=se.textures;for(let pe=0,we=Z.length;pe<we;pe++){const J=r.get(Z[pe]);J.__webglTexture&&(t.deleteTexture(J.__webglTexture),a.memory.textures--),r.remove(Z[pe])}r.remove(se)}let U=0;function F(){U=0}function V(){const se=U;return se>=n.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+se+" texture units while this GPU supports only "+n.maxTextures),U+=1,se}function k(se){const H=[];return H.push(se.wrapS),H.push(se.wrapT),H.push(se.wrapR||0),H.push(se.magFilter),H.push(se.minFilter),H.push(se.anisotropy),H.push(se.internalFormat),H.push(se.format),H.push(se.type),H.push(se.generateMipmaps),H.push(se.premultiplyAlpha),H.push(se.flipY),H.push(se.unpackAlignment),H.push(se.colorSpace),H.join()}function K(se,H){const Z=r.get(se);if(se.isVideoTexture&&De(se),se.isRenderTargetTexture===!1&&se.version>0&&Z.__version!==se.version){const pe=se.image;if(pe===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(pe.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Q(Z,se,H);return}}i.bindTexture(t.TEXTURE_2D,Z.__webglTexture,t.TEXTURE0+H)}function X(se,H){const Z=r.get(se);if(se.version>0&&Z.__version!==se.version){Q(Z,se,H);return}i.bindTexture(t.TEXTURE_2D_ARRAY,Z.__webglTexture,t.TEXTURE0+H)}function $(se,H){const Z=r.get(se);if(se.version>0&&Z.__version!==se.version){Q(Z,se,H);return}i.bindTexture(t.TEXTURE_3D,Z.__webglTexture,t.TEXTURE0+H)}function Y(se,H){const Z=r.get(se);if(se.version>0&&Z.__version!==se.version){ae(Z,se,H);return}i.bindTexture(t.TEXTURE_CUBE_MAP,Z.__webglTexture,t.TEXTURE0+H)}const re={[Yw]:t.REPEAT,[tu]:t.CLAMP_TO_EDGE,[Qw]:t.MIRRORED_REPEAT},G={[no]:t.NEAREST,[J4]:t.NEAREST_MIPMAP_NEAREST,[a1]:t.NEAREST_MIPMAP_LINEAR,[Cs]:t.LINEAR,[lw]:t.LINEAR_MIPMAP_NEAREST,[Id]:t.LINEAR_MIPMAP_LINEAR},j={[NK]:t.NEVER,[jK]:t.ALWAYS,[FK]:t.LESS,[uF]:t.LEQUAL,[kK]:t.EQUAL,[GK]:t.GEQUAL,[VK]:t.GREATER,[HK]:t.NOTEQUAL};function ee(se,H){if(H.type===jl&&e.has("OES_texture_float_linear")===!1&&(H.magFilter===Cs||H.magFilter===lw||H.magFilter===a1||H.magFilter===Id||H.minFilter===Cs||H.minFilter===lw||H.minFilter===a1||H.minFilter===Id)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(se,t.TEXTURE_WRAP_S,re[H.wrapS]),t.texParameteri(se,t.TEXTURE_WRAP_T,re[H.wrapT]),(se===t.TEXTURE_3D||se===t.TEXTURE_2D_ARRAY)&&t.texParameteri(se,t.TEXTURE_WRAP_R,re[H.wrapR]),t.texParameteri(se,t.TEXTURE_MAG_FILTER,G[H.magFilter]),t.texParameteri(se,t.TEXTURE_MIN_FILTER,G[H.minFilter]),H.compareFunction&&(t.texParameteri(se,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(se,t.TEXTURE_COMPARE_FUNC,j[H.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(H.magFilter===no||H.minFilter!==a1&&H.minFilter!==Id||H.type===jl&&e.has("OES_texture_float_linear")===!1)return;if(H.anisotropy>1||r.get(H).__currentAnisotropy){const Z=e.get("EXT_texture_filter_anisotropic");t.texParameterf(se,Z.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(H.anisotropy,n.getMaxAnisotropy())),r.get(H).__currentAnisotropy=H.anisotropy}}}function oe(se,H){let Z=!1;se.__webglInit===void 0&&(se.__webglInit=!0,H.addEventListener("dispose",T));const pe=H.source;let we=d.get(pe);we===void 0&&(we={},d.set(pe,we));const J=k(H);if(J!==se.__cacheKey){we[J]===void 0&&(we[J]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,Z=!0),we[J].usedTimes++;const He=we[se.__cacheKey];He!==void 0&&(we[se.__cacheKey].usedTimes--,He.usedTimes===0&&R(H)),se.__cacheKey=J,se.__webglTexture=we[J].texture}return Z}function Q(se,H,Z){let pe=t.TEXTURE_2D;(H.isDataArrayTexture||H.isCompressedArrayTexture)&&(pe=t.TEXTURE_2D_ARRAY),H.isData3DTexture&&(pe=t.TEXTURE_3D);const we=oe(se,H),J=H.source;i.bindTexture(pe,se.__webglTexture,t.TEXTURE0+Z);const He=r.get(J);if(J.version!==He.__version||we===!0){i.activeTexture(t.TEXTURE0+Z);const je=Er.getPrimaries(Er.workingColorSpace),Ye=H.colorSpace===hp?null:Er.getPrimaries(H.colorSpace),Ve=H.colorSpace===hp||je===Ye?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,H.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,H.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,H.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ve);let Ke=x(H.image,!1,n.maxTextureSize);Ke=Ge(H,Ke);const at=s.convert(H.format,H.colorSpace),ut=s.convert(H.type);let ht=M(H.internalFormat,at,ut,H.colorSpace,H.isVideoTexture);ee(pe,H);let $e;const St=H.mipmaps,Pt=H.isVideoTexture!==!0,Kt=He.__version===void 0||we===!0,le=J.dataReady,Re=D(H,Ke);if(H.isDepthTexture)ht=E(H.format===H0,H.type),Kt&&(Pt?i.texStorage2D(t.TEXTURE_2D,1,ht,Ke.width,Ke.height):i.texImage2D(t.TEXTURE_2D,0,ht,Ke.width,Ke.height,0,at,ut,null));else if(H.isDataTexture)if(St.length>0){Pt&&Kt&&i.texStorage2D(t.TEXTURE_2D,Re,ht,St[0].width,St[0].height);for(let Ee=0,Qe=St.length;Ee<Qe;Ee++)$e=St[Ee],Pt?le&&i.texSubImage2D(t.TEXTURE_2D,Ee,0,0,$e.width,$e.height,at,ut,$e.data):i.texImage2D(t.TEXTURE_2D,Ee,ht,$e.width,$e.height,0,at,ut,$e.data);H.generateMipmaps=!1}else Pt?(Kt&&i.texStorage2D(t.TEXTURE_2D,Re,ht,Ke.width,Ke.height),le&&i.texSubImage2D(t.TEXTURE_2D,0,0,0,Ke.width,Ke.height,at,ut,Ke.data)):i.texImage2D(t.TEXTURE_2D,0,ht,Ke.width,Ke.height,0,at,ut,Ke.data);else if(H.isCompressedTexture)if(H.isCompressedArrayTexture){Pt&&Kt&&i.texStorage3D(t.TEXTURE_2D_ARRAY,Re,ht,St[0].width,St[0].height,Ke.depth);for(let Ee=0,Qe=St.length;Ee<Qe;Ee++)if($e=St[Ee],H.format!==Lo)if(at!==null)if(Pt){if(le)if(H.layerUpdates.size>0){const ot=NB($e.width,$e.height,H.format,H.type);for(const pt of H.layerUpdates){const Bt=$e.data.subarray(pt*ot/$e.data.BYTES_PER_ELEMENT,(pt+1)*ot/$e.data.BYTES_PER_ELEMENT);i.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,Ee,0,0,pt,$e.width,$e.height,1,at,Bt)}H.clearLayerUpdates()}else i.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,Ee,0,0,0,$e.width,$e.height,Ke.depth,at,$e.data)}else i.compressedTexImage3D(t.TEXTURE_2D_ARRAY,Ee,ht,$e.width,$e.height,Ke.depth,0,$e.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Pt?le&&i.texSubImage3D(t.TEXTURE_2D_ARRAY,Ee,0,0,0,$e.width,$e.height,Ke.depth,at,ut,$e.data):i.texImage3D(t.TEXTURE_2D_ARRAY,Ee,ht,$e.width,$e.height,Ke.depth,0,at,ut,$e.data)}else{Pt&&Kt&&i.texStorage2D(t.TEXTURE_2D,Re,ht,St[0].width,St[0].height);for(let Ee=0,Qe=St.length;Ee<Qe;Ee++)$e=St[Ee],H.format!==Lo?at!==null?Pt?le&&i.compressedTexSubImage2D(t.TEXTURE_2D,Ee,0,0,$e.width,$e.height,at,$e.data):i.compressedTexImage2D(t.TEXTURE_2D,Ee,ht,$e.width,$e.height,0,$e.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Pt?le&&i.texSubImage2D(t.TEXTURE_2D,Ee,0,0,$e.width,$e.height,at,ut,$e.data):i.texImage2D(t.TEXTURE_2D,Ee,ht,$e.width,$e.height,0,at,ut,$e.data)}else if(H.isDataArrayTexture)if(Pt){if(Kt&&i.texStorage3D(t.TEXTURE_2D_ARRAY,Re,ht,Ke.width,Ke.height,Ke.depth),le)if(H.layerUpdates.size>0){const Ee=NB(Ke.width,Ke.height,H.format,H.type);for(const Qe of H.layerUpdates){const ot=Ke.data.subarray(Qe*Ee/Ke.data.BYTES_PER_ELEMENT,(Qe+1)*Ee/Ke.data.BYTES_PER_ELEMENT);i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,Qe,Ke.width,Ke.height,1,at,ut,ot)}H.clearLayerUpdates()}else i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,Ke.width,Ke.height,Ke.depth,at,ut,Ke.data)}else i.texImage3D(t.TEXTURE_2D_ARRAY,0,ht,Ke.width,Ke.height,Ke.depth,0,at,ut,Ke.data);else if(H.isData3DTexture)Pt?(Kt&&i.texStorage3D(t.TEXTURE_3D,Re,ht,Ke.width,Ke.height,Ke.depth),le&&i.texSubImage3D(t.TEXTURE_3D,0,0,0,0,Ke.width,Ke.height,Ke.depth,at,ut,Ke.data)):i.texImage3D(t.TEXTURE_3D,0,ht,Ke.width,Ke.height,Ke.depth,0,at,ut,Ke.data);else if(H.isFramebufferTexture){if(Kt)if(Pt)i.texStorage2D(t.TEXTURE_2D,Re,ht,Ke.width,Ke.height);else{let Ee=Ke.width,Qe=Ke.height;for(let ot=0;ot<Re;ot++)i.texImage2D(t.TEXTURE_2D,ot,ht,Ee,Qe,0,at,ut,null),Ee>>=1,Qe>>=1}}else if(St.length>0){if(Pt&&Kt){const Ee=We(St[0]);i.texStorage2D(t.TEXTURE_2D,Re,ht,Ee.width,Ee.height)}for(let Ee=0,Qe=St.length;Ee<Qe;Ee++)$e=St[Ee],Pt?le&&i.texSubImage2D(t.TEXTURE_2D,Ee,0,0,at,ut,$e):i.texImage2D(t.TEXTURE_2D,Ee,ht,at,ut,$e);H.generateMipmaps=!1}else if(Pt){if(Kt){const Ee=We(Ke);i.texStorage2D(t.TEXTURE_2D,Re,ht,Ee.width,Ee.height)}le&&i.texSubImage2D(t.TEXTURE_2D,0,0,0,at,ut,Ke)}else i.texImage2D(t.TEXTURE_2D,0,ht,at,ut,Ke);v(H)&&b(pe),He.__version=J.version,H.onUpdate&&H.onUpdate(H)}se.__version=H.version}function ae(se,H,Z){if(H.image.length!==6)return;const pe=oe(se,H),we=H.source;i.bindTexture(t.TEXTURE_CUBE_MAP,se.__webglTexture,t.TEXTURE0+Z);const J=r.get(we);if(we.version!==J.__version||pe===!0){i.activeTexture(t.TEXTURE0+Z);const He=Er.getPrimaries(Er.workingColorSpace),je=H.colorSpace===hp?null:Er.getPrimaries(H.colorSpace),Ye=H.colorSpace===hp||He===je?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,H.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,H.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,H.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ye);const Ve=H.isCompressedTexture||H.image[0].isCompressedTexture,Ke=H.image[0]&&H.image[0].isDataTexture,at=[];for(let Qe=0;Qe<6;Qe++)!Ve&&!Ke?at[Qe]=x(H.image[Qe],!0,n.maxCubemapSize):at[Qe]=Ke?H.image[Qe].image:H.image[Qe],at[Qe]=Ge(H,at[Qe]);const ut=at[0],ht=s.convert(H.format,H.colorSpace),$e=s.convert(H.type),St=M(H.internalFormat,ht,$e,H.colorSpace),Pt=H.isVideoTexture!==!0,Kt=J.__version===void 0||pe===!0,le=we.dataReady;let Re=D(H,ut);ee(t.TEXTURE_CUBE_MAP,H);let Ee;if(Ve){Pt&&Kt&&i.texStorage2D(t.TEXTURE_CUBE_MAP,Re,St,ut.width,ut.height);for(let Qe=0;Qe<6;Qe++){Ee=at[Qe].mipmaps;for(let ot=0;ot<Ee.length;ot++){const pt=Ee[ot];H.format!==Lo?ht!==null?Pt?le&&i.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,ot,0,0,pt.width,pt.height,ht,pt.data):i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,ot,St,pt.width,pt.height,0,pt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Pt?le&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,ot,0,0,pt.width,pt.height,ht,$e,pt.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,ot,St,pt.width,pt.height,0,ht,$e,pt.data)}}}else{if(Ee=H.mipmaps,Pt&&Kt){Ee.length>0&&Re++;const Qe=We(at[0]);i.texStorage2D(t.TEXTURE_CUBE_MAP,Re,St,Qe.width,Qe.height)}for(let Qe=0;Qe<6;Qe++)if(Ke){Pt?le&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,0,0,0,at[Qe].width,at[Qe].height,ht,$e,at[Qe].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,0,St,at[Qe].width,at[Qe].height,0,ht,$e,at[Qe].data);for(let ot=0;ot<Ee.length;ot++){const Bt=Ee[ot].image[Qe].image;Pt?le&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,ot+1,0,0,Bt.width,Bt.height,ht,$e,Bt.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,ot+1,St,Bt.width,Bt.height,0,ht,$e,Bt.data)}}else{Pt?le&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,0,0,0,ht,$e,at[Qe]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,0,St,ht,$e,at[Qe]);for(let ot=0;ot<Ee.length;ot++){const pt=Ee[ot];Pt?le&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,ot+1,0,0,ht,$e,pt.image[Qe]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,ot+1,St,ht,$e,pt.image[Qe])}}}v(H)&&b(t.TEXTURE_CUBE_MAP),J.__version=we.version,H.onUpdate&&H.onUpdate(H)}se.__version=H.version}function ne(se,H,Z,pe,we,J){const He=s.convert(Z.format,Z.colorSpace),je=s.convert(Z.type),Ye=M(Z.internalFormat,He,je,Z.colorSpace),Ve=r.get(H),Ke=r.get(Z);if(Ke.__renderTarget=H,!Ve.__hasExternalTextures){const at=Math.max(1,H.width>>J),ut=Math.max(1,H.height>>J);we===t.TEXTURE_3D||we===t.TEXTURE_2D_ARRAY?i.texImage3D(we,J,Ye,at,ut,H.depth,0,He,je,null):i.texImage2D(we,J,Ye,at,ut,0,He,je,null)}i.bindFramebuffer(t.FRAMEBUFFER,se),Xe(H)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,pe,we,Ke.__webglTexture,0,ze(H)):(we===t.TEXTURE_2D||we>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&we<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,pe,we,Ke.__webglTexture,J),i.bindFramebuffer(t.FRAMEBUFFER,null)}function ue(se,H,Z){if(t.bindRenderbuffer(t.RENDERBUFFER,se),H.depthBuffer){const pe=H.depthTexture,we=pe&&pe.isDepthTexture?pe.type:null,J=E(H.stencilBuffer,we),He=H.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,je=ze(H);Xe(H)?o.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,je,J,H.width,H.height):Z?t.renderbufferStorageMultisample(t.RENDERBUFFER,je,J,H.width,H.height):t.renderbufferStorage(t.RENDERBUFFER,J,H.width,H.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,He,t.RENDERBUFFER,se)}else{const pe=H.textures;for(let we=0;we<pe.length;we++){const J=pe[we],He=s.convert(J.format,J.colorSpace),je=s.convert(J.type),Ye=M(J.internalFormat,He,je,J.colorSpace),Ve=ze(H);Z&&Xe(H)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,Ve,Ye,H.width,H.height):Xe(H)?o.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,Ve,Ye,H.width,H.height):t.renderbufferStorage(t.RENDERBUFFER,Ye,H.width,H.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function fe(se,H){if(H&&H.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(t.FRAMEBUFFER,se),!(H.depthTexture&&H.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const pe=r.get(H.depthTexture);pe.__renderTarget=H,(!pe.__webglTexture||H.depthTexture.image.width!==H.width||H.depthTexture.image.height!==H.height)&&(H.depthTexture.image.width=H.width,H.depthTexture.image.height=H.height,H.depthTexture.needsUpdate=!0),K(H.depthTexture,0);const we=pe.__webglTexture,J=ze(H);if(H.depthTexture.format===A0)Xe(H)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,we,0,J):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,we,0);else if(H.depthTexture.format===H0)Xe(H)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,we,0,J):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,we,0);else throw new Error("Unknown depthTexture format")}function xe(se){const H=r.get(se),Z=se.isWebGLCubeRenderTarget===!0;if(H.__boundDepthTexture!==se.depthTexture){const pe=se.depthTexture;if(H.__depthDisposeCallback&&H.__depthDisposeCallback(),pe){const we=()=>{delete H.__boundDepthTexture,delete H.__depthDisposeCallback,pe.removeEventListener("dispose",we)};pe.addEventListener("dispose",we),H.__depthDisposeCallback=we}H.__boundDepthTexture=pe}if(se.depthTexture&&!H.__autoAllocateDepthBuffer){if(Z)throw new Error("target.depthTexture not supported in Cube render targets");fe(H.__webglFramebuffer,se)}else if(Z){H.__webglDepthbuffer=[];for(let pe=0;pe<6;pe++)if(i.bindFramebuffer(t.FRAMEBUFFER,H.__webglFramebuffer[pe]),H.__webglDepthbuffer[pe]===void 0)H.__webglDepthbuffer[pe]=t.createRenderbuffer(),ue(H.__webglDepthbuffer[pe],se,!1);else{const we=se.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,J=H.__webglDepthbuffer[pe];t.bindRenderbuffer(t.RENDERBUFFER,J),t.framebufferRenderbuffer(t.FRAMEBUFFER,we,t.RENDERBUFFER,J)}}else if(i.bindFramebuffer(t.FRAMEBUFFER,H.__webglFramebuffer),H.__webglDepthbuffer===void 0)H.__webglDepthbuffer=t.createRenderbuffer(),ue(H.__webglDepthbuffer,se,!1);else{const pe=se.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,we=H.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,we),t.framebufferRenderbuffer(t.FRAMEBUFFER,pe,t.RENDERBUFFER,we)}i.bindFramebuffer(t.FRAMEBUFFER,null)}function be(se,H,Z){const pe=r.get(se);H!==void 0&&ne(pe.__webglFramebuffer,se,se.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),Z!==void 0&&xe(se)}function Ce(se){const H=se.texture,Z=r.get(se),pe=r.get(H);se.addEventListener("dispose",L);const we=se.textures,J=se.isWebGLCubeRenderTarget===!0,He=we.length>1;if(He||(pe.__webglTexture===void 0&&(pe.__webglTexture=t.createTexture()),pe.__version=H.version,a.memory.textures++),J){Z.__webglFramebuffer=[];for(let je=0;je<6;je++)if(H.mipmaps&&H.mipmaps.length>0){Z.__webglFramebuffer[je]=[];for(let Ye=0;Ye<H.mipmaps.length;Ye++)Z.__webglFramebuffer[je][Ye]=t.createFramebuffer()}else Z.__webglFramebuffer[je]=t.createFramebuffer()}else{if(H.mipmaps&&H.mipmaps.length>0){Z.__webglFramebuffer=[];for(let je=0;je<H.mipmaps.length;je++)Z.__webglFramebuffer[je]=t.createFramebuffer()}else Z.__webglFramebuffer=t.createFramebuffer();if(He)for(let je=0,Ye=we.length;je<Ye;je++){const Ve=r.get(we[je]);Ve.__webglTexture===void 0&&(Ve.__webglTexture=t.createTexture(),a.memory.textures++)}if(se.samples>0&&Xe(se)===!1){Z.__webglMultisampledFramebuffer=t.createFramebuffer(),Z.__webglColorRenderbuffer=[],i.bindFramebuffer(t.FRAMEBUFFER,Z.__webglMultisampledFramebuffer);for(let je=0;je<we.length;je++){const Ye=we[je];Z.__webglColorRenderbuffer[je]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,Z.__webglColorRenderbuffer[je]);const Ve=s.convert(Ye.format,Ye.colorSpace),Ke=s.convert(Ye.type),at=M(Ye.internalFormat,Ve,Ke,Ye.colorSpace,se.isXRRenderTarget===!0),ut=ze(se);t.renderbufferStorageMultisample(t.RENDERBUFFER,ut,at,se.width,se.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+je,t.RENDERBUFFER,Z.__webglColorRenderbuffer[je])}t.bindRenderbuffer(t.RENDERBUFFER,null),se.depthBuffer&&(Z.__webglDepthRenderbuffer=t.createRenderbuffer(),ue(Z.__webglDepthRenderbuffer,se,!0)),i.bindFramebuffer(t.FRAMEBUFFER,null)}}if(J){i.bindTexture(t.TEXTURE_CUBE_MAP,pe.__webglTexture),ee(t.TEXTURE_CUBE_MAP,H);for(let je=0;je<6;je++)if(H.mipmaps&&H.mipmaps.length>0)for(let Ye=0;Ye<H.mipmaps.length;Ye++)ne(Z.__webglFramebuffer[je][Ye],se,H,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+je,Ye);else ne(Z.__webglFramebuffer[je],se,H,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+je,0);v(H)&&b(t.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(He){for(let je=0,Ye=we.length;je<Ye;je++){const Ve=we[je],Ke=r.get(Ve);i.bindTexture(t.TEXTURE_2D,Ke.__webglTexture),ee(t.TEXTURE_2D,Ve),ne(Z.__webglFramebuffer,se,Ve,t.COLOR_ATTACHMENT0+je,t.TEXTURE_2D,0),v(Ve)&&b(t.TEXTURE_2D)}i.unbindTexture()}else{let je=t.TEXTURE_2D;if((se.isWebGL3DRenderTarget||se.isWebGLArrayRenderTarget)&&(je=se.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),i.bindTexture(je,pe.__webglTexture),ee(je,H),H.mipmaps&&H.mipmaps.length>0)for(let Ye=0;Ye<H.mipmaps.length;Ye++)ne(Z.__webglFramebuffer[Ye],se,H,t.COLOR_ATTACHMENT0,je,Ye);else ne(Z.__webglFramebuffer,se,H,t.COLOR_ATTACHMENT0,je,0);v(H)&&b(je),i.unbindTexture()}se.depthBuffer&&xe(se)}function ge(se){const H=se.textures;for(let Z=0,pe=H.length;Z<pe;Z++){const we=H[Z];if(v(we)){const J=w(se),He=r.get(we).__webglTexture;i.bindTexture(J,He),b(J),i.unbindTexture()}}}const Te=[],ce=[];function Ue(se){if(se.samples>0){if(Xe(se)===!1){const H=se.textures,Z=se.width,pe=se.height;let we=t.COLOR_BUFFER_BIT;const J=se.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,He=r.get(se),je=H.length>1;if(je)for(let Ye=0;Ye<H.length;Ye++)i.bindFramebuffer(t.FRAMEBUFFER,He.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Ye,t.RENDERBUFFER,null),i.bindFramebuffer(t.FRAMEBUFFER,He.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+Ye,t.TEXTURE_2D,null,0);i.bindFramebuffer(t.READ_FRAMEBUFFER,He.__webglMultisampledFramebuffer),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,He.__webglFramebuffer);for(let Ye=0;Ye<H.length;Ye++){if(se.resolveDepthBuffer&&(se.depthBuffer&&(we|=t.DEPTH_BUFFER_BIT),se.stencilBuffer&&se.resolveStencilBuffer&&(we|=t.STENCIL_BUFFER_BIT)),je){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,He.__webglColorRenderbuffer[Ye]);const Ve=r.get(H[Ye]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,Ve,0)}t.blitFramebuffer(0,0,Z,pe,0,0,Z,pe,we,t.NEAREST),l===!0&&(Te.length=0,ce.length=0,Te.push(t.COLOR_ATTACHMENT0+Ye),se.depthBuffer&&se.resolveDepthBuffer===!1&&(Te.push(J),ce.push(J),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,ce)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,Te))}if(i.bindFramebuffer(t.READ_FRAMEBUFFER,null),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),je)for(let Ye=0;Ye<H.length;Ye++){i.bindFramebuffer(t.FRAMEBUFFER,He.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Ye,t.RENDERBUFFER,He.__webglColorRenderbuffer[Ye]);const Ve=r.get(H[Ye]).__webglTexture;i.bindFramebuffer(t.FRAMEBUFFER,He.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+Ye,t.TEXTURE_2D,Ve,0)}i.bindFramebuffer(t.DRAW_FRAMEBUFFER,He.__webglMultisampledFramebuffer)}else if(se.depthBuffer&&se.resolveDepthBuffer===!1&&l){const H=se.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[H])}}}function ze(se){return Math.min(n.maxSamples,se.samples)}function Xe(se){const H=r.get(se);return se.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&H.__useRenderToTexture!==!1}function De(se){const H=a.render.frame;u.get(se)!==H&&(u.set(se,H),se.update())}function Ge(se,H){const Z=se.colorSpace,pe=se.format,we=se.type;return se.isCompressedTexture===!0||se.isVideoTexture===!0||Z!==Ag&&Z!==hp&&(Er.getTransfer(Z)===tn?(pe!==Lo||we!==bh)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Z)),H}function We(se){return typeof HTMLImageElement<"u"&&se instanceof HTMLImageElement?(c.width=se.naturalWidth||se.width,c.height=se.naturalHeight||se.height):typeof VideoFrame<"u"&&se instanceof VideoFrame?(c.width=se.displayWidth,c.height=se.displayHeight):(c.width=se.width,c.height=se.height),c}this.allocateTextureUnit=V,this.resetTextureUnits=F,this.setTexture2D=K,this.setTexture2DArray=X,this.setTexture3D=$,this.setTextureCube=Y,this.rebindTextures=be,this.setupRenderTarget=Ce,this.updateRenderTargetMipmap=ge,this.updateMultisampleRenderTarget=Ue,this.setupDepthRenderbuffer=xe,this.setupFrameBufferTexture=ne,this.useMultisampledRTT=Xe}function JJ(t,e){function i(r,n=hp){let s;const a=Er.getTransfer(n);if(r===bh)return t.UNSIGNED_BYTE;if(r===oP)return t.UNSIGNED_SHORT_4_4_4_4;if(r===lP)return t.UNSIGNED_SHORT_5_5_5_1;if(r===tF)return t.UNSIGNED_INT_5_9_9_9_REV;if(r===$4)return t.BYTE;if(r===eF)return t.SHORT;if(r===W1)return t.UNSIGNED_SHORT;if(r===aP)return t.INT;if(r===Ip)return t.UNSIGNED_INT;if(r===jl)return t.FLOAT;if(r===Mb)return t.HALF_FLOAT;if(r===iF)return t.ALPHA;if(r===rF)return t.RGB;if(r===Lo)return t.RGBA;if(r===nF)return t.LUMINANCE;if(r===sF)return t.LUMINANCE_ALPHA;if(r===A0)return t.DEPTH_COMPONENT;if(r===H0)return t.DEPTH_STENCIL;if(r===cP)return t.RED;if(r===UM)return t.RED_INTEGER;if(r===aF)return t.RG;if(r===uP)return t.RG_INTEGER;if(r===hP)return t.RGBA_INTEGER;if(r===cw||r===uw||r===hw||r===dw)if(a===tn)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(r===cw)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===uw)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===hw)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===dw)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(r===cw)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===uw)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===hw)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===dw)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===UD||r===BD||r===ND||r===FD)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(r===UD)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===BD)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===ND)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===FD)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===kD||r===VD||r===HD)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(r===kD||r===VD)return a===tn?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(r===HD)return a===tn?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===GD||r===jD||r===WD||r===qD||r===XD||r===YD||r===QD||r===ZD||r===KD||r===JD||r===$D||r===e3||r===t3||r===i3)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(r===GD)return a===tn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===jD)return a===tn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===WD)return a===tn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===qD)return a===tn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===XD)return a===tn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===YD)return a===tn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===QD)return a===tn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===ZD)return a===tn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===KD)return a===tn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===JD)return a===tn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===$D)return a===tn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===e3)return a===tn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===t3)return a===tn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===i3)return a===tn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===fw||r===r3||r===n3)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(r===fw)return a===tn?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===r3)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===n3)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===oF||r===s3||r===a3||r===o3)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(r===fw)return s.COMPRESSED_RED_RGTC1_EXT;if(r===s3)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===a3)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===o3)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===V0?t.UNSIGNED_INT_24_8:t[r]!==void 0?t[r]:null}return{convert:i}}const R4e=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,O4e=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class L4e{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,i,r){if(this.texture===null){const n=new ss,s=e.properties.get(n);s.__webglTexture=i.texture,(i.depthNear!==r.depthNear||i.depthFar!==r.depthFar)&&(this.depthNear=i.depthNear,this.depthFar=i.depthFar),this.texture=n}}getMesh(e){if(this.texture!==null&&this.mesh===null){const i=e.cameras[0].viewport,r=new _h({vertexShader:R4e,fragmentShader:O4e,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new is(new kp(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class I4e extends rf{constructor(e,i){super();const r=this;let n=null,s=1,a=null,o="local-floor",l=1,c=null,u=null,h=null,d=null,p=null,g=null;const x=new L4e,v=i.getContextAttributes();let b=null,w=null;const M=[],E=[],D=new Tt;let T=null;const L=new Pa;L.viewport=new Ar;const P=new Pa;P.viewport=new Ar;const R=[L,P],O=new VJ;let U=null,F=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Q){let ae=M[Q];return ae===void 0&&(ae=new hC,M[Q]=ae),ae.getTargetRaySpace()},this.getControllerGrip=function(Q){let ae=M[Q];return ae===void 0&&(ae=new hC,M[Q]=ae),ae.getGripSpace()},this.getHand=function(Q){let ae=M[Q];return ae===void 0&&(ae=new hC,M[Q]=ae),ae.getHandSpace()};function V(Q){const ae=E.indexOf(Q.inputSource);if(ae===-1)return;const ne=M[ae];ne!==void 0&&(ne.update(Q.inputSource,Q.frame,c||a),ne.dispatchEvent({type:Q.type,data:Q.inputSource}))}function k(){n.removeEventListener("select",V),n.removeEventListener("selectstart",V),n.removeEventListener("selectend",V),n.removeEventListener("squeeze",V),n.removeEventListener("squeezestart",V),n.removeEventListener("squeezeend",V),n.removeEventListener("end",k),n.removeEventListener("inputsourceschange",K);for(let Q=0;Q<M.length;Q++){const ae=E[Q];ae!==null&&(E[Q]=null,M[Q].disconnect(ae))}U=null,F=null,x.reset(),e.setRenderTarget(b),p=null,d=null,h=null,n=null,w=null,oe.stop(),r.isPresenting=!1,e.setPixelRatio(T),e.setSize(D.width,D.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Q){s=Q,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Q){o=Q,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||a},this.setReferenceSpace=function(Q){c=Q},this.getBaseLayer=function(){return d!==null?d:p},this.getBinding=function(){return h},this.getFrame=function(){return g},this.getSession=function(){return n},this.setSession=async function(Q){if(n=Q,n!==null){if(b=e.getRenderTarget(),n.addEventListener("select",V),n.addEventListener("selectstart",V),n.addEventListener("selectend",V),n.addEventListener("squeeze",V),n.addEventListener("squeezestart",V),n.addEventListener("squeezeend",V),n.addEventListener("end",k),n.addEventListener("inputsourceschange",K),v.xrCompatible!==!0&&await i.makeXRCompatible(),T=e.getPixelRatio(),e.getSize(D),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let ne=null,ue=null,fe=null;v.depth&&(fe=v.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,ne=v.stencil?H0:A0,ue=v.stencil?V0:Ip);const xe={colorFormat:i.RGBA8,depthFormat:fe,scaleFactor:s};h=new XRWebGLBinding(n,i),d=h.createProjectionLayer(xe),n.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),w=new Yd(d.textureWidth,d.textureHeight,{format:Lo,type:bh,depthTexture:new xF(d.textureWidth,d.textureHeight,ue,void 0,void 0,void 0,void 0,void 0,void 0,ne),stencilBuffer:v.stencil,colorSpace:e.outputColorSpace,samples:v.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1,resolveStencilBuffer:d.ignoreDepthValues===!1})}else{const ne={antialias:v.antialias,alpha:!0,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(n,i,ne),n.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),w=new Yd(p.framebufferWidth,p.framebufferHeight,{format:Lo,type:bh,colorSpace:e.outputColorSpace,stencilBuffer:v.stencil,resolveDepthBuffer:p.ignoreDepthValues===!1,resolveStencilBuffer:p.ignoreDepthValues===!1})}w.isXRRenderTarget=!0,this.setFoveation(l),c=null,a=await n.requestReferenceSpace(o),oe.setContext(n),oe.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(n!==null)return n.environmentBlendMode},this.getDepthTexture=function(){return x.getDepthTexture()};function K(Q){for(let ae=0;ae<Q.removed.length;ae++){const ne=Q.removed[ae],ue=E.indexOf(ne);ue>=0&&(E[ue]=null,M[ue].disconnect(ne))}for(let ae=0;ae<Q.added.length;ae++){const ne=Q.added[ae];let ue=E.indexOf(ne);if(ue===-1){for(let xe=0;xe<M.length;xe++)if(xe>=E.length){E.push(ne),ue=xe;break}else if(E[xe]===null){E[xe]=ne,ue=xe;break}if(ue===-1)break}const fe=M[ue];fe&&fe.connect(ne)}}const X=new Se,$=new Se;function Y(Q,ae,ne){X.setFromMatrixPosition(ae.matrixWorld),$.setFromMatrixPosition(ne.matrixWorld);const ue=X.distanceTo($),fe=ae.projectionMatrix.elements,xe=ne.projectionMatrix.elements,be=fe[14]/(fe[10]-1),Ce=fe[14]/(fe[10]+1),ge=(fe[9]+1)/fe[5],Te=(fe[9]-1)/fe[5],ce=(fe[8]-1)/fe[0],Ue=(xe[8]+1)/xe[0],ze=be*ce,Xe=be*Ue,De=ue/(-ce+Ue),Ge=De*-ce;if(ae.matrixWorld.decompose(Q.position,Q.quaternion,Q.scale),Q.translateX(Ge),Q.translateZ(De),Q.matrixWorld.compose(Q.position,Q.quaternion,Q.scale),Q.matrixWorldInverse.copy(Q.matrixWorld).invert(),fe[10]===-1)Q.projectionMatrix.copy(ae.projectionMatrix),Q.projectionMatrixInverse.copy(ae.projectionMatrixInverse);else{const We=be+De,se=Ce+De,H=ze-Ge,Z=Xe+(ue-Ge),pe=ge*Ce/se*We,we=Te*Ce/se*We;Q.projectionMatrix.makePerspective(H,Z,pe,we,We,se),Q.projectionMatrixInverse.copy(Q.projectionMatrix).invert()}}function re(Q,ae){ae===null?Q.matrixWorld.copy(Q.matrix):Q.matrixWorld.multiplyMatrices(ae.matrixWorld,Q.matrix),Q.matrixWorldInverse.copy(Q.matrixWorld).invert()}this.updateCamera=function(Q){if(n===null)return;let ae=Q.near,ne=Q.far;x.texture!==null&&(x.depthNear>0&&(ae=x.depthNear),x.depthFar>0&&(ne=x.depthFar)),O.near=P.near=L.near=ae,O.far=P.far=L.far=ne,(U!==O.near||F!==O.far)&&(n.updateRenderState({depthNear:O.near,depthFar:O.far}),U=O.near,F=O.far),L.layers.mask=Q.layers.mask|2,P.layers.mask=Q.layers.mask|4,O.layers.mask=L.layers.mask|P.layers.mask;const ue=Q.parent,fe=O.cameras;re(O,ue);for(let xe=0;xe<fe.length;xe++)re(fe[xe],ue);fe.length===2?Y(O,L,P):O.projectionMatrix.copy(L.projectionMatrix),G(Q,O,ue)};function G(Q,ae,ne){ne===null?Q.matrix.copy(ae.matrixWorld):(Q.matrix.copy(ne.matrixWorld),Q.matrix.invert(),Q.matrix.multiply(ae.matrixWorld)),Q.matrix.decompose(Q.position,Q.quaternion,Q.scale),Q.updateMatrixWorld(!0),Q.projectionMatrix.copy(ae.projectionMatrix),Q.projectionMatrixInverse.copy(ae.projectionMatrixInverse),Q.isPerspectiveCamera&&(Q.fov=q1*2*Math.atan(1/Q.projectionMatrix.elements[5]),Q.zoom=1)}this.getCamera=function(){return O},this.getFoveation=function(){if(!(d===null&&p===null))return l},this.setFoveation=function(Q){l=Q,d!==null&&(d.fixedFoveation=Q),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=Q)},this.hasDepthSensing=function(){return x.texture!==null},this.getDepthSensingMesh=function(){return x.getMesh(O)};let j=null;function ee(Q,ae){if(u=ae.getViewerPose(c||a),g=ae,u!==null){const ne=u.views;p!==null&&(e.setRenderTargetFramebuffer(w,p.framebuffer),e.setRenderTarget(w));let ue=!1;ne.length!==O.cameras.length&&(O.cameras.length=0,ue=!0);for(let be=0;be<ne.length;be++){const Ce=ne[be];let ge=null;if(p!==null)ge=p.getViewport(Ce);else{const ce=h.getViewSubImage(d,Ce);ge=ce.viewport,be===0&&(e.setRenderTargetTextures(w,ce.colorTexture,d.ignoreDepthValues?void 0:ce.depthStencilTexture),e.setRenderTarget(w))}let Te=R[be];Te===void 0&&(Te=new Pa,Te.layers.enable(be),Te.viewport=new Ar,R[be]=Te),Te.matrix.fromArray(Ce.transform.matrix),Te.matrix.decompose(Te.position,Te.quaternion,Te.scale),Te.projectionMatrix.fromArray(Ce.projectionMatrix),Te.projectionMatrixInverse.copy(Te.projectionMatrix).invert(),Te.viewport.set(ge.x,ge.y,ge.width,ge.height),be===0&&(O.matrix.copy(Te.matrix),O.matrix.decompose(O.position,O.quaternion,O.scale)),ue===!0&&O.cameras.push(Te)}const fe=n.enabledFeatures;if(fe&&fe.includes("depth-sensing")&&n.depthUsage=="gpu-optimized"&&h){const be=h.getDepthInformation(ne[0]);be&&be.isValid&&be.texture&&x.init(e,be,n.renderState)}}for(let ne=0;ne<M.length;ne++){const ue=E[ne],fe=M[ne];ue!==null&&fe!==void 0&&fe.update(ue,ae,c||a)}j&&j(Q,ae),ae.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:ae}),g=null}const oe=new XJ;oe.setAnimationLoop(ee),this.setAnimationLoop=function(Q){j=Q},this.dispose=function(){}}}const Gv=new Sc,z4e=new Ui;function U4e(t,e){function i(v,b){v.matrixAutoUpdate===!0&&v.updateMatrix(),b.value.copy(v.matrix)}function r(v,b){b.color.getRGB(v.fogColor.value,QK(t)),b.isFog?(v.fogNear.value=b.near,v.fogFar.value=b.far):b.isFogExp2&&(v.fogDensity.value=b.density)}function n(v,b,w,M,E){b.isMeshBasicMaterial||b.isMeshLambertMaterial?s(v,b):b.isMeshToonMaterial?(s(v,b),h(v,b)):b.isMeshPhongMaterial?(s(v,b),u(v,b)):b.isMeshStandardMaterial?(s(v,b),d(v,b),b.isMeshPhysicalMaterial&&p(v,b,E)):b.isMeshMatcapMaterial?(s(v,b),g(v,b)):b.isMeshDepthMaterial?s(v,b):b.isMeshDistanceMaterial?(s(v,b),x(v,b)):b.isMeshNormalMaterial?s(v,b):b.isLineBasicMaterial?(a(v,b),b.isLineDashedMaterial&&o(v,b)):b.isPointsMaterial?l(v,b,w,M):b.isSpriteMaterial?c(v,b):b.isShadowMaterial?(v.color.value.copy(b.color),v.opacity.value=b.opacity):b.isShaderMaterial&&(b.uniformsNeedUpdate=!1)}function s(v,b){v.opacity.value=b.opacity,b.color&&v.diffuse.value.copy(b.color),b.emissive&&v.emissive.value.copy(b.emissive).multiplyScalar(b.emissiveIntensity),b.map&&(v.map.value=b.map,i(b.map,v.mapTransform)),b.alphaMap&&(v.alphaMap.value=b.alphaMap,i(b.alphaMap,v.alphaMapTransform)),b.bumpMap&&(v.bumpMap.value=b.bumpMap,i(b.bumpMap,v.bumpMapTransform),v.bumpScale.value=b.bumpScale,b.side===ll&&(v.bumpScale.value*=-1)),b.normalMap&&(v.normalMap.value=b.normalMap,i(b.normalMap,v.normalMapTransform),v.normalScale.value.copy(b.normalScale),b.side===ll&&v.normalScale.value.negate()),b.displacementMap&&(v.displacementMap.value=b.displacementMap,i(b.displacementMap,v.displacementMapTransform),v.displacementScale.value=b.displacementScale,v.displacementBias.value=b.displacementBias),b.emissiveMap&&(v.emissiveMap.value=b.emissiveMap,i(b.emissiveMap,v.emissiveMapTransform)),b.specularMap&&(v.specularMap.value=b.specularMap,i(b.specularMap,v.specularMapTransform)),b.alphaTest>0&&(v.alphaTest.value=b.alphaTest);const w=e.get(b),M=w.envMap,E=w.envMapRotation;M&&(v.envMap.value=M,Gv.copy(E),Gv.x*=-1,Gv.y*=-1,Gv.z*=-1,M.isCubeTexture&&M.isRenderTargetTexture===!1&&(Gv.y*=-1,Gv.z*=-1),v.envMapRotation.value.setFromMatrix4(z4e.makeRotationFromEuler(Gv)),v.flipEnvMap.value=M.isCubeTexture&&M.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=b.reflectivity,v.ior.value=b.ior,v.refractionRatio.value=b.refractionRatio),b.lightMap&&(v.lightMap.value=b.lightMap,v.lightMapIntensity.value=b.lightMapIntensity,i(b.lightMap,v.lightMapTransform)),b.aoMap&&(v.aoMap.value=b.aoMap,v.aoMapIntensity.value=b.aoMapIntensity,i(b.aoMap,v.aoMapTransform))}function a(v,b){v.diffuse.value.copy(b.color),v.opacity.value=b.opacity,b.map&&(v.map.value=b.map,i(b.map,v.mapTransform))}function o(v,b){v.dashSize.value=b.dashSize,v.totalSize.value=b.dashSize+b.gapSize,v.scale.value=b.scale}function l(v,b,w,M){v.diffuse.value.copy(b.color),v.opacity.value=b.opacity,v.size.value=b.size*w,v.scale.value=M*.5,b.map&&(v.map.value=b.map,i(b.map,v.uvTransform)),b.alphaMap&&(v.alphaMap.value=b.alphaMap,i(b.alphaMap,v.alphaMapTransform)),b.alphaTest>0&&(v.alphaTest.value=b.alphaTest)}function c(v,b){v.diffuse.value.copy(b.color),v.opacity.value=b.opacity,v.rotation.value=b.rotation,b.map&&(v.map.value=b.map,i(b.map,v.mapTransform)),b.alphaMap&&(v.alphaMap.value=b.alphaMap,i(b.alphaMap,v.alphaMapTransform)),b.alphaTest>0&&(v.alphaTest.value=b.alphaTest)}function u(v,b){v.specular.value.copy(b.specular),v.shininess.value=Math.max(b.shininess,1e-4)}function h(v,b){b.gradientMap&&(v.gradientMap.value=b.gradientMap)}function d(v,b){v.metalness.value=b.metalness,b.metalnessMap&&(v.metalnessMap.value=b.metalnessMap,i(b.metalnessMap,v.metalnessMapTransform)),v.roughness.value=b.roughness,b.roughnessMap&&(v.roughnessMap.value=b.roughnessMap,i(b.roughnessMap,v.roughnessMapTransform)),b.envMap&&(v.envMapIntensity.value=b.envMapIntensity)}function p(v,b,w){v.ior.value=b.ior,b.sheen>0&&(v.sheenColor.value.copy(b.sheenColor).multiplyScalar(b.sheen),v.sheenRoughness.value=b.sheenRoughness,b.sheenColorMap&&(v.sheenColorMap.value=b.sheenColorMap,i(b.sheenColorMap,v.sheenColorMapTransform)),b.sheenRoughnessMap&&(v.sheenRoughnessMap.value=b.sheenRoughnessMap,i(b.sheenRoughnessMap,v.sheenRoughnessMapTransform))),b.clearcoat>0&&(v.clearcoat.value=b.clearcoat,v.clearcoatRoughness.value=b.clearcoatRoughness,b.clearcoatMap&&(v.clearcoatMap.value=b.clearcoatMap,i(b.clearcoatMap,v.clearcoatMapTransform)),b.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=b.clearcoatRoughnessMap,i(b.clearcoatRoughnessMap,v.clearcoatRoughnessMapTransform)),b.clearcoatNormalMap&&(v.clearcoatNormalMap.value=b.clearcoatNormalMap,i(b.clearcoatNormalMap,v.clearcoatNormalMapTransform),v.clearcoatNormalScale.value.copy(b.clearcoatNormalScale),b.side===ll&&v.clearcoatNormalScale.value.negate())),b.dispersion>0&&(v.dispersion.value=b.dispersion),b.iridescence>0&&(v.iridescence.value=b.iridescence,v.iridescenceIOR.value=b.iridescenceIOR,v.iridescenceThicknessMinimum.value=b.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=b.iridescenceThicknessRange[1],b.iridescenceMap&&(v.iridescenceMap.value=b.iridescenceMap,i(b.iridescenceMap,v.iridescenceMapTransform)),b.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=b.iridescenceThicknessMap,i(b.iridescenceThicknessMap,v.iridescenceThicknessMapTransform))),b.transmission>0&&(v.transmission.value=b.transmission,v.transmissionSamplerMap.value=w.texture,v.transmissionSamplerSize.value.set(w.width,w.height),b.transmissionMap&&(v.transmissionMap.value=b.transmissionMap,i(b.transmissionMap,v.transmissionMapTransform)),v.thickness.value=b.thickness,b.thicknessMap&&(v.thicknessMap.value=b.thicknessMap,i(b.thicknessMap,v.thicknessMapTransform)),v.attenuationDistance.value=b.attenuationDistance,v.attenuationColor.value.copy(b.attenuationColor)),b.anisotropy>0&&(v.anisotropyVector.value.set(b.anisotropy*Math.cos(b.anisotropyRotation),b.anisotropy*Math.sin(b.anisotropyRotation)),b.anisotropyMap&&(v.anisotropyMap.value=b.anisotropyMap,i(b.anisotropyMap,v.anisotropyMapTransform))),v.specularIntensity.value=b.specularIntensity,v.specularColor.value.copy(b.specularColor),b.specularColorMap&&(v.specularColorMap.value=b.specularColorMap,i(b.specularColorMap,v.specularColorMapTransform)),b.specularIntensityMap&&(v.specularIntensityMap.value=b.specularIntensityMap,i(b.specularIntensityMap,v.specularIntensityMapTransform))}function g(v,b){b.matcap&&(v.matcap.value=b.matcap)}function x(v,b){const w=e.get(b).light;v.referencePosition.value.setFromMatrixPosition(w.matrixWorld),v.nearDistance.value=w.shadow.camera.near,v.farDistance.value=w.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:n}}function B4e(t,e,i,r){let n={},s={},a=[];const o=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function l(w,M){const E=M.program;r.uniformBlockBinding(w,E)}function c(w,M){let E=n[w.id];E===void 0&&(g(w),E=u(w),n[w.id]=E,w.addEventListener("dispose",v));const D=M.program;r.updateUBOMapping(w,D);const T=e.render.frame;s[w.id]!==T&&(d(w),s[w.id]=T)}function u(w){const M=h();w.__bindingPointIndex=M;const E=t.createBuffer(),D=w.__size,T=w.usage;return t.bindBuffer(t.UNIFORM_BUFFER,E),t.bufferData(t.UNIFORM_BUFFER,D,T),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,M,E),E}function h(){for(let w=0;w<o;w++)if(a.indexOf(w)===-1)return a.push(w),w;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(w){const M=n[w.id],E=w.uniforms,D=w.__cache;t.bindBuffer(t.UNIFORM_BUFFER,M);for(let T=0,L=E.length;T<L;T++){const P=Array.isArray(E[T])?E[T]:[E[T]];for(let R=0,O=P.length;R<O;R++){const U=P[R];if(p(U,T,R,D)===!0){const F=U.__offset,V=Array.isArray(U.value)?U.value:[U.value];let k=0;for(let K=0;K<V.length;K++){const X=V[K],$=x(X);typeof X=="number"||typeof X=="boolean"?(U.__data[0]=X,t.bufferSubData(t.UNIFORM_BUFFER,F+k,U.__data)):X.isMatrix3?(U.__data[0]=X.elements[0],U.__data[1]=X.elements[1],U.__data[2]=X.elements[2],U.__data[3]=0,U.__data[4]=X.elements[3],U.__data[5]=X.elements[4],U.__data[6]=X.elements[5],U.__data[7]=0,U.__data[8]=X.elements[6],U.__data[9]=X.elements[7],U.__data[10]=X.elements[8],U.__data[11]=0):(X.toArray(U.__data,k),k+=$.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,F,U.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}function p(w,M,E,D){const T=w.value,L=M+"_"+E;if(D[L]===void 0)return typeof T=="number"||typeof T=="boolean"?D[L]=T:D[L]=T.clone(),!0;{const P=D[L];if(typeof T=="number"||typeof T=="boolean"){if(P!==T)return D[L]=T,!0}else if(P.equals(T)===!1)return P.copy(T),!0}return!1}function g(w){const M=w.uniforms;let E=0;const D=16;for(let L=0,P=M.length;L<P;L++){const R=Array.isArray(M[L])?M[L]:[M[L]];for(let O=0,U=R.length;O<U;O++){const F=R[O],V=Array.isArray(F.value)?F.value:[F.value];for(let k=0,K=V.length;k<K;k++){const X=V[k],$=x(X),Y=E%D,re=Y%$.boundary,G=Y+re;E+=re,G!==0&&D-G<$.storage&&(E+=D-G),F.__data=new Float32Array($.storage/Float32Array.BYTES_PER_ELEMENT),F.__offset=E,E+=$.storage}}}const T=E%D;return T>0&&(E+=D-T),w.__size=E,w.__cache={},this}function x(w){const M={boundary:0,storage:0};return typeof w=="number"||typeof w=="boolean"?(M.boundary=4,M.storage=4):w.isVector2?(M.boundary=8,M.storage=8):w.isVector3||w.isColor?(M.boundary=16,M.storage=12):w.isVector4?(M.boundary=16,M.storage=16):w.isMatrix3?(M.boundary=48,M.storage=48):w.isMatrix4?(M.boundary=64,M.storage=64):w.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",w),M}function v(w){const M=w.target;M.removeEventListener("dispose",v);const E=a.indexOf(M.__bindingPointIndex);a.splice(E,1),t.deleteBuffer(n[M.id]),delete n[M.id],delete s[M.id]}function b(){for(const w in n)t.deleteBuffer(n[w]);a=[],n={},s={}}return{bind:l,update:c,dispose:b}}class $J{constructor(e={}){const{canvas:i=qK(),context:r=null,depth:n=!0,stencil:s=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1,reverseDepthBuffer:d=!1}=e;this.isWebGLRenderer=!0;let p;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");p=r.getContextAttributes().alpha}else p=a;const g=new Uint32Array(4),x=new Int32Array(4);let v=null,b=null;const w=[],M=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Co,this.toneMapping=Fd,this.toneMappingExposure=1;const E=this;let D=!1,T=0,L=0,P=null,R=-1,O=null;const U=new Ar,F=new Ar;let V=null;const k=new Zt(0);let K=0,X=i.width,$=i.height,Y=1,re=null,G=null;const j=new Ar(0,0,X,$),ee=new Ar(0,0,X,$);let oe=!1;const Q=new FM;let ae=!1,ne=!1;this.transmissionResolutionScale=1;const ue=new Ui,fe=new Ui,xe=new Se,be=new Ar,Ce={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let ge=!1;function Te(){return P===null?Y:1}let ce=r;function Ue(de,ke){return i.getContext(de,ke)}try{const de={alpha:!0,depth:n,stencil:s,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${rP}`),i.addEventListener("webglcontextlost",Qe,!1),i.addEventListener("webglcontextrestored",ot,!1),i.addEventListener("webglcontextcreationerror",pt,!1),ce===null){const ke="webgl2";if(ce=Ue(ke,de),ce===null)throw Ue(ke)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(de){throw console.error("THREE.WebGLRenderer: "+de.message),de}let ze,Xe,De,Ge,We,se,H,Z,pe,we,J,He,je,Ye,Ve,Ke,at,ut,ht,$e,St,Pt,Kt,le;function Re(){ze=new QBe(ce),ze.init(),Pt=new JJ(ce,ze),Xe=new HBe(ce,ze,e,Pt),De=new D4e(ce,ze),Xe.reverseDepthBuffer&&d&&De.buffers.depth.setReversed(!0),Ge=new JBe(ce),We=new g4e,se=new P4e(ce,ze,De,We,Xe,Pt,Ge),H=new jBe(E),Z=new YBe(E),pe=new nze(ce),Kt=new kBe(ce,pe),we=new ZBe(ce,pe,Ge,Kt),J=new eNe(ce,we,pe,Ge),ht=new $Be(ce,Xe,se),Ke=new GBe(We),He=new m4e(E,H,Z,ze,Xe,Kt,Ke),je=new U4e(E,We),Ye=new y4e,Ve=new M4e(ze),ut=new FBe(E,H,Z,De,J,p,l),at=new T4e(E,J,Xe),le=new B4e(ce,Ge,Xe,De),$e=new VBe(ce,ze,Ge),St=new KBe(ce,ze,Ge),Ge.programs=He.programs,E.capabilities=Xe,E.extensions=ze,E.properties=We,E.renderLists=Ye,E.shadowMap=at,E.state=De,E.info=Ge}Re();const Ee=new I4e(E,ce);this.xr=Ee,this.getContext=function(){return ce},this.getContextAttributes=function(){return ce.getContextAttributes()},this.forceContextLoss=function(){const de=ze.get("WEBGL_lose_context");de&&de.loseContext()},this.forceContextRestore=function(){const de=ze.get("WEBGL_lose_context");de&&de.restoreContext()},this.getPixelRatio=function(){return Y},this.setPixelRatio=function(de){de!==void 0&&(Y=de,this.setSize(X,$,!1))},this.getSize=function(de){return de.set(X,$)},this.setSize=function(de,ke,rt=!0){if(Ee.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}X=de,$=ke,i.width=Math.floor(de*Y),i.height=Math.floor(ke*Y),rt===!0&&(i.style.width=de+"px",i.style.height=ke+"px"),this.setViewport(0,0,de,ke)},this.getDrawingBufferSize=function(de){return de.set(X*Y,$*Y).floor()},this.setDrawingBufferSize=function(de,ke,rt){X=de,$=ke,Y=rt,i.width=Math.floor(de*rt),i.height=Math.floor(ke*rt),this.setViewport(0,0,de,ke)},this.getCurrentViewport=function(de){return de.copy(U)},this.getViewport=function(de){return de.copy(j)},this.setViewport=function(de,ke,rt,Ie){de.isVector4?j.set(de.x,de.y,de.z,de.w):j.set(de,ke,rt,Ie),De.viewport(U.copy(j).multiplyScalar(Y).round())},this.getScissor=function(de){return de.copy(ee)},this.setScissor=function(de,ke,rt,Ie){de.isVector4?ee.set(de.x,de.y,de.z,de.w):ee.set(de,ke,rt,Ie),De.scissor(F.copy(ee).multiplyScalar(Y).round())},this.getScissorTest=function(){return oe},this.setScissorTest=function(de){De.setScissorTest(oe=de)},this.setOpaqueSort=function(de){re=de},this.setTransparentSort=function(de){G=de},this.getClearColor=function(de){return de.copy(ut.getClearColor())},this.setClearColor=function(){ut.setClearColor(...arguments)},this.getClearAlpha=function(){return ut.getClearAlpha()},this.setClearAlpha=function(){ut.setClearAlpha(...arguments)},this.clear=function(de=!0,ke=!0,rt=!0){let Ie=0;if(de){let Fe=!1;if(P!==null){const Dt=P.texture.format;Fe=Dt===hP||Dt===uP||Dt===UM}if(Fe){const Dt=P.texture.type,xt=Dt===bh||Dt===Ip||Dt===W1||Dt===V0||Dt===oP||Dt===lP,Nt=ut.getClearColor(),kt=ut.getClearAlpha(),li=Nt.r,ii=Nt.g,te=Nt.b;xt?(g[0]=li,g[1]=ii,g[2]=te,g[3]=kt,ce.clearBufferuiv(ce.COLOR,0,g)):(x[0]=li,x[1]=ii,x[2]=te,x[3]=kt,ce.clearBufferiv(ce.COLOR,0,x))}else Ie|=ce.COLOR_BUFFER_BIT}ke&&(Ie|=ce.DEPTH_BUFFER_BIT),rt&&(Ie|=ce.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ce.clear(Ie)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",Qe,!1),i.removeEventListener("webglcontextrestored",ot,!1),i.removeEventListener("webglcontextcreationerror",pt,!1),ut.dispose(),Ye.dispose(),Ve.dispose(),We.dispose(),H.dispose(),Z.dispose(),J.dispose(),Kt.dispose(),le.dispose(),He.dispose(),Ee.dispose(),Ee.removeEventListener("sessionstart",Tr),Ee.removeEventListener("sessionend",Dn),pn.stop()};function Qe(de){de.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),D=!0}function ot(){console.log("THREE.WebGLRenderer: Context Restored."),D=!1;const de=Ge.autoReset,ke=at.enabled,rt=at.autoUpdate,Ie=at.needsUpdate,Fe=at.type;Re(),Ge.autoReset=de,at.enabled=ke,at.autoUpdate=rt,at.needsUpdate=Ie,at.type=Fe}function pt(de){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",de.statusMessage)}function Bt(de){const ke=de.target;ke.removeEventListener("dispose",Bt),Jt(ke)}function Jt(de){qt(de),We.remove(de)}function qt(de){const ke=We.get(de).programs;ke!==void 0&&(ke.forEach(function(rt){He.releaseProgram(rt)}),de.isShaderMaterial&&He.releaseShaderCache(de))}this.renderBufferDirect=function(de,ke,rt,Ie,Fe,Dt){ke===null&&(ke=Ce);const xt=Fe.isMesh&&Fe.matrixWorld.determinant()<0,Nt=gi(de,ke,rt,Ie,Fe);De.setMaterial(Ie,xt);let kt=rt.index,li=1;if(Ie.wireframe===!0){if(kt=we.getWireframeAttribute(rt),kt===void 0)return;li=2}const ii=rt.drawRange,te=rt.attributes.position;let he=ii.start*li,Ae=(ii.start+ii.count)*li;Dt!==null&&(he=Math.max(he,Dt.start*li),Ae=Math.min(Ae,(Dt.start+Dt.count)*li)),kt!==null?(he=Math.max(he,0),Ae=Math.min(Ae,kt.count)):te!=null&&(he=Math.max(he,0),Ae=Math.min(Ae,te.count));const me=Ae-he;if(me<0||me===1/0)return;Kt.setup(Fe,Ie,Nt,rt,kt);let Ne,mt=$e;if(kt!==null&&(Ne=pe.get(kt),mt=St,mt.setIndex(Ne)),Fe.isMesh)Ie.wireframe===!0?(De.setLineWidth(Ie.wireframeLinewidth*Te()),mt.setMode(ce.LINES)):mt.setMode(ce.TRIANGLES);else if(Fe.isLine){let ei=Ie.linewidth;ei===void 0&&(ei=1),De.setLineWidth(ei*Te()),Fe.isLineSegments?mt.setMode(ce.LINES):Fe.isLineLoop?mt.setMode(ce.LINE_LOOP):mt.setMode(ce.LINE_STRIP)}else Fe.isPoints?mt.setMode(ce.POINTS):Fe.isSprite&&mt.setMode(ce.TRIANGLES);if(Fe.isBatchedMesh)if(Fe._multiDrawInstances!==null)Zv("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),mt.renderMultiDrawInstances(Fe._multiDrawStarts,Fe._multiDrawCounts,Fe._multiDrawCount,Fe._multiDrawInstances);else if(ze.get("WEBGL_multi_draw"))mt.renderMultiDraw(Fe._multiDrawStarts,Fe._multiDrawCounts,Fe._multiDrawCount);else{const ei=Fe._multiDrawStarts,jr=Fe._multiDrawCounts,Li=Fe._multiDrawCount,Pn=kt?pe.get(kt).bytesPerElement:1,Un=We.get(Ie).currentProgram.getUniforms();for(let _n=0;_n<Li;_n++)Un.setValue(ce,"_gl_DrawID",_n),mt.render(ei[_n]/Pn,jr[_n])}else if(Fe.isInstancedMesh)mt.renderInstances(he,me,Fe.count);else if(rt.isInstancedBufferGeometry){const ei=rt._maxInstanceCount!==void 0?rt._maxInstanceCount:1/0,jr=Math.min(rt.instanceCount,ei);mt.renderInstances(he,me,jr)}else mt.render(he,me)};function Ft(de,ke,rt){de.transparent===!0&&de.side===ch&&de.forceSinglePass===!1?(de.side=ll,de.needsUpdate=!0,it(de,ke,rt),de.side=Op,de.needsUpdate=!0,it(de,ke,rt),de.side=ch):it(de,ke,rt)}this.compile=function(de,ke,rt=null){rt===null&&(rt=de),b=Ve.get(rt),b.init(ke),M.push(b),rt.traverseVisible(function(Fe){Fe.isLight&&Fe.layers.test(ke.layers)&&(b.pushLight(Fe),Fe.castShadow&&b.pushShadow(Fe))}),de!==rt&&de.traverseVisible(function(Fe){Fe.isLight&&Fe.layers.test(ke.layers)&&(b.pushLight(Fe),Fe.castShadow&&b.pushShadow(Fe))}),b.setupLights();const Ie=new Set;return de.traverse(function(Fe){if(!(Fe.isMesh||Fe.isPoints||Fe.isLine||Fe.isSprite))return;const Dt=Fe.material;if(Dt)if(Array.isArray(Dt))for(let xt=0;xt<Dt.length;xt++){const Nt=Dt[xt];Ft(Nt,rt,Fe),Ie.add(Nt)}else Ft(Dt,rt,Fe),Ie.add(Dt)}),b=M.pop(),Ie},this.compileAsync=function(de,ke,rt=null){const Ie=this.compile(de,ke,rt);return new Promise(Fe=>{function Dt(){if(Ie.forEach(function(xt){We.get(xt).currentProgram.isReady()&&Ie.delete(xt)}),Ie.size===0){Fe(de);return}setTimeout(Dt,10)}ze.get("KHR_parallel_shader_compile")!==null?Dt():setTimeout(Dt,10)})};let Ni=null;function Oi(de){Ni&&Ni(de)}function Tr(){pn.stop()}function Dn(){pn.start()}const pn=new XJ;pn.setAnimationLoop(Oi),typeof self<"u"&&pn.setContext(self),this.setAnimationLoop=function(de){Ni=de,Ee.setAnimationLoop(de),de===null?pn.stop():pn.start()},Ee.addEventListener("sessionstart",Tr),Ee.addEventListener("sessionend",Dn),this.render=function(de,ke){if(ke!==void 0&&ke.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(D===!0)return;if(de.matrixWorldAutoUpdate===!0&&de.updateMatrixWorld(),ke.parent===null&&ke.matrixWorldAutoUpdate===!0&&ke.updateMatrixWorld(),Ee.enabled===!0&&Ee.isPresenting===!0&&(Ee.cameraAutoUpdate===!0&&Ee.updateCamera(ke),ke=Ee.getCamera()),de.isScene===!0&&de.onBeforeRender(E,de,ke,P),b=Ve.get(de,M.length),b.init(ke),M.push(b),fe.multiplyMatrices(ke.projectionMatrix,ke.matrixWorldInverse),Q.setFromProjectionMatrix(fe),ne=this.localClippingEnabled,ae=Ke.init(this.clippingPlanes,ne),v=Ye.get(de,w.length),v.init(),w.push(v),Ee.enabled===!0&&Ee.isPresenting===!0){const Dt=E.xr.getDepthSensingMesh();Dt!==null&&Fr(Dt,ke,-1/0,E.sortObjects)}Fr(de,ke,0,E.sortObjects),v.finish(),E.sortObjects===!0&&v.sort(re,G),ge=Ee.enabled===!1||Ee.isPresenting===!1||Ee.hasDepthSensing()===!1,ge&&ut.addToRenderList(v,de),this.info.render.frame++,ae===!0&&Ke.beginShadows();const rt=b.state.shadowsArray;at.render(rt,de,ke),ae===!0&&Ke.endShadows(),this.info.autoReset===!0&&this.info.reset();const Ie=v.opaque,Fe=v.transmissive;if(b.setupLights(),ke.isArrayCamera){const Dt=ke.cameras;if(Fe.length>0)for(let xt=0,Nt=Dt.length;xt<Nt;xt++){const kt=Dt[xt];tt(Ie,Fe,de,kt)}ge&&ut.render(de);for(let xt=0,Nt=Dt.length;xt<Nt;xt++){const kt=Dt[xt];_e(v,de,kt,kt.viewport)}}else Fe.length>0&&tt(Ie,Fe,de,ke),ge&&ut.render(de),_e(v,de,ke);P!==null&&L===0&&(se.updateMultisampleRenderTarget(P),se.updateRenderTargetMipmap(P)),de.isScene===!0&&de.onAfterRender(E,de,ke),Kt.resetDefaultState(),R=-1,O=null,M.pop(),M.length>0?(b=M[M.length-1],ae===!0&&Ke.setGlobalState(E.clippingPlanes,b.state.camera)):b=null,w.pop(),w.length>0?v=w[w.length-1]:v=null};function Fr(de,ke,rt,Ie){if(de.visible===!1)return;if(de.layers.test(ke.layers)){if(de.isGroup)rt=de.renderOrder;else if(de.isLOD)de.autoUpdate===!0&&de.update(ke);else if(de.isLight)b.pushLight(de),de.castShadow&&b.pushShadow(de);else if(de.isSprite){if(!de.frustumCulled||Q.intersectsSprite(de)){Ie&&be.setFromMatrixPosition(de.matrixWorld).applyMatrix4(fe);const xt=J.update(de),Nt=de.material;Nt.visible&&v.push(de,xt,Nt,rt,be.z,null)}}else if((de.isMesh||de.isLine||de.isPoints)&&(!de.frustumCulled||Q.intersectsObject(de))){const xt=J.update(de),Nt=de.material;if(Ie&&(de.boundingSphere!==void 0?(de.boundingSphere===null&&de.computeBoundingSphere(),be.copy(de.boundingSphere.center)):(xt.boundingSphere===null&&xt.computeBoundingSphere(),be.copy(xt.boundingSphere.center)),be.applyMatrix4(de.matrixWorld).applyMatrix4(fe)),Array.isArray(Nt)){const kt=xt.groups;for(let li=0,ii=kt.length;li<ii;li++){const te=kt[li],he=Nt[te.materialIndex];he&&he.visible&&v.push(de,xt,he,rt,be.z,te)}}else Nt.visible&&v.push(de,xt,Nt,rt,be.z,null)}}const Dt=de.children;for(let xt=0,Nt=Dt.length;xt<Nt;xt++)Fr(Dt[xt],ke,rt,Ie)}function _e(de,ke,rt,Ie){const Fe=de.opaque,Dt=de.transmissive,xt=de.transparent;b.setupLightsView(rt),ae===!0&&Ke.setGlobalState(E.clippingPlanes,rt),Ie&&De.viewport(U.copy(Ie)),Fe.length>0&&ct(Fe,ke,rt),Dt.length>0&&ct(Dt,ke,rt),xt.length>0&&ct(xt,ke,rt),De.buffers.depth.setTest(!0),De.buffers.depth.setMask(!0),De.buffers.color.setMask(!0),De.setPolygonOffset(!1)}function tt(de,ke,rt,Ie){if((rt.isScene===!0?rt.overrideMaterial:null)!==null)return;b.state.transmissionRenderTarget[Ie.id]===void 0&&(b.state.transmissionRenderTarget[Ie.id]=new Yd(1,1,{generateMipmaps:!0,type:ze.has("EXT_color_buffer_half_float")||ze.has("EXT_color_buffer_float")?Mb:bh,minFilter:Id,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Er.workingColorSpace}));const Dt=b.state.transmissionRenderTarget[Ie.id],xt=Ie.viewport||U;Dt.setSize(xt.z*E.transmissionResolutionScale,xt.w*E.transmissionResolutionScale);const Nt=E.getRenderTarget();E.setRenderTarget(Dt),E.getClearColor(k),K=E.getClearAlpha(),K<1&&E.setClearColor(16777215,.5),E.clear(),ge&&ut.render(rt);const kt=E.toneMapping;E.toneMapping=Fd;const li=Ie.viewport;if(Ie.viewport!==void 0&&(Ie.viewport=void 0),b.setupLightsView(Ie),ae===!0&&Ke.setGlobalState(E.clippingPlanes,Ie),ct(de,rt,Ie),se.updateMultisampleRenderTarget(Dt),se.updateRenderTargetMipmap(Dt),ze.has("WEBGL_multisampled_render_to_texture")===!1){let ii=!1;for(let te=0,he=ke.length;te<he;te++){const Ae=ke[te],me=Ae.object,Ne=Ae.geometry,mt=Ae.material,ei=Ae.group;if(mt.side===ch&&me.layers.test(Ie.layers)){const jr=mt.side;mt.side=ll,mt.needsUpdate=!0,qe(me,rt,Ie,Ne,mt,ei),mt.side=jr,mt.needsUpdate=!0,ii=!0}}ii===!0&&(se.updateMultisampleRenderTarget(Dt),se.updateRenderTargetMipmap(Dt))}E.setRenderTarget(Nt),E.setClearColor(k,K),li!==void 0&&(Ie.viewport=li),E.toneMapping=kt}function ct(de,ke,rt){const Ie=ke.isScene===!0?ke.overrideMaterial:null;for(let Fe=0,Dt=de.length;Fe<Dt;Fe++){const xt=de[Fe],Nt=xt.object,kt=xt.geometry,li=Ie===null?xt.material:Ie,ii=xt.group;Nt.layers.test(rt.layers)&&qe(Nt,ke,rt,kt,li,ii)}}function qe(de,ke,rt,Ie,Fe,Dt){de.onBeforeRender(E,ke,rt,Ie,Fe,Dt),de.modelViewMatrix.multiplyMatrices(rt.matrixWorldInverse,de.matrixWorld),de.normalMatrix.getNormalMatrix(de.modelViewMatrix),Fe.onBeforeRender(E,ke,rt,Ie,de,Dt),Fe.transparent===!0&&Fe.side===ch&&Fe.forceSinglePass===!1?(Fe.side=ll,Fe.needsUpdate=!0,E.renderBufferDirect(rt,ke,Ie,Fe,de,Dt),Fe.side=Op,Fe.needsUpdate=!0,E.renderBufferDirect(rt,ke,Ie,Fe,de,Dt),Fe.side=ch):E.renderBufferDirect(rt,ke,Ie,Fe,de,Dt),de.onAfterRender(E,ke,rt,Ie,Fe,Dt)}function it(de,ke,rt){ke.isScene!==!0&&(ke=Ce);const Ie=We.get(de),Fe=b.state.lights,Dt=b.state.shadowsArray,xt=Fe.state.version,Nt=He.getParameters(de,Fe.state,Dt,ke,rt),kt=He.getProgramCacheKey(Nt);let li=Ie.programs;Ie.environment=de.isMeshStandardMaterial?ke.environment:null,Ie.fog=ke.fog,Ie.envMap=(de.isMeshStandardMaterial?Z:H).get(de.envMap||Ie.environment),Ie.envMapRotation=Ie.environment!==null&&de.envMap===null?ke.environmentRotation:de.envMapRotation,li===void 0&&(de.addEventListener("dispose",Bt),li=new Map,Ie.programs=li);let ii=li.get(kt);if(ii!==void 0){if(Ie.currentProgram===ii&&Ie.lightsStateVersion===xt)return oi(de,Nt),ii}else Nt.uniforms=He.getUniforms(de),de.onBeforeCompile(Nt,E),ii=He.acquireProgram(Nt,kt),li.set(kt,ii),Ie.uniforms=Nt.uniforms;const te=Ie.uniforms;return(!de.isShaderMaterial&&!de.isRawShaderMaterial||de.clipping===!0)&&(te.clippingPlanes=Ke.uniform),oi(de,Nt),Ie.needsLights=Wi(de),Ie.lightsStateVersion=xt,Ie.needsLights&&(te.ambientLightColor.value=Fe.state.ambient,te.lightProbe.value=Fe.state.probe,te.directionalLights.value=Fe.state.directional,te.directionalLightShadows.value=Fe.state.directionalShadow,te.spotLights.value=Fe.state.spot,te.spotLightShadows.value=Fe.state.spotShadow,te.rectAreaLights.value=Fe.state.rectArea,te.ltc_1.value=Fe.state.rectAreaLTC1,te.ltc_2.value=Fe.state.rectAreaLTC2,te.pointLights.value=Fe.state.point,te.pointLightShadows.value=Fe.state.pointShadow,te.hemisphereLights.value=Fe.state.hemi,te.directionalShadowMap.value=Fe.state.directionalShadowMap,te.directionalShadowMatrix.value=Fe.state.directionalShadowMatrix,te.spotShadowMap.value=Fe.state.spotShadowMap,te.spotLightMatrix.value=Fe.state.spotLightMatrix,te.spotLightMap.value=Fe.state.spotLightMap,te.pointShadowMap.value=Fe.state.pointShadowMap,te.pointShadowMatrix.value=Fe.state.pointShadowMatrix),Ie.currentProgram=ii,Ie.uniformsList=null,ii}function Gt(de){if(de.uniformsList===null){const ke=de.currentProgram.getUniforms();de.uniformsList=dC.seqWithValue(ke.seq,de.uniforms)}return de.uniformsList}function oi(de,ke){const rt=We.get(de);rt.outputColorSpace=ke.outputColorSpace,rt.batching=ke.batching,rt.batchingColor=ke.batchingColor,rt.instancing=ke.instancing,rt.instancingColor=ke.instancingColor,rt.instancingMorph=ke.instancingMorph,rt.skinning=ke.skinning,rt.morphTargets=ke.morphTargets,rt.morphNormals=ke.morphNormals,rt.morphColors=ke.morphColors,rt.morphTargetsCount=ke.morphTargetsCount,rt.numClippingPlanes=ke.numClippingPlanes,rt.numIntersection=ke.numClipIntersection,rt.vertexAlphas=ke.vertexAlphas,rt.vertexTangents=ke.vertexTangents,rt.toneMapping=ke.toneMapping}function gi(de,ke,rt,Ie,Fe){ke.isScene!==!0&&(ke=Ce),se.resetTextureUnits();const Dt=ke.fog,xt=Ie.isMeshStandardMaterial?ke.environment:null,Nt=P===null?E.outputColorSpace:P.isXRRenderTarget===!0?P.texture.colorSpace:Ag,kt=(Ie.isMeshStandardMaterial?Z:H).get(Ie.envMap||xt),li=Ie.vertexColors===!0&&!!rt.attributes.color&&rt.attributes.color.itemSize===4,ii=!!rt.attributes.tangent&&(!!Ie.normalMap||Ie.anisotropy>0),te=!!rt.morphAttributes.position,he=!!rt.morphAttributes.normal,Ae=!!rt.morphAttributes.color;let me=Fd;Ie.toneMapped&&(P===null||P.isXRRenderTarget===!0)&&(me=E.toneMapping);const Ne=rt.morphAttributes.position||rt.morphAttributes.normal||rt.morphAttributes.color,mt=Ne!==void 0?Ne.length:0,ei=We.get(Ie),jr=b.state.lights;if(ae===!0&&(ne===!0||de!==O)){const mn=de===O&&Ie.id===R;Ke.setState(Ie,de,mn)}let Li=!1;Ie.version===ei.__version?(ei.needsLights&&ei.lightsStateVersion!==jr.state.version||ei.outputColorSpace!==Nt||Fe.isBatchedMesh&&ei.batching===!1||!Fe.isBatchedMesh&&ei.batching===!0||Fe.isBatchedMesh&&ei.batchingColor===!0&&Fe.colorTexture===null||Fe.isBatchedMesh&&ei.batchingColor===!1&&Fe.colorTexture!==null||Fe.isInstancedMesh&&ei.instancing===!1||!Fe.isInstancedMesh&&ei.instancing===!0||Fe.isSkinnedMesh&&ei.skinning===!1||!Fe.isSkinnedMesh&&ei.skinning===!0||Fe.isInstancedMesh&&ei.instancingColor===!0&&Fe.instanceColor===null||Fe.isInstancedMesh&&ei.instancingColor===!1&&Fe.instanceColor!==null||Fe.isInstancedMesh&&ei.instancingMorph===!0&&Fe.morphTexture===null||Fe.isInstancedMesh&&ei.instancingMorph===!1&&Fe.morphTexture!==null||ei.envMap!==kt||Ie.fog===!0&&ei.fog!==Dt||ei.numClippingPlanes!==void 0&&(ei.numClippingPlanes!==Ke.numPlanes||ei.numIntersection!==Ke.numIntersection)||ei.vertexAlphas!==li||ei.vertexTangents!==ii||ei.morphTargets!==te||ei.morphNormals!==he||ei.morphColors!==Ae||ei.toneMapping!==me||ei.morphTargetsCount!==mt)&&(Li=!0):(Li=!0,ei.__version=Ie.version);let Pn=ei.currentProgram;Li===!0&&(Pn=it(Ie,ke,Fe));let Un=!1,_n=!1,zr=!1;const Or=Pn.getUniforms(),Vn=ei.uniforms;if(De.useProgram(Pn.program)&&(Un=!0,_n=!0,zr=!0),Ie.id!==R&&(R=Ie.id,_n=!0),Un||O!==de){De.buffers.depth.getReversed()?(ue.copy(de.projectionMatrix),AOe(ue),TOe(ue),Or.setValue(ce,"projectionMatrix",ue)):Or.setValue(ce,"projectionMatrix",de.projectionMatrix),Or.setValue(ce,"viewMatrix",de.matrixWorldInverse);const On=Or.map.cameraPosition;On!==void 0&&On.setValue(ce,xe.setFromMatrixPosition(de.matrixWorld)),Xe.logarithmicDepthBuffer&&Or.setValue(ce,"logDepthBufFC",2/(Math.log(de.far+1)/Math.LN2)),(Ie.isMeshPhongMaterial||Ie.isMeshToonMaterial||Ie.isMeshLambertMaterial||Ie.isMeshBasicMaterial||Ie.isMeshStandardMaterial||Ie.isShaderMaterial)&&Or.setValue(ce,"isOrthographic",de.isOrthographicCamera===!0),O!==de&&(O=de,_n=!0,zr=!0)}if(Fe.isSkinnedMesh){Or.setOptional(ce,Fe,"bindMatrix"),Or.setOptional(ce,Fe,"bindMatrixInverse");const mn=Fe.skeleton;mn&&(mn.boneTexture===null&&mn.computeBoneTexture(),Or.setValue(ce,"boneTexture",mn.boneTexture,se))}Fe.isBatchedMesh&&(Or.setOptional(ce,Fe,"batchingTexture"),Or.setValue(ce,"batchingTexture",Fe._matricesTexture,se),Or.setOptional(ce,Fe,"batchingIdTexture"),Or.setValue(ce,"batchingIdTexture",Fe._indirectTexture,se),Or.setOptional(ce,Fe,"batchingColorTexture"),Fe._colorsTexture!==null&&Or.setValue(ce,"batchingColorTexture",Fe._colorsTexture,se));const Rn=rt.morphAttributes;if((Rn.position!==void 0||Rn.normal!==void 0||Rn.color!==void 0)&&ht.update(Fe,rt,Pn),(_n||ei.receiveShadow!==Fe.receiveShadow)&&(ei.receiveShadow=Fe.receiveShadow,Or.setValue(ce,"receiveShadow",Fe.receiveShadow)),Ie.isMeshGouraudMaterial&&Ie.envMap!==null&&(Vn.envMap.value=kt,Vn.flipEnvMap.value=kt.isCubeTexture&&kt.isRenderTargetTexture===!1?-1:1),Ie.isMeshStandardMaterial&&Ie.envMap===null&&ke.environment!==null&&(Vn.envMapIntensity.value=ke.environmentIntensity),_n&&(Or.setValue(ce,"toneMappingExposure",E.toneMappingExposure),ei.needsLights&&ri(Vn,zr),Dt&&Ie.fog===!0&&je.refreshFogUniforms(Vn,Dt),je.refreshMaterialUniforms(Vn,Ie,Y,$,b.state.transmissionRenderTarget[de.id]),dC.upload(ce,Gt(ei),Vn,se)),Ie.isShaderMaterial&&Ie.uniformsNeedUpdate===!0&&(dC.upload(ce,Gt(ei),Vn,se),Ie.uniformsNeedUpdate=!1),Ie.isSpriteMaterial&&Or.setValue(ce,"center",Fe.center),Or.setValue(ce,"modelViewMatrix",Fe.modelViewMatrix),Or.setValue(ce,"normalMatrix",Fe.normalMatrix),Or.setValue(ce,"modelMatrix",Fe.matrixWorld),Ie.isShaderMaterial||Ie.isRawShaderMaterial){const mn=Ie.uniformsGroups;for(let On=0,ha=mn.length;On<ha;On++){const _s=mn[On];le.update(_s,Pn),le.bind(_s,Pn)}}return Pn}function ri(de,ke){de.ambientLightColor.needsUpdate=ke,de.lightProbe.needsUpdate=ke,de.directionalLights.needsUpdate=ke,de.directionalLightShadows.needsUpdate=ke,de.pointLights.needsUpdate=ke,de.pointLightShadows.needsUpdate=ke,de.spotLights.needsUpdate=ke,de.spotLightShadows.needsUpdate=ke,de.rectAreaLights.needsUpdate=ke,de.hemisphereLights.needsUpdate=ke}function Wi(de){return de.isMeshLambertMaterial||de.isMeshToonMaterial||de.isMeshPhongMaterial||de.isMeshStandardMaterial||de.isShadowMaterial||de.isShaderMaterial&&de.lights===!0}this.getActiveCubeFace=function(){return T},this.getActiveMipmapLevel=function(){return L},this.getRenderTarget=function(){return P},this.setRenderTargetTextures=function(de,ke,rt){We.get(de.texture).__webglTexture=ke,We.get(de.depthTexture).__webglTexture=rt;const Ie=We.get(de);Ie.__hasExternalTextures=!0,Ie.__autoAllocateDepthBuffer=rt===void 0,Ie.__autoAllocateDepthBuffer||ze.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ie.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(de,ke){const rt=We.get(de);rt.__webglFramebuffer=ke,rt.__useDefaultFramebuffer=ke===void 0};const mi=ce.createFramebuffer();this.setRenderTarget=function(de,ke=0,rt=0){P=de,T=ke,L=rt;let Ie=!0,Fe=null,Dt=!1,xt=!1;if(de){const kt=We.get(de);if(kt.__useDefaultFramebuffer!==void 0)De.bindFramebuffer(ce.FRAMEBUFFER,null),Ie=!1;else if(kt.__webglFramebuffer===void 0)se.setupRenderTarget(de);else if(kt.__hasExternalTextures)se.rebindTextures(de,We.get(de.texture).__webglTexture,We.get(de.depthTexture).__webglTexture);else if(de.depthBuffer){const te=de.depthTexture;if(kt.__boundDepthTexture!==te){if(te!==null&&We.has(te)&&(de.width!==te.image.width||de.height!==te.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");se.setupDepthRenderbuffer(de)}}const li=de.texture;(li.isData3DTexture||li.isDataArrayTexture||li.isCompressedArrayTexture)&&(xt=!0);const ii=We.get(de).__webglFramebuffer;de.isWebGLCubeRenderTarget?(Array.isArray(ii[ke])?Fe=ii[ke][rt]:Fe=ii[ke],Dt=!0):de.samples>0&&se.useMultisampledRTT(de)===!1?Fe=We.get(de).__webglMultisampledFramebuffer:Array.isArray(ii)?Fe=ii[rt]:Fe=ii,U.copy(de.viewport),F.copy(de.scissor),V=de.scissorTest}else U.copy(j).multiplyScalar(Y).floor(),F.copy(ee).multiplyScalar(Y).floor(),V=oe;if(rt!==0&&(Fe=mi),De.bindFramebuffer(ce.FRAMEBUFFER,Fe)&&Ie&&De.drawBuffers(de,Fe),De.viewport(U),De.scissor(F),De.setScissorTest(V),Dt){const kt=We.get(de.texture);ce.framebufferTexture2D(ce.FRAMEBUFFER,ce.COLOR_ATTACHMENT0,ce.TEXTURE_CUBE_MAP_POSITIVE_X+ke,kt.__webglTexture,rt)}else if(xt){const kt=We.get(de.texture),li=ke;ce.framebufferTextureLayer(ce.FRAMEBUFFER,ce.COLOR_ATTACHMENT0,kt.__webglTexture,rt,li)}else if(de!==null&&rt!==0){const kt=We.get(de.texture);ce.framebufferTexture2D(ce.FRAMEBUFFER,ce.COLOR_ATTACHMENT0,ce.TEXTURE_2D,kt.__webglTexture,rt)}R=-1},this.readRenderTargetPixels=function(de,ke,rt,Ie,Fe,Dt,xt){if(!(de&&de.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Nt=We.get(de).__webglFramebuffer;if(de.isWebGLCubeRenderTarget&&xt!==void 0&&(Nt=Nt[xt]),Nt){De.bindFramebuffer(ce.FRAMEBUFFER,Nt);try{const kt=de.texture,li=kt.format,ii=kt.type;if(!Xe.textureFormatReadable(li)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Xe.textureTypeReadable(ii)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ke>=0&&ke<=de.width-Ie&&rt>=0&&rt<=de.height-Fe&&ce.readPixels(ke,rt,Ie,Fe,Pt.convert(li),Pt.convert(ii),Dt)}finally{const kt=P!==null?We.get(P).__webglFramebuffer:null;De.bindFramebuffer(ce.FRAMEBUFFER,kt)}}},this.readRenderTargetPixelsAsync=async function(de,ke,rt,Ie,Fe,Dt,xt){if(!(de&&de.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Nt=We.get(de).__webglFramebuffer;if(de.isWebGLCubeRenderTarget&&xt!==void 0&&(Nt=Nt[xt]),Nt){const kt=de.texture,li=kt.format,ii=kt.type;if(!Xe.textureFormatReadable(li))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Xe.textureTypeReadable(ii))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(ke>=0&&ke<=de.width-Ie&&rt>=0&&rt<=de.height-Fe){De.bindFramebuffer(ce.FRAMEBUFFER,Nt);const te=ce.createBuffer();ce.bindBuffer(ce.PIXEL_PACK_BUFFER,te),ce.bufferData(ce.PIXEL_PACK_BUFFER,Dt.byteLength,ce.STREAM_READ),ce.readPixels(ke,rt,Ie,Fe,Pt.convert(li),Pt.convert(ii),0);const he=P!==null?We.get(P).__webglFramebuffer:null;De.bindFramebuffer(ce.FRAMEBUFFER,he);const Ae=ce.fenceSync(ce.SYNC_GPU_COMMANDS_COMPLETE,0);return ce.flush(),await EOe(ce,Ae,4),ce.bindBuffer(ce.PIXEL_PACK_BUFFER,te),ce.getBufferSubData(ce.PIXEL_PACK_BUFFER,0,Dt),ce.deleteBuffer(te),ce.deleteSync(Ae),Dt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(de,ke=null,rt=0){de.isTexture!==!0&&(Zv("WebGLRenderer: copyFramebufferToTexture function signature has changed."),ke=arguments[0]||null,de=arguments[1]);const Ie=Math.pow(2,-rt),Fe=Math.floor(de.image.width*Ie),Dt=Math.floor(de.image.height*Ie),xt=ke!==null?ke.x:0,Nt=ke!==null?ke.y:0;se.setTexture2D(de,0),ce.copyTexSubImage2D(ce.TEXTURE_2D,rt,0,0,xt,Nt,Fe,Dt),De.unbindTexture()};const Mi=ce.createFramebuffer(),hi=ce.createFramebuffer();this.copyTextureToTexture=function(de,ke,rt=null,Ie=null,Fe=0,Dt=null){de.isTexture!==!0&&(Zv("WebGLRenderer: copyTextureToTexture function signature has changed."),Ie=arguments[0]||null,de=arguments[1],ke=arguments[2],Dt=arguments[3]||0,rt=null),Dt===null&&(Fe!==0?(Zv("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),Dt=Fe,Fe=0):Dt=0);let xt,Nt,kt,li,ii,te,he,Ae,me;const Ne=de.isCompressedTexture?de.mipmaps[Dt]:de.image;if(rt!==null)xt=rt.max.x-rt.min.x,Nt=rt.max.y-rt.min.y,kt=rt.isBox3?rt.max.z-rt.min.z:1,li=rt.min.x,ii=rt.min.y,te=rt.isBox3?rt.min.z:0;else{const Rn=Math.pow(2,-Fe);xt=Math.floor(Ne.width*Rn),Nt=Math.floor(Ne.height*Rn),de.isDataArrayTexture?kt=Ne.depth:de.isData3DTexture?kt=Math.floor(Ne.depth*Rn):kt=1,li=0,ii=0,te=0}Ie!==null?(he=Ie.x,Ae=Ie.y,me=Ie.z):(he=0,Ae=0,me=0);const mt=Pt.convert(ke.format),ei=Pt.convert(ke.type);let jr;ke.isData3DTexture?(se.setTexture3D(ke,0),jr=ce.TEXTURE_3D):ke.isDataArrayTexture||ke.isCompressedArrayTexture?(se.setTexture2DArray(ke,0),jr=ce.TEXTURE_2D_ARRAY):(se.setTexture2D(ke,0),jr=ce.TEXTURE_2D),ce.pixelStorei(ce.UNPACK_FLIP_Y_WEBGL,ke.flipY),ce.pixelStorei(ce.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ke.premultiplyAlpha),ce.pixelStorei(ce.UNPACK_ALIGNMENT,ke.unpackAlignment);const Li=ce.getParameter(ce.UNPACK_ROW_LENGTH),Pn=ce.getParameter(ce.UNPACK_IMAGE_HEIGHT),Un=ce.getParameter(ce.UNPACK_SKIP_PIXELS),_n=ce.getParameter(ce.UNPACK_SKIP_ROWS),zr=ce.getParameter(ce.UNPACK_SKIP_IMAGES);ce.pixelStorei(ce.UNPACK_ROW_LENGTH,Ne.width),ce.pixelStorei(ce.UNPACK_IMAGE_HEIGHT,Ne.height),ce.pixelStorei(ce.UNPACK_SKIP_PIXELS,li),ce.pixelStorei(ce.UNPACK_SKIP_ROWS,ii),ce.pixelStorei(ce.UNPACK_SKIP_IMAGES,te);const Or=de.isDataArrayTexture||de.isData3DTexture,Vn=ke.isDataArrayTexture||ke.isData3DTexture;if(de.isDepthTexture){const Rn=We.get(de),mn=We.get(ke),On=We.get(Rn.__renderTarget),ha=We.get(mn.__renderTarget);De.bindFramebuffer(ce.READ_FRAMEBUFFER,On.__webglFramebuffer),De.bindFramebuffer(ce.DRAW_FRAMEBUFFER,ha.__webglFramebuffer);for(let _s=0;_s<kt;_s++)Or&&(ce.framebufferTextureLayer(ce.READ_FRAMEBUFFER,ce.COLOR_ATTACHMENT0,We.get(de).__webglTexture,Fe,te+_s),ce.framebufferTextureLayer(ce.DRAW_FRAMEBUFFER,ce.COLOR_ATTACHMENT0,We.get(ke).__webglTexture,Dt,me+_s)),ce.blitFramebuffer(li,ii,xt,Nt,he,Ae,xt,Nt,ce.DEPTH_BUFFER_BIT,ce.NEAREST);De.bindFramebuffer(ce.READ_FRAMEBUFFER,null),De.bindFramebuffer(ce.DRAW_FRAMEBUFFER,null)}else if(Fe!==0||de.isRenderTargetTexture||We.has(de)){const Rn=We.get(de),mn=We.get(ke);De.bindFramebuffer(ce.READ_FRAMEBUFFER,Mi),De.bindFramebuffer(ce.DRAW_FRAMEBUFFER,hi);for(let On=0;On<kt;On++)Or?ce.framebufferTextureLayer(ce.READ_FRAMEBUFFER,ce.COLOR_ATTACHMENT0,Rn.__webglTexture,Fe,te+On):ce.framebufferTexture2D(ce.READ_FRAMEBUFFER,ce.COLOR_ATTACHMENT0,ce.TEXTURE_2D,Rn.__webglTexture,Fe),Vn?ce.framebufferTextureLayer(ce.DRAW_FRAMEBUFFER,ce.COLOR_ATTACHMENT0,mn.__webglTexture,Dt,me+On):ce.framebufferTexture2D(ce.DRAW_FRAMEBUFFER,ce.COLOR_ATTACHMENT0,ce.TEXTURE_2D,mn.__webglTexture,Dt),Fe!==0?ce.blitFramebuffer(li,ii,xt,Nt,he,Ae,xt,Nt,ce.COLOR_BUFFER_BIT,ce.NEAREST):Vn?ce.copyTexSubImage3D(jr,Dt,he,Ae,me+On,li,ii,xt,Nt):ce.copyTexSubImage2D(jr,Dt,he,Ae,li,ii,xt,Nt);De.bindFramebuffer(ce.READ_FRAMEBUFFER,null),De.bindFramebuffer(ce.DRAW_FRAMEBUFFER,null)}else Vn?de.isDataTexture||de.isData3DTexture?ce.texSubImage3D(jr,Dt,he,Ae,me,xt,Nt,kt,mt,ei,Ne.data):ke.isCompressedArrayTexture?ce.compressedTexSubImage3D(jr,Dt,he,Ae,me,xt,Nt,kt,mt,Ne.data):ce.texSubImage3D(jr,Dt,he,Ae,me,xt,Nt,kt,mt,ei,Ne):de.isDataTexture?ce.texSubImage2D(ce.TEXTURE_2D,Dt,he,Ae,xt,Nt,mt,ei,Ne.data):de.isCompressedTexture?ce.compressedTexSubImage2D(ce.TEXTURE_2D,Dt,he,Ae,Ne.width,Ne.height,mt,Ne.data):ce.texSubImage2D(ce.TEXTURE_2D,Dt,he,Ae,xt,Nt,mt,ei,Ne);ce.pixelStorei(ce.UNPACK_ROW_LENGTH,Li),ce.pixelStorei(ce.UNPACK_IMAGE_HEIGHT,Pn),ce.pixelStorei(ce.UNPACK_SKIP_PIXELS,Un),ce.pixelStorei(ce.UNPACK_SKIP_ROWS,_n),ce.pixelStorei(ce.UNPACK_SKIP_IMAGES,zr),Dt===0&&ke.generateMipmaps&&ce.generateMipmap(jr),De.unbindTexture()},this.copyTextureToTexture3D=function(de,ke,rt=null,Ie=null,Fe=0){return de.isTexture!==!0&&(Zv("WebGLRenderer: copyTextureToTexture3D function signature has changed."),rt=arguments[0]||null,Ie=arguments[1]||null,de=arguments[2],ke=arguments[3],Fe=arguments[4]||0),Zv('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(de,ke,rt,Ie,Fe)},this.initRenderTarget=function(de){We.get(de).__webglFramebuffer===void 0&&se.setupRenderTarget(de)},this.initTexture=function(de){de.isCubeTexture?se.setTextureCube(de,0):de.isData3DTexture?se.setTexture3D(de,0):de.isDataArrayTexture||de.isCompressedArrayTexture?se.setTexture2DArray(de,0):se.setTexture2D(de,0),De.unbindTexture()},this.resetState=function(){T=0,L=0,P=null,De.reset(),Kt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return fh}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const i=this.getContext();i.drawingBufferColorspace=Er._getDrawingBufferColorSpace(e),i.unpackColorSpace=Er._getUnpackColorSpace()}}const N4e=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:K4,AddEquation:tg,AddOperation:EK,AdditiveAnimationBlendMode:lF,AdditiveBlending:AB,AgXToneMapping:PK,AlphaFormat:iF,AlwaysCompare:jK,AlwaysDepth:PD,AlwaysStencilFunc:PB,AmbientLight:UJ,AnimationAction:jJ,AnimationClip:lM,AnimationLoader:KLe,AnimationMixer:AIe,AnimationObjectGroup:MIe,AnimationUtils:XLe,ArcCurve:oJ,ArrayCamera:VJ,ArrowHelper:QIe,AttachedBindMode:DB,Audio:HJ,AudioAnalyser:pIe,AudioContext:LF,AudioListener:hIe,AudioLoader:lIe,AxesHelper:ZIe,BackSide:ll,BasicDepthPacking:UK,BasicShadowMap:sK,BatchedMesh:rJ,Bone:vF,BooleanKeyframeTrack:ty,Box2:zIe,Box3:ao,Box3Helper:XIe,BoxGeometry:ey,BoxHelper:qIe,BufferAttribute:fn,BufferGeometry:sr,BufferGeometryLoader:kJ,ByteType:$4,Cache:xp,Camera:mP,CameraHelper:WIe,CanvasTexture:vLe,CapsuleGeometry:SP,CatmullRomCurve3:lJ,CineonToneMapping:CK,CircleGeometry:wP,ClampToEdgeWrapping:tu,Clock:IF,Color:Zt,ColorKeyframeTrack:DF,ColorManagement:Er,CompressedArrayTexture:mLe,CompressedCubeTexture:gLe,CompressedTexture:bP,CompressedTextureLoader:JLe,ConeGeometry:MP,ConstantAlphaFactor:SK,ConstantColorFactor:bK,Controls:JIe,CubeCamera:ZK,CubeReflectionMapping:Lp,CubeRefractionMapping:Eg,CubeTexture:NM,CubeTextureLoader:$Le,CubeUVReflectionMapping:wb,CubicBezierCurve:_F,CubicBezierCurve3:cJ,CubicInterpolant:CJ,CullFaceBack:EB,CullFaceFront:nK,CullFaceFrontBack:ARe,CullFaceNone:rK,Curve:Eh,CurvePath:hJ,CustomBlending:aK,CustomToneMapping:DK,CylinderGeometry:Ab,Cylindrical:IIe,Data3DTexture:pP,DataArrayTexture:BM,DataTexture:kd,DataTextureLoader:eIe,DataUtils:HOe,DecrementStencilOp:kRe,DecrementWrapStencilOp:HRe,DefaultLoadingManager:RJ,DepthFormat:A0,DepthStencilFormat:H0,DepthTexture:xF,DetachedBindMode:OK,DirectionalLight:zJ,DirectionalLightHelper:jIe,DiscreteInterpolant:DJ,DodecahedronGeometry:EP,DoubleSide:ch,DstAlphaFactor:mK,DstColorFactor:vK,DynamicCopyUsage:rOe,DynamicDrawUsage:KRe,DynamicReadUsage:eOe,EdgesGeometry:dJ,EllipseCurve:_P,EqualCompare:kK,EqualDepth:OD,EqualStencilFunc:qRe,EquirectangularReflectionMapping:qw,EquirectangularRefractionMapping:Xw,Euler:Sc,EventDispatcher:rf,ExtrudeGeometry:TP,FileLoader:zp,Float16BufferAttribute:QOe,Float32BufferAttribute:di,FloatType:jl,Fog:vP,FogExp2:gP,FramebufferTexture:pLe,FrontSide:Op,Frustum:FM,GLBufferAttribute:OIe,GLSL1:sOe,GLSL3:RB,GreaterCompare:VK,GreaterDepth:ID,GreaterEqualCompare:GK,GreaterEqualDepth:LD,GreaterEqualStencilFunc:ZRe,GreaterStencilFunc:YRe,GridHelper:HIe,Group:l1,HalfFloatType:Mb,HemisphereLight:OJ,HemisphereLightHelper:VIe,IcosahedronGeometry:CP,ImageBitmapLoader:oIe,ImageLoader:cM,ImageUtils:XK,IncrementStencilOp:FRe,IncrementWrapStencilOp:VRe,InstancedBufferAttribute:j0,InstancedBufferGeometry:OF,InstancedInterleavedBuffer:RIe,InstancedMesh:iJ,Int16BufferAttribute:XOe,Int32BufferAttribute:YOe,Int8BufferAttribute:jOe,IntType:aP,InterleavedBuffer:yP,InterleavedBufferAttribute:G0,Interpolant:GM,InterpolateDiscrete:Zw,InterpolateLinear:l3,InterpolateSmooth:uC,InvertStencilOp:GRe,KeepStencilOp:Qv,KeyframeTrack:Ah,LOD:eJ,LatheGeometry:kM,Layers:X1,LessCompare:FK,LessDepth:RD,LessEqualCompare:uF,LessEqualDepth:k0,LessEqualStencilFunc:XRe,LessStencilFunc:WRe,Light:zg,LightProbe:FJ,Line:Tg,Line3:UIe,LineBasicMaterial:fl,LineCurve:SF,LineCurve3:uJ,LineDashedMaterial:EJ,LineLoop:nJ,LineSegments:nf,LinearFilter:Cs,LinearInterpolant:CF,LinearMipMapLinearFilter:PRe,LinearMipMapNearestFilter:DRe,LinearMipmapLinearFilter:Id,LinearMipmapNearestFilter:lw,LinearSRGBColorSpace:Ag,LinearToneMapping:AK,LinearTransfer:Jw,Loader:Ql,LoaderUtils:UB,LoadingManager:PF,LoopOnce:LK,LoopPingPong:zK,LoopRepeat:IK,LuminanceAlphaFormat:sF,LuminanceFormat:nF,MOUSE:cC,Material:Bo,MaterialLoader:BP,MathUtils:wOe,Matrix2:NF,Matrix3:Yi,Matrix4:Ui,MaxEquation:uK,Mesh:is,MeshBasicMaterial:Fp,MeshDepthMaterial:zP,MeshDistanceMaterial:UP,MeshLambertMaterial:wJ,MeshMatcapMaterial:MJ,MeshNormalMaterial:SJ,MeshPhongMaterial:bJ,MeshPhysicalMaterial:xJ,MeshStandardMaterial:AF,MeshToonMaterial:_J,MinEquation:cK,MirroredRepeatWrapping:Qw,MixOperation:MK,MultiplyBlending:CB,MultiplyOperation:zM,NearestFilter:no,NearestMipMapLinearFilter:CRe,NearestMipMapNearestFilter:TRe,NearestMipmapLinearFilter:a1,NearestMipmapNearestFilter:J4,NeutralToneMapping:RK,NeverCompare:NK,NeverDepth:DD,NeverStencilFunc:jRe,NoBlending:wp,NoColorSpace:hp,NoToneMapping:Fd,NormalAnimationBlendMode:dP,NormalBlending:E0,NotEqualCompare:HK,NotEqualDepth:zD,NotEqualStencilFunc:QRe,NumberKeyframeTrack:aM,Object3D:Ir,ObjectLoader:sIe,ObjectSpaceNormalMap:BK,OctahedronGeometry:VM,OneFactor:dK,OneMinusConstantAlphaFactor:wK,OneMinusConstantColorFactor:_K,OneMinusDstAlphaFactor:gK,OneMinusDstColorFactor:yK,OneMinusSrcAlphaFactor:CD,OneMinusSrcColorFactor:pK,OrthographicCamera:WM,PCFShadowMap:nP,PCFSoftShadowMap:ow,PMREMGenerator:FB,Path:iM,PerspectiveCamera:Pa,Plane:Ym,PlaneGeometry:kp,PlaneHelper:YIe,PointLight:IJ,PointLightHelper:FIe,Points:sJ,PointsMaterial:yF,PolarGridHelper:GIe,PolyhedronGeometry:Ig,PositionalAudio:fIe,PropertyBinding:Lr,PropertyMixer:GJ,QuadraticBezierCurve:wF,QuadraticBezierCurve3:MF,Quaternion:so,QuaternionKeyframeTrack:jM,QuaternionLinearInterpolant:PJ,RED_GREEN_RGTC2_Format:a3,RED_RGTC1_Format:oF,REVISION:rP,RGBADepthPacking:cF,RGBAFormat:Lo,RGBAIntegerFormat:hP,RGBA_ASTC_10x10_Format:e3,RGBA_ASTC_10x5_Format:KD,RGBA_ASTC_10x6_Format:JD,RGBA_ASTC_10x8_Format:$D,RGBA_ASTC_12x10_Format:t3,RGBA_ASTC_12x12_Format:i3,RGBA_ASTC_4x4_Format:GD,RGBA_ASTC_5x4_Format:jD,RGBA_ASTC_5x5_Format:WD,RGBA_ASTC_6x5_Format:qD,RGBA_ASTC_6x6_Format:XD,RGBA_ASTC_8x5_Format:YD,RGBA_ASTC_8x6_Format:QD,RGBA_ASTC_8x8_Format:ZD,RGBA_BPTC_Format:fw,RGBA_ETC2_EAC_Format:HD,RGBA_PVRTC_2BPPV1_Format:FD,RGBA_PVRTC_4BPPV1_Format:ND,RGBA_S3TC_DXT1_Format:uw,RGBA_S3TC_DXT3_Format:hw,RGBA_S3TC_DXT5_Format:dw,RGBDepthPacking:zRe,RGBFormat:rF,RGBIntegerFormat:RRe,RGB_BPTC_SIGNED_Format:r3,RGB_BPTC_UNSIGNED_Format:n3,RGB_ETC1_Format:kD,RGB_ETC2_Format:VD,RGB_PVRTC_2BPPV1_Format:BD,RGB_PVRTC_4BPPV1_Format:UD,RGB_S3TC_DXT1_Format:cw,RGDepthPacking:URe,RGFormat:aF,RGIntegerFormat:uP,RawShaderMaterial:yJ,Ray:Eb,Raycaster:WJ,RectAreaLight:BJ,RedFormat:cP,RedIntegerFormat:UM,ReinhardToneMapping:TK,RenderTarget:fP,RenderTarget3D:TIe,RenderTargetArray:CIe,RepeatWrapping:Yw,ReplaceStencilOp:NRe,ReverseSubtractEquation:lK,RingGeometry:DP,SIGNED_RED_GREEN_RGTC2_Format:o3,SIGNED_RED_RGTC1_Format:s3,SRGBColorSpace:Co,SRGBTransfer:tn,Scene:mF,ShaderChunk:Ji,ShaderLib:ah,ShaderMaterial:_h,ShadowMaterial:vJ,Shape:C0,ShapeGeometry:PP,ShapePath:KIe,ShapeUtils:Vd,ShortType:eF,Skeleton:xP,SkeletonHelper:NIe,SkinnedMesh:tJ,Source:fg,Sphere:oo,SphereGeometry:HM,Spherical:LIe,SphericalHarmonics3:NJ,SplineCurve:EF,SpotLight:LJ,SpotLightHelper:BIe,Sprite:$K,SpriteMaterial:gF,SrcAlphaFactor:TD,SrcAlphaSaturateFactor:xK,SrcColorFactor:fK,StaticCopyUsage:iOe,StaticDrawUsage:$w,StaticReadUsage:$Re,StereoCamera:cIe,StreamCopyUsage:nOe,StreamDrawUsage:JRe,StreamReadUsage:tOe,StringKeyframeTrack:iy,SubtractEquation:oK,SubtractiveBlending:TB,TOUCH:ERe,TangentSpaceNormalMap:Lg,TetrahedronGeometry:RP,Texture:ss,TextureLoader:tIe,TextureUtils:rze,TimestampQuery:aOe,TorusGeometry:OP,TorusKnotGeometry:LP,Triangle:Vl,TriangleFanDrawMode:IRe,TriangleStripDrawMode:LRe,TrianglesDrawMode:ORe,TubeGeometry:IP,UVMapping:sP,Uint16BufferAttribute:dF,Uint32BufferAttribute:fF,Uint8BufferAttribute:WOe,Uint8ClampedBufferAttribute:qOe,Uniform:BF,UniformsGroup:PIe,UniformsLib:Yt,UniformsUtils:pF,UnsignedByteType:bh,UnsignedInt248Type:V0,UnsignedInt5999Type:tF,UnsignedIntType:Ip,UnsignedShort4444Type:oP,UnsignedShort5551Type:lP,UnsignedShortType:W1,VSMShadowMap:sh,Vector2:Tt,Vector3:Se,Vector4:Ar,VectorKeyframeTrack:oM,VideoFrameTexture:fLe,VideoTexture:aJ,WebGL3DRenderTarget:OOe,WebGLArrayRenderTarget:ROe,WebGLCoordinateSystem:fh,WebGLCubeRenderTarget:KK,WebGLRenderTarget:Yd,WebGLRenderer:$J,WebGLUtils:JJ,WebGPUCoordinateSystem:eM,WebXRController:hC,WireframeGeometry:gJ,WrapAroundEnding:Kw,ZeroCurvatureEnding:p0,ZeroFactor:hK,ZeroSlopeEnding:m0,ZeroStencilOp:BRe,createCanvasElement:qK},Symbol.toStringTag,{value:"Module"}));var UI={exports:{}},$f={};/**
 * @license React
 * react-reconciler-constants.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var e9;function F4e(){return e9||(e9=1,$f.ConcurrentRoot=1,$f.ContinuousEventPriority=8,$f.DefaultEventPriority=32,$f.DiscreteEventPriority=2,$f.IdleEventPriority=268435456,$f.LegacyRoot=0,$f.NoEventPriority=0),$f}var t9;function k4e(){return t9||(t9=1,UI.exports=F4e()),UI.exports}var fC=k4e(),BI={exports:{}},NI={},FI={exports:{}},kI={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i9;function V4e(){if(i9)return kI;i9=1;var t=$1();function e(h,d){return h===d&&(h!==0||1/h===1/d)||h!==h&&d!==d}var i=typeof Object.is=="function"?Object.is:e,r=t.useState,n=t.useEffect,s=t.useLayoutEffect,a=t.useDebugValue;function o(h,d){var p=d(),g=r({inst:{value:p,getSnapshot:d}}),x=g[0].inst,v=g[1];return s(function(){x.value=p,x.getSnapshot=d,l(x)&&v({inst:x})},[h,p,d]),n(function(){return l(x)&&v({inst:x}),h(function(){l(x)&&v({inst:x})})},[h]),a(p),p}function l(h){var d=h.getSnapshot;h=h.value;try{var p=d();return!i(h,p)}catch{return!0}}function c(h,d){return d()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:o;return kI.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:u,kI}var r9;function H4e(){return r9||(r9=1,FI.exports=V4e()),FI.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n9;function G4e(){if(n9)return NI;n9=1;var t=$1(),e=H4e();function i(c,u){return c===u&&(c!==0||1/c===1/u)||c!==c&&u!==u}var r=typeof Object.is=="function"?Object.is:i,n=e.useSyncExternalStore,s=t.useRef,a=t.useEffect,o=t.useMemo,l=t.useDebugValue;return NI.useSyncExternalStoreWithSelector=function(c,u,h,d,p){var g=s(null);if(g.current===null){var x={hasValue:!1,value:null};g.current=x}else x=g.current;g=o(function(){function b(T){if(!w){if(w=!0,M=T,T=d(T),p!==void 0&&x.hasValue){var L=x.value;if(p(L,T))return E=L}return E=T}if(L=E,r(M,T))return L;var P=d(T);return p!==void 0&&p(L,P)?(M=T,L):(M=T,E=P)}var w=!1,M,E,D=h===void 0?null:h;return[function(){return b(u())},D===null?void 0:function(){return b(D())}]},[u,h,d,p]);var v=n(c,g[0],g[1]);return a(function(){x.hasValue=!0,x.value=v},[v]),l(v),v},NI}var s9;function j4e(){return s9||(s9=1,BI.exports=G4e()),BI.exports}var W4e=j4e();const q4e=x3(W4e),a9=t=>{let e;const i=new Set,r=(c,u)=>{const h=typeof c=="function"?c(e):c;if(!Object.is(h,e)){const d=e;e=u??(typeof h!="object"||h===null)?h:Object.assign({},e,h),i.forEach(p=>p(e,d))}},n=()=>e,o={setState:r,getState:n,getInitialState:()=>l,subscribe:c=>(i.add(c),()=>i.delete(c))},l=e=t(r,n,o);return o},X4e=t=>t?a9(t):a9,{useSyncExternalStoreWithSelector:Y4e}=q4e,Q4e=t=>t;function Z4e(t,e=Q4e,i){const r=Y4e(t.subscribe,t.getState,t.getInitialState,e,i);return yC.useDebugValue(r),r}const o9=(t,e)=>{const i=X4e(t),r=(n,s=e)=>Z4e(i,n,s);return Object.assign(r,i),r},K4e=(t,e)=>t?o9(t,e):o9;var VI={exports:{}},HI={exports:{}};/**
 * @license React
 * react-reconciler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l9;function J4e(){return l9||(l9=1,function(t){t.exports=function(e){function i(y,_,C,z){return new uE(y,_,C,z)}function r(){}function n(y){var _="https://react.dev/errors/"+y;if(1<arguments.length){_+="?args[]="+encodeURIComponent(arguments[1]);for(var C=2;C<arguments.length;C++)_+="&args[]="+encodeURIComponent(arguments[C])}return"Minified React error #"+y+"; visit "+_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(y){return y===null||typeof y!="object"?null:(y=kr&&y[kr]||y["@@iterator"],typeof y=="function"?y:null)}function a(y){if(y==null)return null;if(typeof y=="function")return y.$$typeof===cs?null:y.displayName||y.name||null;if(typeof y=="string")return y;switch(y){case jh:return"Fragment";case Dc:return"Portal";case Wh:return"Profiler";case bf:return"StrictMode";case Cu:return"Suspense";case av:return"SuspenseList"}if(typeof y=="object")switch(y.$$typeof){case qh:return(y.displayName||"Context")+".Provider";case Kb:return(y._context.displayName||"Context")+".Consumer";case yy:var _=y.render;return y=y.displayName,y||(y=_.displayName||_.name||"",y=y!==""?"ForwardRef("+y+")":"ForwardRef"),y;case $p:return _=y.displayName||null,_!==null?_:a(y.type)||"Memo";case Du:_=y._payload,y=y._init;try{return a(y(_))}catch{}}return null}function o(y){if(Xh===void 0)try{throw Error()}catch(C){var _=C.stack.trim().match(/\n( *(at )?)/);Xh=_&&_[1]||"",Yh=-1<C.stack.indexOf(`
    at`)?" (<anonymous>)":-1<C.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Xh+y+Yh}function l(y,_){if(!y||em)return"";em=!0;var C=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var z={DetermineComponentFrameRoot:function(){try{if(_){var Xt=function(){throw Error()};if(Object.defineProperty(Xt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Xt,[])}catch(Vi){var zt=Vi}Reflect.construct(y,[],Xt)}else{try{Xt.call()}catch(Vi){zt=Vi}y.call(Xt.prototype)}}else{try{throw Error()}catch(Vi){zt=Vi}(Xt=y())&&typeof Xt.catch=="function"&&Xt.catch(function(){})}}catch(Vi){if(Vi&&zt&&typeof Vi.stack=="string")return[Vi.stack,zt.stack]}return[null,null]}};z.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var N=Object.getOwnPropertyDescriptor(z.DetermineComponentFrameRoot,"name");N&&N.configurable&&Object.defineProperty(z.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var q=z.DetermineComponentFrameRoot(),ye=q[0],Be=q[1];if(ye&&Be){var st=ye.split(`
`),Mt=Be.split(`
`);for(N=z=0;z<st.length&&!st[z].includes("DetermineComponentFrameRoot");)z++;for(;N<Mt.length&&!Mt[N].includes("DetermineComponentFrameRoot");)N++;if(z===st.length||N===Mt.length)for(z=st.length-1,N=Mt.length-1;1<=z&&0<=N&&st[z]!==Mt[N];)N--;for(;1<=z&&0<=N;z--,N--)if(st[z]!==Mt[N]){if(z!==1||N!==1)do if(z--,N--,0>N||st[z]!==Mt[N]){var Ut=`
`+st[z].replace(" at new "," at ");return y.displayName&&Ut.includes("<anonymous>")&&(Ut=Ut.replace("<anonymous>",y.displayName)),Ut}while(1<=z&&0<=N);break}}}finally{em=!1,Error.prepareStackTrace=C}return(C=y?y.displayName||y.name:"")?o(C):""}function c(y){switch(y.tag){case 26:case 27:case 5:return o(y.type);case 16:return o("Lazy");case 13:return o("Suspense");case 19:return o("SuspenseList");case 0:case 15:return y=l(y.type,!1),y;case 11:return y=l(y.type.render,!1),y;case 1:return y=l(y.type,!0),y;default:return""}}function u(y){try{var _="";do _+=c(y),y=y.return;while(y);return _}catch(C){return`
Error generating stack: `+C.message+`
`+C.stack}}function h(y){var _=y,C=y;if(y.alternate)for(;_.return;)_=_.return;else{y=_;do _=y,(_.flags&4098)!==0&&(C=_.return),y=_.return;while(y)}return _.tag===3?C:null}function d(y){if(h(y)!==y)throw Error(n(188))}function p(y){var _=y.alternate;if(!_){if(_=h(y),_===null)throw Error(n(188));return _!==y?null:y}for(var C=y,z=_;;){var N=C.return;if(N===null)break;var q=N.alternate;if(q===null){if(z=N.return,z!==null){C=z;continue}break}if(N.child===q.child){for(q=N.child;q;){if(q===C)return d(N),y;if(q===z)return d(N),_;q=q.sibling}throw Error(n(188))}if(C.return!==z.return)C=N,z=q;else{for(var ye=!1,Be=N.child;Be;){if(Be===C){ye=!0,C=N,z=q;break}if(Be===z){ye=!0,z=N,C=q;break}Be=Be.sibling}if(!ye){for(Be=q.child;Be;){if(Be===C){ye=!0,C=q,z=N;break}if(Be===z){ye=!0,z=q,C=N;break}Be=Be.sibling}if(!ye)throw Error(n(189))}}if(C.alternate!==z)throw Error(n(190))}if(C.tag!==3)throw Error(n(188));return C.stateNode.current===C?y:_}function g(y){var _=y.tag;if(_===5||_===26||_===27||_===6)return y;for(y=y.child;y!==null;){if(_=g(y),_!==null)return _;y=y.sibling}return null}function x(y){var _=y.tag;if(_===5||_===26||_===27||_===6)return y;for(y=y.child;y!==null;){if(y.tag!==4&&(_=x(y),_!==null))return _;y=y.sibling}return null}function v(y){return{current:y}}function b(y){0>Jh||(y.current=Ry[Jh],Ry[Jh]=null,Jh--)}function w(y,_){Jh++,Ry[Jh]=y.current,y.current=_}function M(y){return y>>>=0,y===0?32:31-(__(y)/aR|0)|0}function E(y){var _=y&42;if(_!==0)return _;switch(y&-y){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return y&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return y&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return y}}function D(y,_){var C=y.pendingLanes;if(C===0)return 0;var z=0,N=y.suspendedLanes,q=y.pingedLanes,ye=y.warmLanes;y=y.finishedLanes!==0;var Be=C&134217727;return Be!==0?(C=Be&~N,C!==0?z=E(C):(q&=Be,q!==0?z=E(q):y||(ye=Be&~ye,ye!==0&&(z=E(ye))))):(Be=C&~N,Be!==0?z=E(Be):q!==0?z=E(q):y||(ye=C&~ye,ye!==0&&(z=E(ye)))),z===0?0:_!==0&&_!==z&&(_&N)===0&&(N=z&-z,ye=_&-_,N>=ye||N===32&&(ye&4194176)!==0)?_:z}function T(y,_){return(y.pendingLanes&~(y.suspendedLanes&~y.pingedLanes)&_)===0}function L(y,_){switch(y){case 1:case 2:case 4:case 8:return _+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function P(){var y=uv;return uv<<=1,(uv&4194176)===0&&(uv=128),y}function R(){var y=sm;return sm<<=1,(sm&62914560)===0&&(sm=4194304),y}function O(y){for(var _=[],C=0;31>C;C++)_.push(y);return _}function U(y,_){y.pendingLanes|=_,_!==268435456&&(y.suspendedLanes=0,y.pingedLanes=0,y.warmLanes=0)}function F(y,_,C,z,N,q){var ye=y.pendingLanes;y.pendingLanes=C,y.suspendedLanes=0,y.pingedLanes=0,y.warmLanes=0,y.expiredLanes&=C,y.entangledLanes&=C,y.errorRecoveryDisabledLanes&=C,y.shellSuspendCounter=0;var Be=y.entanglements,st=y.expirationTimes,Mt=y.hiddenUpdates;for(C=ye&~C;0<C;){var Ut=31-qn(C),Xt=1<<Ut;Be[Ut]=0,st[Ut]=-1;var zt=Mt[Ut];if(zt!==null)for(Mt[Ut]=null,Ut=0;Ut<zt.length;Ut++){var Vi=zt[Ut];Vi!==null&&(Vi.lane&=-536870913)}C&=~Xt}z!==0&&V(y,z,0),q!==0&&N===0&&y.tag!==0&&(y.suspendedLanes|=q&~(ye&~_))}function V(y,_,C){y.pendingLanes|=_,y.suspendedLanes&=~_;var z=31-qn(_);y.entangledLanes|=_,y.entanglements[z]=y.entanglements[z]|1073741824|C&4194218}function k(y,_){var C=y.entangledLanes|=_;for(y=y.entanglements;C;){var z=31-qn(C),N=1<<z;N&_|y[z]&_&&(y[z]|=_),C&=~N}}function K(y){return y&=-y,2<y?8<y?(y&134217727)!==0?32:268435456:8:2}function X(y){if(us&&typeof us.onCommitFiberRoot=="function")try{us.onCommitFiberRoot(om,y,void 0,(y.current.flags&128)===128)}catch{}}function $(y){if(typeof ma=="function"&&Ly(y),us&&typeof us.setStrictMode=="function")try{us.setStrictMode(om,y)}catch{}}function Y(y,_){return y===_&&(y!==0||1/y===1/_)||y!==y&&_!==_}function re(y,_){if(typeof y=="object"&&y!==null){var C=Iy.get(y);return C!==void 0?C:(_={value:y,source:_,stack:u(_)},Iy.set(y,_),_)}return{value:y,source:_,stack:u(_)}}function G(y,_){Wo[qo++]=lm,Wo[qo++]=ed,ed=y,lm=_}function j(y,_,C){xo[ga++]=Lc,xo[ga++]=Ic,xo[ga++]=nc,nc=y;var z=Lc;y=Ic;var N=32-qn(z)-1;z&=~(1<<N),C+=1;var q=32-qn(_)+N;if(30<q){var ye=N-N%5;q=(z&(1<<ye)-1).toString(32),z>>=ye,N-=ye,Lc=1<<32-qn(_)+N|C<<N|z,Ic=q+y}else Lc=1<<q|C<<N|z,Ic=y}function ee(y){y.return!==null&&(G(y,1),j(y,1,0))}function oe(y){for(;y===ed;)ed=Wo[--qo],Wo[qo]=null,lm=Wo[--qo],Wo[qo]=null;for(;y===nc;)nc=xo[--ga],xo[ga]=null,Ic=xo[--ga],xo[ga]=null,Lc=xo[--ga],xo[ga]=null}function Q(y,_){w(Iu,_),w(Sl,y),w(Xn,null),y=Jb(_),b(Xn),w(Xn,y)}function ae(){b(Xn),b(Sl),b(Iu)}function ne(y){y.memoizedState!==null&&w(dv,y);var _=Xn.current,C=hE(_,y.type);_!==C&&(w(Sl,y),w(Xn,C))}function ue(y){Sl.current===y&&(b(Xn),b(Sl)),dv.current===y&&(b(dv),tc?Ru._currentValue=Sf:Ru._currentValue2=Sf)}function fe(y){var _=Error(n(418,""));throw Te(re(_,y)),fv}function xe(y,_){if(!yo)throw Error(n(175));Ef(y.stateNode,y.type,y.memoizedProps,_,y)||fe(y)}function be(y){for(Yn=y.return;Yn;)switch(Yn.tag){case 3:case 27:sc=!0;return;case 5:case 13:sc=!1;return;default:Yn=Yn.return}}function Ce(y){if(!yo||y!==Yn)return!1;if(!_r)return be(y),_r=!0,!1;var _=!1;if(zs?y.tag!==3&&y.tag!==27&&(y.tag!==5||h_(y.type)&&!Zs(y.type,y.memoizedProps))&&(_=!0):y.tag!==3&&(y.tag!==5||h_(y.type)&&!Zs(y.type,y.memoizedProps))&&(_=!0),_&&Wr&&fe(y),be(y),y.tag===13){if(!yo)throw Error(n(316));if(y=y.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(n(317));Wr=GE(y)}else Wr=Yn?Kh(y.stateNode):null;return!0}function ge(){yo&&(Wr=Yn=null,_r=!1)}function Te(y){wl===null?wl=[y]:wl.push(y)}function ce(){for(var y=zu,_=ac=zu=0;_<y;){var C=bo[_];bo[_++]=null;var z=bo[_];bo[_++]=null;var N=bo[_];bo[_++]=null;var q=bo[_];if(bo[_++]=null,z!==null&&N!==null){var ye=z.pending;ye===null?N.next=N:(N.next=ye.next,ye.next=N),z.pending=N}q!==0&&De(C,N,q)}}function Ue(y,_,C,z){bo[zu++]=y,bo[zu++]=_,bo[zu++]=C,bo[zu++]=z,ac|=z,y.lanes|=z,y=y.alternate,y!==null&&(y.lanes|=z)}function ze(y,_,C,z){return Ue(y,_,C,z),Ge(y)}function Xe(y,_){return Ue(y,null,null,_),Ge(y)}function De(y,_,C){y.lanes|=C;var z=y.alternate;z!==null&&(z.lanes|=C);for(var N=!1,q=y.return;q!==null;)q.childLanes|=C,z=q.alternate,z!==null&&(z.childLanes|=C),q.tag===22&&(y=q.stateNode,y===null||y._visibility&1||(N=!0)),y=q,q=q.return;N&&_!==null&&y.tag===3&&(q=y.stateNode,N=31-qn(C),q=q.hiddenUpdates,y=q[N],y===null?q[N]=[_]:y.push(_),_.lane=C|536870912)}function Ge(y){if(50<Lf)throw Lf=0,A_=null,Error(n(185));for(var _=y.return;_!==null;)y=_,_=y.return;return y.tag===3?y.stateNode:null}function We(y){y!==td&&y.next===null&&(td===null?gn=td=y:td=td.next=y),Qn=!0,zy||(zy=!0,J(H))}function se(y,_){if(!Uy&&Qn){Uy=!0;do for(var C=!1,z=gn;z!==null;){if(y!==0){var N=z.pendingLanes;if(N===0)var q=0;else{var ye=z.suspendedLanes,Be=z.pingedLanes;q=(1<<31-qn(42|y)+1)-1,q&=N&~(ye&~Be),q=q&201326677?q&201326677|1:q?q|2:0}q!==0&&(C=!0,we(z,q))}else q=ur,q=D(z,z===Xr?q:0),(q&3)===0||T(z,q)||(C=!0,we(z,q));z=z.next}while(C);Uy=!1}}function H(){Qn=zy=!1;var y=0;cm!==0&&(mE()&&(y=cm),cm=0);for(var _=jo(),C=null,z=gn;z!==null;){var N=z.next,q=Z(z,_);q===0?(z.next=null,C===null?gn=N:C.next=N,N===null&&(td=C)):(C=z,(y!==0||(q&3)!==0)&&(Qn=!0)),z=N}se(y)}function Z(y,_){for(var C=y.suspendedLanes,z=y.pingedLanes,N=y.expirationTimes,q=y.pendingLanes&-62914561;0<q;){var ye=31-qn(q),Be=1<<ye,st=N[ye];st===-1?((Be&C)===0||(Be&z)!==0)&&(N[ye]=L(Be,_)):st<=_&&(y.expiredLanes|=Be),q&=~Be}if(_=Xr,C=ur,C=D(y,y===_?C:0),z=y.callbackNode,C===0||y===_&&Vr===2||y.cancelPendingCommit!==null)return z!==null&&z!==null&&rc(z),y.callbackNode=null,y.callbackPriority=0;if((C&3)===0||T(y,C)){if(_=C&-C,_===y.callbackPriority)return _;switch(z!==null&&rc(z),K(C)){case 2:case 8:C=hv;break;case 32:C=am;break;case 268435456:C=Tf;break;default:C=am}return z=pe.bind(null,y),C=Oc(C,z),y.callbackPriority=_,y.callbackNode=C,_}return z!==null&&z!==null&&rc(z),y.callbackPriority=2,y.callbackNode=null,2}function pe(y,_){var C=y.callbackNode;if(kh()&&y.callbackNode!==C)return null;var z=ur;return z=D(y,y===Xr?z:0),z===0?null:(Vo(y,z,_),Z(y,jo()),y.callbackNode!=null&&y.callbackNode===C?pe.bind(null,y):null)}function we(y,_){if(kh())return null;Vo(y,_,!0)}function J(y){xE?bE(function(){(cr&6)!==0?Oc(Oy,y):y()}):Oc(Oy,y)}function He(){return cm===0&&(cm=P()),cm}function je(y,_){if(um===null){var C=um=[];By=0,vn=He(),Us={status:"pending",value:void 0,then:function(z){C.push(z)}}}return By++,_.then(Ye,Ye),_}function Ye(){if(--By===0&&um!==null){Us!==null&&(Us.status="fulfilled");var y=um;um=null,vn=0,Us=null;for(var _=0;_<y.length;_++)(0,y[_])()}}function Ve(y,_){var C=[],z={status:"pending",value:null,reason:null,then:function(N){C.push(N)}};return y.then(function(){z.status="fulfilled",z.value=_;for(var N=0;N<C.length;N++)(0,C[N])(_)},function(N){for(z.status="rejected",z.reason=N,N=0;N<C.length;N++)(0,C[N])(void 0)}),z}function Ke(y){y.updateQueue={baseState:y.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function at(y,_){y=y.updateQueue,_.updateQueue===y&&(_.updateQueue={baseState:y.baseState,firstBaseUpdate:y.firstBaseUpdate,lastBaseUpdate:y.lastBaseUpdate,shared:y.shared,callbacks:null})}function ut(y){return{lane:y,tag:0,payload:null,callback:null,next:null}}function ht(y,_,C){var z=y.updateQueue;if(z===null)return null;if(z=z.shared,(cr&2)!==0){var N=z.pending;return N===null?_.next=_:(_.next=N.next,N.next=_),z.pending=_,_=Ge(y),De(y,null,C),_}return Ue(y,z,_,C),Ge(y)}function $e(y,_,C){if(_=_.updateQueue,_!==null&&(_=_.shared,(C&4194176)!==0)){var z=_.lanes;z&=y.pendingLanes,C|=z,_.lanes=C,k(y,C)}}function St(y,_){var C=y.updateQueue,z=y.alternate;if(z!==null&&(z=z.updateQueue,C===z)){var N=null,q=null;if(C=C.firstBaseUpdate,C!==null){do{var ye={lane:C.lane,tag:C.tag,payload:C.payload,callback:null,next:null};q===null?N=q=ye:q=q.next=ye,C=C.next}while(C!==null);q===null?N=q=_:q=q.next=_}else N=q=_;C={baseState:z.baseState,firstBaseUpdate:N,lastBaseUpdate:q,shared:z.shared,callbacks:z.callbacks},y.updateQueue=C;return}y=C.lastBaseUpdate,y===null?C.firstBaseUpdate=_:y.next=_,C.lastBaseUpdate=_}function Pt(){if(Ny){var y=Us;if(y!==null)throw y}}function Kt(y,_,C,z){Ny=!1;var N=y.updateQueue;va=!1;var q=N.firstBaseUpdate,ye=N.lastBaseUpdate,Be=N.shared.pending;if(Be!==null){N.shared.pending=null;var st=Be,Mt=st.next;st.next=null,ye===null?q=Mt:ye.next=Mt,ye=st;var Ut=y.alternate;Ut!==null&&(Ut=Ut.updateQueue,Be=Ut.lastBaseUpdate,Be!==ye&&(Be===null?Ut.firstBaseUpdate=Mt:Be.next=Mt,Ut.lastBaseUpdate=st))}if(q!==null){var Xt=N.baseState;ye=0,Ut=Mt=st=null,Be=q;do{var zt=Be.lane&-536870913,Vi=zt!==Be.lane;if(Vi?(ur&zt)===zt:(z&zt)===zt){zt!==0&&zt===vn&&(Ny=!0),Ut!==null&&(Ut=Ut.next={lane:0,tag:Be.tag,payload:Be.payload,callback:null,next:null});e:{var Rl=y,gm=Be;zt=_;var If=C;switch(gm.tag){case 1:if(Rl=gm.payload,typeof Rl=="function"){Xt=Rl.call(If,Xt,zt);break e}Xt=Rl;break e;case 3:Rl.flags=Rl.flags&-65537|128;case 0:if(Rl=gm.payload,zt=typeof Rl=="function"?Rl.call(If,Xt,zt):Rl,zt==null)break e;Xt=jn({},Xt,zt);break e;case 2:va=!0}}zt=Be.callback,zt!==null&&(y.flags|=64,Vi&&(y.flags|=8192),Vi=N.callbacks,Vi===null?N.callbacks=[zt]:Vi.push(zt))}else Vi={lane:zt,tag:Be.tag,payload:Be.payload,callback:Be.callback,next:null},Ut===null?(Mt=Ut=Vi,st=Xt):Ut=Ut.next=Vi,ye|=zt;if(Be=Be.next,Be===null){if(Be=N.shared.pending,Be===null)break;Vi=Be,Be=Vi.next,Vi.next=null,N.lastBaseUpdate=Vi,N.shared.pending=null}}while(!0);Ut===null&&(st=Xt),N.baseState=st,N.firstBaseUpdate=Mt,N.lastBaseUpdate=Ut,q===null&&(N.shared.lanes=0),Dl|=ye,y.lanes=ye,y.memoizedState=Xt}}function le(y,_){if(typeof y!="function")throw Error(n(191,y));y.call(_)}function Re(y,_){var C=y.callbacks;if(C!==null)for(y.callbacks=null,y=0;y<C.length;y++)le(C[y],_)}function Ee(y,_){if(ka(y,_))return!0;if(typeof y!="object"||y===null||typeof _!="object"||_===null)return!1;var C=Object.keys(y),z=Object.keys(_);if(C.length!==z.length)return!1;for(z=0;z<C.length;z++){var N=C[z];if(!KE.call(_,N)||!ka(y[N],_[N]))return!1}return!0}function Qe(y){return y=y.status,y==="fulfilled"||y==="rejected"}function ot(){}function pt(y,_,C){switch(C=y[C],C===void 0?y.push(_):C!==_&&(_.then(ot,ot),_=C),_.status){case"fulfilled":return _.value;case"rejected":throw y=_.reason,y===pv?Error(n(483)):y;default:if(typeof _.status=="string")_.then(ot,ot);else{if(y=Xr,y!==null&&100<y.shellSuspendCounter)throw Error(n(482));y=_,y.status="pending",y.then(function(z){if(_.status==="pending"){var N=_;N.status="fulfilled",N.value=z}},function(z){if(_.status==="pending"){var N=_;N.status="rejected",N.reason=z}})}switch(_.status){case"fulfilled":return _.value;case"rejected":throw y=_.reason,y===pv?Error(n(483)):y}throw ya=_,pv}}function Bt(){if(ya===null)throw Error(n(459));var y=ya;return ya=null,y}function Jt(y){var _=xa;return xa+=1,Cf===null&&(Cf=[]),pt(Cf,y,_)}function qt(y,_){_=_.props.ref,y.ref=_!==void 0?_:null}function Ft(y,_){throw _.$$typeof===Zb?Error(n(525)):(y=Object.prototype.toString.call(_),Error(n(31,y==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":y)))}function Ni(y){var _=y._init;return _(y._payload)}function Oi(y){function _(ft,et){if(y){var vt=ft.deletions;vt===null?(ft.deletions=[et],ft.flags|=16):vt.push(et)}}function C(ft,et){if(!y)return null;for(;et!==null;)_(ft,et),et=et.sibling;return null}function z(ft){for(var et=new Map;ft!==null;)ft.key!==null?et.set(ft.key,ft):et.set(ft.index,ft),ft=ft.sibling;return et}function N(ft,et){return ft=Eu(ft,et),ft.index=0,ft.sibling=null,ft}function q(ft,et,vt){return ft.index=vt,y?(vt=ft.alternate,vt!==null?(vt=vt.index,vt<et?(ft.flags|=33554434,et):vt):(ft.flags|=33554434,et)):(ft.flags|=1048576,et)}function ye(ft){return y&&ft.alternate===null&&(ft.flags|=33554434),ft}function Be(ft,et,vt,It){return et===null||et.tag!==6?(et=sv(vt,ft.mode,It),et.return=ft,et):(et=N(et,vt),et.return=ft,et)}function st(ft,et,vt,It){var fi=vt.type;return fi===jh?Ut(ft,et,vt.props.children,It,vt.key):et!==null&&(et.elementType===fi||typeof fi=="object"&&fi!==null&&fi.$$typeof===Du&&Ni(fi)===et.type)?(et=N(et,vt.props),qt(et,vt),et.return=ft,et):(et=xf(vt.type,vt.key,vt.props,null,ft.mode,It),qt(et,vt),et.return=ft,et)}function Mt(ft,et,vt,It){return et===null||et.tag!==4||et.stateNode.containerInfo!==vt.containerInfo||et.stateNode.implementation!==vt.implementation?(et=vo(vt,ft.mode,It),et.return=ft,et):(et=N(et,vt.children||[]),et.return=ft,et)}function Ut(ft,et,vt,It,fi){return et===null||et.tag!==7?(et=Hh(vt,ft.mode,It,fi),et.return=ft,et):(et=N(et,vt),et.return=ft,et)}function Xt(ft,et,vt){if(typeof et=="string"&&et!==""||typeof et=="number"||typeof et=="bigint")return et=sv(""+et,ft.mode,vt),et.return=ft,et;if(typeof et=="object"&&et!==null){switch(et.$$typeof){case Gh:return vt=xf(et.type,et.key,et.props,null,ft.mode,vt),qt(vt,et),vt.return=ft,vt;case Dc:return et=vo(et,ft.mode,vt),et.return=ft,et;case Du:var It=et._init;return et=It(et._payload),Xt(ft,et,vt)}if(Qh(et)||s(et))return et=Hh(et,ft.mode,vt,null),et.return=ft,et;if(typeof et.then=="function")return Xt(ft,Jt(et),vt);if(et.$$typeof===qh)return Xt(ft,Gg(ft,et),vt);Ft(ft,et)}return null}function zt(ft,et,vt,It){var fi=et!==null?et.key:null;if(typeof vt=="string"&&vt!==""||typeof vt=="number"||typeof vt=="bigint")return fi!==null?null:Be(ft,et,""+vt,It);if(typeof vt=="object"&&vt!==null){switch(vt.$$typeof){case Gh:return vt.key===fi?st(ft,et,vt,It):null;case Dc:return vt.key===fi?Mt(ft,et,vt,It):null;case Du:return fi=vt._init,vt=fi(vt._payload),zt(ft,et,vt,It)}if(Qh(vt)||s(vt))return fi!==null?null:Ut(ft,et,vt,It,null);if(typeof vt.then=="function")return zt(ft,et,Jt(vt),It);if(vt.$$typeof===qh)return zt(ft,et,Gg(ft,vt),It);Ft(ft,vt)}return null}function Vi(ft,et,vt,It,fi){if(typeof It=="string"&&It!==""||typeof It=="number"||typeof It=="bigint")return ft=ft.get(vt)||null,Be(et,ft,""+It,fi);if(typeof It=="object"&&It!==null){switch(It.$$typeof){case Gh:return ft=ft.get(It.key===null?vt:It.key)||null,st(et,ft,It,fi);case Dc:return ft=ft.get(It.key===null?vt:It.key)||null,Mt(et,ft,It,fi);case Du:var Yr=It._init;return It=Yr(It._payload),Vi(ft,et,vt,It,fi)}if(Qh(It)||s(It))return ft=ft.get(vt)||null,Ut(et,ft,It,fi,null);if(typeof It.then=="function")return Vi(ft,et,vt,Jt(It),fi);if(It.$$typeof===qh)return Vi(ft,et,vt,Gg(et,It),fi);Ft(et,It)}return null}function Rl(ft,et,vt,It){for(var fi=null,Yr=null,Pi=et,or=et=0,$r=null;Pi!==null&&or<vt.length;or++){Pi.index>or?($r=Pi,Pi=null):$r=Pi.sibling;var hr=zt(ft,Pi,vt[or],It);if(hr===null){Pi===null&&(Pi=$r);break}y&&Pi&&hr.alternate===null&&_(ft,Pi),et=q(hr,et,or),Yr===null?fi=hr:Yr.sibling=hr,Yr=hr,Pi=$r}if(or===vt.length)return C(ft,Pi),_r&&G(ft,or),fi;if(Pi===null){for(;or<vt.length;or++)Pi=Xt(ft,vt[or],It),Pi!==null&&(et=q(Pi,et,or),Yr===null?fi=Pi:Yr.sibling=Pi,Yr=Pi);return _r&&G(ft,or),fi}for(Pi=z(Pi);or<vt.length;or++)$r=Vi(Pi,ft,or,vt[or],It),$r!==null&&(y&&$r.alternate!==null&&Pi.delete($r.key===null?or:$r.key),et=q($r,et,or),Yr===null?fi=$r:Yr.sibling=$r,Yr=$r);return y&&Pi.forEach(function(ud){return _(ft,ud)}),_r&&G(ft,or),fi}function gm(ft,et,vt,It){if(vt==null)throw Error(n(151));for(var fi=null,Yr=null,Pi=et,or=et=0,$r=null,hr=vt.next();Pi!==null&&!hr.done;or++,hr=vt.next()){Pi.index>or?($r=Pi,Pi=null):$r=Pi.sibling;var ud=zt(ft,Pi,hr.value,It);if(ud===null){Pi===null&&(Pi=$r);break}y&&Pi&&ud.alternate===null&&_(ft,Pi),et=q(ud,et,or),Yr===null?fi=ud:Yr.sibling=ud,Yr=ud,Pi=$r}if(hr.done)return C(ft,Pi),_r&&G(ft,or),fi;if(Pi===null){for(;!hr.done;or++,hr=vt.next())hr=Xt(ft,hr.value,It),hr!==null&&(et=q(hr,et,or),Yr===null?fi=hr:Yr.sibling=hr,Yr=hr);return _r&&G(ft,or),fi}for(Pi=z(Pi);!hr.done;or++,hr=vt.next())hr=Vi(Pi,ft,or,hr.value,It),hr!==null&&(y&&hr.alternate!==null&&Pi.delete(hr.key===null?or:hr.key),et=q(hr,et,or),Yr===null?fi=hr:Yr.sibling=hr,Yr=hr);return y&&Pi.forEach(function($E){return _(ft,$E)}),_r&&G(ft,or),fi}function If(ft,et,vt,It){if(typeof vt=="object"&&vt!==null&&vt.type===jh&&vt.key===null&&(vt=vt.props.children),typeof vt=="object"&&vt!==null){switch(vt.$$typeof){case Gh:e:{for(var fi=vt.key;et!==null;){if(et.key===fi){if(fi=vt.type,fi===jh){if(et.tag===7){C(ft,et.sibling),It=N(et,vt.props.children),It.return=ft,ft=It;break e}}else if(et.elementType===fi||typeof fi=="object"&&fi!==null&&fi.$$typeof===Du&&Ni(fi)===et.type){C(ft,et.sibling),It=N(et,vt.props),qt(It,vt),It.return=ft,ft=It;break e}C(ft,et);break}else _(ft,et);et=et.sibling}vt.type===jh?(It=Hh(vt.props.children,ft.mode,It,vt.key),It.return=ft,ft=It):(It=xf(vt.type,vt.key,vt.props,null,ft.mode,It),qt(It,vt),It.return=ft,ft=It)}return ye(ft);case Dc:e:{for(fi=vt.key;et!==null;){if(et.key===fi)if(et.tag===4&&et.stateNode.containerInfo===vt.containerInfo&&et.stateNode.implementation===vt.implementation){C(ft,et.sibling),It=N(et,vt.children||[]),It.return=ft,ft=It;break e}else{C(ft,et);break}else _(ft,et);et=et.sibling}It=vo(vt,ft.mode,It),It.return=ft,ft=It}return ye(ft);case Du:return fi=vt._init,vt=fi(vt._payload),If(ft,et,vt,It)}if(Qh(vt))return Rl(ft,et,vt,It);if(s(vt)){if(fi=s(vt),typeof fi!="function")throw Error(n(150));return vt=fi.call(vt),gm(ft,et,vt,It)}if(typeof vt.then=="function")return If(ft,et,Jt(vt),It);if(vt.$$typeof===qh)return If(ft,et,Gg(ft,vt),It);Ft(ft,vt)}return typeof vt=="string"&&vt!==""||typeof vt=="number"||typeof vt=="bigint"?(vt=""+vt,et!==null&&et.tag===6?(C(ft,et.sibling),It=N(et,vt),It.return=ft,ft=It):(C(ft,et),It=sv(vt,ft.mode,It),It.return=ft,ft=It),ye(ft)):C(ft,et)}return function(ft,et,vt,It){try{xa=0;var fi=If(ft,et,vt,It);return Cf=null,fi}catch(Pi){if(Pi===pv)throw Pi;var Yr=i(29,Pi,null,ft.mode);return Yr.lanes=It,Yr.return=ft,Yr}finally{}}}function Tr(y,_){y=uc,w(lc,y),w(oc,_),uc=y|_.baseLanes}function Dn(){w(lc,uc),w(oc,oc.current)}function pn(){uc=lc.current,b(oc),b(lc)}function Fr(y){var _=y.alternate;w(ln,ln.current&1),w(_o,y),Ml===null&&(_===null||oc.current!==null||_.memoizedState!==null)&&(Ml=y)}function _e(y){if(y.tag===22){if(w(ln,ln.current),w(_o,y),Ml===null){var _=y.alternate;_!==null&&_.memoizedState!==null&&(Ml=y)}}else tt()}function tt(){w(ln,ln.current),w(_o,_o.current)}function ct(y){b(_o),Ml===y&&(Ml=null),b(ln)}function qe(y){for(var _=y;_!==null;){if(_.tag===13){var C=_.memoizedState;if(C!==null&&(C=C.dehydrated,C===null||wf(C)||cv(C)))return _}else if(_.tag===19&&_.memoizedProps.revealOrder!==void 0){if((_.flags&128)!==0)return _}else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===y)break;for(;_.sibling===null;){if(_.return===null||_.return===y)return null;_=_.return}_.sibling.return=_.return,_=_.sibling}return null}function it(){throw Error(n(321))}function Gt(y,_){if(_===null)return!1;for(var C=0;C<_.length&&C<y.length;C++)if(!ka(y[C],_[C]))return!1;return!0}function oi(y,_,C,z,N,q){return Uu=q,Fi=_,_.memoizedState=null,_.updateQueue=null,_.lanes=0,Ii.H=y===null||y.memoizedState===null?Fu:Ha,rd=!1,q=C(z,N),rd=!1,Df&&(q=ri(_,C,z,N)),gi(y),q}function gi(y){Ii.H=Zn;var _=Cr!==null&&Cr.next!==null;if(Uu=0,Mn=Cr=Fi=null,Bu=!1,hm=0,Nu=null,_)throw Error(n(300));y===null||hs||(y=y.dependencies,y!==null&&Hg(y)&&(hs=!0))}function ri(y,_,C,z){Fi=y;var N=0;do{if(Df&&(Nu=null),hm=0,Df=!1,25<=N)throw Error(n(301));if(N+=1,Mn=Cr=null,y.updateQueue!=null){var q=y.updateQueue;q.lastEffect=null,q.events=null,q.stores=null,q.memoCache!=null&&(q.memoCache.index=0)}Ii.H=sd,q=_(C,z)}while(Df);return q}function Wi(){var y=Ii.H,_=y.useState()[0];return _=typeof _.then=="function"?rt(_):_,y=y.useState()[0],(Cr!==null?Cr.memoizedState:null)!==y&&(Fi.flags|=1024),_}function mi(){var y=nd!==0;return nd=0,y}function Mi(y,_,C){_.updateQueue=y.updateQueue,_.flags&=-2053,y.lanes&=~C}function hi(y){if(Bu){for(y=y.memoizedState;y!==null;){var _=y.queue;_!==null&&(_.pending=null),y=y.next}Bu=!1}Uu=0,Mn=Cr=Fi=null,Df=!1,hm=nd=0,Nu=null}function de(){var y={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Mn===null?Fi.memoizedState=Mn=y:Mn=Mn.next=y,Mn}function ke(){if(Cr===null){var y=Fi.alternate;y=y!==null?y.memoizedState:null}else y=Cr.next;var _=Mn===null?Fi.memoizedState:Mn.next;if(_!==null)Mn=_,Cr=y;else{if(y===null)throw Fi.alternate===null?Error(n(467)):Error(n(310));Cr=y,y={memoizedState:Cr.memoizedState,baseState:Cr.baseState,baseQueue:Cr.baseQueue,queue:Cr.queue,next:null},Mn===null?Fi.memoizedState=Mn=y:Mn=Mn.next=y}return Mn}function rt(y){var _=hm;return hm+=1,Nu===null&&(Nu=[]),y=pt(Nu,y,_),_=Fi,(Mn===null?_.memoizedState:Mn.next)===null&&(_=_.alternate,Ii.H=_===null||_.memoizedState===null?Fu:Ha),y}function Ie(y){if(y!==null&&typeof y=="object"){if(typeof y.then=="function")return rt(y);if(y.$$typeof===qh)return Ys(y)}throw Error(n(438,String(y)))}function Fe(y){var _=null,C=Fi.updateQueue;if(C!==null&&(_=C.memoCache),_==null){var z=Fi.alternate;z!==null&&(z=z.updateQueue,z!==null&&(z=z.memoCache,z!=null&&(_={data:z.data.map(function(N){return N.slice()}),index:0})))}if(_==null&&(_={data:[],index:0}),C===null&&(C=S_(),Fi.updateQueue=C),C.memoCache=_,C=_.data[_.index],C===void 0)for(C=_.data[_.index]=Array(y),z=0;z<y;z++)C[z]=tr;return _.index++,C}function Dt(y,_){return typeof _=="function"?_(y):_}function xt(y){var _=ke();return Nt(_,Cr,y)}function Nt(y,_,C){var z=y.queue;if(z===null)throw Error(n(311));z.lastRenderedReducer=C;var N=y.baseQueue,q=z.pending;if(q!==null){if(N!==null){var ye=N.next;N.next=q.next,q.next=ye}_.baseQueue=N=q,z.pending=null}if(q=y.baseState,N===null)y.memoizedState=q;else{_=N.next;var Be=ye=null,st=null,Mt=_,Ut=!1;do{var Xt=Mt.lane&-536870913;if(Xt!==Mt.lane?(ur&Xt)===Xt:(Uu&Xt)===Xt){var zt=Mt.revertLane;if(zt===0)st!==null&&(st=st.next={lane:0,revertLane:0,action:Mt.action,hasEagerState:Mt.hasEagerState,eagerState:Mt.eagerState,next:null}),Xt===vn&&(Ut=!0);else if((Uu&zt)===zt){Mt=Mt.next,zt===vn&&(Ut=!0);continue}else Xt={lane:0,revertLane:Mt.revertLane,action:Mt.action,hasEagerState:Mt.hasEagerState,eagerState:Mt.eagerState,next:null},st===null?(Be=st=Xt,ye=q):st=st.next=Xt,Fi.lanes|=zt,Dl|=zt;Xt=Mt.action,rd&&C(q,Xt),q=Mt.hasEagerState?Mt.eagerState:C(q,Xt)}else zt={lane:Xt,revertLane:Mt.revertLane,action:Mt.action,hasEagerState:Mt.hasEagerState,eagerState:Mt.eagerState,next:null},st===null?(Be=st=zt,ye=q):st=st.next=zt,Fi.lanes|=Xt,Dl|=Xt;Mt=Mt.next}while(Mt!==null&&Mt!==_);if(st===null?ye=q:st.next=Be,!ka(q,y.memoizedState)&&(hs=!0,Ut&&(C=Us,C!==null)))throw C;y.memoizedState=q,y.baseState=ye,y.baseQueue=st,z.lastRenderedState=q}return N===null&&(z.lanes=0),[y.memoizedState,z.dispatch]}function kt(y){var _=ke(),C=_.queue;if(C===null)throw Error(n(311));C.lastRenderedReducer=y;var z=C.dispatch,N=C.pending,q=_.memoizedState;if(N!==null){C.pending=null;var ye=N=N.next;do q=y(q,ye.action),ye=ye.next;while(ye!==N);ka(q,_.memoizedState)||(hs=!0),_.memoizedState=q,_.baseQueue===null&&(_.baseState=q),C.lastRenderedState=q}return[q,z]}function li(y,_,C){var z=Fi,N=ke(),q=_r;if(q){if(C===void 0)throw Error(n(407));C=C()}else C=_();var ye=!ka((Cr||N).memoizedState,C);if(ye&&(N.memoizedState=C,hs=!0),N=N.queue,Zl(he.bind(null,z,N,y),[y]),N.getSnapshot!==_||ye||Mn!==null&&Mn.memoizedState.tag&1){if(z.flags|=2048,ha(9,te.bind(null,z,N,C,_),{destroy:void 0},null),Xr===null)throw Error(n(349));q||(Uu&60)!==0||ii(z,_,C)}return C}function ii(y,_,C){y.flags|=16384,y={getSnapshot:_,value:C},_=Fi.updateQueue,_===null?(_=S_(),Fi.updateQueue=_,_.stores=[y]):(C=_.stores,C===null?_.stores=[y]:C.push(y))}function te(y,_,C,z){_.value=C,_.getSnapshot=z,Ae(_)&&me(y)}function he(y,_,C){return C(function(){Ae(_)&&me(y)})}function Ae(y){var _=y.getSnapshot;y=y.value;try{var C=_();return!ka(y,C)}catch{return!0}}function me(y){var _=Xe(y,2);_!==null&&on(_,y,2)}function Ne(y){var _=de();if(typeof y=="function"){var C=y;if(y=C(),rd){$(!0);try{C()}finally{$(!1)}}}return _.memoizedState=_.baseState=y,_.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Dt,lastRenderedState:y},_}function mt(y,_,C,z){return y.baseState=C,Nt(y,Cr,typeof z=="function"?z:Dt)}function ei(y,_,C,z,N){if(Ph(y))throw Error(n(485));if(y=_.action,y!==null){var q={payload:N,action:y,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ye){q.listeners.push(ye)}};Ii.T!==null?C(!0):q.isTransition=!1,z(q),C=_.pending,C===null?(q.next=_.pending=q,jr(_,q)):(q.next=C.next,_.pending=C.next=q)}}function jr(y,_){var C=_.action,z=_.payload,N=y.state;if(_.isTransition){var q=Ii.T,ye={};Ii.T=ye;try{var Be=C(N,z),st=Ii.S;st!==null&&st(ye,Be),Li(y,_,Be)}catch(Mt){Un(y,_,Mt)}finally{Ii.T=q}}else try{q=C(N,z),Li(y,_,q)}catch(Mt){Un(y,_,Mt)}}function Li(y,_,C){C!==null&&typeof C=="object"&&typeof C.then=="function"?C.then(function(z){Pn(y,_,z)},function(z){return Un(y,_,z)}):Pn(y,_,C)}function Pn(y,_,C){_.status="fulfilled",_.value=C,_n(_),y.state=C,_=y.pending,_!==null&&(C=_.next,C===_?y.pending=null:(C=C.next,_.next=C,jr(y,C)))}function Un(y,_,C){var z=y.pending;if(y.pending=null,z!==null){z=z.next;do _.status="rejected",_.reason=C,_n(_),_=_.next;while(_!==z)}y.action=null}function _n(y){y=y.listeners;for(var _=0;_<y.length;_++)(0,y[_])()}function zr(y,_){return _}function Or(y,_){if(_r){var C=Xr.formState;if(C!==null){e:{var z=Fi;if(_r){if(Wr){var N=FE(Wr,sc);if(N){Wr=Kh(N),z=Rc(N);break e}}fe(z)}z=!1}z&&(_=C[0])}}C=de(),C.memoizedState=C.baseState=_,z={pending:null,lanes:0,dispatch:null,lastRenderedReducer:zr,lastRenderedState:_},C.queue=z,C=Hp.bind(null,Fi,z),z.dispatch=C,z=Ne(!1);var q=hu.bind(null,Fi,!1,z.queue);return z=de(),N={state:_,dispatch:null,action:y,pending:null},z.queue=N,C=ei.bind(null,Fi,N,q,C),N.dispatch=C,z.memoizedState=y,[_,C,!1]}function Vn(y){var _=ke();return Rn(_,Cr,y)}function Rn(y,_,C){_=Nt(y,_,zr)[0],y=xt(Dt)[0],_=typeof _=="object"&&_!==null&&typeof _.then=="function"?rt(_):_;var z=ke(),N=z.queue,q=N.dispatch;return C!==z.memoizedState&&(Fi.flags|=2048,ha(9,mn.bind(null,N,C),{destroy:void 0},null)),[_,q,y]}function mn(y,_){y.action=_}function On(y){var _=ke(),C=Cr;if(C!==null)return Rn(_,C,y);ke(),_=_.memoizedState,C=ke();var z=C.queue.dispatch;return C.memoizedState=y,[_,z,!1]}function ha(y,_,C,z){return y={tag:y,create:_,inst:C,deps:z,next:null},_=Fi.updateQueue,_===null&&(_=S_(),Fi.updateQueue=_),C=_.lastEffect,C===null?_.lastEffect=y.next=y:(z=C.next,C.next=y,y.next=z,_.lastEffect=y),y}function _s(){return ke().memoizedState}function sf(y,_,C,z){var N=de();Fi.flags|=y,N.memoizedState=ha(1|_,C,{destroy:void 0},z===void 0?null:z)}function Th(y,_,C,z){var N=ke();z=z===void 0?null:z;var q=N.memoizedState.inst;Cr!==null&&z!==null&&Gt(z,Cr.memoizedState.deps)?N.memoizedState=ha(_,C,q,z):(Fi.flags|=y,N.memoizedState=ha(1|_,C,q,z))}function af(y,_){sf(8390656,8,y,_)}function Zl(y,_){Th(2048,8,y,_)}function Ug(y,_){return Th(4,2,y,_)}function of(y,_){return Th(4,4,y,_)}function pl(y,_){if(typeof _=="function"){y=y();var C=_(y);return function(){typeof C=="function"?C():_(null)}}if(_!=null)return y=y(),_.current=y,function(){_.current=null}}function Kl(y,_,C){C=C!=null?C.concat([y]):null,Th(4,4,pl.bind(null,_,y),C)}function Jl(){}function wc(y,_){var C=ke();_=_===void 0?null:_;var z=C.memoizedState;return _!==null&&Gt(_,z[1])?z[0]:(C.memoizedState=[y,_],y)}function No(y,_){var C=ke();_=_===void 0?null:_;var z=C.memoizedState;if(_!==null&&Gt(_,z[1]))return z[0];if(z=y(),rd){$(!0);try{y()}finally{$(!1)}}return C.memoizedState=[z,_],z}function Ch(y,_,C){return C===void 0||(Uu&1073741824)!==0?y.memoizedState=_:(y.memoizedState=C,y=Jg(),Fi.lanes|=y,Dl|=y,C)}function Dh(y,_,C,z){return ka(C,_)?C:oc.current!==null?(y=Ch(y,C,z),ka(y,_)||(hs=!0),y):(Uu&42)===0?(hs=!0,y.memoizedState=C):(y=Jg(),Fi.lanes|=y,Dl|=y,_)}function Vp(y,_,C,z,N){var q=Zh();Fa(q!==0&&8>q?q:8);var ye=Ii.T,Be={};Ii.T=Be,hu(y,!1,_,C);try{var st=N(),Mt=Ii.S;if(Mt!==null&&Mt(Be,st),st!==null&&typeof st=="object"&&typeof st.then=="function"){var Ut=Ve(st,z);ml(y,_,Ut,fa(y))}else ml(y,_,z,fa(y))}catch(Xt){ml(y,_,{then:function(){},status:"rejected",reason:Xt},fa())}finally{Fa(q),Ii.T=ye}}function $l(y){var _=y.memoizedState;if(_!==null)return _;_={memoizedState:Sf,baseState:Sf,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Dt,lastRenderedState:Sf},next:null};var C={};return _.next={memoizedState:C,baseState:C,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Dt,lastRenderedState:C},next:null},y.memoizedState=_,y=y.alternate,y!==null&&(y.memoizedState=_),_}function cu(){return Ys(Ru)}function uu(){return ke().memoizedState}function Hn(){return ke().memoizedState}function lf(y){for(var _=y.return;_!==null;){switch(_.tag){case 24:case 3:var C=fa();y=ut(C);var z=ht(_,y,C);z!==null&&(on(z,_,C),$e(z,_,C)),_={cache:Lh()},y.payload=_;return}_=_.return}}function cf(y,_,C){var z=fa();C={lane:z,revertLane:0,action:C,hasEagerState:!1,eagerState:null,next:null},Ph(y)?Gn(_,C):(C=ze(y,_,C,z),C!==null&&(on(C,y,z),co(C,_,z)))}function Hp(y,_,C){var z=fa();ml(y,_,C,z)}function ml(y,_,C,z){var N={lane:z,revertLane:0,action:C,hasEagerState:!1,eagerState:null,next:null};if(Ph(y))Gn(_,N);else{var q=y.alternate;if(y.lanes===0&&(q===null||q.lanes===0)&&(q=_.lastRenderedReducer,q!==null))try{var ye=_.lastRenderedState,Be=q(ye,C);if(N.hasEagerState=!0,N.eagerState=Be,ka(Be,ye))return Ue(y,_,N,0),Xr===null&&ce(),!1}catch{}finally{}if(C=ze(y,_,N,z),C!==null)return on(C,y,z),co(C,_,z),!0}return!1}function hu(y,_,C,z){if(z={lane:2,revertLane:He(),action:z,hasEagerState:!1,eagerState:null,next:null},Ph(y)){if(_)throw Error(n(479))}else _=ze(y,C,z,2),_!==null&&on(_,y,2)}function Ph(y){var _=y.alternate;return y===Fi||_!==null&&_===Fi}function Gn(y,_){Df=Bu=!0;var C=y.pending;C===null?_.next=_:(_.next=C.next,C.next=_),y.pending=_}function co(y,_,C){if((C&4194176)!==0){var z=_.lanes;z&=y.pendingLanes,C|=z,_.lanes=C,k(y,C)}}function Ba(y,_,C,z){_=y.memoizedState,C=C(z,_),C=C==null?_:jn({},_,C),y.memoizedState=C,y.lanes===0&&(y.updateQueue.baseState=C)}function du(y,_,C,z,N,q,ye){return y=y.stateNode,typeof y.shouldComponentUpdate=="function"?y.shouldComponentUpdate(z,q,ye):_.prototype&&_.prototype.isPureReactComponent?!Ee(C,z)||!Ee(N,q):!0}function Gp(y,_,C,z){y=_.state,typeof _.componentWillReceiveProps=="function"&&_.componentWillReceiveProps(C,z),typeof _.UNSAFE_componentWillReceiveProps=="function"&&_.UNSAFE_componentWillReceiveProps(C,z),_.state!==y&&dm.enqueueReplaceState(_,_.state,null)}function Fo(y,_){var C=_;if("ref"in _){C={};for(var z in _)z!=="ref"&&(C[z]=_[z])}if(y=y.defaultProps){C===_&&(C=jn({},C));for(var N in y)C[N]===void 0&&(C[N]=y[N])}return C}function gl(y,_){try{var C=y.onUncaughtError;C(_.value,{componentStack:_.stack})}catch(z){setTimeout(function(){throw z})}}function fu(y,_,C){try{var z=y.onCaughtError;z(C.value,{componentStack:C.stack,errorBoundary:_.tag===1?_.stateNode:null})}catch(N){setTimeout(function(){throw N})}}function vl(y,_,C){return C=ut(C),C.tag=3,C.payload={element:null},C.callback=function(){gl(y,_)},C}function uf(y){return y=ut(y),y.tag=3,y}function da(y,_,C,z){var N=C.type.getDerivedStateFromError;if(typeof N=="function"){var q=z.value;y.payload=function(){return N(q)},y.callback=function(){fu(_,C,z)}}var ye=C.stateNode;ye!==null&&typeof ye.componentDidCatch=="function"&&(y.callback=function(){fu(_,C,z),typeof N!="function"&&(Nc===null?Nc=new Set([this]):Nc.add(this));var Be=z.stack;this.componentDidCatch(z.value,{componentStack:Be!==null?Be:""})})}function Pb(y,_,C,z,N){if(C.flags|=32768,z!==null&&typeof z=="object"&&typeof z.then=="function"){if(_=C.alternate,_!==null&&Vg(_,C,N,!0),C=_o.current,C!==null){switch(C.tag){case 13:return Ml===null?_l():C.alternate===null&&En===0&&(En=3),C.flags&=-257,C.flags|=65536,C.lanes=N,z===Va?C.flags|=16384:(_=C.updateQueue,_===null?C.updateQueue=new Set([z]):_.add(z),Vh(y,z,N)),!1;case 22:return C.flags|=65536,z===Va?C.flags|=16384:(_=C.updateQueue,_===null?(_={transitions:null,markerInstances:null,retryQueue:new Set([z])},C.updateQueue=_):(C=_.retryQueue,C===null?_.retryQueue=new Set([z]):C.add(z)),Vh(y,z,N)),!1}throw Error(n(435,C.tag))}return Vh(y,z,N),_l(),!1}if(_r)return _=_o.current,_!==null?((_.flags&65536)===0&&(_.flags|=256),_.flags|=65536,_.lanes=N,z!==fv&&(y=Error(n(422),{cause:z}),Te(re(y,C)))):(z!==fv&&(_=Error(n(423),{cause:z}),Te(re(_,C))),y=y.current.alternate,y.flags|=65536,N&=-N,y.lanes|=N,z=re(z,C),N=vl(y.stateNode,z,N),St(y,N),En!==4&&(En=2)),!1;var q=Error(n(520),{cause:z});if(q=re(q,C),pm===null?pm=[q]:pm.push(q),En!==4&&(En=2),_===null)return!0;z=re(z,C),C=_;do{switch(C.tag){case 3:return C.flags|=65536,y=N&-N,C.lanes|=y,y=vl(C.stateNode,z,y),St(C,y),!1;case 1:if(_=C.type,q=C.stateNode,(C.flags&128)===0&&(typeof _.getDerivedStateFromError=="function"||q!==null&&typeof q.componentDidCatch=="function"&&(Nc===null||!Nc.has(q))))return C.flags|=65536,N&=-N,C.lanes|=N,N=uf(N),da(N,y,C,z),St(C,N),!1}C=C.return}while(C!==null);return!1}function Bn(y,_,C,z){_.child=y===null?zc(_,null,C,z):id(_,y.child,C,z)}function pu(y,_,C,z,N){C=C.render;var q=_.ref;if("ref"in z){var ye={};for(var Be in z)Be!=="ref"&&(ye[Be]=z[Be])}else ye=z;return Oh(_),z=oi(y,_,C,ye,q,N),Be=mi(),y!==null&&!hs?(Mi(y,_,N),mu(y,_,N)):(_r&&Be&&ee(_),_.flags|=1,Bn(y,_,z,N),_.child)}function Bg(y,_,C,z,N){if(y===null){var q=C.type;return typeof q=="function"&&!Mu(q)&&q.defaultProps===void 0&&C.compare===null?(_.tag=15,_.type=q,ry(y,_,q,z,N)):(y=xf(C.type,null,z,_,_.mode,N),y.ref=_.ref,y.return=_,_.child=y)}if(q=y.child,!zb(y,N)){var ye=q.memoizedProps;if(C=C.compare,C=C!==null?C:Ee,C(ye,z)&&y.ref===_.ref)return mu(y,_,N)}return _.flags|=1,y=Eu(q,z),y.ref=_.ref,y.return=_,_.child=y}function ry(y,_,C,z,N){if(y!==null){var q=y.memoizedProps;if(Ee(q,z)&&y.ref===_.ref)if(hs=!1,_.pendingProps=z=q,zb(y,N))(y.flags&131072)!==0&&(hs=!0);else return _.lanes=y.lanes,mu(y,_,N)}return ko(y,_,C,z,N)}function Xs(y,_,C){var z=_.pendingProps,N=z.children,q=(_.stateNode._pendingVisibility&2)!==0,ye=y!==null?y.memoizedState:null;if(as(y,_),z.mode==="hidden"||q){if((_.flags&128)!==0){if(z=ye!==null?ye.baseLanes|C:C,y!==null){for(N=_.child=y.child,q=0;N!==null;)q=q|N.lanes|N.childLanes,N=N.sibling;_.childLanes=q&~z}else _.childLanes=0,_.child=null;return uo(y,_,z,C)}if((C&536870912)!==0)_.memoizedState={baseLanes:0,cachePool:null},y!==null&&sy(_,ye!==null?ye.cachePool:null),ye!==null?Tr(_,ye):Dn(),_e(_);else return _.lanes=_.childLanes=536870912,uo(y,_,ye!==null?ye.baseLanes|C:C,C)}else ye!==null?(sy(_,ye.cachePool),Tr(_,ye),tt(),_.memoizedState=null):(y!==null&&sy(_,null),Dn(),tt());return Bn(y,_,N,C),_.child}function uo(y,_,C,z){var N=Bb();return N=N===null?null:{parent:tc?Fn._currentValue:Fn._currentValue2,pool:N},_.memoizedState={baseLanes:C,cachePool:N},y!==null&&sy(_,null),Dn(),_e(_),y!==null&&Vg(y,_,z,!0),null}function as(y,_){var C=_.ref;if(C===null)y!==null&&y.ref!==null&&(_.flags|=2097664);else{if(typeof C!="function"&&typeof C!="object")throw Error(n(284));(y===null||y.ref!==C)&&(_.flags|=2097664)}}function ko(y,_,C,z,N){return Oh(_),C=oi(y,_,C,z,void 0,N),z=mi(),y!==null&&!hs?(Mi(y,_,N),mu(y,_,N)):(_r&&z&&ee(_),_.flags|=1,Bn(y,_,C,N),_.child)}function Ng(y,_,C,z,N,q){return Oh(_),_.updateQueue=null,C=ri(_,z,C,N),gi(y),z=mi(),y!==null&&!hs?(Mi(y,_,q),mu(y,_,q)):(_r&&z&&ee(_),_.flags|=1,Bn(y,_,C,q),_.child)}function ZM(y,_,C,z,N){if(Oh(_),_.stateNode===null){var q=Af,ye=C.contextType;typeof ye=="object"&&ye!==null&&(q=Ys(ye)),q=new C(z,q),_.memoizedState=q.state!==null&&q.state!==void 0?q.state:null,q.updater=dm,_.stateNode=q,q._reactInternals=_,q=_.stateNode,q.props=z,q.state=_.memoizedState,q.refs={},Ke(_),ye=C.contextType,q.context=typeof ye=="object"&&ye!==null?Ys(ye):Af,q.state=_.memoizedState,ye=C.getDerivedStateFromProps,typeof ye=="function"&&(Ba(_,C,ye,z),q.state=_.memoizedState),typeof C.getDerivedStateFromProps=="function"||typeof q.getSnapshotBeforeUpdate=="function"||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(ye=q.state,typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount(),ye!==q.state&&dm.enqueueReplaceState(q,q.state,null),Kt(_,z,q,N),Pt(),q.state=_.memoizedState),typeof q.componentDidMount=="function"&&(_.flags|=4194308),z=!0}else if(y===null){q=_.stateNode;var Be=_.memoizedProps,st=Fo(C,Be);q.props=st;var Mt=q.context,Ut=C.contextType;ye=Af,typeof Ut=="object"&&Ut!==null&&(ye=Ys(Ut));var Xt=C.getDerivedStateFromProps;Ut=typeof Xt=="function"||typeof q.getSnapshotBeforeUpdate=="function",Be=_.pendingProps!==Be,Ut||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(Be||Mt!==ye)&&Gp(_,q,z,ye),va=!1;var zt=_.memoizedState;q.state=zt,Kt(_,z,q,N),Pt(),Mt=_.memoizedState,Be||zt!==Mt||va?(typeof Xt=="function"&&(Ba(_,C,Xt,z),Mt=_.memoizedState),(st=va||du(_,C,st,z,zt,Mt,ye))?(Ut||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount()),typeof q.componentDidMount=="function"&&(_.flags|=4194308)):(typeof q.componentDidMount=="function"&&(_.flags|=4194308),_.memoizedProps=z,_.memoizedState=Mt),q.props=z,q.state=Mt,q.context=ye,z=st):(typeof q.componentDidMount=="function"&&(_.flags|=4194308),z=!1)}else{q=_.stateNode,at(y,_),ye=_.memoizedProps,Ut=Fo(C,ye),q.props=Ut,Xt=_.pendingProps,zt=q.context,Mt=C.contextType,st=Af,typeof Mt=="object"&&Mt!==null&&(st=Ys(Mt)),Be=C.getDerivedStateFromProps,(Mt=typeof Be=="function"||typeof q.getSnapshotBeforeUpdate=="function")||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(ye!==Xt||zt!==st)&&Gp(_,q,z,st),va=!1,zt=_.memoizedState,q.state=zt,Kt(_,z,q,N),Pt();var Vi=_.memoizedState;ye!==Xt||zt!==Vi||va||y!==null&&y.dependencies!==null&&Hg(y.dependencies)?(typeof Be=="function"&&(Ba(_,C,Be,z),Vi=_.memoizedState),(Ut=va||du(_,C,Ut,z,zt,Vi,st)||y!==null&&y.dependencies!==null&&Hg(y.dependencies))?(Mt||typeof q.UNSAFE_componentWillUpdate!="function"&&typeof q.componentWillUpdate!="function"||(typeof q.componentWillUpdate=="function"&&q.componentWillUpdate(z,Vi,st),typeof q.UNSAFE_componentWillUpdate=="function"&&q.UNSAFE_componentWillUpdate(z,Vi,st)),typeof q.componentDidUpdate=="function"&&(_.flags|=4),typeof q.getSnapshotBeforeUpdate=="function"&&(_.flags|=1024)):(typeof q.componentDidUpdate!="function"||ye===y.memoizedProps&&zt===y.memoizedState||(_.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||ye===y.memoizedProps&&zt===y.memoizedState||(_.flags|=1024),_.memoizedProps=z,_.memoizedState=Vi),q.props=z,q.state=Vi,q.context=st,z=Ut):(typeof q.componentDidUpdate!="function"||ye===y.memoizedProps&&zt===y.memoizedState||(_.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||ye===y.memoizedProps&&zt===y.memoizedState||(_.flags|=1024),z=!1)}return q=z,as(y,_),z=(_.flags&128)!==0,q||z?(q=_.stateNode,C=z&&typeof C.getDerivedStateFromError!="function"?null:q.render(),_.flags|=1,y!==null&&z?(_.child=id(_,y.child,null,N),_.child=id(_,null,C,N)):Bn(y,_,C,N),_.memoizedState=q.state,y=_.child):y=mu(y,_,N),y}function KM(y,_,C,z){return ge(),_.flags|=256,Bn(y,_,C,z),_.child}function Rb(y){return{baseLanes:y,cachePool:Nb()}}function Fg(y,_,C){return y=y!==null?y.childLanes&~C:0,_&&(y|=Xo),y}function JM(y,_,C){var z=_.pendingProps,N=!1,q=(_.flags&128)!==0,ye;if((ye=q)||(ye=y!==null&&y.memoizedState===null?!1:(ln.current&2)!==0),ye&&(N=!0,_.flags&=-129),ye=(_.flags&32)!==0,_.flags&=-33,y===null){if(_r){if(N?Fr(_):tt(),_r){var Be=Wr,st;(st=Be)&&(Be=VE(Be,sc),Be!==null?(_.memoizedState={dehydrated:Be,treeContext:nc!==null?{id:Lc,overflow:Ic}:null,retryLane:536870912},st=i(18,null,null,0),st.stateNode=Be,st.return=_,_.child=st,Yn=_,Wr=null,st=!0):st=!1),st||fe(_)}if(Be=_.memoizedState,Be!==null&&(Be=Be.dehydrated,Be!==null))return cv(Be)?_.lanes=16:_.lanes=536870912,null;ct(_)}return Be=z.children,z=z.fallback,N?(tt(),N=_.mode,Be=Lb({mode:"hidden",children:Be},N),z=Hh(z,N,C,null),Be.return=_,z.return=_,Be.sibling=z,_.child=Be,N=_.child,N.memoizedState=Rb(C),N.childLanes=Fg(y,ye,C),_.memoizedState=gv,z):(Fr(_),Ob(_,Be))}if(st=y.memoizedState,st!==null&&(Be=st.dehydrated,Be!==null)){if(q)_.flags&256?(Fr(_),_.flags&=-257,_=ny(y,_,C)):_.memoizedState!==null?(tt(),_.child=y.child,_.flags|=128,_=null):(tt(),N=z.fallback,Be=_.mode,z=Lb({mode:"visible",children:z.children},Be),N=Hh(N,Be,C,null),N.flags|=2,z.return=_,N.return=_,z.sibling=N,_.child=z,id(_,y.child,null,C),z=_.child,z.memoizedState=Rb(C),z.childLanes=Fg(y,ye,C),_.memoizedState=gv,_=N);else if(Fr(_),cv(Be))ye=Ay(Be).digest,z=Error(n(419)),z.stack="",z.digest=ye,Te({value:z,source:null,stack:null}),_=ny(y,_,C);else if(hs||Vg(y,_,C,!1),ye=(C&y.childLanes)!==0,hs||ye){if(ye=Xr,ye!==null){if(z=C&-C,(z&42)!==0)z=1;else switch(z){case 2:z=1;break;case 8:z=4;break;case 32:z=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:z=64;break;case 268435456:z=134217728;break;default:z=0}if(z=(z&(ye.suspendedLanes|C))!==0?0:z,z!==0&&z!==st.retryLane)throw st.retryLane=z,Xe(y,z),on(ye,y,z),w_}wf(Be)||_l(),_=ny(y,_,C)}else wf(Be)?(_.flags|=128,_.child=y.child,_=nv.bind(null,y),NE(Be,_),_=null):(y=st.treeContext,yo&&(Wr=l_(Be),Yn=_,_r=!0,wl=null,sc=!1,y!==null&&(xo[ga++]=Lc,xo[ga++]=Ic,xo[ga++]=nc,Lc=y.id,Ic=y.overflow,nc=_)),_=Ob(_,z.children),_.flags|=4096);return _}return N?(tt(),N=z.fallback,Be=_.mode,st=y.child,q=st.sibling,z=Eu(st,{mode:"hidden",children:z.children}),z.subtreeFlags=st.subtreeFlags&31457280,q!==null?N=Eu(q,N):(N=Hh(N,Be,C,null),N.flags|=2),N.return=_,z.return=_,z.sibling=N,_.child=z,z=N,N=_.child,Be=y.child.memoizedState,Be===null?Be=Rb(C):(st=Be.cachePool,st!==null?(q=tc?Fn._currentValue:Fn._currentValue2,st=st.parent!==q?{parent:q,pool:q}:st):st=Nb(),Be={baseLanes:Be.baseLanes|C,cachePool:st}),N.memoizedState=Be,N.childLanes=Fg(y,ye,C),_.memoizedState=gv,z):(Fr(_),C=y.child,y=C.sibling,C=Eu(C,{mode:"visible",children:z.children}),C.return=_,C.sibling=null,y!==null&&(ye=_.deletions,ye===null?(_.deletions=[y],_.flags|=16):ye.push(y)),_.child=C,_.memoizedState=null,C)}function Ob(y,_){return _=Lb({mode:"visible",children:_},y.mode),_.return=y,y.child=_}function Lb(y,_){return vy(y,_,0,null)}function ny(y,_,C){return id(_,y.child,null,C),y=Ob(_,_.pendingProps.children),y.flags|=2,_.memoizedState=null,y}function $M(y,_,C){y.lanes|=_;var z=y.alternate;z!==null&&(z.lanes|=_),kg(y.return,_,C)}function Ib(y,_,C,z,N){var q=y.memoizedState;q===null?y.memoizedState={isBackwards:_,rendering:null,renderingStartTime:0,last:z,tail:C,tailMode:N}:(q.isBackwards=_,q.rendering=null,q.renderingStartTime=0,q.last=z,q.tail=C,q.tailMode=N)}function eE(y,_,C){var z=_.pendingProps,N=z.revealOrder,q=z.tail;if(Bn(y,_,z.children,C),z=ln.current,(z&2)!==0)z=z&1|2,_.flags|=128;else{if(y!==null&&(y.flags&128)!==0)e:for(y=_.child;y!==null;){if(y.tag===13)y.memoizedState!==null&&$M(y,C,_);else if(y.tag===19)$M(y,C,_);else if(y.child!==null){y.child.return=y,y=y.child;continue}if(y===_)break e;for(;y.sibling===null;){if(y.return===null||y.return===_)break e;y=y.return}y.sibling.return=y.return,y=y.sibling}z&=1}switch(w(ln,z),N){case"forwards":for(C=_.child,N=null;C!==null;)y=C.alternate,y!==null&&qe(y)===null&&(N=C),C=C.sibling;C=N,C===null?(N=_.child,_.child=null):(N=C.sibling,C.sibling=null),Ib(_,!1,N,C,q);break;case"backwards":for(C=null,N=_.child,_.child=null;N!==null;){if(y=N.alternate,y!==null&&qe(y)===null){_.child=N;break}y=N.sibling,N.sibling=C,C=N,N=y}Ib(_,!0,C,null,q);break;case"together":Ib(_,!1,null,null,void 0);break;default:_.memoizedState=null}return _.child}function mu(y,_,C){if(y!==null&&(_.dependencies=y.dependencies),Dl|=_.lanes,(C&_.childLanes)===0)if(y!==null){if(Vg(y,_,C,!1),(C&_.childLanes)===0)return null}else return null;if(y!==null&&_.child!==y.child)throw Error(n(153));if(_.child!==null){for(y=_.child,C=Eu(y,y.pendingProps),_.child=C,C.return=_;y.sibling!==null;)y=y.sibling,C=C.sibling=Eu(y,y.pendingProps),C.return=_;C.sibling=null}return _.child}function zb(y,_){return(y.lanes&_)!==0?!0:(y=y.dependencies,!!(y!==null&&Hg(y)))}function ZP(y,_,C){switch(_.tag){case 3:Q(_,_.stateNode.containerInfo),Rh(_,Fn,y.memoizedState.cache),ge();break;case 27:case 5:ne(_);break;case 4:Q(_,_.stateNode.containerInfo);break;case 10:Rh(_,_.type,_.memoizedProps.value);break;case 13:var z=_.memoizedState;if(z!==null)return z.dehydrated!==null?(Fr(_),_.flags|=128,null):(C&_.child.childLanes)!==0?JM(y,_,C):(Fr(_),y=mu(y,_,C),y!==null?y.sibling:null);Fr(_);break;case 19:var N=(y.flags&128)!==0;if(z=(C&_.childLanes)!==0,z||(Vg(y,_,C,!1),z=(C&_.childLanes)!==0),N){if(z)return eE(y,_,C);_.flags|=128}if(N=_.memoizedState,N!==null&&(N.rendering=null,N.tail=null,N.lastEffect=null),w(ln,ln.current),z)break;return null;case 22:case 23:return _.lanes=0,Xs(y,_,C);case 24:Rh(_,Fn,y.memoizedState.cache)}return mu(y,_,C)}function tE(y,_,C){if(y!==null)if(y.memoizedProps!==_.pendingProps)hs=!0;else{if(!zb(y,C)&&(_.flags&128)===0)return hs=!1,ZP(y,_,C);hs=(y.flags&131072)!==0}else hs=!1,_r&&(_.flags&1048576)!==0&&j(_,lm,_.index);switch(_.lanes=0,_.tag){case 16:e:{y=_.pendingProps;var z=_.elementType,N=z._init;if(z=N(z._payload),_.type=z,typeof z=="function")Mu(z)?(y=Fo(z,y),_.tag=1,_=ZM(null,_,z,y,C)):(_.tag=0,_=ko(null,_,z,y,C));else{if(z!=null){if(N=z.$$typeof,N===yy){_.tag=11,_=pu(null,_,z,y,C);break e}else if(N===$p){_.tag=14,_=Bg(null,_,z,y,C);break e}}throw _=a(z)||z,Error(n(306,_,""))}}return _;case 0:return ko(y,_,_.type,_.pendingProps,C);case 1:return z=_.type,N=Fo(z,_.pendingProps),ZM(y,_,z,N,C);case 3:e:{if(Q(_,_.stateNode.containerInfo),y===null)throw Error(n(387));var q=_.pendingProps;N=_.memoizedState,z=N.element,at(y,_),Kt(_,q,null,C);var ye=_.memoizedState;if(q=ye.cache,Rh(_,Fn,q),q!==N.cache&&hf(_,[Fn],C,!0),Pt(),q=ye.element,yo&&N.isDehydrated)if(N={element:q,isDehydrated:!1,cache:ye.cache},_.updateQueue.baseState=N,_.memoizedState=N,_.flags&256){_=KM(y,_,q,C);break e}else if(q!==z){z=re(Error(n(424)),_),Te(z),_=KM(y,_,q,C);break e}else for(yo&&(Wr=Mf(_.stateNode.containerInfo),Yn=_,_r=!0,wl=null,sc=!0),C=zc(_,null,q,C),_.child=C;C;)C.flags=C.flags&-3|4096,C=C.sibling;else{if(ge(),q===z){_=mu(y,_,C);break e}Bn(y,_,q,C)}_=_.child}return _;case 26:if(Go)return as(y,_),y===null?(C=d_(_.type,null,_.pendingProps,null))?_.memoizedState=C:_r||(_.stateNode=g_(_.type,_.pendingProps,Iu.current,_)):_.memoizedState=d_(_.type,y.memoizedProps,_.pendingProps,y.memoizedState),null;case 27:if(zs)return ne(_),y===null&&zs&&_r&&(z=_.stateNode=Dy(_.type,_.pendingProps,Iu.current,Xn.current,!1),Yn=_,sc=!0,Wr=Ou(z)),z=_.pendingProps.children,y!==null||_r?Bn(y,_,z,C):_.child=id(_,null,z,C),as(y,_),_.child;case 5:return y===null&&_r&&(qE(_.type,_.pendingProps,Xn.current),(N=z=Wr)&&(z=c_(z,_.type,_.pendingProps,sc),z!==null?(_.stateNode=z,Yn=_,Wr=Ou(z),sc=!1,N=!0):N=!1),N||fe(_)),ne(_),N=_.type,q=_.pendingProps,ye=y!==null?y.memoizedProps:null,z=q.children,Zs(N,q)?z=null:ye!==null&&Zs(N,ye)&&(_.flags|=32),_.memoizedState!==null&&(N=oi(y,_,Wi,null,null,C),tc?Ru._currentValue=N:Ru._currentValue2=N),as(y,_),Bn(y,_,z,C),_.child;case 6:return y===null&&_r&&(sR(_.pendingProps,Xn.current),(y=C=Wr)&&(C=kE(C,_.pendingProps,sc),C!==null?(_.stateNode=C,Yn=_,Wr=null,y=!0):y=!1),y||fe(_)),null;case 13:return JM(y,_,C);case 4:return Q(_,_.stateNode.containerInfo),z=_.pendingProps,y===null?_.child=id(_,null,z,C):Bn(y,_,z,C),_.child;case 11:return pu(y,_,_.type,_.pendingProps,C);case 7:return Bn(y,_,_.pendingProps,C),_.child;case 8:return Bn(y,_,_.pendingProps.children,C),_.child;case 12:return Bn(y,_,_.pendingProps.children,C),_.child;case 10:return z=_.pendingProps,Rh(_,_.type,z.value),Bn(y,_,z.children,C),_.child;case 9:return N=_.type._context,z=_.pendingProps.children,Oh(_),N=Ys(N),z=z(N),_.flags|=1,Bn(y,_,z,C),_.child;case 14:return Bg(y,_,_.type,_.pendingProps,C);case 15:return ry(y,_,_.type,_.pendingProps,C);case 19:return eE(y,_,C);case 22:return Xs(y,_,C);case 24:return Oh(_),z=Ys(Fn),y===null?(N=Bb(),N===null&&(N=Xr,q=Lh(),N.pooledCache=q,q.refCount++,q!==null&&(N.pooledCacheLanes|=C),N=q),_.memoizedState={parent:z,cache:N},Ke(_),Rh(_,Fn,N)):((y.lanes&C)!==0&&(at(y,_),Kt(_,null,null,C),Pt()),N=y.memoizedState,q=_.memoizedState,N.parent!==z?(N={parent:z,cache:z},_.memoizedState=N,_.lanes===0&&(_.memoizedState=_.updateQueue.baseState=N),Rh(_,Fn,z)):(z=q.cache,Rh(_,Fn,z),z!==N.cache&&hf(_,[Fn],C,!0))),Bn(y,_,_.pendingProps.children,C),_.child;case 29:throw _.pendingProps}throw Error(n(156,_.tag))}function Rh(y,_,C){tc?(w(El,_._currentValue),_._currentValue=C):(w(El,_._currentValue2),_._currentValue2=C)}function gu(y){var _=El.current;tc?y._currentValue=_:y._currentValue2=_,b(El)}function kg(y,_,C){for(;y!==null;){var z=y.alternate;if((y.childLanes&_)!==_?(y.childLanes|=_,z!==null&&(z.childLanes|=_)):z!==null&&(z.childLanes&_)!==_&&(z.childLanes|=_),y===C)break;y=y.return}}function hf(y,_,C,z){var N=y.child;for(N!==null&&(N.return=y);N!==null;){var q=N.dependencies;if(q!==null){var ye=N.child;q=q.firstContext;e:for(;q!==null;){var Be=q;q=N;for(var st=0;st<_.length;st++)if(Be.context===_[st]){q.lanes|=C,Be=q.alternate,Be!==null&&(Be.lanes|=C),kg(q.return,C,y),z||(ye=null);break e}q=Be.next}}else if(N.tag===18){if(ye=N.return,ye===null)throw Error(n(341));ye.lanes|=C,q=ye.alternate,q!==null&&(q.lanes|=C),kg(ye,C,y),ye=null}else ye=N.child;if(ye!==null)ye.return=N;else for(ye=N;ye!==null;){if(ye===y){ye=null;break}if(N=ye.sibling,N!==null){N.return=ye.return,ye=N;break}ye=ye.return}N=ye}}function Vg(y,_,C,z){y=null;for(var N=_,q=!1;N!==null;){if(!q){if((N.flags&524288)!==0)q=!0;else if((N.flags&262144)!==0)break}if(N.tag===10){var ye=N.alternate;if(ye===null)throw Error(n(387));if(ye=ye.memoizedProps,ye!==null){var Be=N.type;ka(N.pendingProps.value,ye.value)||(y!==null?y.push(Be):y=[Be])}}else if(N===dv.current){if(ye=N.alternate,ye===null)throw Error(n(387));ye.memoizedState.memoizedState!==N.memoizedState.memoizedState&&(y!==null?y.push(Ru):y=[Ru])}N=N.return}y!==null&&hf(_,y,C,z),_.flags|=262144}function Hg(y){for(y=y.firstContext;y!==null;){var _=y.context;if(!ka(tc?_._currentValue:_._currentValue2,y.memoizedValue))return!0;y=y.next}return!1}function Oh(y){od=y,Al=null,y=y.dependencies,y!==null&&(y.firstContext=null)}function Ys(y){return Ub(od,y)}function Gg(y,_){return od===null&&Oh(y),Ub(y,_)}function Ub(y,_){var C=tc?_._currentValue:_._currentValue2;if(_={context:_,memoizedValue:C,next:null},Al===null){if(y===null)throw Error(n(308));Al=_,y.dependencies={lanes:0,firstContext:_},y.flags|=524288}else Al=Al.next=_;return C}function Lh(){return{controller:new vv,data:new Map,refCount:0}}function jg(y){y.refCount--,y.refCount===0&&Ln(oR,function(){y.controller.abort()})}function Bb(){var y=Pf.current;return y!==null?y:Xr.pooledCache}function sy(y,_){_===null?w(Pf,Pf.current):w(Pf,_.pool)}function Nb(){var y=Bb();return y===null?null:{parent:tc?Fn._currentValue:Fn._currentValue2,pool:y}}function ho(y){y.flags|=4}function jp(y,_){if(y!==null&&y.child===_.child)return!1;if((_.flags&16)!==0)return!0;for(y=_.child;y!==null;){if((y.flags&13878)!==0||(y.subtreeFlags&13878)!==0)return!0;y=y.sibling}return!1}function df(y,_,C,z){if(wn)for(C=_.child;C!==null;){if(C.tag===5||C.tag===6)ov(y,C.stateNode);else if(!(C.tag===4||zs&&C.tag===27)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===_)break;for(;C.sibling===null;){if(C.return===null||C.return===_)return;C=C.return}C.sibling.return=C.return,C=C.sibling}else if(ic)for(var N=_.child;N!==null;){if(N.tag===5){var q=N.stateNode;C&&z&&(q=BE(q,N.type,N.memoizedProps)),ov(y,q)}else if(N.tag===6)q=N.stateNode,C&&z&&(q=o_(q,N.memoizedProps)),ov(y,q);else if(N.tag!==4){if(N.tag===22&&N.memoizedState!==null)q=N.child,q!==null&&(q.return=N),df(y,N,!0,!0);else if(N.child!==null){N.child.return=N,N=N.child;continue}}if(N===_)break;for(;N.sibling===null;){if(N.return===null||N.return===_)return;N=N.return}N.sibling.return=N.return,N=N.sibling}}function iE(y,_,C,z){if(ic)for(var N=_.child;N!==null;){if(N.tag===5){var q=N.stateNode;C&&z&&(q=BE(q,N.type,N.memoizedProps)),a_(y,q)}else if(N.tag===6)q=N.stateNode,C&&z&&(q=o_(q,N.memoizedProps)),a_(y,q);else if(N.tag!==4){if(N.tag===22&&N.memoizedState!==null)q=N.child,q!==null&&(q.return=N),iE(y,N,!(N.memoizedProps!==null&&N.memoizedProps.mode==="manual"),!0);else if(N.child!==null){N.child.return=N,N=N.child;continue}}if(N===_)break;for(;N.sibling===null;){if(N.return===null||N.return===_)return;N=N.return}N.sibling.return=N.return,N=N.sibling}}function Wg(y,_){if(ic&&jp(y,_)){y=_.stateNode;var C=y.containerInfo,z=Ey();iE(z,_,!1,!1),y.pendingChildren=z,ho(_),zE(C,z)}}function ay(y,_,C,z){if(wn)y.memoizedProps!==z&&ho(_);else if(ic){var N=y.stateNode,q=y.memoizedProps;if((y=jp(y,_))||q!==z){var ye=Xn.current;q=IE(N,C,q,z,!y,null),q===N?_.stateNode=N:(xy(q,C,z,ye)&&ho(_),_.stateNode=q,y?df(q,_,!1,!1):ho(_))}else _.stateNode=N}}function oy(y,_,C){if(e_(_,C)){if(y.flags|=16777216,!t_(_,C))if(Is())y.flags|=8192;else throw ya=Va,mv}else y.flags&=-16777217}function ly(y,_){if(QE(_)){if(y.flags|=16777216,!v_(_))if(Is())y.flags|=8192;else throw ya=Va,mv}else y.flags&=-16777217}function Wp(y,_){_!==null&&(y.flags|=4),y.flags&16384&&(_=y.tag!==22?R():536870912,y.lanes|=_,fs|=_)}function qp(y,_){if(!_r)switch(y.tailMode){case"hidden":_=y.tail;for(var C=null;_!==null;)_.alternate!==null&&(C=_),_=_.sibling;C===null?y.tail=null:C.sibling=null;break;case"collapsed":C=y.tail;for(var z=null;C!==null;)C.alternate!==null&&(z=C),C=C.sibling;z===null?_||y.tail===null?y.tail=null:y.tail.sibling=null:z.sibling=null}}function Sn(y){var _=y.alternate!==null&&y.alternate.child===y.child,C=0,z=0;if(_)for(var N=y.child;N!==null;)C|=N.lanes|N.childLanes,z|=N.subtreeFlags&31457280,z|=N.flags&31457280,N.return=y,N=N.sibling;else for(N=y.child;N!==null;)C|=N.lanes|N.childLanes,z|=N.subtreeFlags,z|=N.flags,N.return=y,N=N.sibling;return y.subtreeFlags|=z,y.childLanes=C,_}function rE(y,_,C){var z=_.pendingProps;switch(oe(_),_.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Sn(_),null;case 1:return Sn(_),null;case 3:return C=_.stateNode,z=null,y!==null&&(z=y.memoizedState.cache),_.memoizedState.cache!==z&&(_.flags|=2048),gu(Fn),ae(),C.pendingContext&&(C.context=C.pendingContext,C.pendingContext=null),(y===null||y.child===null)&&(Ce(_)?ho(_):y===null||y.memoizedState.isDehydrated&&(_.flags&256)===0||(_.flags|=1024,wl!==null&&(Su(wl),wl=null))),Wg(y,_),Sn(_),null;case 26:if(Go){C=_.type;var N=_.memoizedState;return y===null?(ho(_),N!==null?(Sn(_),ly(_,N)):(Sn(_),oy(_,C,z))):N?N!==y.memoizedState?(ho(_),Sn(_),ly(_,N)):(Sn(_),_.flags&=-16777217):(wn?y.memoizedProps!==z&&ho(_):ay(y,_,C,z),Sn(_),oy(_,C,z)),null}case 27:if(zs){if(ue(_),C=Iu.current,N=_.type,y!==null&&_.stateNode!=null)wn?y.memoizedProps!==z&&ho(_):ay(y,_,N,z);else{if(!z){if(_.stateNode===null)throw Error(n(166));return Sn(_),null}y=Xn.current,Ce(_)?xe(_,y):(y=Dy(N,z,C,y,!0),_.stateNode=y,ho(_))}return Sn(_),null}case 5:if(ue(_),C=_.type,y!==null&&_.stateNode!=null)ay(y,_,C,z);else{if(!z){if(_.stateNode===null)throw Error(n(166));return Sn(_),null}y=Xn.current,Ce(_)?xe(_,y):(N=$b(C,z,Iu.current,y,_),df(N,_,!1,!1),_.stateNode=N,xy(N,C,z,y)&&ho(_))}return Sn(_),oy(_,_.type,_.pendingProps),null;case 6:if(y&&_.stateNode!=null)C=y.memoizedProps,wn?C!==z&&ho(_):ic&&(C!==z?(_.stateNode=Wn(z,Iu.current,Xn.current,_),ho(_)):_.stateNode=y.stateNode);else{if(typeof z!="string"&&_.stateNode===null)throw Error(n(166));if(y=Iu.current,C=Xn.current,Ce(_)){if(!yo)throw Error(n(176));if(y=_.stateNode,C=_.memoizedProps,z=null,N=Yn,N!==null)switch(N.tag){case 27:case 5:z=N.memoizedProps}Ty(y,C,_,z)||fe(_)}else _.stateNode=Wn(z,y,C,_)}return Sn(_),null;case 13:if(z=_.memoizedState,y===null||y.memoizedState!==null&&y.memoizedState.dehydrated!==null){if(N=Ce(_),z!==null&&z.dehydrated!==null){if(y===null){if(!N)throw Error(n(318));if(!yo)throw Error(n(344));if(N=_.memoizedState,N=N!==null?N.dehydrated:null,!N)throw Error(n(317));HE(N,_)}else ge(),(_.flags&128)===0&&(_.memoizedState=null),_.flags|=4;Sn(_),N=!1}else wl!==null&&(Su(wl),wl=null),N=!0;if(!N)return _.flags&256?(ct(_),_):(ct(_),null)}if(ct(_),(_.flags&128)!==0)return _.lanes=C,_;if(C=z!==null,y=y!==null&&y.memoizedState!==null,C){z=_.child,N=null,z.alternate!==null&&z.alternate.memoizedState!==null&&z.alternate.memoizedState.cachePool!==null&&(N=z.alternate.memoizedState.cachePool.pool);var q=null;z.memoizedState!==null&&z.memoizedState.cachePool!==null&&(q=z.memoizedState.cachePool.pool),q!==N&&(z.flags|=2048)}return C!==y&&C&&(_.child.flags|=8192),Wp(_,_.updateQueue),Sn(_),null;case 4:return ae(),Wg(y,_),y===null&&fE(_.stateNode.containerInfo),Sn(_),null;case 10:return gu(_.type),Sn(_),null;case 19:if(b(ln),N=_.memoizedState,N===null)return Sn(_),null;if(z=(_.flags&128)!==0,q=N.rendering,q===null)if(z)qp(N,!1);else{if(En!==0||y!==null&&(y.flags&128)!==0)for(y=_.child;y!==null;){if(q=qe(y),q!==null){for(_.flags|=128,qp(N,!1),y=q.updateQueue,_.updateQueue=y,Wp(_,y),_.subtreeFlags=0,y=C,C=_.child;C!==null;)yf(C,y),C=C.sibling;return w(ln,ln.current&1|2),_.child}y=y.sibling}N.tail!==null&&jo()>Yo&&(_.flags|=128,z=!0,qp(N,!1),_.lanes=4194304)}else{if(!z)if(y=qe(q),y!==null){if(_.flags|=128,z=!0,y=y.updateQueue,_.updateQueue=y,Wp(_,y),qp(N,!0),N.tail===null&&N.tailMode==="hidden"&&!q.alternate&&!_r)return Sn(_),null}else 2*jo()-N.renderingStartTime>Yo&&C!==536870912&&(_.flags|=128,z=!0,qp(N,!1),_.lanes=4194304);N.isBackwards?(q.sibling=_.child,_.child=q):(y=N.last,y!==null?y.sibling=q:_.child=q,N.last=q)}return N.tail!==null?(_=N.tail,N.rendering=_,N.tail=_.sibling,N.renderingStartTime=jo(),_.sibling=null,y=ln.current,w(ln,z?y&1|2:y&1),_):(Sn(_),null);case 22:case 23:return ct(_),pn(),z=_.memoizedState!==null,y!==null?y.memoizedState!==null!==z&&(_.flags|=8192):z&&(_.flags|=8192),z?(C&536870912)!==0&&(_.flags&128)===0&&(Sn(_),_.subtreeFlags&6&&(_.flags|=8192)):Sn(_),C=_.updateQueue,C!==null&&Wp(_,C.retryQueue),C=null,y!==null&&y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(C=y.memoizedState.cachePool.pool),z=null,_.memoizedState!==null&&_.memoizedState.cachePool!==null&&(z=_.memoizedState.cachePool.pool),z!==C&&(_.flags|=2048),y!==null&&b(Pf),null;case 24:return C=null,y!==null&&(C=y.memoizedState.cache),_.memoizedState.cache!==C&&(_.flags|=2048),gu(Fn),Sn(_),null;case 25:return null}throw Error(n(156,_.tag))}function KP(y,_){switch(oe(_),_.tag){case 1:return y=_.flags,y&65536?(_.flags=y&-65537|128,_):null;case 3:return gu(Fn),ae(),y=_.flags,(y&65536)!==0&&(y&128)===0?(_.flags=y&-65537|128,_):null;case 26:case 27:case 5:return ue(_),null;case 13:if(ct(_),y=_.memoizedState,y!==null&&y.dehydrated!==null){if(_.alternate===null)throw Error(n(340));ge()}return y=_.flags,y&65536?(_.flags=y&-65537|128,_):null;case 19:return b(ln),null;case 4:return ae(),null;case 10:return gu(_.type),null;case 22:case 23:return ct(_),pn(),y!==null&&b(Pf),y=_.flags,y&65536?(_.flags=y&-65537|128,_):null;case 24:return gu(Fn),null;case 25:return null;default:return null}}function nE(y,_){switch(oe(_),_.tag){case 3:gu(Fn),ae();break;case 26:case 27:case 5:ue(_);break;case 4:ae();break;case 13:ct(_);break;case 19:b(ln);break;case 10:gu(_.type);break;case 22:case 23:ct(_),pn(),y!==null&&b(Pf);break;case 24:gu(Fn)}}function qg(y,_){try{var C=_.updateQueue,z=C!==null?C.lastEffect:null;if(z!==null){var N=z.next;C=N;do{if((C.tag&y)===y){z=void 0;var q=C.create,ye=C.inst;z=q(),ye.destroy=z}C=C.next}while(C!==N)}}catch(Be){Ur(_,_.return,Be)}}function Ih(y,_,C){try{var z=_.updateQueue,N=z!==null?z.lastEffect:null;if(N!==null){var q=N.next;z=q;do{if((z.tag&y)===y){var ye=z.inst,Be=ye.destroy;if(Be!==void 0){ye.destroy=void 0,N=_;var st=C;try{Be()}catch(Mt){Ur(N,st,Mt)}}}z=z.next}while(z!==q)}}catch(Mt){Ur(_,_.return,Mt)}}function sE(y){var _=y.updateQueue;if(_!==null){var C=y.stateNode;try{Re(_,C)}catch(z){Ur(y,y.return,z)}}}function fo(y,_,C){C.props=Fo(y.type,y.memoizedProps),C.state=y.memoizedState;try{C.componentWillUnmount()}catch(z){Ur(y,_,z)}}function ec(y,_){try{var C=y.ref;if(C!==null){var z=y.stateNode;switch(y.tag){case 26:case 27:case 5:var N=_f(z);break;default:N=z}typeof C=="function"?y.refCleanup=C(N):C.current=N}}catch(q){Ur(y,_,q)}}function po(y,_){var C=y.ref,z=y.refCleanup;if(C!==null)if(typeof z=="function")try{z()}catch(N){Ur(y,_,N)}finally{y.refCleanup=null,y=y.alternate,y!=null&&(y.refCleanup=null)}else if(typeof C=="function")try{C(null)}catch(N){Ur(y,_,N)}else C.current=null}function Fb(y){var _=y.type,C=y.memoizedProps,z=y.stateNode;try{AE(z,_,C,y)}catch(N){Ur(y,y.return,N)}}function kb(y,_,C){try{TE(y.stateNode,y.type,C,_,y)}catch(z){Ur(y,y.return,z)}}function Vb(y){return y.tag===5||y.tag===3||(Go?y.tag===26:!1)||(zs?y.tag===27:!1)||y.tag===4}function Xg(y){e:for(;;){for(;y.sibling===null;){if(y.return===null||Vb(y.return))return null;y=y.return}for(y.sibling.return=y.return,y=y.sibling;y.tag!==5&&y.tag!==6&&(!zs||y.tag!==27)&&y.tag!==18;){if(y.flags&2||y.child===null||y.tag===4)continue e;y.child.return=y,y=y.child}if(!(y.flags&2))return y.stateNode}}function Hb(y,_,C){var z=y.tag;if(z===5||z===6)y=y.stateNode,_?n_(C,y,_):r_(C,y);else if(!(z===4||zs&&z===27)&&(y=y.child,y!==null))for(Hb(y,_,C),y=y.sibling;y!==null;)Hb(y,_,C),y=y.sibling}function cy(y,_,C){var z=y.tag;if(z===5||z===6)y=y.stateNode,_?CE(C,y,_):ME(C,y);else if(!(z===4||zs&&z===27)&&(y=y.child,y!==null))for(cy(y,_,C),y=y.sibling;y!==null;)cy(y,_,C),y=y.sibling}function ff(y,_,C){y=y.containerInfo;try{UE(y,C)}catch(z){Ur(_,_.return,z)}}function Gb(y,_){for(dE(y.containerInfo),Ei=_;Ei!==null;)if(y=Ei,_=y.child,(y.subtreeFlags&1028)!==0&&_!==null)_.return=y,Ei=_;else for(;Ei!==null;){y=Ei;var C=y.alternate;switch(_=y.flags,y.tag){case 0:break;case 11:case 15:break;case 1:if((_&1024)!==0&&C!==null){_=void 0;var z=y,N=C.memoizedProps;C=C.memoizedState;var q=z.stateNode;try{var ye=Fo(z.type,N,z.elementType===z.type);_=q.getSnapshotBeforeUpdate(ye,C),q.__reactInternalSnapshotBeforeUpdate=_}catch(Be){Ur(z,z.return,Be)}}break;case 3:(_&1024)!==0&&wn&&LE(y.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((_&1024)!==0)throw Error(n(163))}if(_=y.sibling,_!==null){_.return=y.return,Ei=_;break}Ei=y.return}return ye=Jr,Jr=!1,ye}function Xp(y,_,C){var z=C.flags;switch(C.tag){case 0:case 11:case 15:yu(y,C),z&4&&qg(5,C);break;case 1:if(yu(y,C),z&4)if(y=C.stateNode,_===null)try{y.componentDidMount()}catch(Be){Ur(C,C.return,Be)}else{var N=Fo(C.type,_.memoizedProps);_=_.memoizedState;try{y.componentDidUpdate(N,_,y.__reactInternalSnapshotBeforeUpdate)}catch(Be){Ur(C,C.return,Be)}}z&64&&sE(C),z&512&&ec(C,C.return);break;case 3:if(yu(y,C),z&64&&(z=C.updateQueue,z!==null)){if(y=null,C.child!==null)switch(C.child.tag){case 27:case 5:y=_f(C.child.stateNode);break;case 1:y=C.child.stateNode}try{Re(z,y)}catch(Be){Ur(C,C.return,Be)}}break;case 26:if(Go){yu(y,C),z&512&&ec(C,C.return);break}case 27:case 5:yu(y,C),_===null&&z&4&&Fb(C),z&512&&ec(C,C.return);break;case 12:yu(y,C);break;case 13:yu(y,C),z&4&&pf(y,C);break;case 22:if(N=C.memoizedState!==null||ku,!N){_=_!==null&&_.memoizedState!==null||ki;var q=ku,ye=ki;ku=N,(ki=_)&&!ye?zh(y,C,(C.subtreeFlags&8772)!==0):yu(y,C),ku=q,ki=ye}z&512&&(C.memoizedProps.mode==="manual"?ec(C,C.return):po(C,C.return));break;default:yu(y,C)}}function uy(y){var _=y.alternate;_!==null&&(y.alternate=null,uy(_)),y.child=null,y.deletions=null,y.sibling=null,y.tag===5&&(_=y.stateNode,_!==null&&gE(_)),y.stateNode=null,y.return=null,y.dependencies=null,y.memoizedProps=null,y.memoizedState=null,y.pendingProps=null,y.stateNode=null,y.updateQueue=null}function yl(y,_,C){for(C=C.child;C!==null;)vu(y,_,C),C=C.sibling}function vu(y,_,C){if(us&&typeof us.onCommitFiberUnmount=="function")try{us.onCommitFiberUnmount(om,C)}catch{}switch(C.tag){case 26:if(Go){ki||po(C,_),yl(y,_,C),C.memoizedState?p_(C.memoizedState):C.stateNode&&nm(C.stateNode);break}case 27:if(zs){ki||po(C,_);var z=Dr,N=Kn;Dr=C.stateNode,yl(y,_,C),b_(C.stateNode),Dr=z,Kn=N;break}case 5:ki||po(C,_);case 6:if(wn){if(z=Dr,N=Kn,Dr=null,yl(y,_,C),Dr=z,Kn=N,Dr!==null)if(Kn)try{PE(Dr,C.stateNode)}catch(q){Ur(C,_,q)}else try{DE(Dr,C.stateNode)}catch(q){Ur(C,_,q)}}else yl(y,_,C);break;case 18:wn&&Dr!==null&&(Kn?u_(Dr,C.stateNode):WE(Dr,C.stateNode));break;case 4:wn?(z=Dr,N=Kn,Dr=C.stateNode.containerInfo,Kn=!0,yl(y,_,C),Dr=z,Kn=N):(ic&&ff(C.stateNode,C,Ey()),yl(y,_,C));break;case 0:case 11:case 14:case 15:ki||Ih(2,C,_),ki||Ih(4,C,_),yl(y,_,C);break;case 1:ki||(po(C,_),z=C.stateNode,typeof z.componentWillUnmount=="function"&&fo(C,_,z)),yl(y,_,C);break;case 21:yl(y,_,C);break;case 22:ki||po(C,_),ki=(z=ki)||C.memoizedState!==null,yl(y,_,C),ki=z;break;default:yl(y,_,C)}}function pf(y,_){if(yo&&_.memoizedState===null&&(y=_.alternate,y!==null&&(y=y.memoizedState,y!==null&&(y=y.dehydrated,y!==null))))try{Cy(y)}catch(C){Ur(_,_.return,C)}}function jb(y){switch(y.tag){case 13:case 19:var _=y.stateNode;return _===null&&(_=y.stateNode=new ar),_;case 22:return y=y.stateNode,_=y._retryCache,_===null&&(_=y._retryCache=new ar),_;default:throw Error(n(435,y.tag))}}function hy(y,_){var C=jb(y);_.forEach(function(z){var N=gy.bind(null,y,z);C.has(z)||(C.add(z),z.then(N,N))})}function os(y,_){var C=_.deletions;if(C!==null)for(var z=0;z<C.length;z++){var N=C[z],q=y,ye=_;if(wn){var Be=ye;e:for(;Be!==null;){switch(Be.tag){case 27:case 5:Dr=Be.stateNode,Kn=!1;break e;case 3:Dr=Be.stateNode.containerInfo,Kn=!0;break e;case 4:Dr=Be.stateNode.containerInfo,Kn=!0;break e}Be=Be.return}if(Dr===null)throw Error(n(160));vu(q,ye,N),Dr=null,Kn=!1}else vu(q,ye,N);q=N.alternate,q!==null&&(q.return=null),N.return=null}if(_.subtreeFlags&13878)for(_=_.child;_!==null;)Wb(_,y),_=_.sibling}function Wb(y,_){var C=y.alternate,z=y.flags;switch(y.tag){case 0:case 11:case 14:case 15:os(_,y),mo(y),z&4&&(Ih(3,y,y.return),qg(3,y),Ih(5,y,y.return));break;case 1:os(_,y),mo(y),z&512&&(ki||C===null||po(C,C.return)),z&64&&ku&&(y=y.updateQueue,y!==null&&(z=y.callbacks,z!==null&&(C=y.shared.hiddenCallbacks,y.shared.hiddenCallbacks=C===null?z:C.concat(z))));break;case 26:if(Go){var N=ba;os(_,y),mo(y),z&512&&(ki||C===null||po(C,C.return)),z&4&&(z=C!==null?C.memoizedState:null,_=y.memoizedState,C===null?_===null?y.stateNode===null?y.stateNode=XE(N,y.type,y.memoizedProps,y):m_(N,y.type,y.stateNode):y.stateNode=f_(N,_,y.memoizedProps):z!==_?(z===null?C.stateNode!==null&&nm(C.stateNode):p_(z),_===null?m_(N,y.type,y.stateNode):f_(N,_,y.memoizedProps)):_===null&&y.stateNode!==null&&kb(y,y.memoizedProps,C.memoizedProps));break}case 27:if(zs&&z&4&&y.alternate===null){N=y.stateNode;var q=y.memoizedProps;try{ZE(N),x_(y.type,q,N,y)}catch(Ut){Ur(y,y.return,Ut)}}case 5:if(os(_,y),mo(y),z&512&&(ki||C===null||po(C,C.return)),wn){if(y.flags&32){_=y.stateNode;try{My(_)}catch(Ut){Ur(y,y.return,Ut)}}z&4&&y.stateNode!=null&&(_=y.memoizedProps,kb(y,_,C!==null?C.memoizedProps:_)),z&1024&&(qr=!0)}break;case 6:if(os(_,y),mo(y),z&4&&wn){if(y.stateNode===null)throw Error(n(162));z=y.memoizedProps,C=C!==null?C.memoizedProps:z,_=y.stateNode;try{EE(_,C,z)}catch(Ut){Ur(y,y.return,Ut)}}break;case 3:if(Go?(YE(),N=ba,ba=ws(_.containerInfo),os(_,y),ba=N):os(_,y),mo(y),z&4){if(wn&&yo&&C!==null&&C.memoizedState.isDehydrated)try{jE(_.containerInfo)}catch(Ut){Ur(y,y.return,Ut)}if(ic){z=_.containerInfo,C=_.pendingChildren;try{UE(z,C)}catch(Ut){Ur(y,y.return,Ut)}}}qr&&(qr=!1,qb(y));break;case 4:Go?(C=ba,ba=ws(y.stateNode.containerInfo),os(_,y),mo(y),ba=C):(os(_,y),mo(y)),z&4&&ic&&ff(y.stateNode,y,y.stateNode.pendingChildren);break;case 12:os(_,y),mo(y);break;case 13:os(_,y),mo(y),y.child.flags&8192&&y.memoizedState!==null!=(C!==null&&C.memoizedState!==null)&&(E_=jo()),z&4&&(z=y.updateQueue,z!==null&&(y.updateQueue=null,hy(y,z)));break;case 22:z&512&&(ki||C===null||po(C,C.return)),N=y.memoizedState!==null;var ye=C!==null&&C.memoizedState!==null,Be=ku,st=ki;if(ku=Be||N,ki=st||ye,os(_,y),ki=st,ku=Be,mo(y),_=y.stateNode,_._current=y,_._visibility&=-3,_._visibility|=_._pendingVisibility&2,z&8192&&(_._visibility=N?_._visibility&-2:_._visibility|1,N&&(_=ku||ki,C===null||ye||_||Yp(y)),wn&&(y.memoizedProps===null||y.memoizedProps.mode!=="manual"))){e:if(C=null,wn)for(_=y;;){if(_.tag===5||Go&&_.tag===26||zs&&_.tag===27){if(C===null){ye=C=_;try{q=ye.stateNode,N?RE(q):nR(ye.stateNode,ye.memoizedProps)}catch(Ut){Ur(ye,ye.return,Ut)}}}else if(_.tag===6){if(C===null){ye=_;try{var Mt=ye.stateNode;N?OE(Mt):s_(Mt,ye.memoizedProps)}catch(Ut){Ur(ye,ye.return,Ut)}}}else if((_.tag!==22&&_.tag!==23||_.memoizedState===null||_===y)&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===y)break e;for(;_.sibling===null;){if(_.return===null||_.return===y)break e;C===_&&(C=null),_=_.return}C===_&&(C=null),_.sibling.return=_.return,_=_.sibling}}z&4&&(z=y.updateQueue,z!==null&&(C=z.retryQueue,C!==null&&(z.retryQueue=null,hy(y,C))));break;case 19:os(_,y),mo(y),z&4&&(z=y.updateQueue,z!==null&&(y.updateQueue=null,hy(y,z)));break;case 21:break;default:os(_,y),mo(y)}}function mo(y){var _=y.flags;if(_&2){try{if(wn&&(!zs||y.tag!==27)){e:{for(var C=y.return;C!==null;){if(Vb(C)){var z=C;break e}C=C.return}throw Error(n(160))}switch(z.tag){case 27:if(zs){var N=z.stateNode,q=Xg(y);cy(y,q,N);break}case 5:var ye=z.stateNode;z.flags&32&&(My(ye),z.flags&=-33);var Be=Xg(y);cy(y,Be,ye);break;case 3:case 4:var st=z.stateNode.containerInfo,Mt=Xg(y);Hb(y,Mt,st);break;default:throw Error(n(161))}}}catch(Ut){Ur(y,y.return,Ut)}y.flags&=-3}_&4096&&(y.flags&=-4097)}function qb(y){if(y.subtreeFlags&1024)for(y=y.child;y!==null;){var _=y;qb(_),_.tag===5&&_.flags&1024&&yE(_.stateNode),y=y.sibling}}function yu(y,_){if(_.subtreeFlags&8772)for(_=_.child;_!==null;)Xp(y,_.alternate,_),_=_.sibling}function Yp(y){for(y=y.child;y!==null;){var _=y;switch(_.tag){case 0:case 11:case 14:case 15:Ih(4,_,_.return),Yp(_);break;case 1:po(_,_.return);var C=_.stateNode;typeof C.componentWillUnmount=="function"&&fo(_,_.return,C),Yp(_);break;case 26:case 27:case 5:po(_,_.return),Yp(_);break;case 22:po(_,_.return),_.memoizedState===null&&Yp(_);break;default:Yp(_)}y=y.sibling}}function zh(y,_,C){for(C=C&&(_.subtreeFlags&8772)!==0,_=_.child;_!==null;){var z=_.alternate,N=y,q=_,ye=q.flags;switch(q.tag){case 0:case 11:case 15:zh(N,q,C),qg(4,q);break;case 1:if(zh(N,q,C),z=q,N=z.stateNode,typeof N.componentDidMount=="function")try{N.componentDidMount()}catch(Mt){Ur(z,z.return,Mt)}if(z=q,N=z.updateQueue,N!==null){var Be=z.stateNode;try{var st=N.shared.hiddenCallbacks;if(st!==null)for(N.shared.hiddenCallbacks=null,N=0;N<st.length;N++)le(st[N],Be)}catch(Mt){Ur(z,z.return,Mt)}}C&&ye&64&&sE(q),ec(q,q.return);break;case 26:case 27:case 5:zh(N,q,C),C&&z===null&&ye&4&&Fb(q),ec(q,q.return);break;case 12:zh(N,q,C);break;case 13:zh(N,q,C),C&&ye&4&&pf(N,q);break;case 22:q.memoizedState===null&&zh(N,q,C),ec(q,q.return);break;default:zh(N,q,C)}_=_.sibling}}function dy(y,_){var C=null;y!==null&&y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(C=y.memoizedState.cachePool.pool),y=null,_.memoizedState!==null&&_.memoizedState.cachePool!==null&&(y=_.memoizedState.cachePool.pool),y!==C&&(y!=null&&y.refCount++,C!=null&&jg(C))}function fy(y,_){y=null,_.alternate!==null&&(y=_.alternate.memoizedState.cache),_=_.memoizedState.cache,_!==y&&(_.refCount++,y!=null&&jg(y))}function xu(y,_,C,z){if(_.subtreeFlags&10256)for(_=_.child;_!==null;)xl(y,_,C,z),_=_.sibling}function xl(y,_,C,z){var N=_.flags;switch(_.tag){case 0:case 11:case 15:xu(y,_,C,z),N&2048&&qg(9,_);break;case 3:xu(y,_,C,z),N&2048&&(y=null,_.alternate!==null&&(y=_.alternate.memoizedState.cache),_=_.memoizedState.cache,_!==y&&(_.refCount++,y!=null&&jg(y)));break;case 12:if(N&2048){xu(y,_,C,z),y=_.stateNode;try{var q=_.memoizedProps,ye=q.id,Be=q.onPostCommit;typeof Be=="function"&&Be(ye,_.alternate===null?"mount":"update",y.passiveEffectDuration,-0)}catch(st){Ur(_,_.return,st)}}else xu(y,_,C,z);break;case 23:break;case 22:q=_.stateNode,_.memoizedState!==null?q._visibility&4?xu(y,_,C,z):Mc(y,_):q._visibility&4?xu(y,_,C,z):(q._visibility|=4,Qs(y,_,C,z,(_.subtreeFlags&10256)!==0)),N&2048&&dy(_.alternate,_);break;case 24:xu(y,_,C,z),N&2048&&fy(_.alternate,_);break;default:xu(y,_,C,z)}}function Qs(y,_,C,z,N){for(N=N&&(_.subtreeFlags&10256)!==0,_=_.child;_!==null;){var q=y,ye=_,Be=C,st=z,Mt=ye.flags;switch(ye.tag){case 0:case 11:case 15:Qs(q,ye,Be,st,N),qg(8,ye);break;case 23:break;case 22:var Ut=ye.stateNode;ye.memoizedState!==null?Ut._visibility&4?Qs(q,ye,Be,st,N):Mc(q,ye):(Ut._visibility|=4,Qs(q,ye,Be,st,N)),N&&Mt&2048&&dy(ye.alternate,ye);break;case 24:Qs(q,ye,Be,st,N),N&&Mt&2048&&fy(ye.alternate,ye);break;default:Qs(q,ye,Be,st,N)}_=_.sibling}}function Mc(y,_){if(_.subtreeFlags&10256)for(_=_.child;_!==null;){var C=y,z=_,N=z.flags;switch(z.tag){case 22:Mc(C,z),N&2048&&dy(z.alternate,z);break;case 24:Mc(C,z),N&2048&&fy(z.alternate,z);break;default:Mc(C,z)}_=_.sibling}}function bu(y){if(y.subtreeFlags&ld)for(y=y.child;y!==null;)Yg(y),y=y.sibling}function Yg(y){switch(y.tag){case 26:bu(y),y.flags&ld&&(y.memoizedState!==null?y_(ba,y.memoizedState,y.memoizedProps):i_(y.type,y.memoizedProps));break;case 5:bu(y),y.flags&ld&&i_(y.type,y.memoizedProps);break;case 3:case 4:if(Go){var _=ba;ba=ws(y.stateNode.containerInfo),bu(y),ba=_}else bu(y);break;case 22:y.memoizedState===null&&(_=y.alternate,_!==null&&_.memoizedState!==null?(_=ld,ld=16777216,bu(y),ld=_):bu(y));break;default:bu(y)}}function Qg(y){var _=y.alternate;if(_!==null&&(y=_.child,y!==null)){_.child=null;do _=y.sibling,y.sibling=null,y=_;while(y!==null)}}function mf(y){var _=y.deletions;if((y.flags&16)!==0){if(_!==null)for(var C=0;C<_.length;C++){var z=_[C];Ei=z,Kg(z,y)}Qg(y)}if(y.subtreeFlags&10256)for(y=y.child;y!==null;)_u(y),y=y.sibling}function _u(y){switch(y.tag){case 0:case 11:case 15:mf(y),y.flags&2048&&Ih(9,y,y.return);break;case 3:mf(y);break;case 12:mf(y);break;case 22:var _=y.stateNode;y.memoizedState!==null&&_._visibility&4&&(y.return===null||y.return.tag!==13)?(_._visibility&=-5,Zg(y)):mf(y);break;default:mf(y)}}function Zg(y){var _=y.deletions;if((y.flags&16)!==0){if(_!==null)for(var C=0;C<_.length;C++){var z=_[C];Ei=z,Kg(z,y)}Qg(y)}for(y=y.child;y!==null;){switch(_=y,_.tag){case 0:case 11:case 15:Ih(8,_,_.return),Zg(_);break;case 22:C=_.stateNode,C._visibility&4&&(C._visibility&=-5,Zg(_));break;default:Zg(_)}y=y.sibling}}function Kg(y,_){for(;Ei!==null;){var C=Ei;switch(C.tag){case 0:case 11:case 15:Ih(8,C,_);break;case 23:case 22:if(C.memoizedState!==null&&C.memoizedState.cachePool!==null){var z=C.memoizedState.cachePool.pool;z!=null&&z.refCount++}break;case 24:jg(C.memoizedState.cache)}if(z=C.child,z!==null)z.return=C,Ei=z;else e:for(C=y;Ei!==null;){z=Ei;var N=z.sibling,q=z.return;if(uy(z),z===C){Ei=null;break e}if(N!==null){N.return=q,Ei=N;break e}Ei=q}}}function Uh(y){var _=_y(y);if(_!=null){if(typeof _.memoizedProps["data-testname"]!="string")throw Error(n(364));return _}if(y=_E(y),y===null)throw Error(n(362));return y.stateNode.current}function py(y,_){var C=y.tag;switch(_.$$typeof){case yn:if(y.type===_.value)return!0;break;case cc:e:{for(_=_.value,y=[y,0],C=0;C<y.length;){var z=y[C++],N=z.tag,q=y[C++],ye=_[q];if(N!==5&&N!==26&&N!==27||!Pc(z)){for(;ye!=null&&py(z,ye);)q++,ye=_[q];if(q===_.length){_=!0;break e}else for(z=z.child;z!==null;)y.push(z,q),z=z.sibling}}_=!1}return _;case Uc:if((C===5||C===26||C===27)&&wE(y.stateNode,_.value))return!0;break;case Ga:if((C===5||C===6||C===26||C===27)&&(y=SE(y),y!==null&&0<=y.indexOf(_.value)))return!0;break;case fm:if((C===5||C===26||C===27)&&(y=y.memoizedProps["data-testname"],typeof y=="string"&&y.toLowerCase()===_.value.toLowerCase()))return!0;break;default:throw Error(n(365))}return!1}function go(y){switch(y.$$typeof){case yn:return"<"+(a(y.value)||"Unknown")+">";case cc:return":has("+(go(y)||"")+")";case Uc:return'[role="'+y.value+'"]';case Ga:return'"'+y.value+'"';case fm:return'[data-testname="'+y.value+'"]';default:throw Error(n(365))}}function gf(y,_){var C=[];y=[y,0];for(var z=0;z<y.length;){var N=y[z++],q=N.tag,ye=y[z++],Be=_[ye];if(q!==5&&q!==26&&q!==27||!Pc(N)){for(;Be!=null&&py(N,Be);)ye++,Be=_[ye];if(ye===_.length)C.push(N);else for(N=N.child;N!==null;)y.push(N,ye),N=N.sibling}}return C}function Bh(y,_){if(!rm)throw Error(n(363));y=Uh(y),y=gf(y,_),_=[],y=Array.from(y);for(var C=0;C<y.length;){var z=y[C++],N=z.tag;if(N===5||N===26||N===27)Pc(z)||_.push(z.stateNode);else for(z=z.child;z!==null;)y.push(z),z=z.sibling}return _}function fa(){if((cr&2)!==0&&ur!==0)return ur&-ur;if(Ii.T!==null){var y=vn;return y!==0?y:He()}return pE()}function Jg(){Xo===0&&(Xo=(ur&536870912)===0||_r?P():536870912);var y=_o.current;return y!==null&&(y.flags|=32),Xo}function on(y,_,C){(y===Xr&&Vr===2||y.cancelPendingCommit!==null)&&(Nh(y,0),Na(y,ur,Xo,!1)),U(y,C),((cr&2)===0||y!==Xr)&&(y===Xr&&((cr&2)===0&&(Hu|=C),En===4&&Na(y,ur,Xo,!1)),We(y))}function Vo(y,_,C){if((cr&6)!==0)throw Error(n(327));var z=!C&&(_&60)===0&&(_&y.expiredLanes)===0||T(y,_),N=z?aE(y,_):ev(y,_,!0),q=z;do{if(N===0){Cl&&!z&&Na(y,_,0,!1);break}else if(N===6)Na(y,_,0,!Tl);else{if(C=y.current.alternate,q&&!wu(C)){N=ev(y,_,!1),q=!1;continue}if(N===2){if(q=_,y.errorRecoveryDisabledLanes&q)var ye=0;else ye=y.pendingLanes&-536870913,ye=ye!==0?ye:ye&536870912?536870912:0;if(ye!==0){_=ye;e:{var Be=y;N=pm;var st=yo&&Be.current.memoizedState.isDehydrated;if(st&&(Nh(Be,ye).flags|=256),ye=ev(Be,ye,!1),ye!==2){if(Rf&&!st){Be.errorRecoveryDisabledLanes|=q,Hu|=q,N=4;break e}q=Pl,Pl=N,q!==null&&Su(q)}N=ye}if(q=!1,N!==2)continue}}if(N===1){Nh(y,0),Na(y,_,0,!0);break}e:{switch(z=y,N){case 0:case 1:throw Error(n(345));case 4:if((_&4194176)===_){Na(z,_,Xo,!Tl);break e}break;case 2:Pl=null;break;case 3:case 5:break;default:throw Error(n(329))}if(z.finishedWork=C,z.finishedLanes=_,(_&62914560)===_&&(q=E_+300-jo(),10<q)){if(Na(z,_,Xo,!Tl),D(z,0)!==0)break e;z.timeoutHandle=by(Ec.bind(null,z,C,Pl,Of,Fy,_,Xo,Hu,fs,Tl,2,-0,0),q);break e}Ec(z,C,Pl,Of,Fy,_,Xo,Hu,fs,Tl,0,-0,0)}}break}while(!0);We(y)}function Su(y){Pl===null?Pl=y:Pl.push.apply(Pl,y)}function Ec(y,_,C,z,N,q,ye,Be,st,Mt,Ut,Xt,zt){var Vi=_.subtreeFlags;if((Vi&8192||(Vi&16785408)===16785408)&&(iR(),Yg(_),_=vE(),_!==null)){y.cancelPendingCommit=_(my.bind(null,y,C,z,N,ye,Be,st,1,Xt,zt)),Na(y,q,ye,!Mt);return}my(y,C,z,N,ye,Be,st,Ut,Xt,zt)}function wu(y){for(var _=y;;){var C=_.tag;if((C===0||C===11||C===15)&&_.flags&16384&&(C=_.updateQueue,C!==null&&(C=C.stores,C!==null)))for(var z=0;z<C.length;z++){var N=C[z],q=N.getSnapshot;N=N.value;try{if(!ka(q(),N))return!1}catch{return!1}}if(C=_.child,_.subtreeFlags&16384&&C!==null)C.return=_,_=C;else{if(_===y)break;for(;_.sibling===null;){if(_.return===null||_.return===y)return!0;_=_.return}_.sibling.return=_.return,_=_.sibling}}return!0}function Na(y,_,C,z){_&=~ja,_&=~Hu,y.suspendedLanes|=_,y.pingedLanes&=~_,z&&(y.warmLanes|=_),z=y.expirationTimes;for(var N=_;0<N;){var q=31-qn(N),ye=1<<q;z[q]=-1,N&=~ye}C!==0&&V(y,C,_)}function Xb(){return(cr&6)===0?(se(0),!1):!0}function $g(){if(ir!==null){if(Vr===0)var y=ir.return;else y=ir,Al=od=null,hi(y),Cf=null,xa=0,y=ir;for(;y!==null;)nE(y.alternate,y),y=y.return;ir=null}}function Nh(y,_){y.finishedWork=null,y.finishedLanes=0;var C=y.timeoutHandle;C!==im&&(y.timeoutHandle=im,lv(C)),C=y.cancelPendingCommit,C!==null&&(y.cancelPendingCommit=null,C()),$g(),Xr=y,ir=C=Eu(y.current,null),ur=_,Vr=0,ds=null,Tl=!1,Cl=T(y,_),Rf=!1,fs=Xo=ja=Hu=Dl=En=0,Pl=pm=null,Fy=!1,(_&8)!==0&&(_|=_&32);var z=y.entangledLanes;if(z!==0)for(y=y.entanglements,z&=_;0<z;){var N=31-qn(z),q=1<<N;_|=y[N],z&=~q}return uc=_,ce(),C}function pa(y,_){Fi=null,Ii.H=Zn,_===pv?(_=Bt(),Vr=3):_===mv?(_=Bt(),Vr=4):Vr=_===w_?8:_!==null&&typeof _=="object"&&typeof _.then=="function"?6:1,ds=_,ir===null&&(En=1,gl(y,re(_,y.current)))}function Is(){var y=_o.current;return y===null?!0:(ur&4194176)===ur?Ml===null:(ur&62914560)===ur||(ur&536870912)!==0?y===Ml:!1}function br(){var y=Ii.H;return Ii.H=Zn,y===null?Zn:y}function bl(){var y=Ii.A;return Ii.A=Vu,y}function _l(){En=4,Tl||(ur&4194176)!==ur&&_o.current!==null||(Cl=!0),(Dl&134217727)===0&&(Hu&134217727)===0||Xr===null||Na(Xr,ur,Xo,!1)}function ev(y,_,C){var z=cr;cr|=2;var N=br(),q=bl();(Xr!==y||ur!==_)&&(Of=null,Nh(y,_)),_=!1;var ye=En;e:do try{if(Vr!==0&&ir!==null){var Be=ir,st=ds;switch(Vr){case 8:$g(),ye=6;break e;case 3:case 2:case 6:_o.current===null&&(_=!0);var Mt=Vr;if(Vr=0,ds=null,Ac(y,Be,st,Mt),C&&Cl){ye=0;break e}break;default:Mt=Vr,Vr=0,ds=null,Ac(y,Be,st,Mt)}}vf(),ye=En;break}catch(Ut){pa(y,Ut)}while(!0);return _&&y.shellSuspendCounter++,Al=od=null,cr=z,Ii.H=N,Ii.A=q,ir===null&&(Xr=null,ur=0,ce()),ye}function vf(){for(;ir!==null;)Qp(ir)}function aE(y,_){var C=cr;cr|=2;var z=br(),N=bl();Xr!==y||ur!==_?(Of=null,Yo=jo()+500,Nh(y,_)):Cl=T(y,_);e:do try{if(Vr!==0&&ir!==null){_=ir;var q=ds;t:switch(Vr){case 1:Vr=0,ds=null,Ac(y,_,q,1);break;case 2:if(Qe(q)){Vr=0,ds=null,Zp(_);break}_=function(){Vr===2&&Xr===y&&(Vr=7),We(y)},q.then(_,_);break e;case 3:Vr=7;break e;case 4:Vr=5;break e;case 7:Qe(q)?(Vr=0,ds=null,Zp(_)):(Vr=0,ds=null,Ac(y,_,q,7));break;case 5:var ye=null;switch(ir.tag){case 26:ye=ir.memoizedState;case 5:case 27:var Be=ir,st=Be.type,Mt=Be.pendingProps;if(ye?v_(ye):t_(st,Mt)){Vr=0,ds=null;var Ut=Be.sibling;if(Ut!==null)ir=Ut;else{var Xt=Be.return;Xt!==null?(ir=Xt,Fh(Xt)):ir=null}break t}}Vr=0,ds=null,Ac(y,_,q,5);break;case 6:Vr=0,ds=null,Ac(y,_,q,6);break;case 8:$g(),En=6;break e;default:throw Error(n(462))}}oE();break}catch(zt){pa(y,zt)}while(!0);return Al=od=null,Ii.H=z,Ii.A=N,cr=C,ir!==null?0:(Xr=null,ur=0,ce(),En)}function oE(){for(;ir!==null&&!$h();)Qp(ir)}function Qp(y){var _=tE(y.alternate,y,uc);y.memoizedProps=y.pendingProps,_===null?Fh(y):ir=_}function Zp(y){var _=y,C=_.alternate;switch(_.tag){case 15:case 0:_=Ng(C,_,_.pendingProps,_.type,void 0,ur);break;case 11:_=Ng(C,_,_.pendingProps,_.type.render,_.ref,ur);break;case 5:hi(_);default:nE(C,_),_=ir=yf(_,uc),_=tE(C,_,uc)}y.memoizedProps=y.pendingProps,_===null?Fh(y):ir=_}function Ac(y,_,C,z){Al=od=null,hi(_),Cf=null,xa=0;var N=_.return;try{if(Pb(y,N,_,C,ur)){En=1,gl(y,re(C,y.current)),ir=null;return}}catch(q){if(N!==null)throw ir=N,q;En=1,gl(y,re(C,y.current)),ir=null;return}_.flags&32768?(_r||z===1?y=!0:Cl||(ur&536870912)!==0?y=!1:(Tl=y=!0,(z===2||z===3||z===6)&&(z=_o.current,z!==null&&z.tag===13&&(z.flags|=16384))),Yb(_,y)):Fh(_)}function Fh(y){var _=y;do{if((_.flags&32768)!==0){Yb(_,Tl);return}y=_.return;var C=rE(_.alternate,_,uc);if(C!==null){ir=C;return}if(_=_.sibling,_!==null){ir=_;return}ir=_=y}while(_!==null);En===0&&(En=5)}function Yb(y,_){do{var C=KP(y.alternate,y);if(C!==null){C.flags&=32767,ir=C;return}if(C=y.return,C!==null&&(C.flags|=32768,C.subtreeFlags=0,C.deletions=null),!_&&(y=y.sibling,y!==null)){ir=y;return}ir=y=C}while(y!==null);En=6,ir=null}function my(y,_,C,z,N,q,ye,Be,st,Mt){var Ut=Ii.T,Xt=Zh();try{Fa(2),Ii.T=null,lE(y,_,C,z,Xt,N,q,ye,Be,st,Mt)}finally{Ii.T=Ut,Fa(Xt)}}function lE(y,_,C,z,N,q,ye,Be){do kh();while(cd!==null);if((cr&6)!==0)throw Error(n(327));var st=y.finishedWork;if(z=y.finishedLanes,st===null)return null;if(y.finishedWork=null,y.finishedLanes=0,st===y.current)throw Error(n(177));y.callbackNode=null,y.callbackPriority=0,y.cancelPendingCommit=null;var Mt=st.lanes|st.childLanes;if(Mt|=ac,F(y,z,Mt,q,ye,Be),y===Xr&&(ir=Xr=null,ur=0),(st.subtreeFlags&10256)===0&&(st.flags&10256)===0||Gu||(Gu=!0,ky=Mt,xv=C,cE(am,function(){return kh(),null})),C=(st.flags&15990)!==0,(st.subtreeFlags&15990)!==0||C?(C=Ii.T,Ii.T=null,q=Zh(),Fa(2),ye=cr,cr|=4,Gb(y,st),Wb(st,y),tR(y.containerInfo),y.current=st,Xp(y,st.alternate,st),Lu(),cr=ye,Fa(q),Ii.T=C):y.current=st,Gu?(Gu=!1,cd=y,mm=z):tv(y,Mt),Mt=y.pendingLanes,Mt===0&&(Nc=null),X(st.stateNode),We(y),_!==null)for(N=y.onRecoverableError,st=0;st<_.length;st++)Mt=_[st],N(Mt.value,{componentStack:Mt.stack});return(mm&3)!==0&&kh(),Mt=y.pendingLanes,(z&4194218)!==0&&(Mt&42)!==0?y===A_?Lf++:(Lf=0,A_=y):Lf=0,se(0),null}function tv(y,_){(y.pooledCacheLanes&=_)===0&&(_=y.pooledCache,_!=null&&(y.pooledCache=null,jg(_)))}function kh(){if(cd!==null){var y=cd,_=ky;ky=0;var C=K(mm),z=32>C?32:C;C=Ii.T;var N=Zh();try{if(Fa(z),Ii.T=null,cd===null)var q=!1;else{z=xv,xv=null;var ye=cd,Be=mm;if(cd=null,mm=0,(cr&6)!==0)throw Error(n(331));var st=cr;if(cr|=4,_u(ye.current),xl(ye,ye.current,Be,z),cr=st,se(0,!1),us&&typeof us.onPostCommitFiberRoot=="function")try{us.onPostCommitFiberRoot(om,ye)}catch{}q=!0}return q}finally{Fa(N),Ii.T=C,tv(y,_)}}return!1}function Kp(y,_,C){_=re(C,_),_=vl(y.stateNode,_,2),y=ht(y,_,2),y!==null&&(U(y,2),We(y))}function Ur(y,_,C){if(y.tag===3)Kp(y,y,C);else for(;_!==null;){if(_.tag===3){Kp(_,y,C);break}else if(_.tag===1){var z=_.stateNode;if(typeof _.type.getDerivedStateFromError=="function"||typeof z.componentDidCatch=="function"&&(Nc===null||!Nc.has(z))){y=re(C,y),C=uf(2),z=ht(_,C,2),z!==null&&(da(C,z,_,y),U(z,2),We(z));break}}_=_.return}}function Vh(y,_,C){var z=y.pingCache;if(z===null){z=y.pingCache=new yv;var N=new Set;z.set(_,N)}else N=z.get(_),N===void 0&&(N=new Set,z.set(_,N));N.has(C)||(Rf=!0,N.add(C),y=iv.bind(null,y,_,C),_.then(y,y))}function iv(y,_,C){var z=y.pingCache;z!==null&&z.delete(_),y.pingedLanes|=y.suspendedLanes&C,y.warmLanes&=~C,Xr===y&&(ur&C)===C&&(En===4||En===3&&(ur&62914560)===ur&&300>jo()-E_?(cr&2)===0&&Nh(y,0):ja|=C,fs===ur&&(fs=0)),We(y)}function rv(y,_){_===0&&(_=R()),y=Xe(y,_),y!==null&&(U(y,_),We(y))}function nv(y){var _=y.memoizedState,C=0;_!==null&&(C=_.retryLane),rv(y,C)}function gy(y,_){var C=0;switch(y.tag){case 13:var z=y.stateNode,N=y.memoizedState;N!==null&&(C=N.retryLane);break;case 19:z=y.stateNode;break;case 22:z=y.stateNode._retryCache;break;default:throw Error(n(314))}z!==null&&z.delete(_),rv(y,C)}function cE(y,_){return Oc(y,_)}function uE(y,_,C,z){this.tag=y,this.key=C,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=_,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=z,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mu(y){return y=y.prototype,!(!y||!y.isReactComponent)}function Eu(y,_){var C=y.alternate;return C===null?(C=i(y.tag,_,y.key,y.mode),C.elementType=y.elementType,C.type=y.type,C.stateNode=y.stateNode,C.alternate=y,y.alternate=C):(C.pendingProps=_,C.type=y.type,C.flags=0,C.subtreeFlags=0,C.deletions=null),C.flags=y.flags&31457280,C.childLanes=y.childLanes,C.lanes=y.lanes,C.child=y.child,C.memoizedProps=y.memoizedProps,C.memoizedState=y.memoizedState,C.updateQueue=y.updateQueue,_=y.dependencies,C.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext},C.sibling=y.sibling,C.index=y.index,C.ref=y.ref,C.refCleanup=y.refCleanup,C}function yf(y,_){y.flags&=31457282;var C=y.alternate;return C===null?(y.childLanes=0,y.lanes=_,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=C.childLanes,y.lanes=C.lanes,y.child=C.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=C.memoizedProps,y.memoizedState=C.memoizedState,y.updateQueue=C.updateQueue,y.type=C.type,_=C.dependencies,y.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext}),y}function xf(y,_,C,z,N,q){var ye=0;if(z=y,typeof y=="function")Mu(y)&&(ye=1);else if(typeof y=="string")ye=Go&&zs?Ss(y,C,Xn.current)?26:Py(y)?27:5:Go?Ss(y,C,Xn.current)?26:5:zs&&Py(y)?27:5;else e:switch(y){case jh:return Hh(C.children,N,q,_);case bf:ye=8,N|=24;break;case Wh:return y=i(12,C,_,N|2),y.elementType=Wh,y.lanes=q,y;case Cu:return y=i(13,C,_,N),y.elementType=Cu,y.lanes=q,y;case av:return y=i(19,C,_,N),y.elementType=av,y.lanes=q,y;case Pu:return vy(C,N,q,_);default:if(typeof y=="object"&&y!==null)switch(y.$$typeof){case $P:case qh:ye=10;break e;case Kb:ye=9;break e;case yy:ye=11;break e;case $p:ye=14;break e;case Du:ye=16,z=null;break e}ye=29,C=Error(n(130,y===null?"null":typeof y,"")),z=null}return _=i(ye,C,_,N),_.elementType=y,_.type=z,_.lanes=q,_}function Hh(y,_,C,z){return y=i(7,y,z,_),y.lanes=C,y}function vy(y,_,C,z){y=i(22,y,z,_),y.elementType=Pu,y.lanes=C;var N={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var q=N._current;if(q===null)throw Error(n(456));if((N._pendingVisibility&2)===0){var ye=Xe(q,2);ye!==null&&(N._pendingVisibility|=2,on(ye,q,2))}},attach:function(){var q=N._current;if(q===null)throw Error(n(456));if((N._pendingVisibility&2)!==0){var ye=Xe(q,2);ye!==null&&(N._pendingVisibility&=-3,on(ye,q,2))}}};return y.stateNode=N,y}function sv(y,_,C){return y=i(6,y,null,_),y.lanes=C,y}function vo(y,_,C){return _=i(4,y.children!==null?y.children:[],y.key,_),_.lanes=C,_.stateNode={containerInfo:y.containerInfo,pendingChildren:null,implementation:y.implementation},_}function Tc(y,_,C,z,N,q,ye,Be){this.tag=1,this.containerInfo=y,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=im,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=O(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=O(0),this.hiddenUpdates=O(null),this.identifierPrefix=z,this.onUncaughtError=N,this.onCaughtError=q,this.onRecoverableError=ye,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Be,this.incompleteTransitions=new Map}function Au(y,_,C,z,N,q,ye,Be,st,Mt,Ut,Xt){return y=new Tc(y,_,C,ye,Be,st,Mt,Xt),_=1,q===!0&&(_|=24),q=i(3,null,null,_),y.current=q,q.stateNode=y,_=Lh(),_.refCount++,y.pooledCache=_,_.refCount++,q.memoizedState={element:z,isDehydrated:C,cache:_},Ke(q),y}function Qb(y){return y?(y=Af,y):Af}function Tu(y){var _=y._reactInternals;if(_===void 0)throw typeof y.render=="function"?Error(n(188)):(y=Object.keys(y).join(","),Error(n(268,y)));return y=p(_),y=y!==null?g(y):null,y===null?null:_f(y.stateNode)}function Cc(y,_,C,z,N,q){N=Qb(N),z.context===null?z.context=N:z.pendingContext=N,z=ut(_),z.payload={element:C},q=q===void 0?null:q,q!==null&&(z.callback=q),C=ht(y,z,_),C!==null&&(on(C,y,_),$e(C,y,_))}function ls(y,_){if(y=y.memoizedState,y!==null&&y.dehydrated!==null){var C=y.retryLane;y.retryLane=C!==0&&C<_?C:_}}function Jp(y,_){ls(y,_),(y=y.alternate)&&ls(y,_)}var lr={},JP=$1(),Ho=eN(),jn=Object.assign,Zb=Symbol.for("react.element"),Gh=Symbol.for("react.transitional.element"),Dc=Symbol.for("react.portal"),jh=Symbol.for("react.fragment"),bf=Symbol.for("react.strict_mode"),Wh=Symbol.for("react.profiler"),$P=Symbol.for("react.provider"),Kb=Symbol.for("react.consumer"),qh=Symbol.for("react.context"),yy=Symbol.for("react.forward_ref"),Cu=Symbol.for("react.suspense"),av=Symbol.for("react.suspense_list"),$p=Symbol.for("react.memo"),Du=Symbol.for("react.lazy"),Pu=Symbol.for("react.offscreen"),tr=Symbol.for("react.memo_cache_sentinel"),kr=Symbol.iterator,cs=Symbol.for("react.client.reference"),Ii=JP.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Xh,Yh,em=!1,Qh=Array.isArray,tm=e.rendererVersion,eR=e.rendererPackageName,Nn=e.extraDevToolsConfig,_f=e.getPublicInstance,Jb=e.getRootHostContext,hE=e.getChildHostContext,dE=e.prepareForCommit,tR=e.resetAfterCommit,$b=e.createInstance,ov=e.appendInitialChild,xy=e.finalizeInitialChildren,Zs=e.shouldSetTextContent,Wn=e.createTextInstance,by=e.scheduleTimeout,lv=e.cancelTimeout,im=e.noTimeout,tc=e.isPrimaryRenderer;e.warnsIfNotActing;var wn=e.supportsMutation,ic=e.supportsPersistence,yo=e.supportsHydration,_y=e.getInstanceFromNode;e.beforeActiveInstanceBlur,e.afterActiveInstanceBlur;var fE=e.preparePortalMount;e.prepareScopeUpdate,e.getInstanceFromScope;var Fa=e.setCurrentUpdatePriority,Zh=e.getCurrentUpdatePriority,pE=e.resolveUpdatePriority;e.resolveEventType,e.resolveEventTimeStamp;var mE=e.shouldAttemptEagerTransition,gE=e.detachDeletedInstance;e.requestPostPaintCallback;var e_=e.maySuspendCommit,t_=e.preloadInstance,iR=e.startSuspendingCommit,i_=e.suspendInstance,vE=e.waitForCommitToBeReady,Sf=e.NotPendingTransition,Ru=e.HostTransitionContext,yE=e.resetFormInstance;e.bindToConsole;var xE=e.supportsMicrotasks,bE=e.scheduleMicrotask,rm=e.supportsTestSelectors,_E=e.findFiberRoot,rR=e.getBoundingRect,SE=e.getTextContent,Pc=e.isHiddenSubtree,wE=e.matchAccessibilityRole,Sy=e.setFocusIfFocusable,wy=e.setupIntersectionObserver,ME=e.appendChild,r_=e.appendChildToContainer,EE=e.commitTextUpdate,AE=e.commitMount,TE=e.commitUpdate,CE=e.insertBefore,n_=e.insertInContainerBefore,DE=e.removeChild,PE=e.removeChildFromContainer,My=e.resetTextContent,RE=e.hideInstance,OE=e.hideTextInstance,nR=e.unhideInstance,s_=e.unhideTextInstance,LE=e.clearContainer,IE=e.cloneInstance,Ey=e.createContainerChildSet,a_=e.appendChildToContainerChildSet,zE=e.finalizeContainerChildren,UE=e.replaceContainerChildren,BE=e.cloneHiddenInstance,o_=e.cloneHiddenTextInstance,wf=e.isSuspenseInstancePending,cv=e.isSuspenseInstanceFallback,Ay=e.getSuspenseInstanceFallbackErrorDetails,NE=e.registerSuspenseInstanceRetry,FE=e.canHydrateFormStateMarker,Rc=e.isFormStateMarkerMatching,Kh=e.getNextHydratableSibling,Ou=e.getFirstHydratableChild,Mf=e.getFirstHydratableChildWithinContainer,l_=e.getFirstHydratableChildWithinSuspenseInstance,c_=e.canHydrateInstance,kE=e.canHydrateTextInstance,VE=e.canHydrateSuspenseInstance,Ef=e.hydrateInstance,Ty=e.hydrateTextInstance,HE=e.hydrateSuspenseInstance,GE=e.getNextHydratableInstanceAfterSuspenseInstance,jE=e.commitHydratedContainer,Cy=e.commitHydratedSuspenseInstance,WE=e.clearSuspenseBoundary,u_=e.clearSuspenseBoundaryFromContainer,h_=e.shouldDeleteUnhydratedTailInstances;e.diffHydratedPropsForDevWarnings,e.diffHydratedTextForDevWarnings,e.describeHydratableInstanceForDevWarnings;var qE=e.validateHydratableInstance,sR=e.validateHydratableTextInstance,Go=e.supportsResources,Ss=e.isHostHoistableType,ws=e.getHoistableRoot,d_=e.getResource,f_=e.acquireResource,p_=e.releaseResource,XE=e.hydrateHoistable,m_=e.mountHoistable,nm=e.unmountHoistable,g_=e.createHoistableInstance,YE=e.prepareToCommitHoistables,QE=e.mayResourceSuspendCommit,v_=e.preloadResource,y_=e.suspendResource,zs=e.supportsSingletons,Dy=e.resolveSingletonInstance,ZE=e.clearSingleton,x_=e.acquireSingletonInstance,b_=e.releaseSingletonInstance,Py=e.isHostSingletonType,Ry=[],Jh=-1,Af={},qn=Math.clz32?Math.clz32:M,__=Math.log,aR=Math.LN2,uv=128,sm=4194304,Oc=Ho.unstable_scheduleCallback,rc=Ho.unstable_cancelCallback,$h=Ho.unstable_shouldYield,Lu=Ho.unstable_requestPaint,jo=Ho.unstable_now,Oy=Ho.unstable_ImmediatePriority,hv=Ho.unstable_UserBlockingPriority,am=Ho.unstable_NormalPriority,Tf=Ho.unstable_IdlePriority,ma=Ho.log,Ly=Ho.unstable_setDisableYieldValue,om=null,us=null,ka=typeof Object.is=="function"?Object.is:Y,Iy=new WeakMap,Wo=[],qo=0,ed=null,lm=0,xo=[],ga=0,nc=null,Lc=1,Ic="",Xn=v(null),Sl=v(null),Iu=v(null),dv=v(null),Yn=null,Wr=null,_r=!1,wl=null,sc=!1,fv=Error(n(519)),bo=[],zu=0,ac=0,gn=null,td=null,zy=!1,Qn=!1,Uy=!1,cm=0,um=null,By=0,vn=0,Us=null,va=!1,Ny=!1,KE=Object.prototype.hasOwnProperty,pv=Error(n(460)),mv=Error(n(474)),Va={then:function(){}},ya=null,Cf=null,xa=0,id=Oi(!0),zc=Oi(!1),oc=v(null),lc=v(0),_o=v(null),Ml=null,ln=v(0),Uu=0,Fi=null,Cr=null,Mn=null,Bu=!1,Df=!1,rd=!1,nd=0,hm=0,Nu=null,JE=0,S_=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}},Zn={readContext:Ys,use:Ie,useCallback:it,useContext:it,useEffect:it,useImperativeHandle:it,useLayoutEffect:it,useInsertionEffect:it,useMemo:it,useReducer:it,useRef:it,useState:it,useDebugValue:it,useDeferredValue:it,useTransition:it,useSyncExternalStore:it,useId:it};Zn.useCacheRefresh=it,Zn.useMemoCache=it,Zn.useHostTransitionStatus=it,Zn.useFormState=it,Zn.useActionState=it,Zn.useOptimistic=it;var Fu={readContext:Ys,use:Ie,useCallback:function(y,_){return de().memoizedState=[y,_===void 0?null:_],y},useContext:Ys,useEffect:af,useImperativeHandle:function(y,_,C){C=C!=null?C.concat([y]):null,sf(4194308,4,pl.bind(null,_,y),C)},useLayoutEffect:function(y,_){return sf(4194308,4,y,_)},useInsertionEffect:function(y,_){sf(4,2,y,_)},useMemo:function(y,_){var C=de();_=_===void 0?null:_;var z=y();if(rd){$(!0);try{y()}finally{$(!1)}}return C.memoizedState=[z,_],z},useReducer:function(y,_,C){var z=de();if(C!==void 0){var N=C(_);if(rd){$(!0);try{C(_)}finally{$(!1)}}}else N=_;return z.memoizedState=z.baseState=N,y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:y,lastRenderedState:N},z.queue=y,y=y.dispatch=cf.bind(null,Fi,y),[z.memoizedState,y]},useRef:function(y){var _=de();return y={current:y},_.memoizedState=y},useState:function(y){y=Ne(y);var _=y.queue,C=Hp.bind(null,Fi,_);return _.dispatch=C,[y.memoizedState,C]},useDebugValue:Jl,useDeferredValue:function(y,_){var C=de();return Ch(C,y,_)},useTransition:function(){var y=Ne(!1);return y=Vp.bind(null,Fi,y.queue,!0,!1),de().memoizedState=y,[!1,y]},useSyncExternalStore:function(y,_,C){var z=Fi,N=de();if(_r){if(C===void 0)throw Error(n(407));C=C()}else{if(C=_(),Xr===null)throw Error(n(349));(ur&60)!==0||ii(z,_,C)}N.memoizedState=C;var q={value:C,getSnapshot:_};return N.queue=q,af(he.bind(null,z,q,y),[y]),z.flags|=2048,ha(9,te.bind(null,z,q,C,_),{destroy:void 0},null),C},useId:function(){var y=de(),_=Xr.identifierPrefix;if(_r){var C=Ic,z=Lc;C=(z&~(1<<32-qn(z)-1)).toString(32)+C,_=":"+_+"R"+C,C=nd++,0<C&&(_+="H"+C.toString(32)),_+=":"}else C=JE++,_=":"+_+"r"+C.toString(32)+":";return y.memoizedState=_},useCacheRefresh:function(){return de().memoizedState=lf.bind(null,Fi)}};Fu.useMemoCache=Fe,Fu.useHostTransitionStatus=cu,Fu.useFormState=Or,Fu.useActionState=Or,Fu.useOptimistic=function(y){var _=de();_.memoizedState=_.baseState=y;var C={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return _.queue=C,_=hu.bind(null,Fi,!0,C),C.dispatch=_,[y,_]};var Ha={readContext:Ys,use:Ie,useCallback:wc,useContext:Ys,useEffect:Zl,useImperativeHandle:Kl,useInsertionEffect:Ug,useLayoutEffect:of,useMemo:No,useReducer:xt,useRef:_s,useState:function(){return xt(Dt)},useDebugValue:Jl,useDeferredValue:function(y,_){var C=ke();return Dh(C,Cr.memoizedState,y,_)},useTransition:function(){var y=xt(Dt)[0],_=ke().memoizedState;return[typeof y=="boolean"?y:rt(y),_]},useSyncExternalStore:li,useId:uu};Ha.useCacheRefresh=Hn,Ha.useMemoCache=Fe,Ha.useHostTransitionStatus=cu,Ha.useFormState=Vn,Ha.useActionState=Vn,Ha.useOptimistic=function(y,_){var C=ke();return mt(C,Cr,y,_)};var sd={readContext:Ys,use:Ie,useCallback:wc,useContext:Ys,useEffect:Zl,useImperativeHandle:Kl,useInsertionEffect:Ug,useLayoutEffect:of,useMemo:No,useReducer:kt,useRef:_s,useState:function(){return kt(Dt)},useDebugValue:Jl,useDeferredValue:function(y,_){var C=ke();return Cr===null?Ch(C,y,_):Dh(C,Cr.memoizedState,y,_)},useTransition:function(){var y=kt(Dt)[0],_=ke().memoizedState;return[typeof y=="boolean"?y:rt(y),_]},useSyncExternalStore:li,useId:uu};sd.useCacheRefresh=Hn,sd.useMemoCache=Fe,sd.useHostTransitionStatus=cu,sd.useFormState=On,sd.useActionState=On,sd.useOptimistic=function(y,_){var C=ke();return Cr!==null?mt(C,Cr,y,_):(C.baseState=y,[y,C.queue.dispatch])};var dm={isMounted:function(y){return(y=y._reactInternals)?h(y)===y:!1},enqueueSetState:function(y,_,C){y=y._reactInternals;var z=fa(),N=ut(z);N.payload=_,C!=null&&(N.callback=C),_=ht(y,N,z),_!==null&&(on(_,y,z),$e(_,y,z))},enqueueReplaceState:function(y,_,C){y=y._reactInternals;var z=fa(),N=ut(z);N.tag=1,N.payload=_,C!=null&&(N.callback=C),_=ht(y,N,z),_!==null&&(on(_,y,z),$e(_,y,z))},enqueueForceUpdate:function(y,_){y=y._reactInternals;var C=fa(),z=ut(C);z.tag=2,_!=null&&(z.callback=_),_=ht(y,z,C),_!==null&&(on(_,y,C),$e(_,y,C))}},ad=typeof reportError=="function"?reportError:function(y){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var _=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof y=="object"&&y!==null&&typeof y.message=="string"?String(y.message):String(y),error:y});if(!window.dispatchEvent(_))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",y);return}console.error(y)},w_=Error(n(461)),hs=!1,gv={dehydrated:null,treeContext:null,retryLane:0},El=v(null),od=null,Al=null,vv=typeof AbortController<"u"?AbortController:function(){var y=[],_=this.signal={aborted:!1,addEventListener:function(C,z){y.push(z)}};this.abort=function(){_.aborted=!0,y.forEach(function(C){return C()})}},Ln=Ho.unstable_scheduleCallback,oR=Ho.unstable_NormalPriority,Fn={$$typeof:qh,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},M_=Ii.S;Ii.S=function(y,_){typeof _=="object"&&_!==null&&typeof _.then=="function"&&je(y,_),M_!==null&&M_(y,_)};var Pf=v(null),ku=!1,ki=!1,qr=!1,ar=typeof WeakSet=="function"?WeakSet:Set,Ei=null,Jr=!1,Dr=null,Kn=!1,ba=null,ld=8192,Vu={getCacheForType:function(y){var _=Ys(Fn),C=_.data.get(y);return C===void 0&&(C=y(),_.data.set(y,C)),C}},yn=0,cc=1,Uc=2,fm=3,Ga=4;if(typeof Symbol=="function"&&Symbol.for){var Bc=Symbol.for;yn=Bc("selector.component"),cc=Bc("selector.has_pseudo_class"),Uc=Bc("selector.role"),fm=Bc("selector.test_id"),Ga=Bc("selector.text")}var yv=typeof WeakMap=="function"?WeakMap:Map,cr=0,Xr=null,ir=null,ur=0,Vr=0,ds=null,Tl=!1,Cl=!1,Rf=!1,uc=0,En=0,Dl=0,Hu=0,ja=0,Xo=0,fs=0,pm=null,Pl=null,Fy=!1,E_=0,Yo=1/0,Of=null,Nc=null,Gu=!1,cd=null,mm=0,ky=0,xv=null,Lf=0,A_=null;return lr.attemptContinuousHydration=function(y){if(y.tag===13){var _=Xe(y,67108864);_!==null&&on(_,y,67108864),Jp(y,67108864)}},lr.attemptHydrationAtCurrentPriority=function(y){if(y.tag===13){var _=fa(),C=Xe(y,_);C!==null&&on(C,y,_),Jp(y,_)}},lr.attemptSynchronousHydration=function(y){switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var _=E(y.pendingLanes);if(_!==0){for(y.pendingLanes|=2,y.entangledLanes|=2;_;){var C=1<<31-qn(_);y.entanglements[1]|=C,_&=~C}We(y),(cr&6)===0&&(Yo=jo()+500,se(0))}}break;case 13:_=Xe(y,2),_!==null&&on(_,y,2),Xb(),Jp(y,2)}},lr.batchedUpdates=function(y,_){return y(_)},lr.createComponentSelector=function(y){return{$$typeof:yn,value:y}},lr.createContainer=function(y,_,C,z,N,q,ye,Be,st,Mt){return Au(y,_,!1,null,C,z,q,ye,Be,st,Mt,null)},lr.createHasPseudoClassSelector=function(y){return{$$typeof:cc,value:y}},lr.createHydrationContainer=function(y,_,C,z,N,q,ye,Be,st,Mt,Ut,Xt,zt){return y=Au(C,z,!0,y,N,q,Be,st,Mt,Ut,Xt,zt),y.context=Qb(null),C=y.current,z=fa(),N=ut(z),N.callback=_??null,ht(C,N,z),y.current.lanes=z,U(y,z),We(y),y},lr.createPortal=function(y,_,C){var z=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Dc,key:z==null?null:""+z,children:y,containerInfo:_,implementation:C}},lr.createRoleSelector=function(y){return{$$typeof:Uc,value:y}},lr.createTestNameSelector=function(y){return{$$typeof:fm,value:y}},lr.createTextSelector=function(y){return{$$typeof:Ga,value:y}},lr.defaultOnCaughtError=function(y){console.error(y)},lr.defaultOnRecoverableError=function(y){ad(y)},lr.defaultOnUncaughtError=function(y){ad(y)},lr.deferredUpdates=function(y){var _=Ii.T,C=Zh();try{return Fa(32),Ii.T=null,y()}finally{Fa(C),Ii.T=_}},lr.discreteUpdates=function(y,_,C,z,N){var q=Ii.T,ye=Zh();try{return Fa(2),Ii.T=null,y(_,C,z,N)}finally{Fa(ye),Ii.T=q,cr===0&&(Yo=jo()+500)}},lr.findAllNodes=Bh,lr.findBoundingRects=function(y,_){if(!rm)throw Error(n(363));_=Bh(y,_),y=[];for(var C=0;C<_.length;C++)y.push(rR(_[C]));for(_=y.length-1;0<_;_--){C=y[_];for(var z=C.x,N=z+C.width,q=C.y,ye=q+C.height,Be=_-1;0<=Be;Be--)if(_!==Be){var st=y[Be],Mt=st.x,Ut=Mt+st.width,Xt=st.y,zt=Xt+st.height;if(z>=Mt&&q>=Xt&&N<=Ut&&ye<=zt){y.splice(_,1);break}else if(z!==Mt||C.width!==st.width||zt<q||Xt>ye){if(!(q!==Xt||C.height!==st.height||Ut<z||Mt>N)){Mt>z&&(st.width+=Mt-z,st.x=z),Ut<N&&(st.width=N-Mt),y.splice(_,1);break}}else{Xt>q&&(st.height+=Xt-q,st.y=q),zt<ye&&(st.height=ye-Xt),y.splice(_,1);break}}}return y},lr.findHostInstance=Tu,lr.findHostInstanceWithNoPortals=function(y){return y=p(y),y=y!==null?x(y):null,y===null?null:_f(y.stateNode)},lr.findHostInstanceWithWarning=function(y){return Tu(y)},lr.flushPassiveEffects=kh,lr.flushSyncFromReconciler=function(y){var _=cr;cr|=1;var C=Ii.T,z=Zh();try{if(Fa(2),Ii.T=null,y)return y()}finally{Fa(z),Ii.T=C,cr=_,(cr&6)===0&&se(0)}},lr.flushSyncWork=Xb,lr.focusWithin=function(y,_){if(!rm)throw Error(n(363));for(y=Uh(y),_=gf(y,_),_=Array.from(_),y=0;y<_.length;){var C=_[y++],z=C.tag;if(!Pc(C)){if((z===5||z===26||z===27)&&Sy(C.stateNode))return!0;for(C=C.child;C!==null;)_.push(C),C=C.sibling}}return!1},lr.getFindAllNodesFailureDescription=function(y,_){if(!rm)throw Error(n(363));var C=0,z=[];y=[Uh(y),0];for(var N=0;N<y.length;){var q=y[N++],ye=q.tag,Be=y[N++],st=_[Be];if((ye!==5&&ye!==26&&ye!==27||!Pc(q))&&(py(q,st)&&(z.push(go(st)),Be++,Be>C&&(C=Be)),Be<_.length))for(q=q.child;q!==null;)y.push(q,Be),q=q.sibling}if(C<_.length){for(y=[];C<_.length;C++)y.push(go(_[C]));return`findAllNodes was able to match part of the selector:
  `+(z.join(" > ")+`

No matching component was found for:
  `)+y.join(" > ")}return null},lr.getPublicRootInstance=function(y){if(y=y.current,!y.child)return null;switch(y.child.tag){case 27:case 5:return _f(y.child.stateNode);default:return y.child.stateNode}},lr.injectIntoDevTools=function(){var y={bundleType:0,version:tm,rendererPackageName:eR,currentDispatcherRef:Ii,findFiberByHostInstance:_y,reconcilerVersion:"19.0.0"};if(Nn!==null&&(y.rendererConfig=Nn),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")y=!1;else{var _=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(_.isDisabled||!_.supportsFiber)y=!0;else{try{om=_.inject(y),us=_}catch{}y=!!_.checkDCE}}return y},lr.isAlreadyRendering=function(){return!1},lr.observeVisibleRects=function(y,_,C,z){if(!rm)throw Error(n(363));y=Bh(y,_);var N=wy(y,C,z).disconnect;return{disconnect:function(){N()}}},lr.shouldError=function(){return null},lr.shouldSuspend=function(){return!1},lr.startHostTransition=function(y,_,C,z){if(y.tag!==5)throw Error(n(476));var N=$l(y).queue;Vp(y,N,_,Sf,C===null?r:function(){var q=$l(y).next.queue;return ml(y,q,{},fa()),C(z)})},lr.updateContainer=function(y,_,C,z){var N=_.current,q=fa();return Cc(N,q,y,_,C,z),q},lr.updateContainerSync=function(y,_,C,z){return _.tag===0&&kh(),Cc(_.current,2,y,_,C,z),2},lr},t.exports.default=t.exports,Object.defineProperty(t.exports,"__esModule",{value:!0})}(HI)),HI.exports}var c9;function $4e(){return c9||(c9=1,VI.exports=J4e()),VI.exports}var eFe=$4e();const tFe=x3(eFe);var u9=eN();const iFe=t=>typeof t=="object"&&typeof t.then=="function",LT=[];function rFe(t,e,i=(r,n)=>r===n){if(t===e)return!0;if(!t||!e)return!1;const r=t.length;if(e.length!==r)return!1;for(let n=0;n<r;n++)if(!i(t[n],e[n]))return!1;return!0}function nFe(t,e=null,i=!1,r={}){e===null&&(e=[t]);for(const s of LT)if(rFe(e,s.keys,s.equal)){if(i)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!i)throw s.promise}const n={keys:e,equal:r.equal,remove:()=>{const s=LT.indexOf(n);s!==-1&&LT.splice(s,1)},promise:(iFe(t)?t:t(...e)).then(s=>{n.response=s,r.lifespan&&r.lifespan>0&&(n.timeout=setTimeout(n.remove,r.lifespan))}).catch(s=>n.error=s)};if(LT.push(n),!i)throw n.promise}const sFe=(t,e,i)=>nFe(t,e,!1,i);function kF(t,e,i){if(!t)return;if(i(t)===!0)return t;let r=e?t.return:t.child;for(;r;){const n=kF(r,e,i);if(n)return n;r=e?null:r.sibling}}function e$(t){try{return Object.defineProperties(t,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return t}}const VF=e$(Me.createContext(null));class t$ extends Me.Component{render(){return Me.createElement(VF.Provider,{value:this._reactInternals},this.props.children)}}function i$(){const t=Me.useContext(VF);if(t===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=Me.useId();return Me.useMemo(()=>{for(const i of[t,t==null?void 0:t.alternate]){if(!i)continue;const r=kF(i,!1,n=>{let s=n.memoizedState;for(;s;){if(s.memoizedState===e)return!0;s=s.next}});if(r)return r}},[t,e])}const aFe=Symbol.for("react.context"),oFe=t=>t!==null&&typeof t=="object"&&"$$typeof"in t&&t.$$typeof===aFe;function lFe(){const t=i$(),[e]=Me.useState(()=>new Map);e.clear();let i=t;for(;i;){const r=i.type;oFe(r)&&r!==VF&&!e.has(r)&&e.set(r,Me.use(e$(r))),i=i.return}return e}function cFe(){const t=lFe();return Me.useMemo(()=>Array.from(t.keys()).reduce((e,i)=>r=>Me.createElement(e,null,Me.createElement(i.Provider,{...r,value:t.get(i)})),e=>Me.createElement(t$,{...e})),[t])}function r$(t){let e=t.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const n$=t=>t&&t.isOrthographicCamera,uFe=t=>t&&t.hasOwnProperty("current"),hFe=t=>t!=null&&(typeof t=="string"||typeof t=="number"||t.isColor),qM=((t,e)=>typeof window<"u"&&(((t=window.document)==null?void 0:t.createElement)||((e=window.navigator)==null?void 0:e.product)==="ReactNative"))()?Me.useLayoutEffect:Me.useEffect;function s$(t){const e=Me.useRef(t);return qM(()=>void(e.current=t),[t]),e}function dFe(){const t=i$(),e=cFe();return Me.useMemo(()=>({children:i})=>{const n=!!kF(t,!0,s=>s.type===Me.StrictMode)?Me.StrictMode:Me.Fragment;return Pe.jsx(n,{children:Pe.jsx(e,{children:i})})},[t,e])}function fFe({set:t}){return qM(()=>(t(new Promise(()=>null)),()=>t(!1)),[t]),null}const pFe=(t=>(t=class extends Me.Component{constructor(...i){super(...i),this.state={error:!1}}componentDidCatch(i){this.props.set(i)}render(){return this.state.error?null:this.props.children}},t.getDerivedStateFromError=()=>({error:!0}),t))();function a$(t){var e;const i=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(t)?Math.min(Math.max(t[0],i),t[1]):t}function Vx(t){var e;return(e=t.__r3f)==null?void 0:e.root.getState()}const $n={obj:t=>t===Object(t)&&!$n.arr(t)&&typeof t!="function",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",boo:t=>typeof t=="boolean",und:t=>t===void 0,nul:t=>t===null,arr:t=>Array.isArray(t),equ(t,e,{arrays:i="shallow",objects:r="reference",strict:n=!0}={}){if(typeof t!=typeof e||!!t!=!!e)return!1;if($n.str(t)||$n.num(t)||$n.boo(t))return t===e;const s=$n.obj(t);if(s&&r==="reference")return t===e;const a=$n.arr(t);if(a&&i==="reference")return t===e;if((a||s)&&t===e)return!0;let o;for(o in t)if(!(o in e))return!1;if(s&&i==="shallow"&&r==="shallow"){for(o in n?e:t)if(!$n.equ(t[o],e[o],{strict:n,objects:"reference"}))return!1}else for(o in n?e:t)if(t[o]!==e[o])return!1;if($n.und(o)){if(a&&t.length===0&&e.length===0||s&&Object.keys(t).length===0&&Object.keys(e).length===0)return!0;if(t!==e)return!1}return!0}};function mFe(t){t.type!=="Scene"&&(t.dispose==null||t.dispose());for(const e in t){const i=t[e];(i==null?void 0:i.type)!=="Scene"&&(i==null||i.dispose==null||i.dispose())}}const o$=["children","key","ref"];function gFe(t){const e={};for(const i in t)o$.includes(i)||(e[i]=t[i]);return e}function d3(t,e,i,r){const n=t;let s=n==null?void 0:n.__r3f;return s||(s={root:e,type:i,parent:null,children:[],props:gFe(r),object:n,eventCount:0,handlers:{},isHidden:!1},n&&(n.__r3f=s)),s}function uM(t,e){let i=t[e];if(!e.includes("-"))return{root:t,key:e,target:i};i=t;for(const n of e.split("-")){var r;e=n,t=i,i=(r=i)==null?void 0:r[e]}return{root:t,key:e,target:i}}const h9=/-\d+$/;function f3(t,e){if($n.str(e.props.attach)){if(h9.test(e.props.attach)){const n=e.props.attach.replace(h9,""),{root:s,key:a}=uM(t.object,n);Array.isArray(s[a])||(s[a]=[])}const{root:i,key:r}=uM(t.object,e.props.attach);e.previousAttach=i[r],i[r]=e.object}else $n.fun(e.props.attach)&&(e.previousAttach=e.props.attach(t.object,e.object))}function p3(t,e){if($n.str(e.props.attach)){const{root:i,key:r}=uM(t.object,e.props.attach),n=e.previousAttach;n===void 0?delete i[r]:i[r]=n}else e.previousAttach==null||e.previousAttach(t.object,e.object);delete e.previousAttach}const VB=[...o$,"args","dispose","attach","object","onUpdate","dispose"],d9=new Map;function vFe(t){let e=d9.get(t.constructor);try{e||(e=new t.constructor,d9.set(t.constructor,e))}catch{}return e}function yFe(t,e){const i={};for(const r in e)if(!VB.includes(r)&&!$n.equ(e[r],t.props[r])){i[r]=e[r];for(const n in e)n.startsWith(`${r}-`)&&(i[n]=e[n])}for(const r in t.props){if(VB.includes(r)||e.hasOwnProperty(r))continue;const{root:n,key:s}=uM(t.object,r);if(n.constructor&&n.constructor.length===0){const a=vFe(n);$n.und(a)||(i[s]=a[s])}else i[s]=0}return i}const xFe=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],bFe=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function ig(t,e){var i;const r=t.__r3f,n=r&&r$(r).getState(),s=r==null?void 0:r.eventCount;for(const o in e){let l=e[o];if(VB.includes(o))continue;if(r&&bFe.test(o)){typeof l=="function"?r.handlers[o]=l:delete r.handlers[o],r.eventCount=Object.keys(r.handlers).length;continue}if(l===void 0)continue;let{root:c,key:u,target:h}=uM(t,o);if(h instanceof X1&&l instanceof X1)h.mask=l.mask;else if(h instanceof Zt&&hFe(l))h.set(l);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&typeof h.copy=="function"&&l!=null&&l.constructor&&h.constructor===l.constructor)h.copy(l);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&Array.isArray(l))typeof h.fromArray=="function"?h.fromArray(l):h.set(...l);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&typeof l=="number")typeof h.setScalar=="function"?h.setScalar(l):h.set(l);else{var a;c[u]=l,n&&!n.linear&&xFe.includes(u)&&(a=c[u])!=null&&a.isTexture&&c[u].format===Lo&&c[u].type===bh&&(c[u].colorSpace=Co)}}if(r!=null&&r.parent&&n!=null&&n.internal&&(i=r.object)!=null&&i.isObject3D&&s!==r.eventCount){const o=r.object,l=n.internal.interaction.indexOf(o);l>-1&&n.internal.interaction.splice(l,1),r.eventCount&&o.raycast!==null&&n.internal.interaction.push(o)}return r&&r.props.attach===void 0&&(r.object.isBufferGeometry?r.props.attach="geometry":r.object.isMaterial&&(r.props.attach="material")),r&&Cb(r),t}function Cb(t){var e;if(!t.parent)return;t.props.onUpdate==null||t.props.onUpdate(t.object);const i=(e=t.root)==null||e.getState==null?void 0:e.getState();i&&i.internal.frames===0&&i.invalidate()}function _Fe(t,e){t.manual||(n$(t)?(t.left=e.width/-2,t.right=e.width/2,t.top=e.height/2,t.bottom=e.height/-2):t.aspect=e.width/e.height,t.updateProjectionMatrix())}const Ul=t=>t==null?void 0:t.isObject3D;function IT(t){return(t.eventObject||t.object).uuid+"/"+t.index+t.instanceId}function l$(t,e,i,r){const n=i.get(e);n&&(i.delete(e),i.size===0&&(t.delete(r),n.target.releasePointerCapture(r)))}function SFe(t,e){const{internal:i}=t.getState();i.interaction=i.interaction.filter(r=>r!==e),i.initialHits=i.initialHits.filter(r=>r!==e),i.hovered.forEach((r,n)=>{(r.eventObject===e||r.object===e)&&i.hovered.delete(n)}),i.capturedMap.forEach((r,n)=>{l$(i.capturedMap,e,r,n)})}function wFe(t){function e(l){const{internal:c}=t.getState(),u=l.offsetX-c.initialClick[0],h=l.offsetY-c.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function i(l){return l.filter(c=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=c.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function r(l,c){const u=t.getState(),h=new Set,d=[],p=c?c(u.internal.interaction):u.internal.interaction;for(let b=0;b<p.length;b++){const w=Vx(p[b]);w&&(w.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(l,u);function g(b){const w=Vx(b);if(!w||!w.events.enabled||w.raycaster.camera===null)return[];if(w.raycaster.camera===void 0){var M;w.events.compute==null||w.events.compute(l,w,(M=w.previousRoot)==null?void 0:M.getState()),w.raycaster.camera===void 0&&(w.raycaster.camera=null)}return w.raycaster.camera?w.raycaster.intersectObject(b,!0):[]}let x=p.flatMap(g).sort((b,w)=>{const M=Vx(b.object),E=Vx(w.object);return!M||!E?b.distance-w.distance:E.events.priority-M.events.priority||b.distance-w.distance}).filter(b=>{const w=IT(b);return h.has(w)?!1:(h.add(w),!0)});u.events.filter&&(x=u.events.filter(x,u));for(const b of x){let w=b.object;for(;w;){var v;(v=w.__r3f)!=null&&v.eventCount&&d.push({...b,eventObject:w}),w=w.parent}}if("pointerId"in l&&u.internal.capturedMap.has(l.pointerId))for(let b of u.internal.capturedMap.get(l.pointerId).values())h.has(IT(b.intersection))||d.push(b.intersection);return d}function n(l,c,u,h){if(l.length){const d={stopped:!1};for(const p of l){let g=Vx(p.object);if(g||p.object.traverseAncestors(x=>{const v=Vx(x);if(v)return g=v,!1}),g){const{raycaster:x,pointer:v,camera:b,internal:w}=g,M=new Se(v.x,v.y,0).unproject(b),E=R=>{var O,U;return(O=(U=w.capturedMap.get(R))==null?void 0:U.has(p.eventObject))!=null?O:!1},D=R=>{const O={intersection:p,target:c.target};w.capturedMap.has(R)?w.capturedMap.get(R).set(p.eventObject,O):w.capturedMap.set(R,new Map([[p.eventObject,O]])),c.target.setPointerCapture(R)},T=R=>{const O=w.capturedMap.get(R);O&&l$(w.capturedMap,p.eventObject,O,R)};let L={};for(let R in c){let O=c[R];typeof O!="function"&&(L[R]=O)}let P={...p,...L,pointer:v,intersections:l,stopped:d.stopped,delta:u,unprojectedPoint:M,ray:x.ray,camera:b,stopPropagation(){const R="pointerId"in c&&w.capturedMap.get(c.pointerId);if((!R||R.has(p.eventObject))&&(P.stopped=d.stopped=!0,w.hovered.size&&Array.from(w.hovered.values()).find(O=>O.eventObject===p.eventObject))){const O=l.slice(0,l.indexOf(p));s([...O,p])}},target:{hasPointerCapture:E,setPointerCapture:D,releasePointerCapture:T},currentTarget:{hasPointerCapture:E,setPointerCapture:D,releasePointerCapture:T},nativeEvent:c};if(h(P),d.stopped===!0)break}}}return l}function s(l){const{internal:c}=t.getState();for(const u of c.hovered.values())if(!l.length||!l.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const d=u.eventObject.__r3f;if(c.hovered.delete(IT(u)),d!=null&&d.eventCount){const p=d.handlers,g={...u,intersections:l};p.onPointerOut==null||p.onPointerOut(g),p.onPointerLeave==null||p.onPointerLeave(g)}}}function a(l,c){for(let u=0;u<c.length;u++){const h=c[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(l)}}function o(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return c=>{const{internal:u}=t.getState();"pointerId"in c&&u.capturedMap.has(c.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(c.pointerId)&&(u.capturedMap.delete(c.pointerId),s([]))})}}return function(u){const{onPointerMissed:h,internal:d}=t.getState();d.lastEvent.current=u;const p=l==="onPointerMove",g=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",v=r(u,p?i:void 0),b=g?e(u):0;l==="onPointerDown"&&(d.initialClick=[u.offsetX,u.offsetY],d.initialHits=v.map(M=>M.eventObject)),g&&!v.length&&b<=2&&(a(u,d.interaction),h&&h(u)),p&&s(v);function w(M){const E=M.eventObject,D=E.__r3f;if(!(D!=null&&D.eventCount))return;const T=D.handlers;if(p){if(T.onPointerOver||T.onPointerEnter||T.onPointerOut||T.onPointerLeave){const L=IT(M),P=d.hovered.get(L);P?P.stopped&&M.stopPropagation():(d.hovered.set(L,M),T.onPointerOver==null||T.onPointerOver(M),T.onPointerEnter==null||T.onPointerEnter(M))}T.onPointerMove==null||T.onPointerMove(M)}else{const L=T[l];L?(!g||d.initialHits.includes(E))&&(a(u,d.interaction.filter(P=>!d.initialHits.includes(P))),L(M)):g&&d.initialHits.includes(E)&&a(u,d.interaction.filter(P=>!d.initialHits.includes(P)))}}n(v,u,b,w)}}return{handlePointer:o}}const f9=t=>!!(t!=null&&t.render),c$=Me.createContext(null),MFe=(t,e)=>{const i=K4e((o,l)=>{const c=new Se,u=new Se,h=new Se;function d(b=l().camera,w=u,M=l().size){const{width:E,height:D,top:T,left:L}=M,P=E/D;w.isVector3?h.copy(w):h.set(...w);const R=b.getWorldPosition(c).distanceTo(h);if(n$(b))return{width:E/b.zoom,height:D/b.zoom,top:T,left:L,factor:1,distance:R,aspect:P};{const O=b.fov*Math.PI/180,U=2*Math.tan(O/2)*R,F=U*(E/D);return{width:F,height:U,top:T,left:L,factor:E/F,distance:R,aspect:P}}}let p;const g=b=>o(w=>({performance:{...w.performance,current:b}})),x=new Tt;return{set:o,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(b=1)=>t(l(),b),advance:(b,w)=>e(b,w,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new IF,pointer:x,mouse:x,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const b=l();p&&clearTimeout(p),b.performance.current!==b.performance.min&&g(b.performance.min),p=setTimeout(()=>g(l().performance.max),b.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:b=>o(w=>({...w,events:{...w.events,...b}})),setSize:(b,w,M=0,E=0)=>{const D=l().camera,T={width:b,height:w,top:M,left:E};o(L=>({size:T,viewport:{...L.viewport,...d(D,u,T)}}))},setDpr:b=>o(w=>{const M=a$(b);return{viewport:{...w.viewport,dpr:M,initialDpr:w.viewport.initialDpr||M}}}),setFrameloop:(b="always")=>{const w=l().clock;w.stop(),w.elapsedTime=0,b!=="never"&&(w.start(),w.elapsedTime=0),o(()=>({frameloop:b}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:Me.createRef(),active:!1,frames:0,priority:0,subscribe:(b,w,M)=>{const E=l().internal;return E.priority=E.priority+(w>0?1:0),E.subscribers.push({ref:b,priority:w,store:M}),E.subscribers=E.subscribers.sort((D,T)=>D.priority-T.priority),()=>{const D=l().internal;D!=null&&D.subscribers&&(D.priority=D.priority-(w>0?1:0),D.subscribers=D.subscribers.filter(T=>T.ref!==b))}}}}}),r=i.getState();let n=r.size,s=r.viewport.dpr,a=r.camera;return i.subscribe(()=>{const{camera:o,size:l,viewport:c,gl:u,set:h}=i.getState();if(l.width!==n.width||l.height!==n.height||c.dpr!==s){n=l,s=c.dpr,_Fe(o,l),c.dpr>0&&u.setPixelRatio(c.dpr);const d=typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(l.width,l.height,d)}o!==a&&(a=o,h(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(o)}})))}),i.subscribe(o=>t(o)),i};function u$(){const t=Me.useContext(c$);if(!t)throw new Error("R3F: Hooks can only be used within the Canvas component!");return t}function h$(t=i=>i,e){return u$()(t,e)}function FP(t,e=0){const i=u$(),r=i.getState().internal.subscribe,n=s$(t);return qM(()=>r(n,e,i),[e,r,i]),null}function EFe(t){const e=tFe(t);return e.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:Me.version}),e}const d$=0,Q1={},AFe=/^three(?=[A-Z])/,kP=t=>`${t[0].toUpperCase()}${t.slice(1)}`;let TFe=0;const CFe=t=>typeof t=="function";function DFe(t){if(CFe(t)){const e=`${TFe++}`;return Q1[e]=t,e}else Object.assign(Q1,t)}function f$(t,e){const i=kP(t),r=Q1[i];if(t!=="primitive"&&!r)throw new Error(`R3F: ${i} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(t==="primitive"&&!e.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(e.args!==void 0&&!Array.isArray(e.args))throw new Error("R3F: The args prop must be an array!")}function PFe(t,e,i){var r;return t=kP(t)in Q1?t:t.replace(AFe,""),f$(t,e),t==="primitive"&&(r=e.object)!=null&&r.__r3f&&delete e.object.__r3f,d3(e.object,i,t,e)}function RFe(t){if(!t.isHidden){var e;t.props.attach&&(e=t.parent)!=null&&e.object?p3(t.parent,t):Ul(t.object)&&(t.object.visible=!1),t.isHidden=!0,Cb(t)}}function p$(t){if(t.isHidden){var e;t.props.attach&&(e=t.parent)!=null&&e.object?f3(t.parent,t):Ul(t.object)&&t.props.visible!==!1&&(t.object.visible=!0),t.isHidden=!1,Cb(t)}}function HF(t,e,i){const r=e.root.getState();if(!(!t.parent&&t.object!==r.scene)){if(!e.object){var n,s;const a=Q1[kP(e.type)];e.object=(n=e.props.object)!=null?n:new a(...(s=e.props.args)!=null?s:[]),e.object.__r3f=e}if(ig(e.object,e.props),e.props.attach)f3(t,e);else if(Ul(e.object)&&Ul(t.object)){const a=t.object.children.indexOf(i==null?void 0:i.object);if(i&&a!==-1){const o=t.object.children.indexOf(e.object);if(o!==-1){t.object.children.splice(o,1);const l=o<a?a-1:a;t.object.children.splice(l,0,e.object)}else e.object.parent=t.object,t.object.children.splice(a,0,e.object),e.object.dispatchEvent({type:"added"}),t.object.dispatchEvent({type:"childadded",child:e.object})}else t.object.add(e.object)}for(const a of e.children)HF(e,a);Cb(e)}}function GI(t,e){e&&(e.parent=t,t.children.push(e),HF(t,e))}function p9(t,e,i){if(!e||!i)return;e.parent=t;const r=t.children.indexOf(i);r!==-1?t.children.splice(r,0,e):t.children.push(e),HF(t,e,i)}function m$(t){if(typeof t.dispose=="function"){const e=()=>{try{t.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?e():u9.unstable_scheduleCallback(u9.unstable_IdlePriority,e)}}function HB(t,e,i){if(!e)return;e.parent=null;const r=t.children.indexOf(e);r!==-1&&t.children.splice(r,1),e.props.attach?p3(t,e):Ul(e.object)&&Ul(t.object)&&(t.object.remove(e.object),SFe(r$(e),e.object));const n=e.props.dispose!==null&&i!==!1;for(let s=e.children.length-1;s>=0;s--){const a=e.children[s];HB(e,a,n)}e.children.length=0,delete e.object.__r3f,n&&e.type!=="primitive"&&e.object.type!=="Scene"&&m$(e.object),i===void 0&&Cb(e)}function OFe(t,e){for(const i of[t,t.alternate])if(i!==null)if(typeof i.ref=="function"){i.refCleanup==null||i.refCleanup();const r=i.ref(e);typeof r=="function"&&(i.refCleanup=r)}else i.ref&&(i.ref.current=e)}const pC=[];function LFe(){for(const[i]of pC){const r=i.parent;if(r){i.props.attach?p3(r,i):Ul(i.object)&&Ul(r.object)&&r.object.remove(i.object);for(const n of i.children)n.props.attach?p3(i,n):Ul(n.object)&&Ul(i.object)&&i.object.remove(n.object)}i.isHidden&&p$(i),i.object.__r3f&&delete i.object.__r3f,i.type!=="primitive"&&m$(i.object)}for(const[i,r,n]of pC){i.props=r;const s=i.parent;if(s){var t,e;const a=Q1[kP(i.type)];i.object=(t=i.props.object)!=null?t:new a(...(e=i.props.args)!=null?e:[]),i.object.__r3f=i,OFe(n,i.object),ig(i.object,i.props),i.props.attach?f3(s,i):Ul(i.object)&&Ul(s.object)&&s.object.add(i.object);for(const o of i.children)o.props.attach?f3(i,o):Ul(o.object)&&Ul(i.object)&&i.object.add(o.object);Cb(i)}}pC.length=0}const jI=()=>{},m9={};let zT=d$;const IFe=0,zFe=4,GB=EFe({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:PFe,removeChild:HB,appendChild:GI,appendInitialChild:GI,insertBefore:p9,appendChildToContainer(t,e){const i=t.getState().scene.__r3f;!e||!i||GI(i,e)},removeChildFromContainer(t,e){const i=t.getState().scene.__r3f;!e||!i||HB(i,e)},insertInContainerBefore(t,e,i){const r=t.getState().scene.__r3f;!e||!i||!r||p9(r,e,i)},getRootHostContext:()=>m9,getChildHostContext:()=>m9,commitUpdate(t,e,i,r,n){var s,a,o;f$(e,r);let l=!1;if((t.type==="primitive"&&i.object!==r.object||((s=r.args)==null?void 0:s.length)!==((a=i.args)==null?void 0:a.length)||(o=r.args)!=null&&o.some((u,h)=>{var d;return u!==((d=i.args)==null?void 0:d[h])}))&&(l=!0),l)pC.push([t,{...r},n]);else{const u=yFe(t,r);Object.keys(u).length&&(Object.assign(t.props,u),ig(t.object,u))}(n.sibling===null||(n.flags&zFe)===IFe)&&LFe()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:t=>t==null?void 0:t.object,prepareForCommit:()=>null,preparePortalMount:t=>d3(t.getState().scene,t,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:RFe,unhideInstance:p$,createTextInstance:jI,hideTextInstance:jI,unhideTextInstance:jI,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:Me.createContext(null),setCurrentUpdatePriority(t){zT=t},getCurrentUpdatePriority(){return zT},resolveUpdatePriority(){var t;if(zT!==d$)return zT;switch(typeof window<"u"&&((t=window.event)==null?void 0:t.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return fC.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return fC.ContinuousEventPriority;default:return fC.DefaultEventPriority}},resetFormInstance(){}}),q0=new Map,Hx={objects:"shallow",strict:!1};function UFe(t,e){if(!e&&typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&t.parentElement){const{width:i,height:r,top:n,left:s}=t.parentElement.getBoundingClientRect();return{width:i,height:r,top:n,left:s}}else if(!e&&typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...e}}function BFe(t){const e=q0.get(t),i=e==null?void 0:e.fiber,r=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const n=typeof reportError=="function"?reportError:console.error,s=r||MFe(qB,v9),a=i||GB.createContainer(s,fC.ConcurrentRoot,null,!1,null,"",n,n,n,null);e||q0.set(t,{fiber:a,store:s});let o,l,c=!1,u=null;return{async configure(h={}){let d;u=new Promise(j=>d=j);let{gl:p,size:g,scene:x,events:v,onCreated:b,shadows:w=!1,linear:M=!1,flat:E=!1,legacy:D=!1,orthographic:T=!1,frameloop:L="always",dpr:P=[1,2],performance:R,raycaster:O,camera:U,onPointerMissed:F}=h,V=s.getState(),k=V.gl;if(!V.gl){const j={canvas:t,powerPreference:"high-performance",antialias:!0,alpha:!0},ee=typeof p=="function"?await p(j):p;f9(ee)?k=ee:k=new $J({...j,...p}),V.set({gl:k})}let K=V.raycaster;K||V.set({raycaster:K=new WJ});const{params:X,...$}=O||{};if($n.equ($,K,Hx)||ig(K,{...$}),$n.equ(X,K.params,Hx)||ig(K,{params:{...K.params,...X}}),!V.camera||V.camera===l&&!$n.equ(l,U,Hx)){l=U;const j=U==null?void 0:U.isCamera,ee=j?U:T?new WM(0,0,0,0,.1,1e3):new Pa(75,0,.1,1e3);j||(ee.position.z=5,U&&(ig(ee,U),ee.manual||("aspect"in U||"left"in U||"right"in U||"bottom"in U||"top"in U)&&(ee.manual=!0,ee.updateProjectionMatrix())),!V.camera&&!(U!=null&&U.rotation)&&ee.lookAt(0,0,0)),V.set({camera:ee}),K.camera=ee}if(!V.scene){let j;x!=null&&x.isScene?(j=x,d3(j,s,"",{})):(j=new mF,d3(j,s,"",{}),x&&ig(j,x)),V.set({scene:j})}v&&!V.events.handlers&&V.set({events:v(s)});const Y=UFe(t,g);if($n.equ(Y,V.size,Hx)||V.setSize(Y.width,Y.height,Y.top,Y.left),P&&V.viewport.dpr!==a$(P)&&V.setDpr(P),V.frameloop!==L&&V.setFrameloop(L),V.onPointerMissed||V.set({onPointerMissed:F}),R&&!$n.equ(R,V.performance,Hx)&&V.set(j=>({performance:{...j.performance,...R}})),!V.xr){var re;const j=(Q,ae)=>{const ne=s.getState();ne.frameloop!=="never"&&v9(Q,!0,ne,ae)},ee=()=>{const Q=s.getState();Q.gl.xr.enabled=Q.gl.xr.isPresenting,Q.gl.xr.setAnimationLoop(Q.gl.xr.isPresenting?j:null),Q.gl.xr.isPresenting||qB(Q)},oe={connect(){const Q=s.getState().gl;Q.xr.addEventListener("sessionstart",ee),Q.xr.addEventListener("sessionend",ee)},disconnect(){const Q=s.getState().gl;Q.xr.removeEventListener("sessionstart",ee),Q.xr.removeEventListener("sessionend",ee)}};typeof((re=k.xr)==null?void 0:re.addEventListener)=="function"&&oe.connect(),V.set({xr:oe})}if(k.shadowMap){const j=k.shadowMap.enabled,ee=k.shadowMap.type;if(k.shadowMap.enabled=!!w,$n.boo(w))k.shadowMap.type=ow;else if($n.str(w)){var G;const oe={basic:sK,percentage:nP,soft:ow,variance:sh};k.shadowMap.type=(G=oe[w])!=null?G:ow}else $n.obj(w)&&Object.assign(k.shadowMap,w);(j!==k.shadowMap.enabled||ee!==k.shadowMap.type)&&(k.shadowMap.needsUpdate=!0)}return Er.enabled=!D,c||(k.outputColorSpace=M?Ag:Co,k.toneMapping=E?Fd:K4),V.legacy!==D&&V.set(()=>({legacy:D})),V.linear!==M&&V.set(()=>({linear:M})),V.flat!==E&&V.set(()=>({flat:E})),p&&!$n.fun(p)&&!f9(p)&&!$n.equ(p,k,Hx)&&ig(k,p),o=b,c=!0,d(),this},render(h){return!c&&!u&&this.configure(),u.then(()=>{GB.updateContainer(Pe.jsx(NFe,{store:s,children:h,onCreated:o,rootElement:t}),a,null,()=>{})}),s},unmount(){g$(t)}}}function NFe({store:t,children:e,onCreated:i,rootElement:r}){return qM(()=>{const n=t.getState();n.set(s=>({internal:{...s.internal,active:!0}})),i&&i(n),t.getState().events.connected||n.events.connect==null||n.events.connect(r)},[]),Pe.jsx(c$.Provider,{value:t,children:e})}function g$(t,e){const i=q0.get(t),r=i==null?void 0:i.fiber;if(r){const n=i==null?void 0:i.store.getState();n&&(n.internal.active=!1),GB.updateContainer(null,r,null,()=>{n&&setTimeout(()=>{try{var s,a,o,l;n.events.disconnect==null||n.events.disconnect(),(s=n.gl)==null||(a=s.renderLists)==null||a.dispose==null||a.dispose(),(o=n.gl)==null||o.forceContextLoss==null||o.forceContextLoss(),(l=n.gl)!=null&&l.xr&&n.xr.disconnect(),mFe(n.scene),q0.delete(t)}catch{}},500)})}}const FFe=new Set,kFe=new Set,VFe=new Set;function WI(t,e){if(t.size)for(const{callback:i}of t.values())i(e)}function vw(t,e){switch(t){case"before":return WI(FFe,e);case"after":return WI(kFe,e);case"tail":return WI(VFe,e)}}let qI,XI;function jB(t,e,i){let r=e.clock.getDelta();e.frameloop==="never"&&typeof t=="number"&&(r=t-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=t),qI=e.internal.subscribers;for(let n=0;n<qI.length;n++)XI=qI[n],XI.ref.current(XI.store.getState(),r,i);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}let m3=!1,WB=!1,YI,g9,Gx;function v$(t){g9=requestAnimationFrame(v$),m3=!0,YI=0,vw("before",t),WB=!0;for(const i of q0.values()){var e;Gx=i.store.getState(),Gx.internal.active&&(Gx.frameloop==="always"||Gx.internal.frames>0)&&!((e=Gx.gl.xr)!=null&&e.isPresenting)&&(YI+=jB(t,Gx))}if(WB=!1,vw("after",t),YI===0)return vw("tail",t),m3=!1,cancelAnimationFrame(g9)}function qB(t,e=1){var i;if(!t)return q0.forEach(r=>qB(r.store.getState(),e));(i=t.gl.xr)!=null&&i.isPresenting||!t.internal.active||t.frameloop==="never"||(e>1?t.internal.frames=Math.min(60,t.internal.frames+e):WB?t.internal.frames=2:t.internal.frames=1,m3||(m3=!0,requestAnimationFrame(v$)))}function v9(t,e=!0,i,r){if(e&&vw("before",t),i)jB(t,i,r);else for(const n of q0.values())jB(t,n.store.getState());e&&vw("after",t)}const QI={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function HFe(t){const{handlePointer:e}=wFe(t);return{priority:1,enabled:!0,compute(i,r,n){r.pointer.set(i.offsetX/r.size.width*2-1,-(i.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(QI).reduce((i,r)=>({...i,[r]:e(r)}),{}),update:()=>{var i;const{events:r,internal:n}=t.getState();(i=n.lastEvent)!=null&&i.current&&r.handlers&&r.handlers.onPointerMove(n.lastEvent.current)},connect:i=>{const{set:r,events:n}=t.getState();if(n.disconnect==null||n.disconnect(),r(s=>({events:{...s.events,connected:i}})),n.handlers)for(const s in n.handlers){const a=n.handlers[s],[o,l]=QI[s];i.addEventListener(o,a,{passive:l})}},disconnect:()=>{const{set:i,events:r}=t.getState();if(r.connected){if(r.handlers)for(const n in r.handlers){const s=r.handlers[n],[a]=QI[n];r.connected.removeEventListener(a,s)}i(n=>({events:{...n.events,connected:void 0}}))}}}}function y9(t,e){let i;return(...r)=>{window.clearTimeout(i),i=window.setTimeout(()=>t(...r),e)}}function GFe({debounce:t,scroll:e,polyfill:i,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const n=i||(typeof window>"u"?class{}:window.ResizeObserver);if(!n)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,a]=Me.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=Me.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),l=t?typeof t=="number"?t:t.scroll:null,c=t?typeof t=="number"?t:t.resize:null,u=Me.useRef(!1);Me.useEffect(()=>(u.current=!0,()=>void(u.current=!1)));const[h,d,p]=Me.useMemo(()=>{const b=()=>{if(!o.current.element)return;const{left:w,top:M,width:E,height:D,bottom:T,right:L,x:P,y:R}=o.current.element.getBoundingClientRect(),O={left:w,top:M,width:E,height:D,bottom:T,right:L,x:P,y:R};o.current.element instanceof HTMLElement&&r&&(O.height=o.current.element.offsetHeight,O.width=o.current.element.offsetWidth),Object.freeze(O),u.current&&!XFe(o.current.lastBounds,O)&&a(o.current.lastBounds=O)};return[b,c?y9(b,c):b,l?y9(b,l):b]},[a,r,l,c]);function g(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(b=>b.removeEventListener("scroll",p,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function x(){o.current.element&&(o.current.resizeObserver=new n(p),o.current.resizeObserver.observe(o.current.element),e&&o.current.scrollContainers&&o.current.scrollContainers.forEach(b=>b.addEventListener("scroll",p,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{p()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}const v=b=>{!b||b===o.current.element||(g(),o.current.element=b,o.current.scrollContainers=y$(b),x())};return WFe(p,!!e),jFe(d),Me.useEffect(()=>{g(),x()},[e,p,d]),Me.useEffect(()=>g,[]),[v,s,h]}function jFe(t){Me.useEffect(()=>{const e=t;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[t])}function WFe(t,e){Me.useEffect(()=>{if(e){const i=t;return window.addEventListener("scroll",i,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",i,!0)}},[t,e])}function y$(t){const e=[];if(!t||t===document.body)return e;const{overflow:i,overflowX:r,overflowY:n}=window.getComputedStyle(t);return[i,r,n].some(s=>s==="auto"||s==="scroll")&&e.push(t),[...e,...y$(t.parentElement)]}const qFe=["x","y","top","bottom","left","right","width","height"],XFe=(t,e)=>qFe.every(i=>t[i]===e[i]);function YFe({ref:t,children:e,fallback:i,resize:r,style:n,gl:s,events:a=HFe,eventSource:o,eventPrefix:l,shadows:c,linear:u,flat:h,legacy:d,orthographic:p,frameloop:g,dpr:x,performance:v,raycaster:b,camera:w,scene:M,onPointerMissed:E,onCreated:D,...T}){Me.useMemo(()=>DFe(N4e),[]);const L=dFe(),[P,R]=GFe({scroll:!0,debounce:{scroll:50,resize:0},...r}),O=Me.useRef(null),U=Me.useRef(null);Me.useImperativeHandle(t,()=>O.current);const F=s$(E),[V,k]=Me.useState(!1),[K,X]=Me.useState(!1);if(V)throw V;if(K)throw K;const $=Me.useRef(null);qM(()=>{const re=O.current;if(R.width>0&&R.height>0&&re){$.current||($.current=BFe(re));async function G(){await $.current.configure({gl:s,scene:M,events:a,shadows:c,linear:u,flat:h,legacy:d,orthographic:p,frameloop:g,dpr:x,performance:v,raycaster:b,camera:w,size:R,onPointerMissed:(...j)=>F.current==null?void 0:F.current(...j),onCreated:j=>{j.events.connect==null||j.events.connect(o?uFe(o)?o.current:o:U.current),l&&j.setEvents({compute:(ee,oe)=>{const Q=ee[l+"X"],ae=ee[l+"Y"];oe.pointer.set(Q/oe.size.width*2-1,-(ae/oe.size.height)*2+1),oe.raycaster.setFromCamera(oe.pointer,oe.camera)}}),D==null||D(j)}}),$.current.render(Pe.jsx(L,{children:Pe.jsx(pFe,{set:X,children:Pe.jsx(Me.Suspense,{fallback:Pe.jsx(fFe,{set:k}),children:e??null})})}))}G()}}),Me.useEffect(()=>{const re=O.current;if(re)return()=>g$(re)},[]);const Y=o?"none":"auto";return Pe.jsx("div",{ref:U,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:Y,...n},...T,children:Pe.jsx("div",{ref:P,style:{width:"100%",height:"100%"},children:Pe.jsx("canvas",{ref:O,style:{display:"block"},children:i})})})}function QFe(t){return Pe.jsx(t$,{children:Pe.jsx(YFe,{...t})})}function hM(){return hM=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)({}).hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},hM.apply(null,arguments)}var ZFe=Object.defineProperty,KFe=(t,e,i)=>e in t?ZFe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,JFe=(t,e,i)=>(KFe(t,e+"",i),i);let $Fe=class{constructor(){JFe(this,"_listeners")}addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(i)===-1&&r[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const n=r.slice(0);for(let s=0,a=n.length;s<a;s++)n[s].call(this,e);e.target=null}}};var e5e=Object.defineProperty,t5e=(t,e,i)=>e in t?e5e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,jt=(t,e,i)=>(t5e(t,typeof e!="symbol"?e+"":e,i),i);let i5e=class extends $Fe{constructor(e,i){super(),jt(this,"enabled",!0),jt(this,"screen",{left:0,top:0,width:0,height:0}),jt(this,"rotateSpeed",1),jt(this,"zoomSpeed",1.2),jt(this,"panSpeed",.3),jt(this,"noRotate",!1),jt(this,"noZoom",!1),jt(this,"noPan",!1),jt(this,"staticMoving",!1),jt(this,"dynamicDampingFactor",.2),jt(this,"minDistance",0),jt(this,"maxDistance",1/0),jt(this,"keys",["KeyA","KeyS","KeyD"]),jt(this,"mouseButtons",{LEFT:cC.ROTATE,MIDDLE:cC.DOLLY,RIGHT:cC.PAN}),jt(this,"object"),jt(this,"domElement"),jt(this,"cursorZoom",!1),jt(this,"target",new Se),jt(this,"mousePosition",new Tt),jt(this,"STATE",{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4}),jt(this,"EPS",1e-6),jt(this,"lastZoom",1),jt(this,"lastPosition",new Se),jt(this,"cursorVector",new Se),jt(this,"targetVector",new Se),jt(this,"_state",this.STATE.NONE),jt(this,"_keyState",this.STATE.NONE),jt(this,"_eye",new Se),jt(this,"_movePrev",new Tt),jt(this,"_moveCurr",new Tt),jt(this,"_lastAxis",new Se),jt(this,"_lastAngle",0),jt(this,"_zoomStart",new Tt),jt(this,"_zoomEnd",new Tt),jt(this,"_touchZoomDistanceStart",0),jt(this,"_touchZoomDistanceEnd",0),jt(this,"_panStart",new Tt),jt(this,"_panEnd",new Tt),jt(this,"target0"),jt(this,"position0"),jt(this,"up0"),jt(this,"zoom0"),jt(this,"changeEvent",{type:"change"}),jt(this,"startEvent",{type:"start"}),jt(this,"endEvent",{type:"end"}),jt(this,"onScreenVector",new Tt),jt(this,"getMouseOnScreen",(r,n)=>(this.onScreenVector.set((r-this.screen.left)/this.screen.width,(n-this.screen.top)/this.screen.height),this.onScreenVector)),jt(this,"onCircleVector",new Tt),jt(this,"getMouseOnCircle",(r,n)=>(this.onCircleVector.set((r-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-n))/this.screen.width),this.onCircleVector)),jt(this,"axis",new Se),jt(this,"quaternion",new so),jt(this,"eyeDirection",new Se),jt(this,"objectUpDirection",new Se),jt(this,"objectSidewaysDirection",new Se),jt(this,"moveDirection",new Se),jt(this,"angle",0),jt(this,"rotateCamera",()=>{this.moveDirection.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0),this.angle=this.moveDirection.length(),this.angle?(this._eye.copy(this.object.position).sub(this.target),this.eyeDirection.copy(this._eye).normalize(),this.objectUpDirection.copy(this.object.up).normalize(),this.objectSidewaysDirection.crossVectors(this.objectUpDirection,this.eyeDirection).normalize(),this.objectUpDirection.setLength(this._moveCurr.y-this._movePrev.y),this.objectSidewaysDirection.setLength(this._moveCurr.x-this._movePrev.x),this.moveDirection.copy(this.objectUpDirection.add(this.objectSidewaysDirection)),this.axis.crossVectors(this.moveDirection,this._eye).normalize(),this.angle*=this.rotateSpeed,this.quaternion.setFromAxisAngle(this.axis,this.angle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion),this._lastAxis.copy(this.axis),this._lastAngle=this.angle):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),this.quaternion.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion)),this._movePrev.copy(this._moveCurr)}),jt(this,"zoomCamera",()=>{let r;if(this._state===this.STATE.TOUCH_ZOOM_PAN)r=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(r):this.object.isOrthographicCamera?(this.object.zoom/=r,this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type");else{if(r=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,Math.abs(r-1)>this.EPS&&r>0&&(this.object.isPerspectiveCamera?(r>1&&this._eye.length()>=this.maxDistance-this.EPS&&(r=1),this._eye.multiplyScalar(r)):this.object.isOrthographicCamera?(r>1&&this.object.zoom<this.maxDistance*this.maxDistance&&(r=1),this.object.zoom/=r):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor,this.cursorZoom){this.targetVector.copy(this.target).project(this.object);let n=this.cursorVector.set(this.mousePosition.x,this.mousePosition.y,this.targetVector.z).unproject(this.object);this.target.lerpVectors(n,this.target,r)}this.object.isOrthographicCamera&&this.object.updateProjectionMatrix()}}),jt(this,"mouseChange",new Tt),jt(this,"objectUp",new Se),jt(this,"pan",new Se),jt(this,"panCamera",()=>{if(this.domElement&&(this.mouseChange.copy(this._panEnd).sub(this._panStart),this.mouseChange.lengthSq()>this.EPS)){if(this.object.isOrthographicCamera){const r=this.object,n=(r.right-r.left)/this.object.zoom,s=(r.top-r.bottom)/this.object.zoom;this.mouseChange.x*=n,this.mouseChange.y*=s}else this.mouseChange.multiplyScalar(this._eye.length()*this.panSpeed);this.pan.copy(this._eye).cross(this.object.up).setLength(this.mouseChange.x),this.pan.add(this.objectUp.copy(this.object.up).setLength(this.mouseChange.y)),this.object.position.add(this.pan),this.target.add(this.pan),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(this.mouseChange.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}),jt(this,"checkDistances",()=>{(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}),jt(this,"handleResize",()=>{if(!this.domElement)return;const r=this.domElement.getBoundingClientRect(),n=this.domElement.ownerDocument.documentElement;this.screen.left=r.left+window.pageXOffset-n.clientLeft,this.screen.top=r.top+window.pageYOffset-n.clientTop,this.screen.width=r.width,this.screen.height=r.height}),jt(this,"update",()=>{this._eye.subVectors(this.object.position,this.target),this.noRotate||this.rotateCamera(),this.noZoom||this.zoomCamera(),this.noPan||this.panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this.checkDistances(),this.object.lookAt(this.target),this.lastPosition.distanceToSquared(this.object.position)>this.EPS&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||this.lastZoom!==this.object.zoom)&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")}),jt(this,"reset",()=>{this._state=this.STATE.NONE,this._keyState=this.STATE.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.up.copy(this.up0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom}),jt(this,"keydown",r=>{this.enabled!==!1&&(window.removeEventListener("keydown",this.keydown),this._keyState===this.STATE.NONE&&(r.code===this.keys[this.STATE.ROTATE]&&!this.noRotate?this._keyState=this.STATE.ROTATE:r.code===this.keys[this.STATE.ZOOM]&&!this.noZoom?this._keyState=this.STATE.ZOOM:r.code===this.keys[this.STATE.PAN]&&!this.noPan&&(this._keyState=this.STATE.PAN)))}),jt(this,"onPointerDown",r=>{if(this.enabled!==!1)switch(r.pointerType){case"mouse":case"pen":this.onMouseDown(r);break}}),jt(this,"onPointerMove",r=>{if(this.enabled!==!1)switch(r.pointerType){case"mouse":case"pen":this.onMouseMove(r);break}}),jt(this,"onPointerUp",r=>{if(this.enabled!==!1)switch(r.pointerType){case"mouse":case"pen":this.onMouseUp();break}}),jt(this,"keyup",()=>{this.enabled!==!1&&(this._keyState=this.STATE.NONE,window.addEventListener("keydown",this.keydown))}),jt(this,"onMouseDown",r=>{if(!this.domElement)return;if(this._state===this.STATE.NONE)switch(r.button){case this.mouseButtons.LEFT:this._state=this.STATE.ROTATE;break;case this.mouseButtons.MIDDLE:this._state=this.STATE.ZOOM;break;case this.mouseButtons.RIGHT:this._state=this.STATE.PAN;break}const n=this._keyState!==this.STATE.NONE?this._keyState:this._state;n===this.STATE.ROTATE&&!this.noRotate?(this._moveCurr.copy(this.getMouseOnCircle(r.pageX,r.pageY)),this._movePrev.copy(this._moveCurr)):n===this.STATE.ZOOM&&!this.noZoom?(this._zoomStart.copy(this.getMouseOnScreen(r.pageX,r.pageY)),this._zoomEnd.copy(this._zoomStart)):n===this.STATE.PAN&&!this.noPan&&(this._panStart.copy(this.getMouseOnScreen(r.pageX,r.pageY)),this._panEnd.copy(this._panStart)),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.startEvent)}),jt(this,"onMouseMove",r=>{if(this.enabled===!1)return;const n=this._keyState!==this.STATE.NONE?this._keyState:this._state;n===this.STATE.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(r.pageX,r.pageY))):n===this.STATE.ZOOM&&!this.noZoom?this._zoomEnd.copy(this.getMouseOnScreen(r.pageX,r.pageY)):n===this.STATE.PAN&&!this.noPan&&this._panEnd.copy(this.getMouseOnScreen(r.pageX,r.pageY))}),jt(this,"onMouseUp",()=>{this.domElement&&this.enabled!==!1&&(this._state=this.STATE.NONE,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.endEvent))}),jt(this,"mousewheel",r=>{if(this.enabled!==!1&&this.noZoom!==!0){switch(r.preventDefault(),r.deltaMode){case 2:this._zoomStart.y-=r.deltaY*.025;break;case 1:this._zoomStart.y-=r.deltaY*.01;break;default:this._zoomStart.y-=r.deltaY*25e-5;break}this.mousePosition.x=r.offsetX/this.screen.width*2-1,this.mousePosition.y=-(r.offsetY/this.screen.height)*2+1,this.dispatchEvent(this.startEvent),this.dispatchEvent(this.endEvent)}}),jt(this,"touchstart",r=>{if(this.enabled!==!1){switch(r.preventDefault(),r.touches.length){case 1:this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(r.touches[0].pageX,r.touches[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this._state=this.STATE.TOUCH_ZOOM_PAN;const n=r.touches[0].pageX-r.touches[1].pageX,s=r.touches[0].pageY-r.touches[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(n*n+s*s);const a=(r.touches[0].pageX+r.touches[1].pageX)/2,o=(r.touches[0].pageY+r.touches[1].pageY)/2;this._panStart.copy(this.getMouseOnScreen(a,o)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(this.startEvent)}}),jt(this,"touchmove",r=>{if(this.enabled!==!1)switch(r.preventDefault(),r.touches.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(r.touches[0].pageX,r.touches[0].pageY));break;default:const n=r.touches[0].pageX-r.touches[1].pageX,s=r.touches[0].pageY-r.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(n*n+s*s);const a=(r.touches[0].pageX+r.touches[1].pageX)/2,o=(r.touches[0].pageY+r.touches[1].pageY)/2;this._panEnd.copy(this.getMouseOnScreen(a,o));break}}),jt(this,"touchend",r=>{if(this.enabled!==!1){switch(r.touches.length){case 0:this._state=this.STATE.NONE;break;case 1:this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(r.touches[0].pageX,r.touches[0].pageY)),this._movePrev.copy(this._moveCurr);break}this.dispatchEvent(this.endEvent)}}),jt(this,"contextmenu",r=>{this.enabled!==!1&&r.preventDefault()}),jt(this,"connect",r=>{r===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=r,this.domElement.addEventListener("contextmenu",this.contextmenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.mousewheel),this.domElement.addEventListener("touchstart",this.touchstart),this.domElement.addEventListener("touchend",this.touchend),this.domElement.addEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup),this.handleResize()}),jt(this,"dispose",()=>{this.domElement&&(this.domElement.removeEventListener("contextmenu",this.contextmenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.mousewheel),this.domElement.removeEventListener("touchstart",this.touchstart),this.domElement.removeEventListener("touchend",this.touchend),this.domElement.removeEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup))}),this.object=e,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,i!==void 0&&this.connect(i),this.update()}};const r5e=Me.forwardRef(function({children:e,follow:i=!0,lockX:r=!1,lockY:n=!1,lockZ:s=!1,...a},o){const l=Me.useRef(null),c=Me.useRef(null),u=new so;return FP(({camera:h})=>{if(!i||!c.current)return;const d=l.current.rotation.clone();c.current.updateMatrix(),c.current.updateWorldMatrix(!1,!1),c.current.getWorldQuaternion(u),h.getWorldQuaternion(l.current.quaternion).premultiply(u.invert()),r&&(l.current.rotation.x=d.x),n&&(l.current.rotation.y=d.y),s&&(l.current.rotation.z=d.z)}),Me.useImperativeHandle(o,()=>c.current,[]),Me.createElement("group",hM({ref:c},a),Me.createElement("group",{ref:l},e))});function n5e(){var t=Object.create(null);function e(n,s){var a=n.id,o=n.name,l=n.dependencies;l===void 0&&(l=[]);var c=n.init;c===void 0&&(c=function(){});var u=n.getTransferables;if(u===void 0&&(u=null),!t[a])try{l=l.map(function(d){return d&&d.isWorkerModule&&(e(d,function(p){if(p instanceof Error)throw p}),d=t[d.id].value),d}),c=r("<"+o+">.init",c),u&&(u=r("<"+o+">.getTransferables",u));var h=null;typeof c=="function"?h=c.apply(void 0,l):console.error("worker module init function failed to rehydrate"),t[a]={id:a,value:h,getTransferables:u},s(h)}catch(d){d&&d.noLog||console.error(d),s(d)}}function i(n,s){var a,o=n.id,l=n.args;(!t[o]||typeof t[o].value!="function")&&s(new Error("Worker module "+o+": not found or its 'init' did not return a function"));try{var c=(a=t[o]).value.apply(a,l);c&&typeof c.then=="function"?c.then(u,function(h){return s(h instanceof Error?h:new Error(""+h))}):u(c)}catch(h){s(h)}function u(h){try{var d=t[o].getTransferables&&t[o].getTransferables(h);(!d||!Array.isArray(d)||!d.length)&&(d=void 0),s(h,d)}catch(p){console.error(p),s(p)}}}function r(n,s){var a=void 0;self.troikaDefine=function(l){return a=l};var o=URL.createObjectURL(new Blob(["/** "+n.replace(/\*/g,"")+` **/

troikaDefine(
`+s+`
)`],{type:"application/javascript"}));try{importScripts(o)}catch(l){console.error(l)}return URL.revokeObjectURL(o),delete self.troikaDefine,a}self.addEventListener("message",function(n){var s=n.data,a=s.messageId,o=s.action,l=s.data;try{o==="registerModule"&&e(l,function(c){c instanceof Error?postMessage({messageId:a,success:!1,error:c.message}):postMessage({messageId:a,success:!0,result:{isCallable:typeof c=="function"}})}),o==="callModule"&&i(l,function(c,u){c instanceof Error?postMessage({messageId:a,success:!1,error:c.message}):postMessage({messageId:a,success:!0,result:c},u||void 0)})}catch(c){postMessage({messageId:a,success:!1,error:c.stack})}})}function s5e(t){var e=function(){for(var i=[],r=arguments.length;r--;)i[r]=arguments[r];return e._getInitResult().then(function(n){if(typeof n=="function")return n.apply(void 0,i);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var i=t.dependencies,r=t.init;i=Array.isArray(i)?i.map(function(s){return s&&(s=s.onMainThread||s,s._getInitResult&&(s=s._getInitResult())),s}):[];var n=Promise.all(i).then(function(s){return r.apply(null,s)});return e._getInitResult=function(){return n},n},e}var x$=function(){var t=!1;if(typeof window<"u"&&typeof window.document<"u")try{var e=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));e.terminate(),t=!0}catch(i){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+i.message+"]")}return x$=function(){return t},t},a5e=0,o5e=0,ZI=!1,yw=Object.create(null),xw=Object.create(null),XB=Object.create(null);function Db(t){if((!t||typeof t.init!="function")&&!ZI)throw new Error("requires `options.init` function");var e=t.dependencies,i=t.init,r=t.getTransferables,n=t.workerId,s=s5e(t);n==null&&(n="#default");var a="workerModule"+ ++a5e,o=t.name||a,l=null;e=e&&e.map(function(u){return typeof u=="function"&&!u.workerModuleData&&(ZI=!0,u=Db({workerId:n,name:"<"+o+"> function dependency: "+u.name,init:`function(){return (
`+mC(u)+`
)}`}),ZI=!1),u&&u.workerModuleData&&(u=u.workerModuleData),u});function c(){for(var u=[],h=arguments.length;h--;)u[h]=arguments[h];if(!x$())return s.apply(void 0,u);if(!l){l=x9(n,"registerModule",c.workerModuleData);var d=function(){l=null,xw[n].delete(d)};(xw[n]||(xw[n]=new Set)).add(d)}return l.then(function(p){var g=p.isCallable;if(g)return x9(n,"callModule",{id:a,args:u});throw new Error("Worker module function was called but `init` did not return a callable function")})}return c.workerModuleData={isWorkerModule:!0,id:a,name:o,dependencies:e,init:mC(i),getTransferables:r&&mC(r)},c.onMainThread=s,c}function l5e(t){xw[t]&&xw[t].forEach(function(e){e()}),yw[t]&&(yw[t].terminate(),delete yw[t])}function mC(t){var e=t.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function c5e(t){var e=yw[t];if(!e){var i=mC(n5e);e=yw[t]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+t.replace(/\*/g,"")+` **/

;(`+i+")()"],{type:"application/javascript"}))),e.onmessage=function(r){var n=r.data,s=n.messageId,a=XB[s];if(!a)throw new Error("WorkerModule response with empty or unknown messageId");delete XB[s],a(n)}}return e}function x9(t,e,i){return new Promise(function(r,n){var s=++o5e;XB[s]=function(a){a.success?r(a.result):n(new Error("Error in worker "+e+" call: "+a.error))},c5e(t).postMessage({messageId:s,action:e,data:i})})}function b$(){var t=function(e){function i(re,G,j,ee,oe,Q,ae,ne){var ue=1-ae;ne.x=ue*ue*re+2*ue*ae*j+ae*ae*oe,ne.y=ue*ue*G+2*ue*ae*ee+ae*ae*Q}function r(re,G,j,ee,oe,Q,ae,ne,ue,fe){var xe=1-ue;fe.x=xe*xe*xe*re+3*xe*xe*ue*j+3*xe*ue*ue*oe+ue*ue*ue*ae,fe.y=xe*xe*xe*G+3*xe*xe*ue*ee+3*xe*ue*ue*Q+ue*ue*ue*ne}function n(re,G){for(var j=/([MLQCZ])([^MLQCZ]*)/g,ee,oe,Q,ae,ne;ee=j.exec(re);){var ue=ee[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(fe){return parseFloat(fe)});switch(ee[1]){case"M":ae=oe=ue[0],ne=Q=ue[1];break;case"L":(ue[0]!==ae||ue[1]!==ne)&&G("L",ae,ne,ae=ue[0],ne=ue[1]);break;case"Q":{G("Q",ae,ne,ae=ue[2],ne=ue[3],ue[0],ue[1]);break}case"C":{G("C",ae,ne,ae=ue[4],ne=ue[5],ue[0],ue[1],ue[2],ue[3]);break}case"Z":(ae!==oe||ne!==Q)&&G("L",ae,ne,oe,Q);break}}}function s(re,G,j){j===void 0&&(j=16);var ee={x:0,y:0};n(re,function(oe,Q,ae,ne,ue,fe,xe,be,Ce){switch(oe){case"L":G(Q,ae,ne,ue);break;case"Q":{for(var ge=Q,Te=ae,ce=1;ce<j;ce++)i(Q,ae,fe,xe,ne,ue,ce/(j-1),ee),G(ge,Te,ee.x,ee.y),ge=ee.x,Te=ee.y;break}case"C":{for(var Ue=Q,ze=ae,Xe=1;Xe<j;Xe++)r(Q,ae,fe,xe,be,Ce,ne,ue,Xe/(j-1),ee),G(Ue,ze,ee.x,ee.y),Ue=ee.x,ze=ee.y;break}}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",o="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",l=new WeakMap,c={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function u(re,G){var j=re.getContext?re.getContext("webgl",c):re,ee=l.get(j);if(!ee){let xe=function(Ue){var ze=Q[Ue];if(!ze&&(ze=Q[Ue]=j.getExtension(Ue),!ze))throw new Error(Ue+" not supported");return ze},be=function(Ue,ze){var Xe=j.createShader(ze);return j.shaderSource(Xe,Ue),j.compileShader(Xe),Xe},Ce=function(Ue,ze,Xe,De){if(!ae[Ue]){var Ge={},We={},se=j.createProgram();j.attachShader(se,be(ze,j.VERTEX_SHADER)),j.attachShader(se,be(Xe,j.FRAGMENT_SHADER)),j.linkProgram(se),ae[Ue]={program:se,transaction:function(Z){j.useProgram(se),Z({setUniform:function(we,J){for(var He=[],je=arguments.length-2;je-- >0;)He[je]=arguments[je+2];var Ye=We[J]||(We[J]=j.getUniformLocation(se,J));j["uniform"+we].apply(j,[Ye].concat(He))},setAttribute:function(we,J,He,je,Ye){var Ve=Ge[we];Ve||(Ve=Ge[we]={buf:j.createBuffer(),loc:j.getAttribLocation(se,we),data:null}),j.bindBuffer(j.ARRAY_BUFFER,Ve.buf),j.vertexAttribPointer(Ve.loc,J,j.FLOAT,!1,0,0),j.enableVertexAttribArray(Ve.loc),oe?j.vertexAttribDivisor(Ve.loc,je):xe("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(Ve.loc,je),Ye!==Ve.data&&(j.bufferData(j.ARRAY_BUFFER,Ye,He),Ve.data=Ye)}})}}}ae[Ue].transaction(De)},ge=function(Ue,ze){ue++;try{j.activeTexture(j.TEXTURE0+ue);var Xe=ne[Ue];Xe||(Xe=ne[Ue]=j.createTexture(),j.bindTexture(j.TEXTURE_2D,Xe),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.NEAREST),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.NEAREST)),j.bindTexture(j.TEXTURE_2D,Xe),ze(Xe,ue)}finally{ue--}},Te=function(Ue,ze,Xe){var De=j.createFramebuffer();fe.push(De),j.bindFramebuffer(j.FRAMEBUFFER,De),j.activeTexture(j.TEXTURE0+ze),j.bindTexture(j.TEXTURE_2D,Ue),j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,j.TEXTURE_2D,Ue,0);try{Xe(De)}finally{j.deleteFramebuffer(De),j.bindFramebuffer(j.FRAMEBUFFER,fe[--fe.length-1]||null)}},ce=function(){Q={},ae={},ne={},ue=-1,fe.length=0};var oe=typeof WebGL2RenderingContext<"u"&&j instanceof WebGL2RenderingContext,Q={},ae={},ne={},ue=-1,fe=[];j.canvas.addEventListener("webglcontextlost",function(Ue){ce(),Ue.preventDefault()},!1),l.set(j,ee={gl:j,isWebGL2:oe,getExtension:xe,withProgram:Ce,withTexture:ge,withTextureFramebuffer:Te,handleContextLoss:ce})}G(ee)}function h(re,G,j,ee,oe,Q,ae,ne){ae===void 0&&(ae=15),ne===void 0&&(ne=null),u(re,function(ue){var fe=ue.gl,xe=ue.withProgram,be=ue.withTexture;be("copy",function(Ce,ge){fe.texImage2D(fe.TEXTURE_2D,0,fe.RGBA,oe,Q,0,fe.RGBA,fe.UNSIGNED_BYTE,G),xe("copy",a,o,function(Te){var ce=Te.setUniform,Ue=Te.setAttribute;Ue("aUV",2,fe.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),ce("1i","image",ge),fe.bindFramebuffer(fe.FRAMEBUFFER,ne||null),fe.disable(fe.BLEND),fe.colorMask(ae&8,ae&4,ae&2,ae&1),fe.viewport(j,ee,oe,Q),fe.scissor(j,ee,oe,Q),fe.drawArrays(fe.TRIANGLES,0,3)})})})}function d(re,G,j){var ee=re.width,oe=re.height;u(re,function(Q){var ae=Q.gl,ne=new Uint8Array(ee*oe*4);ae.readPixels(0,0,ee,oe,ae.RGBA,ae.UNSIGNED_BYTE,ne),re.width=G,re.height=j,h(ae,ne,0,0,ee,oe)})}var p=Object.freeze({__proto__:null,withWebGLContext:u,renderImageData:h,resizeWebGLCanvasWithoutClearing:d});function g(re,G,j,ee,oe,Q){Q===void 0&&(Q=1);var ae=new Uint8Array(re*G),ne=ee[2]-ee[0],ue=ee[3]-ee[1],fe=[];s(j,function(Ue,ze,Xe,De){fe.push({x1:Ue,y1:ze,x2:Xe,y2:De,minX:Math.min(Ue,Xe),minY:Math.min(ze,De),maxX:Math.max(Ue,Xe),maxY:Math.max(ze,De)})}),fe.sort(function(Ue,ze){return Ue.maxX-ze.maxX});for(var xe=0;xe<re;xe++)for(var be=0;be<G;be++){var Ce=Te(ee[0]+ne*(xe+.5)/re,ee[1]+ue*(be+.5)/G),ge=Math.pow(1-Math.abs(Ce)/oe,Q)/2;Ce<0&&(ge=1-ge),ge=Math.max(0,Math.min(255,Math.round(ge*255))),ae[be*re+xe]=ge}return ae;function Te(Ue,ze){for(var Xe=1/0,De=1/0,Ge=fe.length;Ge--;){var We=fe[Ge];if(We.maxX+De<=Ue)break;if(Ue+De>We.minX&&ze-De<We.maxY&&ze+De>We.minY){var se=b(Ue,ze,We.x1,We.y1,We.x2,We.y2);se<Xe&&(Xe=se,De=Math.sqrt(Xe))}}return ce(Ue,ze)&&(De=-De),De}function ce(Ue,ze){for(var Xe=0,De=fe.length;De--;){var Ge=fe[De];if(Ge.maxX<=Ue)break;var We=Ge.y1>ze!=Ge.y2>ze&&Ue<(Ge.x2-Ge.x1)*(ze-Ge.y1)/(Ge.y2-Ge.y1)+Ge.x1;We&&(Xe+=Ge.y1<Ge.y2?1:-1)}return Xe!==0}}function x(re,G,j,ee,oe,Q,ae,ne,ue,fe){Q===void 0&&(Q=1),ne===void 0&&(ne=0),ue===void 0&&(ue=0),fe===void 0&&(fe=0),v(re,G,j,ee,oe,Q,ae,null,ne,ue,fe)}function v(re,G,j,ee,oe,Q,ae,ne,ue,fe,xe){Q===void 0&&(Q=1),ue===void 0&&(ue=0),fe===void 0&&(fe=0),xe===void 0&&(xe=0);for(var be=g(re,G,j,ee,oe,Q),Ce=new Uint8Array(be.length*4),ge=0;ge<be.length;ge++)Ce[ge*4+xe]=be[ge];h(ae,Ce,ue,fe,re,G,1<<3-xe,ne)}function b(re,G,j,ee,oe,Q){var ae=oe-j,ne=Q-ee,ue=ae*ae+ne*ne,fe=ue?Math.max(0,Math.min(1,((re-j)*ae+(G-ee)*ne)/ue)):0,xe=re-(j+fe*ae),be=G-(ee+fe*ne);return xe*xe+be*be}var w=Object.freeze({__proto__:null,generate:g,generateIntoCanvas:x,generateIntoFramebuffer:v}),M="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",E="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",D="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",T=new Float32Array([0,0,2,0,0,2]),L=null,P=!1,R={},O=new WeakMap;function U(re){if(!P&&!K(re))throw new Error("WebGL generation not supported")}function F(re,G,j,ee,oe,Q,ae){if(Q===void 0&&(Q=1),ae===void 0&&(ae=null),!ae&&(ae=L,!ae)){var ne=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!ne)throw new Error("OffscreenCanvas or DOM canvas not supported");ae=L=ne.getContext("webgl",{depth:!1})}U(ae);var ue=new Uint8Array(re*G*4);u(ae,function(Ce){var ge=Ce.gl,Te=Ce.withTexture,ce=Ce.withTextureFramebuffer;Te("readable",function(Ue,ze){ge.texImage2D(ge.TEXTURE_2D,0,ge.RGBA,re,G,0,ge.RGBA,ge.UNSIGNED_BYTE,null),ce(Ue,ze,function(Xe){k(re,G,j,ee,oe,Q,ge,Xe,0,0,0),ge.readPixels(0,0,re,G,ge.RGBA,ge.UNSIGNED_BYTE,ue)})})});for(var fe=new Uint8Array(re*G),xe=0,be=0;xe<ue.length;xe+=4)fe[be++]=ue[xe];return fe}function V(re,G,j,ee,oe,Q,ae,ne,ue,fe){Q===void 0&&(Q=1),ne===void 0&&(ne=0),ue===void 0&&(ue=0),fe===void 0&&(fe=0),k(re,G,j,ee,oe,Q,ae,null,ne,ue,fe)}function k(re,G,j,ee,oe,Q,ae,ne,ue,fe,xe){Q===void 0&&(Q=1),ue===void 0&&(ue=0),fe===void 0&&(fe=0),xe===void 0&&(xe=0),U(ae);var be=[];s(j,function(Ce,ge,Te,ce){be.push(Ce,ge,Te,ce)}),be=new Float32Array(be),u(ae,function(Ce){var ge=Ce.gl,Te=Ce.isWebGL2,ce=Ce.getExtension,Ue=Ce.withProgram,ze=Ce.withTexture,Xe=Ce.withTextureFramebuffer,De=Ce.handleContextLoss;if(ze("rawDistances",function(Ge,We){(re!==Ge._lastWidth||G!==Ge._lastHeight)&&ge.texImage2D(ge.TEXTURE_2D,0,ge.RGBA,Ge._lastWidth=re,Ge._lastHeight=G,0,ge.RGBA,ge.UNSIGNED_BYTE,null),Ue("main",M,E,function(se){var H=se.setAttribute,Z=se.setUniform,pe=!Te&&ce("ANGLE_instanced_arrays"),we=!Te&&ce("EXT_blend_minmax");H("aUV",2,ge.STATIC_DRAW,0,T),H("aLineSegment",4,ge.DYNAMIC_DRAW,1,be),Z.apply(void 0,["4f","uGlyphBounds"].concat(ee)),Z("1f","uMaxDistance",oe),Z("1f","uExponent",Q),Xe(Ge,We,function(J){ge.enable(ge.BLEND),ge.colorMask(!0,!0,!0,!0),ge.viewport(0,0,re,G),ge.scissor(0,0,re,G),ge.blendFunc(ge.ONE,ge.ONE),ge.blendEquationSeparate(ge.FUNC_ADD,Te?ge.MAX:we.MAX_EXT),ge.clear(ge.COLOR_BUFFER_BIT),Te?ge.drawArraysInstanced(ge.TRIANGLES,0,3,be.length/4):pe.drawArraysInstancedANGLE(ge.TRIANGLES,0,3,be.length/4)})}),Ue("post",a,D,function(se){se.setAttribute("aUV",2,ge.STATIC_DRAW,0,T),se.setUniform("1i","tex",We),ge.bindFramebuffer(ge.FRAMEBUFFER,ne),ge.disable(ge.BLEND),ge.colorMask(xe===0,xe===1,xe===2,xe===3),ge.viewport(ue,fe,re,G),ge.scissor(ue,fe,re,G),ge.drawArrays(ge.TRIANGLES,0,3)})}),ge.isContextLost())throw De(),new Error("webgl context lost")})}function K(re){var G=!re||re===L?R:re.canvas||re,j=O.get(G);if(j===void 0){P=!0;var ee=null;try{var oe=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],Q=F(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,re);j=Q&&oe.length===Q.length&&Q.every(function(ae,ne){return ae===oe[ne]}),j||(ee="bad trial run results",console.info(oe,Q))}catch(ae){j=!1,ee=ae.message}ee&&console.warn("WebGL SDF generation not supported:",ee),P=!1,O.set(G,j)}return j}var X=Object.freeze({__proto__:null,generate:F,generateIntoCanvas:V,generateIntoFramebuffer:k,isSupported:K});function $(re,G,j,ee,oe,Q){oe===void 0&&(oe=Math.max(ee[2]-ee[0],ee[3]-ee[1])/2),Q===void 0&&(Q=1);try{return F.apply(X,arguments)}catch(ae){return console.info("WebGL SDF generation failed, falling back to JS",ae),g.apply(w,arguments)}}function Y(re,G,j,ee,oe,Q,ae,ne,ue,fe){oe===void 0&&(oe=Math.max(ee[2]-ee[0],ee[3]-ee[1])/2),Q===void 0&&(Q=1),ne===void 0&&(ne=0),ue===void 0&&(ue=0),fe===void 0&&(fe=0);try{return V.apply(X,arguments)}catch(xe){return console.info("WebGL SDF generation failed, falling back to JS",xe),x.apply(w,arguments)}}return e.forEachPathCommand=n,e.generate=$,e.generateIntoCanvas=Y,e.javascript=w,e.pathToLineSegments=s,e.webgl=X,e.webglUtils=p,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return t}function u5e(){var t=function(e){var i={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},r={},n={};r.L=1,n[1]="L",Object.keys(i).forEach(function(De,Ge){r[De]=1<<Ge+1,n[r[De]]=De}),Object.freeze(r);var s=r.LRI|r.RLI|r.FSI,a=r.L|r.R|r.AL,o=r.B|r.S|r.WS|r.ON|r.FSI|r.LRI|r.RLI|r.PDI,l=r.BN|r.RLE|r.LRE|r.RLO|r.LRO|r.PDF,c=r.S|r.WS|r.B|s|r.PDI|l,u=null;function h(){if(!u){u=new Map;var De=function(We){if(i.hasOwnProperty(We)){var se=0;i[We].split(",").forEach(function(H){var Z=H.split("+"),pe=Z[0],we=Z[1];pe=parseInt(pe,36),we=we?parseInt(we,36):0,u.set(se+=pe,r[We]);for(var J=0;J<we;J++)u.set(++se,r[We])})}};for(var Ge in i)De(Ge)}}function d(De){return h(),u.get(De.codePointAt(0))||r.L}function p(De){return n[d(De)]}var g={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function x(De,Ge){var We=36,se=0,H=new Map,Z=Ge&&new Map,pe;return De.split(",").forEach(function we(J){if(J.indexOf("+")!==-1)for(var He=+J;He--;)we(pe);else{pe=J;var je=J.split(">"),Ye=je[0],Ve=je[1];Ye=String.fromCodePoint(se+=parseInt(Ye,We)),Ve=String.fromCodePoint(se+=parseInt(Ve,We)),H.set(Ye,Ve),Ge&&Z.set(Ve,Ye)}}),{map:H,reverseMap:Z}}var v,b,w;function M(){if(!v){var De=x(g.pairs,!0),Ge=De.map,We=De.reverseMap;v=Ge,b=We,w=x(g.canonical,!1).map}}function E(De){return M(),v.get(De)||null}function D(De){return M(),b.get(De)||null}function T(De){return M(),w.get(De)||null}var L=r.L,P=r.R,R=r.EN,O=r.ES,U=r.ET,F=r.AN,V=r.CS,k=r.B,K=r.S,X=r.ON,$=r.BN,Y=r.NSM,re=r.AL,G=r.LRO,j=r.RLO,ee=r.LRE,oe=r.RLE,Q=r.PDF,ae=r.LRI,ne=r.RLI,ue=r.FSI,fe=r.PDI;function xe(De,Ge){for(var We=125,se=new Uint32Array(De.length),H=0;H<De.length;H++)se[H]=d(De[H]);var Z=new Map;function pe(Xs,uo){var as=se[Xs];se[Xs]=uo,Z.set(as,Z.get(as)-1),as&o&&Z.set(o,Z.get(o)-1),Z.set(uo,(Z.get(uo)||0)+1),uo&o&&Z.set(o,(Z.get(o)||0)+1)}for(var we=new Uint8Array(De.length),J=new Map,He=[],je=null,Ye=0;Ye<De.length;Ye++)je||He.push(je={start:Ye,end:De.length-1,level:Ge==="rtl"?1:Ge==="ltr"?0:Bg(Ye,!1)}),se[Ye]&k&&(je.end=Ye,je=null);for(var Ve=oe|ee|j|G|s|fe|Q|k,Ke=function(Xs){return Xs+(Xs&1?1:2)},at=function(Xs){return Xs+(Xs&1?2:1)},ut=0;ut<He.length;ut++){je=He[ut];var ht=[{_level:je.level,_override:0,_isolate:0}],$e=void 0,St=0,Pt=0,Kt=0;Z.clear();for(var le=je.start;le<=je.end;le++){var Re=se[le];if($e=ht[ht.length-1],Z.set(Re,(Z.get(Re)||0)+1),Re&o&&Z.set(o,(Z.get(o)||0)+1),Re&Ve)if(Re&(oe|ee)){we[le]=$e._level;var Ee=(Re===oe?at:Ke)($e._level);Ee<=We&&!St&&!Pt?ht.push({_level:Ee,_override:0,_isolate:0}):St||Pt++}else if(Re&(j|G)){we[le]=$e._level;var Qe=(Re===j?at:Ke)($e._level);Qe<=We&&!St&&!Pt?ht.push({_level:Qe,_override:Re&j?P:L,_isolate:0}):St||Pt++}else if(Re&s){Re&ue&&(Re=Bg(le+1,!0)===1?ne:ae),we[le]=$e._level,$e._override&&pe(le,$e._override);var ot=(Re===ne?at:Ke)($e._level);ot<=We&&St===0&&Pt===0?(Kt++,ht.push({_level:ot,_override:0,_isolate:1,_isolInitIndex:le})):St++}else if(Re&fe){if(St>0)St--;else if(Kt>0){for(Pt=0;!ht[ht.length-1]._isolate;)ht.pop();var pt=ht[ht.length-1]._isolInitIndex;pt!=null&&(J.set(pt,le),J.set(le,pt)),ht.pop(),Kt--}$e=ht[ht.length-1],we[le]=$e._level,$e._override&&pe(le,$e._override)}else Re&Q?(St===0&&(Pt>0?Pt--:!$e._isolate&&ht.length>1&&(ht.pop(),$e=ht[ht.length-1])),we[le]=$e._level):Re&k&&(we[le]=je.level);else we[le]=$e._level,$e._override&&Re!==$&&pe(le,$e._override)}for(var Bt=[],Jt=null,qt=je.start;qt<=je.end;qt++){var Ft=se[qt];if(!(Ft&l)){var Ni=we[qt],Oi=Ft&s,Tr=Ft===fe;Jt&&Ni===Jt._level?(Jt._end=qt,Jt._endsWithIsolInit=Oi):Bt.push(Jt={_start:qt,_end:qt,_level:Ni,_startsWithPDI:Tr,_endsWithIsolInit:Oi})}}for(var Dn=[],pn=0;pn<Bt.length;pn++){var Fr=Bt[pn];if(!Fr._startsWithPDI||Fr._startsWithPDI&&!J.has(Fr._start)){for(var _e=[Jt=Fr],tt=void 0;Jt&&Jt._endsWithIsolInit&&(tt=J.get(Jt._end))!=null;)for(var ct=pn+1;ct<Bt.length;ct++)if(Bt[ct]._start===tt){_e.push(Jt=Bt[ct]);break}for(var qe=[],it=0;it<_e.length;it++)for(var Gt=_e[it],oi=Gt._start;oi<=Gt._end;oi++)qe.push(oi);for(var gi=we[qe[0]],ri=je.level,Wi=qe[0]-1;Wi>=0;Wi--)if(!(se[Wi]&l)){ri=we[Wi];break}var mi=qe[qe.length-1],Mi=we[mi],hi=je.level;if(!(se[mi]&s)){for(var de=mi+1;de<=je.end;de++)if(!(se[de]&l)){hi=we[de];break}}Dn.push({_seqIndices:qe,_sosType:Math.max(ri,gi)%2?P:L,_eosType:Math.max(hi,Mi)%2?P:L})}}for(var ke=0;ke<Dn.length;ke++){var rt=Dn[ke],Ie=rt._seqIndices,Fe=rt._sosType,Dt=rt._eosType,xt=we[Ie[0]]&1?P:L;if(Z.get(Y))for(var Nt=0;Nt<Ie.length;Nt++){var kt=Ie[Nt];if(se[kt]&Y){for(var li=Fe,ii=Nt-1;ii>=0;ii--)if(!(se[Ie[ii]]&l)){li=se[Ie[ii]];break}pe(kt,li&(s|fe)?X:li)}}if(Z.get(R))for(var te=0;te<Ie.length;te++){var he=Ie[te];if(se[he]&R)for(var Ae=te-1;Ae>=-1;Ae--){var me=Ae===-1?Fe:se[Ie[Ae]];if(me&a){me===re&&pe(he,F);break}}}if(Z.get(re))for(var Ne=0;Ne<Ie.length;Ne++){var mt=Ie[Ne];se[mt]&re&&pe(mt,P)}if(Z.get(O)||Z.get(V))for(var ei=1;ei<Ie.length-1;ei++){var jr=Ie[ei];if(se[jr]&(O|V)){for(var Li=0,Pn=0,Un=ei-1;Un>=0&&(Li=se[Ie[Un]],!!(Li&l));Un--);for(var _n=ei+1;_n<Ie.length&&(Pn=se[Ie[_n]],!!(Pn&l));_n++);Li===Pn&&(se[jr]===O?Li===R:Li&(R|F))&&pe(jr,Li)}}if(Z.get(R))for(var zr=0;zr<Ie.length;zr++){var Or=Ie[zr];if(se[Or]&R){for(var Vn=zr-1;Vn>=0&&se[Ie[Vn]]&(U|l);Vn--)pe(Ie[Vn],R);for(zr++;zr<Ie.length&&se[Ie[zr]]&(U|l|R);zr++)se[Ie[zr]]!==R&&pe(Ie[zr],R)}}if(Z.get(U)||Z.get(O)||Z.get(V))for(var Rn=0;Rn<Ie.length;Rn++){var mn=Ie[Rn];if(se[mn]&(U|O|V)){pe(mn,X);for(var On=Rn-1;On>=0&&se[Ie[On]]&l;On--)pe(Ie[On],X);for(var ha=Rn+1;ha<Ie.length&&se[Ie[ha]]&l;ha++)pe(Ie[ha],X)}}if(Z.get(R))for(var _s=0,sf=Fe;_s<Ie.length;_s++){var Th=Ie[_s],af=se[Th];af&R?sf===L&&pe(Th,L):af&a&&(sf=af)}if(Z.get(o)){var Zl=P|R|F,Ug=Zl|L,of=[];{for(var pl=[],Kl=0;Kl<Ie.length;Kl++)if(se[Ie[Kl]]&o){var Jl=De[Ie[Kl]],wc=void 0;if(E(Jl)!==null)if(pl.length<63)pl.push({char:Jl,seqIndex:Kl});else break;else if((wc=D(Jl))!==null)for(var No=pl.length-1;No>=0;No--){var Ch=pl[No].char;if(Ch===wc||Ch===D(T(Jl))||E(T(Ch))===Jl){of.push([pl[No].seqIndex,Kl]),pl.length=No;break}}}of.sort(function(Xs,uo){return Xs[0]-uo[0]})}for(var Dh=0;Dh<of.length;Dh++){for(var Vp=of[Dh],$l=Vp[0],cu=Vp[1],uu=!1,Hn=0,lf=$l+1;lf<cu;lf++){var cf=Ie[lf];if(se[cf]&Ug){uu=!0;var Hp=se[cf]&Zl?P:L;if(Hp===xt){Hn=Hp;break}}}if(uu&&!Hn){Hn=Fe;for(var ml=$l-1;ml>=0;ml--){var hu=Ie[ml];if(se[hu]&Ug){var Ph=se[hu]&Zl?P:L;Ph!==xt?Hn=Ph:Hn=xt;break}}}if(Hn){if(se[Ie[$l]]=se[Ie[cu]]=Hn,Hn!==xt){for(var Gn=$l+1;Gn<Ie.length;Gn++)if(!(se[Ie[Gn]]&l)){d(De[Ie[Gn]])&Y&&(se[Ie[Gn]]=Hn);break}}if(Hn!==xt){for(var co=cu+1;co<Ie.length;co++)if(!(se[Ie[co]]&l)){d(De[Ie[co]])&Y&&(se[Ie[co]]=Hn);break}}}}for(var Ba=0;Ba<Ie.length;Ba++)if(se[Ie[Ba]]&o){for(var du=Ba,Gp=Ba,Fo=Fe,gl=Ba-1;gl>=0;gl--)if(se[Ie[gl]]&l)du=gl;else{Fo=se[Ie[gl]]&Zl?P:L;break}for(var fu=Dt,vl=Ba+1;vl<Ie.length;vl++)if(se[Ie[vl]]&(o|l))Gp=vl;else{fu=se[Ie[vl]]&Zl?P:L;break}for(var uf=du;uf<=Gp;uf++)se[Ie[uf]]=Fo===fu?Fo:xt;Ba=Gp}}}for(var da=je.start;da<=je.end;da++){var Pb=we[da],Bn=se[da];if(Pb&1?Bn&(L|R|F)&&we[da]++:Bn&P?we[da]++:Bn&(F|R)&&(we[da]+=2),Bn&l&&(we[da]=da===0?je.level:we[da-1]),da===je.end||d(De[da])&(K|k))for(var pu=da;pu>=0&&d(De[pu])&c;pu--)we[pu]=je.level}}return{levels:we,paragraphs:He};function Bg(Xs,uo){for(var as=Xs;as<De.length;as++){var ko=se[as];if(ko&(P|re))return 1;if(ko&(k|L)||uo&&ko===fe)return 0;if(ko&s){var Ng=ry(as);as=Ng===-1?De.length:Ng}}return 0}function ry(Xs){for(var uo=1,as=Xs+1;as<De.length;as++){var ko=se[as];if(ko&k)break;if(ko&fe){if(--uo===0)return as}else ko&s&&uo++}return-1}}var be="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",Ce;function ge(){if(!Ce){var De=x(be,!0),Ge=De.map,We=De.reverseMap;We.forEach(function(se,H){Ge.set(H,se)}),Ce=Ge}}function Te(De){return ge(),Ce.get(De)||null}function ce(De,Ge,We,se){var H=De.length;We=Math.max(0,We==null?0:+We),se=Math.min(H-1,se==null?H-1:+se);for(var Z=new Map,pe=We;pe<=se;pe++)if(Ge[pe]&1){var we=Te(De[pe]);we!==null&&Z.set(pe,we)}return Z}function Ue(De,Ge,We,se){var H=De.length;We=Math.max(0,We==null?0:+We),se=Math.min(H-1,se==null?H-1:+se);var Z=[];return Ge.paragraphs.forEach(function(pe){var we=Math.max(We,pe.start),J=Math.min(se,pe.end);if(we<J){for(var He=Ge.levels.slice(we,J+1),je=J;je>=we&&d(De[je])&c;je--)He[je]=pe.level;for(var Ye=pe.level,Ve=1/0,Ke=0;Ke<He.length;Ke++){var at=He[Ke];at>Ye&&(Ye=at),at<Ve&&(Ve=at|1)}for(var ut=Ye;ut>=Ve;ut--)for(var ht=0;ht<He.length;ht++)if(He[ht]>=ut){for(var $e=ht;ht+1<He.length&&He[ht+1]>=ut;)ht++;ht>$e&&Z.push([$e+we,ht+we])}}}),Z}function ze(De,Ge,We,se){var H=Xe(De,Ge,We,se),Z=[].concat(De);return H.forEach(function(pe,we){Z[we]=(Ge.levels[pe]&1?Te(De[pe]):null)||De[pe]}),Z.join("")}function Xe(De,Ge,We,se){for(var H=Ue(De,Ge,We,se),Z=[],pe=0;pe<De.length;pe++)Z[pe]=pe;return H.forEach(function(we){for(var J=we[0],He=we[1],je=Z.slice(J,He+1),Ye=je.length;Ye--;)Z[He-Ye]=je[Ye]}),Z}return e.closingToOpeningBracket=D,e.getBidiCharType=d,e.getBidiCharTypeName=p,e.getCanonicalBracket=T,e.getEmbeddingLevels=xe,e.getMirroredCharacter=Te,e.getMirroredCharactersMap=ce,e.getReorderSegments=Ue,e.getReorderedIndices=Xe,e.getReorderedString=ze,e.openingToClosingBracket=E,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return t}const _$=/\bvoid\s+main\s*\(\s*\)\s*{/g;function YB(t){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;function i(r,n){let s=Ji[n];return s?YB(s):r}return t.replace(e,i)}const Ya=[];for(let t=0;t<256;t++)Ya[t]=(t<16?"0":"")+t.toString(16);function h5e(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Ya[t&255]+Ya[t>>8&255]+Ya[t>>16&255]+Ya[t>>24&255]+"-"+Ya[e&255]+Ya[e>>8&255]+"-"+Ya[e>>16&15|64]+Ya[e>>24&255]+"-"+Ya[i&63|128]+Ya[i>>8&255]+"-"+Ya[i>>16&255]+Ya[i>>24&255]+Ya[r&255]+Ya[r>>8&255]+Ya[r>>16&255]+Ya[r>>24&255]).toUpperCase()}const jv=Object.assign||function(){let t=arguments[0];for(let e=1,i=arguments.length;e<i;e++){let r=arguments[e];if(r)for(let n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},d5e=Date.now(),b9=new WeakMap,_9=new Map;let f5e=1e10;function QB(t,e){const i=v5e(e);let r=b9.get(t);if(r||b9.set(t,r=Object.create(null)),r[i])return new r[i];const n=`_onBeforeCompile${i}`,s=function(c,u){t.onBeforeCompile.call(this,c,u);const h=this.customProgramCacheKey()+"|"+c.vertexShader+"|"+c.fragmentShader;let d=_9[h];if(!d){const p=p5e(this,c,e,i);d=_9[h]=p}c.vertexShader=d.vertexShader,c.fragmentShader=d.fragmentShader,jv(c.uniforms,this.uniforms),e.timeUniform&&(c.uniforms[e.timeUniform]={get value(){return Date.now()-d5e}}),this[n]&&this[n](c)},a=function(){return o(e.chained?t:t.clone())},o=function(c){const u=Object.create(c,l);return Object.defineProperty(u,"baseMaterial",{value:t}),Object.defineProperty(u,"id",{value:f5e++}),u.uuid=h5e(),u.uniforms=jv({},c.uniforms,e.uniforms),u.defines=jv({},c.defines,e.defines),u.defines[`TROIKA_DERIVED_MATERIAL_${i}`]="",u.extensions=jv({},c.extensions,e.extensions),u._listeners=void 0,u},l={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>t.type,set:c=>{t.type=c}},isDerivedFrom:{writable:!0,configurable:!0,value:function(c){const u=this.baseMaterial;return c===u||u.isDerivedMaterial&&u.isDerivedFrom(c)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return t.customProgramCacheKey()+"|"+i}},onBeforeCompile:{get(){return s},set(c){this[n]=c}},copy:{writable:!0,configurable:!0,value:function(c){return t.copy.call(this,c),!t.isShaderMaterial&&!t.isDerivedMaterial&&(jv(this.extensions,c.extensions),jv(this.defines,c.defines),jv(this.uniforms,pF.clone(c.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const c=new t.constructor;return o(c).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let c=this._depthMaterial;return c||(c=this._depthMaterial=QB(t.isDerivedMaterial?t.getDepthMaterial():new zP({depthPacking:cF}),e),c.defines.IS_DEPTH_MATERIAL="",c.uniforms=this.uniforms),c}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let c=this._distanceMaterial;return c||(c=this._distanceMaterial=QB(t.isDerivedMaterial?t.getDistanceMaterial():new UP,e),c.defines.IS_DISTANCE_MATERIAL="",c.uniforms=this.uniforms),c}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:c,_distanceMaterial:u}=this;c&&c.dispose(),u&&u.dispose(),t.dispose.call(this)}}};return r[i]=a,new a}function p5e(t,{vertexShader:e,fragmentShader:i},r,n){let{vertexDefs:s,vertexMainIntro:a,vertexMainOutro:o,vertexTransform:l,fragmentDefs:c,fragmentMainIntro:u,fragmentMainOutro:h,fragmentColorTransform:d,customRewriter:p,timeUniform:g}=r;if(s=s||"",a=a||"",o=o||"",c=c||"",u=u||"",h=h||"",(l||p)&&(e=YB(e)),(d||p)&&(i=i.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),i=YB(i)),p){let x=p({vertexShader:e,fragmentShader:i});e=x.vertexShader,i=x.fragmentShader}if(d){let x=[];i=i.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,v=>(x.push(v),"")),h=`${d}
${x.join(`
`)}
${h}`}if(g){const x=`
uniform float ${g};
`;s=x+s,c=x+c}return l&&(e=`vec3 troika_position_${n};
vec3 troika_normal_${n};
vec2 troika_uv_${n};
${e}
`,s=`${s}
void troikaVertexTransform${n}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${l}
}
`,a=`
troika_position_${n} = vec3(position);
troika_normal_${n} = vec3(normal);
troika_uv_${n} = vec2(uv);
troikaVertexTransform${n}(troika_position_${n}, troika_normal_${n}, troika_uv_${n});
${a}
`,e=e.replace(/\b(position|normal|uv)\b/g,(x,v,b,w)=>/\battribute\s+vec[23]\s+$/.test(w.substr(0,b))?v:`troika_${v}_${n}`),t.map&&t.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${n}`))),e=S9(e,n,s,a,o),i=S9(i,n,c,u,h),{vertexShader:e,fragmentShader:i}}function S9(t,e,i,r,n){return(r||n||i)&&(t=t.replace(_$,`
${i}
void troikaOrigMain${e}() {`),t+=`
void main() {
  ${r}
  troikaOrigMain${e}();
  ${n}
}`),t}function m5e(t,e){return t==="uniforms"?void 0:typeof e=="function"?e.toString():e}let g5e=0;const w9=new Map;function v5e(t){const e=JSON.stringify(t,m5e);let i=w9.get(e);return i==null&&w9.set(e,i=++g5e),i}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function y5e(){return typeof window>"u"&&(self.window=self),function(t){var e={parse:function(n){var s=e._bin,a=new Uint8Array(n);if(s.readASCII(a,0,4)=="ttcf"){var o=4;s.readUshort(a,o),o+=2,s.readUshort(a,o),o+=2;var l=s.readUint(a,o);o+=4;for(var c=[],u=0;u<l;u++){var h=s.readUint(a,o);o+=4,c.push(e._readFont(a,h))}return c}return[e._readFont(a,0)]},_readFont:function(n,s){var a=e._bin,o=s;a.readFixed(n,s),s+=4;var l=a.readUshort(n,s);s+=2,a.readUshort(n,s),s+=2,a.readUshort(n,s),s+=2,a.readUshort(n,s),s+=2;for(var c=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],u={_data:n,_offset:o},h={},d=0;d<l;d++){var p=a.readASCII(n,s,4);s+=4,a.readUint(n,s),s+=4;var g=a.readUint(n,s);s+=4;var x=a.readUint(n,s);s+=4,h[p]={offset:g,length:x}}for(d=0;d<c.length;d++){var v=c[d];h[v]&&(u[v.trim()]=e[v.trim()].parse(n,h[v].offset,h[v].length,u))}return u},_tabOffset:function(n,s,a){for(var o=e._bin,l=o.readUshort(n,a+4),c=a+12,u=0;u<l;u++){var h=o.readASCII(n,c,4);c+=4,o.readUint(n,c),c+=4;var d=o.readUint(n,c);if(c+=4,o.readUint(n,c),c+=4,h==s)return d}return 0}};e._bin={readFixed:function(n,s){return(n[s]<<8|n[s+1])+(n[s+2]<<8|n[s+3])/65540},readF2dot14:function(n,s){return e._bin.readShort(n,s)/16384},readInt:function(n,s){return e._bin._view(n).getInt32(s)},readInt8:function(n,s){return e._bin._view(n).getInt8(s)},readShort:function(n,s){return e._bin._view(n).getInt16(s)},readUshort:function(n,s){return e._bin._view(n).getUint16(s)},readUshorts:function(n,s,a){for(var o=[],l=0;l<a;l++)o.push(e._bin.readUshort(n,s+2*l));return o},readUint:function(n,s){return e._bin._view(n).getUint32(s)},readUint64:function(n,s){return 4294967296*e._bin.readUint(n,s)+e._bin.readUint(n,s+4)},readASCII:function(n,s,a){for(var o="",l=0;l<a;l++)o+=String.fromCharCode(n[s+l]);return o},readUnicode:function(n,s,a){for(var o="",l=0;l<a;l++){var c=n[s++]<<8|n[s++];o+=String.fromCharCode(c)}return o},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(n,s,a){var o=e._bin._tdec;return o&&s==0&&a==n.length?o.decode(n):e._bin.readASCII(n,s,a)},readBytes:function(n,s,a){for(var o=[],l=0;l<a;l++)o.push(n[s+l]);return o},readASCIIArray:function(n,s,a){for(var o=[],l=0;l<a;l++)o.push(String.fromCharCode(n[s+l]));return o},_view:function(n){return n._dataView||(n._dataView=n.buffer?new DataView(n.buffer,n.byteOffset,n.byteLength):new DataView(new Uint8Array(n).buffer))}},e._lctf={},e._lctf.parse=function(n,s,a,o,l){var c=e._bin,u={},h=s;c.readFixed(n,s),s+=4;var d=c.readUshort(n,s);s+=2;var p=c.readUshort(n,s);s+=2;var g=c.readUshort(n,s);return s+=2,u.scriptList=e._lctf.readScriptList(n,h+d),u.featureList=e._lctf.readFeatureList(n,h+p),u.lookupList=e._lctf.readLookupList(n,h+g,l),u},e._lctf.readLookupList=function(n,s,a){var o=e._bin,l=s,c=[],u=o.readUshort(n,s);s+=2;for(var h=0;h<u;h++){var d=o.readUshort(n,s);s+=2;var p=e._lctf.readLookupTable(n,l+d,a);c.push(p)}return c},e._lctf.readLookupTable=function(n,s,a){var o=e._bin,l=s,c={tabs:[]};c.ltype=o.readUshort(n,s),s+=2,c.flag=o.readUshort(n,s),s+=2;var u=o.readUshort(n,s);s+=2;for(var h=c.ltype,d=0;d<u;d++){var p=o.readUshort(n,s);s+=2;var g=a(n,h,l+p,c);c.tabs.push(g)}return c},e._lctf.numOfOnes=function(n){for(var s=0,a=0;a<32;a++)(n>>>a&1)!=0&&s++;return s},e._lctf.readClassDef=function(n,s){var a=e._bin,o=[],l=a.readUshort(n,s);if(s+=2,l==1){var c=a.readUshort(n,s);s+=2;var u=a.readUshort(n,s);s+=2;for(var h=0;h<u;h++)o.push(c+h),o.push(c+h),o.push(a.readUshort(n,s)),s+=2}if(l==2){var d=a.readUshort(n,s);for(s+=2,h=0;h<d;h++)o.push(a.readUshort(n,s)),s+=2,o.push(a.readUshort(n,s)),s+=2,o.push(a.readUshort(n,s)),s+=2}return o},e._lctf.getInterval=function(n,s){for(var a=0;a<n.length;a+=3){var o=n[a],l=n[a+1];if(n[a+2],o<=s&&s<=l)return a}return-1},e._lctf.readCoverage=function(n,s){var a=e._bin,o={};o.fmt=a.readUshort(n,s),s+=2;var l=a.readUshort(n,s);return s+=2,o.fmt==1&&(o.tab=a.readUshorts(n,s,l)),o.fmt==2&&(o.tab=a.readUshorts(n,s,3*l)),o},e._lctf.coverageIndex=function(n,s){var a=n.tab;if(n.fmt==1)return a.indexOf(s);if(n.fmt==2){var o=e._lctf.getInterval(a,s);if(o!=-1)return a[o+2]+(s-a[o])}return-1},e._lctf.readFeatureList=function(n,s){var a=e._bin,o=s,l=[],c=a.readUshort(n,s);s+=2;for(var u=0;u<c;u++){var h=a.readASCII(n,s,4);s+=4;var d=a.readUshort(n,s);s+=2;var p=e._lctf.readFeatureTable(n,o+d);p.tag=h.trim(),l.push(p)}return l},e._lctf.readFeatureTable=function(n,s){var a=e._bin,o=s,l={},c=a.readUshort(n,s);s+=2,c>0&&(l.featureParams=o+c);var u=a.readUshort(n,s);s+=2,l.tab=[];for(var h=0;h<u;h++)l.tab.push(a.readUshort(n,s+2*h));return l},e._lctf.readScriptList=function(n,s){var a=e._bin,o=s,l={},c=a.readUshort(n,s);s+=2;for(var u=0;u<c;u++){var h=a.readASCII(n,s,4);s+=4;var d=a.readUshort(n,s);s+=2,l[h.trim()]=e._lctf.readScriptTable(n,o+d)}return l},e._lctf.readScriptTable=function(n,s){var a=e._bin,o=s,l={},c=a.readUshort(n,s);s+=2,c>0&&(l.default=e._lctf.readLangSysTable(n,o+c));var u=a.readUshort(n,s);s+=2;for(var h=0;h<u;h++){var d=a.readASCII(n,s,4);s+=4;var p=a.readUshort(n,s);s+=2,l[d.trim()]=e._lctf.readLangSysTable(n,o+p)}return l},e._lctf.readLangSysTable=function(n,s){var a=e._bin,o={};a.readUshort(n,s),s+=2,o.reqFeature=a.readUshort(n,s),s+=2;var l=a.readUshort(n,s);return s+=2,o.features=a.readUshorts(n,s,l),o},e.CFF={},e.CFF.parse=function(n,s,a){var o=e._bin;(n=new Uint8Array(n.buffer,s,a))[s=0],n[++s],n[++s],n[++s],s++;var l=[];s=e.CFF.readIndex(n,s,l);for(var c=[],u=0;u<l.length-1;u++)c.push(o.readASCII(n,s+l[u],l[u+1]-l[u]));s+=l[l.length-1];var h=[];s=e.CFF.readIndex(n,s,h);var d=[];for(u=0;u<h.length-1;u++)d.push(e.CFF.readDict(n,s+h[u],s+h[u+1]));s+=h[h.length-1];var p=d[0],g=[];s=e.CFF.readIndex(n,s,g);var x=[];for(u=0;u<g.length-1;u++)x.push(o.readASCII(n,s+g[u],g[u+1]-g[u]));if(s+=g[g.length-1],e.CFF.readSubrs(n,s,p),p.CharStrings){s=p.CharStrings,g=[],s=e.CFF.readIndex(n,s,g);var v=[];for(u=0;u<g.length-1;u++)v.push(o.readBytes(n,s+g[u],g[u+1]-g[u]));p.CharStrings=v}if(p.ROS){s=p.FDArray;var b=[];for(s=e.CFF.readIndex(n,s,b),p.FDArray=[],u=0;u<b.length-1;u++){var w=e.CFF.readDict(n,s+b[u],s+b[u+1]);e.CFF._readFDict(n,w,x),p.FDArray.push(w)}s+=b[b.length-1],s=p.FDSelect,p.FDSelect=[];var M=n[s];if(s++,M!=3)throw M;var E=o.readUshort(n,s);for(s+=2,u=0;u<E+1;u++)p.FDSelect.push(o.readUshort(n,s),n[s+2]),s+=3}return p.Encoding&&(p.Encoding=e.CFF.readEncoding(n,p.Encoding,p.CharStrings.length)),p.charset&&(p.charset=e.CFF.readCharset(n,p.charset,p.CharStrings.length)),e.CFF._readFDict(n,p,x),p},e.CFF._readFDict=function(n,s,a){var o;for(var l in s.Private&&(o=s.Private[1],s.Private=e.CFF.readDict(n,o,o+s.Private[0]),s.Private.Subrs&&e.CFF.readSubrs(n,o+s.Private.Subrs,s.Private)),s)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(l)!=-1&&(s[l]=a[s[l]-426+35])},e.CFF.readSubrs=function(n,s,a){var o=e._bin,l=[];s=e.CFF.readIndex(n,s,l);var c,u=l.length;c=u<1240?107:u<33900?1131:32768,a.Bias=c,a.Subrs=[];for(var h=0;h<l.length-1;h++)a.Subrs.push(o.readBytes(n,s+l[h],l[h+1]-l[h]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(n,s){for(var a=0;a<n.charset.length;a++)if(n.charset[a]==s)return a;return-1},e.CFF.glyphBySE=function(n,s){return s<0||s>255?-1:e.CFF.glyphByUnicode(n,e.CFF.tableSE[s])},e.CFF.readEncoding=function(n,s,a){e._bin;var o=[".notdef"],l=n[s];if(s++,l!=0)throw"error: unknown encoding format: "+l;var c=n[s];s++;for(var u=0;u<c;u++)o.push(n[s+u]);return o},e.CFF.readCharset=function(n,s,a){var o=e._bin,l=[".notdef"],c=n[s];if(s++,c==0)for(var u=0;u<a;u++){var h=o.readUshort(n,s);s+=2,l.push(h)}else{if(c!=1&&c!=2)throw"error: format: "+c;for(;l.length<a;){h=o.readUshort(n,s),s+=2;var d=0;for(c==1?(d=n[s],s++):(d=o.readUshort(n,s),s+=2),u=0;u<=d;u++)l.push(h),h++}}return l},e.CFF.readIndex=function(n,s,a){var o=e._bin,l=o.readUshort(n,s)+1,c=n[s+=2];if(s++,c==1)for(var u=0;u<l;u++)a.push(n[s+u]);else if(c==2)for(u=0;u<l;u++)a.push(o.readUshort(n,s+2*u));else if(c==3)for(u=0;u<l;u++)a.push(16777215&o.readUint(n,s+3*u-1));else if(l!=1)throw"unsupported offset size: "+c+", count: "+l;return(s+=l*c)-1},e.CFF.getCharString=function(n,s,a){var o=e._bin,l=n[s],c=n[s+1];n[s+2],n[s+3],n[s+4];var u=1,h=null,d=null;l<=20&&(h=l,u=1),l==12&&(h=100*l+c,u=2),21<=l&&l<=27&&(h=l,u=1),l==28&&(d=o.readShort(n,s+1),u=3),29<=l&&l<=31&&(h=l,u=1),32<=l&&l<=246&&(d=l-139,u=1),247<=l&&l<=250&&(d=256*(l-247)+c+108,u=2),251<=l&&l<=254&&(d=256*-(l-251)-c-108,u=2),l==255&&(d=o.readInt(n,s+1)/65535,u=5),a.val=d??"o"+h,a.size=u},e.CFF.readCharString=function(n,s,a){for(var o=s+a,l=e._bin,c=[];s<o;){var u=n[s],h=n[s+1];n[s+2],n[s+3],n[s+4];var d=1,p=null,g=null;u<=20&&(p=u,d=1),u==12&&(p=100*u+h,d=2),u!=19&&u!=20||(p=u,d=2),21<=u&&u<=27&&(p=u,d=1),u==28&&(g=l.readShort(n,s+1),d=3),29<=u&&u<=31&&(p=u,d=1),32<=u&&u<=246&&(g=u-139,d=1),247<=u&&u<=250&&(g=256*(u-247)+h+108,d=2),251<=u&&u<=254&&(g=256*-(u-251)-h-108,d=2),u==255&&(g=l.readInt(n,s+1)/65535,d=5),c.push(g??"o"+p),s+=d}return c},e.CFF.readDict=function(n,s,a){for(var o=e._bin,l={},c=[];s<a;){var u=n[s],h=n[s+1];n[s+2],n[s+3],n[s+4];var d=1,p=null,g=null;if(u==28&&(g=o.readShort(n,s+1),d=3),u==29&&(g=o.readInt(n,s+1),d=5),32<=u&&u<=246&&(g=u-139,d=1),247<=u&&u<=250&&(g=256*(u-247)+h+108,d=2),251<=u&&u<=254&&(g=256*-(u-251)-h-108,d=2),u==255)throw g=o.readInt(n,s+1)/65535,d=5,"unknown number";if(u==30){var x=[];for(d=1;;){var v=n[s+d];d++;var b=v>>4,w=15&v;if(b!=15&&x.push(b),w!=15&&x.push(w),w==15)break}for(var M="",E=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],D=0;D<x.length;D++)M+=E[x[D]];g=parseFloat(M)}u<=21&&(p=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][u],d=1,u==12&&(p=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][h],d=2)),p!=null?(l[p]=c.length==1?c[0]:c,c=[]):c.push(g),s+=d}return l},e.cmap={},e.cmap.parse=function(n,s,a){n=new Uint8Array(n.buffer,s,a),s=0;var o=e._bin,l={};o.readUshort(n,s),s+=2;var c=o.readUshort(n,s);s+=2;var u=[];l.tables=[];for(var h=0;h<c;h++){var d=o.readUshort(n,s);s+=2;var p=o.readUshort(n,s);s+=2;var g=o.readUint(n,s);s+=4;var x="p"+d+"e"+p,v=u.indexOf(g);if(v==-1){var b;v=l.tables.length,u.push(g);var w=o.readUshort(n,g);w==0?b=e.cmap.parse0(n,g):w==4?b=e.cmap.parse4(n,g):w==6?b=e.cmap.parse6(n,g):w==12?b=e.cmap.parse12(n,g):console.debug("unknown format: "+w,d,p,g),l.tables.push(b)}if(l[x]!=null)throw"multiple tables for one platform+encoding";l[x]=v}return l},e.cmap.parse0=function(n,s){var a=e._bin,o={};o.format=a.readUshort(n,s),s+=2;var l=a.readUshort(n,s);s+=2,a.readUshort(n,s),s+=2,o.map=[];for(var c=0;c<l-6;c++)o.map.push(n[s+c]);return o},e.cmap.parse4=function(n,s){var a=e._bin,o=s,l={};l.format=a.readUshort(n,s),s+=2;var c=a.readUshort(n,s);s+=2,a.readUshort(n,s),s+=2;var u=a.readUshort(n,s);s+=2;var h=u/2;l.searchRange=a.readUshort(n,s),s+=2,l.entrySelector=a.readUshort(n,s),s+=2,l.rangeShift=a.readUshort(n,s),s+=2,l.endCount=a.readUshorts(n,s,h),s+=2*h,s+=2,l.startCount=a.readUshorts(n,s,h),s+=2*h,l.idDelta=[];for(var d=0;d<h;d++)l.idDelta.push(a.readShort(n,s)),s+=2;for(l.idRangeOffset=a.readUshorts(n,s,h),s+=2*h,l.glyphIdArray=[];s<o+c;)l.glyphIdArray.push(a.readUshort(n,s)),s+=2;return l},e.cmap.parse6=function(n,s){var a=e._bin,o={};o.format=a.readUshort(n,s),s+=2,a.readUshort(n,s),s+=2,a.readUshort(n,s),s+=2,o.firstCode=a.readUshort(n,s),s+=2;var l=a.readUshort(n,s);s+=2,o.glyphIdArray=[];for(var c=0;c<l;c++)o.glyphIdArray.push(a.readUshort(n,s)),s+=2;return o},e.cmap.parse12=function(n,s){var a=e._bin,o={};o.format=a.readUshort(n,s),s+=2,s+=2,a.readUint(n,s),s+=4,a.readUint(n,s),s+=4;var l=a.readUint(n,s);s+=4,o.groups=[];for(var c=0;c<l;c++){var u=s+12*c,h=a.readUint(n,u+0),d=a.readUint(n,u+4),p=a.readUint(n,u+8);o.groups.push([h,d,p])}return o},e.glyf={},e.glyf.parse=function(n,s,a,o){for(var l=[],c=0;c<o.maxp.numGlyphs;c++)l.push(null);return l},e.glyf._parseGlyf=function(n,s){var a=e._bin,o=n._data,l=e._tabOffset(o,"glyf",n._offset)+n.loca[s];if(n.loca[s]==n.loca[s+1])return null;var c={};if(c.noc=a.readShort(o,l),l+=2,c.xMin=a.readShort(o,l),l+=2,c.yMin=a.readShort(o,l),l+=2,c.xMax=a.readShort(o,l),l+=2,c.yMax=a.readShort(o,l),l+=2,c.xMin>=c.xMax||c.yMin>=c.yMax)return null;if(c.noc>0){c.endPts=[];for(var u=0;u<c.noc;u++)c.endPts.push(a.readUshort(o,l)),l+=2;var h=a.readUshort(o,l);if(l+=2,o.length-l<h)return null;c.instructions=a.readBytes(o,l,h),l+=h;var d=c.endPts[c.noc-1]+1;for(c.flags=[],u=0;u<d;u++){var p=o[l];if(l++,c.flags.push(p),(8&p)!=0){var g=o[l];l++;for(var x=0;x<g;x++)c.flags.push(p),u++}}for(c.xs=[],u=0;u<d;u++){var v=(2&c.flags[u])!=0,b=(16&c.flags[u])!=0;v?(c.xs.push(b?o[l]:-o[l]),l++):b?c.xs.push(0):(c.xs.push(a.readShort(o,l)),l+=2)}for(c.ys=[],u=0;u<d;u++)v=(4&c.flags[u])!=0,b=(32&c.flags[u])!=0,v?(c.ys.push(b?o[l]:-o[l]),l++):b?c.ys.push(0):(c.ys.push(a.readShort(o,l)),l+=2);var w=0,M=0;for(u=0;u<d;u++)w+=c.xs[u],M+=c.ys[u],c.xs[u]=w,c.ys[u]=M}else{var E;c.parts=[];do{E=a.readUshort(o,l),l+=2;var D={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(c.parts.push(D),D.glyphIndex=a.readUshort(o,l),l+=2,1&E){var T=a.readShort(o,l);l+=2;var L=a.readShort(o,l);l+=2}else T=a.readInt8(o,l),l++,L=a.readInt8(o,l),l++;2&E?(D.m.tx=T,D.m.ty=L):(D.p1=T,D.p2=L),8&E?(D.m.a=D.m.d=a.readF2dot14(o,l),l+=2):64&E?(D.m.a=a.readF2dot14(o,l),l+=2,D.m.d=a.readF2dot14(o,l),l+=2):128&E&&(D.m.a=a.readF2dot14(o,l),l+=2,D.m.b=a.readF2dot14(o,l),l+=2,D.m.c=a.readF2dot14(o,l),l+=2,D.m.d=a.readF2dot14(o,l),l+=2)}while(32&E);if(256&E){var P=a.readUshort(o,l);for(l+=2,c.instr=[],u=0;u<P;u++)c.instr.push(o[l]),l++}}return c},e.GDEF={},e.GDEF.parse=function(n,s,a,o){var l=s;s+=4;var c=e._bin.readUshort(n,s);return{glyphClassDef:c===0?null:e._lctf.readClassDef(n,l+c)}},e.GPOS={},e.GPOS.parse=function(n,s,a,o){return e._lctf.parse(n,s,a,o,e.GPOS.subt)},e.GPOS.subt=function(n,s,a,o){var l=e._bin,c=a,u={};if(u.fmt=l.readUshort(n,a),a+=2,s==1||s==2||s==3||s==7||s==8&&u.fmt<=2){var h=l.readUshort(n,a);a+=2,u.coverage=e._lctf.readCoverage(n,h+c)}if(s==1&&u.fmt==1){var d=l.readUshort(n,a);a+=2,d!=0&&(u.pos=e.GPOS.readValueRecord(n,a,d))}else if(s==2&&u.fmt>=1&&u.fmt<=2){d=l.readUshort(n,a),a+=2;var p=l.readUshort(n,a);a+=2;var g=e._lctf.numOfOnes(d),x=e._lctf.numOfOnes(p);if(u.fmt==1){u.pairsets=[];var v=l.readUshort(n,a);a+=2;for(var b=0;b<v;b++){var w=c+l.readUshort(n,a);a+=2;var M=l.readUshort(n,w);w+=2;for(var E=[],D=0;D<M;D++){var T=l.readUshort(n,w);w+=2,d!=0&&(F=e.GPOS.readValueRecord(n,w,d),w+=2*g),p!=0&&(V=e.GPOS.readValueRecord(n,w,p),w+=2*x),E.push({gid2:T,val1:F,val2:V})}u.pairsets.push(E)}}if(u.fmt==2){var L=l.readUshort(n,a);a+=2;var P=l.readUshort(n,a);a+=2;var R=l.readUshort(n,a);a+=2;var O=l.readUshort(n,a);for(a+=2,u.classDef1=e._lctf.readClassDef(n,c+L),u.classDef2=e._lctf.readClassDef(n,c+P),u.matrix=[],b=0;b<R;b++){var U=[];for(D=0;D<O;D++){var F=null,V=null;d!=0&&(F=e.GPOS.readValueRecord(n,a,d),a+=2*g),p!=0&&(V=e.GPOS.readValueRecord(n,a,p),a+=2*x),U.push({val1:F,val2:V})}u.matrix.push(U)}}}else if(s==4&&u.fmt==1)u.markCoverage=e._lctf.readCoverage(n,l.readUshort(n,a)+c),u.baseCoverage=e._lctf.readCoverage(n,l.readUshort(n,a+2)+c),u.markClassCount=l.readUshort(n,a+4),u.markArray=e.GPOS.readMarkArray(n,l.readUshort(n,a+6)+c),u.baseArray=e.GPOS.readBaseArray(n,l.readUshort(n,a+8)+c,u.markClassCount);else if(s==6&&u.fmt==1)u.mark1Coverage=e._lctf.readCoverage(n,l.readUshort(n,a)+c),u.mark2Coverage=e._lctf.readCoverage(n,l.readUshort(n,a+2)+c),u.markClassCount=l.readUshort(n,a+4),u.mark1Array=e.GPOS.readMarkArray(n,l.readUshort(n,a+6)+c),u.mark2Array=e.GPOS.readBaseArray(n,l.readUshort(n,a+8)+c,u.markClassCount);else{if(s==9&&u.fmt==1){var k=l.readUshort(n,a);a+=2;var K=l.readUint(n,a);if(a+=4,o.ltype==9)o.ltype=k;else if(o.ltype!=k)throw"invalid extension substitution";return e.GPOS.subt(n,o.ltype,c+K)}console.debug("unsupported GPOS table LookupType",s,"format",u.fmt)}return u},e.GPOS.readValueRecord=function(n,s,a){var o=e._bin,l=[];return l.push(1&a?o.readShort(n,s):0),s+=1&a?2:0,l.push(2&a?o.readShort(n,s):0),s+=2&a?2:0,l.push(4&a?o.readShort(n,s):0),s+=4&a?2:0,l.push(8&a?o.readShort(n,s):0),s+=8&a?2:0,l},e.GPOS.readBaseArray=function(n,s,a){var o=e._bin,l=[],c=s,u=o.readUshort(n,s);s+=2;for(var h=0;h<u;h++){for(var d=[],p=0;p<a;p++)d.push(e.GPOS.readAnchorRecord(n,c+o.readUshort(n,s))),s+=2;l.push(d)}return l},e.GPOS.readMarkArray=function(n,s){var a=e._bin,o=[],l=s,c=a.readUshort(n,s);s+=2;for(var u=0;u<c;u++){var h=e.GPOS.readAnchorRecord(n,a.readUshort(n,s+2)+l);h.markClass=a.readUshort(n,s),o.push(h),s+=4}return o},e.GPOS.readAnchorRecord=function(n,s){var a=e._bin,o={};return o.fmt=a.readUshort(n,s),o.x=a.readShort(n,s+2),o.y=a.readShort(n,s+4),o},e.GSUB={},e.GSUB.parse=function(n,s,a,o){return e._lctf.parse(n,s,a,o,e.GSUB.subt)},e.GSUB.subt=function(n,s,a,o){var l=e._bin,c=a,u={};if(u.fmt=l.readUshort(n,a),a+=2,s!=1&&s!=2&&s!=4&&s!=5&&s!=6)return null;if(s==1||s==2||s==4||s==5&&u.fmt<=2||s==6&&u.fmt<=2){var h=l.readUshort(n,a);a+=2,u.coverage=e._lctf.readCoverage(n,c+h)}if(s==1&&u.fmt>=1&&u.fmt<=2){if(u.fmt==1)u.delta=l.readShort(n,a),a+=2;else if(u.fmt==2){var d=l.readUshort(n,a);a+=2,u.newg=l.readUshorts(n,a,d),a+=2*u.newg.length}}else if(s==2&&u.fmt==1){d=l.readUshort(n,a),a+=2,u.seqs=[];for(var p=0;p<d;p++){var g=l.readUshort(n,a)+c;a+=2;var x=l.readUshort(n,g);u.seqs.push(l.readUshorts(n,g+2,x))}}else if(s==4)for(u.vals=[],d=l.readUshort(n,a),a+=2,p=0;p<d;p++){var v=l.readUshort(n,a);a+=2,u.vals.push(e.GSUB.readLigatureSet(n,c+v))}else if(s==5&&u.fmt==2){if(u.fmt==2){var b=l.readUshort(n,a);a+=2,u.cDef=e._lctf.readClassDef(n,c+b),u.scset=[];var w=l.readUshort(n,a);for(a+=2,p=0;p<w;p++){var M=l.readUshort(n,a);a+=2,u.scset.push(M==0?null:e.GSUB.readSubClassSet(n,c+M))}}}else if(s==6&&u.fmt==3){if(u.fmt==3){for(p=0;p<3;p++){d=l.readUshort(n,a),a+=2;for(var E=[],D=0;D<d;D++)E.push(e._lctf.readCoverage(n,c+l.readUshort(n,a+2*D)));a+=2*d,p==0&&(u.backCvg=E),p==1&&(u.inptCvg=E),p==2&&(u.ahedCvg=E)}d=l.readUshort(n,a),a+=2,u.lookupRec=e.GSUB.readSubstLookupRecords(n,a,d)}}else{if(s==7&&u.fmt==1){var T=l.readUshort(n,a);a+=2;var L=l.readUint(n,a);if(a+=4,o.ltype==9)o.ltype=T;else if(o.ltype!=T)throw"invalid extension substitution";return e.GSUB.subt(n,o.ltype,c+L)}console.debug("unsupported GSUB table LookupType",s,"format",u.fmt)}return u},e.GSUB.readSubClassSet=function(n,s){var a=e._bin.readUshort,o=s,l=[],c=a(n,s);s+=2;for(var u=0;u<c;u++){var h=a(n,s);s+=2,l.push(e.GSUB.readSubClassRule(n,o+h))}return l},e.GSUB.readSubClassRule=function(n,s){var a=e._bin.readUshort,o={},l=a(n,s),c=a(n,s+=2);s+=2,o.input=[];for(var u=0;u<l-1;u++)o.input.push(a(n,s)),s+=2;return o.substLookupRecords=e.GSUB.readSubstLookupRecords(n,s,c),o},e.GSUB.readSubstLookupRecords=function(n,s,a){for(var o=e._bin.readUshort,l=[],c=0;c<a;c++)l.push(o(n,s),o(n,s+2)),s+=4;return l},e.GSUB.readChainSubClassSet=function(n,s){var a=e._bin,o=s,l=[],c=a.readUshort(n,s);s+=2;for(var u=0;u<c;u++){var h=a.readUshort(n,s);s+=2,l.push(e.GSUB.readChainSubClassRule(n,o+h))}return l},e.GSUB.readChainSubClassRule=function(n,s){for(var a=e._bin,o={},l=["backtrack","input","lookahead"],c=0;c<l.length;c++){var u=a.readUshort(n,s);s+=2,c==1&&u--,o[l[c]]=a.readUshorts(n,s,u),s+=2*o[l[c]].length}return u=a.readUshort(n,s),s+=2,o.subst=a.readUshorts(n,s,2*u),s+=2*o.subst.length,o},e.GSUB.readLigatureSet=function(n,s){var a=e._bin,o=s,l=[],c=a.readUshort(n,s);s+=2;for(var u=0;u<c;u++){var h=a.readUshort(n,s);s+=2,l.push(e.GSUB.readLigature(n,o+h))}return l},e.GSUB.readLigature=function(n,s){var a=e._bin,o={chain:[]};o.nglyph=a.readUshort(n,s),s+=2;var l=a.readUshort(n,s);s+=2;for(var c=0;c<l-1;c++)o.chain.push(a.readUshort(n,s)),s+=2;return o},e.head={},e.head.parse=function(n,s,a){var o=e._bin,l={};return o.readFixed(n,s),s+=4,l.fontRevision=o.readFixed(n,s),s+=4,o.readUint(n,s),s+=4,o.readUint(n,s),s+=4,l.flags=o.readUshort(n,s),s+=2,l.unitsPerEm=o.readUshort(n,s),s+=2,l.created=o.readUint64(n,s),s+=8,l.modified=o.readUint64(n,s),s+=8,l.xMin=o.readShort(n,s),s+=2,l.yMin=o.readShort(n,s),s+=2,l.xMax=o.readShort(n,s),s+=2,l.yMax=o.readShort(n,s),s+=2,l.macStyle=o.readUshort(n,s),s+=2,l.lowestRecPPEM=o.readUshort(n,s),s+=2,l.fontDirectionHint=o.readShort(n,s),s+=2,l.indexToLocFormat=o.readShort(n,s),s+=2,l.glyphDataFormat=o.readShort(n,s),s+=2,l},e.hhea={},e.hhea.parse=function(n,s,a){var o=e._bin,l={};return o.readFixed(n,s),s+=4,l.ascender=o.readShort(n,s),s+=2,l.descender=o.readShort(n,s),s+=2,l.lineGap=o.readShort(n,s),s+=2,l.advanceWidthMax=o.readUshort(n,s),s+=2,l.minLeftSideBearing=o.readShort(n,s),s+=2,l.minRightSideBearing=o.readShort(n,s),s+=2,l.xMaxExtent=o.readShort(n,s),s+=2,l.caretSlopeRise=o.readShort(n,s),s+=2,l.caretSlopeRun=o.readShort(n,s),s+=2,l.caretOffset=o.readShort(n,s),s+=2,s+=8,l.metricDataFormat=o.readShort(n,s),s+=2,l.numberOfHMetrics=o.readUshort(n,s),s+=2,l},e.hmtx={},e.hmtx.parse=function(n,s,a,o){for(var l=e._bin,c={aWidth:[],lsBearing:[]},u=0,h=0,d=0;d<o.maxp.numGlyphs;d++)d<o.hhea.numberOfHMetrics&&(u=l.readUshort(n,s),s+=2,h=l.readShort(n,s),s+=2),c.aWidth.push(u),c.lsBearing.push(h);return c},e.kern={},e.kern.parse=function(n,s,a,o){var l=e._bin,c=l.readUshort(n,s);if(s+=2,c==1)return e.kern.parseV1(n,s-2,a,o);var u=l.readUshort(n,s);s+=2;for(var h={glyph1:[],rval:[]},d=0;d<u;d++){s+=2,a=l.readUshort(n,s),s+=2;var p=l.readUshort(n,s);s+=2;var g=p>>>8;if((g&=15)!=0)throw"unknown kern table format: "+g;s=e.kern.readFormat0(n,s,h)}return h},e.kern.parseV1=function(n,s,a,o){var l=e._bin;l.readFixed(n,s),s+=4;var c=l.readUint(n,s);s+=4;for(var u={glyph1:[],rval:[]},h=0;h<c;h++){l.readUint(n,s),s+=4;var d=l.readUshort(n,s);s+=2,l.readUshort(n,s),s+=2;var p=d>>>8;if((p&=15)!=0)throw"unknown kern table format: "+p;s=e.kern.readFormat0(n,s,u)}return u},e.kern.readFormat0=function(n,s,a){var o=e._bin,l=-1,c=o.readUshort(n,s);s+=2,o.readUshort(n,s),s+=2,o.readUshort(n,s),s+=2,o.readUshort(n,s),s+=2;for(var u=0;u<c;u++){var h=o.readUshort(n,s);s+=2;var d=o.readUshort(n,s);s+=2;var p=o.readShort(n,s);s+=2,h!=l&&(a.glyph1.push(h),a.rval.push({glyph2:[],vals:[]}));var g=a.rval[a.rval.length-1];g.glyph2.push(d),g.vals.push(p),l=h}return s},e.loca={},e.loca.parse=function(n,s,a,o){var l=e._bin,c=[],u=o.head.indexToLocFormat,h=o.maxp.numGlyphs+1;if(u==0)for(var d=0;d<h;d++)c.push(l.readUshort(n,s+(d<<1))<<1);if(u==1)for(d=0;d<h;d++)c.push(l.readUint(n,s+(d<<2)));return c},e.maxp={},e.maxp.parse=function(n,s,a){var o=e._bin,l={},c=o.readUint(n,s);return s+=4,l.numGlyphs=o.readUshort(n,s),s+=2,c==65536&&(l.maxPoints=o.readUshort(n,s),s+=2,l.maxContours=o.readUshort(n,s),s+=2,l.maxCompositePoints=o.readUshort(n,s),s+=2,l.maxCompositeContours=o.readUshort(n,s),s+=2,l.maxZones=o.readUshort(n,s),s+=2,l.maxTwilightPoints=o.readUshort(n,s),s+=2,l.maxStorage=o.readUshort(n,s),s+=2,l.maxFunctionDefs=o.readUshort(n,s),s+=2,l.maxInstructionDefs=o.readUshort(n,s),s+=2,l.maxStackElements=o.readUshort(n,s),s+=2,l.maxSizeOfInstructions=o.readUshort(n,s),s+=2,l.maxComponentElements=o.readUshort(n,s),s+=2,l.maxComponentDepth=o.readUshort(n,s),s+=2),l},e.name={},e.name.parse=function(n,s,a){var o=e._bin,l={};o.readUshort(n,s),s+=2;var c=o.readUshort(n,s);s+=2,o.readUshort(n,s);for(var u,h=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],d=s+=2,p=0;p<c;p++){var g=o.readUshort(n,s);s+=2;var x=o.readUshort(n,s);s+=2;var v=o.readUshort(n,s);s+=2;var b=o.readUshort(n,s);s+=2;var w=o.readUshort(n,s);s+=2;var M=o.readUshort(n,s);s+=2;var E,D=h[b],T=d+12*c+M;if(g==0)E=o.readUnicode(n,T,w/2);else if(g==3&&x==0)E=o.readUnicode(n,T,w/2);else if(x==0)E=o.readASCII(n,T,w);else if(x==1)E=o.readUnicode(n,T,w/2);else if(x==3)E=o.readUnicode(n,T,w/2);else{if(g!=1)throw"unknown encoding "+x+", platformID: "+g;E=o.readASCII(n,T,w),console.debug("reading unknown MAC encoding "+x+" as ASCII")}var L="p"+g+","+v.toString(16);l[L]==null&&(l[L]={}),l[L][D!==void 0?D:b]=E,l[L]._lang=v}for(var P in l)if(l[P].postScriptName!=null&&l[P]._lang==1033)return l[P];for(var P in l)if(l[P].postScriptName!=null&&l[P]._lang==0)return l[P];for(var P in l)if(l[P].postScriptName!=null&&l[P]._lang==3084)return l[P];for(var P in l)if(l[P].postScriptName!=null)return l[P];for(var P in l){u=P;break}return console.debug("returning name table with languageID "+l[u]._lang),l[u]},e["OS/2"]={},e["OS/2"].parse=function(n,s,a){var o=e._bin.readUshort(n,s);s+=2;var l={};if(o==0)e["OS/2"].version0(n,s,l);else if(o==1)e["OS/2"].version1(n,s,l);else if(o==2||o==3||o==4)e["OS/2"].version2(n,s,l);else{if(o!=5)throw"unknown OS/2 table version: "+o;e["OS/2"].version5(n,s,l)}return l},e["OS/2"].version0=function(n,s,a){var o=e._bin;return a.xAvgCharWidth=o.readShort(n,s),s+=2,a.usWeightClass=o.readUshort(n,s),s+=2,a.usWidthClass=o.readUshort(n,s),s+=2,a.fsType=o.readUshort(n,s),s+=2,a.ySubscriptXSize=o.readShort(n,s),s+=2,a.ySubscriptYSize=o.readShort(n,s),s+=2,a.ySubscriptXOffset=o.readShort(n,s),s+=2,a.ySubscriptYOffset=o.readShort(n,s),s+=2,a.ySuperscriptXSize=o.readShort(n,s),s+=2,a.ySuperscriptYSize=o.readShort(n,s),s+=2,a.ySuperscriptXOffset=o.readShort(n,s),s+=2,a.ySuperscriptYOffset=o.readShort(n,s),s+=2,a.yStrikeoutSize=o.readShort(n,s),s+=2,a.yStrikeoutPosition=o.readShort(n,s),s+=2,a.sFamilyClass=o.readShort(n,s),s+=2,a.panose=o.readBytes(n,s,10),s+=10,a.ulUnicodeRange1=o.readUint(n,s),s+=4,a.ulUnicodeRange2=o.readUint(n,s),s+=4,a.ulUnicodeRange3=o.readUint(n,s),s+=4,a.ulUnicodeRange4=o.readUint(n,s),s+=4,a.achVendID=[o.readInt8(n,s),o.readInt8(n,s+1),o.readInt8(n,s+2),o.readInt8(n,s+3)],s+=4,a.fsSelection=o.readUshort(n,s),s+=2,a.usFirstCharIndex=o.readUshort(n,s),s+=2,a.usLastCharIndex=o.readUshort(n,s),s+=2,a.sTypoAscender=o.readShort(n,s),s+=2,a.sTypoDescender=o.readShort(n,s),s+=2,a.sTypoLineGap=o.readShort(n,s),s+=2,a.usWinAscent=o.readUshort(n,s),s+=2,a.usWinDescent=o.readUshort(n,s),s+=2},e["OS/2"].version1=function(n,s,a){var o=e._bin;return s=e["OS/2"].version0(n,s,a),a.ulCodePageRange1=o.readUint(n,s),s+=4,a.ulCodePageRange2=o.readUint(n,s),s+=4},e["OS/2"].version2=function(n,s,a){var o=e._bin;return s=e["OS/2"].version1(n,s,a),a.sxHeight=o.readShort(n,s),s+=2,a.sCapHeight=o.readShort(n,s),s+=2,a.usDefault=o.readUshort(n,s),s+=2,a.usBreak=o.readUshort(n,s),s+=2,a.usMaxContext=o.readUshort(n,s),s+=2},e["OS/2"].version5=function(n,s,a){var o=e._bin;return s=e["OS/2"].version2(n,s,a),a.usLowerOpticalPointSize=o.readUshort(n,s),s+=2,a.usUpperOpticalPointSize=o.readUshort(n,s),s+=2},e.post={},e.post.parse=function(n,s,a){var o=e._bin,l={};return l.version=o.readFixed(n,s),s+=4,l.italicAngle=o.readFixed(n,s),s+=4,l.underlinePosition=o.readShort(n,s),s+=2,l.underlineThickness=o.readShort(n,s),s+=2,l},e==null&&(e={}),e.U==null&&(e.U={}),e.U.codeToGlyph=function(n,s){var a=n.cmap,o=-1;if(a.p0e4!=null?o=a.p0e4:a.p3e1!=null?o=a.p3e1:a.p1e0!=null?o=a.p1e0:a.p0e3!=null&&(o=a.p0e3),o==-1)throw"no familiar platform and encoding!";var l=a.tables[o];if(l.format==0)return s>=l.map.length?0:l.map[s];if(l.format==4){for(var c=-1,u=0;u<l.endCount.length;u++)if(s<=l.endCount[u]){c=u;break}return c==-1||l.startCount[c]>s?0:65535&(l.idRangeOffset[c]!=0?l.glyphIdArray[s-l.startCount[c]+(l.idRangeOffset[c]>>1)-(l.idRangeOffset.length-c)]:s+l.idDelta[c])}if(l.format==12){if(s>l.groups[l.groups.length-1][1])return 0;for(u=0;u<l.groups.length;u++){var h=l.groups[u];if(h[0]<=s&&s<=h[1])return h[2]+(s-h[0])}return 0}throw"unknown cmap table format "+l.format},e.U.glyphToPath=function(n,s){var a={cmds:[],crds:[]};if(n.SVG&&n.SVG.entries[s]){var o=n.SVG.entries[s];return o==null?a:(typeof o=="string"&&(o=e.SVG.toPath(o),n.SVG.entries[s]=o),o)}if(n.CFF){var l={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:n.CFF.Private?n.CFF.Private.defaultWidthX:0,open:!1},c=n.CFF,u=n.CFF.Private;if(c.ROS){for(var h=0;c.FDSelect[h+2]<=s;)h+=2;u=c.FDArray[c.FDSelect[h+1]].Private}e.U._drawCFF(n.CFF.CharStrings[s],l,c,u,a)}else n.glyf&&e.U._drawGlyf(s,n,a);return a},e.U._drawGlyf=function(n,s,a){var o=s.glyf[n];o==null&&(o=s.glyf[n]=e.glyf._parseGlyf(s,n)),o!=null&&(o.noc>-1?e.U._simpleGlyph(o,a):e.U._compoGlyph(o,s,a))},e.U._simpleGlyph=function(n,s){for(var a=0;a<n.noc;a++){for(var o=a==0?0:n.endPts[a-1]+1,l=n.endPts[a],c=o;c<=l;c++){var u=c==o?l:c-1,h=c==l?o:c+1,d=1&n.flags[c],p=1&n.flags[u],g=1&n.flags[h],x=n.xs[c],v=n.ys[c];if(c==o)if(d){if(!p){e.U.P.moveTo(s,x,v);continue}e.U.P.moveTo(s,n.xs[u],n.ys[u])}else p?e.U.P.moveTo(s,n.xs[u],n.ys[u]):e.U.P.moveTo(s,(n.xs[u]+x)/2,(n.ys[u]+v)/2);d?p&&e.U.P.lineTo(s,x,v):g?e.U.P.qcurveTo(s,x,v,n.xs[h],n.ys[h]):e.U.P.qcurveTo(s,x,v,(x+n.xs[h])/2,(v+n.ys[h])/2)}e.U.P.closePath(s)}},e.U._compoGlyph=function(n,s,a){for(var o=0;o<n.parts.length;o++){var l={cmds:[],crds:[]},c=n.parts[o];e.U._drawGlyf(c.glyphIndex,s,l);for(var u=c.m,h=0;h<l.crds.length;h+=2){var d=l.crds[h],p=l.crds[h+1];a.crds.push(d*u.a+p*u.b+u.tx),a.crds.push(d*u.c+p*u.d+u.ty)}for(h=0;h<l.cmds.length;h++)a.cmds.push(l.cmds[h])}},e.U._getGlyphClass=function(n,s){var a=e._lctf.getInterval(s,n);return a==-1?0:s[a+2]},e.U._applySubs=function(n,s,a,o){for(var l=n.length-s-1,c=0;c<a.tabs.length;c++)if(a.tabs[c]!=null){var u,h=a.tabs[c];if(!h.coverage||(u=e._lctf.coverageIndex(h.coverage,n[s]))!=-1){if(a.ltype==1)n[s],h.fmt==1?n[s]=n[s]+h.delta:n[s]=h.newg[u];else if(a.ltype==4)for(var d=h.vals[u],p=0;p<d.length;p++){var g=d[p],x=g.chain.length;if(!(x>l)){for(var v=!0,b=0,w=0;w<x;w++){for(;n[s+b+(1+w)]==-1;)b++;g.chain[w]!=n[s+b+(1+w)]&&(v=!1)}if(v){for(n[s]=g.nglyph,w=0;w<x+b;w++)n[s+w+1]=-1;break}}}else if(a.ltype==5&&h.fmt==2)for(var M=e._lctf.getInterval(h.cDef,n[s]),E=h.cDef[M+2],D=h.scset[E],T=0;T<D.length;T++){var L=D[T],P=L.input;if(!(P.length>l)){for(v=!0,w=0;w<P.length;w++){var R=e._lctf.getInterval(h.cDef,n[s+1+w]);if(M==-1&&h.cDef[R+2]!=P[w]){v=!1;break}}if(v){var O=L.substLookupRecords;for(p=0;p<O.length;p+=2)O[p],O[p+1]}}}else if(a.ltype==6&&h.fmt==3){if(!e.U._glsCovered(n,h.backCvg,s-h.backCvg.length)||!e.U._glsCovered(n,h.inptCvg,s)||!e.U._glsCovered(n,h.ahedCvg,s+h.inptCvg.length))continue;var U=h.lookupRec;for(T=0;T<U.length;T+=2){M=U[T];var F=o[U[T+1]];e.U._applySubs(n,s+M,F,o)}}}}},e.U._glsCovered=function(n,s,a){for(var o=0;o<s.length;o++)if(e._lctf.coverageIndex(s[o],n[a+o])==-1)return!1;return!0},e.U.glyphsToPath=function(n,s,a){for(var o={cmds:[],crds:[]},l=0,c=0;c<s.length;c++){var u=s[c];if(u!=-1){for(var h=c<s.length-1&&s[c+1]!=-1?s[c+1]:0,d=e.U.glyphToPath(n,u),p=0;p<d.crds.length;p+=2)o.crds.push(d.crds[p]+l),o.crds.push(d.crds[p+1]);for(a&&o.cmds.push(a),p=0;p<d.cmds.length;p++)o.cmds.push(d.cmds[p]);a&&o.cmds.push("X"),l+=n.hmtx.aWidth[u],c<s.length-1&&(l+=e.U.getPairAdjustment(n,u,h))}}return o},e.U.P={},e.U.P.moveTo=function(n,s,a){n.cmds.push("M"),n.crds.push(s,a)},e.U.P.lineTo=function(n,s,a){n.cmds.push("L"),n.crds.push(s,a)},e.U.P.curveTo=function(n,s,a,o,l,c,u){n.cmds.push("C"),n.crds.push(s,a,o,l,c,u)},e.U.P.qcurveTo=function(n,s,a,o,l){n.cmds.push("Q"),n.crds.push(s,a,o,l)},e.U.P.closePath=function(n){n.cmds.push("Z")},e.U._drawCFF=function(n,s,a,o,l){for(var c=s.stack,u=s.nStems,h=s.haveWidth,d=s.width,p=s.open,g=0,x=s.x,v=s.y,b=0,w=0,M=0,E=0,D=0,T=0,L=0,P=0,R=0,O=0,U={val:0,size:0};g<n.length;){e.CFF.getCharString(n,g,U);var F=U.val;if(g+=U.size,F=="o1"||F=="o18")c.length%2!=0&&!h&&(d=c.shift()+o.nominalWidthX),u+=c.length>>1,c.length=0,h=!0;else if(F=="o3"||F=="o23")c.length%2!=0&&!h&&(d=c.shift()+o.nominalWidthX),u+=c.length>>1,c.length=0,h=!0;else if(F=="o4")c.length>1&&!h&&(d=c.shift()+o.nominalWidthX,h=!0),p&&e.U.P.closePath(l),v+=c.pop(),e.U.P.moveTo(l,x,v),p=!0;else if(F=="o5")for(;c.length>0;)x+=c.shift(),v+=c.shift(),e.U.P.lineTo(l,x,v);else if(F=="o6"||F=="o7")for(var V=c.length,k=F=="o6",K=0;K<V;K++){var X=c.shift();k?x+=X:v+=X,k=!k,e.U.P.lineTo(l,x,v)}else if(F=="o8"||F=="o24"){V=c.length;for(var $=0;$+6<=V;)b=x+c.shift(),w=v+c.shift(),M=b+c.shift(),E=w+c.shift(),x=M+c.shift(),v=E+c.shift(),e.U.P.curveTo(l,b,w,M,E,x,v),$+=6;F=="o24"&&(x+=c.shift(),v+=c.shift(),e.U.P.lineTo(l,x,v))}else{if(F=="o11")break;if(F=="o1234"||F=="o1235"||F=="o1236"||F=="o1237")F=="o1234"&&(w=v,M=(b=x+c.shift())+c.shift(),O=E=w+c.shift(),T=E,P=v,x=(L=(D=(R=M+c.shift())+c.shift())+c.shift())+c.shift(),e.U.P.curveTo(l,b,w,M,E,R,O),e.U.P.curveTo(l,D,T,L,P,x,v)),F=="o1235"&&(b=x+c.shift(),w=v+c.shift(),M=b+c.shift(),E=w+c.shift(),R=M+c.shift(),O=E+c.shift(),D=R+c.shift(),T=O+c.shift(),L=D+c.shift(),P=T+c.shift(),x=L+c.shift(),v=P+c.shift(),c.shift(),e.U.P.curveTo(l,b,w,M,E,R,O),e.U.P.curveTo(l,D,T,L,P,x,v)),F=="o1236"&&(b=x+c.shift(),w=v+c.shift(),M=b+c.shift(),O=E=w+c.shift(),T=E,L=(D=(R=M+c.shift())+c.shift())+c.shift(),P=T+c.shift(),x=L+c.shift(),e.U.P.curveTo(l,b,w,M,E,R,O),e.U.P.curveTo(l,D,T,L,P,x,v)),F=="o1237"&&(b=x+c.shift(),w=v+c.shift(),M=b+c.shift(),E=w+c.shift(),R=M+c.shift(),O=E+c.shift(),D=R+c.shift(),T=O+c.shift(),L=D+c.shift(),P=T+c.shift(),Math.abs(L-x)>Math.abs(P-v)?x=L+c.shift():v=P+c.shift(),e.U.P.curveTo(l,b,w,M,E,R,O),e.U.P.curveTo(l,D,T,L,P,x,v));else if(F=="o14"){if(c.length>0&&!h&&(d=c.shift()+a.nominalWidthX,h=!0),c.length==4){var Y=c.shift(),re=c.shift(),G=c.shift(),j=c.shift(),ee=e.CFF.glyphBySE(a,G),oe=e.CFF.glyphBySE(a,j);e.U._drawCFF(a.CharStrings[ee],s,a,o,l),s.x=Y,s.y=re,e.U._drawCFF(a.CharStrings[oe],s,a,o,l)}p&&(e.U.P.closePath(l),p=!1)}else if(F=="o19"||F=="o20")c.length%2!=0&&!h&&(d=c.shift()+o.nominalWidthX),u+=c.length>>1,c.length=0,h=!0,g+=u+7>>3;else if(F=="o21")c.length>2&&!h&&(d=c.shift()+o.nominalWidthX,h=!0),v+=c.pop(),x+=c.pop(),p&&e.U.P.closePath(l),e.U.P.moveTo(l,x,v),p=!0;else if(F=="o22")c.length>1&&!h&&(d=c.shift()+o.nominalWidthX,h=!0),x+=c.pop(),p&&e.U.P.closePath(l),e.U.P.moveTo(l,x,v),p=!0;else if(F=="o25"){for(;c.length>6;)x+=c.shift(),v+=c.shift(),e.U.P.lineTo(l,x,v);b=x+c.shift(),w=v+c.shift(),M=b+c.shift(),E=w+c.shift(),x=M+c.shift(),v=E+c.shift(),e.U.P.curveTo(l,b,w,M,E,x,v)}else if(F=="o26")for(c.length%2&&(x+=c.shift());c.length>0;)b=x,w=v+c.shift(),x=M=b+c.shift(),v=(E=w+c.shift())+c.shift(),e.U.P.curveTo(l,b,w,M,E,x,v);else if(F=="o27")for(c.length%2&&(v+=c.shift());c.length>0;)w=v,M=(b=x+c.shift())+c.shift(),E=w+c.shift(),x=M+c.shift(),v=E,e.U.P.curveTo(l,b,w,M,E,x,v);else if(F=="o10"||F=="o29"){var Q=F=="o10"?o:a;if(c.length==0)console.debug("error: empty stack");else{var ae=c.pop(),ne=Q.Subrs[ae+Q.Bias];s.x=x,s.y=v,s.nStems=u,s.haveWidth=h,s.width=d,s.open=p,e.U._drawCFF(ne,s,a,o,l),x=s.x,v=s.y,u=s.nStems,h=s.haveWidth,d=s.width,p=s.open}}else if(F=="o30"||F=="o31"){var ue=c.length,fe=($=0,F=="o31");for($+=ue-(V=-3&ue);$<V;)fe?(w=v,M=(b=x+c.shift())+c.shift(),v=(E=w+c.shift())+c.shift(),V-$==5?(x=M+c.shift(),$++):x=M,fe=!1):(b=x,w=v+c.shift(),M=b+c.shift(),E=w+c.shift(),x=M+c.shift(),V-$==5?(v=E+c.shift(),$++):v=E,fe=!0),e.U.P.curveTo(l,b,w,M,E,x,v),$+=4}else{if((F+"").charAt(0)=="o")throw console.debug("Unknown operation: "+F,n),F;c.push(F)}}}s.x=x,s.y=v,s.nStems=u,s.haveWidth=h,s.width=d,s.open=p};var i=e,r={Typr:i};return t.Typr=i,t.default=r,Object.defineProperty(t,"__esModule",{value:!0}),t}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function x5e(){return function(t){var e=Uint8Array,i=Uint16Array,r=Uint32Array,n=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(F,V){for(var k=new i(31),K=0;K<31;++K)k[K]=V+=1<<F[K-1];var X=new r(k[30]);for(K=1;K<30;++K)for(var $=k[K];$<k[K+1];++$)X[$]=$-k[K]<<5|K;return[k,X]},l=o(n,2),c=l[0],u=l[1];c[28]=258,u[258]=28;for(var h=o(s,0)[0],d=new i(32768),p=0;p<32768;++p){var g=(43690&p)>>>1|(21845&p)<<1;g=(61680&(g=(52428&g)>>>2|(13107&g)<<2))>>>4|(3855&g)<<4,d[p]=((65280&g)>>>8|(255&g)<<8)>>>1}var x=function(F,V,k){for(var K=F.length,X=0,$=new i(V);X<K;++X)++$[F[X]-1];var Y,re=new i(V);for(X=0;X<V;++X)re[X]=re[X-1]+$[X-1]<<1;{Y=new i(1<<V);var G=15-V;for(X=0;X<K;++X)if(F[X])for(var j=X<<4|F[X],ee=V-F[X],oe=re[F[X]-1]++<<ee,Q=oe|(1<<ee)-1;oe<=Q;++oe)Y[d[oe]>>>G]=j}return Y},v=new e(288);for(p=0;p<144;++p)v[p]=8;for(p=144;p<256;++p)v[p]=9;for(p=256;p<280;++p)v[p]=7;for(p=280;p<288;++p)v[p]=8;var b=new e(32);for(p=0;p<32;++p)b[p]=5;var w=x(v,9),M=x(b,5),E=function(F){for(var V=F[0],k=1;k<F.length;++k)F[k]>V&&(V=F[k]);return V},D=function(F,V,k){var K=V/8|0;return(F[K]|F[K+1]<<8)>>(7&V)&k},T=function(F,V){var k=V/8|0;return(F[k]|F[k+1]<<8|F[k+2]<<16)>>(7&V)},L=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],P=function(F,V,k){var K=new Error(V||L[F]);if(K.code=F,Error.captureStackTrace&&Error.captureStackTrace(K,P),!k)throw K;return K},R=function(F,V,k){var K=F.length;if(!K||k&&!k.l&&K<5)return V||new e(0);var X=!V||k,$=!k||k.i;k||(k={}),V||(V=new e(3*K));var Y,re=function($e){var St=V.length;if($e>St){var Pt=new e(Math.max(2*St,$e));Pt.set(V),V=Pt}},G=k.f||0,j=k.p||0,ee=k.b||0,oe=k.l,Q=k.d,ae=k.m,ne=k.n,ue=8*K;do{if(!oe){k.f=G=D(F,j,1);var fe=D(F,j+1,3);if(j+=3,!fe){var xe=F[(We=((Y=j)/8|0)+(7&Y&&1)+4)-4]|F[We-3]<<8,be=We+xe;if(be>K){$&&P(0);break}X&&re(ee+xe),V.set(F.subarray(We,be),ee),k.b=ee+=xe,k.p=j=8*be;continue}if(fe==1)oe=w,Q=M,ae=9,ne=5;else if(fe==2){var Ce=D(F,j,31)+257,ge=D(F,j+10,15)+4,Te=Ce+D(F,j+5,31)+1;j+=14;for(var ce=new e(Te),Ue=new e(19),ze=0;ze<ge;++ze)Ue[a[ze]]=D(F,j+3*ze,7);j+=3*ge;var Xe=E(Ue),De=(1<<Xe)-1,Ge=x(Ue,Xe);for(ze=0;ze<Te;){var We,se=Ge[D(F,j,De)];if(j+=15&se,(We=se>>>4)<16)ce[ze++]=We;else{var H=0,Z=0;for(We==16?(Z=3+D(F,j,3),j+=2,H=ce[ze-1]):We==17?(Z=3+D(F,j,7),j+=3):We==18&&(Z=11+D(F,j,127),j+=7);Z--;)ce[ze++]=H}}var pe=ce.subarray(0,Ce),we=ce.subarray(Ce);ae=E(pe),ne=E(we),oe=x(pe,ae),Q=x(we,ne)}else P(1);if(j>ue){$&&P(0);break}}X&&re(ee+131072);for(var J=(1<<ae)-1,He=(1<<ne)-1,je=j;;je=j){var Ye=(H=oe[T(F,j)&J])>>>4;if((j+=15&H)>ue){$&&P(0);break}if(H||P(2),Ye<256)V[ee++]=Ye;else{if(Ye==256){je=j,oe=null;break}var Ve=Ye-254;if(Ye>264){var Ke=n[ze=Ye-257];Ve=D(F,j,(1<<Ke)-1)+c[ze],j+=Ke}var at=Q[T(F,j)&He],ut=at>>>4;if(at||P(3),j+=15&at,we=h[ut],ut>3&&(Ke=s[ut],we+=T(F,j)&(1<<Ke)-1,j+=Ke),j>ue){$&&P(0);break}X&&re(ee+131072);for(var ht=ee+Ve;ee<ht;ee+=4)V[ee]=V[ee-we],V[ee+1]=V[ee+1-we],V[ee+2]=V[ee+2-we],V[ee+3]=V[ee+3-we];ee=ht}}k.l=oe,k.p=je,k.b=ee,oe&&(G=1,k.m=ae,k.d=Q,k.n=ne)}while(!G);return ee==V.length?V:function($e,St,Pt){(Pt==null||Pt>$e.length)&&(Pt=$e.length);var Kt=new($e instanceof i?i:$e instanceof r?r:e)(Pt-St);return Kt.set($e.subarray(St,Pt)),Kt}(V,0,ee)},O=new e(0),U=typeof TextDecoder<"u"&&new TextDecoder;try{U.decode(O,{stream:!0})}catch{}return t.convert_streams=function(F){var V=new DataView(F),k=0;function K(){var Ce=V.getUint16(k);return k+=2,Ce}function X(){var Ce=V.getUint32(k);return k+=4,Ce}function $(Ce){xe.setUint16(be,Ce),be+=2}function Y(Ce){xe.setUint32(be,Ce),be+=4}for(var re={signature:X(),flavor:X(),length:X(),numTables:K(),reserved:K(),totalSfntSize:X(),majorVersion:K(),minorVersion:K(),metaOffset:X(),metaLength:X(),metaOrigLength:X(),privOffset:X(),privLength:X()},G=0;Math.pow(2,G)<=re.numTables;)G++;G--;for(var j=16*Math.pow(2,G),ee=16*re.numTables-j,oe=12,Q=[],ae=0;ae<re.numTables;ae++)Q.push({tag:X(),offset:X(),compLength:X(),origLength:X(),origChecksum:X()}),oe+=16;var ne,ue=new Uint8Array(12+16*Q.length+Q.reduce(function(Ce,ge){return Ce+ge.origLength+4},0)),fe=ue.buffer,xe=new DataView(fe),be=0;return Y(re.flavor),$(re.numTables),$(j),$(G),$(ee),Q.forEach(function(Ce){Y(Ce.tag),Y(Ce.origChecksum),Y(oe),Y(Ce.origLength),Ce.outOffset=oe,(oe+=Ce.origLength)%4!=0&&(oe+=4-oe%4)}),Q.forEach(function(Ce){var ge,Te=F.slice(Ce.offset,Ce.offset+Ce.compLength);if(Ce.compLength!=Ce.origLength){var ce=new Uint8Array(Ce.origLength);ge=new Uint8Array(Te,2),R(ge,ce)}else ce=new Uint8Array(Te);ue.set(ce,Ce.outOffset);var Ue=0;(oe=Ce.outOffset+Ce.origLength)%4!=0&&(Ue=4-oe%4),ue.set(new Uint8Array(Ue).buffer,Ce.outOffset+Ce.origLength),ne=oe+Ue}),fe.slice(0,ne)},Object.defineProperty(t,"__esModule",{value:!0}),t}({}).convert_streams}function b5e(t,e){const i={M:2,L:2,Q:4,C:6,Z:0},r={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},n=1,s=2,a=4,o=8,l=16,c=32;let u;function h(L){if(!u){const P={R:s,L:n,D:a,C:l,U:c,T:o};u=new Map;for(let R in r){let O=0;r[R].split(",").forEach(U=>{let[F,V]=U.split("+");F=parseInt(F,36),V=V?parseInt(V,36):0,u.set(O+=F,P[R]);for(let k=V;k--;)u.set(++O,P[R])})}}return u.get(L)||c}const d=1,p=2,g=3,x=4,v=[null,"isol","init","fina","medi"];function b(L){const P=new Uint8Array(L.length);let R=c,O=d,U=-1;for(let F=0;F<L.length;F++){const V=L.codePointAt(F);let k=h(V)|0,K=d;k&o||(R&(n|a|l)?k&(s|a|l)?(K=g,(O===d||O===g)&&P[U]++):k&(n|c)&&(O===p||O===x)&&P[U]--:R&(s|c)&&(O===p||O===x)&&P[U]--,O=P[F]=K,R=k,U=F,V>65535&&F++)}return P}function w(L,P){const R=[];for(let U=0;U<P.length;U++){const F=P.codePointAt(U);F>65535&&U++,R.push(t.U.codeToGlyph(L,F))}const O=L.GSUB;if(O){const{lookupList:U,featureList:F}=O;let V;const k=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,K=[];F.forEach(X=>{if(k.test(X.tag))for(let $=0;$<X.tab.length;$++){if(K[X.tab[$]])continue;K[X.tab[$]]=!0;const Y=U[X.tab[$]],re=/^(isol|init|fina|medi)$/.test(X.tag);re&&!V&&(V=b(P));for(let G=0;G<R.length;G++)(!V||!re||v[V[G]]===X.tag)&&t.U._applySubs(R,G,Y,U)}})}return R}function M(L,P){const R=new Int16Array(P.length*3);let O=0;for(;O<P.length;O++){const k=P[O];if(k===-1)continue;R[O*3+2]=L.hmtx.aWidth[k];const K=L.GPOS;if(K){const X=K.lookupList;for(let $=0;$<X.length;$++){const Y=X[$];for(let re=0;re<Y.tabs.length;re++){const G=Y.tabs[re];if(Y.ltype===1){if(t._lctf.coverageIndex(G.coverage,k)!==-1&&G.pos){V(G.pos,O);break}}else if(Y.ltype===2){let j=null,ee=U();if(ee!==-1){const oe=t._lctf.coverageIndex(G.coverage,P[ee]);if(oe!==-1){if(G.fmt===1){const Q=G.pairsets[oe];for(let ae=0;ae<Q.length;ae++)Q[ae].gid2===k&&(j=Q[ae])}else if(G.fmt===2){const Q=t.U._getGlyphClass(P[ee],G.classDef1),ae=t.U._getGlyphClass(k,G.classDef2);j=G.matrix[Q][ae]}if(j){j.val1&&V(j.val1,ee),j.val2&&V(j.val2,O);break}}}}else if(Y.ltype===4){const j=t._lctf.coverageIndex(G.markCoverage,k);if(j!==-1){const ee=U(F),oe=ee===-1?-1:t._lctf.coverageIndex(G.baseCoverage,P[ee]);if(oe!==-1){const Q=G.markArray[j],ae=G.baseArray[oe][Q.markClass];R[O*3]=ae.x-Q.x+R[ee*3]-R[ee*3+2],R[O*3+1]=ae.y-Q.y+R[ee*3+1];break}}}else if(Y.ltype===6){const j=t._lctf.coverageIndex(G.mark1Coverage,k);if(j!==-1){const ee=U();if(ee!==-1){const oe=P[ee];if(E(L,oe)===3){const Q=t._lctf.coverageIndex(G.mark2Coverage,oe);if(Q!==-1){const ae=G.mark1Array[j],ne=G.mark2Array[Q][ae.markClass];R[O*3]=ne.x-ae.x+R[ee*3]-R[ee*3+2],R[O*3+1]=ne.y-ae.y+R[ee*3+1];break}}}}}}}}else if(L.kern&&!L.cff){const X=U();if(X!==-1){const $=L.kern.glyph1.indexOf(P[X]);if($!==-1){const Y=L.kern.rval[$].glyph2.indexOf(k);Y!==-1&&(R[X*3+2]+=L.kern.rval[$].vals[Y])}}}}return R;function U(k){for(let K=O-1;K>=0;K--)if(P[K]!==-1&&(!k||k(P[K])))return K;return-1}function F(k){return E(L,k)===1}function V(k,K){for(let X=0;X<3;X++)R[K*3+X]+=k[X]||0}}function E(L,P){const R=L.GDEF&&L.GDEF.glyphClassDef;return R?t.U._getGlyphClass(P,R):0}function D(...L){for(let P=0;P<L.length;P++)if(typeof L[P]=="number")return L[P]}function T(L){const P=Object.create(null),R=L["OS/2"],O=L.hhea,U=L.head.unitsPerEm,F=D(R&&R.sTypoAscender,O&&O.ascender,U),V={unitsPerEm:U,ascender:F,descender:D(R&&R.sTypoDescender,O&&O.descender,0),capHeight:D(R&&R.sCapHeight,F),xHeight:D(R&&R.sxHeight,F),lineGap:D(R&&R.sTypoLineGap,O&&O.lineGap),supportsCodePoint(k){return t.U.codeToGlyph(L,k)>0},forEachGlyph(k,K,X,$){let Y=0;const re=1/V.unitsPerEm*K,G=w(L,k);let j=0;const ee=M(L,G);return G.forEach((oe,Q)=>{if(oe!==-1){let ae=P[oe];if(!ae){const{cmds:ne,crds:ue}=t.U.glyphToPath(L,oe);let fe="",xe=0;for(let ce=0,Ue=ne.length;ce<Ue;ce++){const ze=i[ne[ce]];fe+=ne[ce];for(let Xe=1;Xe<=ze;Xe++)fe+=(Xe>1?",":"")+ue[xe++]}let be,Ce,ge,Te;if(ue.length){be=Ce=1/0,ge=Te=-1/0;for(let ce=0,Ue=ue.length;ce<Ue;ce+=2){let ze=ue[ce],Xe=ue[ce+1];ze<be&&(be=ze),Xe<Ce&&(Ce=Xe),ze>ge&&(ge=ze),Xe>Te&&(Te=Xe)}}else be=ge=Ce=Te=0;ae=P[oe]={index:oe,advanceWidth:L.hmtx.aWidth[oe],xMin:be,yMin:Ce,xMax:ge,yMax:Te,path:fe}}$.call(null,ae,Y+ee[Q*3]*re,ee[Q*3+1]*re,j),Y+=ee[Q*3+2]*re,X&&(Y+=X*K)}j+=k.codePointAt(j)>65535?2:1}),Y}};return V}return function(P){const R=new Uint8Array(P,0,4),O=t._bin.readASCII(R,0,4);if(O==="wOFF")P=e(P);else if(O==="wOF2")throw new Error("woff2 fonts not supported");return T(t.parse(P)[0])}}const _5e=Db({name:"Typr Font Parser",dependencies:[y5e,x5e,b5e],init(t,e,i){const r=t(),n=e();return i(r,n)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function S5e(){return function(t){var e=function(){this.buckets=new Map};e.prototype.add=function(M){var E=M>>5;this.buckets.set(E,(this.buckets.get(E)||0)|1<<(31&M))},e.prototype.has=function(M){var E=this.buckets.get(M>>5);return E!==void 0&&(E&1<<(31&M))!=0},e.prototype.serialize=function(){var M=[];return this.buckets.forEach(function(E,D){M.push((+D).toString(36)+":"+E.toString(36))}),M.join(",")},e.prototype.deserialize=function(M){var E=this;this.buckets.clear(),M.split(",").forEach(function(D){var T=D.split(":");E.buckets.set(parseInt(T[0],36),parseInt(T[1],36))})};var i=Math.pow(2,8),r=i-1,n=~r;function s(M){var E=function(T){return T&n}(M).toString(16),D=function(T){return(T&n)+i-1}(M).toString(16);return"codepoint-index/plane"+(M>>16)+"/"+E+"-"+D+".json"}function a(M,E){var D=M&r,T=E.codePointAt(D/6|0);return((T=(T||48)-48)&1<<D%6)!=0}function o(M,E){var D;(D=M,D.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(T){return T.split("-").map(function(L){return parseInt(L.trim(),16)})})).forEach(function(T){var L=T[0],P=T[1];P===void 0&&(P=L),E(L,P)})}function l(M,E){o(M,function(D,T){for(var L=D;L<=T;L++)E(L)})}var c={},u={},h=new WeakMap,d="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function p(M){var E=h.get(M);return E||(E=new e,l(M.ranges,function(D){return E.add(D)}),h.set(M,E)),E}var g,x=new Map;function v(M,E,D){return M[E]?E:M[D]?D:function(T){for(var L in T)return L}(M)}function b(M,E){var D=E;if(!M.includes(D)){D=1/0;for(var T=0;T<M.length;T++)Math.abs(M[T]-E)<Math.abs(D-E)&&(D=M[T])}return D}function w(M){return g||(g=new Set,l("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(E){g.add(E)})),g.has(M)}return t.CodePointSet=e,t.clearCache=function(){c={},u={}},t.getFontsForString=function(M,E){E===void 0&&(E={});var D,T=E.lang;T===void 0&&(T=new RegExp("\\p{Script=Hangul}","u").test(D=M)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(D)?"ja":"en");var L=E.category;L===void 0&&(L="sans-serif");var P=E.style;P===void 0&&(P="normal");var R=E.weight;R===void 0&&(R=400);var O=(E.dataUrl||d).replace(/\/$/g,""),U=new Map,F=new Uint8Array(M.length),V={},k={},K=new Array(M.length),X=new Map,$=!1;function Y(j){var ee=x.get(j);return ee||(ee=fetch(O+"/"+j).then(function(oe){if(!oe.ok)throw new Error(oe.statusText);return oe.json().then(function(Q){if(!Array.isArray(Q)||Q[0]!==1)throw new Error("Incorrect schema version; need 1, got "+Q[0]);return Q[1]})}).catch(function(oe){if(O!==d)return $||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+O+'", trying default CDN. '+oe.message),$=!0),O=d,x.delete(j),Y(j);throw oe}),x.set(j,ee)),ee}for(var re=function(j){var ee=M.codePointAt(j),oe=s(ee);K[j]=oe,c[oe]||X.has(oe)||X.set(oe,Y(oe).then(function(Q){c[oe]=Q})),ee>65535&&(j++,G=j)},G=0;G<M.length;G++)re(G);return Promise.all(X.values()).then(function(){X.clear();for(var j=function(oe){var Q=M.codePointAt(oe),ae=null,ne=c[K[oe]],ue=void 0;for(var fe in ne){var xe=k[fe];if(xe===void 0&&(xe=k[fe]=new RegExp(fe).test(T||"en")),xe){for(var be in ue=fe,ne[fe])if(a(Q,ne[fe][be])){ae=be;break}break}}if(!ae){e:for(var Ce in ne)if(Ce!==ue){for(var ge in ne[Ce])if(a(Q,ne[Ce][ge])){ae=ge;break e}}}ae||(console.debug("No font coverage for U+"+Q.toString(16)),ae="latin"),K[oe]=ae,u[ae]||X.has(ae)||X.set(ae,Y("font-meta/"+ae+".json").then(function(Te){u[ae]=Te})),Q>65535&&(oe++,ee=oe)},ee=0;ee<M.length;ee++)j(ee);return Promise.all(X.values())}).then(function(){for(var j,ee=null,oe=0;oe<M.length;oe++){var Q=M.codePointAt(oe);if(ee&&(w(Q)||p(ee).has(Q)))F[oe]=F[oe-1];else{ee=u[K[oe]];var ae=V[ee.id];if(!ae){var ne=ee.typeforms,ue=v(ne,L,"sans-serif"),fe=v(ne[ue],P,"normal"),xe=b((j=ne[ue])===null||j===void 0?void 0:j[fe],R);ae=V[ee.id]=O+"/font-files/"+ee.id+"/"+ue+"."+fe+"."+xe+".woff"}var be=U.get(ae);be==null&&(be=U.size,U.set(ae,be)),F[oe]=be}Q>65535&&(oe++,F[oe]=F[oe-1])}return{fontUrls:Array.from(U.keys()),chars:F}})},Object.defineProperty(t,"__esModule",{value:!0}),t}({})}function w5e(t,e){const i=Object.create(null),r=Object.create(null);function n(a,o){const l=c=>{console.error(`Failure loading font ${a}`,c)};try{const c=new XMLHttpRequest;c.open("get",a,!0),c.responseType="arraybuffer",c.onload=function(){if(c.status>=400)l(new Error(c.statusText));else if(c.status>0)try{const u=t(c.response);u.src=a,o(u)}catch(u){l(u)}},c.onerror=l,c.send()}catch(c){l(c)}}function s(a,o){let l=i[a];l?o(l):r[a]?r[a].push(o):(r[a]=[o],n(a,c=>{c.src=a,i[a]=c,r[a].forEach(u=>u(c)),delete r[a]}))}return function(a,o,{lang:l,fonts:c=[],style:u="normal",weight:h="normal",unicodeFontsURL:d}={}){const p=new Uint8Array(a.length),g=[];a.length||w();const x=new Map,v=[];if(u!=="italic"&&(u="normal"),typeof h!="number"&&(h=h==="bold"?700:400),c&&!Array.isArray(c)&&(c=[c]),c=c.slice().filter(E=>!E.lang||E.lang.test(l)).reverse(),c.length){let L=0;(function P(R=0){for(let O=R,U=a.length;O<U;O++){const F=a.codePointAt(O);if(L===1&&g[p[O-1]].supportsCodePoint(F)||O>0&&/\s/.test(a[O]))p[O]=p[O-1],L===2&&(v[v.length-1][1]=O);else for(let V=p[O],k=c.length;V<=k;V++)if(V===k){const K=L===2?v[v.length-1]:v[v.length]=[O,O];K[1]=O,L=2}else{p[O]=V;const{src:K,unicodeRange:X}=c[V];if(!X||M(F,X)){const $=i[K];if(!$){s(K,()=>{P(O)});return}if($.supportsCodePoint(F)){let Y=x.get($);typeof Y!="number"&&(Y=g.length,g.push($),x.set($,Y)),p[O]=Y,L=1;break}}}F>65535&&O+1<U&&(p[O+1]=p[O],O++,L===2&&(v[v.length-1][1]=O))}b()})()}else v.push([0,a.length-1]),b();function b(){if(v.length){const E=v.map(D=>a.substring(D[0],D[1]+1)).join(`
`);e.getFontsForString(E,{lang:l||void 0,style:u,weight:h,dataUrl:d}).then(({fontUrls:D,chars:T})=>{const L=g.length;let P=0;v.forEach(O=>{for(let U=0,F=O[1]-O[0];U<=F;U++)p[O[0]+U]=T[P++]+L;P++});let R=0;D.forEach((O,U)=>{s(O,F=>{g[U+L]=F,++R===D.length&&w()})})})}else w()}function w(){o({chars:p,fonts:g})}function M(E,D){for(let T=0;T<D.length;T++){const[L,P=L]=D[T];if(L<=E&&E<=P)return!0}return!1}}}const M5e=Db({name:"FontResolver",dependencies:[w5e,_5e,S5e],init(t,e,i){return t(e,i())}});function E5e(t,e){const r=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,n="[^\\S\\u00A0]",s=new RegExp(`${n}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:g,lang:x,fonts:v,style:b,weight:w,preResolvedFonts:M,unicodeFontsURL:E},D){const T=({chars:L,fonts:P})=>{let R,O;const U=[];for(let F=0;F<L.length;F++)L[F]!==O?(O=L[F],U.push(R={start:F,end:F,fontObj:P[L[F]]})):R.end=F;D(U)};M?T(M):t(g,T,{lang:x,fonts:v,style:b,weight:w,unicodeFontsURL:E})}function o({text:g="",font:x,lang:v,sdfGlyphSize:b=64,fontSize:w=400,fontWeight:M=1,fontStyle:E="normal",letterSpacing:D=0,lineHeight:T="normal",maxWidth:L=1/0,direction:P,textAlign:R="left",textIndent:O=0,whiteSpace:U="normal",overflowWrap:F="normal",anchorX:V=0,anchorY:k=0,metricsOnly:K=!1,unicodeFontsURL:X,preResolvedFonts:$=null,includeCaretPositions:Y=!1,chunkedBoundsSize:re=8192,colorRanges:G=null},j){const ee=h(),oe={fontLoad:0,typesetting:0};g.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),g=g.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),w=+w,D=+D,L=+L,T=T||"normal",O=+O,a({text:g,lang:v,style:E,weight:M,fonts:typeof x=="string"?[{src:x}]:x,unicodeFontsURL:X,preResolvedFonts:$},Q=>{oe.fontLoad=h()-ee;const ae=isFinite(L);let ne=null,ue=null,fe=null,xe=null,be=null,Ce=null,ge=null,Te=null,ce=0,Ue=0,ze=U!=="nowrap";const Xe=new Map,De=h();let Ge=O,We=0,se=new d;const H=[se];Q.forEach(He=>{const{fontObj:je}=He,{ascender:Ye,descender:Ve,unitsPerEm:Ke,lineGap:at,capHeight:ut,xHeight:ht}=je;let $e=Xe.get(je);if(!$e){const Re=w/Ke,Ee=T==="normal"?(Ye-Ve+at)*Re:T*w,Qe=(Ee-(Ye-Ve)*Re)/2,ot=Math.min(Ee,(Ye-Ve)*Re),pt=(Ye+Ve)/2*Re+ot/2;$e={index:Xe.size,src:je.src,fontObj:je,fontSizeMult:Re,unitsPerEm:Ke,ascender:Ye*Re,descender:Ve*Re,capHeight:ut*Re,xHeight:ht*Re,lineHeight:Ee,baseline:-Qe-Ye*Re,caretTop:pt,caretBottom:pt-ot},Xe.set(je,$e)}const{fontSizeMult:St}=$e,Pt=g.slice(He.start,He.end+1);let Kt,le;je.forEachGlyph(Pt,w,D,(Re,Ee,Qe,ot)=>{Ee+=We,ot+=He.start,Kt=Ee,le=Re;const pt=g.charAt(ot),Bt=Re.advanceWidth*St,Jt=se.count;let qt;if("isEmpty"in Re||(Re.isWhitespace=!!pt&&new RegExp(n).test(pt),Re.canBreakAfter=!!pt&&s.test(pt),Re.isEmpty=Re.xMin===Re.xMax||Re.yMin===Re.yMax||r.test(pt)),!Re.isWhitespace&&!Re.isEmpty&&Ue++,ze&&ae&&!Re.isWhitespace&&Ee+Bt+Ge>L&&Jt){if(se.glyphAt(Jt-1).glyphObj.canBreakAfter)qt=new d,Ge=-Ee;else for(let Ni=Jt;Ni--;)if(Ni===0&&F==="break-word"){qt=new d,Ge=-Ee;break}else if(se.glyphAt(Ni).glyphObj.canBreakAfter){qt=se.splitAt(Ni+1);const Oi=qt.glyphAt(0).x;Ge-=Oi;for(let Tr=qt.count;Tr--;)qt.glyphAt(Tr).x-=Oi;break}qt&&(se.isSoftWrapped=!0,se=qt,H.push(se),ce=L)}let Ft=se.glyphAt(se.count);Ft.glyphObj=Re,Ft.x=Ee+Ge,Ft.y=Qe,Ft.width=Bt,Ft.charIndex=ot,Ft.fontData=$e,pt===`
`&&(se=new d,H.push(se),Ge=-(Ee+Bt+D*w)+O)}),We=Kt+le.advanceWidth*St+D*w});let Z=0;H.forEach(He=>{let je=!0;for(let Ye=He.count;Ye--;){const Ve=He.glyphAt(Ye);je&&!Ve.glyphObj.isWhitespace&&(He.width=Ve.x+Ve.width,He.width>ce&&(ce=He.width),je=!1);let{lineHeight:Ke,capHeight:at,xHeight:ut,baseline:ht}=Ve.fontData;Ke>He.lineHeight&&(He.lineHeight=Ke);const $e=ht-He.baseline;$e<0&&(He.baseline+=$e,He.cap+=$e,He.ex+=$e),He.cap=Math.max(He.cap,He.baseline+at),He.ex=Math.max(He.ex,He.baseline+ut)}He.baseline-=Z,He.cap-=Z,He.ex-=Z,Z+=He.lineHeight});let pe=0,we=0;if(V&&(typeof V=="number"?pe=-V:typeof V=="string"&&(pe=-ce*(V==="left"?0:V==="center"?.5:V==="right"?1:c(V)))),k&&(typeof k=="number"?we=-k:typeof k=="string"&&(we=k==="top"?0:k==="top-baseline"?-H[0].baseline:k==="top-cap"?-H[0].cap:k==="top-ex"?-H[0].ex:k==="middle"?Z/2:k==="bottom"?Z:k==="bottom-baseline"?-H[H.length-1].baseline:c(k)*Z)),!K){const He=e.getEmbeddingLevels(g,P);ne=new Uint16Array(Ue),ue=new Uint8Array(Ue),fe=new Float32Array(Ue*2),xe={},ge=[1/0,1/0,-1/0,-1/0],Te=[],Y&&(Ce=new Float32Array(g.length*4)),G&&(be=new Uint8Array(Ue*3));let je=0,Ye=-1,Ve=-1,Ke,at;if(H.forEach((ut,ht)=>{let{count:$e,width:St}=ut;if($e>0){let Pt=0;for(let ot=$e;ot--&&ut.glyphAt(ot).glyphObj.isWhitespace;)Pt++;let Kt=0,le=0;if(R==="center")Kt=(ce-St)/2;else if(R==="right")Kt=ce-St;else if(R==="justify"&&ut.isSoftWrapped){let ot=0;for(let pt=$e-Pt;pt--;)ut.glyphAt(pt).glyphObj.isWhitespace&&ot++;le=(ce-St)/ot}if(le||Kt){let ot=0;for(let pt=0;pt<$e;pt++){let Bt=ut.glyphAt(pt);const Jt=Bt.glyphObj;Bt.x+=Kt+ot,le!==0&&Jt.isWhitespace&&pt<$e-Pt&&(ot+=le,Bt.width+=le)}}const Re=e.getReorderSegments(g,He,ut.glyphAt(0).charIndex,ut.glyphAt(ut.count-1).charIndex);for(let ot=0;ot<Re.length;ot++){const[pt,Bt]=Re[ot];let Jt=1/0,qt=-1/0;for(let Ft=0;Ft<$e;Ft++)if(ut.glyphAt(Ft).charIndex>=pt){let Ni=Ft,Oi=Ft;for(;Oi<$e;Oi++){let Tr=ut.glyphAt(Oi);if(Tr.charIndex>Bt)break;Oi<$e-Pt&&(Jt=Math.min(Jt,Tr.x),qt=Math.max(qt,Tr.x+Tr.width))}for(let Tr=Ni;Tr<Oi;Tr++){const Dn=ut.glyphAt(Tr);Dn.x=qt-(Dn.x+Dn.width-Jt)}break}}let Ee;const Qe=ot=>Ee=ot;for(let ot=0;ot<$e;ot++){const pt=ut.glyphAt(ot);Ee=pt.glyphObj;const Bt=Ee.index,Jt=He.levels[pt.charIndex]&1;if(Jt){const qt=e.getMirroredCharacter(g[pt.charIndex]);qt&&pt.fontData.fontObj.forEachGlyph(qt,0,0,Qe)}if(Y){const{charIndex:qt,fontData:Ft}=pt,Ni=pt.x+pe,Oi=pt.x+pt.width+pe;Ce[qt*4]=Jt?Oi:Ni,Ce[qt*4+1]=Jt?Ni:Oi,Ce[qt*4+2]=ut.baseline+Ft.caretBottom+we,Ce[qt*4+3]=ut.baseline+Ft.caretTop+we;const Tr=qt-Ye;Tr>1&&u(Ce,Ye,Tr),Ye=qt}if(G){const{charIndex:qt}=pt;for(;qt>Ve;)Ve++,G.hasOwnProperty(Ve)&&(at=G[Ve])}if(!Ee.isWhitespace&&!Ee.isEmpty){const qt=je++,{fontSizeMult:Ft,src:Ni,index:Oi}=pt.fontData,Tr=xe[Ni]||(xe[Ni]={});Tr[Bt]||(Tr[Bt]={path:Ee.path,pathBounds:[Ee.xMin,Ee.yMin,Ee.xMax,Ee.yMax]});const Dn=pt.x+pe,pn=pt.y+ut.baseline+we;fe[qt*2]=Dn,fe[qt*2+1]=pn;const Fr=Dn+Ee.xMin*Ft,_e=pn+Ee.yMin*Ft,tt=Dn+Ee.xMax*Ft,ct=pn+Ee.yMax*Ft;Fr<ge[0]&&(ge[0]=Fr),_e<ge[1]&&(ge[1]=_e),tt>ge[2]&&(ge[2]=tt),ct>ge[3]&&(ge[3]=ct),qt%re===0&&(Ke={start:qt,end:qt,rect:[1/0,1/0,-1/0,-1/0]},Te.push(Ke)),Ke.end++;const qe=Ke.rect;if(Fr<qe[0]&&(qe[0]=Fr),_e<qe[1]&&(qe[1]=_e),tt>qe[2]&&(qe[2]=tt),ct>qe[3]&&(qe[3]=ct),ne[qt]=Bt,ue[qt]=Oi,G){const it=qt*3;be[it]=at>>16&255,be[it+1]=at>>8&255,be[it+2]=at&255}}}}}),Ce){const ut=g.length-Ye;ut>1&&u(Ce,Ye,ut)}}const J=[];Xe.forEach(({index:He,src:je,unitsPerEm:Ye,ascender:Ve,descender:Ke,lineHeight:at,capHeight:ut,xHeight:ht})=>{J[He]={src:je,unitsPerEm:Ye,ascender:Ve,descender:Ke,lineHeight:at,capHeight:ut,xHeight:ht}}),oe.typesetting=h()-De,j({glyphIds:ne,glyphFontIndices:ue,glyphPositions:fe,glyphData:xe,fontData:J,caretPositions:Ce,glyphColors:be,chunkedBounds:Te,fontSize:w,topBaseline:we+H[0].baseline,blockBounds:[pe,we-Z,pe+ce,we],visibleBounds:ge,timings:oe})})}function l(g,x){o({...g,metricsOnly:!0},v=>{const[b,w,M,E]=v.blockBounds;x({width:M-b,height:E-w})})}function c(g){let x=g.match(/^([\d.]+)%$/),v=x?parseFloat(x[1]):NaN;return isNaN(v)?0:v/100}function u(g,x,v){const b=g[x*4],w=g[x*4+1],M=g[x*4+2],E=g[x*4+3],D=(w-b)/v;for(let T=0;T<v;T++){const L=(x+T)*4;g[L]=b+D*T,g[L+1]=b+D*(T+1),g[L+2]=M,g[L+3]=E}}function h(){return(self.performance||Date).now()}function d(){this.data=[]}const p=["glyphObj","x","y","width","charIndex","fontData"];return d.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/p.length)},glyphAt(g){let x=d.flyweight;return x.data=this.data,x.index=g,x},splitAt(g){let x=new d;return x.data=this.data.splice(g*p.length),x}},d.flyweight=p.reduce((g,x,v,b)=>(Object.defineProperty(g,x,{get(){return this.data[this.index*p.length+v]},set(w){this.data[this.index*p.length+v]=w}}),g),{data:null,index:0}),{typeset:o,measure:l}}const D0=()=>(self.performance||Date).now(),VP=b$();let M9;function A5e(t,e,i,r,n,s,a,o,l,c,u=!0){return u?C5e(t,e,i,r,n,s,a,o,l,c).then(null,h=>(M9||(console.warn("WebGL SDF generation failed, falling back to JS",h),M9=!0),A9(t,e,i,r,n,s,a,o,l,c))):A9(t,e,i,r,n,s,a,o,l,c)}const gC=[],T5e=5;let ZB=0;function S$(){const t=D0();for(;gC.length&&D0()-t<T5e;)gC.shift()();ZB=gC.length?setTimeout(S$,0):0}const C5e=(...t)=>new Promise((e,i)=>{gC.push(()=>{const r=D0();try{VP.webgl.generateIntoCanvas(...t),e({timing:D0()-r})}catch(n){i(n)}}),ZB||(ZB=setTimeout(S$,0))}),D5e=4,P5e=2e3,E9={};let R5e=0;function A9(t,e,i,r,n,s,a,o,l,c){const u="TroikaTextSDFGenerator_JS_"+R5e++%D5e;let h=E9[u];return h||(h=E9[u]={workerModule:Db({name:u,workerId:u,dependencies:[b$,D0],init(d,p){const g=d().javascript.generate;return function(...x){const v=p();return{textureData:g(...x),timing:p()-v}}},getTransferables(d){return[d.textureData.buffer]}}),requests:0,idleTimer:null}),h.requests++,clearTimeout(h.idleTimer),h.workerModule(t,e,i,r,n,s).then(({textureData:d,timing:p})=>{const g=D0(),x=new Uint8Array(d.length*4);for(let v=0;v<d.length;v++)x[v*4+c]=d[v];return VP.webglUtils.renderImageData(a,x,o,l,t,e,1<<3-c),p+=D0()-g,--h.requests===0&&(h.idleTimer=setTimeout(()=>{l5e(u)},P5e)),{timing:p}})}function O5e(t){t._warm||(VP.webgl.isSupported(t),t._warm=!0)}const L5e=VP.webglUtils.resizeWebGLCanvasWithoutClearing,jS={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},I5e=new Zt;function jx(){return(self.performance||Date).now()}const T9=Object.create(null);function w$(t,e){t=B5e({},t);const i=jx(),r=[];if(t.font&&r.push({label:"user",src:N5e(t.font)}),t.font=r,t.text=""+t.text,t.sdfGlyphSize=t.sdfGlyphSize||jS.sdfGlyphSize,t.unicodeFontsURL=t.unicodeFontsURL||jS.unicodeFontsURL,t.colorRanges!=null){let d={};for(let p in t.colorRanges)if(t.colorRanges.hasOwnProperty(p)){let g=t.colorRanges[p];typeof g!="number"&&(g=I5e.set(g).getHex()),d[p]=g}t.colorRanges=d}Object.freeze(t);const{textureWidth:n,sdfExponent:s}=jS,{sdfGlyphSize:a}=t,o=n/a*4;let l=T9[a];if(!l){const d=document.createElement("canvas");d.width=n,d.height=a*256/o,l=T9[a]={glyphCount:0,sdfGlyphSize:a,sdfCanvas:d,sdfTexture:new ss(d,void 0,void 0,void 0,Cs,Cs),contextLost:!1,glyphsByFont:new Map},l.sdfTexture.generateMipmaps=!1,z5e(l)}const{sdfTexture:c,sdfCanvas:u}=l;A$(t).then(d=>{const{glyphIds:p,glyphFontIndices:g,fontData:x,glyphPositions:v,fontSize:b,timings:w}=d,M=[],E=new Float32Array(p.length*4);let D=0,T=0;const L=jx(),P=x.map(V=>{let k=l.glyphsByFont.get(V.src);return k||l.glyphsByFont.set(V.src,k=new Map),k});p.forEach((V,k)=>{const K=g[k],{src:X,unitsPerEm:$}=x[K];let Y=P[K].get(V);if(!Y){const{path:oe,pathBounds:Q}=d.glyphData[X][V],ae=Math.max(Q[2]-Q[0],Q[3]-Q[1])/a*(jS.sdfMargin*a+.5),ne=l.glyphCount++,ue=[Q[0]-ae,Q[1]-ae,Q[2]+ae,Q[3]+ae];P[K].set(V,Y={path:oe,atlasIndex:ne,sdfViewBox:ue}),M.push(Y)}const{sdfViewBox:re}=Y,G=v[T++],j=v[T++],ee=b/$;E[D++]=G+re[0]*ee,E[D++]=j+re[1]*ee,E[D++]=G+re[2]*ee,E[D++]=j+re[3]*ee,p[k]=Y.atlasIndex}),w.quads=(w.quads||0)+(jx()-L);const R=jx();w.sdf={};const O=u.height,U=Math.ceil(l.glyphCount/o),F=Math.pow(2,Math.ceil(Math.log2(U*a)));F>O&&(console.info(`Increasing SDF texture size ${O}->${F}`),L5e(u,n,F),c.dispose()),Promise.all(M.map(V=>M$(V,l,t.gpuAccelerateSDF).then(({timing:k})=>{w.sdf[V.atlasIndex]=k}))).then(()=>{M.length&&!l.contextLost&&(E$(l),c.needsUpdate=!0),w.sdfTotal=jx()-R,w.total=jx()-i,e(Object.freeze({parameters:t,sdfTexture:c,sdfGlyphSize:a,sdfExponent:s,glyphBounds:E,glyphAtlasIndices:p,glyphColors:d.glyphColors,caretPositions:d.caretPositions,chunkedBounds:d.chunkedBounds,ascender:d.ascender,descender:d.descender,lineHeight:d.lineHeight,capHeight:d.capHeight,xHeight:d.xHeight,topBaseline:d.topBaseline,blockBounds:d.blockBounds,visibleBounds:d.visibleBounds,timings:d.timings}))})}),Promise.resolve().then(()=>{l.contextLost||O5e(u)})}function M$({path:t,atlasIndex:e,sdfViewBox:i},{sdfGlyphSize:r,sdfCanvas:n,contextLost:s},a){if(s)return Promise.resolve({timing:-1});const{textureWidth:o,sdfExponent:l}=jS,c=Math.max(i[2]-i[0],i[3]-i[1]),u=Math.floor(e/4),h=u%(o/r)*r,d=Math.floor(u/(o/r))*r,p=e%4;return A5e(r,r,t,i,c,l,n,h,d,p,a)}function z5e(t){const e=t.sdfCanvas;e.addEventListener("webglcontextlost",i=>{console.log("Context Lost",i),i.preventDefault(),t.contextLost=!0}),e.addEventListener("webglcontextrestored",i=>{console.log("Context Restored",i),t.contextLost=!1;const r=[];t.glyphsByFont.forEach(n=>{n.forEach(s=>{r.push(M$(s,t,!0))})}),Promise.all(r).then(()=>{E$(t),t.sdfTexture.needsUpdate=!0})})}function U5e({font:t,characters:e,sdfGlyphSize:i},r){let n=Array.isArray(e)?e.join(`
`):""+e;w$({font:t,sdfGlyphSize:i,text:n},r)}function B5e(t,e){for(let i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}let UT;function N5e(t){return UT||(UT=typeof document>"u"?{}:document.createElement("a")),UT.href=t,UT.href}function E$(t){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:i}=t,{width:r,height:n}=e,s=t.sdfCanvas.getContext("webgl");let a=i.image.data;(!a||a.length!==r*n*4)&&(a=new Uint8Array(r*n*4),i.image={width:r,height:n,data:a},i.flipY=!1,i.isDataTexture=!0),s.readPixels(0,0,r,n,s.RGBA,s.UNSIGNED_BYTE,a)}}const F5e=Db({name:"Typesetter",dependencies:[E5e,M5e,u5e],init(t,e,i){return t(e,i())}}),A$=Db({name:"Typesetter",dependencies:[F5e],init(t){return function(e){return new Promise(i=>{t.typeset(e,i)})}},getTransferables(t){const e=[];for(let i in t)t[i]&&t[i].buffer&&e.push(t[i].buffer);return e}});A$.onMainThread;const C9={};function k5e(t){let e=C9[t];return e||(e=C9[t]=new kp(1,1,t,t).translate(.5,.5,0)),e}const V5e="aTroikaGlyphBounds",D9="aTroikaGlyphIndex",H5e="aTroikaGlyphColor";class G5e extends OF{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new oo,this.boundingBox=new ao}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){this._detail=e,(typeof e!="number"||e<1)&&(e=1);let i=k5e(e);["position","normal","uv"].forEach(r=>{this.attributes[r]=i.attributes[r].clone()}),this.setIndex(i.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,i,r,n,s){this.updateAttributeData(V5e,e,4),this.updateAttributeData(D9,i,1),this.updateAttributeData(H5e,s,3),this._blockBounds=r,this._chunkedBounds=n,this.instanceCount=i.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:i,boundingBox:r}=this;if(i){const{PI:n,floor:s,min:a,max:o,sin:l,cos:c}=Math,u=n/2,h=n*2,d=Math.abs(i),p=e[0]/d,g=e[2]/d,x=s((p+u)/h)!==s((g+u)/h)?-d:a(l(p)*d,l(g)*d),v=s((p-u)/h)!==s((g-u)/h)?d:o(l(p)*d,l(g)*d),b=s((p+n)/h)!==s((g+n)/h)?d*2:o(d-c(p)*d,d-c(g)*d);r.min.set(x,e[1],i<0?-b:0),r.max.set(v,e[3],i<0?0:b)}else r.min.set(e[0],e[1],0),r.max.set(e[2],e[3],0);r.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let i=this.getAttribute(D9).count,r=this._chunkedBounds;if(r)for(let n=r.length;n--;){i=r[n].end;let s=r[n].rect;if(s[1]<e.w&&s[3]>e.y&&s[0]<e.z&&s[2]>e.x)break}this.instanceCount=i}updateAttributeData(e,i,r){const n=this.getAttribute(e);i?n&&n.array.length===i.length?(n.array.set(i),n.needsUpdate=!0):(this.setAttribute(e,new j0(i,r)),delete this._maxInstanceCount,this.dispose()):n&&this.deleteAttribute(e)}}const j5e=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,W5e=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,q5e=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,X5e=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function Y5e(t){const e=QB(t,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Tt},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Ar(0,0,0,0)},uTroikaClipRect:{value:new Ar(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Tt},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Zt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Yi},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:j5e,vertexTransform:W5e,fragmentDefs:q5e,fragmentColorTransform:X5e,customRewriter({vertexShader:i,fragmentShader:r}){let n=/\buniform\s+vec3\s+diffuse\b/;return n.test(r)&&(r=r.replace(n,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),n.test(i)||(i=i.replace(_$,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:i,fragmentShader:r}}});return e.transparent=!0,e.forceSinglePass=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}const GF=new Fp({color:16777215,side:ch,transparent:!0}),P9=8421504,R9=new Ui,BT=new Se,KI=new Se,DS=[],Q5e=new Se,JI="+x+y";function O9(t){return Array.isArray(t)?t[0]:t}let T$=()=>{const t=new is(new kp(1,1),GF);return T$=()=>t,t},C$=()=>{const t=new is(new kp(1,1,32,1),GF);return C$=()=>t,t};const Z5e={type:"syncstart"},K5e={type:"synccomplete"},D$=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],J5e=D$.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let P$=class extends is{constructor(){const e=new G5e;super(e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=P9,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=JI,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(Z5e),w$({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},i=>{this._isSyncing=!1,this._textRenderInfo=i,this.geometry.updateGlyphs(i.glyphBounds,i.glyphAtlasIndices,i.blockBounds,i.chunkedBounds,i.glyphColors);const r=this._queuedSyncs;r&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{r.forEach(n=>n&&n())})),this.dispatchEvent(K5e),e&&e()})))}onBeforeRender(e,i,r,n,s,a){this.sync(),s.isTroikaTextMaterial&&this._prepareForRender(s)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return Y5e(e)}get material(){let e=this._derivedMaterial;const i=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=GF.clone());if((!e||!e.isDerivedFrom(i))&&(e=this._derivedMaterial=this.createDerivedMaterial(i),i.addEventListener("dispose",function r(){i.removeEventListener("dispose",r),e.dispose()})),this.hasOutline()){let r=e._outlineMtl;return r||(r=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),r.isTextOutlineMaterial=!0,r.depthWrite=!1,r.map=null,e.addEventListener("dispose",function n(){e.removeEventListener("dispose",n),r.dispose()})),[r,e]}else return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return O9(this.material).getDepthMaterial()}get customDistanceMaterial(){return O9(this.material).getDistanceMaterial()}_prepareForRender(e){const i=e.isTextOutlineMaterial,r=e.uniforms,n=this.textRenderInfo;if(n){const{sdfTexture:o,blockBounds:l}=n;r.uTroikaSDFTexture.value=o,r.uTroikaSDFTextureSize.value.set(o.image.width,o.image.height),r.uTroikaSDFGlyphSize.value=n.sdfGlyphSize,r.uTroikaSDFExponent.value=n.sdfExponent,r.uTroikaTotalBounds.value.fromArray(l),r.uTroikaUseGlyphColors.value=!i&&!!n.glyphColors;let c=0,u=0,h=0,d,p,g,x=0,v=0;if(i){let{outlineWidth:w,outlineOffsetX:M,outlineOffsetY:E,outlineBlur:D,outlineOpacity:T}=this;c=this._parsePercent(w)||0,u=Math.max(0,this._parsePercent(D)||0),d=T,x=this._parsePercent(M)||0,v=this._parsePercent(E)||0}else h=Math.max(0,this._parsePercent(this.strokeWidth)||0),h&&(g=this.strokeColor,r.uTroikaStrokeColor.value.set(g??P9),p=this.strokeOpacity,p==null&&(p=1)),d=this.fillOpacity;r.uTroikaEdgeOffset.value=c,r.uTroikaPositionOffset.value.set(x,v),r.uTroikaBlurRadius.value=u,r.uTroikaStrokeWidth.value=h,r.uTroikaStrokeOpacity.value=p,r.uTroikaFillOpacity.value=d??1,r.uTroikaCurveRadius.value=this.curveRadius||0;let b=this.clipRect;if(b&&Array.isArray(b)&&b.length===4)r.uTroikaClipRect.value.fromArray(b);else{const w=(this.fontSize||.1)*100;r.uTroikaClipRect.value.set(l[0]-w,l[1]-w,l[2]+w,l[3]+w)}this.geometry.applyClipRect(r.uTroikaClipRect.value)}r.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const s=i?this.outlineColor||0:this.color;if(s==null)delete e.color;else{const o=e.hasOwnProperty("color")?e.color:e.color=new Zt;(s!==o._input||typeof s=="object")&&o.set(o._input=s)}let a=this.orientation||JI;if(a!==e._orientation){let o=r.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let l=a!==JI&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(l){let[,c,u,h,d]=l;BT.set(0,0,0)[u]=c==="-"?1:-1,KI.set(0,0,0)[d]=h==="-"?-1:1,R9.lookAt(Q5e,BT.cross(KI),KI),o.setFromMatrix4(R9)}else o.identity();e._orientation=a}}_parsePercent(e){if(typeof e=="string"){let i=e.match(/^(-?[\d.]+)%$/),r=i?parseFloat(i[1]):NaN;e=(isNaN(r)?0:r/100)*this.fontSize}return e}localPositionToTextCoords(e,i=new Tt){i.copy(e);const r=this.curveRadius;return r&&(i.x=Math.atan2(e.x,Math.abs(r)-Math.abs(e.z))*Math.abs(r)),i}worldPositionToTextCoords(e,i=new Tt){return BT.copy(e),this.localPositionToTextCoords(this.worldToLocal(BT),i)}raycast(e,i){const{textRenderInfo:r,curveRadius:n}=this;if(r){const s=r.blockBounds,a=n?C$():T$(),o=a.geometry,{position:l,uv:c}=o.attributes;for(let u=0;u<c.count;u++){let h=s[0]+c.getX(u)*(s[2]-s[0]);const d=s[1]+c.getY(u)*(s[3]-s[1]);let p=0;n&&(p=n-Math.cos(h/n)*n,h=Math.sin(h/n)*n),l.setXYZ(u,h,d,p)}o.boundingSphere=this.geometry.boundingSphere,o.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,DS.length=0,a.raycast(e,DS);for(let u=0;u<DS.length;u++)DS[u].object=this,i.push(DS[u])}}copy(e){const i=this.geometry;return super.copy(e),this.geometry=i,J5e.forEach(r=>{this[r]=e[r]}),this}clone(){return new this.constructor().copy(this)}};D$.forEach(t=>{const e="_private_"+t;Object.defineProperty(P$.prototype,t,{get(){return this[e]},set(i){i!==this[e]&&(this[e]=i,this._needsSync=!0)}})});new ao;new Zt;const $5e=Me.forwardRef(({sdfGlyphSize:t=64,anchorX:e="center",anchorY:i="middle",font:r,fontSize:n=1,children:s,characters:a,onSync:o,...l},c)=>{const u=h$(({invalidate:g})=>g),[h]=Me.useState(()=>new P$),[d,p]=Me.useMemo(()=>{const g=[];let x="";return Me.Children.forEach(s,v=>{typeof v=="string"||typeof v=="number"?x+=v:g.push(v)}),[g,x]},[s]);return sFe(()=>new Promise(g=>U5e({font:r,characters:a},g)),["troika-text",r,a]),Me.useLayoutEffect(()=>void h.sync(()=>{u(),o&&o(h)})),Me.useEffect(()=>()=>h.dispose(),[h]),Me.createElement("primitive",hM({object:h,ref:c,font:r,text:p,anchorX:e,anchorY:i,fontSize:n,sdfGlyphSize:t},l),d)}),eke=Me.forwardRef(({makeDefault:t,camera:e,domElement:i,regress:r,onChange:n,onStart:s,onEnd:a,...o},l)=>{const{invalidate:c,camera:u,gl:h,events:d,set:p,get:g,performance:x,viewport:v}=h$(),b=e||u,w=i||d.connected||h.domElement,M=Me.useMemo(()=>new i5e(b),[b]);return FP(()=>{M.enabled&&M.update()},-1),Me.useEffect(()=>(M.connect(w),()=>void M.dispose()),[w,r,M,c]),Me.useEffect(()=>{const E=D=>{c(),r&&x.regress(),n&&n(D)};return M.addEventListener("change",E),s&&M.addEventListener("start",s),a&&M.addEventListener("end",a),()=>{s&&M.removeEventListener("start",s),a&&M.removeEventListener("end",a),M.removeEventListener("change",E)}},[n,s,a,M,c]),Me.useEffect(()=>{M.handleResize()},[v]),Me.useEffect(()=>{if(t){const E=g().controls;return p({controls:M}),()=>p({controls:E})}},[t,M]),Me.createElement("primitive",hM({ref:l,object:M},o))});function tke({children:t,fontSize:e,isLoading:i,onLoadComplete:r,...n}){const s=new Zt,a={fontSize:e||2.5,letterSpacing:-.05,lineHeight:1},o=Me.useRef(null),[l,c]=Me.useState(!1),u=p=>{p.stopPropagation(),c(!0)},h=()=>c(!1);Me.useEffect(()=>(l&&(document.body.style.cursor="pointer"),()=>{document.body.style.cursor="auto"}),[l]);const d=p=>{const[g,x,v]=p,b=Math.atan2(v,g),w=new so;return w.setFromAxisAngle(new Se(0,1,0),b+Math.PI/4),w};return FP(({clock:p})=>{if(o.current)try{const g=o.current.material;g&&g.color&&g.color.lerp(s.set(l?"#ffcc00":"white"),.1);const x=p.getElapsedTime(),v=Math.sin(x+n.position[0]*.5)*.15;o.current.position.y+=v*.01,i===!1&&(o.current.scale.x>.01?(o.current.scale.x*=.9,o.current.scale.y*=.9,o.current.scale.z*=.9):o.current.scale.x>.001&&(r(),o.current.scale.set(0,0,0)))}catch(g){console.error("Error in animation frame:",g)}}),Pe.jsx(r5e,{...n,quaternion:d(n.position),children:Pe.jsx($5e,{ref:o,onPointerOver:u,onPointerOut:h,onClick:()=>console.log(`Clicked on: ${t}`),...a,children:t})})}function ike({isLoading:t,onLoadComplete:e,words:i}){const n=i||[{text:"hand",size:4},{text:"history",size:3.8},{text:"piece",size:3.8},{text:"habit",size:3.5},{text:"band",size:3.5},{text:"dollar",size:3.5},{text:"bank",size:3.5},{text:"success",size:3.2},{text:"fish",size:3.2},{text:"pure",size:3.2},{text:"number",size:3.2},{text:"clay",size:3.2},{text:"baby",size:3},{text:"watch",size:3},{text:"dawn",size:3},{text:"cloud",size:3.7},{text:"dream",size:3.6},{text:"future",size:3.9},{text:"space",size:3.4},{text:"journey",size:3.3},{text:"magic",size:3.7},{text:"book",size:3.1},{text:"ocean",size:3.8},{text:"light",size:3.6},{text:"music",size:3.9},{text:"nature",size:3.5},{text:"science",size:3.2},{text:"love",size:4},{text:"art",size:3.7},{text:"mind",size:3.6},{text:"world",size:3.8},{text:"idea",size:3.4},{text:"time",size:3.6},{text:"life",size:4},{text:"power",size:3.5},{text:"heart",size:3.7},{text:"fire",size:3.3},{text:"water",size:3.4},{text:"earth",size:3.3},{text:"wind",size:3.2},{text:"star",size:3.5},{text:"moon",size:3.4},{text:"sun",size:3.6},{text:"joy",size:3.2},{text:"peace",size:3.5},{text:"hope",size:3.6},{text:"truth",size:3.7},{text:"faith",size:3.4},{text:"wisdom",size:3.8},{text:"beauty",size:3.7}],[s,a]=Me.useState(0),o=n.length;Me.useEffect(()=>{s>=o&&!t&&e()},[s,o,t,e]);const l=()=>{a(h=>h+1)},c=Me.useMemo(()=>{try{const h=[],p=n.length,g=10,x=8,v=1;v>0&&n.length>0&&(h.push({position:[0,18,0],word:n[0].text,size:n[0].size*.6}),n.length>1&&h.push({position:[0,-18,0],word:n[1].text,size:n[1].size*.6}));for(let b=v*2;b<n.length;b++){const w=b-v*2,M=w%g,E=Math.floor(w/g),D=Math.ceil((p-v*2)/g),T=.1+E/D*.8,L=M*.2,P=2*Math.PI*x*(T+L)+2*Math.PI*M/g,R=Math.PI*T,O=18*Math.sin(R)*Math.cos(P),U=18*Math.cos(R),F=18*Math.sin(R)*Math.sin(P),V=.9+Math.abs(Math.cos(R))*.2;h.push({position:[O,U,F],word:n[b].text,size:n[b].size*.5*V})}return h}catch(h){return console.error("Error creating tag items:",h),[]}},[n]),u=Me.useRef(null);return FP(({clock:h})=>{u.current&&(u.current.rotation.y=h.getElapsedTime()*1,u.current.rotation.x=Math.sin(h.getElapsedTime()*.3)*.3)}),Pe.jsx("group",{ref:u,children:c.map((h,d)=>Pe.jsx(tke,{position:h.position,fontSize:h.size,isLoading:t,onLoadComplete:l,children:h.word},d))})}function R$({onLoadComplete:t,words:e}){const[i,r]=Me.useState(!0);return Me.useEffect(()=>{const n=setTimeout(()=>{r(!1)},2e3);return()=>clearTimeout(n)},[]),Pe.jsx("div",{style:{width:"100%",height:"100vh",background:"#111111",position:"relative"},children:Pe.jsxs(QFe,{dpr:[1,2],camera:{position:[0,0,45],fov:60},style:{background:"#111111"},children:[Pe.jsx("color",{attach:"background",args:["#111111"]}),Pe.jsx("fog",{attach:"fog",args:["#111111",20,80]}),Pe.jsx("ambientLight",{intensity:.5}),Pe.jsx(Me.Suspense,{fallback:null,children:Pe.jsx(ike,{isLoading:i,onLoadComplete:t,words:e})}),Pe.jsx(eke,{rotateSpeed:2,zoomSpeed:.5,panSpeed:.5,enabled:i})]})})}function XM({className:t,...e}){return Pe.jsx("div",{"data-slot":"card",className:Gd("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...e})}function rke({className:t,...e}){return Pe.jsx("div",{"data-slot":"card-header",className:Gd("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...e})}function nke({className:t,...e}){return Pe.jsx("div",{"data-slot":"card-title",className:Gd("leading-none font-semibold",t),...e})}function YM({className:t,...e}){return Pe.jsx("div",{"data-slot":"card-content",className:Gd("px-6",t),...e})}function ske(t,e=[]){let i=[];function r(s,a){const o=Me.createContext(a),l=i.length;i=[...i,a];const c=h=>{var b;const{scope:d,children:p,...g}=h,x=((b=d==null?void 0:d[t])==null?void 0:b[l])||o,v=Me.useMemo(()=>g,Object.values(g));return Pe.jsx(x.Provider,{value:v,children:p})};c.displayName=s+"Provider";function u(h,d){var x;const p=((x=d==null?void 0:d[t])==null?void 0:x[l])||o,g=Me.useContext(p);if(g)return g;if(a!==void 0)return a;throw new Error(`\`${h}\` must be used within \`${s}\``)}return[c,u]}const n=()=>{const s=i.map(a=>Me.createContext(a));return function(o){const l=(o==null?void 0:o[t])||s;return Me.useMemo(()=>({[`__scope${t}`]:{...o,[t]:l}}),[o,l])}};return n.scopeName=t,[r,ake(n,...e)]}function ake(...t){const e=t[0];if(t.length===1)return e;const i=()=>{const r=t.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(s){const a=r.reduce((o,{useScope:l,scopeName:c})=>{const h=l(s)[`__scope${c}`];return{...o,...h}},{});return Me.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return i.scopeName=e.scopeName,i}function L9(t,e,{checkForDefaultPrevented:i=!0}={}){return function(n){if(t==null||t(n),i===!1||!n.defaultPrevented)return e==null?void 0:e(n)}}function O$(t){const e=Me.useRef(t);return Me.useEffect(()=>{e.current=t}),Me.useMemo(()=>(...i)=>{var r;return(r=e.current)==null?void 0:r.call(e,...i)},[])}function oke({prop:t,defaultProp:e,onChange:i=()=>{}}){const[r,n]=lke({defaultProp:e,onChange:i}),s=t!==void 0,a=s?t:r,o=O$(i),l=Me.useCallback(c=>{if(s){const h=typeof c=="function"?c(t):c;h!==t&&o(h)}else n(c)},[s,t,n,o]);return[a,l]}function lke({defaultProp:t,onChange:e}){const i=Me.useState(t),[r]=i,n=Me.useRef(r),s=O$(e);return Me.useEffect(()=>{n.current!==r&&(s(r),n.current=r)},[r,n,s]),i}function cke(t){const e=Me.useRef({value:t,previous:t});return Me.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var KB=globalThis!=null&&globalThis.document?Me.useLayoutEffect:()=>{};function uke(t){const[e,i]=Me.useState(void 0);return KB(()=>{if(t){i({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(n=>{if(!Array.isArray(n)||!n.length)return;const s=n[0];let a,o;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;a=c.inlineSize,o=c.blockSize}else a=t.offsetWidth,o=t.offsetHeight;i({width:a,height:o})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else i(void 0)},[t]),e}function hke(t,e){return Me.useReducer((i,r)=>e[i][r]??i,t)}var L$=t=>{const{present:e,children:i}=t,r=dke(e),n=typeof i=="function"?i({present:r.isPresent}):Me.Children.only(i),s=d7(r.ref,fke(n));return typeof i=="function"||r.isPresent?Me.cloneElement(n,{ref:s}):null};L$.displayName="Presence";function dke(t){const[e,i]=Me.useState(),r=Me.useRef({}),n=Me.useRef(t),s=Me.useRef("none"),a=t?"mounted":"unmounted",[o,l]=hke(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return Me.useEffect(()=>{const c=NT(r.current);s.current=o==="mounted"?c:"none"},[o]),KB(()=>{const c=r.current,u=n.current;if(u!==t){const d=s.current,p=NT(c);t?l("MOUNT"):p==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(u&&d!==p?"ANIMATION_OUT":"UNMOUNT"),n.current=t}},[t,l]),KB(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,h=p=>{const x=NT(r.current).includes(p.animationName);if(p.target===e&&x&&(l("ANIMATION_END"),!n.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},d=p=>{p.target===e&&(s.current=NT(r.current))};return e.addEventListener("animationstart",d),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",d),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:Me.useCallback(c=>{c&&(r.current=getComputedStyle(c)),i(c)},[])}}function NT(t){return(t==null?void 0:t.animationName)||"none"}function fke(t){var r,n;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,i=e&&"isReactWarning"in e&&e.isReactWarning;return i?t.ref:(e=(n=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:n.get,i=e&&"isReactWarning"in e&&e.isReactWarning,i?t.props.ref:t.props.ref||t.ref)}var pke=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],I$=pke.reduce((t,e)=>{const i=Me.forwardRef((r,n)=>{const{asChild:s,...a}=r,o=s?oN:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),Pe.jsx(o,{...a,ref:n})});return i.displayName=`Primitive.${e}`,{...t,[e]:i}},{}),jF="Checkbox",[mke,qHe]=ske(jF),[gke,vke]=mke(jF),z$=Me.forwardRef((t,e)=>{const{__scopeCheckbox:i,name:r,checked:n,defaultChecked:s,required:a,disabled:o,value:l="on",onCheckedChange:c,form:u,...h}=t,[d,p]=Me.useState(null),g=d7(e,E=>p(E)),x=Me.useRef(!1),v=d?u||!!d.closest("form"):!0,[b=!1,w]=oke({prop:n,defaultProp:s,onChange:c}),M=Me.useRef(b);return Me.useEffect(()=>{const E=d==null?void 0:d.form;if(E){const D=()=>w(M.current);return E.addEventListener("reset",D),()=>E.removeEventListener("reset",D)}},[d,w]),Pe.jsxs(gke,{scope:i,state:b,disabled:o,children:[Pe.jsx(I$.button,{type:"button",role:"checkbox","aria-checked":xg(b)?"mixed":b,"aria-required":a,"data-state":N$(b),"data-disabled":o?"":void 0,disabled:o,value:l,...h,ref:g,onKeyDown:L9(t.onKeyDown,E=>{E.key==="Enter"&&E.preventDefault()}),onClick:L9(t.onClick,E=>{w(D=>xg(D)?!0:!D),v&&(x.current=E.isPropagationStopped(),x.current||E.stopPropagation())})}),v&&Pe.jsx(yke,{control:d,bubbles:!x.current,name:r,value:l,checked:b,required:a,disabled:o,form:u,style:{transform:"translateX(-100%)"},defaultChecked:xg(s)?!1:s})]})});z$.displayName=jF;var U$="CheckboxIndicator",B$=Me.forwardRef((t,e)=>{const{__scopeCheckbox:i,forceMount:r,...n}=t,s=vke(U$,i);return Pe.jsx(L$,{present:r||xg(s.state)||s.state===!0,children:Pe.jsx(I$.span,{"data-state":N$(s.state),"data-disabled":s.disabled?"":void 0,...n,ref:e,style:{pointerEvents:"none",...t.style}})})});B$.displayName=U$;var yke=t=>{const{control:e,checked:i,bubbles:r=!0,defaultChecked:n,...s}=t,a=Me.useRef(null),o=cke(i),l=uke(e);Me.useEffect(()=>{const u=a.current,h=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(h,"checked").set;if(o!==i&&p){const g=new Event("click",{bubbles:r});u.indeterminate=xg(i),p.call(u,xg(i)?!1:i),u.dispatchEvent(g)}},[o,i,r]);const c=Me.useRef(xg(i)?!1:i);return Pe.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n??c.current,...s,tabIndex:-1,ref:a,style:{...t.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function xg(t){return t==="indeterminate"}function N$(t){return xg(t)?"indeterminate":t?"checked":"unchecked"}var xke=z$,bke=B$;/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _ke=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),F$=(...t)=>t.filter((e,i,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===i).join(" ").trim();/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ske={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wke=Me.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:i=2,absoluteStrokeWidth:r,className:n="",children:s,iconNode:a,...o},l)=>Me.createElement("svg",{ref:l,...Ske,width:e,height:e,stroke:t,strokeWidth:r?Number(i)*24/Number(e):i,className:F$("lucide",n),...o},[...a.map(([c,u])=>Me.createElement(c,u)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mke=(t,e)=>{const i=Me.forwardRef(({className:r,...n},s)=>Me.createElement(wke,{ref:s,iconNode:e,className:F$(`lucide-${_ke(t)}`,r),...n}));return i.displayName=`${t}`,i};/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eke=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ake=Mke("Check",Eke);function FT({className:t,...e}){return Pe.jsx(xke,{"data-slot":"checkbox",className:Gd("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...e,children:Pe.jsx(bke,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:Pe.jsx(Ake,{className:"size-3.5"})})})}const Tke=({filters:t,onFilterChange:e,onClearFilters:i})=>Pe.jsxs(XM,{className:"max-h-[calc(100vh-180px)] overflow-y-auto",children:[Pe.jsx(rke,{children:Pe.jsx(nke,{children:"Filters"})}),Pe.jsx(YM,{children:Pe.jsxs("div",{className:"space-y-6",children:[Pe.jsxs("div",{children:[Pe.jsx("h3",{className:"text-sm font-semibold mb-2 text-gray-700",children:"Semester"}),Pe.jsx("div",{className:"space-y-2",children:["Fall","Spring","Summer","Winter"].map(r=>Pe.jsxs("div",{className:"flex items-center space-x-2",children:[Pe.jsx(FT,{id:r.toLowerCase(),checked:t.semester.includes(r),onCheckedChange:()=>e("semester",r)}),Pe.jsx("label",{htmlFor:r.toLowerCase(),className:"text-sm font-medium leading-none",children:r})]},r))})]}),Pe.jsxs("div",{children:[Pe.jsx("h3",{className:"text-sm font-semibold mb-2 text-gray-700",children:"Class Level"}),Pe.jsx("div",{className:"space-y-2",children:["1000","2000","3000","4000","5000+"].map(r=>Pe.jsxs("div",{className:"flex items-center space-x-2",children:[Pe.jsx(FT,{id:`level${r}`,checked:t.classLevel.includes(r),onCheckedChange:()=>e("classLevel",r)}),Pe.jsx("label",{htmlFor:`level${r}`,className:"text-sm font-medium leading-none",children:r})]},r))})]}),Pe.jsxs("div",{children:[Pe.jsx("h3",{className:"text-sm font-semibold mb-2 text-gray-700",children:"Difficulty"}),Pe.jsx("div",{className:"space-y-2",children:["Easy","Medium","Hard"].map(r=>Pe.jsxs("div",{className:"flex items-center space-x-2",children:[Pe.jsx(FT,{id:`difficulty-${r.toLowerCase()}`,checked:t.difficulty.includes(r),onCheckedChange:()=>e("difficulty",r)}),Pe.jsx("label",{htmlFor:`difficulty-${r.toLowerCase()}`,className:"text-sm font-medium leading-none",children:r})]},r))})]}),Pe.jsxs("div",{children:[Pe.jsx("h3",{className:"text-sm font-semibold mb-2 text-gray-700",children:"Workload"}),Pe.jsx("div",{className:"space-y-2",children:["Light","Moderate","Heavy"].map(r=>Pe.jsxs("div",{className:"flex items-center space-x-2",children:[Pe.jsx(FT,{id:`workload-${r.toLowerCase()}`,checked:t.workload.includes(r),onCheckedChange:()=>e("workload",r)}),Pe.jsx("label",{htmlFor:`workload-${r.toLowerCase()}`,className:"text-sm font-medium leading-none",children:r})]},r))})]}),Pe.jsx(w3,{variant:"outline",className:"w-full",onClick:i,children:"Clear All Filters"})]})})]});function Cke({classItem:t,isSelected:e=!1,onClick:i}){const r=n=>{switch(n.trim()){case"Fall":return"bg-amber-100 text-amber-800";case"Spring":return"bg-green-100 text-green-800";case"Summer":return"bg-blue-100 text-blue-800";case"Winter":return"bg-indigo-100 text-indigo-800";default:return"bg-gray-100 text-gray-800"}};return Pe.jsx(XM,{className:Gd("transition-shadow cursor-pointer",e?"border-blue-500 shadow-md":"hover:shadow-md hover:border-blue-300"),onClick:i,children:Pe.jsxs(YM,{className:"p-4",children:[Pe.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[Pe.jsx("span",{className:"text-sm font-medium text-gray-500",children:t.classCode||t.course_code}),Pe.jsx("div",{className:"flex flex-wrap gap-1",children:(t.semester||t.term_offered||[]).map((n,s)=>Pe.jsx("span",{className:Gd("text-xs px-2 py-0.5 rounded",r(n)),children:n.trim()},s))})]}),Pe.jsx("h3",{className:"font-semibold",children:t.title||t["course title"]||"No Title"}),Pe.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:t.description||""}),(t.distribution||t.distributions||[]).length>0&&Pe.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:(t.distribution||t.distributions||[]).map((n,s)=>Pe.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-purple-100 text-purple-800",children:n},s))})]})})}const Dke=({results:t,loading:e,error:i,selectedCourse:r,onSelectCourse:n,query:s})=>Pe.jsxs("div",{children:[Pe.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Search Results (",t.length,")"]}),i&&Pe.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:i}),Pe.jsx("div",{className:"space-y-6 max-h-[calc(100vh-180px)] overflow-y-auto pr-2 pb-4",children:e?Pe.jsx("p",{className:"text-gray-500",children:"Loading courses..."}):t.length>0?t.map(a=>Pe.jsx(Cke,{classItem:a,isSelected:r?r.course_code===a.course_code:!1,onClick:()=>n(a)},a.course_code)):Pe.jsx("p",{className:"text-gray-500",children:s?`No results found for "${s}"`:"Enter a search query"})})]});function k$({review:t}){const e=(i,r=5)=>{const n=typeof i=="string"?i==="-"?0:parseInt(i):i||0;return Pe.jsx("div",{className:"flex",children:[...Array(r)].map((s,a)=>Pe.jsx("svg",{className:`w-5 h-5 ${a<n?"text-yellow-400":"text-gray-300"}`,fill:"currentColor",viewBox:"0 0 20 20",children:Pe.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})},a))})};return t?Pe.jsx(XM,{className:"mb-4",children:Pe.jsxs(YM,{className:"p-4",children:[t.professor&&t.professor!=="N/A"&&Pe.jsx("div",{className:"mb-2",children:Pe.jsxs("div",{className:"text-sm text-gray-600 font-medium",children:["Professor: ",t.professor]})}),t.major&&t.major!=="N/A"&&Pe.jsx("div",{className:"mb-2",children:Pe.jsxs("div",{className:"text-sm text-gray-600",children:["Major: ",t.major]})}),t.grade&&t.grade!=="N/A"&&Pe.jsx("div",{className:"mb-2",children:Pe.jsxs("div",{className:"text-sm text-gray-600",children:["Grade: ",t.grade]})}),Pe.jsxs("div",{className:"flex flex-wrap gap-4 mb-3",children:[t.overall&&t.overall!=="-"&&Pe.jsxs("div",{className:"flex items-center",children:[Pe.jsx("span",{className:"text-sm font-medium mr-2",children:"Overall:"}),e(t.overall)]}),t.difficulty&&t.difficulty!=="-"&&Pe.jsxs("div",{className:"flex items-center",children:[Pe.jsx("span",{className:"text-sm font-medium mr-2",children:"Difficulty:"}),e(t.difficulty)]}),t.workload&&t.workload!=="-"&&Pe.jsxs("div",{className:"flex items-center",children:[Pe.jsx("span",{className:"text-sm font-medium mr-2",children:"Workload:"}),e(t.workload)]})]}),t.comment&&Pe.jsx("p",{className:"text-gray-700 mb-3",children:t.comment})]})}):null}const Pke=({course:t,loading:e})=>t?Pe.jsxs("div",{className:"max-h-[calc(100vh-180px)] overflow-y-auto pr-2 pb-4",children:[Pe.jsx(XM,{className:"mb-6",children:Pe.jsxs(YM,{className:"p-6",children:[Pe.jsx("div",{className:"mb-2 flex items-center",children:Pe.jsx("span",{className:"text-lg font-medium text-gray-500 mr-2",children:t.course_code})}),Pe.jsx("h2",{className:"text-2xl font-bold mb-4",children:t["course title"]||t.title||"No Title"}),Pe.jsx("p",{className:"text-gray-700 mb-4",children:t.description}),Pe.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[Pe.jsxs("div",{className:"flex flex-col",children:[Pe.jsx("span",{className:"text-sm text-gray-500",children:"Difficulty"}),Pe.jsx("span",{className:"font-semibold",children:t.avgDifficulty&&t.avgDifficulty>0?`${t.avgDifficulty.toFixed(1)}/5`:"N/A"})]}),Pe.jsxs("div",{className:"flex flex-col",children:[Pe.jsx("span",{className:"text-sm text-gray-500",children:"Workload"}),Pe.jsx("span",{className:"font-semibold",children:t.avgWorkload&&t.avgWorkload>0?`${t.avgWorkload.toFixed(1)}/5`:"N/A"})]})]}),t.term_offered&&t.term_offered.length>0&&Pe.jsxs("div",{className:"mb-4",children:[Pe.jsx("span",{className:"font-semibold",children:"Terms Offered: "}),t.term_offered.join(", ")]}),t.distributions&&t.distributions.length>0&&Pe.jsxs("div",{className:"mb-4",children:[Pe.jsx("span",{className:"font-semibold",children:"Distributions: "}),t.distributions.join(", ")]})]})}),Pe.jsx("h2",{className:"text-xl font-semibold my-4",children:"Reviews"}),Pe.jsx("div",{className:"space-y-6",children:t.reviews&&t.reviews.length>0?t.reviews.slice(0,2).map((i,r)=>Pe.jsx(k$,{review:i},r)):Pe.jsx("p",{className:"text-gray-500",children:"No reviews available for this course."})}),Pe.jsx("div",{className:"mt-6",children:Pe.jsx(S3,{to:`/class/${t.course_code.replace(/\s+/g,"-")}?data=${encodeURIComponent(JSON.stringify({id:t.course_code,course_code:t.course_code,classCode:t.course_code,title:t["course title"]||t.title||"No Title",description:t.description||"",semester:t.term_offered||[],distribution:t.distributions||[],reviews:t.reviews||[],avgDifficulty:t.avgDifficulty||0,avgWorkload:t.avgWorkload||0,avgOverall:t.avgOverall||0}))}`,children:Pe.jsx(w3,{className:"w-full",children:"See more about class"})})})]}):Pe.jsx("div",{className:"flex items-center justify-center h-64",children:Pe.jsx("p",{className:"text-gray-500",children:e?"Loading...":"Select a course to view details"})});function Rke(){const t=Up(),i=new URLSearchParams(t.search).get("q")||"",[r,n]=Me.useState(null),[s,a]=Me.useState([]),[o,l]=Me.useState(!1),[c,u]=Me.useState(null),[h,d]=Me.useState({semester:[],classLevel:[],difficulty:[],workload:[]}),[p,g]=Me.useState(!0),[x,v]=Me.useState(!1),[b,w]=Me.useState(void 0);Me.useEffect(()=>{i?(g(!0),v(!1)):(g(!1),v(!0))},[i]),Me.useEffect(()=>{if(b&&b.length>0){g(!0);const P=setTimeout(()=>{},1e3);return()=>clearTimeout(P)}},[b]),Me.useEffect(()=>{(async()=>{if(i){l(!0),u(null),w(void 0);try{const R=await qne(i);console.log("Search results:",R),R.courses&&Array.isArray(R.courses)&&R.courses.length>0?(a(R.courses),n(R.courses[0]),w(R.keywords),console.log("Keywords for cloud:",R.keywords)):(console.log("No results found or results not in expected format"),a([]),n(null),w(void 0))}catch(R){console.error("Error fetching data:",R),u("Failed to fetch search results. Please try again."),a([]),n(null),w(void 0)}finally{l(!1)}}})()},[i]);const M=()=>{setTimeout(()=>{g(!1),v(!0)},300)},E=(P,R)=>{d(O=>{const U={...O};return U[P].includes(R)?U[P]=U[P].filter(F=>F!==R):U[P]=[...U[P],R],U})},D=()=>{d({semester:[],classLevel:[],difficulty:[],workload:[]})},T=Array.isArray(s)?Qne(s,h):[],L=P=>{n(P)};return Pe.jsxs("div",{className:"min-h-screen bg-gray-50 relative",children:[Pe.jsx(VS,{initialQuery:i}),p&&i?Pe.jsx("div",{className:"absolute inset-0 z-50",children:Pe.jsx(R$,{onLoadComplete:M,words:b})}):x||!i?Pe.jsxs("div",{className:"max-w-7xl mx-auto p-4 grid grid-cols-1 md:grid-cols-12 gap-6 mt-6",children:[Pe.jsx("div",{className:"md:col-span-3",children:Pe.jsx(Dke,{results:T,loading:o,error:c,selectedCourse:r,onSelectCourse:L,query:i})}),Pe.jsx("div",{className:"md:col-span-6",children:Pe.jsx(Pke,{course:r,loading:o})}),Pe.jsx("div",{className:"md:col-span-3",children:Pe.jsx(Tke,{filters:h,onFilterChange:E,onClearFilters:D})})]}):null]})}function Oke(){const[t,e]=Me.useState(null),[i,r]=Me.useState(!0),[n,s]=Me.useState(null),a=Ete(),o=Up(),l=new URLSearchParams(o.search),c=a.id,u=l.get("data");Me.useEffect(()=>{(async()=>{if(c){r(!0),s(null);try{if(u)try{const x=JSON.parse(u);console.log("Using data passed from search page:",x),e(x),r(!1);return}catch(x){console.error("Error parsing passed data:",x)}const p=c.replace(/-/g," ");console.log("Fetching data for class:",p);const g=await Xne(p);g?e({id:g.course_code,course_code:g.course_code,classCode:g.course_code,title:g["course title"]||"No Title",description:g.description||"No description available",semester:g.term_offered||[],distribution:g.distributions||[],reviews:g.reviews||[],avgDifficulty:g.avgDifficulty||0,avgWorkload:g.avgWorkload||0,avgOverall:g.avgOverall||0}):s("Course not found. Please check the course ID.")}catch(p){console.error("Error loading course data:",p),s("Failed to load course data. Please try again later.")}finally{r(!1)}}})()},[c,u]);const h=(d,p)=>d&&d.length>0?Pe.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:d.map((g,x)=>Pe.jsx("span",{className:Gd(`px-2 py-1 text-xs font-medium rounded-full ${p}`),children:g},x))}):null;return i?Pe.jsxs("div",{className:"min-h-screen bg-gray-50",children:[Pe.jsx(VS,{}),Pe.jsx("div",{className:"max-w-7xl mx-auto p-4 mt-6 flex justify-center items-center",children:Pe.jsx("p",{className:"text-lg",children:"Loading class details..."})})]}):n?Pe.jsxs("div",{className:"min-h-screen bg-gray-50",children:[Pe.jsx(VS,{}),Pe.jsx("div",{className:"max-w-7xl mx-auto p-4 mt-6",children:Pe.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:n})})]}):t?Pe.jsxs("div",{className:"min-h-screen bg-gray-50",children:[Pe.jsx(VS,{}),Pe.jsxs("div",{className:"max-w-7xl mx-auto p-4 mt-6",children:[Pe.jsxs("div",{className:"mb-2 flex items-start",children:[Pe.jsx("span",{className:"text-lg font-medium text-gray-500 mr-2",children:t.classCode}),h(t.semester,"bg-blue-100 text-blue-800")]}),Pe.jsx("h1",{className:"text-4xl font-bold mb-2",children:t.title}),h(t.distribution,"bg-purple-100 text-purple-800")]}),Pe.jsxs("div",{className:"max-w-7xl mx-auto p-4 grid grid-cols-1 md:grid-cols-12 gap-6 mt-2",children:[Pe.jsx("div",{className:"md:col-span-7",children:Pe.jsx("div",{className:"max-h-[calc(100vh-220px)] overflow-y-auto pr-2",children:Pe.jsx(XM,{children:Pe.jsxs(YM,{className:"p-6",children:[Pe.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Description"}),Pe.jsx("p",{className:"text-gray-700 mb-6",children:t.description}),Pe.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[Pe.jsxs("div",{className:"flex flex-col",children:[Pe.jsx("span",{className:"text-lg font-semibold mb-1",children:"Difficulty"}),Pe.jsx("span",{className:"text-gray-700",children:(t.avgDifficulty||0)>0?`${(t.avgDifficulty||0).toFixed(1)}/5`:"No data available"})]}),Pe.jsxs("div",{className:"flex flex-col",children:[Pe.jsx("span",{className:"text-lg font-semibold mb-1",children:"Workload"}),Pe.jsx("span",{className:"text-gray-700",children:(t.avgWorkload||0)>0?`${(t.avgWorkload||0).toFixed(1)}/5`:"No data available"})]})]}),Pe.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Terms Offered"}),Pe.jsx("p",{className:"text-gray-700 mb-6",children:t.semester&&t.semester.length>0?t.semester.join(", "):"No term information available"}),Pe.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Distribution Requirements"}),Pe.jsx("p",{className:"text-gray-700",children:t.distribution&&t.distribution.length>0?t.distribution.join(", "):"No distribution information available"})]})})})}),Pe.jsxs("div",{className:"md:col-span-5",children:[Pe.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Reviews"}),Pe.jsx("div",{className:"space-y-6 max-h-[calc(100vh-220px)] overflow-y-auto pr-2 pb-4",children:t.reviews&&t.reviews.length>0?t.reviews.map((d,p)=>Pe.jsx(k$,{review:d},p)):Pe.jsx("p",{className:"text-gray-500",children:"No reviews available for this course."})})]})]})]}):Pe.jsxs("div",{className:"min-h-screen bg-gray-50",children:[Pe.jsx(VS,{}),Pe.jsx("div",{className:"max-w-7xl mx-auto p-4 mt-6",children:Pe.jsx("p",{className:"text-lg text-center",children:"Course not found. Please check the course ID and try again."})})]})}function Lke(){const t=()=>{console.log("Cloud animation completed")};return Pe.jsx("div",{style:{width:"100%",height:"100vh"},children:Pe.jsx(R$,{onLoadComplete:t})})}function Ike(){return Pe.jsx("div",{style:{width:"100%",height:"100vh"},children:Pe.jsx(Y7,{})})}const bw="generated",zke="pointerdown",Uke="pointerup",I9="pointerleave",Bke="pointerout",z9="pointermove",Nke="touchstart",U9="touchend",Fke="touchmove",kke="touchcancel",Vke="resize",Hke="visibilitychange",X0="tsParticles - Error";class mc{constructor(e,i,r){if(this._updateFromAngle=(n,s)=>{this.x=Math.cos(n)*s,this.y=Math.sin(n)*s},!au(e)&&e){this.x=e.x,this.y=e.y;const n=e;this.z=n.z?n.z:0}else if(e!==void 0&&i!==void 0)this.x=e,this.y=i,this.z=r??0;else throw new Error(`${X0} Vector3d not initialized correctly`)}static get origin(){return mc.create(0,0,0)}get angle(){return Math.atan2(this.y,this.x)}set angle(e){this._updateFromAngle(e,this.length)}get length(){return Math.sqrt(this.getLengthSq())}set length(e){this._updateFromAngle(this.angle,e)}static clone(e){return mc.create(e.x,e.y,e.z)}static create(e,i,r){return new mc(e,i,r)}add(e){return mc.create(this.x+e.x,this.y+e.y,this.z+e.z)}addTo(e){this.x+=e.x,this.y+=e.y,this.z+=e.z}copy(){return mc.clone(this)}distanceTo(e){return this.sub(e).length}distanceToSq(e){return this.sub(e).getLengthSq()}div(e){return mc.create(this.x/e,this.y/e,this.z/e)}divTo(e){this.x/=e,this.y/=e,this.z/=e}getLengthSq(){return this.x**2+this.y**2}mult(e){return mc.create(this.x*e,this.y*e,this.z*e)}multTo(e){this.x*=e,this.y*=e,this.z*=e}normalize(){const e=this.length;e!=0&&this.multTo(1/e)}rotate(e){return mc.create(this.x*Math.cos(e)-this.y*Math.sin(e),this.x*Math.sin(e)+this.y*Math.cos(e),0)}setTo(e){this.x=e.x,this.y=e.y;const i=e;this.z=i.z?i.z:0}sub(e){return mc.create(this.x-e.x,this.y-e.y,this.z-e.z)}subFrom(e){this.x-=e.x,this.y-=e.y,this.z-=e.z}}class bc extends mc{constructor(e,i){super(e,i,0)}static get origin(){return bc.create(0,0)}static clone(e){return bc.create(e.x,e.y)}static create(e,i){return new bc(e,i)}}let Gke=Math.random;function Zr(){return Z1(Gke(),0,1-1e-16)}function Z1(t,e,i){return Math.min(Math.max(t,e),i)}function iu(t){const e=HP(t);let i=WF(t);return e===i&&(i=0),Zr()*(e-i)+i}function Zi(t){return au(t)?t:iu(t)}function WF(t){return au(t)?t:t.min}function HP(t){return au(t)?t:t.max}function pr(t,e){if(t===e||e===void 0&&au(t))return t;const i=WF(t),r=HP(t);return e!==void 0?{min:Math.min(i,e),max:Math.max(r,e)}:pr(i,r)}function qF(t){const e=t.random,{enable:i,minimumValue:r}=bg(e)?{enable:e,minimumValue:0}:e;return Zi(i?pr(t.value,r):t.value)}function T1(t,e){const i=t.x-e.x,r=t.y-e.y;return{dx:i,dy:r,distance:Math.sqrt(i**2+r**2)}}function GP(t,e){return T1(t,e).distance}function jke(t,e,i){if(au(t))return t*Math.PI/180;switch(t){case"top":return-Math.PI/2;case"top-right":return-Math.PI/4;case"right":return 0;case"bottom-right":return Math.PI/4;case"bottom":return Math.PI/2;case"bottom-left":return 3*Math.PI/4;case"left":return Math.PI;case"top-left":return-3*Math.PI/4;case"inside":return Math.atan2(i.y-e.y,i.x-e.x);case"outside":return Math.atan2(e.y-i.y,e.x-i.x);default:return Zr()*Math.PI*2}}function Wke(t){const e=bc.origin;return e.length=1,e.angle=t,e}function qke(t){var e,i;return{x:(((e=t.position)==null?void 0:e.x)??Zr()*100)*t.size.width/100,y:(((i=t.position)==null?void 0:i.y)??Zr()*100)*t.size.height/100}}function Xke(t){var i,r;const e={x:((i=t.position)==null?void 0:i.x)!==void 0?Zi(t.position.x):void 0,y:((r=t.position)==null?void 0:r.y)!==void 0?Zi(t.position.y):void 0};return qke({size:t.size,position:e})}function Yke(t){var e,i;return{x:((e=t.position)==null?void 0:e.x)??Zr()*t.size.width,y:((i=t.position)==null?void 0:i.y)??Zr()*t.size.height}}function V$(t){return t?t.endsWith("%")?parseFloat(t)/100:parseFloat(t):1}const Qke={debug:console.debug,error:console.error,info:console.info,log:console.log,verbose:console.log,warning:console.warn};function dM(){return Qke}function jP(){return typeof window>"u"||!window||typeof window.document>"u"||!window.document}function Zke(){return!jP()&&typeof matchMedia<"u"}function H$(t){if(Zke())return matchMedia(t)}function Kke(t){if(!(jP()||typeof MutationObserver>"u"))return new MutationObserver(t)}function G$(t,e){return t===e||cl(e)&&e.indexOf(t)>-1}function j$(t){return Math.floor(Zr()*t.length)}function WP(t,e,i=!0){return t[e!==void 0&&i?e%t.length:j$(t)]}function qP(t,e,i,r,n){return Jke(XF(t,r??0),e,i,n)}function Jke(t,e,i,r){let n=!0;return(!r||r==="bottom")&&(n=t.top<e.height+i.x),n&&(!r||r==="left")&&(n=t.right>i.x),n&&(!r||r==="right")&&(n=t.left<e.width+i.y),n&&(!r||r==="top")&&(n=t.bottom>i.y),n}function XF(t,e){return{bottom:t.y+e,left:t.x-e,right:t.x+e,top:t.y-e}}function sa(t,...e){for(const i of e){if(i==null)continue;if(!h1(i)){t=i;continue}const r=Array.isArray(i);r&&(h1(t)||!t||!Array.isArray(t))?t=[]:!r&&(h1(t)||!t||Array.isArray(t))&&(t={});for(const n in i){if(n==="__proto__")continue;const s=i,a=s[n],o=t;o[n]=h1(a)&&Array.isArray(a)?a.map(l=>sa(o[n],l)):sa(o[n],a)}}return t}function Qd(t,e){return cl(t)?t.map((i,r)=>e(i,r)):e(t,0)}function C1(t,e,i){return cl(t)?WP(t,e,i):t}function W$(t,e){const i=t.value,r=t.animation,n={delayTime:Zi(r.delay)*1e3,enable:r.enable,value:Zi(t.value)*e,max:HP(i)*e,min:WF(i)*e,loops:0,maxLoops:Zi(r.count),time:0};if(r.enable){switch(n.decay=1-Zi(r.decay),r.mode){case"increase":n.status="increasing";break;case"decrease":n.status="decreasing";break;case"random":n.status=Zr()>=.5?"increasing":"decreasing";break}const s=r.mode==="auto";switch(r.startValue){case"min":n.value=n.min,s&&(n.status="increasing");break;case"max":n.value=n.max,s&&(n.status="decreasing");break;case"random":default:n.value=iu(n),s&&(n.status=Zr()>=.5?"increasing":"decreasing");break}}return n.initialValue=n.value,n}function q$(t,e){if(!(t.mode==="percent")){const{mode:n,...s}=t;return s}return"x"in t?{x:t.x/100*e.width,y:t.y/100*e.height}:{width:t.width/100*e.width,height:t.height/100*e.height}}function X$(t,e){return q$(t,e)}function $ke(t,e){return q$(t,e)}function bg(t){return typeof t=="boolean"}function mh(t){return typeof t=="string"}function au(t){return typeof t=="number"}function YF(t){return typeof t=="function"}function h1(t){return typeof t=="object"&&t!==null}function cl(t){return Array.isArray(t)}const eVe="random",XP=new Map;function B9(t){XP.set(t.key,t)}function $I(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function tVe(t){for(const[,s]of XP)if(t.startsWith(s.stringPrefix))return s.parseString(t);const e=/^#?([a-f\d])([a-f\d])([a-f\d])([a-f\d])?$/i,i=t.replace(e,(s,a,o,l,c)=>a+a+o+o+l+l+(c!==void 0?c+c:"")),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i,n=r.exec(i);return n?{a:n[4]!==void 0?parseInt(n[4],16)/255:1,b:parseInt(n[3],16),g:parseInt(n[2],16),r:parseInt(n[1],16)}:void 0}function D1(t,e,i=!0){if(!t)return;const r=mh(t)?{value:t}:t;if(mh(r.value))return Y$(r.value,e,i);if(cl(r.value))return D1({value:WP(r.value,e,i)});for(const[,n]of XP){const s=n.handleRangeColor(r);if(s)return s}}function Y$(t,e,i=!0){if(!t)return;const r=mh(t)?{value:t}:t;if(mh(r.value))return r.value===eVe?sVe():rVe(r.value);if(cl(r.value))return Y$({value:WP(r.value,e,i)});for(const[,n]of XP){const s=n.handleColor(r);if(s)return s}}function g3(t,e,i=!0){const r=D1(t,e,i);return r?iVe(r):void 0}function iVe(t){const e=t.r/255,i=t.g/255,r=t.b/255,n=Math.max(e,i,r),s=Math.min(e,i,r),a={h:0,l:(n+s)/2,s:0};return n!==s&&(a.s=a.l<.5?(n-s)/(n+s):(n-s)/(2-n-s),a.h=e===n?(i-r)/(n-s):a.h=i===n?2+(r-e)/(n-s):4+(e-i)/(n-s)),a.l*=100,a.s*=100,a.h*=60,a.h<0&&(a.h+=360),a.h>=360&&(a.h-=360),a}function rVe(t){return tVe(t)}function JB(t){const e={b:0,g:0,r:0},i={h:t.h/360,l:t.l/100,s:t.s/100};if(!i.s)e.r=e.g=e.b=i.l;else{const r=i.l<.5?i.l*(1+i.s):i.l+i.s-i.l*i.s,n=2*i.l-r;e.r=$I(n,r,i.h+1/3),e.g=$I(n,r,i.h),e.b=$I(n,r,i.h-1/3)}return e.r=Math.floor(e.r*255),e.g=Math.floor(e.g*255),e.b=Math.floor(e.b*255),e}function nVe(t){const e=JB(t);return{a:t.a,b:e.b,g:e.g,r:e.r}}function sVe(t){return{b:Math.floor(iu(pr(0,256))),g:Math.floor(iu(pr(0,256))),r:Math.floor(iu(pr(0,256)))}}function vC(t,e){return`rgba(${t.r}, ${t.g}, ${t.b}, ${e??1})`}function N9(t,e){return`hsla(${t.h}, ${t.s}%, ${t.l}%, ${e??1})`}function F9(t){return t!==void 0?{h:t.h.value,s:t.s.value,l:t.l.value}:void 0}function aVe(t,e,i){const r={h:{enable:!1,value:t.h},s:{enable:!1,value:t.s},l:{enable:!1,value:t.l}};return e&&(ez(r.h,e.h,i),ez(r.s,e.s,i),ez(r.l,e.l,i)),r}function ez(t,e,i){t.enable=e.enable,t.enable?(t.velocity=Zi(e.speed)/100*i,t.decay=1-Zi(e.decay),t.status="increasing",t.loops=0,t.maxLoops=Zi(e.count),t.time=0,t.delayTime=Zi(e.delay)*1e3,e.sync||(t.velocity*=Zr(),t.value*=Zr()),t.initialValue=t.value):t.velocity=0}function oVe(t,e,i){t.fillStyle=i??"rgba(0,0,0,0)",t.fillRect(0,0,e.width,e.height)}function lVe(t,e,i,r){i&&(t.globalAlpha=r,t.drawImage(i,0,0,e.width,e.height),t.globalAlpha=1)}function tz(t,e){t.clearRect(0,0,e.width,e.height)}function cVe(t){const{container:e,context:i,particle:r,delta:n,colorStyles:s,backgroundMask:a,composite:o,radius:l,opacity:c,shadow:u,transform:h}=t,d=r.getPosition(),p=r.rotation+(r.pathRotation?r.velocity.angle:0),g={sin:Math.sin(p),cos:Math.cos(p)},x={a:g.cos*(h.a??1),b:g.sin*(h.b??1),c:-g.sin*(h.c??1),d:g.cos*(h.d??1)};i.setTransform(x.a,x.b,x.c,x.d,d.x,d.y),i.beginPath(),a&&(i.globalCompositeOperation=o);const v=r.shadowColor;u.enable&&v&&(i.shadowBlur=u.blur,i.shadowColor=vC(v),i.shadowOffsetX=u.offset.x,i.shadowOffsetY=u.offset.y),s.fill&&(i.fillStyle=s.fill);const b=r.strokeWidth??0;i.lineWidth=b,s.stroke&&(i.strokeStyle=s.stroke),uVe(e,i,r,l,c,n),b>0&&i.stroke(),r.close&&i.closePath(),r.fill&&i.fill(),hVe(e,i,r,l,c,n),i.globalCompositeOperation="source-over",i.setTransform(1,0,0,1,0,0)}function uVe(t,e,i,r,n,s){if(!i.shape)return;const a=t.drawers.get(i.shape);a&&a.draw(e,i,r,n,s,t.retina.pixelRatio)}function hVe(t,e,i,r,n,s){if(!i.shape)return;const a=t.drawers.get(i.shape);!a||!a.afterEffect||a.afterEffect(e,i,r,n,s,t.retina.pixelRatio)}function dVe(t,e,i){e.draw&&e.draw(t,i)}function fVe(t,e,i,r){e.drawParticle&&e.drawParticle(t,i,r)}function pVe(t,e,i){return{h:t.h,s:t.s,l:t.l+(e==="darken"?-1:1)*i}}function mVe(t,e,i){const r=e[i];r!==void 0&&(t[i]=(t[i]??1)*r)}class gVe{constructor(e){this.container=e,this._applyPostDrawUpdaters=i=>{for(const r of this._postDrawUpdaters)r.afterDraw&&r.afterDraw(i)},this._applyPreDrawUpdaters=(i,r,n,s,a,o)=>{for(const l of this._preDrawUpdaters){if(l.getColorStyles){const{fill:c,stroke:u}=l.getColorStyles(r,i,n,s);c&&(a.fill=c),u&&(a.stroke=u)}if(l.getTransformValues){const c=l.getTransformValues(r);for(const u in c)mVe(o,c,u)}l.beforeDraw&&l.beforeDraw(r)}},this._applyResizePlugins=()=>{for(const i of this._resizePlugins)i.resize&&i.resize()},this._getPluginParticleColors=i=>{let r,n;for(const s of this._colorPlugins)if(!r&&s.particleFillColor&&(r=g3(s.particleFillColor(i))),!n&&s.particleStrokeColor&&(n=g3(s.particleStrokeColor(i))),r&&n)break;return[r,n]},this._initCover=()=>{const i=this.container.actualOptions,r=i.backgroundMask.cover,n=r.color,s=D1(n);if(s){const a={...s,a:r.opacity};this._coverColorStyle=vC(a,a.a)}},this._initStyle=()=>{const i=this.element,r=this.container.actualOptions;if(i){this._fullScreen?(this._originalStyle=sa({},i.style),this._setFullScreenStyle()):this._resetOriginalStyle();for(const n in r.style){if(!n||!r.style)continue;const s=r.style[n];s&&i.style.setProperty(n,s,"important")}}},this._initTrail=async()=>{const i=this.container.actualOptions,r=i.particles.move.trail,n=r.fill;if(r.enable)if(n.color){const s=D1(n.color);if(!s)return;const a=i.particles.move.trail;this._trailFill={color:{...s},opacity:1/a.length}}else await new Promise((s,a)=>{if(!n.image)return;const o=document.createElement("img");o.addEventListener("load",()=>{this._trailFill={image:o,opacity:1/r.length},s()}),o.addEventListener("error",l=>{a(l.error)}),o.src=n.image})},this._paintBase=i=>{this.draw(r=>oVe(r,this.size,i))},this._paintImage=(i,r)=>{this.draw(n=>lVe(n,this.size,i,r))},this._repairStyle=()=>{const i=this.element;i&&(this._safeMutationObserver(r=>r.disconnect()),this._initStyle(),this.initBackground(),this._safeMutationObserver(r=>r.observe(i,{attributes:!0})))},this._resetOriginalStyle=()=>{const i=this.element,r=this._originalStyle;if(!(i&&r))return;const n=i.style;n.position=r.position,n.zIndex=r.zIndex,n.top=r.top,n.left=r.left,n.width=r.width,n.height=r.height},this._safeMutationObserver=i=>{this._mutationObserver&&i(this._mutationObserver)},this._setFullScreenStyle=()=>{const i=this.element;if(!i)return;const r="important",n=i.style;n.setProperty("position","fixed",r),n.setProperty("z-index",this.container.actualOptions.fullScreen.zIndex.toString(10),r),n.setProperty("top","0",r),n.setProperty("left","0",r),n.setProperty("width","100%",r),n.setProperty("height","100%",r)},this.size={height:0,width:0},this._context=null,this._generated=!1,this._preDrawUpdaters=[],this._postDrawUpdaters=[],this._resizePlugins=[],this._colorPlugins=[]}get _fullScreen(){return this.container.actualOptions.fullScreen.enable}clear(){const e=this.container.actualOptions,i=e.particles.move.trail,r=this._trailFill;e.backgroundMask.enable?this.paint():i.enable&&i.length>0&&r?r.color?this._paintBase(vC(r.color,r.opacity)):r.image&&this._paintImage(r.image,r.opacity):this.draw(n=>{tz(n,this.size)})}destroy(){if(this.stop(),this._generated){const e=this.element;e&&e.remove()}else this._resetOriginalStyle();this._preDrawUpdaters=[],this._postDrawUpdaters=[],this._resizePlugins=[],this._colorPlugins=[]}draw(e){const i=this._context;if(i)return e(i)}drawParticle(e,i){if(e.spawning||e.destroyed)return;const r=e.getRadius();if(r<=0)return;const n=e.getFillColor(),s=e.getStrokeColor()??n;let[a,o]=this._getPluginParticleColors(e);a||(a=n),o||(o=s),!(!a&&!o)&&this.draw(l=>{var M;const c=this.container,u=c.actualOptions,h=e.options.zIndex,d=(1-e.zIndexFactor)**h.opacityRate,p=e.bubble.opacity??((M=e.opacity)==null?void 0:M.value)??1,g=e.strokeOpacity??p,x=p*d,v=g*d,b={},w={fill:a?N9(a,x):void 0};w.stroke=o?N9(o,v):w.fill,this._applyPreDrawUpdaters(l,e,r,x,w,b),cVe({container:c,context:l,particle:e,delta:i,colorStyles:w,backgroundMask:u.backgroundMask.enable,composite:u.backgroundMask.composite,radius:r*(1-e.zIndexFactor)**h.sizeRate,opacity:x,shadow:e.options.shadow,transform:b}),this._applyPostDrawUpdaters(e)})}drawParticlePlugin(e,i,r){this.draw(n=>fVe(n,e,i,r))}drawPlugin(e,i){this.draw(r=>dVe(r,e,i))}async init(){this._safeMutationObserver(e=>e.disconnect()),this._mutationObserver=Kke(e=>{for(const i of e)i.type==="attributes"&&i.attributeName==="style"&&this._repairStyle()}),this.resize(),this._initStyle(),this._initCover();try{await this._initTrail()}catch(e){dM().error(e)}this.initBackground(),this._safeMutationObserver(e=>{this.element&&e.observe(this.element,{attributes:!0})}),this.initUpdaters(),this.initPlugins(),this.paint()}initBackground(){const e=this.container.actualOptions,i=e.background,r=this.element;if(!r)return;const n=r.style;if(n){if(i.color){const s=D1(i.color);n.backgroundColor=s?vC(s,i.opacity):""}else n.backgroundColor="";n.backgroundImage=i.image||"",n.backgroundPosition=i.position||"",n.backgroundRepeat=i.repeat||"",n.backgroundSize=i.size||""}}initPlugins(){this._resizePlugins=[];for(const[,e]of this.container.plugins)e.resize&&this._resizePlugins.push(e),(e.particleFillColor||e.particleStrokeColor)&&this._colorPlugins.push(e)}initUpdaters(){this._preDrawUpdaters=[],this._postDrawUpdaters=[];for(const e of this.container.particles.updaters)e.afterDraw&&this._postDrawUpdaters.push(e),(e.getColorStyles||e.getTransformValues||e.beforeDraw)&&this._preDrawUpdaters.push(e)}loadCanvas(e){this._generated&&this.element&&this.element.remove(),this._generated=e.dataset&&bw in e.dataset?e.dataset[bw]==="true":this._generated,this.element=e,this.element.ariaHidden="true",this._originalStyle=sa({},this.element.style),this.size.height=e.offsetHeight,this.size.width=e.offsetWidth,this._context=this.element.getContext("2d"),this._safeMutationObserver(i=>{this.element&&i.observe(this.element,{attributes:!0})}),this.container.retina.init(),this.initBackground()}paint(){const e=this.container.actualOptions;this.draw(i=>{e.backgroundMask.enable&&e.backgroundMask.cover?(tz(i,this.size),this._paintBase(this._coverColorStyle)):this._paintBase()})}resize(){if(!this.element)return!1;const e=this.container,i=e.retina.pixelRatio,r=e.canvas.size,n={width:this.element.offsetWidth*i,height:this.element.offsetHeight*i};if(n.height===r.height&&n.width===r.width&&n.height===this.element.height&&n.width===this.element.width)return!1;const s={...r};return this.element.width=r.width=this.element.offsetWidth*i,this.element.height=r.height=this.element.offsetHeight*i,this.container.started&&(this.resizeFactor={width:r.width/s.width,height:r.height/s.height}),!0}stop(){this._safeMutationObserver(e=>e.disconnect()),this._mutationObserver=void 0,this.draw(e=>tz(e,this.size))}async windowResize(){if(!this.element||!this.resize())return;const e=this.container,i=e.updateActualOptions();e.particles.setDensity(),this._applyResizePlugins(),i&&await e.refresh()}}function Xc(t,e,i,r,n){if(r){let s={passive:!0};bg(n)?s.capture=n:n!==void 0&&(s=n),t.addEventListener(e,i,s)}else{const s=n;t.removeEventListener(e,i,s)}}class vVe{constructor(e){this.container=e,this._doMouseTouchClick=i=>{const r=this.container,n=r.actualOptions;if(this._canPush){const s=r.interactivity.mouse,a=s.position;if(!a)return;s.clickPosition={...a},s.clickTime=new Date().getTime();const o=n.interactivity.events.onClick;Qd(o.mode,l=>this.container.handleClickMode(l))}i.type==="touchend"&&setTimeout(()=>this._mouseTouchFinish(),500)},this._handleThemeChange=i=>{const r=i,n=this.container,s=n.options,a=s.defaultThemes,o=r.matches?a.dark:a.light,l=s.themes.find(c=>c.name===o);l&&l.default.auto&&n.loadTheme(o)},this._handleVisibilityChange=()=>{const i=this.container,r=i.actualOptions;this._mouseTouchFinish(),r.pauseOnBlur&&(document&&document.hidden?(i.pageHidden=!0,i.pause()):(i.pageHidden=!1,i.getAnimationStatus()?i.play(!0):i.draw(!0)))},this._handleWindowResize=async()=>{this._resizeTimeout&&(clearTimeout(this._resizeTimeout),delete this._resizeTimeout),this._resizeTimeout=setTimeout(async()=>{const i=this.container.canvas;i&&await i.windowResize()},this.container.actualOptions.interactivity.events.resize.delay*1e3)},this._manageInteractivityListeners=(i,r)=>{const n=this._handlers,s=this.container,a=s.actualOptions,o=s.interactivity.element;if(!o)return;const l=o,c=s.canvas.element;c&&(c.style.pointerEvents=l===c?"initial":"none"),(a.interactivity.events.onHover.enable||a.interactivity.events.onClick.enable)&&(Xc(o,z9,n.mouseMove,r),Xc(o,Nke,n.touchStart,r),Xc(o,Fke,n.touchMove,r),a.interactivity.events.onClick.enable?(Xc(o,U9,n.touchEndClick,r),Xc(o,Uke,n.mouseUp,r),Xc(o,zke,n.mouseDown,r)):Xc(o,U9,n.touchEnd,r),Xc(o,i,n.mouseLeave,r),Xc(o,kke,n.touchCancel,r))},this._manageListeners=i=>{const r=this._handlers,n=this.container,s=n.actualOptions,a=s.interactivity.detectsOn,o=n.canvas.element;let l=I9;a==="window"?(n.interactivity.element=window,l=Bke):a==="parent"&&o?n.interactivity.element=o.parentElement??o.parentNode:n.interactivity.element=o,this._manageMediaMatch(i),this._manageResize(i),this._manageInteractivityListeners(l,i),document&&Xc(document,Hke,r.visibilityChange,i,!1)},this._manageMediaMatch=i=>{const r=this._handlers,n=H$("(prefers-color-scheme: dark)");if(n){if(n.addEventListener!==void 0){Xc(n,"change",r.themeChange,i);return}n.addListener!==void 0&&(i?n.addListener(r.oldThemeChange):n.removeListener(r.oldThemeChange))}},this._manageResize=i=>{const r=this._handlers,n=this.container;if(!n.actualOptions.interactivity.events.resize)return;if(typeof ResizeObserver>"u"){Xc(window,Vke,r.resize,i);return}const a=n.canvas.element;this._resizeObserver&&!i?(a&&this._resizeObserver.unobserve(a),this._resizeObserver.disconnect(),delete this._resizeObserver):!this._resizeObserver&&i&&a&&(this._resizeObserver=new ResizeObserver(async o=>{o.find(c=>c.target===a)&&await this._handleWindowResize()}),this._resizeObserver.observe(a))},this._mouseDown=()=>{const{interactivity:i}=this.container;if(!i)return;const{mouse:r}=i;r.clicking=!0,r.downPosition=r.position},this._mouseTouchClick=i=>{const r=this.container,n=r.actualOptions,{mouse:s}=r.interactivity;s.inside=!0;let a=!1;const o=s.position;if(!(!o||!n.interactivity.events.onClick.enable)){for(const[,l]of r.plugins)if(l.clickPositionValid&&(a=l.clickPositionValid(o),a))break;a||this._doMouseTouchClick(i),s.clicking=!1}},this._mouseTouchFinish=()=>{const i=this.container.interactivity;if(!i)return;const r=i.mouse;delete r.position,delete r.clickPosition,delete r.downPosition,i.status=I9,r.inside=!1,r.clicking=!1},this._mouseTouchMove=i=>{const r=this.container,n=r.actualOptions,s=r.interactivity,a=r.canvas.element;if(!s||!s.element)return;s.mouse.inside=!0;let o;if(i.type.startsWith("pointer")){this._canPush=!0;const c=i;if(s.element===window){if(a){const u=a.getBoundingClientRect();o={x:c.clientX-u.left,y:c.clientY-u.top}}}else if(n.interactivity.detectsOn==="parent"){const u=c.target,h=c.currentTarget;if(u&&h&&a){const d=u.getBoundingClientRect(),p=h.getBoundingClientRect(),g=a.getBoundingClientRect();o={x:c.offsetX+2*d.left-(p.left+g.left),y:c.offsetY+2*d.top-(p.top+g.top)}}else o={x:c.offsetX??c.clientX,y:c.offsetY??c.clientY}}else c.target===a&&(o={x:c.offsetX??c.clientX,y:c.offsetY??c.clientY})}else if(this._canPush=i.type!=="touchmove",a){const c=i,u=c.touches[c.touches.length-1],h=a.getBoundingClientRect();o={x:u.clientX-(h.left??0),y:u.clientY-(h.top??0)}}const l=r.retina.pixelRatio;o&&(o.x*=l,o.y*=l),s.mouse.position=o,s.status=z9},this._touchEnd=i=>{const r=i,n=Array.from(r.changedTouches);for(const s of n)this._touches.delete(s.identifier);this._mouseTouchFinish()},this._touchEndClick=i=>{const r=i,n=Array.from(r.changedTouches);for(const s of n)this._touches.delete(s.identifier);this._mouseTouchClick(i)},this._touchStart=i=>{const r=i,n=Array.from(r.changedTouches);for(const s of n)this._touches.set(s.identifier,performance.now());this._mouseTouchMove(i)},this._canPush=!0,this._touches=new Map,this._handlers={mouseDown:()=>this._mouseDown(),mouseLeave:()=>this._mouseTouchFinish(),mouseMove:i=>this._mouseTouchMove(i),mouseUp:i=>this._mouseTouchClick(i),touchStart:i=>this._touchStart(i),touchMove:i=>this._mouseTouchMove(i),touchEnd:i=>this._touchEnd(i),touchCancel:i=>this._touchEnd(i),touchEndClick:i=>this._touchEndClick(i),visibilityChange:()=>this._handleVisibilityChange(),themeChange:i=>this._handleThemeChange(i),oldThemeChange:i=>this._handleThemeChange(i),resize:()=>{this._handleWindowResize()}}}addListeners(){this._manageListeners(!0)}removeListeners(){this._manageListeners(!1)}}class Zd{constructor(){this.value=""}static create(e,i){const r=new Zd;return r.load(e),i!==void 0&&(mh(i)||cl(i)?r.load({value:i}):r.load(i)),r}load(e){(e==null?void 0:e.value)!==void 0&&(this.value=e.value)}}class yVe{constructor(){this.color=new Zd,this.color.value="",this.image="",this.position="",this.repeat="",this.size="",this.opacity=1}load(e){e&&(e.color!==void 0&&(this.color=Zd.create(this.color,e.color)),e.image!==void 0&&(this.image=e.image),e.position!==void 0&&(this.position=e.position),e.repeat!==void 0&&(this.repeat=e.repeat),e.size!==void 0&&(this.size=e.size),e.opacity!==void 0&&(this.opacity=e.opacity))}}class xVe{constructor(){this.color=new Zd,this.color.value="#fff",this.opacity=1}load(e){e&&(e.color!==void 0&&(this.color=Zd.create(this.color,e.color)),e.opacity!==void 0&&(this.opacity=e.opacity))}}class bVe{constructor(){this.composite="destination-out",this.cover=new xVe,this.enable=!1}load(e){if(e){if(e.composite!==void 0&&(this.composite=e.composite),e.cover!==void 0){const i=e.cover,r=mh(e.cover)?{color:e.cover}:e.cover;this.cover.load(i.color!==void 0?i:{color:r})}e.enable!==void 0&&(this.enable=e.enable)}}}class _Ve{constructor(){this.enable=!0,this.zIndex=0}load(e){e&&(e.enable!==void 0&&(this.enable=e.enable),e.zIndex!==void 0&&(this.zIndex=e.zIndex))}}class SVe{constructor(){this.enable=!1,this.mode=[]}load(e){e&&(e.enable!==void 0&&(this.enable=e.enable),e.mode!==void 0&&(this.mode=e.mode))}}class k9{constructor(){this.selectors=[],this.enable=!1,this.mode=[],this.type="circle"}get el(){return this.elementId}set el(e){this.elementId=e}get elementId(){return this.ids}set elementId(e){this.ids=e}get ids(){return Qd(this.selectors,e=>e.replace("#",""))}set ids(e){this.selectors=Qd(e,i=>`#${i}`)}load(e){if(!e)return;const i=e.ids??e.elementId??e.el;i!==void 0&&(this.ids=i),e.selectors!==void 0&&(this.selectors=e.selectors),e.enable!==void 0&&(this.enable=e.enable),e.mode!==void 0&&(this.mode=e.mode),e.type!==void 0&&(this.type=e.type)}}class wVe{constructor(){this.enable=!1,this.force=2,this.smooth=10}load(e){e&&(e.enable!==void 0&&(this.enable=e.enable),e.force!==void 0&&(this.force=e.force),e.smooth!==void 0&&(this.smooth=e.smooth))}}class MVe{constructor(){this.enable=!1,this.mode=[],this.parallax=new wVe}load(e){e&&(e.enable!==void 0&&(this.enable=e.enable),e.mode!==void 0&&(this.mode=e.mode),this.parallax.load(e.parallax))}}class EVe{constructor(){this.delay=.5,this.enable=!0}load(e){e!==void 0&&(e.delay!==void 0&&(this.delay=e.delay),e.enable!==void 0&&(this.enable=e.enable))}}class AVe{constructor(){this.onClick=new SVe,this.onDiv=new k9,this.onHover=new MVe,this.resize=new EVe}get onclick(){return this.onClick}set onclick(e){this.onClick=e}get ondiv(){return this.onDiv}set ondiv(e){this.onDiv=e}get onhover(){return this.onHover}set onhover(e){this.onHover=e}load(e){if(!e)return;this.onClick.load(e.onClick??e.onclick);const i=e.onDiv??e.ondiv;i!==void 0&&(this.onDiv=Qd(i,r=>{const n=new k9;return n.load(r),n})),this.onHover.load(e.onHover??e.onhover),bg(e.resize)?this.resize.enable=e.resize:this.resize.load(e.resize)}}class TVe{constructor(e,i){this._engine=e,this._container=i}load(e){if(!e||!this._container)return;const i=this._engine.plugins.interactors.get(this._container);if(i)for(const r of i)r.loadModeOptions&&r.loadModeOptions(this,e)}}class Q${constructor(e,i){this.detectsOn="window",this.events=new AVe,this.modes=new TVe(e,i)}get detect_on(){return this.detectsOn}set detect_on(e){this.detectsOn=e}load(e){if(!e)return;const i=e.detectsOn??e.detect_on;i!==void 0&&(this.detectsOn=i),this.events.load(e.events),this.modes.load(e.modes)}}class CVe{load(e){e&&(e.position&&(this.position={x:e.position.x??50,y:e.position.y??50,mode:e.position.mode??"percent"}),e.options&&(this.options=sa({},e.options)))}}class DVe{constructor(){this.maxWidth=1/0,this.options={},this.mode="canvas"}load(e){e&&(e.maxWidth!==void 0&&(this.maxWidth=e.maxWidth),e.mode!==void 0&&(e.mode==="screen"?this.mode="screen":this.mode="canvas"),e.options!==void 0&&(this.options=sa({},e.options)))}}class PVe{constructor(){this.auto=!1,this.mode="any",this.value=!1}load(e){e&&(e.auto!==void 0&&(this.auto=e.auto),e.mode!==void 0&&(this.mode=e.mode),e.value!==void 0&&(this.value=e.value))}}class RVe{constructor(){this.name="",this.default=new PVe}load(e){e&&(e.name!==void 0&&(this.name=e.name),this.default.load(e.default),e.options!==void 0&&(this.options=sa({},e.options)))}}class iz{constructor(){this.count=0,this.enable=!1,this.offset=0,this.speed=1,this.delay=0,this.decay=0,this.sync=!0}load(e){e&&(e.count!==void 0&&(this.count=pr(e.count)),e.enable!==void 0&&(this.enable=e.enable),e.offset!==void 0&&(this.offset=pr(e.offset)),e.speed!==void 0&&(this.speed=pr(e.speed)),e.decay!==void 0&&(this.decay=pr(e.decay)),e.delay!==void 0&&(this.delay=pr(e.delay)),e.sync!==void 0&&(this.sync=e.sync))}}class OVe{constructor(){this.h=new iz,this.s=new iz,this.l=new iz}load(e){e&&(this.h.load(e.h),this.s.load(e.s),this.l.load(e.l))}}class K1 extends Zd{constructor(){super(),this.animation=new OVe}static create(e,i){const r=new K1;return r.load(e),i!==void 0&&(mh(i)||cl(i)?r.load({value:i}):r.load(i)),r}load(e){if(super.load(e),!e)return;const i=e.animation;i!==void 0&&(i.enable!==void 0?this.animation.h.load(i):this.animation.load(e.animation))}}class LVe{constructor(){this.speed=2}load(e){e&&e.speed!==void 0&&(this.speed=e.speed)}}class IVe{constructor(){this.enable=!0,this.retries=0}load(e){e&&(e.enable!==void 0&&(this.enable=e.enable),e.retries!==void 0&&(this.retries=e.retries))}}class zVe{constructor(){this.count=0,this.enable=!1,this.speed=1,this.decay=0,this.delay=0,this.sync=!1}load(e){e&&(e.count!==void 0&&(this.count=pr(e.count)),e.enable!==void 0&&(this.enable=e.enable),e.speed!==void 0&&(this.speed=pr(e.speed)),e.decay!==void 0&&(this.decay=pr(e.decay)),e.delay!==void 0&&(this.delay=pr(e.delay)),e.sync!==void 0&&(this.sync=e.sync))}}class Z$ extends zVe{constructor(){super(),this.mode="auto",this.startValue="random"}load(e){super.load(e),e&&(e.minimumValue!==void 0&&(this.minimumValue=e.minimumValue),e.mode!==void 0&&(this.mode=e.mode),e.startValue!==void 0&&(this.startValue=e.startValue))}}class UVe{constructor(){this.enable=!1,this.minimumValue=0}load(e){e&&(e.enable!==void 0&&(this.enable=e.enable),e.minimumValue!==void 0&&(this.minimumValue=e.minimumValue))}}class QM{constructor(){this.random=new UVe,this.value=0}load(e){e&&(bg(e.random)?this.random.enable=e.random:this.random.load(e.random),e.value!==void 0&&(this.value=pr(e.value,this.random.enable?this.random.minimumValue:void 0)))}}class V9 extends QM{constructor(){super(),this.random.minimumValue=.1,this.value=1}}class K${constructor(){this.horizontal=new V9,this.vertical=new V9}load(e){e&&(this.horizontal.load(e.horizontal),this.vertical.load(e.vertical))}}class BVe{constructor(){this.absorb=new LVe,this.bounce=new K$,this.enable=!1,this.maxSpeed=50,this.mode="bounce",this.overlap=new IVe}load(e){e&&(this.absorb.load(e.absorb),this.bounce.load(e.bounce),e.enable!==void 0&&(this.enable=e.enable),e.maxSpeed!==void 0&&(this.maxSpeed=pr(e.maxSpeed)),e.mode!==void 0&&(this.mode=e.mode),this.overlap.load(e.overlap))}}class NVe{constructor(){this.offset=0,this.value=90}load(e){e&&(e.offset!==void 0&&(this.offset=pr(e.offset)),e.value!==void 0&&(this.value=pr(e.value)))}}class FVe{constructor(){this.distance=200,this.enable=!1,this.rotate={x:3e3,y:3e3}}get rotateX(){return this.rotate.x}set rotateX(e){this.rotate.x=e}get rotateY(){return this.rotate.y}set rotateY(e){this.rotate.y=e}load(e){var n,s;if(!e)return;e.distance!==void 0&&(this.distance=pr(e.distance)),e.enable!==void 0&&(this.enable=e.enable);const i=((n=e.rotate)==null?void 0:n.x)??e.rotateX;i!==void 0&&(this.rotate.x=i);const r=((s=e.rotate)==null?void 0:s.y)??e.rotateY;r!==void 0&&(this.rotate.y=r)}}class kVe{constructor(){this.x=50,this.y=50,this.mode="percent",this.radius=0}load(e){e&&(e.x!==void 0&&(this.x=e.x),e.y!==void 0&&(this.y=e.y),e.mode!==void 0&&(this.mode=e.mode),e.radius!==void 0&&(this.radius=e.radius))}}class VVe{constructor(){this.acceleration=9.81,this.enable=!1,this.inverse=!1,this.maxSpeed=50}load(e){e&&(e.acceleration!==void 0&&(this.acceleration=pr(e.acceleration)),e.enable!==void 0&&(this.enable=e.enable),e.inverse!==void 0&&(this.inverse=e.inverse),e.maxSpeed!==void 0&&(this.maxSpeed=pr(e.maxSpeed)))}}class HVe{constructor(){this.clamp=!0,this.delay=new QM,this.enable=!1,this.options={}}load(e){e&&(e.clamp!==void 0&&(this.clamp=e.clamp),this.delay.load(e.delay),e.enable!==void 0&&(this.enable=e.enable),this.generator=e.generator,e.options&&(this.options=sa(this.options,e.options)))}}class GVe{load(e){e&&(e.color!==void 0&&(this.color=Zd.create(this.color,e.color)),e.image!==void 0&&(this.image=e.image))}}class jVe{constructor(){this.enable=!1,this.length=10,this.fill=new GVe}get fillColor(){return this.fill.color}set fillColor(e){this.fill.load({color:e})}load(e){e&&(e.enable!==void 0&&(this.enable=e.enable),(e.fill!==void 0||e.fillColor!==void 0)&&this.fill.load(e.fill||{color:e.fillColor}),e.length!==void 0&&(this.length=e.length))}}class WVe{constructor(){this.default="out"}load(e){e&&(e.default!==void 0&&(this.default=e.default),this.bottom=e.bottom??e.default,this.left=e.left??e.default,this.right=e.right??e.default,this.top=e.top??e.default)}}class qVe{constructor(){this.acceleration=0,this.enable=!1}load(e){e&&(e.acceleration!==void 0&&(this.acceleration=pr(e.acceleration)),e.enable!==void 0&&(this.enable=e.enable),e.position&&(this.position=sa({},e.position)))}}class XVe{constructor(){this.angle=new NVe,this.attract=new FVe,this.center=new kVe,this.decay=0,this.distance={},this.direction="none",this.drift=0,this.enable=!1,this.gravity=new VVe,this.path=new HVe,this.outModes=new WVe,this.random=!1,this.size=!1,this.speed=2,this.spin=new qVe,this.straight=!1,this.trail=new jVe,this.vibrate=!1,this.warp=!1}get bounce(){return this.collisions}set bounce(e){this.collisions=e}get collisions(){return!1}set collisions(e){}get noise(){return this.path}set noise(e){this.path=e}get outMode(){return this.outModes.default}set outMode(e){this.outModes.default=e}get out_mode(){return this.outMode}set out_mode(e){this.outMode=e}load(e){if(!e)return;this.angle.load(au(e.angle)?{value:e.angle}:e.angle),this.attract.load(e.attract),this.center.load(e.center),e.decay!==void 0&&(this.decay=pr(e.decay)),e.direction!==void 0&&(this.direction=e.direction),e.distance!==void 0&&(this.distance=au(e.distance)?{horizontal:e.distance,vertical:e.distance}:{...e.distance}),e.drift!==void 0&&(this.drift=pr(e.drift)),e.enable!==void 0&&(this.enable=e.enable),this.gravity.load(e.gravity);const i=e.outModes??e.outMode??e.out_mode;i!==void 0&&(h1(i)?this.outModes.load(i):this.outModes.load({default:i})),this.path.load(e.path??e.noise),e.random!==void 0&&(this.random=e.random),e.size!==void 0&&(this.size=e.size),e.speed!==void 0&&(this.speed=pr(e.speed)),this.spin.load(e.spin),e.straight!==void 0&&(this.straight=e.straight),this.trail.load(e.trail),e.vibrate!==void 0&&(this.vibrate=e.vibrate),e.warp!==void 0&&(this.warp=e.warp)}}class YVe extends Z${constructor(){super(),this.destroy="none",this.speed=2}get opacity_min(){return this.minimumValue}set opacity_min(e){this.minimumValue=e}load(e){(e==null?void 0:e.opacity_min)!==void 0&&e.minimumValue===void 0&&(e.minimumValue=e.opacity_min),super.load(e),e&&e.destroy!==void 0&&(this.destroy=e.destroy)}}class QVe extends QM{constructor(){super(),this.animation=new YVe,this.random.minimumValue=.1,this.value=1}get anim(){return this.animation}set anim(e){this.animation=e}load(e){if(!e)return;super.load(e);const i=e.animation??e.anim;i!==void 0&&(this.animation.load(i),this.value=pr(this.value,this.animation.enable?this.animation.minimumValue:void 0))}}class ZVe{constructor(){this.enable=!1,this.width=1920,this.height=1080}get area(){return this.width}set area(e){this.width=e}get factor(){return this.height}set factor(e){this.height=e}get value_area(){return this.area}set value_area(e){this.area=e}load(e){if(!e)return;e.enable!==void 0&&(this.enable=e.enable);const i=e.width??e.area??e.value_area;i!==void 0&&(this.width=i);const r=e.height??e.factor;r!==void 0&&(this.height=r)}}class KVe{constructor(){this.density=new ZVe,this.limit=0,this.value=0}get max(){return this.limit}set max(e){this.limit=e}load(e){if(!e)return;this.density.load(e.density);const i=e.limit??e.max;i!==void 0&&(this.limit=i),e.value!==void 0&&(this.value=e.value)}}class JVe{constructor(){this.blur=0,this.color=new Zd,this.enable=!1,this.offset={x:0,y:0},this.color.value="#000"}load(e){e&&(e.blur!==void 0&&(this.blur=e.blur),this.color=Zd.create(this.color,e.color),e.enable!==void 0&&(this.enable=e.enable),e.offset!==void 0&&(e.offset.x!==void 0&&(this.offset.x=e.offset.x),e.offset.y!==void 0&&(this.offset.y=e.offset.y)))}}const rz="character",nz="char",sz="image",az="images",oz="polygon",lz="star";class $Ve{constructor(){this.loadShape=(e,i,r,n)=>{if(!e)return;const s=cl(e),a=s?[]:{},o=s!==cl(this.options[i]),l=s!==cl(this.options[r]);o&&(this.options[i]=a),l&&n&&(this.options[r]=a),this.options[i]=sa(this.options[i]??a,e),(!this.options[r]||n)&&(this.options[r]=sa(this.options[r]??a,e))},this.close=!0,this.fill=!0,this.options={},this.type="circle"}get character(){return this.options[rz]??this.options[nz]}set character(e){this.options[nz]=this.options[rz]=e}get custom(){return this.options}set custom(e){this.options=e}get image(){return this.options[sz]??this.options[az]}set image(e){this.options[az]=this.options[sz]=e}get images(){return this.image}set images(e){this.image=e}get polygon(){return this.options[oz]??this.options[lz]}set polygon(e){this.options[lz]=this.options[oz]=e}get stroke(){return[]}set stroke(e){}load(e){if(!e)return;const i=e.options??e.custom;if(i!==void 0)for(const r in i){const n=i[r];n&&(this.options[r]=sa(this.options[r]??{},n))}this.loadShape(e.character,rz,nz,!0),this.loadShape(e.polygon,oz,lz,!1),this.loadShape(e.image??e.images,sz,az,!0),e.close!==void 0&&(this.close=e.close),e.fill!==void 0&&(this.fill=e.fill),e.type!==void 0&&(this.type=e.type)}}class e6e extends Z${constructor(){super(),this.destroy="none",this.speed=5}get size_min(){return this.minimumValue}set size_min(e){this.minimumValue=e}load(e){(e==null?void 0:e.size_min)!==void 0&&e.minimumValue===void 0&&(e.minimumValue=e.size_min),super.load(e),e&&e.destroy!==void 0&&(this.destroy=e.destroy)}}class t6e extends QM{constructor(){super(),this.animation=new e6e,this.random.minimumValue=1,this.value=3}get anim(){return this.animation}set anim(e){this.animation=e}load(e){if(super.load(e),!e)return;const i=e.animation??e.anim;i!==void 0&&(this.animation.load(i),this.value=pr(this.value,this.animation.enable?this.animation.minimumValue:void 0))}}class H9{constructor(){this.width=0}load(e){e&&(e.color!==void 0&&(this.color=K1.create(this.color,e.color)),e.width!==void 0&&(this.width=pr(e.width)),e.opacity!==void 0&&(this.opacity=pr(e.opacity)))}}class i6e extends QM{constructor(){super(),this.opacityRate=1,this.sizeRate=1,this.velocityRate=1}load(e){super.load(e),e&&(e.opacityRate!==void 0&&(this.opacityRate=e.opacityRate),e.sizeRate!==void 0&&(this.sizeRate=e.sizeRate),e.velocityRate!==void 0&&(this.velocityRate=e.velocityRate))}}class r6e{constructor(e,i){this._engine=e,this._container=i,this.bounce=new K$,this.collisions=new BVe,this.color=new K1,this.color.value="#fff",this.groups={},this.move=new XVe,this.number=new KVe,this.opacity=new QVe,this.reduceDuplicates=!1,this.shadow=new JVe,this.shape=new $Ve,this.size=new t6e,this.stroke=new H9,this.zIndex=new i6e}load(e){var n,s,a;if(!e)return;if(this.bounce.load(e.bounce),this.color.load(K1.create(this.color,e.color)),e.groups!==void 0)for(const o in e.groups){const l=e.groups[o];l!==void 0&&(this.groups[o]=sa(this.groups[o]??{},l))}this.move.load(e.move),this.number.load(e.number),this.opacity.load(e.opacity),e.reduceDuplicates!==void 0&&(this.reduceDuplicates=e.reduceDuplicates),this.shape.load(e.shape),this.size.load(e.size),this.shadow.load(e.shadow),this.zIndex.load(e.zIndex);const i=((n=e.move)==null?void 0:n.collisions)??((s=e.move)==null?void 0:s.bounce);i!==void 0&&(this.collisions.enable=i),this.collisions.load(e.collisions),e.interactivity!==void 0&&(this.interactivity=sa({},e.interactivity));const r=e.stroke??((a=e.shape)==null?void 0:a.stroke);if(r&&(this.stroke=Qd(r,o=>{const l=new H9;return l.load(o),l})),this._container){const o=this._engine.plugins.updaters.get(this._container);if(o)for(const c of o)c.loadOptions&&c.loadOptions(this,e);const l=this._engine.plugins.interactors.get(this._container);if(l)for(const c of l)c.loadParticlesOptions&&c.loadParticlesOptions(this,e)}}}function J$(t,...e){for(const i of e)t.load(i)}function $$(t,e,...i){const r=new r6e(t,e);return J$(r,...i),r}class n6e{constructor(e,i){this._findDefaultTheme=r=>this.themes.find(n=>n.default.value&&n.default.mode===r)??this.themes.find(n=>n.default.value&&n.default.mode==="any"),this._importPreset=r=>{this.load(this._engine.plugins.getPreset(r))},this._engine=e,this._container=i,this.autoPlay=!0,this.background=new yVe,this.backgroundMask=new bVe,this.defaultThemes={},this.delay=0,this.fullScreen=new _Ve,this.detectRetina=!0,this.duration=0,this.fpsLimit=120,this.interactivity=new Q$(e,i),this.manualParticles=[],this.particles=$$(this._engine,this._container),this.pauseOnBlur=!0,this.pauseOnOutsideViewport=!0,this.responsive=[],this.smooth=!1,this.style={},this.themes=[],this.zLayers=100}get backgroundMode(){return this.fullScreen}set backgroundMode(e){this.fullScreen.load(e)}get fps_limit(){return this.fpsLimit}set fps_limit(e){this.fpsLimit=e}get retina_detect(){return this.detectRetina}set retina_detect(e){this.detectRetina=e}load(e){var a,o;if(!e)return;e.preset!==void 0&&Qd(e.preset,l=>this._importPreset(l)),e.autoPlay!==void 0&&(this.autoPlay=e.autoPlay),e.delay!==void 0&&(this.delay=pr(e.delay));const i=e.detectRetina??e.retina_detect;i!==void 0&&(this.detectRetina=i),e.duration!==void 0&&(this.duration=pr(e.duration));const r=e.fpsLimit??e.fps_limit;r!==void 0&&(this.fpsLimit=r),e.pauseOnBlur!==void 0&&(this.pauseOnBlur=e.pauseOnBlur),e.pauseOnOutsideViewport!==void 0&&(this.pauseOnOutsideViewport=e.pauseOnOutsideViewport),e.zLayers!==void 0&&(this.zLayers=e.zLayers),this.background.load(e.background);const n=e.fullScreen??e.backgroundMode;bg(n)?this.fullScreen.enable=n:this.fullScreen.load(n),this.backgroundMask.load(e.backgroundMask),this.interactivity.load(e.interactivity),e.manualParticles&&(this.manualParticles=e.manualParticles.map(l=>{const c=new CVe;return c.load(l),c})),this.particles.load(e.particles),this.style=sa(this.style,e.style),this._engine.plugins.loadOptions(this,e),e.smooth!==void 0&&(this.smooth=e.smooth);const s=this._engine.plugins.interactors.get(this._container);if(s)for(const l of s)l.loadOptions&&l.loadOptions(this,e);if(e.responsive!==void 0)for(const l of e.responsive){const c=new DVe;c.load(l),this.responsive.push(c)}if(this.responsive.sort((l,c)=>l.maxWidth-c.maxWidth),e.themes!==void 0)for(const l of e.themes){const c=this.themes.find(u=>u.name===l.name);if(c)c.load(l);else{const u=new RVe;u.load(l),this.themes.push(u)}}this.defaultThemes.dark=(a=this._findDefaultTheme("dark"))==null?void 0:a.name,this.defaultThemes.light=(o=this._findDefaultTheme("light"))==null?void 0:o.name}setResponsive(e,i,r){this.load(r);const n=this.responsive.find(s=>s.mode==="screen"&&screen?s.maxWidth>screen.availWidth:s.maxWidth*i>e);return this.load(n==null?void 0:n.options),n==null?void 0:n.maxWidth}setTheme(e){if(e){const i=this.themes.find(r=>r.name===e);i&&this.load(i.options)}else{const i=H$("(prefers-color-scheme: dark)"),r=i&&i.matches,n=this._findDefaultTheme(r?"dark":"light");n&&this.load(n.options)}}}class s6e{constructor(e,i){this.container=i,this._engine=e,this._interactors=e.plugins.getInteractors(this.container,!0),this._externalInteractors=[],this._particleInteractors=[]}async externalInteract(e){for(const i of this._externalInteractors)i.isEnabled()&&await i.interact(e)}handleClickMode(e){for(const i of this._externalInteractors)i.handleClickMode&&i.handleClickMode(e)}init(){this._externalInteractors=[],this._particleInteractors=[];for(const e of this._interactors){switch(e.type){case"external":this._externalInteractors.push(e);break;case"particles":this._particleInteractors.push(e);break}e.init()}}async particlesInteract(e,i){for(const r of this._externalInteractors)r.clear(e,i);for(const r of this._particleInteractors)r.isEnabled(e)&&await r.interact(e,i)}async reset(e){for(const i of this._externalInteractors)i.isEnabled()&&i.reset(e);for(const i of this._particleInteractors)i.isEnabled(e)&&i.reset(e)}}const G9=t=>{if(!G$(t.outMode,t.checkModes))return;const e=t.radius*2;t.coord>t.maxCoord-e?t.setCb(-t.radius):t.coord<e&&t.setCb(t.radius)};class a6e{constructor(e,i,r,n,s,a){this.container=r,this._calcPosition=(o,l,c,u=0)=>{for(const[,w]of o.plugins){const M=w.particlePosition!==void 0?w.particlePosition(l,this):void 0;if(M)return mc.create(M.x,M.y,c)}const h=o.canvas.size,d=Yke({size:h,position:l}),p=mc.create(d.x,d.y,c),g=this.getRadius(),x=this.options.move.outModes,v=w=>{G9({outMode:w,checkModes:["bounce","bounce-horizontal"],coord:p.x,maxCoord:o.canvas.size.width,setCb:M=>p.x+=M,radius:g})},b=w=>{G9({outMode:w,checkModes:["bounce","bounce-vertical"],coord:p.y,maxCoord:o.canvas.size.height,setCb:M=>p.y+=M,radius:g})};return v(x.left??x.default),v(x.right??x.default),b(x.top??x.default),b(x.bottom??x.default),this._checkOverlap(p,u)?this._calcPosition(o,void 0,c,u+1):p},this._calculateVelocity=()=>{const o=Wke(this.direction),l=o.copy(),c=this.options.move;if(c.direction==="inside"||c.direction==="outside")return l;const u=Math.PI/180*Zi(c.angle.value),h=Math.PI/180*Zi(c.angle.offset),d={left:h-u/2,right:h+u/2};return c.straight||(l.angle+=iu(pr(d.left,d.right))),c.random&&typeof c.speed=="number"&&(l.length*=Zr()),l},this._checkOverlap=(o,l=0)=>{const c=this.options.collisions,u=this.getRadius();if(!c.enable)return!1;const h=c.overlap;if(h.enable)return!1;const d=h.retries;if(d>=0&&l>d)throw new Error(`${X0} particle is overlapping and can't be placed`);return!!this.container.particles.find(p=>GP(o,p.position)<u+p.getRadius())},this._getRollColor=o=>{if(!o||!this.roll||!this.backColor&&!this.roll.alter)return o;const l=this.roll.horizontal&&this.roll.vertical?2:1,c=this.roll.horizontal?Math.PI/2:0;return Math.floor(((this.roll.angle??0)+c)/(Math.PI/l))%2?this.backColor?this.backColor:this.roll.alter?pVe(o,this.roll.alter.type,this.roll.alter.value):o:o},this._initPosition=o=>{const l=this.container,c=Zi(this.options.zIndex.value);this.position=this._calcPosition(l,o,Z1(c,0,l.zLayers)),this.initialPosition=this.position.copy();const u=l.canvas.size;switch(this.moveCenter={...X$(this.options.move.center,u),radius:this.options.move.center.radius??0,mode:this.options.move.center.mode??"percent"},this.direction=jke(this.options.move.direction,this.position,this.moveCenter),this.options.move.direction){case"inside":this.outType="inside";break;case"outside":this.outType="outside";break}this.offset=bc.origin},this._loadShapeData=(o,l)=>{const c=o.options[this.shape];if(c)return sa({close:o.close,fill:o.fill},C1(c,this.id,l))},this._engine=e,this.init(i,n,s,a)}destroy(e){if(this.unbreakable||this.destroyed)return;this.destroyed=!0,this.bubble.inRange=!1,this.slow.inRange=!1;const i=this.container,r=this.pathGenerator;for(const[,n]of i.plugins)n.particleDestroyed&&n.particleDestroyed(this,e);for(const n of i.particles.updaters)n.particleDestroyed&&n.particleDestroyed(this,e);r&&r.reset(this)}draw(e){const i=this.container;for(const[,r]of i.plugins)i.canvas.drawParticlePlugin(r,this,e);i.canvas.drawParticle(this,e)}getFillColor(){return this._getRollColor(this.bubble.color??F9(this.color))}getMass(){return this.getRadius()**2*Math.PI/2}getPosition(){return{x:this.position.x+this.offset.x,y:this.position.y+this.offset.y,z:this.position.z}}getRadius(){return this.bubble.radius??this.size.value}getStrokeColor(){return this._getRollColor(this.bubble.color??F9(this.strokeColor))}init(e,i,r,n){const s=this.container,a=this._engine;this.id=e,this.group=n,this.fill=!0,this.pathRotation=!1,this.close=!0,this.lastPathTime=0,this.destroyed=!1,this.unbreakable=!1,this.rotation=0,this.misplaced=!1,this.retina={maxDistance:{}},this.outType="normal",this.ignoresResizeRatio=!0;const o=s.retina.pixelRatio,l=s.actualOptions,c=$$(this._engine,s,l.particles),u=c.shape.type,{reduceDuplicates:h}=c;this.shape=C1(u,this.id,h);const d=c.shape;if(r&&r.shape&&r.shape.type){const M=r.shape.type,E=C1(M,this.id,h);E&&(this.shape=E,d.load(r.shape))}this.shapeData=this._loadShapeData(d,h),c.load(r);const p=this.shapeData;p&&c.load(p.particles);const g=new Q$(a,s);g.load(s.actualOptions.interactivity),g.load(c.interactivity),this.interactivity=g,this.fill=(p==null?void 0:p.fill)??c.shape.fill,this.close=(p==null?void 0:p.close)??c.shape.close,this.options=c;const x=this.options.move.path;this.pathDelay=qF(x.delay)*1e3,x.generator&&(this.pathGenerator=this._engine.plugins.getPathGenerator(x.generator),this.pathGenerator&&s.addPath(x.generator,this.pathGenerator)&&this.pathGenerator.init(s)),s.retina.initParticle(this),this.size=W$(this.options.size,o),this.bubble={inRange:!1},this.slow={inRange:!1,factor:1},this._initPosition(i),this.initialVelocity=this._calculateVelocity(),this.velocity=this.initialVelocity.copy(),this.moveDecay=1-Zi(this.options.move.decay);const v=s.particles;v.needsSort=v.needsSort||v.lastZIndex<this.position.z,v.lastZIndex=this.position.z,this.zIndexFactor=this.position.z/s.zLayers,this.sides=24;let b=s.drawers.get(this.shape);b||(b=this._engine.plugins.getShapeDrawer(this.shape),b&&s.drawers.set(this.shape,b)),b&&b.loadShape&&b.loadShape(this);const w=b==null?void 0:b.getSidesCount;w&&(this.sides=w(this)),this.spawning=!1,this.shadowColor=D1(this.options.shadow.color);for(const M of s.particles.updaters)M.init(this);for(const M of s.particles.movers)M.init&&M.init(this);b&&b.particleInit&&b.particleInit(s,this);for(const[,M]of s.plugins)M.particleCreated&&M.particleCreated(this)}isInsideCanvas(){const e=this.getRadius(),i=this.container.canvas.size,r=this.position;return r.x>=-e&&r.y>=-e&&r.y<=i.height+e&&r.x<=i.width+e}isVisible(){return!this.destroyed&&!this.spawning&&this.isInsideCanvas()}reset(){for(const e of this.container.particles.updaters)e.reset&&e.reset(this)}}class o6e{constructor(e,i){this.position=e,this.particle=i}}class eee{constructor(e,i){this.position={x:e,y:i}}}class J1 extends eee{constructor(e,i,r,n){super(e,i),this.size={height:n,width:r}}contains(e){const i=this.size.width,r=this.size.height,n=this.position;return e.x>=n.x&&e.x<=n.x+i&&e.y>=n.y&&e.y<=n.y+r}intersects(e){e instanceof YP&&e.intersects(this);const i=this.size.width,r=this.size.height,n=this.position,s=e.position,a=e instanceof J1?e.size:{width:0,height:0},o=a.width,l=a.height;return s.x<n.x+i&&s.x+o>n.x&&s.y<n.y+r&&s.y+l>n.y}}class YP extends eee{constructor(e,i,r){super(e,i),this.radius=r}contains(e){return GP(e,this.position)<=this.radius}intersects(e){const i=this.position,r=e.position,n={x:Math.abs(r.x-i.x),y:Math.abs(r.y-i.y)},s=this.radius;if(e instanceof YP){const a=s+e.radius,o=Math.sqrt(n.x**2+n.y**2);return a>o}else if(e instanceof J1){const{width:a,height:o}=e.size;return Math.pow(n.x-a,2)+Math.pow(n.y-o,2)<=s**2||n.x<=s+a&&n.y<=s+o||n.x<=a||n.y<=o}return!1}}class v3{constructor(e,i){this.rectangle=e,this.capacity=i,this._subdivide=()=>{const{x:r,y:n}=this.rectangle.position,{width:s,height:a}=this.rectangle.size,{capacity:o}=this;for(let l=0;l<4;l++)this._subs.push(new v3(new J1(r+s/2*(l%2),n+a/2*(Math.round(l/2)-l%2),s/2,a/2),o));this._divided=!0},this._points=[],this._divided=!1,this._subs=[]}insert(e){return this.rectangle.contains(e.position)?this._points.length<this.capacity?(this._points.push(e),!0):(this._divided||this._subdivide(),this._subs.some(i=>i.insert(e))):!1}query(e,i,r){const n=r||[];if(!e.intersects(this.rectangle))return[];for(const s of this._points)!e.contains(s.position)&&GP(e.position,s.position)>s.particle.getRadius()&&(!i||i(s.particle))||n.push(s.particle);if(this._divided)for(const s of this._subs)s.query(e,i,n);return n}queryCircle(e,i,r){return this.query(new YP(e.x,e.y,i),r)}queryRectangle(e,i,r){return this.query(new J1(e.x,e.y,i.width,i.height),r)}}const j9=4,W9=t=>new J1(-t.width/4,-t.height/4,t.width*3/2,t.height*3/2);let l6e=class{constructor(e,i){this._applyDensity=(n,s,a)=>{var p;if(!((p=n.number.density)!=null&&p.enable))return;const o=n.number,l=this._initDensityFactor(o.density),c=o.value,u=o.limit>0?o.limit:c,h=Math.min(c,u)*l+s,d=Math.min(this.count,this.filter(g=>g.group===a).length);this.limit=o.limit*l,d<h?this.push(Math.abs(h-d),void 0,n,a):d>h&&this.removeQuantity(d-h,a)},this._initDensityFactor=n=>{const s=this._container;if(!s.canvas.element||!n.enable)return 1;const a=s.canvas.element,o=s.retina.pixelRatio;return a.width*a.height/(n.factor*o**2*n.area)},this._pushParticle=(n,s,a,o)=>{try{let l=this.pool.pop();l?l.init(this._nextId,n,s,a):l=new a6e(this._engine,this._nextId,this._container,n,s,a);let c=!0;return o&&(c=o(l)),c?(this._array.push(l),this._zArray.push(l),this._nextId++,this._engine.dispatchEvent("particleAdded",{container:this._container,data:{particle:l}}),l):void 0}catch(l){dM().warning(`${X0} adding particle: ${l}`);return}},this._removeParticle=(n,s,a)=>{const o=this._array[n];if(!o||o.group!==s)return!1;o.destroy(a);const l=this._zArray.indexOf(o);return this._array.splice(n,1),this._zArray.splice(l,1),this.pool.push(o),this._engine.dispatchEvent("particleRemoved",{container:this._container,data:{particle:o}}),!0},this._engine=e,this._container=i,this._nextId=0,this._array=[],this._zArray=[],this.pool=[],this.limit=0,this.needsSort=!1,this.lastZIndex=0,this._interactionManager=new s6e(e,i);const r=i.canvas.size;this.quadTree=new v3(W9(r),j9),this.movers=this._engine.plugins.getMovers(i,!0),this.updaters=this._engine.plugins.getUpdaters(i,!0)}get count(){return this._array.length}addManualParticles(){const e=this._container,i=e.actualOptions;for(const r of i.manualParticles)this.addParticle(r.position?X$(r.position,e.canvas.size):void 0,r.options)}addParticle(e,i,r,n){const s=this._container,a=s.actualOptions,o=a.particles.number.limit;if(o>0){const l=this.count+1-o;l>0&&this.removeQuantity(l)}return this._pushParticle(e,i,r,n)}clear(){this._array=[],this._zArray=[]}destroy(){this._array=[],this._zArray=[],this.movers=[],this.updaters=[]}async draw(e){const i=this._container;i.canvas.clear(),await this.update(e);for(const[,r]of i.plugins)i.canvas.drawPlugin(r,e);for(const r of this._zArray)r.draw(e)}filter(e){return this._array.filter(e)}find(e){return this._array.find(e)}handleClickMode(e){this._interactionManager.handleClickMode(e)}init(){var n;const e=this._container,i=e.actualOptions;this.lastZIndex=0,this.needsSort=!1;let r=!1;this.updaters=this._engine.plugins.getUpdaters(e,!0),this._interactionManager.init();for(const[,s]of e.plugins)if(s.particlesInitialization!==void 0&&(r=s.particlesInitialization()),r)break;this._interactionManager.init();for(const[,s]of e.pathGenerators)s.init(e);if(this.addManualParticles(),!r){for(const s in i.particles.groups){const a=i.particles.groups[s];for(let o=this.count,l=0;l<((n=a.number)==null?void 0:n.value)&&o<i.particles.number.value;o++,l++)this.addParticle(void 0,a,s)}for(let s=this.count;s<i.particles.number.value;s++)this.addParticle()}}push(e,i,r,n){this.pushing=!0;for(let s=0;s<e;s++)this.addParticle(i==null?void 0:i.position,r,n);this.pushing=!1}async redraw(){this.clear(),this.init(),await this.draw({value:0,factor:0})}remove(e,i,r){this.removeAt(this._array.indexOf(e),void 0,i,r)}removeAt(e,i=1,r,n){if(e<0||e>this.count)return;let s=0;for(let a=e;s<i&&a<this.count;a++)this._removeParticle(a--,r,n)&&s++}removeQuantity(e,i){this.removeAt(0,e,i)}setDensity(){const e=this._container.actualOptions,i=e.particles.groups;for(const r in i)this._applyDensity(i[r],0,r);this._applyDensity(e.particles,e.manualParticles.length)}async update(e){const i=this._container,r=new Set;this.quadTree=new v3(W9(i.canvas.size),j9);for(const[,n]of i.pathGenerators)n.update();for(const[,n]of i.plugins)n.update&&n.update(e);for(const n of this._array){const s=i.canvas.resizeFactor;s&&!n.ignoresResizeRatio&&(n.position.x*=s.width,n.position.y*=s.height,n.initialPosition.x*=s.width,n.initialPosition.y*=s.height),n.ignoresResizeRatio=!1,await this._interactionManager.reset(n);for(const[,a]of this._container.plugins){if(n.destroyed)break;a.particleUpdate&&a.particleUpdate(n,e)}for(const a of this.movers)a.isEnabled(n)&&a.move(n,e);if(n.destroyed){r.add(n);continue}this.quadTree.insert(new o6e(n.getPosition(),n))}if(r.size){const n=s=>!r.has(s);this._array=this.filter(n),this._zArray=this._zArray.filter(n),this.pool.push(...r)}await this._interactionManager.externalInteract(e);for(const n of this._array){for(const s of this.updaters)s.update(n,e);!n.destroyed&&!n.spawning&&await this._interactionManager.particlesInteract(n,e)}if(delete i.canvas.resizeFactor,this.needsSort){const n=this._zArray;n.sort((s,a)=>a.position.z-s.position.z||s.id-a.id),this.lastZIndex=n[n.length-1].position.z,this.needsSort=!1}}};class c6e{constructor(e){this.container=e,this.pixelRatio=1,this.reduceFactor=1}init(){const e=this.container,i=e.actualOptions;this.pixelRatio=!i.detectRetina||jP()?1:window.devicePixelRatio,this.reduceFactor=1;const r=this.pixelRatio;if(e.canvas.element){const a=e.canvas.element;e.canvas.size.width=a.offsetWidth*r,e.canvas.size.height=a.offsetHeight*r}const n=i.particles,s=n.move;this.attractDistance=Zi(s.attract.distance)*r,this.maxSpeed=Zi(s.gravity.maxSpeed)*r,this.sizeAnimationSpeed=Zi(n.size.animation.speed)*r}initParticle(e){const i=e.options,r=this.pixelRatio,n=i.move,s=n.distance,a=e.retina;a.attractDistance=Zi(n.attract.distance)*r,a.moveDrift=Zi(n.drift)*r,a.moveSpeed=Zi(n.speed)*r,a.sizeAnimationSpeed=Zi(i.size.animation.speed)*r;const o=a.maxDistance;o.horizontal=s.horizontal!==void 0?s.horizontal*r:void 0,o.vertical=s.vertical!==void 0?s.vertical*r:void 0,a.maxSpeed=Zi(n.gravity.maxSpeed)*r}}function Jn(t){return t&&!t.destroyed}function u6e(t,e=60,i=!1){return{value:t,factor:i?60/e:60*t/1e3}}function Wx(t,e,...i){const r=new n6e(t,e);return J$(r,...i),r}const h6e="default",q9={generate:t=>t.velocity,init:()=>{},update:()=>{},reset:()=>{}};class d6e{constructor(e,i,r){this.id=i,this._intersectionManager=n=>{if(!(!Jn(this)||!this.actualOptions.pauseOnOutsideViewport))for(const s of n)s.target===this.interactivity.element&&(s.isIntersecting?this.play:this.pause)()},this._nextFrame=async n=>{try{if(!this.smooth&&this.lastFrameTime!==void 0&&n<this.lastFrameTime+1e3/this.fpsLimit){this.draw(!1);return}this.lastFrameTime??(this.lastFrameTime=n);const s=u6e(n-this.lastFrameTime,this.fpsLimit,this.smooth);if(this.addLifeTime(s.value),this.lastFrameTime=n,s.value>1e3){this.draw(!1);return}if(await this.particles.draw(s),!this.alive()){this.destroy();return}this.getAnimationStatus()&&this.draw(!1)}catch(s){dM().error(`${X0} in animation loop`,s)}},this._engine=e,this.fpsLimit=120,this.smooth=!1,this._delay=0,this._duration=0,this._lifeTime=0,this._firstStart=!0,this.started=!1,this.destroyed=!1,this._paused=!0,this.lastFrameTime=0,this.zLayers=100,this.pageHidden=!1,this._sourceOptions=r,this._initialSourceOptions=r,this.retina=new c6e(this),this.canvas=new gVe(this),this.particles=new l6e(this._engine,this),this.pathGenerators=new Map,this.interactivity={mouse:{clicking:!1,inside:!1}},this.plugins=new Map,this.drawers=new Map,this._options=Wx(this._engine,this),this.actualOptions=Wx(this._engine,this),this._eventListeners=new vVe(this),typeof IntersectionObserver<"u"&&IntersectionObserver&&(this._intersectionObserver=new IntersectionObserver(n=>this._intersectionManager(n))),this._engine.dispatchEvent("containerBuilt",{container:this})}get options(){return this._options}get sourceOptions(){return this._sourceOptions}addClickHandler(e){if(!Jn(this))return;const i=this.interactivity.element;if(!i)return;const r=(h,d,p)=>{if(!Jn(this))return;const g=this.retina.pixelRatio,x={x:d.x*g,y:d.y*g},v=this.particles.quadTree.queryCircle(x,p*g);e(h,v)},n=h=>{if(!Jn(this))return;const d=h,p={x:d.offsetX||d.clientX,y:d.offsetY||d.clientY};r(h,p,1)},s=()=>{Jn(this)&&(c=!0,u=!1)},a=()=>{Jn(this)&&(u=!0)},o=h=>{if(Jn(this)){if(c&&!u){const d=h;let p=d.touches[d.touches.length-1];if(!p&&(p=d.changedTouches[d.changedTouches.length-1],!p))return;const g=this.canvas.element,x=g?g.getBoundingClientRect():void 0,v={x:p.clientX-(x?x.left:0),y:p.clientY-(x?x.top:0)};r(h,v,Math.max(p.radiusX,p.radiusY))}c=!1,u=!1}},l=()=>{Jn(this)&&(c=!1,u=!1)};let c=!1,u=!1;i.addEventListener("click",n),i.addEventListener("touchstart",s),i.addEventListener("touchmove",a),i.addEventListener("touchend",o),i.addEventListener("touchcancel",l)}addLifeTime(e){this._lifeTime+=e}addPath(e,i,r=!1){return!Jn(this)||!r&&this.pathGenerators.has(e)?!1:(this.pathGenerators.set(e,i??q9),!0)}alive(){return!this._duration||this._lifeTime<=this._duration}destroy(){if(!Jn(this))return;this.stop(),this.particles.destroy(),this.canvas.destroy();for(const[,r]of this.drawers)r.destroy&&r.destroy(this);for(const r of this.drawers.keys())this.drawers.delete(r);this._engine.plugins.destroy(this),this.destroyed=!0;const e=this._engine.dom(),i=e.findIndex(r=>r===this);i>=0&&e.splice(i,1),this._engine.dispatchEvent("containerDestroyed",{container:this})}draw(e){if(!Jn(this))return;let i=e;this._drawAnimationFrame=requestAnimationFrame(async r=>{i&&(this.lastFrameTime=void 0,i=!1),await this._nextFrame(r)})}async export(e,i={}){for(const[,r]of this.plugins){if(!r.export)continue;const n=await r.export(e,i);if(n.supported)return n.blob}dM().error(`${X0} - Export plugin with type ${e} not found`)}getAnimationStatus(){return!this._paused&&!this.pageHidden&&Jn(this)}handleClickMode(e){if(Jn(this)){this.particles.handleClickMode(e);for(const[,i]of this.plugins)i.handleClickMode&&i.handleClickMode(e)}}async init(){if(!Jn(this))return;const e=this._engine.plugins.getSupportedShapes();for(const r of e){const n=this._engine.plugins.getShapeDrawer(r);n&&this.drawers.set(r,n)}this._options=Wx(this._engine,this,this._initialSourceOptions,this.sourceOptions),this.actualOptions=Wx(this._engine,this,this._options);const i=this._engine.plugins.getAvailablePlugins(this);for(const[r,n]of i)this.plugins.set(r,n);this.retina.init(),await this.canvas.init(),this.updateActualOptions(),this.canvas.initBackground(),this.canvas.resize(),this.zLayers=this.actualOptions.zLayers,this._duration=Zi(this.actualOptions.duration)*1e3,this._delay=Zi(this.actualOptions.delay)*1e3,this._lifeTime=0,this.fpsLimit=this.actualOptions.fpsLimit>0?this.actualOptions.fpsLimit:120,this.smooth=this.actualOptions.smooth;for(const[,r]of this.drawers)r.init&&await r.init(this);for(const[,r]of this.plugins)r.init&&await r.init();this._engine.dispatchEvent("containerInit",{container:this}),this.particles.init(),this.particles.setDensity();for(const[,r]of this.plugins)r.particlesSetup&&r.particlesSetup();this._engine.dispatchEvent("particlesSetup",{container:this})}async loadTheme(e){Jn(this)&&(this._currentTheme=e,await this.refresh())}pause(){if(Jn(this)&&(this._drawAnimationFrame!==void 0&&(cancelAnimationFrame(this._drawAnimationFrame),delete this._drawAnimationFrame),!this._paused)){for(const[,e]of this.plugins)e.pause&&e.pause();this.pageHidden||(this._paused=!0),this._engine.dispatchEvent("containerPaused",{container:this})}}play(e){if(!Jn(this))return;const i=this._paused||e;if(this._firstStart&&!this.actualOptions.autoPlay){this._firstStart=!1;return}if(this._paused&&(this._paused=!1),i)for(const[,r]of this.plugins)r.play&&r.play();this._engine.dispatchEvent("containerPlay",{container:this}),this.draw(i||!1)}async refresh(){if(Jn(this))return this.stop(),this.start()}async reset(){if(Jn(this))return this._initialSourceOptions=void 0,this._options=Wx(this._engine,this),this.actualOptions=Wx(this._engine,this,this._options),this.refresh()}setNoise(e,i,r){Jn(this)&&this.setPath(e,i,r)}setPath(e,i,r){if(!e||!Jn(this))return;const n={...q9};if(YF(e))n.generate=e,i&&(n.init=i),r&&(n.update=r);else{const s=n;n.generate=e.generate||s.generate,n.init=e.init||s.init,n.update=e.update||s.update}this.addPath(h6e,n,!0)}async start(){!Jn(this)||this.started||(await this.init(),this.started=!0,await new Promise(e=>{this._delayTimeout=setTimeout(async()=>{this._eventListeners.addListeners(),this.interactivity.element instanceof HTMLElement&&this._intersectionObserver&&this._intersectionObserver.observe(this.interactivity.element);for(const[,i]of this.plugins)i.start&&await i.start();this._engine.dispatchEvent("containerStarted",{container:this}),this.play(),e()},this._delay)}))}stop(){if(!(!Jn(this)||!this.started)){this._delayTimeout&&(clearTimeout(this._delayTimeout),delete this._delayTimeout),this._firstStart=!0,this.started=!1,this._eventListeners.removeListeners(),this.pause(),this.particles.clear(),this.canvas.stop(),this.interactivity.element instanceof HTMLElement&&this._intersectionObserver&&this._intersectionObserver.unobserve(this.interactivity.element);for(const[,e]of this.plugins)e.stop&&e.stop();for(const e of this.plugins.keys())this.plugins.delete(e);this._sourceOptions=this._options,this._engine.dispatchEvent("containerStopped",{container:this})}}updateActualOptions(){this.actualOptions.responsive=[];const e=this.actualOptions.setResponsive(this.canvas.size.width,this.retina.pixelRatio,this._options);return this.actualOptions.setTheme(this._currentTheme),this.responsiveMaxWidth===e?!1:(this.responsiveMaxWidth=e,!0)}}class f6e{constructor(){this._listeners=new Map}addEventListener(e,i){this.removeEventListener(e,i);let r=this._listeners.get(e);r||(r=[],this._listeners.set(e,r)),r.push(i)}dispatchEvent(e,i){const r=this._listeners.get(e);r&&r.forEach(n=>n(i))}hasEventListener(e){return!!this._listeners.get(e)}removeAllEventListeners(e){e?this._listeners.delete(e):this._listeners=new Map}removeEventListener(e,i){const r=this._listeners.get(e);if(!r)return;const n=r.length,s=r.indexOf(i);s<0||(n===1?this._listeners.delete(e):r.splice(s,1))}}function cz(t,e,i,r=!1){let n=e.get(t);return(!n||r)&&(n=[...i.values()].map(s=>s(t)),e.set(t,n)),n}class p6e{constructor(e){this._engine=e,this.plugins=[],this._initializers={interactors:new Map,movers:new Map,updaters:new Map},this.interactors=new Map,this.movers=new Map,this.updaters=new Map,this.presets=new Map,this.drawers=new Map,this.pathGenerators=new Map}addInteractor(e,i){this._initializers.interactors.set(e,i)}addParticleMover(e,i){this._initializers.movers.set(e,i)}addParticleUpdater(e,i){this._initializers.updaters.set(e,i)}addPathGenerator(e,i){!this.getPathGenerator(e)&&this.pathGenerators.set(e,i)}addPlugin(e){!this.getPlugin(e.id)&&this.plugins.push(e)}addPreset(e,i,r=!1){(r||!this.getPreset(e))&&this.presets.set(e,i)}addShapeDrawer(e,i){Qd(e,r=>{!this.getShapeDrawer(r)&&this.drawers.set(r,i)})}destroy(e){this.updaters.delete(e),this.movers.delete(e),this.interactors.delete(e)}getAvailablePlugins(e){const i=new Map;for(const r of this.plugins)r.needsPlugin(e.actualOptions)&&i.set(r.id,r.getPlugin(e));return i}getInteractors(e,i=!1){return cz(e,this.interactors,this._initializers.interactors,i)}getMovers(e,i=!1){return cz(e,this.movers,this._initializers.movers,i)}getPathGenerator(e){return this.pathGenerators.get(e)}getPlugin(e){return this.plugins.find(i=>i.id===e)}getPreset(e){return this.presets.get(e)}getShapeDrawer(e){return this.drawers.get(e)}getSupportedShapes(){return this.drawers.keys()}getUpdaters(e,i=!1){return cz(e,this.updaters,this._initializers.updaters,i)}loadOptions(e,i){for(const r of this.plugins)r.loadOptions(e,i)}loadParticlesOptions(e,i,...r){const n=this.updaters.get(e);if(n)for(const s of n)s.loadOptions&&s.loadOptions(i,...r)}}async function m6e(t){const e=C1(t.url,t.index);if(!e)return t.fallback;const i=await fetch(e);return i.ok?i.json():(dM().error(`${X0} ${i.status} while retrieving config file`),t.fallback)}function g6e(t){return!t.id&&!t.element&&!t.url&&!t.options}function v6e(t){return!g6e(t)}class y6e{constructor(){this._configs=new Map,this._domArray=[],this._eventDispatcher=new f6e,this._initialized=!1,this.plugins=new p6e(this)}get configs(){const e={};for(const[i,r]of this._configs)e[i]=r;return e}get version(){return"2.12.0"}addConfig(e,i){mh(e)?i&&(i.name=e,this._configs.set(e,i)):this._configs.set(e.name??"default",e)}addEventListener(e,i){this._eventDispatcher.addEventListener(e,i)}async addInteractor(e,i,r=!0){this.plugins.addInteractor(e,i),await this.refresh(r)}async addMover(e,i,r=!0){this.plugins.addParticleMover(e,i),await this.refresh(r)}async addParticleUpdater(e,i,r=!0){this.plugins.addParticleUpdater(e,i),await this.refresh(r)}async addPathGenerator(e,i,r=!0){this.plugins.addPathGenerator(e,i),await this.refresh(r)}async addPlugin(e,i=!0){this.plugins.addPlugin(e),await this.refresh(i)}async addPreset(e,i,r=!1,n=!0){this.plugins.addPreset(e,i,r),await this.refresh(n)}async addShape(e,i,r,n,s,a=!0){let o,l=a,c,u,h;bg(r)?(l=r,c=void 0):c=r,bg(n)?(l=n,u=void 0):u=n,bg(s)?(l=s,h=void 0):h=s,YF(i)?o={afterEffect:u,destroy:h,draw:i,init:c}:o=i,this.plugins.addShapeDrawer(e,o),await this.refresh(l)}dispatchEvent(e,i){this._eventDispatcher.dispatchEvent(e,i)}dom(){return this._domArray}domItem(e){const i=this.dom(),r=i[e];if(!r||r.destroyed){i.splice(e,1);return}return r}init(){this._initialized||(this._initialized=!0)}async load(e,i){return this.loadFromArray(e,i)}async loadFromArray(e,i,r){let n;return v6e(e)?n=e:(n={},mh(e)?n.id=e:n.options=e,au(i)?n.index=i:n.options=i??n.options,n.index=r??n.index),this._loadParams(n)}async loadJSON(e,i,r){let n,s;return au(i)||i===void 0?n=e:(s=e,n=i),this._loadParams({id:s,url:n,index:r})}async refresh(e=!0){e&&this.dom().forEach(i=>i.refresh())}removeEventListener(e,i){this._eventDispatcher.removeEventListener(e,i)}async set(e,i,r,n){const s={index:n};return mh(e)?s.id=e:s.element=e,i instanceof HTMLElement?s.element=i:s.options=i,au(r)?s.index=r:s.options=r??s.options,this._loadParams(s)}async setJSON(e,i,r,n){const s={};return e instanceof HTMLElement?(s.element=e,s.url=i,s.index=r):(s.id=e,s.element=i,s.url=r,s.index=n),this._loadParams(s)}setOnClickHandler(e){const i=this.dom();if(!i.length)throw new Error(`${X0} can only set click handlers after calling tsParticles.load()`);for(const r of i)r.addClickHandler(e)}async _loadParams(e){const i=e.id??`tsparticles${Math.floor(Zr()*1e4)}`,{index:r,url:n}=e,s=n?await m6e({fallback:e.options,url:n,index:r}):e.options;let a=e.element??document.getElementById(i);a||(a=document.createElement("div"),a.id=i,document.body.append(a));const o=C1(s,r),l=this.dom(),c=l.findIndex(d=>d.id===i);if(c>=0){const d=this.domItem(c);d&&!d.destroyed&&(d.destroy(),l.splice(c,1))}let u;if(a.tagName.toLowerCase()==="canvas")u=a,u.dataset[bw]="false";else{const d=a.getElementsByTagName("canvas");d.length?(u=d[0],u.dataset[bw]="false"):(u=document.createElement("canvas"),u.dataset[bw]="true",a.appendChild(u))}u.style.width||(u.style.width="100%"),u.style.height||(u.style.height="100%");const h=new d6e(this,i,o);return c>=0?l.splice(c,0,h):l.push(h),h.canvas.loadCanvas(u),await h.start(),h}}class x6e{constructor(){this.key="hsl",this.stringPrefix="hsl"}handleColor(e){const i=e.value,r=i.hsl??e.value;if(r.h!==void 0&&r.s!==void 0&&r.l!==void 0)return JB(r)}handleRangeColor(e){const i=e.value,r=i.hsl??e.value;if(r.h!==void 0&&r.l!==void 0)return JB({h:Zi(r.h),l:Zi(r.l),s:Zi(r.s)})}parseString(e){if(!e.startsWith("hsl"))return;const i=/hsla?\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([\d.%]+)\s*)?\)/i,r=i.exec(e);return r?nVe({a:r.length>4?V$(r[5]):1,h:parseInt(r[1],10),l:parseInt(r[3],10),s:parseInt(r[2],10)}):void 0}}class b6e{constructor(){this.key="rgb",this.stringPrefix="rgb"}handleColor(e){const i=e.value,r=i.rgb??e.value;if(r.r!==void 0)return r}handleRangeColor(e){const i=e.value,r=i.rgb??e.value;if(r.r!==void 0)return{r:Zi(r.r),g:Zi(r.g),b:Zi(r.b)}}parseString(e){if(!e.startsWith(this.stringPrefix))return;const i=/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([\d.%]+)\s*)?\)/i,r=i.exec(e);return r?{a:r.length>4?V$(r[5]):1,b:parseInt(r[3],10),g:parseInt(r[2],10),r:parseInt(r[1],10)}:void 0}}function _6e(){const t=new b6e,e=new x6e;B9(t),B9(e);const i=new y6e;return i.init(),i}const $B=_6e();jP()||(window.tsParticles=$B);const d1=t=>typeof t=="object"&&t!==null;function y3(t,e,i=()=>!1){if(!d1(t)||!d1(e))return t===e;const r=Object.keys(t).filter(s=>!i(s)),n=Object.keys(e).filter(s=>!i(s));if(r.length!==n.length)return!1;for(const s of r){const a=t[s],o=e[s];if(d1(a)&&d1(o)){if(a===e&&o===t)continue;if(!y3(a,o,i))return!1}else if(Array.isArray(a)&&Array.isArray(o)){if(!tee(a,o,i))return!1}else if(a!==o)return!1}return!0}function tee(t,e,i){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++){const n=t[r],s=e[r];if(Array.isArray(n)&&Array.isArray(s)){if(!tee(n,s,i))return!1}else if(d1(n)&&d1(s)){if(!y3(n,s,i))return!1}else if(n!==s)return!1}return!0}const iee="tsparticles";class QP extends Me.Component{constructor(e){super(e),this.state={init:!1,library:void 0}}destroy(){this.state.library&&(this.state.library.destroy(),this.setState({library:void 0}))}shouldComponentUpdate(e){const i=e.options??e.params,r=this.props.options??this.props.params;return e.url!==this.props.url||e.id!==this.props.id||e.canvasClassName!==this.props.canvasClassName||e.className!==this.props.className||e.height!==this.props.height||e.width!==this.props.width||!y3(e.style,this.props.style)||e.init!==this.props.init||e.loaded!==this.props.loaded||!y3(i,r,n=>n.startsWith("_"))}componentDidUpdate(){this.refresh()}forceUpdate(){this.refresh().then(()=>{super.forceUpdate()})}componentDidMount(){(async()=>(this.props.init&&await this.props.init($B),this.setState({init:!0},async()=>{await this.loadParticles()})))()}componentWillUnmount(){this.destroy()}render(){const{width:e,height:i,className:r,canvasClassName:n,id:s}=this.props;return yC.createElement("div",{className:r,id:s},yC.createElement("canvas",{className:n,style:{...this.props.style,width:e,height:i}}))}async refresh(){this.destroy(),await this.loadParticles()}async loadParticles(){if(!this.state.init)return;const e=this.props.id??QP.defaultProps.id??iee,i=await $B.load({url:this.props.url,id:e,options:this.props.options??this.props.params});this.props.container&&(this.props.container.current=i),this.setState({library:i}),this.props.loaded&&await this.props.loaded(i)}}QP.defaultProps={width:"100%",height:"100%",options:{},style:{},url:void 0,id:iee};function S6e(t,e,i,r,n=0,s=1){const a=[],o=[],l=[],c=[],u=[],h=t??Zr;let d=0;i<1&&(i=1);for(let p=1;p<=i;++p)a[p]=h(),o[p]=h(),l[p]=p===1?1:l[p-1]*r,d+=l[p],c[p]=p/e,u[p]=h();return l.forEach((p,g)=>l[g]=p/d*(s-n)),()=>{let p,g,x=0;for(let v=i;v>=1;--v)p=u[v]+=c[v],u[v]>=1&&(p=u[v]-=1,a[v]=o[v],o[v]=h()),g=p**2*(3-2*p),x+=(a[v]*(1-g)+o[v]*g)*l[v];return x+n}}class w6e{constructor(){this.options={rndFunc:null,period:100,nbHarmonics:2,attenHarmonics:.8,lowValue:-.03,highValue:.03}}generate(e){if(!e.pathGen){const i=this.options;e.pathGen=S6e(i.rndFunc,i.period,i.nbHarmonics,i.attenHarmonics,i.lowValue,i.highValue)}return e.curveVelocity?(e.curveVelocity.length+=.01,e.curveVelocity.angle=(e.curveVelocity.angle+e.pathGen())%(Math.PI*2)):(e.curveVelocity=bc.origin,e.curveVelocity.length=Zr()*.6+.8,e.curveVelocity.angle=Zr()*Math.PI*2),e.velocity.x=0,e.velocity.y=0,e.curveVelocity}init(e){const i=e.actualOptions.particles.move.path.options,{options:r}=this;YF(i.rndFunc)?r.rndFunc=i.rndFunc:mh(i.rndFunc)&&(r.rndFunc=window[i.rndFunc]||this.options.rndFunc),r.period=i.period??r.period,r.nbHarmonics=i.nbHarmonics??r.nbHarmonics,r.attenHarmonics=i.attenHarmonics??r.attenHarmonics,r.lowValue=i.lowValue??r.lowValue,r.highValue=i.highValue??r.highValue}reset(e){delete e.pathGen,delete e.curveVelocity}update(){}}const ree="curvesPathGenerator";async function M6e(t,e=!0){await t.addPathGenerator(ree,new w6e,e)}const E6e="seaAnemone",A6e={fpsLimit:120,particles:{color:{value:"#FF0000"},move:{direction:"none",enable:!0,outModes:{default:"destroy"},path:{clamp:!1,enable:!0,delay:{value:0},generator:ree},random:!1,speed:2,straight:!1,trail:{fillColor:"#000",length:30,enable:!0}},number:{value:0,limit:300},opacity:{value:1},shape:{type:"circle"},size:{value:{min:1,max:10},animation:{count:1,startValue:"min",enable:!0,speed:10,sync:!0}}},background:{color:"#000"},detectRetina:!0,emitters:{direction:"none",rate:{quantity:10,delay:.3},size:{width:0,height:0,mode:"precise"},spawnColor:{value:"#ff0000",animation:{h:{enable:!0,offset:{min:-1.4,max:1.4},speed:5,sync:!1},l:{enable:!0,offset:{min:20,max:80},speed:0,sync:!1}}},position:{x:50,y:50}}};function T6e(t){const e=t.initialPosition,{dx:i,dy:r}=T1(e,t.position),n=Math.abs(i),s=Math.abs(r),{maxDistance:a}=t.retina,o=a.horizontal,l=a.vertical;if(!(!o&&!l)){if((o&&n>=o||l&&s>=l)&&!t.misplaced)t.misplaced=!!o&&n>o||!!l&&s>l,o&&(t.velocity.x=t.velocity.y/2-t.velocity.x),l&&(t.velocity.y=t.velocity.x/2-t.velocity.y);else if((!o||n<o)&&(!l||s<l)&&t.misplaced)t.misplaced=!1;else if(t.misplaced){const c=t.position,u=t.velocity;o&&(c.x<e.x&&u.x<0||c.x>e.x&&u.x>0)&&(u.x*=-Zr()),l&&(c.y<e.y&&u.y<0||c.y>e.y&&u.y>0)&&(u.y*=-Zr())}}}function C6e(t,e,i,r,n,s){P6e(t,s);const a=t.gravity,o=a!=null&&a.enable&&a.inverse?-1:1;n&&i&&(t.velocity.x+=n*s.factor/(60*i)),a!=null&&a.enable&&i&&(t.velocity.y+=o*(a.acceleration*s.factor)/(60*i));const l=t.moveDecay;t.velocity.multTo(l);const c=t.velocity.mult(i);a!=null&&a.enable&&r>0&&(!a.inverse&&c.y>=0&&c.y>=r||a.inverse&&c.y<=0&&c.y<=-r)&&(c.y=o*r,i&&(t.velocity.y=c.y/i));const u=t.options.zIndex,h=(1-t.zIndexFactor)**u.velocityRate;c.multTo(h);const{position:d}=t;d.addTo(c),e.vibrate&&(d.x+=Math.sin(d.x*Math.cos(d.y)),d.y+=Math.cos(d.y*Math.sin(d.x)))}function D6e(t,e){const i=t.container;if(!t.spin)return;const r={x:t.spin.direction==="clockwise"?Math.cos:Math.sin,y:t.spin.direction==="clockwise"?Math.sin:Math.cos};t.position.x=t.spin.center.x+t.spin.radius*r.x(t.spin.angle),t.position.y=t.spin.center.y+t.spin.radius*r.y(t.spin.angle),t.spin.radius+=t.spin.acceleration;const n=Math.max(i.canvas.size.width,i.canvas.size.height);t.spin.radius>n/2?(t.spin.radius=n/2,t.spin.acceleration*=-1):t.spin.radius<0&&(t.spin.radius=0,t.spin.acceleration*=-1),t.spin.angle+=e/100*(1-t.spin.radius/n)}function P6e(t,e){var a;const i=t.options,r=i.move.path;if(!r.enable)return;if(t.lastPathTime<=t.pathDelay){t.lastPathTime+=e.value;return}const s=(a=t.pathGenerator)==null?void 0:a.generate(t,e);s&&t.velocity.addTo(s),r.clamp&&(t.velocity.x=Z1(t.velocity.x,-1,1),t.velocity.y=Z1(t.velocity.y,-1,1)),t.lastPathTime-=t.pathDelay}function R6e(t){return t.slow.inRange?t.slow.factor:1}const O6e=2;class L6e{constructor(){this._initSpin=e=>{const i=e.container,r=e.options,n=r.move.spin;if(!n.enable)return;const s=n.position??{x:50,y:50},a={x:s.x/100*i.canvas.size.width,y:s.y/100*i.canvas.size.height},o=e.getPosition(),l=GP(o,a),c=Zi(n.acceleration);e.retina.spinAcceleration=c*i.retina.pixelRatio,e.spin={center:a,direction:e.velocity.x>=0?"clockwise":"counter-clockwise",angle:e.velocity.angle,radius:l,acceleration:e.retina.spinAcceleration}}}init(e){const i=e.options,r=i.move.gravity;e.gravity={enable:r.enable,acceleration:Zi(r.acceleration),inverse:r.inverse},this._initSpin(e)}isEnabled(e){return!e.destroyed&&e.options.move.enable}move(e,i){var g,x;const r=e.options,n=r.move;if(!n.enable)return;const s=e.container,a=s.retina.pixelRatio,o=R6e(e),l=((g=e.retina).moveSpeed??(g.moveSpeed=Zi(n.speed)*a))*s.retina.reduceFactor,c=(x=e.retina).moveDrift??(x.moveDrift=Zi(e.options.move.drift)*a),u=HP(r.size.value)*a,h=n.size?e.getRadius()/u:1,d=l*h*o*(i.factor||1)/O6e,p=e.retina.maxSpeed??s.retina.maxSpeed;n.spin.enable?D6e(e,d):C6e(e,n,d,p,c,i),T6e(e)}}async function I6e(t,e=!0){await t.addMover("base",()=>new L6e,e)}class z6e{draw(e,i,r){i.circleRange||(i.circleRange={min:0,max:Math.PI*2});const n=i.circleRange;e.arc(0,0,r,n.min,n.max,!1)}getSidesCount(){return 12}particleInit(e,i){const r=i.shapeData,n=(r==null?void 0:r.angle)??{max:360,min:0};i.circleRange=h1(n)?{min:n.min*Math.PI/180,max:n.max*Math.PI/180}:{min:0,max:n*Math.PI/180}}}async function U6e(t,e=!0){await t.addShape("circle",new z6e,e)}function uz(t,e,i,r,n){if(!e||!i.enable||(e.maxLoops??0)>0&&(e.loops??0)>(e.maxLoops??0)||(e.time||(e.time=0),(e.delayTime??0)>0&&e.time<(e.delayTime??0)&&(e.time+=t.value),(e.delayTime??0)>0&&e.time<(e.delayTime??0)))return;const s=iu(i.offset),a=(e.velocity??0)*t.factor+s*3.6,o=e.decay??1;!n||e.status==="increasing"?(e.value+=a,e.value>r&&(e.loops||(e.loops=0),e.loops++,n&&(e.status="decreasing",e.value-=e.value%r))):(e.value-=a,e.value<0&&(e.loops||(e.loops=0),e.loops++,e.status="increasing",e.value+=e.value)),e.velocity&&o!==1&&(e.velocity*=o),e.value>r&&(e.value%=r)}function B6e(t,e){const{h:i,s:r,l:n}=t.options.color.animation,{color:s}=t;if(!s)return;const{h:a,s:o,l}=s;a&&uz(e,a,i,360,!1),o&&uz(e,o,r,100,!0),l&&uz(e,l,n,100,!0)}class N6e{constructor(e){this.container=e}init(e){const i=g3(e.options.color,e.id,e.options.reduceDuplicates);i&&(e.color=aVe(i,e.options.color.animation,this.container.retina.reduceFactor))}isEnabled(e){const{h:i,s:r,l:n}=e.options.color.animation,{color:s}=e;return!e.destroyed&&!e.spawning&&((s==null?void 0:s.h.value)!==void 0&&i.enable||(s==null?void 0:s.s.value)!==void 0&&r.enable||(s==null?void 0:s.l.value)!==void 0&&n.enable)}update(e,i){B6e(e,i)}}async function F6e(t,e=!0){await t.addParticleUpdater("color",i=>new N6e(i),e)}function k6e(t,e,i,r){switch(t.options.opacity.animation.destroy){case"max":e>=r&&t.destroy();break;case"min":e<=i&&t.destroy();break}}function V6e(t,e){const i=t.opacity;if(t.destroyed||!(i!=null&&i.enable)||(i.maxLoops??0)>0&&(i.loops??0)>(i.maxLoops??0))return;const r=i.min,n=i.max,s=i.decay??1;if(i.time||(i.time=0),(i.delayTime??0)>0&&i.time<(i.delayTime??0)&&(i.time+=e.value),!((i.delayTime??0)>0&&i.time<(i.delayTime??0))){switch(i.status){case"increasing":i.value>=n?(i.status="decreasing",i.loops||(i.loops=0),i.loops++):i.value+=(i.velocity??0)*e.factor;break;case"decreasing":i.value<=r?(i.status="increasing",i.loops||(i.loops=0),i.loops++):i.value-=(i.velocity??0)*e.factor;break}i.velocity&&i.decay!==1&&(i.velocity*=s),k6e(t,i.value,r,n),t.destroyed||(i.value=Z1(i.value,r,n))}}class H6e{constructor(e){this.container=e}init(e){const i=e.options.opacity;e.opacity=W$(i,1);const r=i.animation;r.enable&&(e.opacity.velocity=Zi(r.speed)/100*this.container.retina.reduceFactor,r.sync||(e.opacity.velocity*=Zr()))}isEnabled(e){return!e.destroyed&&!e.spawning&&!!e.opacity&&e.opacity.enable&&((e.opacity.maxLoops??0)<=0||(e.opacity.maxLoops??0)>0&&(e.opacity.loops??0)<(e.opacity.maxLoops??0))}reset(e){e.opacity&&(e.opacity.time=0,e.opacity.loops=0)}update(e,i){this.isEnabled(e)&&V6e(e,i)}}async function G6e(t,e=!0){await t.addParticleUpdater("opacity",i=>new H6e(i),e)}function j6e(t){if(t.outMode!=="bounce"&&t.outMode!=="bounce-horizontal"&&t.outMode!=="bounceHorizontal"&&t.outMode!=="split"||t.direction!=="left"&&t.direction!=="right")return;t.bounds.right<0&&t.direction==="left"?t.particle.position.x=t.size+t.offset.x:t.bounds.left>t.canvasSize.width&&t.direction==="right"&&(t.particle.position.x=t.canvasSize.width-t.size-t.offset.x);const e=t.particle.velocity.x;let i=!1;if(t.direction==="right"&&t.bounds.right>=t.canvasSize.width&&e>0||t.direction==="left"&&t.bounds.left<=0&&e<0){const n=qF(t.particle.options.bounce.horizontal);t.particle.velocity.x*=-n,i=!0}if(!i)return;const r=t.offset.x+t.size;t.bounds.right>=t.canvasSize.width&&t.direction==="right"?t.particle.position.x=t.canvasSize.width-r:t.bounds.left<=0&&t.direction==="left"&&(t.particle.position.x=r),t.outMode==="split"&&t.particle.destroy()}function W6e(t){if(t.outMode!=="bounce"&&t.outMode!=="bounce-vertical"&&t.outMode!=="bounceVertical"&&t.outMode!=="split"||t.direction!=="bottom"&&t.direction!=="top")return;t.bounds.bottom<0&&t.direction==="top"?t.particle.position.y=t.size+t.offset.y:t.bounds.top>t.canvasSize.height&&t.direction==="bottom"&&(t.particle.position.y=t.canvasSize.height-t.size-t.offset.y);const e=t.particle.velocity.y;let i=!1;if(t.direction==="bottom"&&t.bounds.bottom>=t.canvasSize.height&&e>0||t.direction==="top"&&t.bounds.top<=0&&e<0){const n=qF(t.particle.options.bounce.vertical);t.particle.velocity.y*=-n,i=!0}if(!i)return;const r=t.offset.y+t.size;t.bounds.bottom>=t.canvasSize.height&&t.direction==="bottom"?t.particle.position.y=t.canvasSize.height-r:t.bounds.top<=0&&t.direction==="top"&&(t.particle.position.y=r),t.outMode==="split"&&t.particle.destroy()}class q6e{constructor(e){this.container=e,this.modes=["bounce","bounce-vertical","bounce-horizontal","bounceVertical","bounceHorizontal","split"]}update(e,i,r,n){if(!this.modes.includes(n))return;const s=this.container;let a=!1;for(const[,d]of s.plugins)if(d.particleBounce!==void 0&&(a=d.particleBounce(e,r,i)),a)break;if(a)return;const o=e.getPosition(),l=e.offset,c=e.getRadius(),u=XF(o,c),h=s.canvas.size;j6e({particle:e,outMode:n,direction:i,bounds:u,canvasSize:h,offset:l,size:c}),W6e({particle:e,outMode:n,direction:i,bounds:u,canvasSize:h,offset:l,size:c})}}class X6e{constructor(e){this.container=e,this.modes=["destroy"]}update(e,i,r,n){if(!this.modes.includes(n))return;const s=this.container;switch(e.outType){case"normal":case"outside":if(qP(e.position,s.canvas.size,bc.origin,e.getRadius(),i))return;break;case"inside":{const{dx:a,dy:o}=T1(e.position,e.moveCenter),{x:l,y:c}=e.velocity;if(l<0&&a>e.moveCenter.radius||c<0&&o>e.moveCenter.radius||l>=0&&a<-e.moveCenter.radius||c>=0&&o<-e.moveCenter.radius)return;break}}s.particles.remove(e,void 0,!0)}}class Y6e{constructor(e){this.container=e,this.modes=["none"]}update(e,i,r,n){if(!this.modes.includes(n)||e.options.move.distance.horizontal&&(i==="left"||i==="right")||e.options.move.distance.vertical&&(i==="top"||i==="bottom"))return;const s=e.options.move.gravity,a=this.container,o=a.canvas.size,l=e.getRadius();if(s.enable){const c=e.position;(!s.inverse&&c.y>o.height+l&&i==="bottom"||s.inverse&&c.y<-l&&i==="top")&&a.particles.remove(e)}else{if(e.velocity.y>0&&e.position.y<=o.height+l||e.velocity.y<0&&e.position.y>=-l||e.velocity.x>0&&e.position.x<=o.width+l||e.velocity.x<0&&e.position.x>=-l)return;qP(e.position,a.canvas.size,bc.origin,l,i)||a.particles.remove(e)}}}class Q6e{constructor(e){this.container=e,this.modes=["out"]}update(e,i,r,n){if(!this.modes.includes(n))return;const s=this.container;switch(e.outType){case"inside":{const{x:a,y:o}=e.velocity,l=bc.origin;l.length=e.moveCenter.radius,l.angle=e.velocity.angle+Math.PI,l.addTo(bc.create(e.moveCenter));const{dx:c,dy:u}=T1(e.position,l);if(a<=0&&c>=0||o<=0&&u>=0||a>=0&&c<=0||o>=0&&u<=0)return;e.position.x=Math.floor(iu({min:0,max:s.canvas.size.width})),e.position.y=Math.floor(iu({min:0,max:s.canvas.size.height}));const{dx:h,dy:d}=T1(e.position,e.moveCenter);e.direction=Math.atan2(-d,-h),e.velocity.angle=e.direction;break}default:{if(qP(e.position,s.canvas.size,bc.origin,e.getRadius(),i))return;switch(e.outType){case"outside":{e.position.x=Math.floor(iu({min:-e.moveCenter.radius,max:e.moveCenter.radius}))+e.moveCenter.x,e.position.y=Math.floor(iu({min:-e.moveCenter.radius,max:e.moveCenter.radius}))+e.moveCenter.y;const{dx:a,dy:o}=T1(e.position,e.moveCenter);e.moveCenter.radius&&(e.direction=Math.atan2(o,a),e.velocity.angle=e.direction);break}case"normal":{const a=e.options.move.warp,o=s.canvas.size,l={bottom:o.height+e.getRadius()+e.offset.y,left:-e.getRadius()-e.offset.x,right:o.width+e.getRadius()+e.offset.x,top:-e.getRadius()-e.offset.y},c=e.getRadius(),u=XF(e.position,c);i==="right"&&u.left>o.width+e.offset.x?(e.position.x=l.left,e.initialPosition.x=e.position.x,a||(e.position.y=Zr()*o.height,e.initialPosition.y=e.position.y)):i==="left"&&u.right<-e.offset.x&&(e.position.x=l.right,e.initialPosition.x=e.position.x,a||(e.position.y=Zr()*o.height,e.initialPosition.y=e.position.y)),i==="bottom"&&u.top>o.height+e.offset.y?(a||(e.position.x=Zr()*o.width,e.initialPosition.x=e.position.x),e.position.y=l.top,e.initialPosition.y=e.position.y):i==="top"&&u.bottom<-e.offset.y&&(a||(e.position.x=Zr()*o.width,e.initialPosition.x=e.position.x),e.position.y=l.bottom,e.initialPosition.y=e.position.y);break}}break}}}}class Z6e{constructor(e){this.container=e,this._updateOutMode=(i,r,n,s)=>{for(const a of this.updaters)a.update(i,s,r,n)},this.updaters=[new q6e(e),new X6e(e),new Q6e(e),new Y6e(e)]}init(){}isEnabled(e){return!e.destroyed&&!e.spawning}update(e,i){const r=e.options.move.outModes;this._updateOutMode(e,i,r.bottom??r.default,"bottom"),this._updateOutMode(e,i,r.left??r.default,"left"),this._updateOutMode(e,i,r.right??r.default,"right"),this._updateOutMode(e,i,r.top??r.default,"top")}}async function K6e(t,e=!0){await t.addParticleUpdater("outModes",i=>new Z6e(i),e)}function J6e(t,e,i,r){switch(t.options.size.animation.destroy){case"max":e>=r&&t.destroy();break;case"min":e<=i&&t.destroy();break}}function $6e(t,e){const i=t.size;if(t.destroyed||!i||!i.enable||(i.maxLoops??0)>0&&(i.loops??0)>(i.maxLoops??0))return;const r=(i.velocity??0)*e.factor,n=i.min,s=i.max,a=i.decay??1;if(i.time||(i.time=0),(i.delayTime??0)>0&&i.time<(i.delayTime??0)&&(i.time+=e.value),!((i.delayTime??0)>0&&i.time<(i.delayTime??0))){switch(i.status){case"increasing":i.value>=s?(i.status="decreasing",i.loops||(i.loops=0),i.loops++):i.value+=r;break;case"decreasing":i.value<=n?(i.status="increasing",i.loops||(i.loops=0),i.loops++):i.value-=r}i.velocity&&a!==1&&(i.velocity*=a),J6e(t,i.value,n,s),t.destroyed||(i.value=Z1(i.value,n,s))}}class eHe{init(e){const i=e.container,r=e.options.size,n=r.animation;n.enable&&(e.size.velocity=(e.retina.sizeAnimationSpeed??i.retina.sizeAnimationSpeed)/100*i.retina.reduceFactor,n.sync||(e.size.velocity*=Zr()))}isEnabled(e){return!e.destroyed&&!e.spawning&&e.size.enable&&((e.size.maxLoops??0)<=0||(e.size.maxLoops??0)>0&&(e.size.loops??0)<(e.size.maxLoops??0))}reset(e){e.size.loops=0}update(e,i){this.isEnabled(e)&&$6e(e,i)}}async function tHe(t,e=!0){await t.addParticleUpdater("size",()=>new eHe,e)}async function iHe(t,e=!0){await I6e(t,!1),await U6e(t,!1),await F6e(t,!1),await G6e(t,!1),await K6e(t,!1),await tHe(t,!1),await t.refresh(e)}class rHe{randomPosition(e,i,r){const n=(h,d)=>{const p=Zr()/4,g=Math.atan(d/h*Math.tan(2*Math.PI*p)),x=Zr();return x<.25?g:x<.5?Math.PI-g:x<.75?Math.PI+g:-g},s=(h,d,p)=>h*d/Math.sqrt((d*Math.cos(p))**2+(h*Math.sin(p))**2),[a,o]=[i.width/2,i.height/2],l=n(a,o),c=s(a,o,l),u=r?c*Math.sqrt(Zr()):c;return{x:e.x+u*Math.cos(l),y:e.y+u*Math.sin(l)}}}class nHe{constructor(){this.wait=!1}load(e){e&&(e.count!==void 0&&(this.count=e.count),e.delay!==void 0&&(this.delay=pr(e.delay)),e.duration!==void 0&&(this.duration=pr(e.duration)),e.wait!==void 0&&(this.wait=e.wait))}}class sHe{constructor(){this.quantity=1,this.delay=.1}load(e){e!==void 0&&(e.quantity!==void 0&&(this.quantity=pr(e.quantity)),e.delay!==void 0&&(this.delay=pr(e.delay)))}}class nee{constructor(){this.mode="percent",this.height=0,this.width=0}load(e){e!==void 0&&(e.mode!==void 0&&(this.mode=e.mode),e.height!==void 0&&(this.height=e.height),e.width!==void 0&&(this.width=e.width))}}class rg{constructor(){this.autoPlay=!0,this.fill=!0,this.life=new nHe,this.rate=new sHe,this.shape="square",this.startCount=0}load(e){e&&(e.autoPlay!==void 0&&(this.autoPlay=e.autoPlay),e.size!==void 0&&(this.size||(this.size=new nee),this.size.load(e.size)),e.direction!==void 0&&(this.direction=e.direction),this.domId=e.domId,e.fill!==void 0&&(this.fill=e.fill),this.life.load(e.life),this.name=e.name,this.particles=Qd(e.particles,i=>sa({},i)),this.rate.load(e.rate),e.shape!==void 0&&(this.shape=e.shape),e.position!==void 0&&(this.position={},e.position.x!==void 0&&(this.position.x=pr(e.position.x)),e.position.y!==void 0&&(this.position.y=pr(e.position.y))),e.spawnColor!==void 0&&(this.spawnColor===void 0&&(this.spawnColor=new K1),this.spawnColor.load(e.spawnColor)),e.startCount!==void 0&&(this.startCount=e.startCount))}}class aHe{constructor(e,i,r,n,s){var o,l;this.emitters=i,this.container=r,this._calcPosition=()=>Xke({size:this.container.canvas.size,position:this.options.position}),this._destroy=()=>{this.emitters.removeEmitter(this),this._engine.dispatchEvent("emitterDestroyed",{container:this.container,data:{emitter:this}})},this._emit=()=>{if(this._paused)return;const c=Zi(this.options.rate.quantity);this._emitParticles(c)},this._emitParticles=c=>{var p,g;const u=this.getPosition(),h=this.getSize(),d=C1(this._particlesOptions);for(let x=0;x<c;x++){const v=sa({},d);if(this.spawnColor){const w=(p=this.options.spawnColor)==null?void 0:p.animation;w&&(this.spawnColor.h=this._setColorAnimation(w.h,this.spawnColor.h,360),this.spawnColor.s=this._setColorAnimation(w.s,this.spawnColor.s,100),this.spawnColor.l=this._setColorAnimation(w.l,this.spawnColor.l,100)),v.color?v.color.value=this.spawnColor:v.color={value:this.spawnColor}}if(!u)return;const b=((g=this._shape)==null?void 0:g.randomPosition(u,h,this.fill))??u;this.container.particles.addParticle(b,v)}},this._prepareToDie=()=>{var u;if(this._paused)return;const c=((u=this.options.life)==null?void 0:u.duration)!==void 0?Zi(this.options.life.duration):void 0;this.container.retina.reduceFactor&&(this._lifeCount>0||this._immortal)&&c!==void 0&&c>0&&(this._duration=c*1e3)},this._setColorAnimation=(c,u,h)=>{const d=this.container;if(!c.enable)return u;const p=iu(c.offset),g=Zi(this.options.rate.delay),x=1e3*g/d.retina.reduceFactor,v=Zi(c.speed??0);return(u+v*d.fpsLimit/x+p*3.6)%h},this._engine=e,this._currentDuration=0,this._currentEmitDelay=0,this._currentSpawnDelay=0,this._initialPosition=s,n instanceof rg?this.options=n:(this.options=new rg,this.options.load(n)),this._spawnDelay=Zi(this.options.life.delay??0)*1e3/this.container.retina.reduceFactor,this.position=this._initialPosition??this._calcPosition(),this.name=this.options.name,this._shape=(o=this._engine.emitterShapeManager)==null?void 0:o.getShape(this.options.shape),this.fill=this.options.fill,this._firstSpawn=!this.options.life.wait,this._startParticlesAdded=!1;let a=sa({},this.options.particles);a??(a={}),a.move??(a.move={}),(l=a.move).direction??(l.direction=this.options.direction),this.options.spawnColor&&(this.spawnColor=g3(this.options.spawnColor)),this._paused=!this.options.autoPlay,this._particlesOptions=a,this.size=this.options.size??(()=>{const c=new nee;return c.load({height:0,mode:"percent",width:0}),c})(),this._lifeCount=this.options.life.count??-1,this._immortal=this._lifeCount<=0,this._engine.dispatchEvent("emitterCreated",{container:r,data:{emitter:this}}),this.play()}externalPause(){this._paused=!0,this.pause()}externalPlay(){this._paused=!1,this.play()}getPosition(){if(this.options.domId){const e=this.container,i=document.getElementById(this.options.domId);if(i){const r=i.getBoundingClientRect();return{x:(r.x+r.width/2)*e.retina.pixelRatio,y:(r.y+r.height/2)*e.retina.pixelRatio}}}return this.position}getSize(){const e=this.container;if(this.options.domId){const i=document.getElementById(this.options.domId);if(i){const r=i.getBoundingClientRect();return{width:r.width*e.retina.pixelRatio,height:r.height*e.retina.pixelRatio}}}return $ke(this.size,e.canvas.size)}pause(){this._paused||delete this._emitDelay}play(){if(!this._paused&&this.container.retina.reduceFactor&&(this._lifeCount>0||this._immortal||!this.options.life.count)&&(this._firstSpawn||this._currentSpawnDelay>=(this._spawnDelay??0))){if(this._emitDelay===void 0){const e=Zi(this.options.rate.delay);this._emitDelay=1e3*e/this.container.retina.reduceFactor}(this._lifeCount>0||this._immortal)&&this._prepareToDie()}}resize(){const e=this._initialPosition;this.position=e&&qP(e,this.container.canvas.size,bc.origin)?e:this._calcPosition()}update(e){this._paused||(this._firstSpawn&&(this._firstSpawn=!1,this._currentSpawnDelay=this._spawnDelay??0,this._currentEmitDelay=this._emitDelay??0),this._startParticlesAdded||(this._startParticlesAdded=!0,this._emitParticles(this.options.startCount)),this._duration!==void 0&&(this._currentDuration+=e.value,this._currentDuration>=this._duration&&(this.pause(),this._spawnDelay!==void 0&&delete this._spawnDelay,this._immortal||this._lifeCount--,this._lifeCount>0||this._immortal?(this.position=this._calcPosition(),this._spawnDelay=Zi(this.options.life.delay??0)*1e3/this.container.retina.reduceFactor):this._destroy(),this._currentDuration-=this._duration,delete this._duration)),this._spawnDelay!==void 0&&(this._currentSpawnDelay+=e.value,this._currentSpawnDelay>=this._spawnDelay&&(this._engine.dispatchEvent("emitterPlay",{container:this.container}),this.play(),this._currentSpawnDelay-=this._currentSpawnDelay,delete this._spawnDelay)),this._emitDelay!==void 0&&(this._currentEmitDelay+=e.value,this._currentEmitDelay>=this._emitDelay&&(this._emit(),this._currentEmitDelay-=this._emitDelay)))}}class oHe{constructor(e,i){this.container=i,this._engine=e,this.array=[],this.emitters=[],this.interactivityEmitters={random:{count:1,enable:!1},value:[]},i.getEmitter=r=>r===void 0||au(r)?this.array[r||0]:this.array.find(n=>n.name===r),i.addEmitter=(r,n)=>this.addEmitter(r,n),i.removeEmitter=r=>{const n=i.getEmitter(r);n&&this.removeEmitter(n)},i.playEmitter=r=>{const n=i.getEmitter(r);n&&n.externalPlay()},i.pauseEmitter=r=>{const n=i.getEmitter(r);n&&n.externalPause()}}addEmitter(e,i){const r=new rg;r.load(e);const n=new aHe(this._engine,this,this.container,r,i);return this.array.push(n),n}handleClickMode(e){const i=this.emitters,r=this.interactivityEmitters;if(e!=="emitter")return;let n;if(r&&cl(r.value))if(r.value.length>0&&r.random.enable){n=[];const o=[];for(let l=0;l<r.random.count;l++){const c=j$(r.value);if(o.includes(c)&&o.length<r.value.length){l--;continue}o.push(c),n.push(WP(r.value,c))}}else n=r.value;else n=r==null?void 0:r.value;const s=n??i,a=this.container.interactivity.mouse.clickPosition;Qd(s,o=>{this.addEmitter(o,a)})}async init(){if(this.emitters=this.container.actualOptions.emitters,this.interactivityEmitters=this.container.actualOptions.interactivity.modes.emitters,!!this.emitters)if(cl(this.emitters))for(const e of this.emitters)this.addEmitter(e);else this.addEmitter(this.emitters)}pause(){for(const e of this.array)e.pause()}play(){for(const e of this.array)e.play()}removeEmitter(e){const i=this.array.indexOf(e);i>=0&&this.array.splice(i,1)}resize(){for(const e of this.array)e.resize()}stop(){this.array=[]}update(e){for(const i of this.array)i.update(e)}}const hz=new Map;class lHe{constructor(e){this._engine=e}addShape(e,i){this.getShape(e)||hz.set(e,i)}getShape(e){return hz.get(e)}getSupportedShapes(){return hz.keys()}}function X9(t,e){return t+e*(Zr()-.5)}class cHe{randomPosition(e,i,r){if(r)return{x:X9(e.x,i.width),y:X9(e.y,i.height)};{const n=i.width/2,s=i.height/2,a=Math.floor(Zr()*4),o=(Zr()-.5)*2;switch(a){case 0:return{x:e.x+o*n,y:e.y-s};case 1:return{x:e.x-n,y:e.y+o*s};case 2:return{x:e.x+o*n,y:e.y+s};case 3:default:return{x:e.x+n,y:e.y+o*s}}}}}class uHe{constructor(e){this._engine=e,this.id="emitters"}getPlugin(e){return new oHe(this._engine,e)}loadOptions(e,i){var n,s;if(!this.needsPlugin(e)&&!this.needsPlugin(i))return;i!=null&&i.emitters&&(e.emitters=Qd(i.emitters,a=>{const o=new rg;return o.load(a),o}));const r=(s=(n=i==null?void 0:i.interactivity)==null?void 0:n.modes)==null?void 0:s.emitters;if(r)if(cl(r))e.interactivity.modes.emitters={random:{count:1,enable:!0},value:r.map(a=>{const o=new rg;return o.load(a),o})};else{const a=r;if(a.value!==void 0)if(cl(a.value))e.interactivity.modes.emitters={random:{count:a.random.count??1,enable:a.random.enable??!1},value:a.value.map(o=>{const l=new rg;return l.load(o),l})};else{const o=new rg;o.load(a.value),e.interactivity.modes.emitters={random:{count:a.random.count??1,enable:a.random.enable??!1},value:o}}else(e.interactivity.modes.emitters={random:{count:1,enable:!1},value:new rg}).value.load(r)}}needsPlugin(e){var r,n,s;if(!e)return!1;const i=e.emitters;return cl(i)&&!!i.length||i!==void 0||!!((s=(n=(r=e.interactivity)==null?void 0:r.events)==null?void 0:n.onClick)!=null&&s.mode)&&G$("emitter",e.interactivity.events.onClick.mode)}}async function hHe(t,e=!0){t.emitterShapeManager||(t.emitterShapeManager=new lHe(t)),t.addEmitterShape||(t.addEmitterShape=(r,n)=>{var s;(s=t.emitterShapeManager)==null||s.addShape(r,n)});const i=new uHe(t);await t.addPlugin(i,e),t.addEmitterShape("circle",new rHe),t.addEmitterShape("square",new cHe)}async function dHe(t,e=!0){await iHe(t,!1),await hHe(t,!1),await M6e(t,!1),await t.addPreset(E6e,A6e,e)}const fHe=({id:t="tsparticles",className:e="",backgroundColor:i="#0a4766",fullScreen:r=!0,particleSpeed:n=2})=>{const s=yC.useCallback(async o=>{await dHe(o)},[]),a={preset:"seaAnemone",particles:{move:{speed:n}},background:{color:i},fullScreen:{enable:r,zIndex:r?-1:0}};return Pe.jsx(QP,{id:t,className:e,options:a,init:s})},pHe=()=>Pe.jsx("div",{className:"app",children:Pe.jsx(fHe,{id:"background-anemone",backgroundColor:"#0a4766",particleSpeed:1.5})}),mHe=()=>Pe.jsx(iK,{});function gHe(){return Pe.jsx(cie,{children:Pe.jsxs(kte,{children:[Pe.jsx(Wm,{path:"/",element:Pe.jsx(MRe,{})}),Pe.jsx(Wm,{path:"/search",element:Pe.jsx(Rke,{})}),Pe.jsx(Wm,{path:"/class/:id",element:Pe.jsx(Oke,{})}),Pe.jsx(Wm,{path:"/cloud",element:Pe.jsx(Lke,{})}),Pe.jsx(Wm,{path:"/scroll",element:Pe.jsx(Ike,{})}),Pe.jsx(Wm,{path:"/anemone",element:Pe.jsx(pHe,{})}),Pe.jsx(Wm,{path:"/robot",element:Pe.jsx(mHe,{})})]})})}Qee.createRoot(document.getElementById("root")).render(Pe.jsx(Me.StrictMode,{children:Pe.jsx(gHe,{})}));export{gA as c,x3 as g};
